---
title: 'Lync Server 2013: Настройка сертификатов для внешнего интерфейса пограничного сервера'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Set up certificates for the external edge interface
ms:assetid: 5d78182c-88d8-4483-95ad-74b17f2d5fac
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg398409(v=OCS.15)
ms:contentKeyID: 48184287
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 0aadbc9603fb62a2dacf78129aef3bf448da2f05
ms.sourcegitcommit: 33db8c7febd4cf1591e8dcbbdfd6fc8e8925896e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "42143409"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="set-up-certificates-for-the-external-edge-interface-for-lync-server-2013"></a>Настройка сертификатов для внешнего пограничного интерфейса для Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2012-09-08_

<div>


> [!IMPORTANT]  
> При запуске мастера сертификатов следует убедиться, что вход выполнен с использованием учетной записи, являющейся членом группы, которой назначены соответствующие разрешения для используемого шаблона сертификата. По умолчанию запрос на сертификат сервера Lync Server будет использовать шаблон сертификата веб-сервера. Если для запроса на сертификат, использующего этот шаблон, применяется учетная запись, которая является членом группы RTCUniversalServerAdmins, проверьте, назначены ли этой группе разрешения на регистрацию, необходимые для использования этого шаблона.



</div>

Каждому пограничному серверу требуется общедоступный сертификат на интерфейс между сетью периметра и Интернетом, и альтернативное имя субъекта сертификата должно содержать внешние имена полных доменных имен пограничной службы доступа и пограничной службы веб-конференций.

Сведения о данном и других требованиях к сертификатам приведены [в статье требования к сертификатам для доступа внешних пользователей в Lync Server 2013](lync-server-2013-certificate-requirements-for-external-user-access.md).

Список общедоступных центров сертификации (ЦС), предоставляющих сертификаты, которые соответствуют определенным требованиям для Объединенных сертификатов и партнерской корпорации Майкрософт, чтобы убедиться, что они работают с мастером сертификатов Lync Server 2013, можно узнать в статье базы знаний Майкрософт 929395, "Объединенные партнеры сертификатов для Exchange Server и Communications Server" в [https://go.microsoft.com/fwlink/p/?linkId=202834](https://go.microsoft.com/fwlink/p/?linkid=202834).

<div>

## <a name="configuring-certificates-on-the-external-interfaces"></a>Настройка сертификатов для внешних интерфейсов

Чтобы настроить сертификат для внешнего пограничного интерфейса на сайте, с помощью процедур, приведенных в данном разделе, выполните следующие действия.

  - Создайте запрос на сертификат для внешнего интерфейса пограничного сервера.

  - Отправьте этот запрос в свой общедоступный центр сертификации.

  - Импортируйте сертификат для внешнего интерфейса каждого пограничного сервера.

  - Назначьте сертификат внешнему интерфейсу каждого пограничного сервера.

  - Если в вашем развертывании имеется несколько пограничных серверов, экспортируйте сертификат вместе с его закрытым ключом, после чего скопируйте его на остальные пограничные серверы. Затем импортируйте и назначьте его для каждого пограничного сервера, как описано выше. Повторите эту процедуру для каждого пограничного сервера.

Общедоступные сертификаты можно запрашивать непосредственно в общедоступном центре сертификации (например, на веб-сайте общедоступного ЦС). В процедурах этого раздела для большинства задач с сертификатами используется мастер сертификатов. При запросе сертификата непосредственно в общедоступном ЦС придется соответствующим образом изменить каждую процедуру для запроса, транспортировки и импорта сертификата, а также для импорта цепочки сертификатов.

При запросе сертификата во внешнем ЦС предоставленные учетные данные должны иметь права на запрос сертификата из этого ЦС. Каждый ЦС имеет политику безопасности, определяющую, каким учетным данным (т.е. конкретным именам пользователей и групп) разрешается запрашивать, выдавать, читать сертификаты или управлять ими.

Если для импорта цепочки сертификатов и сертификата планируется использовать консоль управления (MMC) "Сертификаты", то необходимо импортировать их в хранилище сертификатов для компьютера. Если вы импортируете их в хранилище сертификатов пользователя или службы, сертификат будет недоступен для назначения в мастере сертификатов Lync Server 2013.

<div>

## <a name="to-create-the-certificate-request-for-the-external-interface-of-the-edge-server"></a>Создание запроса на сертификат для внешнего интерфейса пограничного сервера

1.  На пограничном сервере в мастере развертывания нажмите кнопку **Run again (Запустить снова)** рядом с пунктом **Step 3: Request, Install, or Assign Certificates (Шаг 3. Запрос, установка или назначение сертификатов)**.
    
    <div>
    

    > [!NOTE]  
    > Если ваша организация хочет поддерживает подключение к общедоступным системам обмена мгновенными сообщениями с AOL, нельзя использовать мастер развертывания Lync Server для запроса сертификата. Вместо этого выполните действия из процедуры “Создание запроса на сертификат для внешнего интерфейса пограничного сервера для поддержки общедоступного подключения к системе обмена мгновенными сообщениями AOL”, которая приводится ниже в этом разделе.<BR>Если в одном расположении пула несколько пограничных серверов, можно запустить мастер сертификатов Lync Server 2013 на одном из пограничных серверов.

    
    </div>

2.  На странице **Available Certificate Tasks** (Доступные задачи сертификатов) щелкните команду **Create a new certificate request** (Создать новый запрос сертификата).

3.  На странице **запроса сертификата** выберите пункт **External Edge Certificate** (Внешний сертификат пограничного сервера).

4.  На странице **Отложенный или немедленный запрос** установите флажок **Подготовить запрос сейчас, чтобы отправить его позже**.

5.  На странице **файл запроса сертификата** введите полный путь и имя файла, в который будет сохранен запрос (например, c:\\CERT\_ексернал\_Edge. cer).

6.  На странице **указания альтернативного шаблона сертификата** для использования шаблона, отличного от шаблона WebServer по умолчанию, установите флажок **Use alternative certificate template for the selected certification authority** (Использовать альтернативный шаблон сертификата для выбранного центра сертификации).

7.  На странице **настроек имени и безопасности** выполните следующие действия.
    
      - В поле **Friendly name (Понятное имя)** введите отображаемое имя для сертификата.
    
      - В поле **Bit length (Длина в битах)** задайте длину в битах (обычно это установленное по умолчанию значение **2048**).
    
      - Убедитесь, что установлен флажок **Mark certificate private key as exportable (Пометить закрытый ключ сертификата как экспортируемый)**.

8.  На странице **сведений об организации** укажите имя организации и подразделения (например, отделения или отдела).

9.  На странице **сведений о местоположении** укажите сведения о местоположении.

10. На странице **имени субъекта и альтернативных имен субъекта** отображаются сведения, автоматически заполненные мастером. Если требуются дополнительные альтернативные имена субъекта, то они указываются в следующих двух действиях.

11. На странице **Параметры домена SIP в альтернативных именах субъектов (SAN)** установите флажок домен, чтобы добавить SIP. \<sipdomain\> запись в список альтернативных имен субъектов.

12. На странице **Configure Additional Subject Alternate Names (Настройка дополнительных альтернативных имен субъекта)** укажите все нужные дополнительные альтернативные имена субъектов.

13. На странице **Request Summary (Сводка по запросу)** просмотрите сведения о сертификате, которые будут использоваться для создания запроса.

14. После завершения выполнения команды выполните следующие действия.
    
      - Чтобы просмотреть журнал запроса на сертификат, нажмите **View Log (Просмотреть журнал)**.
    
      - Чтобы завершить запрос на сертификат, нажмите кнопку **Далее**.

15. На странице **Certificate Request File (Файл запроса сертификата)** выполните следующие действия.
    
      - Чтобы просмотреть файл запроса подписи сертификата (CSR-файл), нажмите кнопку **View (Просмотр)**.
    
      - Чтобы закрыть мастер, нажмите кнопку **Готово**.

16. Скопируйте выходной файл в расположение, из которого можно будет отправить его в общедоступный ЦС.

</div>

<div>

## <a name="to-create-a-certificate-request-for-the-external-interface-of-the-edge-server-to-support-public-im-connectivity-with-aol"></a>Создание запроса на сертификат для внешнего интерфейса пограничного сервера для поддержки общедоступного подключения к системе обмена мгновенными сообщениями AOL

1.  Если необходимый шаблон доступен для ЦС, используйте следующий командлет Windows PowerShell на пограничном сервере, чтобы запросить сертификат:
    
        Request-CsCertificate -New -Type AccessEdgeExternal  -Output C:\ <certfilename.txt or certfilename.csr>  -ClientEku $true -Template <template name>
    
    Имя сертификата по умолчанию для шаблона, указанного в Lync Server 2013, — Web Server. Указывайте имя \<\> шаблона только в том случае, если требуется использовать шаблон, отличный от шаблона по умолчанию.
    
    <div>
    

    > [!NOTE]  
    > Если в Организации требуется поддерживать связь с общедоступной службой обмена мгновенными сообщениями с AOL, необходимо использовать Windows PowerShell вместо мастера сертификатов, чтобы запросить сертификат для внешнего края службы пограничного доступа. Это связано с тем, что шаблон веб-сервера Lync Server 2013, который мастер сертификатов использует для запроса сертификата, не поддерживает настройку клиентского EKU. Прежде чем использовать Windows PowerShell для создания сертификата, администратору ЦС необходимо создать и развернуть новый шаблон, поддерживающий клиентское EKU.

    
    </div>

</div>

<div>

## <a name="to-submit-a-request-to-a-public-certification-authority"></a>Отправка запроса в общедоступный центр сертификации

1.  Откройте выходной файл.

2.  Скопируйте и вставьте содержимое запроса подписи сертификата (CSR-файла).

3.  При запросе укажите следующее:
    
      - **Microsoft** в качестве серверной платформы;
    
      - **IIS** в качестве версии;
    
      - **Web Server** в качестве типа использования;
    
      - **PKCS7** в качестве формата ответа.

4.  Когда общедоступный ЦС проверит ваши сведения, вы получите сообщение электронной почты с текстом, необходимым для вашего сертификата.

5.  Скопируйте текст из этого сообщения и сохраните его в текстовом файле (TXT-файле) на локальном компьютере.

</div>

<div>

## <a name="to-import-the-certificate-for-the-external-interface-of-the-edge-server"></a>Импорт сертификата для внешнего интерфейса пограничного сервера

1.  Войдите как член группы администраторов на тот же пограничный сервер, на котором создавался запрос на сертификат.

2.  В мастере развертывания на странице **Deploy Edge Server (Развертывание пограничного сервера)** нажмите кнопку **Run again (Запустить снова)** рядом с пунктом **Step 3: Request, Install, or Assign Certificates (Шаг 3. Запрос, установка или назначение сертификатов)**.

3.  На странице **Available Certificate Tasks (Доступные задачи с сертификатами)** нажмите **Import a certificate from a .p7b, pfx or .cer file (Импортировать сертификат из файла P7B, PFX или CER)**.

4.  На странице **Import Certificate (Импорт сертификата)** нажмите кнопку **Обзор**, чтобы найти и выбрать сертификат, запрошенный для внешнего интерфейса пограничного сервера (или можно ввести полный путь и имя). Если сертификат содержит закрытый ключ, выберите **Certificate file contains certificate’s private key (Файл сертификата, содержащий закрытый ключ сертификата)** и введите пароль для закрытого ключа. Нажмите кнопку **Далее**.

5.  На странице **Import Certificate Summary (Сводка по импорту сертификата)** просмотрите сводку и нажмите кнопку **Далее**.

6.  На странице **Executing Commands (Выполненные команды)** просмотрите результаты импорта, при необходимости получения дополнительных сведений нажмите кнопку **View Log (Просмотреть журнал)**, а затем нажмите кнопку **Готово**, чтобы завершить импорт сертификата.

7.  Если настраивается пул пограничных серверов, экспортируйте сертификат с его закрытым ключом, как описывается в процедуре “Экспорт сертификата с закрытым ключом для пограничных серверов в пуле” далее в этом разделе. Скопируйте экспортированный файл сертификата на остальные пограничные сервера и импортируйте его в хранилище компьютера на каждом пограничном сервере.

</div>

<div>

## <a name="to-export-the-certificate-with-the-private-key-for-edge-servers-in-a-pool"></a>Экспорт сертификата с закрытым ключом для пограничных серверов в пуле

1.  Войдите как член группы администраторов на тот же пограничный сервер, на котором выполнялся импорт сертификата.

2.  Нажмите кнопку **Пуск**, выберите пункт **Выполнить** и введите **MMC**.

3.  В консоли управления (MMC) последовательно выберите пункты **Файл** и **Добавить или удалить оснастку**.

4.  В окне **Добавление и удаление оснасток** выберите пункт **Сертификаты** и нажмите кнопку **Добавить**.

5.  В диалоговом окне **Сертификаты** выберите пункт **Учетная запись компьютера**, нажмите кнопку **Далее**, выберите пункт **Локальный компьютер (на котором запущена эта консоль)** в разделе **Выбор компьютера**, нажмите кнопку **Готово**, а затем нажмите кнопку **ОК**, чтобы завершить настройку консоли MMC.

6.  Дважды щелкните пункт **Сертификаты (локальный компьютер)**, чтобы развернуть хранилища сертификатов, дважды щелкните пункт **Личные**, а затем дважды щелкните пункт **Сертификаты**.
    
    <div>
    

    > [!IMPORTANT]  
    > Если в личном хранилище сертификатов для локального компьютера сертификаты отсутствуют, то отсутствует и закрытый ключ, связанный с импортированным сертификатом. Проанализируйте действия по отправке запроса и импорту. Если проблема сохраняется, обратитесь к своему администратору центра сертификации или к поставщику.

    
    </div>

7.  В **личном хранилище сертификатов для локального компьютера** щелкните правой кнопкой мыши экспортируемый сертификат, выберите пункт **Все задачи** и нажмите **Экспорт**.

8.  В мастере экспорта сертификатов нажмите кнопку **Далее**, установите флажок **Да, экспортировать закрытый ключ** и нажмите кнопку **Далее**.
    
    <div>
    

    > [!NOTE]  
    > Если установить флажок <STRONG>Да, экспортировать закрытый ключ</STRONG> невозможно, то закрытый ключ, связанный с этим сертификатом, не был помечен для экспорта. В этом случае придется запросить этот сертификат снова и проверить, что в сертификате отмечено разрешение экспорта закрытого ключа, после чего продолжить процедуру экспорта. Обратитесь к администратору центра сертификации или к поставщику.

    
    </div>

9.  В диалоговом окне Экспорт форматов файлов выберите файл **обмена личной информацией —\#PKCS 12 (. PFX)** , а затем выберите следующее:
    
      - Включить по возможности все сертификаты в путь сертификата.
    
      - Экспортировать все расширенные свойства.
        
        <div>
        

        > [!WARNING]  
        > При экспорте сертификата с пограничного сервера не устанавливайте флажок <STRONG>Удалить закрытый ключ после успешного экспорта</STRONG>. Установка этого флажка потребует выполнения импорта сертификата и закрытого ключа на данный пограничный сервер.

        
        </div>

10. Нажмите кнопку **Далее**.

11. Введите пароль для закрытого ключа, повторите его для подтверждения и нажмите кнопку **Далее**.

12. Введите путь и имя файла для экспортированного сертификата, используя расширение PFX. Этот путь должен быть доступен для всех остальных пограничных серверов в пуле, или должна быть возможна транспортировка с помощью съемного носителя, например USB-устройства флэш-памяти. Нажмите кнопку **Далее**.

13. Просмотрите сводку на странице **Завершение мастера экспорта сертификатов** и нажмите кнопку **Готово**.

14. В диалоговом окне, сообщающем об успешном экспорте, нажмите кнопку **ОК**.

15. Импортируйте экспортированный файл сертификата на остальные пограничные серверы, выполнив действия, описанные в процедуре “Импорт сертификата для внешнего интерфейса пограничного сервера” в этом разделе выше.

</div>

<div>

## <a name="to-assign-the-certificate-for-the-external-interface-of-the-edge-server"></a>Назначение сертификата внешнему интерфейсу пограничного сервера

1.  На каждом пограничном сервере в мастере развертывания нажмите кнопку **Run again (Запустить снова)** рядом с пунктом **Step 3: Request, Install, or Assign Certificates (Шаг 3. Запрос, установка или назначение сертификатов)**.

2.  На странице **Available Certificate Tasks (Доступные задачи с сертификатами)** выберите пункт **Assign an existing certificate (Назначить существующий сертификат)**.

3.  На странице **Certificate Assignment (Назначение сертификата)** выберите пункт **External Edge Certificate (Внешний пограничный сертификат)** и установите флажок **Advanced Certificate Usages (Расширенное использование сертификата)**.

4.  На странице **Advanced Certificate Usages (Расширенное использование сертификата)** установите все флажки, чтобы назначить все варианты использования сертификата.

5.  На странице **Certificate Store (Хранилище сертификатов)** выберите общедоступный сертификат, который был запрошен и импортирован для внешнего интерфейса пограничного сервера.
    
    <div>
    

    > [!NOTE]  
    > Если запрошенный и импортированный сертификат отсутствует в списке, можно использовать один из способов устранения неполадки, заключающийся в том, чтобы проверить соответствие имени субъекта и альтернативных имен субъектов всем требованиям для сертификата, и в случае, если сертификат и цепочка сертификатов импортировались вручную, а не с помощью предыдущих процедур, проверить, что сертификат находится в правильном хранилище сертификатов (в хранилище сертификатов компьютера, а не пользователя или службы).

    
    </div>

6.  На странице **Certificate Assignment Summary (Сводка по назначениям сертификатов)** просмотрите все параметры, а затем нажмите кнопку **Далее**, чтобы назначить сертификаты.

7.  На странице завершения мастера нажмите кнопку **Готово**.

8.  После использования этой процедуры для назначения пограничного сертификата откройте оснастку "Сертификаты" на каждом сервере, разверните узел **Сертификаты (локальный компьютер)**, разверните узел **Личные**, выберите пункт **Сертификаты** и проверьте, значится ли этот сертификат в области сведений.

9.  Если в развертывании имеется несколько пограничных серверов, повторите эту процедуру для каждого пограничного сервера.

</div>

</div>

</div>

<span> </span>

</div>

</div>

</div>

