---
title: "Lync Server 2013: сертификаты для внешнего интерфейса пограничного сервера"
TOCTitle: Настройка сертификатов для внешнего интерфейса пограничного сервера
ms:assetid: 5d78182c-88d8-4483-95ad-74b17f2d5fac
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Gg398409(v=OCS.15)
ms:contentKeyID: 49309900
ms.date: 12/10/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Настройка сертификатов для внешнего интерфейса пограничного сервера для Lync Server 2013

 

_**Дата изменения раздела:** 2016-12-08_

> [!IMPORTANT]  
> Перед запуском мастера сертификатов убедитесь, что вы вошли с учетной записью, которая является членом группы, имеющей соответствующие разрешения для типа шаблона сертификата, который вы планируете использовать. По умолчанию запрос на сертификат Lync Server будет использовать шаблон сертификата веб-сервера. Если для запроса на сертификат с помощью этого шаблона вы используете учетную запись, которая является членом группы RTCUniversalServerAdmins, убедитесь, что группе назначены разрешения для регистрации, требуемые для использования этого шаблона.

Каждому пограничному серверу требуется общедоступный сертификат на интерфейс между сетью периметра и Интернетом, и альтернативное имя субъекта сертификата должно содержать внешние имена полных доменных имен пограничной службы доступа и пограничной службы веб-конференций.

Дополнительные сведения об этом и других требованиях к сертификатам см. в разделе [Требования к сертификатам для доступа внешних пользователей в Lync Server 2013](lync-server-2013-certificate-requirements-for-external-user-access.md).

Список общедоступных центров сертификации, которые соответствуют определенным требованиям для сертификатов объединенных коммуникаций (UC) и сотрудничают с Майкрософт для поддержки работы мастера сертификатов Lync Server 2013, см. в статье базы знаний Майкрософт 929395, «Партнеры по сертификации единой системы связи для Exchange 2007 и Communications Server 2007» по адресу [http://go.microsoft.com/fwlink/p/?linkId=202834](http://go.microsoft.com/fwlink/p/?linkid=202834).

## Настройка сертификатов для внешних интерфейсов

Чтобы настроить сертификат для внешнего пограничного интерфейса на сайте, с помощью процедур, приведенных в данном разделе, выполните следующие действия.

  - Создайте запрос на сертификат для внешнего интерфейса пограничного сервера.

  - Отправьте этот запрос в свой общедоступный центр сертификации.

  - Импортируйте сертификат для внешнего интерфейса каждого пограничного сервера.

  - Назначьте сертификат внешнему интерфейсу каждого пограничного сервера.

  - Если в вашем развертывании имеется несколько пограничных серверов, экспортируйте сертификат вместе с его закрытым ключом, после чего скопируйте его на остальные пограничные серверы. Затем импортируйте и назначьте его для каждого пограничного сервера, как описано выше. Повторите эту процедуру для каждого пограничного сервера.

Общедоступные сертификаты можно запрашивать непосредственно в общедоступном центре сертификации (например, на веб-сайте общедоступного ЦС). В процедурах этого раздела для большинства задач с сертификатами используется мастер сертификатов. При запросе сертификата непосредственно в общедоступном ЦС придется соответствующим образом изменить каждую процедуру для запроса, транспортировки и импорта сертификата, а также для импорта цепочки сертификатов.

При запросе сертификата во внешнем ЦС предоставленные учетные данные должны иметь права на запрос сертификата из этого ЦС. Каждый ЦС имеет политику безопасности, определяющую, каким учетным данным (т.е. конкретным именам пользователей и групп) разрешается запрашивать, выдавать, читать сертификаты или управлять ими.

Если для импорта цепочки сертификатов и сертификата планируется использовать консоль управления (MMC) "Сертификаты", то необходимо импортировать их в хранилище сертификатов для компьютера. Если импортировать их в хранилище сертификатов пользователя или службы, то сертификат не будет доступен для назначения в мастере сертификатов сервера Lync Server 2013.

## Создание запроса на сертификат для внешнего интерфейса пограничного сервера

1.  На пограничном сервере в мастере развертывания рядом с пунктом **Шаг 3. Запрос, установка или назначение сертификатов** нажмите кнопку **Повторный запуск** .
    
    > [!NOTE]  
    > Если организация планирует поддерживать общедоступное подключение к системе обмена мгновенными сообщениями AOL, то нельзя использовать мастер развертывания Lync Server для запроса сертификата. Вместо этого выполните действия из процедуры “Создание запроса на сертификат для внешнего интерфейса пограничного сервера для поддержки общедоступного подключения к системе обмена мгновенными сообщениями AOL”, которая приводится ниже в этом разделе.<br />    Если имеется несколько пограничных серверов в одном расположении в пуле, можно запустить мастер сертификатов сервера Lync Server 2013 на любом из этих пограничных серверов.

2.  На странице **Available Certificate Tasks** (Доступные задачи сертификатов) щелкните команду **Create a new certificate request** (Создать новый запрос сертификата).

3.  На странице **запроса сертификата** выберите пункт **External Edge Certificate** (Внешний сертификат пограничного сервера).

4.  На странице **Отложенный или немедленный запрос** установите флажок **Подготовить запрос сейчас, чтобы отправить его позже** .

5.  На странице **файла запроса сертификата** введите полный путь и имя файла, в который должен сохраняться запрос (например, c:\\cert\_exernal\_edge.cer).

6.  На странице **указания альтернативного шаблона сертификата** для использования шаблона, отличного от шаблона WebServer по умолчанию, установите флажок **Use alternative certificate template for the selected certification authority** (Использовать альтернативный шаблон сертификата для выбранного центра сертификации).

7.  На странице **настроек имени и безопасности** выполните следующие действия.
    
      - В поле **Понятное имя** введите отображаемое имя для сертификата.
    
      - В раскрывающемся списке **Длина в битах** укажите длину в битах (как правило, по умолчанию используется значение **2048** ).
    
      - Убедитесь, что флажок **Mark certificate private key as exportable** (Пометить закрытый ключ сертификата как экспортируемый) установлен.

8.  На странице **сведений об организации** укажите имя организации и подразделения (например, отделения или отдела).

9.  На странице **сведений о местоположении** укажите сведения о местоположении.

10. На странице **имени субъекта и альтернативных имен субъекта** отображаются сведения, автоматически заполненные мастером. Если требуются дополнительные альтернативные имена субъекта, то они указываются в следующих двух действиях.

11. На странице **SIP Domain Setting on Subject Alternate Names (SANs) (Настройка домена SIP в альтернативных именах субъектов (SAN))** установите флажок домена, чтобы добавить запись sip. *\<домен\_SIP\>* в список альтернативных имен субъектов.

12. На странице **Настройка дополнительных альтернативных имен субъекта** укажите все необходимые дополнительные альтернативные имена субъекта.

13. На странице **сводки по запросу** просмотрите сведения о сертификате, которые будут использоваться для создания запроса.

14. После завершения выполнения команды выполните следующие действия.
    
      - Чтобы просмотреть журнал запросов на сертификаты, щелкните **Просмотреть журнал** .
    
      - Чтобы завершить запрос на сертификат, щелкните **Далее** .

15. На странице **Файл запроса на сертификат** выполните следующее действие:
    
      - Чтобы просмотреть созданный файл запроса подписи сертификата (CSR-файл), щелкните **Просмотреть** .
    
      - Чтобы закрыть мастер, щелкните **Готово** .

16. Скопируйте выходной файл в расположение, из которого можно будет отправить его в общедоступный ЦС.

## Создание запроса на сертификат для внешнего интерфейса пограничного сервера для поддержки подключения к общедоступным системам обмена мгновенными сообщениями с AOL

1.  Если необходимый шаблон доступен ЦС, используйте следующий командлет Windows PowerShell на пограничном сервере, чтобы запросить сертификат:
    
        Request-CsCertificate -New -Type AccessEdgeExternal  -Output C:\ <certfilename.txt or certfilename.csr>  -ClientEku $true -Template <template name>
    
    Имя сертификата по умолчанию для шаблона, предоставленного на сервере Lync Server 2013 – Web Server. Если требуется использовать другой шаблон, просто укажите *\<имя\_шаблона\>* .
    
    > [!NOTE]  
    > Если организация планирует поддерживать общедоступное подключение к системе обмена мгновенными сообщениями AOL, то для запроса сертификата, который будет назначен внешнему пограничному серверу для пограничной службы доступа, необходимо использовать Windows PowerShell вместо мастера сертификатов. Это объясняется тем, что шаблон Web Server сервера Lync Server 2013, который используется мастером сертификатов для запроса на сертификат, не поддерживает клиентскую конфигурацию EKU. Прежде чем воспользоваться Windows PowerShell для создания сертификата, администратор ЦС должен создать и развернуть новый шаблон, который поддерживает клиентское расширенное использование ключа (EKU).

## Отправка запроса в общедоступный центр сертификации

1.  Откройте выходной файл.

2.  Скопируйте и вставьте содержимое запроса подписи сертификата (CSR-файла).

3.  При запросе укажите следующее:
    
      - **Microsoft** в качестве серверной платформы;
    
      - **IIS** в качестве версии;
    
      - **Web Server** в качестве типа использования;
    
      - **PKCS7** в качестве формата ответа.

4.  Когда общедоступный ЦС проверит ваши сведения, вы получите сообщение электронной почты с текстом, необходимым для вашего сертификата.

5.  Скопируйте текст из этого сообщения и сохраните его в текстовом файле (TXT-файле) на локальном компьютере.

## Импорт сертификата для внешнего интерфейса пограничного сервера

1.  Войдите как член группы администраторов на тот же пограничный сервер, на котором создавался запрос на сертификат.

2.  В мастере развертывания на странице **Deploy Edge Server (Развертывание пограничного сервера)** нажмите кнопку **Run again (Запустить снова)** рядом с пунктом **Step 3: Request, Install, or Assign Certificates (Шаг 3. Запрос, установка или назначение сертификатов)** .

3.  На странице **Available Certificate Tasks (Доступные задачи с сертификатами)** нажмите **Import a certificate from a .p7b, pfx or .cer file (Импортировать сертификат из файла P7B, PFX или CER)** .

4.  На странице **Import Certificate (Импорт сертификата)** нажмите кнопку **Обзор** , чтобы найти и выбрать сертификат, запрошенный для внешнего интерфейса пограничного сервера (или можно ввести полный путь и имя). Если сертификат содержит закрытый ключ, выберите **Certificate file contains certificate's private key (Файл сертификата, содержащий закрытый ключ сертификата)** и введите пароль для закрытого ключа. Нажмите кнопку **Далее** .

5.  На странице **Import Certificate Summary (Сводка по импорту сертификата)** просмотрите сводку и нажмите кнопку **Далее** .

6.  На странице **Executing Commands (Выполненные команды)** просмотрите результаты импорта, при необходимости получения дополнительных сведений нажмите кнопку **View Log (Просмотреть журнал)** , а затем нажмите кнопку **Готово** , чтобы завершить импорт сертификата.

7.  Если настраивается пул пограничных серверов, экспортируйте сертификат с его закрытым ключом, как описывается в процедуре “Экспорт сертификата с закрытым ключом для пограничных серверов в пуле” далее в этом разделе. Скопируйте экспортированный файл сертификата на остальные пограничные сервера и импортируйте его в хранилище компьютера на каждом пограничном сервере.

## Экспорт сертификата с закрытым ключом для пограничных серверов пула

1.  Выполните вход с учетной записью члена группы "Администраторы" на сервер, на который был импортирован сертификат.

2.  Щелкните **Пуск** , **Выполнить** и введите **MMC** .

3.  В консоли управления (MMC) последовательно выберите пункты **Файл** и **Добавить или удалить оснастку** .

4.  В окне **Добавление и удаление оснасток** выберите пункт **Сертификаты** и нажмите кнопку **Добавить** .

5.  В диалоговом окне **Сертификаты** выберите пункт **Учетная запись компьютера** , нажмите кнопку **Далее** , выберите пункт **Локальный компьютер (на котором запущена эта консоль)** в разделе **Выбор компьютера** , нажмите кнопку **Готово** , а затем нажмите кнопку **ОК** , чтобы завершить настройку консоли MMC.

6.  Дважды щелкните пункт **Сертификаты (локальный компьютер)** , чтобы развернуть хранилища сертификатов, дважды щелкните пункт **Личные** , а затем дважды щелкните пункт **Сертификаты** .
    
    > [!IMPORTANT]  
    > Если в хранилище личных сертификатов для локального компьютера сертификат отсутствует, то закрытый ключ, связанный с сертификатом, не был импортирован. Проверьте запрос и шаги, относящиеся к импорту. Если проблема повторится, обратитесь к администратору или поставщику ЦС.

7.  В **личном хранилище сертификатов для локального компьютера** щелкните правой кнопкой мыши экспортируемый сертификат, выберите пункт **Все задачи** и нажмите **Экспорт** .

8.  В мастере экспорта сертификатов нажмите кнопку **Далее** , установите флажок **Да, экспортировать закрытый ключ** и нажмите кнопку **Далее** .
    
    > [!NOTE]  
    > Если переключатель <strong>Да, экспортировать закрытый ключ</strong> недоступен, то закрытый ключ, связанный с этим сертификатом, не был помечен для экспорта. В этом случае вам потребуется запросить сертификат повторно и проверить, помечен ли сертификат для экспорта закрытого ключа. Обратитесь к администратору или поставщику ЦС.

9.  В диалоговом окне форматов экспортируемых файлов установите переключатель **Файл обмена личной информацией - PKCS \#12 (.PFX)** и затем установите следующие флажки:
    
      - Включить по возможности все сертификаты в путь сертификации
    
      - Экспортировать все расширенные свойства
        
        > [!WARNING]  
        > При экспорте сертификата с пограничного сервера не устанавливайте флажок <strong>Удалить закрытый ключ после успешного экспорта</strong> . В противном случае потребуется импортировать сертификат и закрытый ключ на этот пограничный сервер.

10. Нажмите кнопку **Далее** .

11. Введите пароль для закрытого ключа, повторите его для подтверждения и нажмите кнопку **Далее** .

12. Введите путь к экспортируемому сертификату, включая имя и расширение файла (PFX). Путь должен быть доступен всем пограничным серверам пула или доступен с помощью съемных носителей, например USB-устройства флэш-памяти. Нажмите кнопку **Далее** .

13. Просмотрите сводку на странице **Завершение мастера экспорта сертификатов** и нажмите кнопку **Готово** .

14. В диалоговом окне, сообщающем об успешном экспорте, нажмите кнопку **ОК** .

15. Импортируйте экспортированный файл сертификата на остальные пограничные серверы, выполнив действия, описанные в процедуре “Импорт сертификата для внешнего интерфейса пограничного сервера” в этом разделе выше.

## Назначение сертификата внешнему интерфейсу пограничного сервера

1.  В мастере развертывания каждого пограничного сервера нажмите кнопку **Повторный запуск** напротив строки **Шаг 3. Запрос, установка или назначение сертификатов** .

2.  На странице **Доступные задачи для сертификатов** выберите **Назначить имеющийся сертификат** .

3.  На странице **Certificate Assignment (Назначение сертификата)** выберите пункт **External Edge Certificate (Внешний пограничный сертификат)** и установите флажок **Advanced Certificate Usages (Расширенное использование сертификата)** .

4.  На странице **Advanced Certificate Usages (Расширенное использование сертификата)** установите все флажки, чтобы назначить все варианты использования сертификата.

5.  На странице **Certificate Store (Хранилище сертификатов)** выберите общедоступный сертификат, который был запрошен и импортирован для внешнего интерфейса пограничного сервера.
    
    > [!NOTE]  
    > Если запрошенный и импортированный сертификат отсутствует в списке, можно использовать один из способов устранения неполадки, заключающийся в том, чтобы проверить соответствие имени субъекта и альтернативных имен субъектов всем требованиям для сертификата, и в случае, если сертификат и цепочка сертификатов импортировались вручную, а не с помощью предыдущих процедур, проверить, что сертификат находится в правильном хранилище сертификатов (в хранилище сертификатов компьютера, а не пользователя или службы).

6.  На странице **Сводка по назначению сертификата** проверьте параметры и затем нажмите кнопку **Далее** , чтобы назначить сертификаты.

7.  На странице завершения работы мастера нажмите кнопку **Готово** .

8.  После использования этой процедуры для назначения пограничного сертификата откройте оснастку "Сертификаты" на каждом сервере, разверните узел **Сертификаты (локальный компьютер)** , разверните узел **Личные** , выберите пункт **Сертификаты** и проверьте, значится ли этот сертификат в области сведений.

9.  Если ваше развертывание содержит несколько пограничных серверов, повторите эту процедуру для каждого пограничного сервера.

