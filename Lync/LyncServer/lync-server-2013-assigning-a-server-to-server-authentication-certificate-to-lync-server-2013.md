---
title: "Lync Server 2013: назначение сертификата проверки подлинности между серверами"
TOCTitle: "Lync Server 2013: назначение сертификата проверки подлинности между серверами"
ms:assetid: c7413954-2504-47f4-a073-44548aff1c0c
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ205253(v=OCS.15)
ms:contentKeyID: 49311137
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Назначение сертификата проверки подлинности между серверами для Microsoft Lync Server 2013

 

_**Дата изменения раздела:** 2013-10-24_

Чтобы определить, назначен ли сертификат проверки подлинности между серверами для Microsoft Lync Server 2013, выполните следующую команду в командная консоль Lync Server 2013:

    Get-CsCertificate -Type OAuthTokenIssuer

Если сведений о сертификатах не возвращается, то для использования проверки подлинности между серверами необходимо назначить сертификат издателя маркеров . В общем случае, в качестве сертификата OAuthTokenIssuer может использоваться любой сертификат Lync Server 2013, например, сертификат Lync Server 2013 по умолчанию. (Сертификатом OAUthTokenIssuer также может быть любой сертификат веб-сервера, включающий имя SIP-домена в поле Subject.) Основные два требования для сертификата, используемого для проверки подлинности между серверами, состоят в следующем: 1) такой же сертификат должен быть задан в качестве сертификата OAuthTokenIssuer на всех серверах переднего плана; и 2) сертификат должен иметь длину не менее 2018 бит.

При отсутствии сертификата, который можно использовать для проверки подлинности между серверами, можно получить новый сертификат, импортировать его и затем использовать для проверки подлинности между серверами. После запроса и получения нового сертификата можно выполнять вход на любой из серверов переднего плана и использовать команду Windows PowerShell, аналогичную следующей, для импорта и назначения этого сертификата:

    Import-CsCertificate -Identity global -Type OAuthTokenIssuer -Path C:\Certificates\ServerToServerAuth.pfx  -Password "P@ssw0rd"

В предыдущей команде параметр Path представляет собой полный путь к файлу сертификата, а параметр Password содержит пароль, назначенный сертификату. Эту процедуру нужно выполнять только один раз: служба репликации Lync Server затем автоматически создаст набор запланированных задач, который выполняют дешифровку и развертывание сертификата на всех серверах переднего плана.

Либо в качестве сертификата проверки подлинности между серверами можно использовать какой-либо имеющийся сертификат. (Как уже отмечалось, в качестве сертификата проверки подлинности между серверами можно использовать сертификат по умолчанию.) Следующие две команды Windows PowerShell извлекают значение свойства Thumbprint сертификата по умолчанию, а затем используют его, чтобы сделать сертификат по умолчанию сертификатом проверки подлинности между серверами:

    $x = (Get-CsCertificate -Type Default).Thumbprint
    Set-CsCertificate -Identity global -Type OAuthTokenIssuer -Thumbprint $x

В предыдущей команде полученный сертификат задается в качестве глобального сертификата проверки подлинности между серверами. Это означает, что сертификат будет реплицирован на все серверы переднего плана и будет ими использоваться. И снова, эту команду нужно использовать только один раз и только на одном из серверов переднего плана. Несмотря на то, что все серверы переднего плана должны использовать один сертификат, не следует настраивать сертификат OAuthTokenIssuer на каждом сервере переднего плана. Вместо этого задайте сертификат один раз и позвольте серверу репликации Lync Server скопировать этот сертификат на все остальные серверы.

Командлет Set-CsCertificate берет указанный сертификат и немедленно устанавливает его в качестве текущего сертификата OAuthTokenIssuer. (Lync Server 2013 хранит две копии сертификата: текущий сертификат и прежний сертификат.) Чтобы новый сертификат немедленно стал использоваться в качестве сертификата OAuthTokenIssuer, необходимо использовать командлет Set-CsCertificate.

Можно также воспользоваться командлетом Set-CsCertificate, чтобы "накатить" новый сертификат. "Накат" означает, что новый сертификат станет текущим сертификатом OAuthTokenIssuer в некоторый определенный момент времени. Например, следующая команда извлекает сертификат по умолчанию и затем делает так, что он становится текущим сертификатом OAuthTokenIssuer 1 июля 2012 г.:

    $x = (Get-CsCertificate -Type Default).Thumbprint
    Set-CsCertificate -Identity global -Type OAuthTokenIssuer -Thumbprint $x -EffectiveDate "7/1/2012" -Roll

1 июля 2012 г. новый сертификат будет установлен в качестве текущего сертификата OAuthTokenIssuer, а "старый" сертификат OAuthTokenIssuer станет прежним сертификатом.

Если нет желания использовать Windows PowerShell, можно воспользоваться консолью MMC "Сертификаты", чтобы экспортировать сертификат с одного из серверов переднего плана, а затем импортировать его на все остальные серверы переднего плана. В этом случае убедитесь, что вместе с сертификатом экспортируется и его закрытый ключ.

> [!CAUTION]
> В данном случае процедуру необходимо выполнить на каждом сервере переднего плана. При экспорте и импорте сертификатов подобным образом Lync Server 2013 не реплицирует их на все серверы переднего плана.


После импорта сертификата на все серверы переднего плана его можно назначить с помощью мастера развертывания Lync Server, а не Windows PowerShell. Чтобы назначить сертификат с помощью мастера развертывания, выполните следующие действия на компьютере, где установлен мастер развертывания:

1.  Нажмите кнопку "Пуск", последовательно выберите "Все программы", **Microsoft Lync Server 2013**, затем нажмите **Мастер развертывания Lync Server**.

2.  В мастере развертывания выберите **Установить или обновить систему Lync Server**.

3.  На странице Microsoft Lync Server 2013 нажмите кнопку **Выполнить** под заголовком **Шаг 3. Запрос, установка или назначение сертификатов**. (Примечание. Если на данном компьютере сертификаты уже устанавливались, то кнопка **Выполнить** будет называться **Перезапуск**.)

4.  В мастере сертификатов выберите сертификат **OAuthTokenIssuer**и нажмите кнопку **Назначить**.

5.  В мастере назначения сертификатов на странице **Назначение сертификатов** нажмите кнопку **Далее**.

6.  На странице **Хранилище сертификатов** выберите сертификат, который должен использоваться для проверки подлинности между серверами, и нажмите кнопку **Далее**.

7.  На странице сводки по назначению сертификатов нажмите кнопку **Далее**.

8.  На странице "Выполнение команд" нажмите кнопку **Готово**.

9.  Закройте мастер сертификатов и мастер развертывания.

