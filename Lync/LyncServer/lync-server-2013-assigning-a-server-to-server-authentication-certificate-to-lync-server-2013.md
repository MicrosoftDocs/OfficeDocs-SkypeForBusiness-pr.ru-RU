---
title: Назначение сертификата проверки подлинности между серверами в Lync Server 2013
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Assigning a server-to-server authentication certificate to Microsoft Lync Server 2013
ms:assetid: c7413954-2504-47f4-a073-44548aff1c0c
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ205253(v=OCS.15)
ms:contentKeyID: 48185367
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 952f4c1b14ce7260d4b320ea7feacddb9a85a8f0
ms.sourcegitcommit: 831d141dfc5a49dd764cb296b73b63e5a9f8e599
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/21/2020
ms.locfileid: "42203305"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="assigning-a-server-to-server-authentication-certificate-to-microsoft-lync-server-2013"></a>Назначение сертификата проверки подлинности между серверами серверу Microsoft Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2013-10-24_

Чтобы определить, был ли сертификат проверки подлинности "сервер – сервер" уже назначен Microsoft Lync Server 2013, выполните следующую команду в командной консоли Lync Server 2013:

    Get-CsCertificate -Type OAuthTokenIssuer

Если сведения о сертификате не возвращаются, необходимо назначить сертификат поставщика маркеров, прежде чем использовать проверку подлинности "сервер-сервер". Как правило, любой сертификат Lync Server 2013 можно использовать в качестве сертификата OAuthTokenIssuer. Например, сертификат по умолчанию для Lync Server 2013 также можно использовать в качестве сертификата OAuthTokenIssuer. (Сертификат OAUthTokenIssuer также может представлять собой любой сертификат веб-сервера, включающий в себя имя домена SIP в поле subject (субъект).) Основные два требования к сертификату, используемому для проверки подлинности "сервер-сервер": 1) один и тот же сертификат должен быть настроен как сертификат OAuthTokenIssuer на всех серверах переднего плана; и 2) сертификат должен иметь по крайней мере 2048 бит.

Если у вас нет сертификата, который можно использовать для межсерверной проверки подлинности, вы можете получить новый сертификат, импортировать новый сертификат, а затем использовать этот сертификат для проверки подлинности между серверами. После того как вы запрашиваете и получаете новый сертификат, вы можете войти на любой из серверов переднего плана и использовать команду Windows PowerShell, аналогичную следующей, для импорта и назначения этого сертификата:

    Import-CsCertificate -Identity global -Type OAuthTokenIssuer -Path C:\Certificates\ServerToServerAuth.pfx  -Password "P@ssw0rd"

В предыдущей команде параметр path представляет полный путь к файлу сертификата, а параметр Password — пароль, назначенный сертификату. Эту процедуру следует выполнять только один раз: служба репликации Lync Server будет автоматически создавать набор запланированных задач, которые будут расшифровывать и развертывать сертификат на все серверы переднего плана.

Кроме того, вы можете использовать существующий сертификат в качестве сертификата проверки подлинности "сервер – сервер". (Как отмечено, сертификат по умолчанию можно использовать в качестве сертификата проверки подлинности "сервер-сервер".) Следующая комбинация команд Windows PowerShell извлекает значение свойства Thumbprint сертификата по умолчанию, а затем использует это значение для создания сертификата проверки подлинности "сервер – сервер" по умолчанию:

    $x = (Get-CsCertificate -Type Default).Thumbprint
    Set-CsCertificate -Identity global -Type OAuthTokenIssuer -Thumbprint $x

В предыдущей команде полученный сертификат настраивается для работы в качестве глобального сертификата проверки подлинности "сервер-сервер"; Это означает, что сертификат будет реплицирован на все серверы переднего плана и использоваться им. Опять же, эта команда должна выполняться только один раз и только на одном из серверов переднего плана. Несмотря на то, что на всех серверах переднего плана должен использоваться один и тот же сертификат, не следует настраивать сертификат OAuthTokenIssuer на каждом сервере переднего плана. Вместо этого необходимо настроить сертификат один раз, а затем позволить серверу репликации Lync Server выполнить копирование этого сертификата на каждый сервер.

Командлет Set – CsCertificate выполняет указанный сертификат и сразу же настраивает этот сертификат в качестве текущего сертификата OAuthTokenIssuer. (Lync Server 2013 хранит две копии типа сертификата: текущий сертификат и предыдущий сертификат). Если требуется, чтобы новый сертификат сразу начал работать в качестве сертификата OAuthTokenIssuer, следует использовать командлет Set – CsCertificate.

Вы также можете использовать командлет Set – CsCertificate для "свертывания" нового сертификата. "Пошаговое" сертификат означает, что новый сертификат будет настроен в качестве текущего сертификата OAuthTokenIssuer в определенный момент времени. Например, эта команда получает сертификат по умолчанию, а затем настраивает этот сертификат для использования в качестве текущего сертификата OAuthTokenIssuer на 1 июля 2012 г.:

    $x = (Get-CsCertificate -Type Default).Thumbprint
    Set-CsCertificate -Identity global -Type OAuthTokenIssuer -Thumbprint $x -EffectiveDate "7/1/2012" -Roll

На 1 июля 2012 новый сертификат будет настроен как текущий сертификат OAuthTokenIssuer, а "старый" сертификат OAuthTokenIssuer будет настроен как предыдущий сертификат.

Если вы не хотите использовать Windows PowerShell, вы также можете экспортировать сертификат с одного сервера переднего плана с помощью консоли MMC для сертификатов, а затем импортировать этот же сертификат на все другие серверы переднего плана. В этом случае необходимо экспортировать закрытый ключ вместе с самим сертификатом.

<div>


> [!WARNING]
> В этом случае процедуру необходимо выполнить на каждом сервере переднего плана. При экспорте и импорте сертификатов таким образом Lync Server 2013 не будет реплицировать этот сертификат на каждый сервер переднего плана.



</div>

После импорта сертификата на все серверы переднего плана этот сертификат можно назначить с помощью мастера развертывания Lync Server, а не Windows PowerShell. Чтобы назначить сертификат с помощью мастера развертывания, выполните следующие действия на компьютере, на котором установлен мастер развертывания:

1.  Нажмите кнопку Пуск, последовательно выберите пункты Все программы, **Microsoft Lync server 2013**и **Мастер развертывания Lync Server**.

2.  В мастере развертывания щелкните **Установить или обновить Lync Server**.

3.  На странице Microsoft Lync Server 2013 нажмите кнопку **выполнить** под заголовком **Шаг 3: запрос, установка или назначение сертификатов**. (Примечание: Если вы уже установили сертификаты на этом компьютере, кнопка **выполнить** будет помечена **снова**.)

4.  В мастере сертификатов выберите сертификат **OAuthTokenIssuer** , а затем нажмите кнопку **назначить**.

5.  В мастере назначения сертификатов на странице **назначение сертификата** нажмите кнопку **Далее**.

6.  На странице **хранилище сертификатов** выберите сертификат, который будет использоваться для проверки подлинности "сервер-сервер", а затем нажмите кнопку **Далее**.

7.  На странице Сводка по назначениям сертификатов щелкните **Далее**.

8.  На странице выполнения команд нажмите кнопку **Готово**.

9.  Закройте мастер сертификатов и мастер развертывания.

</div>

<span> </span>

</div>

</div>

</div>

