---
title: 'Lync Server 2013: обзор централизованной службы ведения журналов'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Overview of the Centralized Logging Service
ms:assetid: 975718a0-f3e3-404d-9453-6224e73bfdd0
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ688145(v=OCS.15)
ms:contentKeyID: 49733746
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 3e1c382151d34751e7e934f15fdd2855ce696e06
ms.sourcegitcommit: 4d6bf5c58b2c553dc1df8375ede4a9cb9eaadff2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2020
ms.locfileid: "48520836"
---
# <a name="overview-of-the-centralized-logging-service-in-lync-server-2013"></a>Обзор централизованной службы ведения журналов в Lync Server 2013

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">



</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2013-02-22_

Централизованная служба ведения журналов предназначена для предоставления управляемой коллекции данных с широкой или узкой областью. Данные можно собирать одновременно со всех серверов в развертывании, можно определить конкретные элементы для трассировки, задать флаги трассировки и получать результаты поиска по одному компьютеру или по всем данным на всех серверах. Служба централизованного ведения журналов выполняется на всех серверах в развертывании. Архитектура централизованной службы ведения журналов состоит из следующих агентов и служб:

  - Агент службы централизованного *ведения журналов*    ClsAgent.exe — это исполняемый файл службы, который обменивается данными с контроллером и получает команды, которые администратор выдает. Агент запускается как служба на каждом компьютере с Lync Server. Когда агент получает команду, он выполняет ее, отправляет сообщения на определенные компоненты для их трассировки и записывает журналы трассировки на диск. Он также считывает журналы трассировки на своем компьютере и отправляет данные трассировки на контроллер по запросу. Для получения команд ClsAgent прослушивает следующие порты: **TCP 50001**, **TCP 50002** и **TCP 50003**.

  - Контроллер службы централизованного *ведения журналов*    ClsControllerLib.dll — это модуль выполнения команд для командной консоли Lync Server и для ClsController.exe. CLSControllerLib.dll отправляет команды "Пуск", "остановить", "очистить" и "Поиск" в ClsAgent. При отправке команд поиска полученные журналы возвращаются в ClsControllerLib.dll и объединяются. Контроллер отвечает за отправку команд агенту, получение состояния этих команд и управление данными файла журнала поиска при его возврате со всех агентов на любом компьютере в области поиска, а также объединение данных журнала в осмысленный и упорядоченный набор выходных данных. Сведения, приведенные в следующих разделах, ориентированы на использование командной консоли Lync Server. ClsController.exe ограничен подмножеством компонентов и функций, доступных в командной консоли Lync Server. Справку по ClsController.exe можно получить в командной строке, введя `ClsController` в файл Default каталога C: \\ Program Files \\ Common Files \\ Microsoft Lync Server 2013 \\ ClsAgent.

**Взаимодействие ClsController и ClsAgent**

![Отношение между CLSController и CLSAgent.](images/JJ688145.68c90811-5cf9-4a84-95b7-ea9ffc61eac4(OCS.15).jpg "Отношение между CLSController и CLSAgent.")

Команды выдаются с помощью интерфейса командной строки Windows Server или консоли управления Lync Server. Команды выполняются на компьютере, на котором выполнен вход в систему, и отправляются локальному агенту ClsAgent или на другие компьютеры и пулы в развертывании.

ClsAgent поддерживает файл индекса всех файлов .CACHE, которые имеются на локальном компьютере. ClsAgent размещает их так, чтобы они равномерно распределялись по томам, определенным параметром CacheFileLocalFolders, и не занимали более 80% места на каждом томе (расположение и процент локального кэша можно настроить с помощью командлета **Set-CsClsConfiguration**). ClsAgent также отвечает за удаление с локального компьютера устаревших кэшированных файлов журнала трассировки событий (файлов ETL). По истечении двухнедельного срока (этот временной интервал настраивается с помощью командлета **Set-CsClsConfiguration**) эти файлы копируются в общую папку и удаляются с локального компьютера. Дополнительные сведения см. в описании командлета [Set-CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/Set-CsClsConfiguration). При получении запроса поиска условия поиска используются для выбора набора кэшированных ETL-файлов для выполнения поиска на основании значений из индекса, поддерживаемого агентом.

<div>


> [!NOTE]  
> ClsAgent может выполнять поиск файлов, перемещенных в общую папку с локального компьютера. После перемещения файлов в общую папку ClsAgent не контролирует их устаревание и удаление. Необходимо определить административную задачу для отслеживания размера файлов в общей папке и их удаления или архивации.



</div>

Результирующие файлы журналов можно считывать и анализировать с помощью различных средств, в том числе с помощью **Snooper.exe** и других средств, способных считывать текстовые файлы, таких как **Notepad.exe**. Snooper.exe входит в состав средств отладки Lync Server 2013 и доступна для скачивания из Интернета [https://go.microsoft.com/fwlink/?LinkId=285257](https://go.microsoft.com/fwlink/?linkid=285257) .

Как и в OCSLogger, централизованная служба ведения журналов имеет несколько компонентов для трассировки и предоставляет параметры для выбора флагов, таких как TF \_ Component и TF \_ DIAG. Служба централизованного ведения журналов также сохраняет параметры уровня ведения журнала OCSLogger.

Наиболее важное преимущество использования командной консоли Lync Server в командной строке ClsController состоит в том, что вы можете настроить и определить новые сценарии с помощью выбранных поставщиков, которые предназначены для проблемного пространства, настраиваемых флагов и уровней ведения журнала. Средство ClsController ограничено сценариями, определенными для исполняемого процесса.

В предыдущих версиях средство OCSLogger.exe позволяло администраторам и сотрудникам технической поддержки собирать файлы трассировки с компьютеров в развертывании. Наряду с преимуществами, средство OCSLogger обладало одним существенным недостатком. В заданный момент времени журналы можно было собирать только на одном компьютере. Можно было вести журналы на нескольких компьютерах с помощью отдельных копий OCSLogger, но при этом создавалось несколько журналов, а простого способа объединения результатов не существовало.

Когда пользователь запрашивает поиск журналов, ClsController определяет, на какие компьютеры отправить этот запрос (на основании выбранных сценариев). Контроллер также определяет, нужно ли выполнять поиск в общей папке, в которой находятся сохраненные ETL-файлы. При получении результатов поиска ClsController объединяет их в один упорядоченный по времени набор, который предоставляется пользователю. Пользователи могут сохранять результаты поиска на локальном компьютере для дальнейшего анализа.

При запуске сеанса ведения журнала пользователь указывает сценарии, имеющие отношение к решаемой задаче. В любой момент времени могут выполняться два сценария. Одним из этих сценариев должен быть сценарий AlwaysOn. Как можно понять из названия, этот сценарий должен всегда выполняться в развертывании, собирая сведения о всех компьютерах, пулах и компонентах.

<div>


> [!IMPORTANT]  
> Сценарий AlwaysOn не выполняется в развертывании по умолчанию. Этот сценарий необходимо явно запустить. После запуска он будет выполняться, пока не будет явно остановлен, а состояние выполнения будет сохраняться между перезагрузками компьютеров. Подробнее о запуске и остановке сценариев можно узнать <A href="lync-server-2013-using-start-for-the-centralized-logging-service-to-capture-logs.md">в статье Использование Start для централизованной службы ведения журналов для захвата журналов в Lync server 2013</A> и <A href="lync-server-2013-using-stop-for-the-centralized-logging-service.md">Использование Stop для централизованной службы ведения журналов в Lync Server 2013</A>.



</div>

При возникновении неполадок запустите второй сценарий, связанный с обнаруженной проблемой. Воспроизведите условия возникновения проблемы и остановите ведение журнала для второго сценария. Выполните в журнале поиск данных, связанных с обнаруженной проблемой. При объединении журналов создается файл, содержащий сообщения трассировки со всех компьютеров в области сайта или в глобальной области развертывания. Если поиск возвращает слишком много данных, которые физически невозможно проанализировать (такую ситуацию часто называют отношением "сигнал-шум", в котором значение "шума" слишком велико), выполните другой поиск с более точными параметрами. На этом этапе можно заметить наборы данных, которые позволяют выявить признаки проблемы и сузить круг поиска. В конечном счете, после выполнения нескольких уточненных поисков можно обнаружить данные, имеющие отношение к проблеме, и определить ее причину.

<div>


> [!TIP]  
> При возникновении проблемного сценария в Lync Server Начните с запроса "что уже знаете об этой проблеме?". Если вы количественно изчислить границы проблемы, вы можете исключить большую часть рабочих сущностей в Lync Server.<BR>Рассмотрим пример сценария, в котором пользователи не получают актуальные результаты при поиске контактов. Нет смысла искать проблемы в компонентах мультимедиа, корпоративной голосовой связи, конференц-связи и некоторых других компонентах. Неизвестно только то, где фактически возникла проблема: в клиенте или на стороне сервера? Контакты собираются из Active Directory репликатором пользователей и доставляются клиенту с помощью сервера адресной книги (ABServer). ABServer получает обновления из базы данных RTC (куда их записывает репликатор пользовательских данных) и собирает их в файлы адресной книги, по умолчанию в 1:30. Клиенты Lync Server получают новую адресную книгу по случайному расписанию. Так как вы знаете, как работает процесс, вы можете уменьшить область поиска, чтобы получить потенциальную причину проблемы, связанной с сбором данных из Active Directory репликатором пользователей, ABServer не извлекать и не создавать файлы адресной книги, а клиенты не загружали файл адресной книги.



</div>

</div>

<span> </span>

</div>

</div>

</div>

