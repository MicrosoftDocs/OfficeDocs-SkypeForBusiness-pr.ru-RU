---
title: Размещение сертификатов AV и OAuth с помощью Set — CsCertificate
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Staging AV and OAuth certificates using -Roll in Set-CsCertificate
ms:assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ660292(v=OCS.15)
ms:contentKeyID: 49354387
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: f59cba907a57d4646a469daa72bae1355f09a662
ms.sourcegitcommit: 33db8c7febd4cf1591e8dcbbdfd6fc8e8925896e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "42142585"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="staging-av-and-oauth-certificates-in-lync-server-2013-using--roll-in-set-cscertificate"></a>Промежуточные сертификаты AV и OAuth в Lync Server 2013 using in Set — CsCertificate

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2012-11-13_

Связь аудио-и видеоданных (A/V) является ключевым компонентом Microsoft Lync Server 2013. Такие функции, как общий доступ к приложениям, а также аудио-и видеоконференции, основываются на сертификатах, назначенных службе аудио-и видеоданных, а именно службе проверки подлинности A/V.

<div>


> [!IMPORTANT]
> <OL>
> <LI>
> <P>Эта новая функция разработана для работы с пограничной службой аудио-и видеоданных и сертификатом <EM>OAuthTokenIssuer</EM> . Другие типы сертификатов можно подготовить к работе с пограничной службой аудио-и видеоданных и типом сертификата OAuth, но при этом не будет выгодно поведение сосуществования, которое будет иметь сертификат пограничной службы аудио-и видеоданных.</P>
> <LI>
> <P>Командлеты PowerShell для консоли управления Lync Server, используемые для управления сертификатами Microsoft Lync Server 2013, относятся к сертификатам пограничной службы аудио-и видеоданных в качестве типа сертификата <EM>AudioVideoAuthentication</EM> и сертификата OAuthServer в качестве типа <EM>OAuthTokenIssuer</EM>. Для оставшейся части этого раздела и уникальной идентификации сертификатов они будут называться одинаковым типом идентификатора, <EM>AudioVideoAuthentication</EM> и <EM>OAuthTokenIssuer</EM>.</P></LI></OL>



</div>

Служба проверки подлинности аудио- и видеоконференций отвечает за выдачу маркеров, используемых клиентами и другими пользователями аудио- и видеоконференций. Маркеры создаются на основе атрибутов сертификата, и по истечении срока действия сертификата, происходит разрыв соединения или отображается запрос на повторное подключение с использованием нового маркера, созданного новым сертификатом. Новая функция в Lync Server 2013 поможет решить эту проблему — возможность размещения нового сертификата перед старым сроком действия, позволяющая обоим сертификатам продолжать работать в течение определенного периода времени. Эта функция использует обновленные функции в командлете Set – CsCertificate Lync Server Management Shell. Новый параметр –Roll вместе с текущим параметром –EffectiveDate помещает новый сертификат AudioVideoAuthentication в хранилище сертификатов. Предыдущий сертификат AudioVideoAuthentication по-прежнему действует для проверки выданных маркеров. С момента размещения нового сертификата AudioVideoAuthentication возникают следующие наборы событий:

<div>


> [!TIP]
> С помощью командлетов командной консоли Lync Server для управления сертификатами можно запрашивать отдельный и отдельный сертификаты для каждой цели на пограничном сервере. С помощью мастера сертификатов в мастере развертывания Lync Server можно создавать сертификаты, но обычно это тип <STRONG>по умолчанию</STRONG> , который связывает все сертификаты, используемые для пограничного сервера, на один сертификат. Если планируется применение компонента последовательных сертификатов, рекомендуется отделить сертификат AudioVideoAuthentication от других назначений сертификата. Можно предоставить и разместить сертификат типа Default для промежуточного хранения, однако, только часть AudioVideoAuthentication объединенного сертификата сможет максимально эффективно использовать преимущества промежуточного хранения. Пользователь, участвующий в (например,) беседу по обмену мгновенными сообщениями при истечении срока действия сертификата, должен выйти из системы и войти в нее, чтобы использовать новый сертификат, связанный со службой пограничного доступа. Аналогичное поведение будет выполняться для пользователя, участвующего в веб-конференции с помощью пограничной службы веб-конференций. Сертификат OAuthTokenIssuer представляет собой отдельный тип, общий доступ к которому предоставляется для всех серверов. Вы создаете сертификат и управляете им в одном месте, а сертификат хранится в центральном хранилище управления для всех остальных серверов.



</div>

Для полного понимания возможностей и условий использования командлета Set-CsCertificate и использования его для промежуточного хранения сертификатов до истечения срока действия текущего сертификата требуются дополнительные данные. Параметр –Roll имеет критически важное значение, но в целом, выполняет одну-единственную задачу. Если задать его в качестве параметра, вы указываете Set-CsCertificate, что вы будете предоставлять сведения о сертификате, который будет зависеть от типа – (например, AudioVideoAuthentication и OAuthTokenIssuer), когда сертификат станет эффективно определяется параметром – EffectiveDate.

**— Рулон:** Параметр – рулон является обязательным и содержит зависимости, которые необходимо указать вместе с ним. Обязательные параметры для полного определения того, какие сертификаты будут затронуты и как они будут применяться:

**— EffectiveDate:** Параметр – EffectiveDate определяет, когда новый сертификат становится совместным с текущим сертификатом. Параметр – EffectiveDate можно закрыть до истечения срока действия текущего сертификата или может быть более длительным. Рекомендуемый минимум — EffectiveDate для сертификата AudioVideoAuthentication будет 8 часов, что является временем жизни токенов по умолчанию для маркеров служебной службы AV EDGE, выданных с помощью сертификата AudioVideoAuthentication.

При размещении сертификатов OAuthTokenIssuer для промежуточного хранения действуют различные требования в отношении времени упреждения, прежде чем действие сертификата вступит в силу. Минимальное время упреждения для сертификата OAuthTokenIssuer составляет 24 часа до истечения срока действия текущего сертификата. Увеличение времени упреждения для совместной работы применяется в связи с тем, что другие роли сервера, зависимые от сертификата OAuthTokenIssuer (например, Exchange Server), для которых предусматривается более продолжительный срок хранения сертификатов, создают данные проверки подлинности и ключа шифрования.

**— Thumbprint:** Отпечаток — это атрибут сертификата, который является уникальным для этого сертификата. Параметр – Thumbprint используется для идентификации сертификата, на который повлияет действие командлета Set-CsCertificate.

**— Тип:** Параметр – Type может принимать один тип использования сертификата или список типов использования сертификатов с разделителями-запятыми. Типы сертификатов — это те, которые идентифицируют командлет и на сервер, на котором находится сертификат. Например, введите AudioVideoAuthentication для использования службой аудио-и видеоданных и службой проверки подлинности AV. Если вы решите одновременно выполнять и резервное размещение сертификатов другого типа, необходимо учитывать максимально необходимое минимальное минимальное время ожидания для сертификатов. Например, необходимо выполнить промежуточное хранение сертификатов типа AudioVideoAuthentication и OAuthTokenIssuer. Минимальное значение – EffectiveDate должно быть большим из двух сертификатов, в данном случае OAuthTokenIssuer, в котором минимальное время ожидания составляет 24 часа. Если вы не хотите поAudioVideoAuthentication сертификат с временем ожидания в 24 часа, разработайте его отдельно с EffectiveDate, который больше требований.

<div>

## <a name="to-update-or-renew-an-av-edge-service-certificate-with-a-roll-and--effectivedate-parameters"></a>Обновление или обновление сертификата пограничной службы аудио-и видеоданных с параметрами – рулон и-EffectiveDate

1.  Войдите на локальный компьютер как член группы "Администраторы".

2.  Запросить обновление или новый сертификат AudioVideoAuthentication с экспортируемым закрытым ключом для существующего сертификата в пограничной службе аудио-и видеоданных.

3.  Импортируйте новый сертификат AudioVideoAuthentication на пограничный сервер и весь другой пограничный сервер в пуле (при наличии развернутого пула).

4.  Настройте импортированный сертификат с помощью командлета Set-CsCertificate и используйте параметр –Roll вместе с параметром –EffectiveDate. Дата вступления в силу определяется как время истечения срока действия текущего сертификата (14:00:00 или 14:00:00) за вычетом срока действия маркера (по умолчанию — восемь часов). Это дает нам время, когда сертификат должен быть установлен в значение Active, и является строкой \<\>– EFFECTIVEDATE: "7/22/2012 6:00:00 AM".
    
    <div>
    

    > [!IMPORTANT]
    > Для пограничного пула необходимо иметь все сертификаты AudioVideoAuthentication, развернутые и подготовленные в соответствии с датой и временем первого развернутого параметра – EffectiveDate первого сертификата, чтобы избежать возможного сбоя аудио-и видеосвязи из-за истечения срока действия старого сертификата до того, как все маркеры клиентов и потребителей будут обновлены с помощью нового сертификата.

    
    </div>
    
    Команда Set-CsCertificate с параметрами –Roll и –EffectiveTime:
    
        Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint <thumb print of new certificate> -Roll -EffectiveDate <date and time for certificate to become active>
    
    Пример команды Set-CsCertificate:
    
        Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2012 6:00:00 AM"
    
    <div>
    

    > [!IMPORTANT]
    > Параметр EffectiveDate должен быть отформатирован в соответствии с региональными и языковыми параметрами американского английского.

    
    </div>

Визуальная временная шкала эффективна для более полного понимания процедуры, используемой командлетом Set-CsCertificate, параметрами -Roll и  -EffectiveDate для размещения новых сертификатов для промежуточного хранения в целях выдачи новых маркеров AudioVideoAuthentication при одновременном использовании существующего сертификата для проверки AudioVideoAuthentication, используемого пользователями.

В следующем примере администратор определяет срок действия сертификата пограничной службы аудио-и видеосвязи в 2:00:00 PM на 07/22/2012. Он запрашивает и получает новый сертификат и импортирует его на каждый пограничный сервер в своем пуле. В 2:00 07/22/2012 он начинает запуск командлета Get-CsCertificate, где значения параметров –Roll, -Thumbprint равны значениям строки отпечатка нового сертификата, а значение времени в параметре –EffectiveTime установлено как "07/22/2012 6:00:00 утра". Он выполняет эту команду на каждом пограничном сервере.

![С помощью параметров рулона и EffectiveDate.](images/JJ660292.21d51a76-0d03-4ed7-a37e-a7c14940265f(OCS.15).jpg "С помощью параметров рулона и EffectiveDate.")

По достижении заданного времени (7/22/2012 6:00:00 утра) все новые маркеры выпускаются новым сертификатом. Сначала выполняется проверка маркеров новым сертификатом. Если проверка не пройдена, маркеры проверяются старым сертификатом. Процедура проверки новым сертификатом и возврат к старому продолжается до тех пор, пока не истечет срок действия старого сертификата. По истечении срока действия старого сертификата (7/22/2012 14:00:00) маркеры будут проверяться только новым сертификатом. Старый сертификат можно удалить с помощью командлета Remove-CsCertificate с параметром –Previous.

    Remove-CsCertificate -Type AudioVideoAuthentication -Previous

</div>

<div>

## <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a-roll-and--effectivedate-parameters"></a>Обновление и продление действия сертификата OAuthTokenIssuer с помощью параметров –Roll и -EffectiveDate

1.  Войдите на локальный компьютер как член группы "Администраторы".

2.  Запросить обновление или новый сертификат OAuthTokenIssuer с экспортируемым закрытым ключом для существующего сертификата в пограничной службе аудио-и видеоданных.

3.  Импортируйте новый сертификат OAuthTokenIssuer на сервер переднего плана в пуле (при наличии развернутого пула). Сертификат OAuthTokenIssuer реплицируется глобально, после чего требуется только его обновление и продление на всех серверах в текущей среде. В качестве примера используется сервер переднего плана.

4.  Настройте импортированный сертификат с помощью командлета Set-CsCertificate и используйте параметр –Roll вместе с параметром –EffectiveDate. Дата вступления в силу определяется как время истечения срока действия текущего сертификата (14:00:00 или 2:00:00 дня) за вычетом не менее 24 часов.
    
    Команда Set-CsCertificate с параметрами –Roll и –EffectiveTime:
    
        Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb print of new certificate> -Roll -EffectiveDate <date and time for certificate to become active>
    
    Пример команды Set-CsCertificate:
    
        Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2012 1:00:00 PM"
    
    <div>
    

    > [!IMPORTANT]
    > Параметр EffectiveDate должен быть отформатирован в соответствии с региональными и языковыми параметрами американского английского.

    
    </div>

По достижении заданного времени (7/21/2012 1:00:00 ночи) все новые маркеры выпускаются новым сертификатом. Сначала выполняется проверка маркеров новым сертификатом. Если проверка не пройдена, маркеры проверяются старым сертификатом. Процедура проверки новым сертификатом и возврат к старому продолжается до тех пор, пока не истечет срок действия старого сертификата. По истечении срока действия старого сертификата (7/22/2012 14:00:00) маркеры будут проверяться только новым сертификатом. Старый сертификат можно удалить с помощью командлета Remove-CsCertificate с параметром –Previous.

    Remove-CsCertificate -Type OAuthTokenIssuer -Previous

</div>

<div>

## <a name="see-also"></a>См. также


[Планирование сертификатов пограничного сервера в Lync Server 2013](lync-server-2013-plan-for-edge-server-certificates.md)  
[Управление проверкой подлинности между серверами (OAuth) и партнерским приложением в Lync Server 2013](lync-server-2013-managing-server-to-server-authentication-oauth-and-partner-applications.md)  


[Настройка пограничных сертификатов для Lync Server 2013](lync-server-2013-set-up-edge-certificates.md)  
[Set — CsCertificate](https://technet.microsoft.com/library/Gg398518(v=OCS.15))  
[Remove — CsCertificate](https://technet.microsoft.com/library/Gg412895(v=OCS.15))  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

