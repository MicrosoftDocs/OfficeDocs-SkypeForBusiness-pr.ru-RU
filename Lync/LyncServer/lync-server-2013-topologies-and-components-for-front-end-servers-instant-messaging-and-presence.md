---
title: 'Lync Server 2013: топологии и компоненты для серверов переднего плана, обмена мгновенными сообщениями и сведений о присутствии'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Topologies and components for Front End Servers, instant messaging, and presence
ms:assetid: f08ce7a1-d14e-4a54-9771-a82c870658bf
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg412996(v=OCS.15)
ms:contentKeyID: 48185763
ms.date: 10/24/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 103d03920df57023ae7dbb953beb0c426d0a43df
ms.sourcegitcommit: 4d6bf5c58b2c553dc1df8375ede4a9cb9eaadff2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2020
ms.locfileid: "48503756"
---
# <a name="topologies-and-components-for-front-end-servers-instant-messaging-and-presence-in-lync-server-2013"></a>Топологии и компоненты для серверов переднего плана, обмена мгновенными сообщениями и сведений о присутствии в Lync Server 2013

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">



</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2014-10-24_

Для обмена мгновенными сообщениями и сведениями о присутствии требуются только следующие компоненты:

  - Серверы переднего плана организации или серверы Standard Edition. Функции обмена мгновенными сообщениями и сведениями о присутствии всегда включены на этих серверах.

  - Подсистема балансировки нагрузки (при наличии пула переднего плана Enterprise Edition). Для получения дополнительных сведений см в разделе [требования к балансировке нагрузки для Lync Server 2013](lync-server-2013-load-balancing-requirements.md).

<div>

## <a name="planning-for-the-deployment-of-front-end-pools"></a>Планирование развертывания интерфейсных пулов

В Lync Server 2013 архитектура пула переднего плана изменилась, и эти изменения влияют на планирование и обслуживание интерфейсных пулов.

Для всех интерфейсных пулов Enterprise Edition рекомендуется включить по крайней мере три сервера переднего плана. В Lync Server архитектура интерфейсных пулов использует модель распределенных систем, в которой данные каждого пользователя хранятся на трех серверах переднего плана в пуле. Дополнительные сведения об этой новой архитектуре приведены [в статье изменения топологии в Lync Server 2013](lync-server-2013-topology-changes.md).

Если вы не хотите развертывать три сервера переднего плана Enterprise Edition и вы хотите аварийное восстановление, рекомендуем использовать Lync Server Standard Edition и создать два пула со связанным отношением резервного копирования. При этом будет предоставлено решение аварийного восстановления с двумя серверами. Дополнительные сведения о топологиях и возможностях высокого уровня доступности и аварийного восстановления приведены [в статье Планирование обеспечения высокой доступности и аварийного восстановления в Lync Server 2013](lync-server-2013-planning-for-high-availability-and-disaster-recovery.md).

</div>

<div>

## <a name="planning-for-the-management-of-front-end-pools"></a>Планирование управления интерфейсными пулами

Для интерфейсных пулов следуйте указаниям, приведенным в этом разделе.

<div>

## <a name="ensuring-that-pools-are-functional"></a>Обеспечение работоспособности пулов

При использовании новой распределенной модели для пулов переднего плана необходимо, чтобы пул работал с определенными номерами серверов пула. Существует два режима потерь для пула

  - Потеря кворума на уровне группы маршрутизации, вызванная недостаточной репликой серверов для определенной группы маршрутизации. Группа маршрутизации является объединением набора пользователей, размещенных в пуле. Каждая группа маршрутизации состоит из трех реплик в пуле: одного основного и двух получателей.

  - Потеря кворума на уровне пула, вызванная тем, что в пуле не работает достаточное количество серверов инициализации.

<div>

## <a name="routing-group-level-quorum-loss"></a>Потеря кворума на уровне группы маршрутизации

При первом запуске нового пула переднего плана необходимо, чтобы 85% серверов были запущены и запущены, как показано в следующей таблице. Если запущено меньшее количество серверов, службы могут оставаться в состоянии запуска, а пул может не запуститься.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Общее количество серверов в пуле</th>
<th>Количество серверов, которые должны быть запущены в первый раз при первом запуске пула</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>2</p></td>
<td><p>1,1</p></td>
</tr>
<tr class="even">
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr class="odd">
<td><p>4 </p></td>
<td><p>4</p></td>
</tr>
<tr class="even">
<td><p>5 </p></td>
<td><p>4 </p></td>
</tr>
<tr class="odd">
<td><p>6 </p></td>
<td><p>5 </p></td>
</tr>
<tr class="even">
<td><p>7 </p></td>
<td><p>5 </p></td>
</tr>
<tr class="odd">
<td><p>8 </p></td>
<td><p>6 </p></td>
</tr>
<tr class="even">
<td><p>9 </p></td>
<td><p>7 </p></td>
</tr>
<tr class="odd">
<td><p>10 </p></td>
<td><p>8 </p></td>
</tr>
<tr class="even">
<td><p>-11:00</p></td>
<td><p>9 </p></td>
</tr>
<tr class="odd">
<td><p>12 </p></td>
<td><p>10 </p></td>
</tr>
</tbody>
</table>


При каждом последующем запуске пула будет запущено 85% серверов (как показано в предыдущей таблице). Если это количество серверов не может быть запущено (но можно запустить достаточное количество серверов, чтобы их можно было отключить из-за потери кворума на уровне пула), можно использовать командлет **Reset-кспулрегистрарстате – ResetType куорумлоссрековери** , чтобы пул мог восстанавливаться после потери кворума на уровне группы маршрутизации и для выполнения. Дополнительные сведения о том, как использовать этот командлет, можно найти в статье [Reset/кспулрегистрарстате](https://docs.microsoft.com/powershell/module/skype/Reset-CsPoolRegistrarState).

<div>


> [!NOTE]  
> Так как Lync Server использует основную базу данных SQL в качестве следящего сервера, то при завершении работы базы данных-источника и перепереходе на зеркальную копию и завершении работы достаточного количества серверов переднего плана, чтобы они не выполнялись в соответствии с предыдущей таблицей, весь пул перейдет. Дополнительные сведения можно найти в разделе <A href="https://go.microsoft.com/fwlink/?linkid=393672">следящий сервер зеркального отображения баз данных</A>.



</div>

</div>

<div>

## <a name="pool-level-quorum-loss"></a>Потеря кворума на уровне пула

Для того, чтобы интерфейсный пул функционировал вообще, он не может находиться в потерях кворума на уровне пула. Если количество серверов, на которых работает уровень ниже режима работы, показано в следующей таблице, остальные серверы в пуле будут останавливать все службы Lync Server. Обратите внимание, что в приведенных ниже таблицах предполагается, что серверы переднего планов в пуле работают.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Общее число серверов переднего плана в пуле</th>
<th>Число работающих серверов, требуемое для правильного функционирования пула</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>2</p></td>
<td><p>1,1</p></td>
</tr>
<tr class="even">
<td><p>3-4</p></td>
<td><p>Любой 2</p></td>
</tr>
<tr class="odd">
<td><p>5-6</p></td>
<td><p>Любое 3</p></td>
</tr>
<tr class="even">
<td><p>7 </p></td>
<td><p>Любой 4</p></td>
</tr>
<tr class="odd">
<td><p>8-9</p></td>
<td><p>4 первых 7 серверов</p></td>
</tr>
<tr class="even">
<td><p>10-12</p></td>
<td><p>5 первых девяти серверов</p></td>
</tr>
</tbody>
</table>


В приведенной выше таблице первыми серверами являются серверы, которые были первыми, в хронологическом порядке, когда пул был запущен в первый раз. Для определения этих серверов можно использовать командлет **Get-CsComputer** с параметром **– PoolFqdn** . Этот командлет покажет серверы в том порядке, в котором они отображаются в топологии, а в верхней части списка находятся первые серверы.

</div>

<div>

## <a name="front-end-pools-with-two-front-end-servers"></a>Интерфейсные пулы с двумя серверами переднего плана

Мы не рекомендуем развертывать интерфейсный пул, содержащий всего два сервера переднего плана. Если вам все же потребуется развернуть такой пул, следуйте приведенным ниже рекомендациям:

  - В случае сбоя одного из двух этих серверов переднего плана вам следует как можно быстрее восстановить его работоспособность. Аналогичным образом, в случае обновления одного из двух серверов его также необходимо вернуть в рабочее состояние как можно быстрее.

  - Если по какой-либо причине требуется отключить оба сервера одновременно, после окончания простоя пула выполните следующие действия:
    
      - Рекомендуется перезапустить оба сервера переднего плана одновременно.
    
      - Если это невозможно, следует включать их в порядке, обратном порядку их отключения.
    
      - Если и это невозможно, перед включением пула выполните следующий командлет:
        
            Reset-CsPoolRegistrarState -ResetType QuorumLossRecovery -PoolFQDN <FQDN>

</div>

<div>

## <a name="additional-steps-to-ensure-pools-are-functional"></a>Дополнительные действия для обеспечения работоспособности пулов

Необходимо проследить за несколько других факторов, чтобы обеспечить работоспособность пулов переднего плана.

  - При первом перемещении пользователей в пул обязательно убедитесь, что запущено не менее трех серверов переднего плана.

  - Если вы устанавливаете отношение связывания между данным пулом и другим пулом в целях обеспечения аварийного восстановления, по после этого вам следует убедиться, что данный пул имеет три одновременно работающих сервера переднего плана для правильной синхронизации данных с резервным пулом. Дополнительные сведения о функциях связывания и аварийного восстановления пула приведены [в статье Планирование обеспечения высокой доступности и аварийного восстановления в Lync Server 2013](lync-server-2013-planning-for-high-availability-and-disaster-recovery.md).

</div>

</div>

<div>

## <a name="improving-the-reliability-of-pool-upgrades"></a>Повышение надежности пула обновлений

Если вам нужно обновить или исправить серверы в пуле переднего плана, выполните рабочий процесс, показанный на странице [обновление или обновление серверов переднего плана в Lync Server 2013](lync-server-2013-upgrade-or-update-front-end-servers.md), и следующие рекомендации:

  - При переходе с одного домена обновления на другой для обновлений (на основе рабочего процесса при [обновлении или обновлении серверов переднего плана в Lync Server 2013](lync-server-2013-upgrade-or-update-front-end-servers.md)) используется командлет **Get-CsPoolUpgradeReadinessState** и выполняется проверка состояния готовности. Добавление 20 минут ожидания между каждым доменом обновления после того, как он достигнет "Готово", сделает обновление более надежным. Если он **не будет готов** в течение этого 20 минут, перезапустите таймер 20 минут. Кроме того, вы можете выполнить командлет **Get – CsPoolFabricState** до и после начала 20 минут и убедиться в отсутствии изменений в первичных и резервных копиях групп маршрутизации.

  - Не переходите к следующему домену обновления, если один из серверов в последнем домене обновления был задержан или не перезапускается. Это также применимо, если не удается запустить ни один из серверов, входящих в обновление. Выполните командлет **Get – CsPoolFabricState** , чтобы убедиться в том, что все группы маршрутизации имеют основной и по крайней мере один вторичный; будет подтверждено, имеет ли все пользователи обслуживание.

  - Если некоторые пользователи имеют службы, а другие — нет, выполните командлет **Get-CsPoolFabricState** с параметром – verbose, чтобы проверить наличие групп маршрутизации, в которых отсутствуют реплики. Не перезапускайте весь пул в качестве первого этапа устранения неполадок. Для получения дополнительных сведений об этом командлете обратитесь к разделу [Get – CsPoolFabricState](https://docs.microsoft.com/powershell/module/skype/Get-CsPoolFabricState).

  - Убедитесь, что все экземпляры окон "Просмотр событий" и "системный монитор" закрыты для установки и удаления Windows Fabric.

</div>

<div>

## <a name="changing-a-front-end-pools-configuration"></a>Изменение конфигурации интерфейсного пула

При добавлении серверов переднего плана в пул, их удалении из пула и публикации новой топологии следуйте приведенным ниже рекомендациям:

  - После публикации новой топологии необходимо перезапустить все серверы переднего плана в пуле. Перезапускайте их по одному.

  - Если во время изменения конфигурации был отключен весь пул, после публикации новой топологии запустите следующий командлет:
    
        Reset-CsPoolRegistrarState -PoolFQDN <PoolFQDN> -ResetType ServiceReset

Если сервер переднего плана ломается и вряд ли будет заменен только через несколько дней или позднее, удалите этот сервер из топологии. Когда новый сервер переднего плана вновь станет доступен, добавьте его в топологию.

</div>

</div>

</div>

<span> </span>

</div>

</div>

</div>

