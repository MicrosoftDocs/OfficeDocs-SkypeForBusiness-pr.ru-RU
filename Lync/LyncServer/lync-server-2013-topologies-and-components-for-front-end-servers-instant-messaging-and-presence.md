---
title: 'Lync Server 2013: топология и компоненты для серверов переднего плана, обмена мгновенными сообщениями и сведениями о присутствии'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Topologies and components for Front End Servers, instant messaging, and presence
ms:assetid: f08ce7a1-d14e-4a54-9771-a82c870658bf
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg412996(v=OCS.15)
ms:contentKeyID: 48185763
ms.date: 10/24/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 181ae682ec5ee1352c5d4f4280b4164fbbcd91f2
ms.sourcegitcommit: b693d5923d6240cbb865241a5750963423a4b33e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2020
ms.locfileid: "41745249"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="topologies-and-components-for-front-end-servers-instant-messaging-and-presence-in-lync-server-2013"></a>Топология и компоненты для серверов переднего плана, обмена мгновенными сообщениями и сведениями о присутствии в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Тема последнего изменения:** 2014-10-24_

Для обмена мгновенными сообщениями и сведениями о присутствии требуются только следующие компоненты:

  - Серверы переднего плана вашей организации или серверы Standard Edition. Функции обмена мгновенными сообщениями и сведениями о присутствии всегда включены на этих серверах.

  - Подсистема балансировки нагрузки, если используется интерфейсный пул Enterprise Edition. Дополнительные сведения можно найти в разделе [требования балансировки нагрузки для Lync Server 2013](lync-server-2013-load-balancing-requirements.md).

<div>

## <a name="planning-for-the-deployment-of-front-end-pools"></a>Планирование развертывания интерфейсных пулов на стороне сервера

В Lync Server 2013 архитектура пула переднего плана была изменена, и эти изменения повлияют на планирование и обслуживание пулов переднего плана.

Рекомендуется, чтобы все пулы переднего плана Enterprise Edition включали не менее трех серверов переднего плана. В Lync Server архитектура пулов переднего плана использует модель распределенных систем, при этом данные каждого пользователя хранятся на трех серверах переднего плана в пуле. Дополнительные сведения об этой новой архитектуре описаны [в разделе изменения топологии в Lync Server 2013](lync-server-2013-topology-changes.md).

Если вы не хотите развертывать три сервера переднего плана Enterprise Edition и хотите восстановить работоспособность, мы рекомендуем использовать Lync Server Standard Edition и создать два пула с Объединенным отношением резервного копирования. Это позволит устранить проблемы с аварийным восстановлением только двух серверов. Дополнительные сведения о топологиях и возможностях восстановления с высокой доступностью и аварийным восстановлением содержатся [в разделе Планирование обеспечения высокой доступности и аварийного восстановления в Lync Server 2013](lync-server-2013-planning-for-high-availability-and-disaster-recovery.md).

</div>

<div>

## <a name="planning-for-the-management-of-front-end-pools"></a>Планирование управления пулами интерфейсов на стороне сервера

Для пулов интерфейсов переднего плана следуйте рекомендациям, приведенным в этом разделе.

<div>

## <a name="ensuring-that-pools-are-functional"></a>Обеспечение функциональных возможностей пулов

При использовании новой распределенной модели для пулов интерфейсов с внешним интерфейсом для функционирования пула необходимо, чтобы были запущены определенные числа серверов пула. Существует два режима потерь для пула

  - Нехватка кворума на уровне группы маршрутизации, что вызвано недостаточным количеством серверов-реплик для определенной группы маршрутизации. Группа маршрутизации — это совокупность набора пользователей, размещенных в пуле. У каждой группы маршрутизации есть три реплики в пуле: один первичный и два.

  - Нехватка кворума на уровне пула, что вызвано недостаточным количеством серверов инициализации в пуле.

<div>

## <a name="routing-group-level-quorum-loss"></a>Нехватка кворума на уровне группы маршрутизации

При первом запуске нового интерфейсного пула необходимо, чтобы 85% серверов были установлены и запущены, как показано в следующей таблице. Если запущено меньшее количество серверов, службы могут зависнуть в состоянии запуска, а пул может вообще не запуститься.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Общее количество серверов в пуле</th>
<th>Количество запущенных серверов, которое требуется для первого запуска пула</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>2</p></td>
<td><p>1</p></td>
</tr>
<tr class="even">
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="odd">
<td><p>4</p></td>
<td><p>3</p></td>
</tr>
<tr class="even">
<td><p>5</p></td>
<td><p>4</p></td>
</tr>
<tr class="odd">
<td><p>6</p></td>
<td><p>5</p></td>
</tr>
<tr class="even">
<td><p>7</p></td>
<td><p>5</p></td>
</tr>
<tr class="odd">
<td><p>No8</p></td>
<td><p>6</p></td>
</tr>
<tr class="even">
<td><p>@</p></td>
<td><p>7</p></td>
</tr>
<tr class="odd">
<td><p>5-10</p></td>
<td><p>No8</p></td>
</tr>
<tr class="even">
<td><p>11</p></td>
<td><p>@</p></td>
</tr>
<tr class="odd">
<td><p>12</p></td>
<td><p>5-10</p></td>
</tr>
</tbody>
</table>


При каждом последующем запуске пула 85% серверов должны быть запущены (как показано на таблице выше). Если невозможно запустить такое количество серверов (однако можно запустить столько серверов, чтобы избежать нехватки кворума на уровне пула), можно воспользоваться командлетом **Reset-CsPoolRegistrarState –ResetType QuorumLossRecovery** для восстановления пула из нехватки кворума на уровне группы маршрутизации и запуска хода выполнения. Дополнительные сведения о том, как использовать этот командлет, можно найти в разделе [Reset-кспулрегистрарстате](https://docs.microsoft.com/powershell/module/skype/Reset-CsPoolRegistrarState).

<div>


> [!NOTE]  
> Так как Lync Server использует основную базу данных SQL в качестве следящего сервера, при закрытии базы данных-источника и переходе на зеркальную копию и завершении достаточного количества серверов переднего плана, так как они не работают в соответствии с предыдущей таблицей, весь пул перейдет вниз. Дополнительные сведения можно найти в разделе <A href="http://go.microsoft.com/fwlink/?linkid=393672">следящий сервер зеркального отображения базы данных</A>.



</div>

</div>

<div>

## <a name="pool-level-quorum-loss"></a>Нехватка кворума на уровне пула

Для пула интерфейсов переднего плана не может быть потеря кворума на уровне пула. Если число запущенных серверов не ниже, как показано в приведенной ниже таблице, оставшиеся серверы в пуле будут остановлены во всех службах Lync Server. Обратите внимание, что в приведенных ниже таблицах предполагается, что сервер в пуле запущен.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Общее количество серверов переднего плана в пуле</th>
<th>Число работающих серверов, требуемое для правильного функционирования пула</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>2</p></td>
<td><p>1</p></td>
</tr>
<tr class="even">
<td><p>3-4</p></td>
<td><p>Любые 2</p></td>
</tr>
<tr class="odd">
<td><p>5-6</p></td>
<td><p>Любые 3</p></td>
</tr>
<tr class="even">
<td><p>7</p></td>
<td><p>Любые 4</p></td>
</tr>
<tr class="odd">
<td><p>8-9</p></td>
<td><p>Любые 4 из первых 7 серверов</p></td>
</tr>
<tr class="even">
<td><p>10–12</p></td>
<td><p>Любые 5 из первых 9 серверов</p></td>
</tr>
</tbody>
</table>


В предыдущей таблице "первые серверы" — это серверы, которые были первыми, в хронологическом порядке, при запуске пула в первый раз. Чтобы определить эти серверы, можно использовать командлет **Get-кскомпутер** с параметром **– пулфкдн** . Этот командлет будет показывать серверы в том порядке, в котором они отображаются в топологии, а в верхней части списка — первые серверы.

</div>

<div>

## <a name="front-end-pools-with-two-front-end-servers"></a>Пулы интерфейсов с двумя серверами переднего плана

Мы не рекомендуем развертывать пул переднего плана, который включает только два сервера переднего плана. Если вы когда-либо хотите развернуть такой пул, следуйте этим рекомендациям:

  - Если один из двух серверов переднего плана отключается, вы должны попытаться выполнить резервное копирование неисправного сервера по мере их появления. Аналогичным образом, в случае обновления одного из двух серверов его также необходимо вернуть в рабочее состояние как можно быстрее.

  - Если по какой-либо причине требуется отключить оба сервера одновременно, после окончания простоя пула выполните следующие действия:
    
      - Рекомендуется перезапускать оба внешних сервера в одно и то же время.
    
      - Если это невозможно, следует включать их в порядке, обратном порядку их отключения.
    
      - Если вы не можете выполнить резервное копирование в указанном порядке, используйте следующий командлет, прежде чем приступить к восстановлению пула:.
        
            Reset-CsPoolRegistrarState -ResetType QuorumLossRecovery -PoolFQDN <FQDN>

</div>

<div>

## <a name="additional-steps-to-ensure-pools-are-functional"></a>Дополнительные действия по обеспечению работоспособности пулов

Для проверки функционирования пулов переднего плана требуется обратить внимание на еще несколько факторов.

  - При первом перемещении пользователей в пул убедитесь, что запущены по крайней мере три сервера переднего плана.

  - Если вы установили отношение связывания между этим пулом и другим пулом для целей аварийного восстановления, после того как вы установите это отношение, вы должны убедиться, что в этом пуле одновременно работают три сервера переднего плана. данные из пула резервных копий. Более подробную информацию о функциях связывания и аварийного восстановления пула можно найти [в разделе Планирование обеспечения высокой доступности и аварийного восстановления в Lync Server 2013](lync-server-2013-planning-for-high-availability-and-disaster-recovery.md).

</div>

</div>

<div>

## <a name="improving-the-reliability-of-pool-upgrades"></a>Повышение надежности кластерных обновлений

Если вам нужно обновить или обновить серверы в пуле переднего плана, выполните действия, указанные в [статье обновление и обновление серверов переднего плана в Lync Server 2013](lync-server-2013-upgrade-or-update-front-end-servers.md), и следующие рекомендации.

  - При переходе с одного домена обновления на другой для обновления (после обновления [или обновления серверов переднего плана в Lync Server 2013](lync-server-2013-upgrade-or-update-front-end-servers.md)) вы будете использовать командлет **Get-кспулупградереадинессстате** и проверяйте состояние готовности. Добавление в течение 20 минут ожидания между каждым доменом обновления после того, как он достигнет значения "Готово", повышает надежность обновлений. Если он **не будет готов** в течение 20 минут, перезапустите 20-минутный таймер. Кроме того, вы можете запустить командлет **Get-кспулфабрикстате** до и после 20-минутного интервала времени и убедиться в отсутствии изменений в первичных и логических категориях групп маршрутизации.

  - Не переходите к следующему домену обновления, если один из серверов в последнем домене обновления задерживается или не перезапускается. Это также применимо, если не удается запустить какой – либо сервер, на котором находится обновление. Запустите **Get-кспулфабрикстате** , чтобы убедиться, что у всех групп маршрутизации есть основной и хотя бы один вспомогательный. Это подтвердит, есть ли у всех пользователей обслуживание.

  - Если у некоторых пользователей есть служба и другие пользователи, запустите **Get-кспулфабрикстате** с параметром – verbose для поиска групп маршрутизации с отсутствующими репликами. Не перезапускайте весь пул как первый шаг для устранения неполадок. Дополнительные сведения об этом командлете можно найти в [статьях Get-кспулфабрикстате](https://docs.microsoft.com/powershell/module/skype/Get-CsPoolFabricState).

  - Убедитесь, что все экземпляры окна просмотра событий или системного монитора закрыты для Windows Fabric (устанавливается или удаляет).

</div>

<div>

## <a name="changing-a-front-end-pools-configuration"></a>Изменение конфигурации пула переднего плана

Каждый раз, когда вы добавляете серверы переднего плана в пул или удаляете их из пула, а затем публикуете новую топологию, следуйте этим рекомендациям:

  - После публикации новой топологии необходимо перезапустить каждый сервер переднего плана в пуле. Перезапускайте их по одному.

  - Если во время изменения конфигурации весь пул был остановлен, после публикации новой топологии запустите следующий командлет:
    
        Reset-CsPoolRegistrarState -PoolFQDN <PoolFQDN> -ResetType ServiceReset

Если сервер переднего плана завершается сбоем и вряд ли будет заменен на несколько дней или больше, удалите сервер из топологии. Добавьте новый сервер переднего плана в топологию, когда он снова станет доступен.

</div>

</div>

</div>

<span> </span>

</div>

</div>

</div>

