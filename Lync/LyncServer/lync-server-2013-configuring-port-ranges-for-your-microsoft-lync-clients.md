---
title: Настройка диапазонов портов для клиентов Microsoft Lync
TOCTitle: Настройка диапазонов портов для клиентов Microsoft Lync
ms:assetid: 287d5cea-7ada-461c-9b4a-9da2af315e71
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ204760(v=OCS.15)
ms:contentKeyID: 49309252
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Настройка диапазонов портов для клиентов Microsoft Lync

 

_**Дата изменения раздела:** 2015-03-09_

По умолчанию клиентские приложения Lync могут использовать любые порты от 1024 до 65535 при участии в сеансе связи. Это связано с тем, что определенные диапазоны портов не применяются автоматически для клиентов. Чтобы использовать качество обслуживания требуется заново назначить различные типы трафика (аудио, видео, мультимедиа, совместное использование приложений и передача файлов) ряду уникальных диапазонов портов. Это можно сделать с помощью командлета Set-CsConferencingConfiguration.

Вы можете определить, какие диапазоны портов используются в данный момент для сеансов связи, выполнив следующую команду в командная консоль Microsoft Lync Server 2013:

    Get-CsConferencingConfiguration

Предположим, что вы не вносили изменений в параметры конференций после установки Lync Server 2013, тогда вы должны получить данные со следующими значениями свойств:

    ClientMediaPortRangeEnabled : False
    ClientAudioPort             : 5350
    ClientAudioPortRange        : 40
    ClientVideoPort             : 5350
    ClientVideoPortRange        : 40
    ClientAppSharingPort        : 5350
    ClientAppSharingPortRange   : 40
    ClientFileTransferPort      : 5350
    ClientTransferPortRange     : 40

Если внимательно посмотреть на предыдущие данные, можно увидеть две важных вещи. Во-первых, для свойства ClientMediaPortRangeEnabled задано значение False:

    ClientMediaPortRangeEnabled : False

Это важно, потому что когда для этого свойства задано значение False, клиенты Lync будут использовать любые порты от 1024 до 65535 при участии в сеансе связи. Это справедливо независимо от любых других настроек портов (например, ClientMediaPort или ClientVideoPort). Если вы хотите разрешить использование только определенных наборов портов (а это необходимо, если вы планируете реализовать качество обслуживания), сначала включите диапазоны портов мультимедиа клиентов. Это можно сделать с помощью следующей команды Windows PowerShell:

    Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True

Приведенная выше команда активирует диапазоны портов мультимедиа клиентов для глобальной коллекции параметров конфигурации конференций. Однако данные настройки также могут применяться к области сайта или службы (только для службы сервера конференций). Чтобы включить диапазоны портов мультимедиа клиентов для определенного сайта или сервера, укажите идентификатор этого сайта или сервера при вызове команды Set-CsConferencingConfiguration:

    Set-CsConferencingConfiguration -Identity "site:Redmond" -ClientMediaPortRangeEnabled $True

Или же вы можете использовать следующую команду, чтобы одновременно включить диапазоны порты для всех параметров конфигурации конференций:

    Get-CsConferencingConfiguration | Set-CsConferencingConfiguration  -ClientMediaPortRangeEnabled $True

Второй важный момент — в примере выходных данных показано, что по умолчанию набор диапазонов портов мультимедиа для каждого типа сетевого трафика идентичны:

    ClientAudioPort             : 5350
    ClientVideoPort             : 5350
    ClientAppSharingPort        : 5350
    ClientFileTransferPort      : 5350

Чтобы реализовать QoS, каждый из этих диапазонов портов должен быть уникальным. Например, вы можете настроить следующие диапазоны портов:


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип клиентского трафика</th>
<th>Запуск порта</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Аудио</p></td>
<td><p>50020</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Видео</p></td>
<td><p>58000</p></td>
<td><p>20</p></td>
</tr>
<tr class="odd">
<td><p>Совместное использование приложений</p></td>
<td><p>42000</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>


В приведенной выше таблице диапазоны портов клиента представляют подмножество диапазонов портов, настроенных для ваших серверов. Например, на серверах для совместного использования приложений были настроены порты с 40803 по 49151. На клиентских компьютерах для совместного использования приложений были настроены порты с 42000 по 42019. Это, в основном, сделано для упрощения управления QoS: клиентские порты не должны представлять подмножество портов, используемых на сервере. (Например, на клиентских компьютерах можно настроить для совместного использования приложений, скажем, порты 10000-10019) Однако рекомендуется сделать диапазоны портов клиента подмножеством диапазонов портов сервера.

Кроме того, вы могли заметить, что 8348 портов было выделено для совместного использования приложений на серверах, но всего 20 портов было выделено для совместного использования приложений на клиентах. Это также рекомендуется, но не является строго обязательным. В общем, можно рассмотреть каждый доступный порт для представления отдельного сеанса связи: если у вас 100 портов в диапазоне, что означает, что компьютер может участвовать максимум в 100 сеансах связи в любой момент времени. Поскольку серверы, вероятно, будут участвовать в большем числе сеансов, чем клиенты, имеет смысл открыть намного больше портов на серверах, чем на клиентах. Выделение 20 портов для совместного использования приложений на клиентах означает, что пользователь одновременно может участвовать в 20 сеансах совместного применения приложений на указанном устройстве. Если должно быть достаточно для подавляющего большинства пользователей.

Чтобы назначить предыдущие диапазоны портов глобальной коллекции параметров конфигурации конференций, можно использовать команду Командная консоль Lync Server:

    Set-CsConferencingConfiguration -Identity global -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 - ClientFileTransferPort 42020 -ClientFileTransferPortRange 20

Или с помощью этой команды можно назначить эти же диапазоны портов всем параметрам конфигурации конференций:

    Get-CsConferencingConfiguration | Set-CsConferencingConfiguration -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 - ClientFileTransferPort 42020 -ClientFileTransferPortRange 20

Отдельные пользователи должны выйти из Lync и войти снова, чтобы эти изменения вступили в силу.

> [!NOTE]  
> Вы также можете включить диапазоны портов мультимедиа клиентов, а затем назначить эти диапазоны портов с помощью одной команды. Например:<br /><code>Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20</code>
