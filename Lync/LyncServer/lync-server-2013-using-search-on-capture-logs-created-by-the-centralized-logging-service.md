---
title: Использование поиска для журналов захвата, созданных службой централизованного ведения журналов
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Using search on capture logs created by the Centralized Logging Service
ms:assetid: 1b75b218-d84f-47a7-8a0a-b7e016b1cc79
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ687982(v=OCS.15)
ms:contentKeyID: 49733571
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 5d306c17f2c399d38e406d466664a49e3e2df6ee
ms.sourcegitcommit: 831d141dfc5a49dd764cb296b73b63e5a9f8e599
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/21/2020
ms.locfileid: "42212715"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="using-search-on-capture-logs-created-by-the-centralized-logging-service-in-lync-server-2013"></a>Использование поиска для журналов захвата, созданных службой централизованного ведения журналов в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2013-02-21_

Функции поиска в централизованной службе ведения журналов полезны и являются мощными по следующим причинам:

  - Процесс и результаты поиска выполняются на одном компьютере, в пуле, на сайте или в глобальной области в зависимости от заданных критериев.

  - Поиск может изначально выполняться в широком диапазоне с последующим уточнением до более узких критериев (время, компонент или компьютер). Поиск выполняется по тем же журналам, и запуск сеанса ведения журнала при изменении условий поиска не требуется.

  - Выполняется сбор результатов поиска со всех компьютеров и из пулов в области, создание коллекции и объединение результатов поисков в единый файл вывода, представляющий результаты использования условий поиска (с ограничением до выполняемых сценариев и данных, получаемых сценариями). При этом для чтения файла вывода и сообщений трассировки во всей среде используется хорошо знакомый инструмент (например, **Snooper** или **Блокнот**).

CLSAgent на каждом отдельном компьютере создает журналы в соответствии со сценарием или сценариями (в любое время на компьютере можно выполнять одновременно два сценария). Управление журналами и связанными с ними файлы индекса и кэша осуществляется посредством CLSAgent. При определении критериев и выполнении поиска команда поиска сообщает CLSAgent, какие данные требуется получить. CLSAgent направляет запрос в файлы журнала, кэша и индекса и возвращает результаты поиска в CLSContoller. CLSController получает результаты поиска от всех компьютеров и объединяет их в пул в области поиска. Затем CLSController объединяет журналы и помещает их в порядке изменения времени (первыми идут самые старые записи, последними - самые новые).

После каждой операции поиска запускается командлет **Sync-CsClsLogging**, который выполняет очистку кэша, используемого операциями поиска (не следует путать с файлами кэша, обслуживаемыми CLSAgent). Очистка кэша позволяет убедиться в том, что журнал и буфер записи файлов трассировки в CLSController свободны для следующей операции поиска.

Чтобы получить наибольшую пользу от централизованной службы ведения журналов, необходимо хорошо понимать, как настроить поиск, чтобы возвратить только сообщения трассировки из журналов компьютера и пула, которые относятся к возникшей ошибке. ошибки

Для запуска функций Службы централизованного ведения журналов с помощью командной консоли Lync Server необходимо быть членом группы безопасности CsAdministrator или CsServerAdministrator с управлением доступом на основе ролей (RBAC) или настраиваемой роли RBAC, содержащей Любая из этих двух групп. Чтобы получить список всех ролей RBAC, которым назначен этот командлет (включая все самостоятельно созданные роли RBAC), выполните следующую команду в командной консоли Lync Server или в командной строке Windows PowerShell:

    Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Lync Server 2013 cmdlet"}

Например:

    Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}

Остальная часть данного раздела посвящена способам определения критериев поиска в целях оптимизации диагностики.

<div>

## <a name="to-run-a-basic-search-by-using-the-centralized-logging-service"></a>Выполнение базового поиска с помощью централизованной службы ведения журналов

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Убедитесь в том, что в глобальной области среды выполняется сценарий AlwaysOn, после чего введите в командной строке следующее:
    
        Search-CsClsLogging -OutputFilePath <string value of path and file to write the output file>
    
    <div>
    

    > [!NOTE]
    > По умолчанию Search-CsClsLogging отправляет результаты поиска на консоль. Если вы хотите сохранить результаты поиска в файл, используйте параметр – OutputFilePath &lt;String полностью полный путь к&gt;файлу. Чтобы определить параметр –OutputFilePath, необходимо указать в параметре путь и имя файла в строковом формате и в кавычках (например: C:\LogFiles\SearchOutput.txt). В этом примере необходимо убедиться в том, что каталог C:\LogFiles существует, и у вас есть разрешения для чтения и записи файлов в этот каталог (разрешение NTFS Modify). Выполняется добавление выходных данных, но не их перезапись. Чтобы создать отдельные файлы, определите уникально идентифицируемое имя файлы для каждой операции поиска.

    
    </div>
    
    Например:
    
        Search-CsClsLogging -OutputFilePath "C:\LogFiles\logfile.txt"

</div>

<div>

## <a name="to-run-a-basic-search-on-a-pool-or-computer-by-using-the-centralized-logging-service"></a>Выполнение базового поиска для пула или компьютера с помощью централизованной службы ведения журналов

1.  Чтобы ограничить область поиска конкретным пулом или компьютером, используется параметр –Computers, в котором компьютер определяется полным именем, заключенным в кавычки, с разделением запятыми:
    
        Search-CsClsLogging -Computers <string value of computer names> -OutputFilePath <string value of path and file to write the output file>
    
    Например:
    
        Search-CsClsLogging -Computers "fe01.contoso.net" -OutputFilePath "C:\LogFiles\logfile.txt"

2.  Чтобы выполнить поиск по нескольким компьютерам, введите несколько имен компьютеров в кавычках с разделением запятыми. Например:
    
        Search-CsClsLogging -Computers "fe01.contoso.net", "fe02.contoso.net", "fe03.contoso.net" -OutputFilePath "C:\LogFiles\logfile.txt"

3.  Чтобы выполнить поиск по всему пулу, а не по одному компьютеру, измените параметр –Computers на –Pools, удалите имя компьютера и замените его на имя пула или пулов в кавычках с разделением запятыми.
    
    Например:
    
        Search-CsClsLogging -Pools "pool01.contoso.net" -OutputFilePath "C:\Logfiles\logfile.txt"

4.  При использовании команд поиска пулы могут представлять собой любой пул в развертывании, например интерфейсные пулы, пограничные пулы, пулы серверов сохраняемого чата или другие, которые определены как пул в развертывании.
    
    Например:
    
        Search-CsClsLogging -Pools "pool01.contoso.net", "pchatpool01.contoso.net", "intedgepool01.contoso.net" -OutputFilePath "C:\Logfiles\logfile.txt"

</div>

<div>

## <a name="to-run-a-search-by-using-time-parameters"></a>Выполнение поиска с использованием параметров времени

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  По умолчанию время начала для параметров времени поиска — 30 минут до инициации поиска. Иными словами, если поиск инициируется в 16:00, поиск выполняется по журналам тех компьютеров и пулов, которые определены в интервале от 15:30 до 16:00. Чтобы выполнить поиск в интервале 1-3 часа до текущего времени, необходимо использовать параметр –StartTime и задать строку времени и даты, чтобы определить желаемое время начала поиска.
    
    Например, при использовании параметров –StartTime и –EndTime для определения времени и диапазона данных можно задать поиск по своему пулу в интервале 20:00 и 9:00 20.11.12. Можно задать выходной путь для записи результатов в файл с именем c:\\logfile. txt следующим образом:
    
        Search-CsClsLogging -Pools "pool01.contoso.net" -StartTime "11/20/2012 08:00:00 AM" -EndTime "11/20/2012 09:00:00 AM" -OutputFilePath "C:\Logfiles\logfile.txt"
    
    <div>
    

    > [!NOTE]
    > Указанная строка времени и даты может иметь значение "Дата и время". "Команда будет анализировать строку и использовать соответствующие значения даты и времени.

    
    </div>

3.  Для получения журналов за период, начиная с 11:00 20.11.12, необходимо задать параметр –StartTime. Для интервала времени по умолчанию установлено значение 30 минут, если не определен параметр –EndTime. В результате поиск возвращает журналы с определенного компьютера или пула за период с 11:00 до 11:30.
    
    Например:
    
        Search-CsClsLogging -Pools "pool01.contoso.net" -StartTime "11/20/2012 11:00:00 AM" -OutputFilePath "C:\Logfiles\logfile.txt"

4.  Чтобы выполнить поиск по журналам в заданный период, необходимо определить параметры –StartTime и –EndTime. Потребуются журналы за период с 13:00 до 14:45 для компьютера edge01.contoso.net.
    
    Пример:
    
        Search-CsClsLogging -Computers "edge01.contoso.net" -StartTime "11/20/2012 1:00:00 PM" -EndTime "11/20/2012 2:45:00 PM" -OutputFilePath "C:\Logfiles\logfile.txt"

</div>

<div>

## <a name="to-run-an-advanced-search-by-using-other-criteria-and-matching-options"></a>Выполнение расширенного поиска с использованием других критериев и параметров сопоставления

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Чтобы выполнить команду сбора трассировок для заданных компонентов, введите следующий текст:
    
        Search-CsClsLogging -Components <components to search on> -OutputFilePath <fully qualified path to output logs>
    
    Пример:
    
        Search-CsClsLogging -Components "SIPStack","S4","UserServices" -OutputFilePath "C:\Logfiles\logfile.txt"
    
    В результате поиск возвращает все записи в журнале, которые содержат компоненты трассировки для SIPStack, S4 и UserServices, для всех компьютеров и пулов в среде за последние 30 минут.

3.  Чтобы ограничить поиск теми же компонентами, что и пул переднего плана с именем pool01.contoso.net, введите:
    
        Search-CsClsLogging -Components "SIPStack","S4","UserServices" -OutputFilePath "C:\Logfiles\logfile.txt"

4.  По умолчанию для команд, содержащих несколько параметров, используется следующая логика поиска: логический оператор OR с каждым из определенных параметров. Можно изменить данное поведение, задав параметр **–MatchAll**. Для этого введите следующий текст:
    
        Search-CsClsLogging -CallId "d0af828e49fa4dcb99f5f80223a634bc" -Components "SIPStack","S4","UserServices" -MatchAll -OutputFilePath "C:\Logfiles\logfile.txt"

5.  Если для сценариев задано постоянное выполнение (например, AlwaysOn), или определены сценарии длительного выполнения, журналы могут быть перемещены с локального компьютера в сетевую общую папку. Общая папка определяется параметром CacheFileNetworkFolder с использованием командлета New-CsClsConfiguration для создания новой или изменения текущей конфигурации с помощью Set-CsClsConfiguration. Если включать общую папку в коллекцию журналов для поиска не требуется, используйте параметр SkipNetworkLogs, как показано далее:
    
        Search-CsClsLogging -Components "SIPStack","S4","UserServices" -StartTime "11/1/2012 00:00:01 AM" -EndTime "11/20/2012 2:45:00 PM" -SkipNetworkLogs -OutputFilePath "C:\Logfiles\logfile.txt"

</div>

</div>

<span> </span>

</div>

</div>

</div>

