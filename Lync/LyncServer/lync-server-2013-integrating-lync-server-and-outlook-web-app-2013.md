---
title: Интеграция Microsoft Lync Server 2013 и Microsoft Outlook Web App 2013
TOCTitle: Интеграция Microsoft Lync Server 2013 и Microsoft Outlook Web App 2013
ms:assetid: 513d4cc7-aa87-4f68-b99d-d58b63bdf242
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ688055(v=OCS.15)
ms:contentKeyID: 49887989
ms.date: 12/10/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Интеграция Microsoft Lync Server 2013 и Microsoft Outlook Web App 2013

 

_**Дата изменения раздела:** 2016-12-08_

В дополнение к интеграции с Microsoft Outlook 2013 Microsoft Lync Server 2013 можно полностью интегрировать с Microsoft Outlook Web App 2013; помимо всего прочего, это добавляет в Outlook Web App возможности обмена мгновенными сообщениями и использования сведений о присутствии, а также позволяет использовать единый список контактов в Outlook Web App и Microsoft Lync 2013. Чтобы интегрировать Lync Server 2013 и Outlook Web App, необходимо сначала убедиться, что среда выполнения Unified Communications Managed API 4.0 была установлена на внутреннем сервере Microsoft Exchange Server 2013. Это можно сделать, проверив наличие следующего раздела реестра:

HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MSExchange OWA\\InstantMessaging\\ImplementationDLLPath

ImplementationDLLPath должен указывать на папку с файлом Microsoft.Rtc.Internal.Ucweb.dll. Если это не так или раздел реестра не существует, необходимо загрузить и установить программу установки среды выполнения UCMA из Центра загрузки Майкрософт по адресу <http://www.microsoft.com/ru-ru/download/details.aspx?id=34992>. Информация об установке среды выполнения UCMA приведена на той же веб-странице.

**Обратная совместимость**

Lync Server 2013 можно интегрировать с версиями Microsoft Exchange Server 2010 как единой системы обмена сообщениями, так и Outlook Web App. Дополнительные сведения см. в статье "Развертывание локальной единой системы обмена сообщениями Exchange для обеспечения функций голосовой почты Lync Server 2010" по адресу [http://technet.microsoft.com/ru-ru/library/gg398768.aspx](lync-server-2013-deploying-on-premises-exchange-um-to-provide-lync-server-2013-voice-mail.md). В случае интеграции с Exchange 2010 характерные для Lync Server возможности, такие как единое хранилище контактов и архивация данных из Lync в Exchange, будут отсутствовать.

Microsoft Lync 2013 можно также использовать совместно с Exchange 2010 и Outlook 2010. Еще раз отметим, что пользователям Lync 2013 будут недоступны новые функциональные возможности, такие как единое хранилище контактов и фотографии с высоким разрешением. Эти новые возможности требуют наличия как Lync Server 2013, так и Exchange 2013.

**Создание пула доверенных приложений для Outlook Web App**

Если вы установили службу маршрутизации вызовов единой системы обмена сообщениями Microsoft Exchange и службу единой системы обмена сообщениями Microsoft Exchange на одном компьютере, то создавать пул доверенных приложений для Outlook Web App не требуется. (Здесь подразумевается, что на соответствующем сервере размещается абонентская группа единой системы обмена сообщениями SipName.) Если вы используете один компьютер для размещения обеих этих служб, то можете сразу перейти к разделу с заголовком **Включение обмена мгновенными сообщениями в Outlook Web App**.

Lync Server 2013 может выполнять автообнаружение любых серверов Exchange, на которых размещается абонентская группа единой системы обмена сообщениями SipName; такие серверы автоматически добавляются в список известных серверов Lync Server. Таким образом, не нужно создавать пул доверенных приложений и добавлять эти серверы в список известных серверов. Фактически это приведет к тому, что интеграция Outlook Web App перестанет работать.

> [!NOTE]  
> Все это вызвано тем фактом, что топология Lync Server будет иметь две записи для одного компьютера: запись автообнаружения и запись, добавленная вручную. Чтобы устранить данную проблему и восстановить работоспособность Outlook Web App, удалите доверенный пул и записи доверенных приложений для этого сервера с помощью Windows PowerShell. Дополнительные сведения см. в разделах справки по командлетам <a href="https://docs.microsoft.com/en-us/powershell/module/skype/Remove-CsTrustedApplicationPool">Remove-CsTrustedApplicationPool</a> и <a href="https://docs.microsoft.com/en-us/powershell/module/skype/Remove-CsTrustedApplication">Remove-CsTrustedApplication</a>.

Если две этих службы выполняются на разных компьютерах, после установки среды выполнения Unified Communications Managed API 4.0 необходимо создать пул доверенных приложений Lync Server и доверенное приложение, связанное с Outlook Web App; в результате сервер добавляется в список известных серверов. Для этого сначала выполните в командной консоли Командная консоль Lync Server следующую команду:

    New-CsTrustedApplicationPool -Identity atl-owa-001.litwareinc.com -Registrar atl-cs-001.litwareinc.com -Site Redmond -RequiresReplication $False

В приведенной выше команде atl-owa-001.litwareinc.com является полным доменным именем пула Outlook Web App; это же имя должно отображаться в полях имени субъекта и альтернативного имени субъекта (SAN) сертификата, обеспечивающего доступ к Outlook Web App. Аналогично atl-cs-001.litwareinc.com является полным доменным именем пула Lync Server 2013, в котором будет размещаться новый пул доверенных приложений. Обратите также внимание, что указанный сайт Redmond представляет значение SiteID сайта Lync Server. Значение SiteID не обязательно равно отображаемому имени сайта; можно получить идентификаторы SiteID для сайтов Lync Server, выполнив следующую команду в командной консоли Командная консоль Lync Server:

    Get-CsSite | Select-Object DisplayName, SiteID

После создания пула доверенных приложений используйте команду, аналогичную приведенной ниже, для настройки удостоверения приложения и порта для Outlook Web App:

    New-CsTrustedApplication -ApplicationId OutlookWebApp -TrustedApplicationPoolFqdn atl-owa-001.litwareinc.com  -Port 5199

В предыдущей команде значение ApplicationID являлось простым и понятным идентификатором, используемым для разграничения доверенных приложений. Значением ApplicationID может являться любая текстовая строка, которая не содержит пробелов и других запрещенных символов. (Чтобы создать допустимый идентификатор, при определении ApplicationId рекомендуется использовать только буквы и цифры.) Значение, назначенное параметру порта, также оставляется на выбор администратора; может использоваться любой доступный сетевой порт.

После создания доверенного приложения необходимо запустить следующую команду, чтобы включить изменения в топологии Lync Server:

    Enable-CsTopology

Помните о том, что нужно также добавить сервер почтовых ящиков и клиентский доступ Exchange во все абонентские группы URI для SIP. В результате серверы будут настроены в качестве доверенных участников SIP-сеанса с топологией ExUmRouting для Lync Server.

**Включение обмена мгновенными сообщениями в Outlook Web App**

При правильной настройке Lync Server можно начать настройку Outlook Web App. Первым шагом является включение обмена мгновенными сообщениями во всех виртуальных каталогах Outlook Web App на серверах переднего плана. (При этом для виртуальных каталогов на внутренних серверах включать обмен мгновенными сообщениями не требуется и даже не рекомендуется.) Обмен мгновенными сообщениями можно включить на серверах клиентского доступа, выполнив в командной консоли Exchange следующие команды:

    Get-OwaVirtualDirectory | Set-OwaVirtualDirectory -InstantMessagingEnabled $True -InstantMessagingType OCS

> [!NOTE]  
> По умолчанию обмен мгновенными сообщениями включается при установке Outlook Web App, то есть когда для свойства InstantMessagingEnabled задается значение True. Однако вам все равно следует выполнить предыдущую команду, чтобы установить для обмена мгновенными сообщениями тип OCS. По умолчанию для InstantMessagingType установлено значение None.

Затем необходимо добавить две следующие строки в файл web.config, относящийся к Outlook Web App (обычно этот файл размещается локально в папке C:\\Program Files\\Microsoft\\Exchange Server\\V15\\ClientAccess\\Owa):

    <add key="IMCertificateThumbprint" value="EA5A332496CC05DA69B75B66111C0F78A110D22d"/>
    <add key="IMServerName" value="atl-cs-001.litwareinc.com"/>

В предыдущем примере значение IMCertificateThumbprint должно быть равным отпечатку сертификата Exchange 2013, установленного на ваших внутренних серверах. Вы можете получить эти сведения, выполнив в командной консоли Exchange следующую команду:

    Get-ExchangeCertificate

Обратите внимание и на то, что значение, назначенное IMServerName, является полным доменным именем пула Lync Server, где был создан пул доверенных приложений для Outlook Web App.

Сертификат, используемый для Outlook Web App, должен являться доверенным сертификатом для Lync Server. Один из способов убедиться, что сертификат является доверенным как для Lync Server, так и для Exchange, заключается в использовании внутреннего центра сертификации для создания сертификата на сервере почтовых ящиков; при этом следует убедиться, что полное доменное имя сервера используется для имени субъекта, а также отображается в поле альтернативного имени сертификата. После создания сертификат можно импортировать на внутренние серверы. В итоге один сертификат используется для достижения двух целей: 1) взаимодействия между единой системой обмена сообщениями Exchange и Lync Server; и 2) интеграции между Outlook Web App и Lync Server.

После обновления файла Web.config необходимо выполнить приведенную ниже команду на внутреннем сервере Exchange, чтобы перезапустить пул Outlook Web App:

    C:\Windows\System32\Inetsrv\Appcmd.exe recycle apppool /apppool.name:"MSExchangeOWAAppPool"

Если операция по перезапуску успешно завершена, в командной консоли Exchange появится следующее сообщение:

    "MSExchangeOWAAppPool" successfully recycled

**Настройка политик почтовых ящиков Outlook Web App**

На этом этапе можно использовать приведенную ниже команду в целях настройки обмена мгновенными сообщениями посредством подходящей политики почтовых ящиков (или нескольких таких политик) Outlook Web App. Например, при запуске на одном из серверов почтовых ящиков данная команда включает обмен мгновенными сообщениями для политики по умолчанию:

    Set-OwaMailboxPolicy -Identity "Default" -InstantMessagingEnabled $True -InstantMessagingType "OCS"

А эта команда включает обмен мгновенными сообщениями для всех политик почтовых ящиков Outlook Web App:

    Get-OwaMailboxPolicy | Set-OwaMailboxPolicy -InstantMessagingEnabled $True -InstantMessagingType "OCS"

После включения политики почтовых ящиков все пользователи, управляемые этой политикой, будут полностью интегрированы в Lync Server и Outlook Web App при соблюдении приведенных ниже условий.

  - Пользователь имеет почтовый ящик в Exchange 2013.

  - Пользователь был включен для Lync Server 2013.

  - Пользователь имеет допустимый прокси-адрес SIP.

**Отключение обмена мгновенными сообщениями в Outlook Web App**

Как уже было отмечено ранее, по умолчанию обмен мгновенными сообщениями в Outlook Web App включен. Таким образом, если вы не интегрируете Outlook Web App в Lync Server, пользователи будут видеть пустые значки присутствия и сообщения об ошибке при каждом входе в Outlook Web App. Чтобы предотвратить возникновение данной проблемы, воспользуйтесь следующей командой командной консоли Exchange для отключения обмена мгновенными сообщениями в Outlook Web App:

    Get-OwaVirtualDirectory | Set-OwaVirtualDirectory -InstantMessagingEnabled $False

**Проверка интеграции с Outlook Web App**

Чтобы проверить интеграцию функций обмена мгновенными сообщениями и присутствия в Outlook Web App, выполните вход в Outlook Web App 2013. В правом верхнем углу экрана появится ваше отображаемое имя Exchange. Если рядом с вашим именем отображается значок присутствия (например, значок зеленого цвета, обозначающий ваше текущее состояние "Доступен"), значит вы успешно осуществили интеграцию Lync Server и Outlook Web App.

После первоначального входа в Outlook Web App проверьте, было ли событие с идентификатором 112 (и исходное событие MSExchange OWA) записано в журнал событий на сервере почтовых ящиков. Это событие указывает на то, что диспетчер конечных точек обмена мгновенными сообщениями успешно инициализирован. Если обмен мгновенными сообщениями не работает, найдите файлы журналов в папке C:\\Program Files\\Microsoft\\Exchange server\\V15\\Logging\\OWA\\InstantMessaging на сервере почтовых ящиков. Если папка Logging или InstantMessaging отсутствует, значит произошел сбой интеграции. В этом случае вы можете воспользоваться трассировкой SIPStack в Lync Server (все уровни и все флаги), чтобы попытаться установить причину сбоя.

