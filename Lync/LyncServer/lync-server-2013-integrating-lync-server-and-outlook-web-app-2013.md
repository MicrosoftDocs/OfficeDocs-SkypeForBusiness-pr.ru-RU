---
title: 'Lync Server 2013: интеграция Lync Server и Outlook Web App 2013'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
TOCTitle: Integrating Lync Server 2013 and Outlook Web App 2013
ms:assetid: 513d4cc7-aa87-4f68-b99d-d58b63bdf242
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ688055(v=OCS.15)
ms:contentKeyID: 49733649
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 31a25e1d0a6410171201af578d6b28f496468e06
ms.sourcegitcommit: bb53f131fabb03a66f0d000f8ba668fbad190778
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2019
ms.locfileid: "34833985"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="integrating-microsoft-lync-server-2013-and-microsoft-outlook-web-app-2013"></a>Интеграция Microsoft Lync Server 2013 и Microsoft Outlook Web App 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Тема последнего изменения:** 2013-02-03_

Помимо интеграции с Microsoft Outlook 2013, Microsoft Lync Server 2013 может быть полностью интегрирован с Microsoft Outlook Web App 2013. Помимо прочего, это позволяет добавить в Outlook Web App мгновенные сообщения и сведения о присутствии, а затем предоставить общий доступ к Объединенному списку контактов между Outlook Web App и Microsoft Lync 2013. Чтобы интегрировать Lync Server 2013 и Outlook Web App, необходимо сначала убедиться, что на внутреннем сервере Microsoft Exchange Server 2013 установлен интерфейс API единой системы обмена сообщениями 4,0. Для этого достаточно проверить наличие следующего значения реестра:

Система\_\\hKey\_для\\локального компьютера\\куррентконтролсет\\Services мсексчанже\\OWA\\инстантмессагинг имплементатиондллпас

Значение ImplementationDLLPath должно указывать расположение папки с файлом Microsoft.Rtc.Internal.Ucweb.dll. Если это не так или значение реестра не существует, необходимо скачать и установить программу установки среды выполнения УКМА из центра загрузки Майкрософт по адресу <http://www.microsoft.com/en-us/download/details.aspx?id=34992>. Инструкции по установке среды выполнения UCMA приведены на той же веб-странице.

**Обратная совместимость**

Lync Server 2013 можно интегрировать с версиями единой системы обмена сообщениями и Outlook Web App в Microsoft Exchange Server 2010. Дополнительные сведения можно найти в статье Развертывание локальной единой системы обмена сообщениями Exchange для предоставления голосовой почты Lync Server 2010 [http://technet.microsoft.com/en-us/library/gg398768.aspx](lync-server-2013-deploying-on-premises-exchange-um-to-provide-lync-server-2013-voice-mail.md)по адресу. Если вы интегрируется с Exchange 2010, у вас нет специфических функций Lync Server, таких как единое хранилище контактов и архивирование из Lync в Exchange.

Microsoft Lync 2013 также можно использовать в сочетании с Exchange 2010 и Outlook 2010. Тем не менее, новые функции, такие как единое хранилище контактов и фотографии высокого разрешения, не будут доступны для пользователей Lync 2013. Для этих новых возможностей требуется как Lync Server 2013, так и Exchange 2013.

**Создание пула доверенных приложений для Outlook Web App**

Если вы установили службу маршрутизатора для единой системы обмена сообщениями Microsoft Exchange и служба единой системы обмена сообщениями Microsoft Exchange на том же компьютере, вам не нужно создавать доверенную группу приложений для Outlook Web App. (Предполагается, что на сервере размещается абонентская группа Сипнаме UM). Если вы используете один компьютер для размещения обоих этих служб, вы можете перейти к разделу этого документа с названием **Включение функции обмена мгновенными сообщениями в Outlook Web App**.

Lync Server 2013 может выключать любые серверы Exchange, на которых размещена абонентская группа UM Сипнаме; Эти серверы автоматически добавляются в список известных серверов Lync Server. Создавать пул доверенных приложений и добавлять эти серверы к списку известных серверов вручную не требуется. Более того, такие действия приводят к нарушению взаимодействия с Outlook Web App.

<div>


> [!NOTE]  
> Это обусловлено тем, что топология Lync Server теперь содержит две записи для одного и того же компьютера: автоматически обнаруживаемый элемент и добавленный вручную элемент. Для устранения неполадки и восстановления работоспособности Outlook Web App следует с помощью Windows PowerShell удалить доверенный пул и записи доверенных приложений для этого сервера. Дополнительные сведения см. в разделах справки по командлетам <A href="https://docs.microsoft.com/powershell/module/skype/Remove-CsTrustedApplicationPool">Remove-CsTrustedApplicationPool</A> и <A href="https://docs.microsoft.com/powershell/module/skype/Remove-CsTrustedApplication">Remove-CsTrustedApplication</A>.



</div>

Если эти две службы запущены на разных компьютерах, после того как вы убедитесь в том, что на компьютере установлено приложение интегрированной среды выполнения API 4,0, необходимо создать доверенный пул приложений Lync Server и доверенное приложение, связанное с Outlook Web App; будет добавлен сервер в список известных серверов. Для этого сначала выполните в командной консоли Lync Server следующую команду:

    New-CsTrustedApplicationPool -Identity atl-owa-001.litwareinc.com -Registrar atl-cs-001.litwareinc.com -Site Redmond -RequiresReplication $False

В приведенной выше команде atl-owa-001.litwareinc.com — полное доменное имя пула Outlook Web App; это же имя должно отображаться в полях имени субъекта и альтернативного имени субъекта (SAN) сертификата, обеспечивающего доступ к Outlook Web App. Точно так же atl-cs-001.litwareinc.com — это полное доменное имя пула Lync Server 2013, на котором будет размещен новый доверенный пул приложений. Обратите внимание, что указанный сайт "Redmond" представляет сайт сайта Lync Server. Идентификатор сайта — это не обязательно тот же отображаемый элемент; Вы можете получить Ситеидс для сайтов Lync Server, выполнив в командной консоли Lync Server следующую команду:

    Get-CsSite | Select-Object DisplayName, SiteID

После создания пула доверенных приложений используйте команду, аналогичную приведенной ниже, для настройки удостоверения приложения и порта для Outlook Web App:

    New-CsTrustedApplication -ApplicationId OutlookWebApp -TrustedApplicationPoolFqdn atl-owa-001.litwareinc.com  -Port 5199

В предыдущей команде значение ApplicationID являлось простым и понятным идентификатором, используемым для разграничения доверенных приложений. Значением ApplicationID может являться любая текстовая строка, которая не содержит пробелов и других запрещенных символов. (Чтобы создать допустимый идентификатор, при определении ApplicationId рекомендуется использовать только буквы и цифры.) Значение, назначенное параметру порта, также оставляется на выбор администратора; может использоваться любой доступный сетевой порт.

После создания надежного приложения необходимо выполнить следующую команду, чтобы включить изменения в топологии Lync Server.

    Enable-CsTopology

Обратите внимание, что необходимо также добавить сервер клиентского доступа и почтового ящика ко всем абонентам SIP URI. В свою очередь, они будут настраивать серверы как доверенные одноранговые модули SIP с помощью топологии Ексумраутинг для Lync Server.

**Включение обмена мгновенными сообщениями в Outlook Web App**

После правильной настройки Lync Server вы можете приступить к настройке Outlook Web App. Первый этап этого процесса — включить обмен мгновенными сообщениями во всех виртуальных каталогах Outlook Web App на серверах переднего плана. (Не нужно включать обмен мгновенными сообщениями для виртуальных каталогов на внутренних серверах. На самом деле не рекомендуется включать функцию обмена мгновенными сообщениями на внутренних серверах.) Вы можете включить функцию обмена мгновенными сообщениями на серверах клиентского доступа, выполнив следующую команду в командной консоли Exchange:

    Get-OwaVirtualDirectory | Set-OwaVirtualDirectory -InstantMessagingEnabled $True -InstantMessagingType OCS

<div>


> [!NOTE]  
> По умолчанию обмен мгновенными сообщениями включается при установке Outlook Web App, то есть когда для свойства InstantMessagingEnabled задается значение True. Однако вам все равно следует выполнить предыдущую команду, чтобы установить для обмена мгновенными сообщениями тип OCS. По умолчанию для InstantMessagingType установлено значение None.



</div>

Затем вы должны добавить следующие две строки в файл Outlook Web App Web. config (этот файл обычно находится в\\папке C: Program Files\\Microsoft\\Exchange Server\\V15\\клиентакцесс\\OWA). Эти две строки нужно добавить под узлом \<appSettings\> в файле Web. config, и эта процедура должна выполняться только на внутренних серверах, где установлено приложение Outlook Web App.

    <add key="IMCertificateThumbprint" value="EA5A332496CC05DA69B75B66111C0F78A110D22d"/>
    <add key="IMServerName" value="atl-cs-001.litwareinc.com"/>

В предыдущем примере значение параметра Имцертификатесумбпринт должно представлять собой отпечаток сертификата Exchange 2013, установленного на серверных серверах. Вы можете получить эти сведения, выполнив следующую команду в командной консоли Exchange:

    Get-ExchangeCertificate

Обратите внимание, что значение, присвоенное параметру ServerName, — это полное доменное имя пула Lync Server, в котором вы создали доверенный пул приложений для Outlook Web App.

Сертификат, используемый для Outlook Web App, должен быть сертификатом, который является надежным для сервера Lync Server. Один из способов удостовериться, что сертификат будет надежно установлен как в Lync Server, так и в Exchange, — использовать внутренний центр сертификации для создания сертификата на сервере почтовых ящиков, что гарантирует использование полного доменного имени сервера и его полное доменное имя в t поле альтернативное имя сертификата. После создания сертификата его можно импортировать на внутренние серверы. Конечный результат состоит в том, что один и тот же сертификат используется в двух целях: 1) обмен данными между единой системой обмена сообщениями Exchange и Lync Server; и 2) интеграция между Outlook Web App и Lync Server.

После обновления файла Web. config для перезапуска пула Outlook Web App необходимо выполнить следующую команду на сервере внутреннего сервера Exchange:

    C:\Windows\System32\Inetsrv\Appcmd.exe recycle apppool /apppool.name:"MSExchangeOWAAppPool"

Если операция перезапуска была выполнена успешно, в командной консоли Exchange появится следующее сообщение:

    "MSExchangeOWAAppPool" successfully recycled

**Настройка политик почтовых ящиков Outlook Web App**

На этом этапе можно использовать приведенную ниже команду в целях настройки обмена мгновенными сообщениями посредством подходящей политики почтовых ящиков (или нескольких таких политик) Outlook Web App. Например, при запуске на одном из серверов почтовых ящиков данная команда включает обмен мгновенными сообщениями для политики по умолчанию:

    Set-OwaMailboxPolicy -Identity "Default" -InstantMessagingEnabled $True -InstantMessagingType "OCS"

А эта команда включает обмен мгновенными сообщениями для всех политик почтовых ящиков Outlook Web App:

    Get-OwaMailboxPolicy | Set-OwaMailboxPolicy -InstantMessagingEnabled $True -InstantMessagingType "OCS"

После включения политики почтовых ящиков все пользователи, которым управляет эта политика, получат полную интеграцию между Lync Server и Outlook Web App, при условии что:

  - У пользователя есть почтовый ящик в Exchange 2013.

  - У пользователя установлен сервер Lync Server 2013.

  - Пользователь имеет допустимый прокси-адрес SIP.

**Отключение обмена мгновенными сообщениями в Outlook Web App**

Как было отмечено ранее, по умолчанию в Outlook Web App включен обмен мгновенными сообщениями. Это означает, что если вы не интегрирует Outlook Web App с Lync Server, пользователи увидят пустой значок присутствия и сообщение об ошибке при каждом входе в Outlook Web App. Чтобы избежать этой проблемы, используйте следующую команду командной консоли Exchange, чтобы отключить функцию обмена мгновенными сообщениями в Outlook Web App.

    Get-OwaVirtualDirectory | Set-OwaVirtualDirectory -InstantMessagingEnabled $False

**Проверка интеграции с Outlook Web App**

Для проверки интеграции обмена мгновенными сообщениями и индикации присутствия с Outlook Web App войдите в Outlook Web App 2013. В правом верхнем углу экрана появляется отображаемое имя Exchange. Если рядом с вашим именем есть значок присутствия (например, зеленый значок, указывающий на то, что ваше текущее состояние доступно), указывающий на то, что вы успешно интегрированы с Lync Server и Outlook Web App.

После первого входа в Outlook Web App проверьте, записано ли событие с идентификатором 112 (и исходное событие MSExchange OWA) в журнал событий на сервере почтовых ящиков. Это событие указывает на успешную инициализацию диспетчера конечных точек обмена мгновенными сообщениями. Если обмен мгновенными сообщениями не работает, то на сервере почтовых ящиков найдите файлы журнала в папке\\C: Program Files\\Microsoft\\Exchange Server\\V15\\ведения\\журнала\\OWA инстантмессагинг. Если папка Logging или InstantMessaging отсутствует, интеграция не настроена. В этом случае вы можете использовать трассировку Сипстакк на Lync Server (все уровни и все флаги), чтобы проверить, почему интеграция завершилась сбоем.

</div>

<span> </span>

</div>

</div>

</div>

