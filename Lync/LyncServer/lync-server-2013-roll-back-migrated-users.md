---
title: 'Lync Server 2013: откат перенесенных пользователей'
TOCTitle: Откат перенесенных пользователей
ms:assetid: bfabaf0b-9a42-4057-b729-a7ab9eee8c72
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ205224(v=OCS.15)
ms:contentKeyID: 49311047
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Откат перенесенных пользователей в Lync Server 2013

 

_**Дата изменения раздела:** 2012-10-07_

Если требуется откатить функцию универсального хранилища контактов, выполняйте откат контактов только в том случае, если вы перемещаете пользователя обратно в Exchange 2010 или Lync Server 2010. Для выполнении отката отключите политику для пользователя, а затем выполните командлет **Invoke-CsUcsRollback**. Выполнения одного командлета **Invoke-CsUcsRollback**недостаточно для обеспечения постоянного отката, поскольку если политика не отключена, то миграция универсального хранилища контактов будет инициирована повторно. Например, если откат пользователя выполняется из-за отката Exchange 2013 до Exchange 2010, а затем выполняется перемещение почтового ящика пользователя в Exchange 2013, то миграция универсального хранилища контактов будет выполнена повторно через 7 дней после отката, поскольку универсальное хранилище контактов еще включено для пользователя в политике служб пользователя.

> [!IMPORTANT]  
> Командлет <strong>Move-CsUser</strong> автоматически выполняет откат хранилища контактов пользователя из Exchange 2013 в Lync Server 2013 в следующих ситуациях:
> <ul><li><p>когда пользователи перемещаются из Lync Server 2013 в Lync Server 2010;</p></li>
> <li><p>когда пользователи перемещаются распределенно, например когда пользователь перемещается из Skype для бизнеса Online в Lync Server 2013 локально или наоборот.</p></li>
</ul>


> [!IMPORTANT]  
> Импорт данных универсального хранилища контактов из резервной копии базы данных может привести к повреждению данных универсального хранилища контактов и пользовательских данных, если режим универсального хранилища контактов изменится с экспорта на импорт. Пример:
> <ul><li><p>Если вы экспортируете списки контактов до миграции контактов пользователей на сервер Exchange 2013, а затем, после миграции, импортируете эти же данные, то данные универсального хранилища контактов и списки контактов будут повреждены.</p></li>
> <li><p>Если вы экспортируете пользовательские данные после миграции пользователей на сервер Exchange 2013, выполняете откат миграции и затем по некоторым причинам импортируете данные после миграции, то данные универсального хранилища контактов и списки контактов будут повреждены.</p></li></ul>


> [!IMPORTANT]
> Перед перемещением почтового ящика Exchange из Exchange 2013 в Exchange 2010 администратор Exchange должен убедиться, что администратор Lync Server выполнил откат контактов пользователей Lync Server с Exchange 2013 до Lync Server. Сведения об откате контактов универсального хранилища контактов до Lync Server см. в процедуре &quot;Откат контактов универсального хранилища контактов с Exchange 2013 до Lync Server 2013&quot; этого раздела.


В следующей процедуре описывается откат контактов пользователей. Если вы используете командлет **Move-CsUser** для перемещения пользователей между Lync Server 2013 и Lync Server 2010, то можете пропустить эти действия, поскольку командлет **Move-CsUser** автоматически выполняет откат универсального хранилища контактов при перемещении пользователей из Lync Server 2013 в Lync Server 2010. Командлет **Move-CsUser** не отключает политику универсального хранилища контактов, поэтому миграция в универсальное хранилище контактов будет повторяться, если пользователь вернется в Lync Server 2013.

## Откат контактов пользователей с Lync Server 2013 до Lync Server 2010

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Чтобы предотвратить повторную миграцию после отката, отключите универсальное хранилище контактов для пользователей, к которым применяется операция отката. (Выполните это действие только в том случае, если хотите убедиться, что в будущем не будет выполнена повторная миграция пользователей.) Чтобы отключить универсальное хранилище контактов для отдельных пользователей, введите в командной строке следующую команду:
    
        Set-CsUserServicesPolicy -Identity "<policy name>" -UcsAllowed $False
    
    Например:
    
        Set-CsUserServicesPolicy -Identity "UCS Enabled Users" -UcsAllowed $False

3.  Перед перемещением пользователя с сервера Lync Server 2013 на сервер Lync Server 2010 выполните откат списка собеседников для указанных пользователей на Lync Server.
    
    > [!IMPORTANT]
    > Если этот шаг пропущен, список собеседников будет утерян.


4.  Выполните откат требуемых пользователей. В командной строке введите:
    
        Invoke-CsUcsRollback -Identity "<user display name>"
    
    Например:
    
        Invoke-CsUcsRollback -Identity "Ken Myer"
    
    > [!IMPORTANT]
    > Не рекомендуется использовать параметр –Force для принудительного отката. При использовании этого параметра контакты пользователей будут утеряны.


## Откат контактов универсального хранилища контактов с Exchange 2013 до Lync Server 2013

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Чтобы предотвратить повторную миграцию после отката, отключите универсальное хранилище контактов для пользователей, к которым применяется операция отката. Чтобы отключить универсальное хранилище контактов для отдельных пользователей, введите в командной строке следующий командлет:
    
        Set-CsUserServicesPolicy -Identity "<policy name>" -UcsAllowed $False
    
    Например:
    
        Set-CsUserServicesPolicy -Identity "UCS Enabled Users" -UcsAllowed $False

3.  Выполните откат требуемых пользователей. В командной строке введите:
    
        Invoke-CsUcsRollback -Identity "<user display name>"
    
    Например:
    
        Invoke-CsUcsRollback -Identity "Ken Myer"
    
    > [!IMPORTANT]
    > Сначала необходимо выполнить откат пользователя Lync Server, а затем переместить почтовый ящик Exchange 2013. Для администратора Exchange откат будет заблокирован до тех пор, пока не завершится откат Lync Server. Не рекомендуется использовать параметр Force для выполнения принудительного отката. При использовании этого параметра контакты пользователей будут утеряны.


4.  После отката пользователя до Lync Server администратор Exchange сможет откатить пользователя Exchange с Exchange 2013 до Exchange 2010.

