---
title: 'Lync Server 2013: откат перенесенных пользователей'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Roll back migrated users
ms:assetid: bfabaf0b-9a42-4057-b729-a7ab9eee8c72
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ205224(v=OCS.15)
ms:contentKeyID: 48185286
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: deda1ec30ef5267acd8b3826b77077e7902d98e4
ms.sourcegitcommit: 4d6bf5c58b2c553dc1df8375ede4a9cb9eaadff2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2020
ms.locfileid: "48511266"
---
# <a name="roll-back-migrated-users-in-lync-server-2013"></a>Откат перенесенных пользователей в Lync Server 2013

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">



</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2012-10-07_

Если необходимо выполнить откат единой системы хранения контактов, выполните откат контактов только в том случае, если пользователь перемещается обратно в Exchange 2010 или Lync Server 2010. Для выполнении отката отключите политику для пользователя, а затем выполните командлет **Invoke-CsUcsRollback**. Выполнения одного командлета **Invoke-CsUcsRollback**недостаточно для обеспечения постоянного отката, поскольку если политика не отключена, то миграция универсального хранилища контактов будет инициирована повторно. Например, если пользователь выполняет откат, так как Exchange 2013 возвращается в Exchange 2010, а почтовый ящик пользователя перемещается в Exchange 2013, то процесс миграции единого хранилища контактов будет начат за семь дней после отката до тех пор, пока единое хранилище контактов остается включенным для пользователя в политике служб пользователей.

<div>


> [!IMPORTANT]  
> Командлет <STRONG>Move – CsUser</STRONG> автоматически выполняет откат хранилища контактов пользователя из Exchange 2013 к Lync Server 2013 в следующих ситуациях: 
> <UL>
> <LI>
> <P>При перемещении пользователей из Lync Server 2013 в Lync Server 2010.</P>
> <LI>
> <P>При переносе локальных пользователей, например, когда пользователь перемещается из Lync Online в локальную среду Lync Server 2013 или наоборот.</P></LI></UL>



</div>

<div>


> [!IMPORTANT]  
> Импорт данных универсального хранилища контактов из резервной копии базы данных может привести к повреждению данных универсального хранилища контактов и пользовательских данных, если режим универсального хранилища контактов изменится с экспорта на импорт. Пример: 
> <UL>
> <LI>
> <P>Если вы экспортируете списки контактов перед тем, как контакты пользователей будут перенесены в Exchange 2013, а затем, после миграции, будут повреждены данные и списки контактов в едином хранилище контактов.</P>
> <LI>
> <P>Если вы экспортируете данные о проходе после миграции пользователей в Exchange 2013, выполните откат миграции, а затем по каким – либо причинам вы импортируете данные из после миграции, данные в едином хранилище контактов и списки контактов будут повреждены.</P></LI></UL>



</div>

<div>


> [!IMPORTANT]  
> Перед перемещением почтового ящика Exchange из Exchange 2013 в Exchange 2010 администратор Exchange должен убедиться в том, что администратор сервера Lync Server выполнил откат контактов пользователя Lync Server из Exchange 2013 в Lync Server. Чтобы откатить контакты универсального хранилища контактов в Lync Server, ознакомьтесь с разделом "откатить контакты универсального хранилища контактов из Exchange 2013 в Lync Server 2013" Далее в этом разделе.



</div>

В следующей процедуре описывается откат контактов пользователей. Если вы используете командлет **Move-CsUser** для перемещения пользователей между lync Server 2013 и Lync Server 2010, вы можете пропустить эти действия, так как командлет **Move-CsUser** автоматически выполняет откат хранилища контактов унифед при перемещении пользователей из Lync Server 2013 в Lync Server 2010. **Move-CsUser** не отключает политику универсального хранилища контактов, поэтому миграция в единое хранилище контактов повторяется, если пользователь перемещается обратно в Lync Server 2013.

<div>

## <a name="to-roll-back-user-contacts-from-lync-server-2013-to-lync-server-2010"></a>Откат контактов пользователей с Lync Server 2013 до Lync Server 2010

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Чтобы предотвратить повторную миграцию после отката, отключите универсальное хранилище контактов для пользователей, к которым применяется операция отката. (Выполните это действие только в том случае, если хотите убедиться, что в будущем не будет выполнена повторная миграция пользователей.) Чтобы отключить универсальное хранилище контактов для отдельных пользователей, введите в командной строке следующую команду:
    
        Set-CsUserServicesPolicy -Identity "<policy name>" -UcsAllowed $False
    
    Пример:
    
        Set-CsUserServicesPolicy -Identity "UCS Enabled Users" -UcsAllowed $False

3.  Перед перемещением пользователя из Lync Server 2013 в Lync Server 2010 выполните откат списка контактов для указанных пользователей на Lync Server.
    
    <div>
    

    > [!IMPORTANT]  
    > Если этот шаг пропущен, список собеседников будет утерян.

    
    </div>

4.  Выполните откат требуемых пользователей. В командной строке введите:
    
        Invoke-CsUcsRollback -Identity "<user display name>"
    
    Пример:
    
        Invoke-CsUcsRollback -Identity "Ken Myer"
    
    <div>
    

    > [!IMPORTANT]  
    > Не рекомендуется использовать параметр –Force для принудительного отката. При использовании этого параметра контакты пользователей будут утеряны.

    
    </div>

</div>

<div>

## <a name="to-roll-back-unified-contact-store-contacts-from-exchange-2013-to-lync-server-2013"></a>Откат контактов универсального хранилища контактов из Exchange 2013 в Lync Server 2013

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Чтобы предотвратить повторную миграцию после отката, отключите универсальное хранилище контактов для пользователей, к которым применяется операция отката. Чтобы отключить универсальное хранилище контактов для отдельных пользователей, введите в командной строке следующий командлет:
    
        Set-CsUserServicesPolicy -Identity "<policy name>" -UcsAllowed $False
    
    Пример:
    
        Set-CsUserServicesPolicy -Identity "UCS Enabled Users" -UcsAllowed $False

3.  Выполните откат требуемых пользователей. В командной строке введите:
    
        Invoke-CsUcsRollback -Identity "<user display name>"
    
    Пример:
    
        Invoke-CsUcsRollback -Identity "Ken Myer"
    
    <div>
    

    > [!IMPORTANT]  
    > Необходимо сначала вернуть пользователя Lync Server, а затем переместить почтовый ящик Exchange 2013. Администратор Exchange блокирует откат Exchange до завершения отката Lync Server. Не рекомендуется использовать параметр Force для выполнения принудительного отката. При использовании этого параметра контакты пользователей будут утеряны.

    
    </div>

4.  После отката пользователя до Lync Server администратор Exchange может выполнить откат пользователя Exchange с Exchange 2013 на сервер Exchange 2010.

</div>

</div>

<span> </span>

</div>

</div>

</div>

