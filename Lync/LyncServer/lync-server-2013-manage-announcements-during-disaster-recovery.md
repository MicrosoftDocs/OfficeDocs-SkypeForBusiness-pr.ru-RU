---
title: 'Lync Server 2013: управление оповещениями во время аварийного восстановления'
TOCTitle: Управление оповещениями во время аварийного восстановления
ms:assetid: c33e51ea-421f-42d2-826b-b73968f6bd5b
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ721874(v=OCS.15)
ms:contentKeyID: 49888174
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Управление оповещениями во время аварийного восстановления в Lync Server 2013

 

_**Дата изменения раздела:** 2013-02-23_

Lync Server 2013 поддерживает оповещения о звонках на не назначенные номера во время отказов. Восстановление функциональности оповещений во время отказа не является обязательным. Если вы выбираете восстановление оповещений во время отказа, то необходимо пересоздать конфигурацию оповещений в резервном пуле. В этом разделе описываются действия, которые необходимо выполнить для восстановления оповещений при аварийном восстановлении.

Этот раздел относится к диапазонам не назначенных номеров, которые используют приложение "Объявление" и не относится к диапазонам не назначенных номеров, которые используют автосекретарь единой системы обмена сообщениями Exchange.

## До отказа

Независимо от того, выбирается ли использование оповещений во время отказов, следует взять отдельные резервные копии всех настроенных звуковых файлов, настроенных для приложения "Объявление". Резервное копирование настроенных оповещений не выполняется в рамках процесса аварийного восстановления Lync Server. Если не взять отдельные резервные копии файлов, и файлы, отправленные на сервер или в пул, будут повреждены, испорчены или очищены, то они будут потеряны.

Если у вас нет резервных копий настроенных звуковых файлов, и исходные звуковые файлы стали недоступны, то звуковые файлы, настроенные для приложения "Объявление", можно найти в хранилище файлов для сервера или пула, куда эти файлы изначально импортировались. Можно скопировать все звуковые файлы, настроенные для приложения "Объявление", из этого хранилища файлов.

**Копирование аудиофайлов из файлового хранилища**

1.  В командной строке выполните следующую команду:
    
        Xcopy <Source: Pool Announcement Service File Store path> <Destination>
    
    Например:
    
        Xcopy "<Pool File Store Path>\X-ApplicationServer-X\AppServerFiles\RGS\AS" "<Destination: Backup location>"
    
    Здесь X-ApplicationServer-X ссылается на идентификатор службы сервера приложений пула (например, 1-ApplicationServer-1")


## Во время отказа

Чтобы использовать приложение "Объявление" во время отказа, необходимо пересоздать конфигурацию оповещений в резервном пуле, выполнив задачи, описываемые в этом разделе.

> [!NOTE]  
> Рекомендуется выполнять эти задачи после перехода резервный пул при отказе, поскольку после выполнения действия 2 резервный пул становится владельцем диапазонов не назначенных номеров.

> [!NOTE]  
> Для диапазонов номеров, использующих телефонный номер автосекретаря единой системы обмена сообщениями Exchange, выполнение этих действий не требуется.

**Пересоздание конфигурации оповещений в резервном пуле**

1.  Пересоздайте в резервном пуле оповещения, развернутые в основном пуле, выполнив следующие действия.
    
    1.  Импортируйте все звуковые файлы, используемые в основном пуле, в резервный пул с помощью командлета **Import-CsAnnouncementFile**, указав резервный пул в параметре Parent.
    
    2.  Пересоздайте каждое оповещение с помощью командлета **New-CsAnnouncement**, указав резервный пул в параметре Parent.
    
    > [!NOTE]  
    > Подробные сведения об использовании этих параметров для создания оповещений в резервном пуле см. в статье <a href="lync-server-2013-create-an-announcement.md">Создание объявления в Lync Server 2013</a>.

2.  После пересоздания всех оповещений в резервном пуле перенаправьте все диапазоны не назначенных номеров, использующие оповещения в основном пуле, к пересозданным оповещениям в резервном пуле.
    
    Для каждого диапазона не назначенных номеров, использующего оповещение из основного пула, выполните следующую команду:
    
        Set-CsUnassignedNumber -Identity "<name of number range>" -AnnouncementService "<FQDN of backup pool>" -AnnouncementName "<announcement name in backup pool>"

## После отказа

Когда основной пул станет доступным, необходимо перенаправить диапазоны не назначенных номеров, измененные при отказе, обратно в основной пул.

> [!NOTE]  
> Для диапазонов номеров, использующих телефонный номер автосекретаря единой системы обмена сообщениями Exchange, выполнение этих действий не требуется.

**Восстановление оповещений в основном пуле**

1.  Если пришлось перестроить основной пул во время восстановления, то необходимо пересоздать оповещения в основном пуле, импортировав звуковые файлы и создав оповещения, как это делалось для резервного пула, только не нужно указывать основной пул в параметре Parent. Подробные сведения см. в разделе "Во время отказа" выше в этой статье.

2.  Для каждого диапазона не назначенных номеров, измененного во время отказа, выполните следующую команду:
    
        Set-CsUnassignedNumber [-Identity "<name of number range>"] -AnnouncementService "<FQDN of primary pool>" -AnnouncementName "<announcement name in primary pool>"

3.  Дополнительно можно удалить оповещения, пересозданные в резервном пуле. Получите список оповещений для резервного пула приложения "Объявление". В командной строке выполните следующую команду:
    
        Get-CsAnnouncement -Identity "<Service:service ID>"
    
    Например:
    
        Get-CsAnnouncement -Identity "ApplicationServer:redmond.contoso.com
    
    В полученном списке найдите оповещения, которые требуется удалить, и скопируйте их GUID. Для каждого оповещения, которое требуется удалить, выполните следующую команду:
    
        Remove-CsAnnouncement -Identity "<Service:service ID/guid>"
    
    Например:
    
        Remove-CsAnnouncement -Identity "ApplicationServer:redmond.contoso.com/1951f734-c80f-4fb2-965d-51807c792b90"


