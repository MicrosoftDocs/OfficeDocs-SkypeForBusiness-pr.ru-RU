---
title: Настройка тестовых пользователей узла-наблюдателя и параметров конфигурации
TOCTitle: Настройка тестовых пользователей узла-наблюдателя и параметров конфигурации
ms:assetid: ab00e9cb-f539-4aa6-bcb4-5533fbe7bc44
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ205152(v=OCS.15)
ms:contentKeyID: 49310807
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Настройка тестовых пользователей узла-наблюдателя и параметров конфигурации

 

_**Дата изменения раздела:** 2013-07-29_

Настроив компьютер, который будет выступать в качестве узла-наблюдателя, выполните следующие действия.

1.  Создайте тестовые учетные записи, которые будут использоваться узлами-наблюдателями. Если вы используете проверку подлинности согласованием, вам также необходимо выполнить командлет [Set-CsTestUserCredential](https://docs.microsoft.com/en-us/powershell/module/skype/), чтобы разрешить использование этих учетных записей узлом-наблюдателем.

2.  Обновите параметры конфигурации узла-наблюдателя.

Содержание раздела:

  - Настройка тестовых учетных записей пользователей

  - Настройка базового узла-наблюдателя, использующего искусственные транзакции по умолчанию

  - Настройка расширенных тестов

  - Добавление и удаление искусственных транзакций

  - Просмотр и тестирование конфигурации узла-наблюдателя

## Настройка тестовых учетных записей пользователей

Тестовые учетные записи не обязательно должны принадлежать настоящим пользователям, однако это должны быть допустимые учетные записи Доменные службы Active Directory. Кроме того, они должны иметь допустимые SIP-адреса и для них должна быть включена поддержка Lync Server 2013 и корпоративной голосовой связи (для использования искусственной транзакции Test-CsPstnPeerToPeerCall). Если вы используете проверку подлинности TrustedServer, то все, что вам нужно, — это убедиться в том, что эти учетные записи существуют и настроены так, как описано здесь. Для каждого тестируемого пула следует назначить по крайней мере три тестовых пользователя.

Если вы используете проверку подлинности согласованием, вам также необходимо воспользоваться командлетом **Set-CsTestUserCredential** и Командная консоль Lync Server, чтобы разрешить для тестовых учетных записей работу с искусственными транзакциями. Для этого выполните команду наподобие следующей (в этих командах предполагается, что три учетные записи пользователей Active Directory уже созданы и для них включена поддержка Lync Server 2013).

    Set-CsTestUserCredential -SipAddress "sip:watcher1@litwareinc.com" -UserName "litwareinc\watcher1" -Password "P@ssw0rd"
    Set-CsTestUserCredential -SipAddress "sip:watcher2@litwareinc.com" -UserName "litwareinc\watcher2" -Password "P@ssw0rd"
    Set-CsTestUserCredential -SipAddress "sip:watcher3@litwareinc.com" -UserName "litwareinc\watcher3" -Password "P@ssw0rd"

Обратите внимание на то, что помимо SIP-адреса вам нужно также указать имя пользователя и пароль. Если вы не укажете пароль, командлет Set-CsTestUserCredential выведет соответствующий запрос. Имя пользователя можно указывать в формате "имя\_домена\\имя\_пользователя", как показано выше, или "имя\_пользователя@имя\_домена". Пример:

    -UserName "watcher3@litwareinc.com"

Для проверки создания учетных данных тестовых пользователей выполните следующие команды в Командная консоль Lync Server.

    Get-CsTestUserCredential -SipAddress "sip:watcher1@litwareinc.com"
    Get-CsTestUserCredential -SipAddress "sip:watcher2@litwareinc.com"
    Get-CsTestUserCredential -SipAddress "sip:watcher3@litwareinc.com"

Команды возвращают сведения о каждом пользователе, похожие на следующие.

    Имя пользователя                        Пароль
    --------                        --------
    Litwareinc\watcher1              System.Security.SecureString

## Настройка базового узла-наблюдателя, использующего искусственные транзакции по умолчанию

Создав тестовых пользователей, вы можете создать узел-наблюдатель с помощью следующей команды.

    New-CsWatcherNodeConfiguration -TargetFqdn "atl-cs-001.litwareinc.com" -PortNumber 5061 -TestUsers @{Add= "sip:watcher1@litwareinc.com","sip:watcher2@litwareinc.com", "sip:watcher3@litwareinc.com"}

Эта команда создает узел-наблюдатель с параметрами по умолчанию, который выполняет набор искусственных транзакций по умолчанию. Для нового узла-наблюдателя используются тестовые пользователи watcher1@litwareinc.com, watcher2@litwareinc.com и watcher3@litwareinc.com. Если узел-наблюдатель использует проверку подлинности TrustedServer, тестовые учетные записи могут представлять собой любые допустимые учетные записи, для которых включена поддержка Active Directory и Lync Server. Если узел-наблюдатель использует проверку подлинности согласованием, вам нужно разрешить использование этих учетных записей узлом-наблюдателем с помощью командлета **Set-CsTestUserCredential**.

## Настройка расширенных тестов

Если вы хотите включить тест ТСОП, проверяющий подключение к телефонной сети общего пользования, вам потребуется произвести дополнительную настройку узла-наблюдателя. Во-первых, вам нужно связать тестовых пользователей с типом теста ТСОП. Для этого в Командная консоль Lync Server выполните следующую команду.

    $pstnTest = New-CsExtendedTest -TestUsers "sip:watcher1@litwareinc.com", "sip:watcher2@litwareinc.com", "sip:watcher3@litwareinc.com"  -Name "Contoso Provider Test" -TestType PSTN

Обратите внимание на то, что результаты выполнения этой команды необходимо сохранить в переменной. В этом примере используется переменная $pstnTest.

На этом этапе вы можете воспользоваться командлетом **New-CsWatcherNodeConfiguration**, чтобы связать тип теста (хранящийся в переменной $pstnTest) с пулом Lync Server 2013. Например, следующая команда создает конфигурацию узла-наблюдателя для пула atl-cs-001.litwareinc.com, добавляет трех тестовых пользователей, созданных ранее, а также тест ТСОП.

    New-CsWatcherNodeConfiguration -TargetFqdn "atl-cs-001.litwareinc.com" -PortNumber 5061 -TestUsers @{Add= "sip:watcher1@litwareinc.com","sip:watcher2@litwareinc.com", "sip:watcher3@litwareinc.com"} -ExtendedTests @{Add=$pstnTest}

Если вы не установили основные файлы Lync Server и базу данных RTCLocal на компьютере узла-наблюдателя, то предыдущая команда завершится с ошибкой.

Чтобы протестировать несколько политик голосовой связи, вам нужно создать расширенный тест для каждой политики с помощью командлета **New-CsExtendedTest**. Для пользователей, назначенных этому тесту, следует настроить требуемые политики голосовой связи. После этого передайте расширенные тесты в командлет **New-CsWatcherNodeConfiguration** с помощью следующей команды.

    -ExtendedTests @{Add=$pstnTest1,$pstnTest2,$pstnTest3}

Так как командлет New-CsWatcherNodeConfiguration был вызван без параметра Tests, то для нового узла-наблюдателя будут включены только искусственные транзакции по умолчанию и указанные расширенные искусственные транзакции. Это означает, что узел-наблюдатель будет тестировать следующие компоненты:

  - Registration (регистрация)

  - IM (обмен мгновенными сообщениями)

  - GroupIM (групповые мгновенные сообщения)

  - P2PAV (одноранговые аудио- и видеосеансы)

  - AvConference (аудио- и видеоконференции)

  - Presence (сведения о присутствии)

  - ABS (служба адресной книги)

  - ABWQ (веб-служба адресной книги)

  - ТСОП (звонки через шлюз ТСОП, определенные как расширенный тест; по умолчанию тест ТСОП отключен, но в этом случае он включен с помощью параметра ExtendedTests, используемого в команде)

Это также означает, что следующие компоненты не будут тестироваться по умолчанию:

  - AVEdgeConnectivity

  - MCXP2PIM (обмен мгновенными сообщениями с помощью мобильных устройств)

  - ExumConnectivity (единая система обмена сообщениями Exchange)

  - JoinLauncher

  - PersistentChatMessage

  - DataConference

  - XmppIM

  - UnifiedContactStore

## Добавление и удаление искусственных транзакций

После настройки узла-наблюдателя вы можете добавлять искусственные транзакции на узел-наблюдатель или удалять их с узла-наблюдателя с помощью командлета **Set-CsWatcherNodeConfiguration**. Например, чтобы добавить тест PersistentChatMessage на узел-наблюдатель, используйте следующую команду с методом Add.

    Set-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" -Tests @{Add="PersistentChatMessage"}

При указании нескольких тестов используйте запятые. Пример:

    Set-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" -Tests @{Add="PersistentChatMessage","DataConference","UnifiedContactStore"}

Имейте в виду, что если один или несколько этих тестов (например, DataConference) уже были включены на узле-наблюдателе, произойдет ошибка. В этом случае вы получите следующее сообщение.

    Set-CsWatcherNodeConfiguration : Существует повторяющаяся последовательность ключей  'DataConference' для ключа 'urn:schema:Microsoft.Rtc.Management.Settings.WatcherNode.2010:TestName' или ограничение по уникальному идентификатору.

Если произошла эта ошибка, изменения не применяются. Команду следует выполнить повторно, удалив повторяющийся тест.

Чтобы удалить искусственную транзакцию с узла-наблюдателя, вместо метода Add используйте метод Remove. Например, следующая команда удаляет тест ABWQ с узла-наблюдателя.

    Set-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" -Tests @{Remove="ABWQ"}

С помощью метода Replace вы можете также заменить все тесты, включенные в настоящий момент, на один или несколько новых тестов. Например, если вы хотите, чтобы узел-наблюдатель выполнял только тест IM, вы можете использовать следующую команду.

    Set-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" -Tests @{Replace="IM"}

При выполнении предыдущей команды на указанном узле-наблюдателе отключаются все искусственные транзакции, кроме IM.

## Просмотр и тестирование конфигурации узла-наблюдателя

Чтобы просмотреть тесты, назначенные узлу-наблюдателю, используйте следующую команду.

    Get-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" | Select-Object -ExpandProperty Tests

Предыдущая команда возвращает сведения, схожие со следующими (с учетом искусственных транзакций, назначенных узлу).

    Registration
    IM
    GroupIM
    P2PAV
    AvConference
    Presence
    PersistentChatMessage
    DataConference


> [!TIP]
> Чтобы просмотреть искусственные транзакции в алфавитном порядке, используйте следующую команду.<BR>Get-CsWatcherNodeConfiguration –Identity "atl-cs-001.litwareinc.com" | Select-Object –ExpandProperty Tests | Sort-Object



Чтобы проверить, был ли создан узел-наблюдатель, введите в Командная консоль Lync Server следующую команду.

    Get-CsWatcherNodeConfiguration

Команда возвращает сведения, похожие на следующие.

    Identity      : atl-cs-001.litwareinc.com
    TestUsers     : {sip:watcher1@litwareinc.com, sip:watcher2@litwareinc.com ...}
    ExtendedTests : {TestUsers=IList<System.String>;Name=PSTN Test; Te...}
    TargetFqdn    : atl-cs-001.litwareinc.com
    PortNumber    : 5061

Чтобы проверить конфигурацию узла-наблюдателя, введите следующую команду в Командная консоль Lync Server.

    Test-CsWatcherNodeConfiguration

Предыдущая команда проверяет каждый узел-наблюдатель в развертывании и сообщает следующие сведения:

  - установлена ли требуемая роль Регистратора;

  - созданы ли требуемые разделы реестра при запуске команды Set-CsWatcherNodeConfiguration;

  - используется ли на серверах правильная версия Lync Server;

  - правильно ли настроены порты;

  - имеются ли у назначенных тестовых пользователей требуемые учетные данные.

