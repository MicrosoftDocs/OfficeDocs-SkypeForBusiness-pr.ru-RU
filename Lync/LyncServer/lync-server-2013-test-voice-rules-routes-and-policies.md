---
title: 'Lync Server 2013: Тестирование правил голосовой связи, маршрутов и политик'
description: 'Lync Server 2013: Тестирование правил голосовой связи, маршрутов и политик.'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Test voice rules, routes, and policies
ms:assetid: ebb9c3fa-6950-4311-87ca-e1ecd9280a43
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Dn725213(v=OCS.15)
ms:contentKeyID: 63969661
ms.date: 01/27/2015
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: cf205ac2585298dfc5347d93e382e8bbda9f3ff4
ms.sourcegitcommit: d42a21b194f4a45e828188e04b25c1ce28a5d1ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2020
ms.locfileid: "48557045"
---
# <a name="test-voice-rules-routes-and-policies-in-lync-server-2013"></a>Проверка правил голосовой связи, маршрутов и политик в Lync Server 2013

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">



</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2014-05-20_


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p>Расписание проверки</p></td>
<td><p>Monthly</p></td>
</tr>
<tr class="even">
<td><p>Средство тестирования</p></td>
<td><p>Windows PowerShell</p></td>
</tr>
<tr class="odd">
<td><p>Необходимые разрешения</p></td>
<td><p>При локальном запуске с помощью командной консоли Lync Server пользователи должны быть членами группы безопасности RTCUniversalServerAdmins.</p>
<p>При выполнении с помощью удаленного экземпляра Windows PowerShell пользователям должна быть назначена роль RBAC, имеющая разрешение на запуск командлета Test-CsVoiceUser. Чтобы просмотреть список всех ролей RBAC, которые могут использовать этот командлет, выполните следующую команду в командной консоли Windows PowerShell:</p>
<p><code>Get-CsAdminRole | Where-Object {$_.Cmdlets -match &quot;Test-CsVoiceUser&quot;}</code></p></td>
</tr>
</tbody>
</table>


<div>

## <a name="description"></a>Описание

Когда пользователь выполняет телефонный звонок, маршрут, по которому выполняется звонок, зависит от политик и абонентских планов, назначенных этому пользователю. Если вы задаете SIP адрес и номер телефона пользователя, командлет Test-CsVoiceUser проверяет, может ли пользователь выполнить вызов по этому номеру. Если проверка прошла успешно, Test-CsVoiceUser возвращает следующее:

  - Число преобразуется в формат E. 164 (на основе абонентской группы пользователя)

  - Правило нормализации, которое предоставляет этот перевод

  - Используемый маршрут голосовых вызовов (на основе приоритета маршрута);

  - Использование телефона, с помощью которого политика голосовой связи пользователя привязывается к маршруту голосовой связи.

Test-CsVoiceUser позволяет определить, будет ли конкретный номер телефона маршрутизироваться и транслироваться должным образом, и может помочь устранить проблемы, связанные с вызовами, которые возникают у отдельных пользователей.

</div>

<div>

## <a name="running-the-test"></a>Выполнение теста

При запуске командлета Test-CsVoiceUser необходимо указать два фрагмента информации: номер набираемого номера (DialedNumber) и идентификатор тестируемой учетной записи пользователя. Например, эта команда проверяет способность пользователя, имеющего адрес SIP sip:kenmyer@litwareinc.com, совершать вызов на номер телефона + 1206555-1219:

`Test-CsVoiceUser -DialedNumber "12065551219" -SipUri "sip:kenmyer@litwareinc.com"`

Номер телефона должен быть отформатирован так, как ожидалось. Например, если пользователи обычно не набирать номер 1 перед выполнением междугородного звонка, используйте следующий формат:

`-DialedNumber "2065551219"`

Конечно, в этом случае тест завершится с ошибками, если у вас нет правила нормализации, которое может правильно перевести число 2065551219 в формат телефона E. 164, используемый Lync Server. Для получения дополнительных сведений обратитесь к разделу справки New-CsVoiceNormalizationRule командлету.

Если вы хотите выполнить такой же тест для каждой учетной записи пользователя, можно использовать команду, аналогичную следующей:

`Get-CsUser | ForEach-Object {$_.DisplayName; Test-CsVoiceUser -DialedNumber "+12065551219" -SipUri $_.SipAddress} | Format-List`

Для получения дополнительных сведений обратитесь к справочной документации по командлету Test-CsVoiceUser.

</div>

<div>

## <a name="determining-success-or-failure"></a>Определение успешности или сбоя

Если проверка успешно завершена (то есть, если пользователь может совершать телефонный звонок по указанному номеру), на выходе будут отображаться такие сведения, как переведенный номер телефона, а также соответствующее правило нормализации и маршрут голосовой связи.

Транслатеднумбер Матчингруле Фирстматчинграуте Матчингусаже

\----------------    ------------    ------------------    -------------

\+12065551219 дескрипти...    Локальная LocalRoute

Из-за ограничений экрана Windows PowerShell по крайней мере некоторые возвращенные сведения (особенно часто полное описание совпадающего правила нормализации) могут не отображаться на экране. Если вы заинтересованы в успешном или неисправном тесте, это может быть неважно. Если вы хотите просмотреть все подробные сведения о возвращаемых данных, затем передаете выходные данные в командлет Format-List при выполнении теста:

`Test-CsVoiceUser -DialedNumber "+12065551219" -SipUri "sip:kenmyer@litwareinc.com" -Verbose | Format-List`

Отобразятся выходные данные в более удобном формате для читателя:

Транслатеднумбер: + 12065551219

Матчингруле: Description =; Pattern = ^ ( \\ d {11} ) $; Перевод = + $1;

Name = prefix ALL; Исинтерналекстенсион = false

Фирсматчинграуте: LocalRoute

Матчингусаже: local

Если проверка завершилась ошибкой, Test-CsVoiceUser вернет пустой набор значений свойств:

Транслатеднумбер Матчингруле Фирстматчинграуте Матчингусаже

\---------------- ------------ ------------------ -------------

</div>

<div>

## <a name="reasons-why-the-test-might-have-failed"></a>Причины, по которым может произойти сбой теста

Существует несколько причин, по которым может произойти ошибка командлета Test-CsVoiceUser: возможно, не существует правила нормализации, которое может перевести предоставленный номер телефона. Возможны проблемы с маршрутом голосовых вызовов. Может быть вызвана ошибка конфигурации абонентской группы, назначенной пользователю. Поэтому при запуске командлета Test-CsVoiceUser может потребоваться включить параметр verbose:

`Test-CsVoiceUser -DialedNumber "+12065551219" -SipUri "sip:kenmyer@litwareinc.com" -Verbose`

Если включен подробный командлет, Test-CsVoiceUser будет выдавать подробные сведения о всех действиях, выполняемых при проведении проверок. Например, вы можете увидеть приведенные ниже действия. 

VERBOSE: Поиск пользователя с идентификатором "sip:kenmyer@litwareinc.com"

VERBOSE: Загрузка абонентской группы: "абонентскую redmonddialplan"

В этой дополнительной информации можно найти указания по выявлению причин сбоя. Например, подробный вывод показывает, что тестируемому пользователю назначена абонентская схема абонентскую redmonddialplan. Если тест завершился с ошибкой, следующим логическим шагом будет проверка того, что абонентскую redmonddialplan может перевести предоставленный номер телефона.

</div>

<div>

## <a name="see-also"></a>См. также


[Test-Ксвоицеусер](https://docs.microsoft.com/powershell/module/skype/Test-CsVoiceUser)  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

