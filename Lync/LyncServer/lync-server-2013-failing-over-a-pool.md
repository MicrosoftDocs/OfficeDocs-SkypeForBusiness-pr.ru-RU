---
title: 'Lync Server 2013: отработка отказа для пула'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Failing over a pool
ms:assetid: 10b13732-bc80-4cb2-a71c-56b1d6cb5bbb
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ204678(v=OCS.15)
ms:contentKeyID: 48183432
ms.date: 10/10/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 7de00de8361ac8bc5827fd76ea2486ae790a66d4
ms.sourcegitcommit: 88a16c09dd91229e1a8c156445eb3c360c942978
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2020
ms.locfileid: "42048022"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="failing-over-a-pool-in-lync-server-2013"></a>Отработка отказа для пула в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2014-10-10_

Если отказал одиночный клиентский пул и его требуется обойти, используйте следующую процедуру. В этой процедуре Datacenter1 содержит Pool1, и произошел отказ Pool1. Выполняется обход отказавшего пула к пулу Pool2, находящемуся в Datacenter2.

Большая часть работы для отработки отказа пула включает отработку отказа центрального хранилища управления, если это необходимо. Это важно, так как центральное хранилище управления должно быть работоспособным при отработки отказа для пользователей пула.

Кроме того, если возник отказ клиентского пула, но пограничный пул на этом сайте по-прежнему работает, необходимо знать, используется ли пограничным пулом отказавший пул в качестве следующего перехода по пулам. Если используется, следует изменить пограничный пул, чтобы он использовал другой клиентский пул до обхода отказавшего клиентского пула. Порядок изменения настройки следующего перехода по пулам зависит от того, будет ли пограничный пул использовать пул на том же сайте, на котором находится пограничный пул, или на другом сайте.

**Чтобы установить пограничный пул на использование пула следующего перехода на том же сайте**

1.  Откройте построитель топологий, щелкните правой кнопкой мыши пограничный пул, который необходимо изменить, и выберите команду **изменить свойства**.

2.  Щелкните **Следующий переход**. В списке **Пул следующего перехода:** выберите пул, который сейчас служит в качестве пула следующего перехода.

3.  Нажмите кнопку **ОК**, а затем опубликуйте изменения.

**Чтобы установить пограничный пул на использование пула следующего перехода на другом сайте**

1.  Откройте окно командной консоли Lync Server и введите следующий командлет:
    
        Set-CsEdgeServer -Identity EdgeServer:<Edge Server pool FQDN> -Registrar Registrar:<NextHopPoolFQDN>

**Чтобы обойти пул, находящийся в аварийном состоянии**

1.  Чтобы определить, какой пул является узлом для центрального сервера управления, введите следующий командлет на сервере переднего плана в Pool2:
    
        Invoke-CsManagementServerFailover -Whatif
    
    Результаты этого командлета покажут, какой пул в настоящее время содержит центральный сервер управления. В оставшейся части этой процедуры этот пул называется пулом CMS\_.

2.  Используйте построитель топологий, чтобы найти версию Lync Server, работающую\_на пуле CMS. Если на нем работает Lync Server 2013, используйте следующий командлет, чтобы найти резервный пул пула 1.
    
        Get-CsPoolBackupRelationship -PoolFQDN <CMS_Pool FQDN>
    
    Подайте\_резервный пул в резервный пул.

3.  Проверьте состояние центрального хранилища управления с помощью следующего командлета:
    
        Get-CsManagementStoreReplicationStatus -CentralManagementStoreStatus 
    
    Этот командлет показывает, что Активемастерфкдн и Активефилетрансферажентс указывают на полное доменное имя пула CMS\_. Если они пусты, центральный сервер управления недоступен и его необходимо отработать.

4.  Если центральное хранилище управления недоступно или если центральное хранилище управления было запущено в Pool1 (то есть при сбое пула), перед отработкой отказа пула необходимо выполнить отработку отказа на центральном сервере управления. Если необходимо отработка отказа для центрального сервера управления, размещенного в пуле, где запущен Lync Server 2013, используйте командлет, описанный в шаге 5 этой процедуры. Если необходимо отработка отказа на центральном сервере управления, размещенном в пуле, где работает Lync Server 2010, используйте командлет, описанный в шаге 6 этой процедуры. Если не требуется отработка отказа для центрального сервера управления, перейдите к шагу 7 этой процедуры.

5.  Чтобы отработка отказа центрального хранилища управления в пуле, работающем под управлением Lync Server 2013, выполните следующие действия:
    
      - Сначала проверьте, какой внутренний сервер в резервном\_пуле выполняет основной экземпляр центрального хранилища управления, введя следующую команду:
        
            Get-CsDatabaseMirrorState -DatabaseType Centralmgmt -PoolFqdn <Backup_Pool Fqdn>
    
      - Если основной сервер переднего план в резервном\_пуле является основным, введите:
        
            Invoke-CSManagementServerFailover -BackupSQLServerFqdn <Backup_Pool Primary BackEnd Server FQDN> -BackupSQLInstanceName <Backup_Pool Primary SQL Instance Name>
        
        Если зеркальный сервер переднего план в\_резервном пуле является основным, введите:
        
            Invoke-CSManagementServerFailover -MirrorSQLServerFqdn <Backup_Pool Mirror BackEnd Server FQDN> -MirrorSQLInstanceName <Backup_Pool Mirror SQL Instance Name>
    
      - Убедитесь, что отработка отказа для центрального сервера управления завершена. Введите следующую команду:
        
            Get-CsManagementStoreReplicationStatus -CentralManagementStoreStatus 
        
        Убедитесь, что оба Активемастерфкдн и Активефилетрансферажентс указывают на полное доменное имя\_резервного пула.
    
      - Наконец, проверьте состояние реплики для всех серверов переднего плана, введя следующую команду:
        
            Get-CsManagementStoreReplicationStatus 
        
        Проверьте, все ли реплики имеют значение True.
        
        Перейдите к действию 7 этой процедуры.

6.  Установите центральное хранилище управления на внутреннем сервере пула резервного копирования\_.
    
      - Сначала выполните следующую команду:
        
        ```PowerShell 
        Install-CsDatabase -CentralManagementDatabase -Clean -SqlServerFqdn <Backup_Pool Back End Server FQDN> -SqlInstanceName rtc  
        ```
    
      - Выполните следующую команду на одном из серверов переднего плана резервного\_пула для принудительного перемещения центрального хранилища управления:
        
            Move-CsManagementServer -ConfigurationFileName c:\CsConfigurationFile.zip -LisConfigurationFileName c:\CsLisConfigurationFile.zip -Force 
    
      - Проверьте, выполнилось ли перемещение.
        
            Get-CsManagementStoreReplicationStatus -CentralManagementStoreStatus 
        
        Убедитесь, что оба Активемастерфкдн и Активефилетрансферажентс указывают на полное доменное имя\_резервного пула.
    
      - Проверьте состояние реплики для всех серверов переднего плана, введя следующую команду:
        
            Get-CsManagementStoreReplicationStatus 
        
        Проверьте, все ли реплики имеют значение True.
    
      - Установите службу центрального сервера управления на остальные серверы переднего плана в резервном\_пуле. Для этого выполните приведенную ниже команду на всех серверах переднего плана, Кроме того, который вы использовали при форсированном перемещении центрального хранилища управления в этой процедуре.
        
            Bootstrapper /Setup 

7.  Выполните отработку отказа для пользователей из Pool1 в Pool2, выполнив следующий командлет в окне командной консоли Lync Server:
    
        Invoke-CsPoolFailover -PoolFQDN <Pool1 FQDN> -DisasterMode -Verbose
    
    Так как действия, описанные в предыдущих процедурах этой процедуры, для проверки состояния центрального хранилища управления не являются универсальными, существует шанс сбоя этого командлета, так как центральное хранилище управления пока не проходит полную отработку отказа. В этом случае необходимо исправить центральное хранилище управления на основе сообщений об ошибках, которые вы видите, а затем снова запустить этот командлет.
    
    Если выводится приводимое ниже сообщение об ошибке, необходимо изменить пограничный пул на данном сайте, чтобы использовать до обхода отказавшего пула другой пул в качестве следующего перехода. Подробности см. в описании процедур в начале этой статьи.
    
        Invoke-CsPoolFailOver : This Front-end pool "pool1.contoso.com" is specified in
        topology as the next hop for the Edge server. Failing over this pool may cause External
        access/Federation/Split-domain/XMPP features to stop working. Please use Topology Builder to
        change the Edge internal next hop setting to point to a different Front-end pool,  before you
        proceed.

</div>

<span> </span>

</div>

</div>

</div>

