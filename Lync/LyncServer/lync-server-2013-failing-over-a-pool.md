---
title: 'Lync Server 2013: отработка отказа для пула'
TOCTitle: Отработка отказа для пула
ms:assetid: 10b13732-bc80-4cb2-a71c-56b1d6cb5bbb
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ204678(v=OCS.15)
ms:contentKeyID: 49308973
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Отработка отказа для пула в Lync Server 2013

 

_**Дата изменения раздела:** 2014-10-10_

Если отказал одиночный клиентский пул и его требуется обойти, используйте следующую процедуру. В этой процедуре Datacenter1 содержит Pool1, и произошел отказ Pool1. Выполняется обход отказавшего пула к пулу Pool2, находящемуся в Datacenter2.

Большая часть работы по отработке отказа пула состоит в отработке отказа центрального хранилища управления, если это требуется. Это важно, поскольку центральное хранилище управления должно функционировать, когда пользователи пула переходят на другой ресурс.

Кроме того, если возник отказ клиентского пула, но пограничный пул на этом сайте по-прежнему работает, необходимо знать, используется ли пограничным пулом отказавший пул в качестве следующего перехода по пулам. Если используется, следует изменить пограничный пул, чтобы он использовал другой клиентский пул до обхода отказавшего клиентского пула. Порядок изменения настройки следующего перехода по пулам зависит от того, будет ли пограничный пул использовать пул на том же сайте, на котором находится пограничный пул, или на другом сайте.

**Чтобы установить пограничный пул на использование пула следующего перехода на том же сайте**

1.  Откройте инструмент топологий, щелкните правой кнопкой мыши пограничный пул, который необходимо изменить, и выберите в контекстном меню команду **Изменить свойства**.

2.  Щелкните **Следующий переход**. В списке **Пул следующего перехода:** выберите пул, который сейчас служит в качестве пула следующего перехода.

3.  Нажмите кнопку **ОК** , а затем опубликуйте изменения.

**Чтобы установить пограничный пул на использование пула следующего перехода на другом сайте**

1.  Откройте окно Командная консоль Lync Server в введите следующий командлет:
    
        Set-CsEdgeServer -Identity EdgeServer:<Edge Server pool FQDN> -Registrar Registrar:<NextHopPoolFQDN>

**Чтобы обойти пул, находящийся в аварийном состоянии**

1.  Найдите, в каком пуле размещается сервер центрального хранилища управления, выполнив на сервере переднего плана в пуле Pool2 следующий командлет:
    
        Invoke-CsManagementServerFailover -Whatif
    
    Результаты выполнения этого командлета показывают, в каком пуле в текущий момент размещается управления. В остальной части данной процедуры этот пул известен как CMS\_Pool.

2.  С помощью построителя топологий найдите версию Lync Server, работающую в пуле CMS\_Pool. Если работает сервер Lync Server 2013, найдите резервный пул для пула Pool 1 с помощью следующего командлета.
    
        Get-CsPoolBackupRelationship -PoolFQDN <CMS_Pool FQDN>
    
    Пусть это будет пул Backup\_Pool.

3.  Проверьте состояние центрального хранилища управления с помощью следующего командлета:
    
        Get-CsManagementStoreReplicationStatus -CentralManagementStoreStatus 
    
    Этот командлет должен показывать, что ActiveMasterFQDN и ActiveFileTransferAgents указывают полное доменное имя CMS\_Pool. Если они пустые, то сервер центрального хранилища управления недоступен, и необходимо выполнить отработку отказа.

4.  Если сервер центрального хранилища управления недоступен, или если сервер центрального хранилища управления работал в пуле Pool1 (сбой которого произошел), то необходимо выполнить отработку отказа сервера центрального хранилища управления перед отработкой отказа пула. Если требуется отработка отказа сервера центрального хранилища управления, размещенного в пуле, в котором работает сервер Lync Server 2013, то используйте командлет из действия 5 этой процедуры. Если требуется выполнить отработку отказа сервера центрального хранилища управления, размещенного в пуле, в котором работает Lync Server 2010, то используйте командлет из действия 6 этой процедуры Если отработка отказа сервера центрального хранилища управления не требуется, перейдите к действию 7 этой процедуры.

5.  Чтобы осуществить обход управления в пуле, в котором работает сервер Lync Server 2013, выполните следующие действия:
    
      - Сначала проверьте, на каком тыловом сервере в пуле Backup\_Pool работает экземпляр-субъект сервера центрального хранилища управления, выполнив следующую команду:
        
            Get-CsDatabaseMirrorState -DatabaseType Centralmgmt -PoolFqdn <Backup_Pool Fqdn>
    
      - Если тыловой сервер в пуле Backup\_Pool является субъектом, введите следующую команду:
        
            Invoke-CSManagementServerFailover -BackupSQLServerFqdn <Backup_Pool Primary BackEnd Server FQDN> -BackupSQLInstanceName <Backup_Pool Primary SQL Instance Name>
        
        Если субъектом является зеркальный тыловой сервер в пуле Backup\_Pool, введите следующую команду:
        
            Invoke-CSManagementServerFailover -MirrorSQLServerFqdn <Backup_Pool Mirror BackEnd Server FQDN> -MirrorSQLInstanceName <Backup_Pool Mirror SQL Instance Name>
    
      - Убедитесь, что отработка отказа сервера центрального хранилища управления завершена. Введите следующую команду:
        
            Get-CsManagementStoreReplicationStatus -CentralManagementStoreStatus 
        
        Проверьте, указывают ли ActiveMasterFQDN и ActiveFileTransferAgents на полное доменное имя пула Backup\_Pool.
    
      - Наконец, проверьте состояние реплики для всех серверов переднего плана, введя следующую команду:
        
            Get-CsManagementStoreReplicationStatus 
        
        Проверьте, все ли реплики имеют значение True.
        
        Перейдите к действию 7 этой процедуры.

6.  Установите управления на внутреннем сервере Backup\_Pool.
    
      - Сначала выполните следующую команду:
        
        ``` 
        Install-CsDatabase -CentralManagementDatabase -Clean -SqlServerFqdn <Backup_Pool Back End Server FQDN> -SqlInstanceName rtc  
        ```
    
      - Выполните следующую команду на одном из клиентских серверов Backup\_Pool, чтобы принудительно переместить управления:
        
            Move-CsManagementServer -ConfigurationFileName c:\CsConfigurationFile.zip -LisConfigurationFileName c:\CsLisConfigurationFile.zip -Force 
    
      - Проверьте, выполнилось ли перемещение.
        
            Get-CsManagementStoreReplicationStatus -CentralManagementStoreStatus 
        
        Проверьте, указывают ли ActiveMasterFQDN и ActiveFileTransferAgents на полное доменное имя пула Backup\_Pool.
    
      - Проверьте состояние реплики для всех серверов переднего плана, введя следующую команду:
        
            Get-CsManagementStoreReplicationStatus 
        
        Проверьте, все ли реплики имеют значение True.
    
      - Установите службу сервера центрального хранилища управления на оставшейся части серверов переднего плана в пуле Backup\_Pool. Для этого выполните следующую команду на всех серверах переднего плана, за исключением того, на котором выполнялось перемещение центрального хранилища управления ранее в этой процедуре:
        
            Bootstrapper /Setup 

7.  Переведите пользователей из пула Pool1 в пул Pool2, выполнив следующий командлет в окне командной консоли Командная консоль Lync Server:
    
        Invoke-CsPoolFailover -PoolFQDN <Pool1 FQDN> -DisasterMode -Verbose
    
    Так как действия, предпринятые в предыдущих частях данной процедуры по проверке состояния управления не являются универсальными, по-прежнему существует шанс, что этот командлет завершится неудачно, поскольку еще не выполнен полный обход управления. В этом случае необходимо исправить управления на основе выводимых сообщений об ошибках, а затем снова выполнить данный командлет.
    
    Если выводится приводимое ниже сообщение об ошибке, необходимо изменить пограничный пул на данном сайте, чтобы использовать до обхода отказавшего пула другой пул в качестве следующего перехода. Подробности см. в описании процедур в начале этой статьи.
    
        Invoke-CsPoolFailOver : This Front-end pool "pool1.contoso.com" is specified in
        topology as the next hop for the Edge server. Failing over this pool may cause External
        access/Federation/Split-domain/XMPP features to stop working. Please use Topology Builder to
        change the Edge internal next hop setting to point to a different Front-end pool,  before you
        proceed.

