---
title: 'Lync Server 2013: Администрирование службы адресной книги'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
TOCTitle: Administering the Address Book Service
ms:assetid: 801e4243-9670-4477-aa2f-88b61ecf5351
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg429711(v=OCS.15)
ms:contentKeyID: 48184649
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 8acf59a898f8da14b9c5c4151728206cc501ceaf
ms.sourcegitcommit: bb53f131fabb03a66f0d000f8ba668fbad190778
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2019
ms.locfileid: "34841996"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="administering-the-address-book-service-in-lync-server-2013"></a>Администрирование службы адресной книги в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Тема последнего изменения:** 2014-02-05_

Как часть развертывания Lync Server, Enterprise Edition или Standard Edition, служба адресной книги устанавливается по умолчанию. База данных, используемая службой адресных книг — Рткаб — создается на сервере SQL Server (для Enterprise Edition — это сервер SQL Server, размещенный на сервере Standard Edition, выровненный SQL Server).

<div>


> [!NOTE]  
> Сведения об использовании команды " <STRONG>Редактирование ADSI</STRONG> " для редактирования атрибутов объектов доменных служб Active Directory смотрите в разделе <A href="http://go.microsoft.com/fwlink/?linkid=330427">Редактирование ADSI</A>. Сведения о средстве из набора ресурсов, специально предназначенном для службы адресной книги, можно найти в статьях <A href="http://go.microsoft.com/fwlink/?linkid=330429">инструменты Microsoft Lync Server 2013 Resource Kit</A>.



</div>

<div>

## <a name="address-book-server-phone-number-normalization"></a>Нормализация номера телефона сервера адресной книги

Для Lync Server требуются стандартизированные телефонные номера RFC 3966/E. 164. Чтобы использовать неструктурированные или неоднородные номера телефонов, сервер Lync Server использует сервер адресной книги для предварительной обработки телефонных номеров, прежде чем они будут переданы в правила нормализации. При использовании номера телефона из адресной книги и применения правила нормализации, клиенты, такие как Lync Phone Edition и Lync Mobile, могут использовать эти нормализованные номера.

Правила нормализации, которые использовались в предыдущих версиях, могут работать неправильно без некоторых корректировок. Так как пробелы и необязательные знаки удаляются до правил нормализации, если выражение Regex специально ищет дефис или другой символ, который был удален, правило нормализации может завершиться сбоем. Необходимо проанализировать правила нормализации, чтобы убедиться в том, что эти необязательные символы, а также в том случае, если правило не просматриваются, и продолжит работу в том случае, если этот знак не отображается в том месте, где оно будет считаться.

</div>

<div>

## <a name="user-replicator-and-address-book-server"></a>Репликатор пользователей и сервер адресной книги

Сервер адресной книги использует данные, предоставленные репликатором пользователей, для обновления первоначально используемых данных в глобальном списке адресов (GAL). Репликатор пользователей записывает атрибуты доменных служб Active Directory для каждого пользователя, контакта и группы в таблицу Абусерентри в базе данных, а сервер адресной книги синхронизирует данные пользователя из базы данных с файлами в хранилище файлов на сервере адресной книги и в базу данных адресной книги Рткаб. Схема для таблицы Абусерентри использует два столбца: **усергуид** и **UserData**. **Усергуид** — это Индексный столбец, который содержит 16-БАЙТОВЫЙ идентификатор GUID объекта службы каталогов Active Directory. **UserData** — это столбец с изображением, который содержит все ранее упомянутые атрибуты доменных служб Active Directory для этого контакта.

Репликатор пользователей определяет, какие атрибуты Active Directory нужно записать, прочитав таблицу конфигурации, расположенную в том же экземпляре SQL Server, что и в таблице Абусерентри. Таблица Абаттрибуте включает в себя три столбца: **ID**, **Name**, **flags**и **Enable**. Таблица будет создана при настройке базы данных. Если таблица Абаттрибуте пуста, то репликатор пользователей пропускает свою логику обработки таблицы Абусерентри. Атрибуты сервера адресной книги являются динамическими и извлекаются из таблицы Абаттрибуте, которая первоначально записывается сервером адресной книги при активации сервера адресной книги.

Активация сервера адресной книги заполняет таблицу Абаттрибуте значениями, указанными в приведенной ниже таблице.


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>ID</th>
<th>Имя</th>
<th>Флажки</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>1</p></td>
<td><p>Гивеннаме</p></td>
<td><p>0x01400000</p></td>
</tr>
<tr class="even">
<td><p>2</p></td>
<td><p>Серий</p></td>
<td><p>0x02400000</p></td>
</tr>
<tr class="odd">
<td><p>3</p></td>
<td><p>Водить</p></td>
<td><p>0x03420000</p></td>
</tr>
<tr class="even">
<td><p>4</p></td>
<td><p>Название</p></td>
<td><p>0x04000000</p></td>
</tr>
<tr class="odd">
<td><p>5</p></td>
<td><p>Атрибута mailNickname</p></td>
<td><p>0x05400000</p></td>
</tr>
<tr class="even">
<td><p>6</p></td>
<td><p>Между</p></td>
<td><p>0x06000000</p></td>
</tr>
<tr class="odd">
<td><p>7</p></td>
<td><p>Фисикалделиверйоффиценаме</p></td>
<td><p>0x07000000</p></td>
</tr>
<tr class="even">
<td><p>No8</p></td>
<td><p>msRTCSIP-PrimaryUserAddress</p></td>
<td><p>0x08520C00</p></td>
</tr>
<tr class="odd">
<td><p>@</p></td>
<td><p>telephoneNumber</p></td>
<td><p>0x09022800</p></td>
</tr>
<tr class="even">
<td><p>5-10</p></td>
<td><p>Хомефоне</p></td>
<td><p>0x0A302800</p></td>
</tr>
<tr class="odd">
<td><p>11</p></td>
<td><p>Мобильный</p></td>
<td><p>0x0B622800</p></td>
</tr>
<tr class="even">
<td><p>12</p></td>
<td><p>Осертелефоне</p></td>
<td><p>0x0C302000</p></td>
</tr>
<tr class="odd">
<td><p>рис</p></td>
<td><p>Ипфоне</p></td>
<td><p>0x0D302000</p></td>
</tr>
<tr class="even">
<td><p>14</p></td>
<td><p>Сообщения</p></td>
<td><p>0x0E500000</p></td>
</tr>
<tr class="odd">
<td><p>10-15</p></td>
<td><p>Грауптипе</p></td>
<td><p>0x0F010800</p></td>
</tr>
<tr class="even">
<td><p>шестнадцат</p></td>
<td><p>Отдел</p></td>
<td><p>0x10000000</p></td>
</tr>
<tr class="odd">
<td><p>18</p></td>
<td><p>Описание</p></td>
<td><p>0x11000100</p></td>
</tr>
<tr class="even">
<td><p>18</p></td>
<td><p>Директор</p></td>
<td><p>0x12040001</p></td>
</tr>
<tr class="odd">
<td><p>19</p></td>
<td><p>Проксяддресс</p></td>
<td><p>0x00500105</p></td>
</tr>
<tr class="even">
<td><p>средняя</p></td>
<td><p>Мсексчхидефромаддресслистс</p></td>
<td><p>0xFF000003</p></td>
</tr>
<tr class="odd">
<td><p>99</p></td>
<td><p>entryID</p></td>
<td><p>0x99000000</p></td>
</tr>
</tbody>
</table>


Числа в столбце " **идентификатор** " должны быть уникальными и не должны использоваться повторно. Кроме того, при сохранении значений ИДЕНТИФИКАТОРов в разделе 256 сохраняются места в выходных файлах, написанных сервером адресной книги. Однако максимальное значение идентификатора — 65535. Столбец **Name** соответствует имени атрибута Active Directory, которое репликатор пользователей должен добавить в таблицу абусерентри для каждого контакта. Значение в столбце **flags** используется для определения типа атрибута. Следующие типы атрибутов сервера адресной книги распознаются репликатором пользователей, обозначается младшим байтом значения в столбце **flags** .


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Атрибут</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>0x0</p></td>
<td><p>Строковый атрибут. Репликатор пользователей преобразует этот тип в кодировку UTF-8, прежде чем хранить его в таблице Абусерентри.</p></td>
</tr>
<tr class="even">
<td><p>0x1</p></td>
<td><p>Двоичный атрибут. Репликатор пользователей сохраняет этот объект в объекте BLOB без каких-либо преобразований.</p></td>
</tr>
<tr class="odd">
<td><p>0x2</p></td>
<td><p>Атрибут String, который включается, только если значение атрибута начинается с &quot;Tel:.&quot; В основном это для многозначных строковых атрибутов, особенно <strong>proxyAddresses</strong>. В этом случае сервер адресной книги нужен только в записях <strong>proxyAddresses</strong> , начинающихся с &quot;Tel:&quot;. Таким образом, в целях экономии места репликатор пользователей хранит только записи, которые начинаются с &quot;Tel:.&quot;</p></td>
</tr>
<tr class="even">
<td><p>0x3</p></td>
<td><p>Логический атрибут String, который в случае ИСТИНности приводит к тому, что этот контакт не должен быть указан в таблице Абусерентри. Если задано значение FALSE, то служба тиражирования пользователей будет включать атрибуты этого контакта в таблицу Абусерентри, но не конкретный атрибут с этим флагом. Это еще один особый тип случая, преимущественно для атрибута <strong>мсексчхидефромаддресслистс</strong> .</p></td>
</tr>
<tr class="odd">
<td><p>0x4</p></td>
<td><p>Атрибут String, который &quot;включается, только если значение атрибута начинается с SMTP:&quot; и содержит &quot; @ &quot; символ.</p></td>
</tr>
<tr class="even">
<td><p>0x5</p></td>
<td><p>Атрибут String, который включается, &quot;только если значение атрибута начинается с Tel:&quot; или &quot;SMTP:&quot; и содержит &quot; @ &quot; символ.</p></td>
</tr>
<tr class="odd">
<td><p>0x100</p></td>
<td><p>Если этот параметр установлен, это многозначный атрибут, который может отображаться для каждого контакта более одного раза.</p></td>
</tr>
<tr class="even">
<td><p>0x400</p></td>
<td><p>Если этот параметр установлен, он определяет атрибут имени учетной записи пользователя электронной почты для контакта. Сервер адресной книги использует этот флаг, чтобы определить, какое значение атрибута отобразить в записи журнала событий нормализации телефона.</p></td>
</tr>
<tr class="odd">
<td><p>0x800</p></td>
<td><p>Если этот параметр установлен, он определяет обязательный атрибут для контакта. Адресная книга сервер включает пользователя в таблицу Абусерентри только в том случае, если в службе каталогов Active Directory есть значение для этого атрибута. Если имеется несколько обязательных атрибутов, для включения пользователя в таблицу Абусерентри требуется только один из них.</p></td>
</tr>
<tr class="even">
<td><p>0x1000</p></td>
<td><p>Если задано, сервер адресной книги всегда нормализует значение этого атрибута.</p></td>
</tr>
<tr class="odd">
<td><p>0x2000</p></td>
<td><p>Если задано, сервер адресной книги использует нормализованное число из <strong>proxyAddresses</strong>, если параметр <strong>усенормализатионрулес</strong> CMS имеет значение ложь; в противном случае она будет выглядеть так же, как если бы бит флага 0x1000.</p></td>
</tr>
<tr class="even">
<td><p>0x4000</p></td>
<td><p>Если задано, сервер адресной книги не включает в таблицу Абусерентри объекты, которые имеют это значение для указанного атрибута. Например, если в атрибуте <strong>msRTCSIP-примарюсераддресс</strong> установлен этот бит флага, то контакты с этим атрибутом не записываются в базу данных.</p></td>
</tr>
<tr class="odd">
<td><p>0x8000</p></td>
<td><p>Если задано, сервер адресной книги не включает в таблицу Абусерентри объекты, которые не имеют этого значения для указанного атрибута. Если для объекта заданы биты флага 0x4000 и 0x8000, атрибут с битовым значением флага, установленным на 0x4000, имеет приоритет, и объект исключается из таблицы Абусерентри.</p></td>
</tr>
<tr class="even">
<td><p>0x10000</p></td>
<td><p>Если этот параметр установлен, это представляет объект Group. Репликатор пользователей использует этот бит флага, чтобы включить контакты с атрибутом <strong>грауптипе</strong> , чье присутствие указывает на группу (например, список рассылки или группу безопасности).</p></td>
</tr>
<tr class="odd">
<td><p>0x20000</p></td>
<td><p>Если задано, репликатор пользователей использует этот бит флага, чтобы включить этот атрибут в файлы сервера адресной книги для конкретных устройств (файлы с расширением Дабс).</p></td>
</tr>
</tbody>
</table>


В предыдущих версиях Lync Server при применении изменения к Active Directory администратору потребуется выполнить командлеты **Update-ксусердатабасе** и **Update — ксаддрессбук** Windows PowerShell, чтобы сохранить изменения на сервере Lync. база данных пользователей и база данных Рткаб немедленно. В Lync Server 2013 служба репликатора пользователей Lync Server выберет изменения из Active Directory и обновит базу данных пользователей Lync Server на основе заданного интервала. Служба репликации пользователей Lync Server также будет автоматически распространять изменения базы данных Рткаб, не требуя администратора запускать Update-Ксаддрессбук. Если включен веб-запрос на адресную книгу, изменения будут отражены в результатах поиска клиентами Lync. Администраторам потребуется выполнить Update-Ксаддрессбук только в том случае, если разрешена загрузка файла адресной книги.

<div>


> [!NOTE]  
> По умолчанию репликатор пользователей Lync Server запускается автоматически каждые 5 минут. Этот интервал можно настроить с помощью Set-Ксусеррепликаторконфигуратион-Репликатионциклеинтервал &lt; &gt;.



</div>

</div>

<div>

## <a name="filtering-the-address-book"></a>Фильтрация адресной книги

Пользователи, заполненные в серверной адресной книге, могут управляться с учетом определенных атрибутов доменных служб Active Directory, перечисленных в таблице Абаттрибуте. Один из таких атрибутов, используемых для фильтрации, — это атрибут **мсексчанжехидефромаддрессбук** . Это пользовательский атрибут, добавляемый в схему Exchange. Если значение этого атрибута равно TRUE, сервер Exchange Server использует этот атрибут для скрытия контакта из глобального списка адресов Outlook (GAL). Аналогичным образом, если значение этого атрибута — TRUE, то репликатор пользователей не включит этого пользователя в таблицу Абусерентри, и этот пользователь не будет находиться в файле адресной книги сервера.

Вы можете использовать несколько битов флагов, чтобы определить фильтр для использования в атрибутах сервера адресной книги. Например, наличие определенных битов флагов может определять атрибут как атрибут Include или атрибут Exclude. Репликатор пользователей отфильтровывает контакты, которые содержат атрибут Exclude и отфильтровывает, что не содержит атрибут Include.

<div>


> [!WARNING]  
> Дополнительные сведения о том, как отфильтровать адресную книгу, приведены <A href="https://technet.microsoft.com/en-us/library/gg415643(v=ocs.15)">в разделе Командлеты сервера адресной книги в Lync Server 2013</A>и фильтрация записной <A href="http://go.microsoft.com/fwlink/?linkid=330430">книжки Lync 2013</A>



</div>

В настоящее время есть три разных фильтра. Эти фильтры перечислены в приведенной ниже таблице.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Атрибут</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>0x800</p></td>
<td><p>Если этот параметр установлен, он определяет обязательный атрибут для контакта. Репликатор пользователей использует этот бит флага, чтобы отфильтровать контакты, которые не содержат хотя бы один обязательный атрибут. Аупасид — обязательный атрибут, который всегда задается. По крайней мере один из других обязательных атрибутов должен быть установлен. В противном случае контакт (то есть со значением требуемого атрибута Аупасид) по-прежнему не будет записываться в базу данных. Например, если в качестве обязательных атрибутов определены <strong>telephoneNumber</strong> и <strong>хомефоне</strong> , в базу данных записываются только те контакты, которые имеют по крайней мере один из этих атрибутов.</p></td>
</tr>
<tr class="even">
<td><p>0x4000</p></td>
<td><p>Если этот параметр установлен, он определяет атрибут Exclude. Репликатор пользователей использует этот бит флага, чтобы отфильтровать контакты, которые содержат этот атрибут. Например, если <strong>msRTCSIP-примарюсераддресс</strong> определен как атрибут Exclude, контакты, имеющие этот атрибут, не записываются в базу данных.</p></td>
</tr>
<tr class="odd">
<td><p>0x8000</p></td>
<td><p>Если этот параметр установлен, он определяет атрибут Include. Репликатор пользователей использует этот бит флага, чтобы отфильтровать контакты, не содержащие этот атрибут. Например, если <strong>msRTCSIP-примарюсераддресс</strong> определен как атрибут Include, в базу данных записываются только те контакты, у которых есть этот атрибут.</p></td>
</tr>
</tbody>
</table>


<div>


> [!NOTE]  
> Если заданы биты флагов 0x4000 (исключить атрибут) и 0x8000 (include Attribute), бит 0x4000 переопределяет 0x8000 бит и контакт исключен.



</div>

Несмотря на то, что вы можете отфильтровать адресную книгу таким образом, чтобы она включала только некоторых пользователей, ограничение записей не ограничивает возможности других пользователей для связи с отфильтрованными пользователями или для просмотра состояния присутствия. Пользователи могут находить и отправлять мгновенные сообщения вручную, а также вручную инициировать звонки пользователям, которые не входят в адресную книгу, вводя полное доменное имя пользователя. Кроме того, контактные данные пользователя также можно найти в Outlook.

Несмотря на то, что у вас есть полные записи контактов в записной книжке, вы можете использовать Lync Server для инициирования электронной почты, телефона или корпоративной голосовой связи (то есть если на сервере включена поддержка корпоративных голосовых звонков) с пользователями, которые не настроены для запуска сеанса. Protocol (SIP), в некоторых организациях предпочтительно включать в записную книжку сервера только пользователей с поддержкой SIP. Вы можете отфильтровать адресную книгу, чтобы включить только пользователей с поддержкой SIP, сняв флажок 0x800 **** в столбце flags следующих обязательных атрибутов **: mailNickname**, **telephoneNumber**, **хомефоне**и **Mobile**. Вы также можете отфильтровать адресную книгу, чтобы включить только пользователей с поддержкой SIP, задав значение 0x8000 (include) **** в столбце Flags (атрибут **msRTCSIP-примарюсераддресс** ). Это также помогает исключить учетные записи служб из файлов из адресной книги.

После того как вы измените таблицу Абаттрибуте, вы можете обновить данные в таблице Абусерентри, выполнив команду командлет **Update-ксусердатабасе** . После завершения репликации UR вы можете обновить файл в хранилище файлов на сервере адресной книги, вручную запустив команду командлета **упдатексаддрессбук** .

<div>


> [!NOTE]  
> Сервер переднего плана, на котором размещен сервер адресной книги, не является административно настраиваемым. Он выбирается во время развертывания — обычно это первый сервер переднего плана, на котором развернута. В случае сбоя служба адресной книги будет переведена на другой сервер переднего плана и не потребует вмешательства администратора.



</div>

<div>


> [!IMPORTANT]  
> Если вы объединили или изменили инфраструктуру из развертывания с несколькими лесами или родительским и дочерним развертыванием (например, консолидация инфраструктуры перед переходом на Lync Server), возможно, вы обнаружите, что служба адресной книги загружена и Веб-запрос адресной книги для некоторых пользователей завершается сбоем. Если в развертывании используется несколько доменов или лесов, атрибут <STRONG>MsRTCSIP-оригинаторсид</STRONG> заполняется для объектов пользователей, которые представляют собой неполадку. Для устранения этой проблемы атрибут <STRONG>MsRTCSIP-оригинаторсид</STRONG> должен иметь значение NULL для этих объектов.



</div>

</div>

</div>

<span> </span>

</div>

</div>

</div>

