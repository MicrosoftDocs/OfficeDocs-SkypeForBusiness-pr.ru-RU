---
title: "Lync Server 2013: сертификаты для внутреннего интерфейса пограничного сервера"
TOCTitle: Настройка сертификатов для внутреннего интерфейса пограничного сервера
ms:assetid: a1963cc9-87c5-4935-86c0-6bedc6afd0ac
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Gg412750(v=OCS.15)
ms:contentKeyID: 49310706
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Настройка сертификатов для внутреннего интерфейса пограничного сервера в Lync Server 2013

 

_**Дата изменения раздела:** 2013-11-07_

> [!IMPORTANT]  
> Перед запуском мастера сертификатов убедитесь, что вы вошли с учетной записью, которая является членом группы, имеющей соответствующие разрешения для типа шаблона сертификата, который вы планируете использовать. По умолчанию запрос на сертификат Lync Server 2013 будет использовать шаблон сертификата веб-сервера. Если для запроса на сертификат с помощью этого шаблона вы используете учетную запись, которая является членом группы RTCUniversalServerAdmins, убедитесь, что группе назначены разрешения для регистрации, требуемые для использования этого шаблона.

Для внутреннего интерфейса каждого пограничного сервера требуется один сертификат. Сертификаты для внутреннего интерфейса могут выдаваться внутренним центром сертификации (ЦС) предприятия или общедоступным ЦС. Если на вашем предприятии развернут внутренний ЦС, то использование внутреннего ЦС вместо общедоступного ЦС для получения сертификата внутреннего интерфейса позволит сэкономить средства. Для создания сертификатов можно использовать внутренний ЦС на базе Windows Server 2008 или Windows Server 2008 R2.

Дополнительные сведения об этом и других требованиях к сертификатам см. в разделе [Требования к сертификатам для доступа внешних пользователей в Lync Server 2013](lync-server-2013-certificate-requirements-for-external-user-access.md).

Настройка сертификатов на внутреннем пограничном интерфейсе на уровне сайта состоит из следующих этапов:

1.  Загрузка цепочки сертификатов ЦС для внутреннего интерфейса на каждом пограничном сервере.

2.  Импорт цепочки сертификатов ЦС для внутреннего интерфейса на каждом пограничном сервере.

3.  Создание запроса на сертификат для внутреннего интерфейса на одном пограничном сервере, называемом первым пограничным сервером.

4.  Импорт сертификата для внутреннего интерфейса на первом пограничном сервере.

5.  Импорт сертификата на остальных пограничных серверах этого сайта или серверах, развернутых за балансировщиком нагрузки.

6.  Назначение сертификата для внутреннего интерфейса каждого пограничного сервера.

При наличии нескольких сайтов с пограничными серверами (т. е. пограничной топологии с несколькими сайтами) или отдельных наборов пограничных серверов, развернутых за разными балансировщиками нагрузки, вам потребуется выполнить этапы, описанные в этом разделе, на каждом сайте с пограничными серверами или для каждого набора пограничных серверов, развернутых за разными балансировщиками нагрузки.

> [!NOTE]  
> В процедурах, описанных в этом разделе, предполагается, что для создания сертификата для каждого пограничного сервера используется ЦС Windows Server 2008, ЦС Windows Server 2008 R2, ЦС Windows Server 2012 или ЦС Windows Server 2012 R2. Для получения инструкций по другим ЦС обратитесь к соответствующей документации. По умолчанию все пользователи, прошедшие проверку подлинности, имеют соответствующие права для запросов на сертификаты.<br />В процедурах, описанных в этом разделе, предполагается, что запросы на сертификаты создаются на пограничном сервере в ходе его развертывания. Для создания запросов на сертификаты можно использовать сервер переднего плана. Этот способ позволяет создавать запросы на сертификаты перед развертыванием пограничных серверов. Перед созданием запросов на сертификаты с помощью сервера переднего плана убедитесь, что запрашиваемый сертификат определен с закрытым ключом, поддерживающим экспорт.<br />В этом разделе описывается использование CER-файла и P7B-файла для сертификата. Если вы используете файлы с другим расширением, измените процедуры соответствующим образом.

## Загрузка CA цепочки сертификатов для внутреннего интерфейса с использованием веб-сайта certsrv

1.  Выполните вход на сервер Lync Server 2013, расположенный во внутренней сети (т. е. сервер, который не является пограничным сервером), в качестве члена группы **Администраторы** .

2.  Щелкните **Пуск** , **Выполнить** и затем введите следующую команду:
    
        https://<name of your Issuing CA Server>/certsrv
    
    Например:
    
        https://ca01.contoso.net/certsrv
    
    > [!NOTE]  
    > Если вы используете ЦС предприятия на базе Windows Server 2008 или Windows Server 2008 R2, то вместо протокола HTTP вам потребуется использовать протокол HTTPS.

3.  На веб-странице certsrv выдающего ЦС в списке **Выберите нужное действие** щелкните **Загрузка сертификата ЦС, цепочки сертификатов или CRL** .

4.  В **Загрузка сертификата ЦС, цепочки сертификатов или CRL** щелкните **Загрузка цепочки сертификатов ЦС** .

5.  В диалоговом окне **Загрузка файла** щелкните **Сохранить** .

6.  Сохраните файл с расширением P7B на жестком диске сервера и затем скопируйте его на каждый пограничный сервер.
    
    > [!NOTE]  
    > P7B-файл содержит все сертификаты, находящиеся в пути сертификации. Чтобы просмотреть путь сертификации, откройте сертификат сервера и щелкните путь сертификации.

## Экспорт цепочки сертификатов ЦС для внутреннего интерфейса с помощью MMC

1.  Корневой сертификат ЦС можно экспортировать с любого компьютера, присоединенного к домену, с помощью (MMC). Щелкните **Пуск** , выберите **Выполнить** , а затем введите **MMC**.

2.  В консоли MMC щелкните **Файл** и выберите **Добавить/удалить** .

3.  В списке диалогового окна **Добавление и удаление оснастки** выберите **Сертификаты** , а затем нажмите кнопку **Добавить** . При выводе запроса выберите **Учетная запись компьютера** . В диалоговом окне **Выбор компьютера** выберите **Локальный компьютер** . Нажмите кнопку **Готово** . Нажмите кнопку **ОК** .

4.  Разверните узел **Сертификаты (локальный компьютер)** . Разверните узел **Доверенные корневые центры сертификации** и выберите **Сертификаты** .

5.  Щелкните корневой сертификат, выпущенный вашим ЦС. Щелкните правой кнопкой мыши этот сертификат, выберите **Все задачи** , а затем – **Экспорт** . Откроется **мастер экспорта сертификатов** .

6.  В **мастере экспорта сертификатов** нажмите кнопку **Далее** .

7.  В диалоговом окне **Формат экспортируемого файла** выберите формат файла, в который будет выполняться экспорт. Мы рекомендуем использовать формат **Стандарт Cryptographic Message Syntax - сертификаты PKCS \#7 (.p7b)** . Если вы выберите формат **Стандарт Cryptographic Message Syntax - сертификаты PKCS \#7 (.p7b)** , установите флажок **Включить по возможности все сертификаты в путь сертификата** , чтобы экспортировать цепочку сертификатов, включая сертификат корневого ЦС и все сертификаты промежуточных ЦС. Нажмите кнопку **Далее** .

8.  В диалоговом окне **Имя файла экспорта** в поле ввода имени файла введите соответствующий путь и имя файла (расширением имени по умолчанию является P7B) для экспорта сертификата. При желании нажмите кнопку **Обзор** , определите расположение каталога, в котором будет размещаться экспортированный сертификат и введите имя этого сертификата. Нажмите кнопку **Сохранить** . Нажмите кнопку **Далее** .

9.  Просмотрите сводку действий и нажмите кнопку **Готово** , чтобы завершить экспорт сертификата. Нажмите кнопку **ОК** , чтобы подтвердить успешное выполнение экспорта.

## Импорт цепочки сертификатов ЦС для внутреннего интерфейса

1.  На каждом пограничном сервере откройте консоль управления (MMC). Для этого нажмите кнопку **Пуск** , щелкните **Выполнить** , введите **mmc** в поле **Открыть** и затем нажмите кнопку **ОК** .

2.  В меню **Файл** щелкните **Добавить или удалить оснастку** и затем щелкните **Добавить** .

3.  В окне **Добавить изолированные оснастки** щелкните **Сертификаты** и затем нажмите кнопку **Добавить** .

4.  В диалоговом окне **Оснастка сертификата** выберите **Учетная запись компьютера** и затем нажмите кнопку **Далее** .

5.  В диалоговом окне **Выбор компьютера** установите переключатель **Локальный компьютер: (компьютер, на котором выполняется эта консоль)** и затем нажмите кнопку **Готово** .

6.  Нажмите кнопку **Закрыть** , а затем – **ОК** .

7.  В дереве консоли разверните **Сертификаты (локальный компьютер)** , щелкните правой кнопкой мыши **Доверенные корневые центры сертификации** , выберите **Все задачи** , а затем – **Импорт** .

8.  В поле **Импортируемый файл** укажите имя файла сертификата (т. е. имя, которое вы указали при загрузке цепочки сертификатов ЦС для внутреннего интерфейса на предыдущем шаге).

9.  Повторите эту процедуру на каждом пограничном сервере.

## Создание запроса на сертификат для внутреннего интерфейса

1.  На одном из пограничных серверов запустите мастер развертывания и напротив **Шаг 3. Запрос, установка или назначение сертификатов** нажмите кнопку **Выполнить** .
    
    > [!NOTE]  
    > При наличии нескольких пограничных серверов в одном расположении пула вы можете запускать мастер сертификатов на любом пограничном сервере.<br />    После первичного выполнения шага 3 кнопка изменится на <strong>Повторный запуск</strong> . После запроса, установки и назначения всех требуемых сертификатов рядом с кнопкой появится зеленый флажок, указывающий на успешное завершение задачи.

2.  На странице **Available Certificate Tasks** (Доступные задачи сертификатов) щелкните команду **Create a new certificate request** (Создать новый запрос сертификата).

3.  На странице **Запрос на сертификат** нажмите кнопку **Далее** .

4.  На странице **Отложенные или немедленные запросы** установите переключатель **Подготовить запрос сейчас, чтобы отправить его позже** .

5.  На странице **Файл запроса на сертификат** введите полный путь и имя файла для сохранения запроса (например, **c:\\cert\_internal\_edge.cer** ).

6.  На странице **Указание альтернативного шаблона сертификата** установите флажок **Использовать альтернативный шаблон сертификата для выбранного ЦС** , чтобы использовать шаблон, отличный от шаблона WebServer по умолчанию.

7.  На странице **настроек имени и безопасности** выполните следующие действия.
    
      - В поле **Понятное имя** введите отображаемое имя для сертификата (например, "Внутренняя граница").
    
      - В раскрывающемся списке **Длина в битах** укажите длину в битах (как правило, по умолчанию используется значение **2048** ).
        
        > [!NOTE]  
        > Большее высокое значение длины ключа обеспечивает более высокий уровень безопасности, однако негативно сказывается на скорости.    
      - Если сертификат должен поддерживать экспорт, установите флажок **Закрытый ключ сертификата поддерживает экспорт** .

8.  На странице **Сведения об организации** введите название организации и подразделения (например, отдела или подразделения).

9.  На странице **сведений о местоположении** укажите сведения о местоположении.

10. На странице **имени субъекта и альтернативных имен субъекта** отображаются сведения, автоматически заполненные мастером.

11. На странице **Настройка дополнительных альтернативных имен субъекта** укажите все необходимые дополнительные альтернативные имена субъекта.

12. На странице **Сводка по запросу** проверьте сведения о сертификате, которые будут использоваться для создания запроса.

13. После завершения выполнения команд выполните следующие действия:
    
      - Чтобы просмотреть журнал запросов на сертификаты, щелкните **Просмотреть журнал** .
    
      - Чтобы завершить запрос на сертификат, щелкните **Далее** .

14. На странице **Файл запроса на сертификат** выполните следующее действие:
    
      - Чтобы просмотреть созданный файл запроса подписи сертификата (CSR-файл), щелкните **Просмотреть** .
    
      - Чтобы закрыть мастер, щелкните **Готово** .

15. Отправьте этот файл в ЦС (по электронной почте или с помощью другого метода, поддерживаемого для вашего ЦС предприятия) и затем при получении файла ответа скопируйте новый сертификат на этот компьютер, чтобы он был доступен для импорта.

## Импорт сертификата для внутреннего интерфейса

1.  Выполните вход на пограничный сервер, используемый для создания запроса на сертификат, в качестве члена локальной группы "Администраторы".

2.  В мастере развертывания нажмите кнопку **Повторный запуск** напротив строки **Шаг 3. Запрос, установка или назначение сертификатов** .
    
    После первичного выполнения шага 3 кнопка изменяется на **Повторный запуск** . Однако зеленый флажок, указывающий на успешное завершение задачи, появляется только после запроса, установки и назначения всех требуемых сертификатов.

3.  На странице **Доступные задачи для сертификатов** щелкните **Импортировать сертификат из P7B-, PFX- или CER-файла** .

4.  На странице **Импорт сертификата** введите полный путь и имя файла сертификата, который был запрошен или получен для внутреннего интерфейса этого пограничного сервера (или щелкните **Обзор** , чтобы найти и выбрать файл).

5.  Если вы импортируете сертификат, содержащий закрытый ключ, для остальных членов пула, то установите флажок **Файл сертификата содержит закрытый ключ сертификата** и укажите пароль.

## Экспорт сертификата с закрытым ключом для пограничных серверов пула

1.  Выполните вход с учетной записью члена группы "Администраторы" на сервер, на который был импортирован сертификат.

2.  Щелкните **Пуск** , **Выполнить** и введите **MMC** .

3.  В консоли MMC выберите **Файл** и затем выберите **Добавить или удалить оснастку** .

4.  На странице "Добавление и удаление оснастки" щелкните **Сертификаты** и затем **Добавить** .

5.  В диалоговом окне "Оснастка сертификатов" выберите **Учетная запись компьютера** . Нажмите кнопку **Далее** . В диалоговом окне "Выбор компьютера" установите флажок **Локальный компьютер: (компьютер, на котором выполняется эта консоль)** . Чтобы завершить настройку консоли MMC, щелкните **Готово** и **ОК** .

6.  Чтобы развернуть хранилища сертификатов, дважды щелкните **Сертификаты (локальный компьютер)** . Дважды щелкните **Личные** и затем дважды щелкните **Сертификаты** .
    
    > [!IMPORTANT]  
    > Если в хранилище личных сертификатов для локального компьютера сертификат отсутствует, то закрытый ключ, связанный с сертификатом, не был импортирован. Проверьте запрос и шаги, относящиеся к импорту. Если проблема повторится, обратитесь к администратору или поставщику ЦС.

7.  В хранилище личных сертификатов для локального компьютера щелкните правой кнопкой мыши сертификат, который необходимо экспортировать. Щелкните **Все задачи** , а затем – **Экспорт** .

8.  В мастере экспорта сертификатов нажмите кнопку **Далее** . Установите переключатель **Да, экспортировать закрытый ключ** . Нажмите кнопку **Далее** .
    
    > [!NOTE]  
    > Если переключатель <strong>Да, экспортировать закрытый ключ</strong> недоступен, то закрытый ключ, связанный с этим сертификатом, не был помечен для экспорта. В этом случае вам потребуется запросить сертификат повторно и проверить, помечен ли сертификат для экспорта закрытого ключа. Обратитесь к администратору или поставщику ЦС.

9.  В диалоговом окне форматов экспортируемых файлов установите переключатель **Файл обмена личной информацией - PKCS \#12 (.PFX)** и затем установите следующие флажки:
    
      - Включить по возможности все сертификаты в путь сертификации
    
      - Экспортировать все расширенные свойства
        
        > [!WARNING]  
        > При экспорте сертификата с пограничного сервера не устанавливайте флажок <strong>Удалить закрытый ключ после успешного экспорта</strong> . В противном случае потребуется импортировать сертификат и закрытый ключ на этот пограничный сервер.    
        
    Чтобы продолжить, нажмите кнопку **Далее** .

10. Если вы хотите назначить пароль для обеспечения защиты закрытого ключа, введите пароль и его подтверждение для закрытого ключа. Нажмите кнопку **Далее** .

11. Введите путь к экспортируемому сертификату, включая имя и расширение файла (PFX). Путь должен быть доступен всем пограничным серверам пула или доступен с помощью съемных носителей, например USB-устройства флэш-памяти. Нажмите кнопку **Далее** .

12. Проверьте сводные данные на странице "Завершение мастера экспорта сертификатов". Нажмите кнопку **Готово** .

13. В диалоговом окне успешного завершения экспорта нажмите кнопку **ОК** .

14. Импортируйте экспортированный файл сертификата на другие пограничные серверы, как описано в разделе [Настройка сертификатов для внешнего интерфейса пограничного сервера для Lync Server 2013](lync-server-2013-set-up-certificates-for-the-external-edge-interface.md).

## Назначение внутреннего сертификата на пограничных серверах

1.  В мастере развертывания каждого пограничного сервера нажмите кнопку **Повторный запуск** напротив строки **Шаг 3. Запрос, установка или назначение сертификатов** .

2.  На странице **Доступные задачи для сертификатов** выберите **Назначить имеющийся сертификат** .

3.  На странице **Назначение сертификата** выберите **Внутренний интерфейс пограничного сервера** .

4.  На странице **Хранилище сертификатов** выберите сертификат, который был импортирован для внутреннего интерфейса пограничного сервера (на предыдущем шаге).

5.  На странице **Сводка по назначению сертификата** проверьте параметры и затем нажмите кнопку **Далее** , чтобы назначить сертификаты.

6.  На странице завершения работы мастера нажмите кнопку **Готово** .

7.  После завершения этой процедуры для назначения сертификата внутреннего интерфейса пограничного сервера откройте оснастку "Сертификаты" на каждом сервере, разверните узлы **Сертификаты (локальный компьютер)** и **Личные** , а затем щелкните **Сертификаты** . Убедитесь, что области сведений указан сертификат внутреннего интерфейса пограничного сервера.

8.  Если ваше развертывание содержит несколько пограничных серверов, повторите эту процедуру для каждого пограничного сервера.

