---
title: 'Lync Server 2013: проверка политики расположения'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Testing location policy
ms:assetid: 23d06fd3-31ee-4480-ba1e-d179a55b8b14
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Dn690127(v=OCS.15)
ms:contentKeyID: 63969591
ms.date: 01/27/2015
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 2a46eecb63ed35075cb44ff840e733f781357ea6
ms.sourcegitcommit: 88a16c09dd91229e1a8c156445eb3c360c942978
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2020
ms.locfileid: "42046572"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="testing-location-policy-in-lync-server-2013"></a>Проверка политики расположения в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2014-06-05_


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p>Расписание проверки</p></td>
<td><p>Daily (Ежедневный)</p></td>
</tr>
<tr class="even">
<td><p>Средство тестирования</p></td>
<td><p>Windows PowerShell</p></td>
</tr>
<tr class="odd">
<td><p>Необходимые разрешения</p></td>
<td><p>При локальном запуске с помощью командной консоли Lync Server пользователи должны быть членами группы безопасности RTCUniversalServerAdmins.</p>
<p>При выполнении с помощью удаленного экземпляра Windows PowerShell пользователям должна быть назначена роль RBAC, имеющая разрешение на запуск командлета Test-CsLocationPolicy. Чтобы просмотреть список всех ролей RBAC, которые могут использовать этот командлет, выполните следующую команду в командной консоли Windows PowerShell:</p>
<pre><code>Get-CsAdminRole | Where-Object {$_.Cmdlets -match &quot;Test-CsLocationPolicy&quot;}</code></pre></td>
</tr>
</tbody>
</table>


<div>

## <a name="description"></a>Описание

Командлет Test-CsLocationPolicy проверяет, назначена ли политика расположения пользователю. Политика местоположения используется для определения параметров, относящихся к функциям службы E9-1-1 и местоположению клиента. Политика расположения определяет, включен ли для пользователя E9-1-1, и, если ответ имеет значение "Да", что такое поведение экстренного вызова. Например, можно использовать политику расположения, чтобы определить, какой номер выполняет экстренные вызовы (911 в США), следует ли автоматически уведомлять корпоративный уровень безопасности и как перенаправлять вызов.

Тестировать политики местоположения можно на пользователях или на подсетях. Если запустить тест для подсети (указав значение для параметра Subnet), командлет попытается обнаружить политику местоположения для этой подсети. Если подсети не назначена политика местоположения, будет извлечена политика местоположения для заданного пользователя. Если политика подсети успешно получена, выходные данные будут включать значение Локатионполицитагид, начинающееся с подсети тагид. Если политика местоположения для подсети не найдена, значение LocationPolicyTagID будет начинаться со строки user-tagid.

</div>

<div>

## <a name="running-the-test"></a>Выполнение теста

Командлет Test-CsLocationPolicy можно выполнить с помощью предварительно настроенной тестовой учетной записи (см. Настройка тестовых учетных записей для выполнения тестов Lync Server) или учетной записи любого пользователя, для которого включен Lync Server. Чтобы выполнить эту проверку с помощью тестовой учетной записи, достаточно указать полное доменное имя тестируемого пула Lync Server. Пример:

    Test-CsLocationPolicy -TargetFqdn "atl-cs-001.litwareinc.com"

Чтобы выполнить эту проверку с использованием реальной учетной записи пользователя, необходимо сначала создать объект учетных данных Windows PowerShell, который содержит имя и пароль учетной записи. Затем необходимо включить этот объект учетных данных и адрес SIP, назначенный учетной записи, при вызове Test-CsLocationPolicy:

    $credential = Get-Credential "litwareinc\kenmyer"
    Test-CsLocationPolicy -TargetFqdn "atl-cs-001.litwareinc.com"-UserSipAddress "sip:kenmyer@litwareinc.com" -UserCredential $credential

Дополнительные сведения можно найти в справочной документации по командлету [Test-CsLocationPolicy](https://docs.microsoft.com/powershell/module/skype/Test-CsLocationPolicy) .

</div>

<div>

## <a name="determining-success-or-failure"></a>Определение успешности или сбоя

Если указанный пользователь имеет действительную политику расположения, вы получите выходные данные, аналогичные приведенным ниже, и свойство Result помечено как **Success.**

Енханцедемерженцисервицесенаблед: true

Локатионполицитагид: User — тагид

TargetFqdn: atl-cs-001.litwareinc.com

Результат: успешное выполнение

Задержка: 00:00:06.8630376

Ошибкой

Диагност

Если для указанного пользователя не удается найти действительную политику расположения, результат будет отображаться как сбой, а в свойствах диагностики ошибок и диагностики будут записаны дополнительные сведения:

TargetFqdn: atl-cs-001.litwareinc.com

Результат: сбой

Задержка: 00:00:00

Ошибка: 404, не найдена

Диагностика: ErrorCode = 4005, Source = ATL – CS – 001.litwareinc.com,

Reason = конечный URI либо не включен для SIP, либо не

есть.

Microsoft. RTC. Signal. Диагностичеадер

Предыдущие выходные данные построили, что не удалось выполнить тест, так как указанный пользователь не является допустимым: либо учетная запись не существует, либо для пользователя не был включен сервер Lync Server. Вы можете проверить допустимость учетной записи и определить, включена ли эта учетная запись для NM-OCS-14-3, выполнив следующую команду:

    Get-CsUser "sip:kenmyer@litwareinc.com" | Select-Object SipAddress, Enabled

Если Test-CsLocationPolicy завершается с ошибкой, вам может потребоваться повторно выполнить проверку, включая параметр verbose:

    Test-CsLocationPolicy -TargetFqdn "atl-cs-001.litwareinc.com" -Verbose

Если включен параметр Verbose, Test-CsLocationPolicy возвращает пошаговые учетные записи всех действий, которые он пытался проверить в политике расположения. Например, эти выходные данные показывают, что серверу Lync Server не удалось выполнить вход в систему тестового пользователя, вероятно, из-за неправильного пароля:

Отправка запроса на регистрацию:

Целевое полное доменное имя = atl-cs-011.litwareinc.com

SIP адрес пользователя = sip:kenmyer@litwareinc.com

Порт регистратора = 5061

Выбран тип проверки подлинности "Ива".

Регистрация с использованием SIP/ATL-CS-001. litwareinc. com

Действие ' Register ' завершено в ' 0,0601795 ' сек.

Исключение "при входе в систему было отклонено. Убедитесь, что используются правильные учетные данные, а учетная запись активна. " При выполнении рабочего процесса.

</div>

<div>

## <a name="reasons-why-the-test-might-have-failed"></a>Причины, по которым может произойти сбой теста

Ниже приведены некоторые распространенные причины, по которым может произойти ошибка Test-CsLocationPolicy:

  - Указана недопустимая учетная запись пользователя. Чтобы убедиться, что учетная запись пользователя существует, выполните следующую команду:
    
        Get-CsUser "sip:kenmyer@litwareinc.com"

  - Учетная запись пользователя действительна, но в настоящее время учетная запись не включена для Lync Server. Чтобы убедиться в том, что учетная запись пользователя включена для Lync Server, выполните команду, аналогичную следующей:
    
        Get-CsUser "sip:kenmyer@litwareinc.com" | Select-Object Enabled
    
    Если свойство Enabled имеет значение false, это означает, что в настоящее время у пользователя не включена поддержка Lync Server.

</div>

</div>

<span> </span>

</div>

</div>

</div>

