---
title: Развертывание нестандартного порта и псевдонима SQL Server в Lync Server 2013
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Deploying a SQL Server nonstandard port and alias in Lync Server 2013
ms:assetid: 2da92c1f-250e-407a-8651-fb2aec76aeb0
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Dn776290(v=OCS.15)
ms:contentKeyID: 62634609
ms.date: 09/17/2015
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 8721cc82651710ab5fc8158eeb6f297f80847c33
ms.sourcegitcommit: 4d6bf5c58b2c553dc1df8375ede4a9cb9eaadff2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2020
ms.locfileid: "48502916"
---
# <a name="deploying-a-sql-server-nonstandard-port-and-alias-in-lync-server-2013"></a>Развертывание нестандартного порта и псевдонима SQL Server в Lync Server 2013

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">



</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2015-09-16_

Microsoft Lync Server 2013 поддерживает использование нестандартного порта и псевдонима в SQL Server. Использование нестандартного порта SQL Server и псевдоним повышает безопасность и создает более гибкую среду для развертывания Lync. Эти действия относятся только к одному этапу надежной защиты среды Lync Server 2013. Необходимо предпринять дополнительные действия, чтобы уменьшить область атаки реализации Lync Server 2013.

В следующей статье описываются действия, необходимые для настройки нестандартного порта и псевдонима SQL Server в Lync Server 2013.

<div>

## <a name="deploying-a-sql-server-non-standard-port-and-alias-in-lync-server-2013"></a>Развертывание нестандартного порта и псевдонима SQL Server в Lync Server 2013

Lync Server 2013 Topology Builder поддерживает использование псевдонима SQL Server в качестве полного доменного имени (FQDN) вместо фактического полного доменного имени SQL Server при настройке Lync Server 2013. Это позволяет скрыть фактическое полное доменное имя SQL Server от вредоносных злоумышленников. Кроме того, использование нестандартного порта приводит к тому, что злоумышленник пытается атаковать базу данных на стандартном порте 1433, как показано на следующем рисунке.

![Хакер не знает номер порта для атаки.](images/Dn776290.2f3923e0-2bdc-416b-a66b-bf56599eb14e(OCS.15).jpg "Хакер не знает номер порта для атаки.")

Для успешного определения порта Lync Server 2013, который используется для связи с SQL Server, злоумышленнику потребуется проверить все порты, чтобы получить сведения о порте. Сканирование портов злоумышленник увеличивает вероятность того, что система безопасности может обнаружить и остановить эту инструкцию. В дополнение к добавлению усиленной защиты с помощью нестандартного порта, вы также можете использовать псевдоним SQL Server для обеспечения гибкости развертывания. Это полезно для сокращения изменений конфигурации в ситуациях, когда требуется изменить имя сервера SQL Server.

<div>


> [!NOTE]  
> SQL Server предоставляет два метода обеспечения отказоустойчивости (отказоустойчивый кластер и зеркальное отображение). Методы отказоустойчивости SQL Server поддерживаются с использованием нестандартного порта и псевдонима SQL Server с Lync Server 2013. Если серверная серверная база данных SQL Server, используемая пулом, находится в зеркальной конфигурации, то служба браузера SQL на внутреннем сервере SQL Server должна быть запущена для подключения серверов переднего плана к зеркальной базе данных при отказе баз данных на зеркальный SQL Server.



</div>

При настройке подключения к базе данных SQL Server в построителе топологий или при использовании командлета Install-CsDatabase невозможно явно определить нестандартный номер порта SQL Server и связать его с экземпляром SQL Server. Чтобы задать нестандартный порт, необходимо использовать SQL Server и служебные программы Windows Server.

Чтобы настроить нестандартный порт и псевдоним SQL Server для использования с Lync Server 2013, вам потребуется выполнить три основных действия. Эти шаги следующие:

  - Убедитесь, что к Lync Server 2013 применены последние обновления.

  - Настройка нестандартного порта и псевдонима SQL Server.

  - Настройте Lync Server 2013 с псевдонимом SQL Server с помощью построителя топологий.

  - Опубликуйте топологию и проверьте базу данных.

<div>

## <a name="confirm-that-lync-server-2013-has-the-latest-updates-applied"></a>Подтверждение применения последних обновлений для Lync Server 2013

Важно поддерживать Lync Server 2013 в актуальном состоянии. Чтобы проверить наличие последних обновлений и сведения о том, как их применять, ознакомьтесь с [Разобновлением для Lync Server 2013](https://support.microsoft.com/kb/2809243).

</div>

<div>

## <a name="setup-the-sql-server-non-standard-port-and-alias"></a>Настройка нестандартного порта и псевдонима SQL Server

Нестандартный порт и псевдоним SQL Server необходимо настроить в экземпляре базы данных, прежде чем к нему можно будет обращаться из построителя топологий Lync Server 2013. Для настройки нестандартного порта и псевдонима SQL Server потребуется выполнить три основных действия. Эти этапы описаны ниже.

  - Измените значения по умолчанию для протокола TCP/IP.

  - Создайте и настройте псевдоним SQL Server.

  - Создайте запись ресурса службы доменных имен (CNAME).

**Изменение значений по умолчанию для протокола TCP/IP**

1.  Нажмите кнопку **Пуск**и выберите **Диспетчер конфигураций SQL Server**, как показано на следующем рисунке.
    
    ![Значок SQL Server Management Studio](images/Dn776290.6e811f27-cea9-4437-b44c-55bff013150f(OCS.15).png "Значок SQL Server Management Studio")

2.  В области навигации щелкните, чтобы развернуть **экземпляр SQL Server**, выберите пункт **Конфигурация сети SQL Server**, а затем выберите **протоколы для \<instance name\> **, как показано на следующем рисунке.
    
    ![Переход к свойствам TCP/IP](images/Dn776290.3d7a964c-f17e-47fd-8f0c-535453da7fad(OCS.15).jpg "Переход к свойствам TCP/IP")

3.  В правой области щелкните правой кнопкой мыши **TCP/IP**и выберите пункт **свойства**. Отобразится диалоговое окно "свойства TCP/IP".

4.  Перейдите на вкладку **IP-адреса** . На вкладке IP-адреса отображаются все активные IP-адреса на сервере. Они представлены в формате IP1, IP2, вплоть до IPAll, как показано на следующем рисунке.
    
    ![Откройте свойства TCP/IP.](images/Dn776290.ed2fd70d-1836-4ebf-80fe-09191d96585e(OCS.15).jpg "Откройте свойства TCP/IP.")

5.  Очистите поле **динамических портов TCP** для всех IP-адресов. Если поле содержит нулевой символ, это означает, что SQL Server прослушивает динамические порты. Убедитесь, что эти поля очищены и не содержат нуля.

6.  Для IP-адреса, который будет использоваться Lync Server для подключения к базе данных, убедитесь, что для параметра **включено** задано значение **Да**, как показано на следующем рисунке.
    
    ![Для правильного IP-адреса установите значение "Да".](images/Dn776290.7f818b91-0793-4594-8932-90447270fad9(OCS.15).jpg "Для правильного IP-адреса установите значение "Да".")

7.  В разделе **IPAll** в нижней части диалогового окна введите нужный порт в поле **TCP-порт** , как показано на следующем рисунке. В этом примере используется порт 50062, но вы можете использовать любой порт от 49152 до 65535. Это порты, назначаемые динамическому и частному использованию, и это гарантирует, что вы не будете конфликтовать с другими портами, используемыми в развертывании Lync Server 2013.
    
    ![Задать порт в разделе IPAll.](images/Dn776290.b5af53e2-7961-4664-b586-3ca8f3a17f06(OCS.15).jpg "Задать порт в разделе IPAll.")

8.  Нажмите кнопку **ОК** , чтобы закрыть диалоговое окно Свойства TCP/IP.

9.  Перезапустите экземпляр SQL Server, выбрав **службы SQL Server** на левой панели диспетчера КОНФИГУРАЦИй SQL Server. Затем щелкните правой кнопкой мыши **SQL \<instance name\> Server** на правой панели и выберите **перезапустить**, как показано на следующем рисунке.
    
    ![Сбросьте службу SQL Server для экземпляра.](images/Dn776290.a965c8cf-f769-4b52-bb38-c48a438cf491(OCS.15).jpg "Сбросьте службу SQL Server для экземпляра.")

<div>


> [!IMPORTANT]  
> Убедитесь, что параметры брандмауэра обновлены в соответствии с новым портом SQL Server.



</div>

**Создание и Настройка псевдонима SQL Server**

1.  Нажмите кнопку **Пуск**и выберите **Диспетчер конфигураций SQL Server**, как показано на следующем рисунке.
    
    ![Значок SQL Server Management Studio](images/Dn776290.6e811f27-cea9-4437-b44c-55bff013150f(OCS.15).png "Значок SQL Server Management Studio")

2.  В левой области разверните узел **SQL Server**, выберите пункт ** \<version\> Конфигурация собственного клиента SQL**, а затем выберите **псевдонимы**, как показано на следующем рисунке.
    
    ![Псевдонимы в диспетчере конфигурации SQL Server.](images/Dn776290.95341826-55d7-425f-ae19-d47d6668c5d8(OCS.15).jpg "Псевдонимы в диспетчере конфигурации SQL Server.")

3.  Щелкните правой кнопкой мыши **псевдонимы**и выберите команду **создать псевдоним...**.

4.  Введите **имя псевдонима**, **номер порта**, **протокол**и **сервер**, как показано на следующем рисунке.
    
    ![Создание нового псевдонима](images/Dn776290.03653588-aecf-4fdd-b58a-95f5b372d478(OCS.15).jpg "Создание нового псевдонима")
    
    <div>
    

    > [!CAUTION]  
    > Убедитесь, что указан один и тот же нестандартный порт, который вы использовали в предыдущем шаге, так как он будет прослушиваться с помощью порта SQL Server. Если настроенный псевдоним подключается к неправильному полному доменному имени SQL Server или экземпляру, отключите и снова включите связанный сетевой протокол. При этом удаляются все сведения о кэшировании подключения, что позволяет клиенту правильно подключаться.

    
    </div>

**Создание записи ресурса CNAME DNS**

1.  Войдите в систему компьютера, управляющего DNS.

2.  Нажмите кнопку **Пуск**и выберите **Диспетчер сервера**, как показано на следующем рисунке.
    
    ![Открытие диспетчера серверов](images/Dn776290.3e4bd8ad-2a65-4a05-af40-c8dd3583bc8f(OCS.15).jpg "Открытие диспетчера серверов")

3.  Выберите раскрывающийся список " **инструменты** " и выберите **DNS**, как показано на следующем рисунке.
    
    ![Открытие службы DNS из диспетчера серверов.](images/Dn776290.415e1da1-7c9a-4a4e-a896-ca34a76aaeff(OCS.15).jpg "Открытие службы DNS из диспетчера серверов.")

4.  В области слева разверните узел имя сервера, разверните узел зоны прямого просмотра и выберите нужный домен.

5.  Щелкните домен правой кнопкой мыши и выберите команду **создать псевдоним (CNAME)...**, как показано на следующем рисунке.
    
    ![Выбор параметра для создания нового псевдонима CNAME](images/Dn776290.abe66cca-b53c-427a-9094-1a59dc6840ca(OCS.15).jpg "Выбор параметра для создания нового псевдонима CNAME")

6.  Введите **имя псевдонима** и **полное доменное имя SQL Server**, как показано на следующем рисунке.
    
    ![Заполните диалоговое окно Создание псевдонима CNAME.](images/Dn776290.dd0ebd2d-3407-4459-8bd9-2b389a7bc440(OCS.15).jpg "Заполните диалоговое окно Создание псевдонима CNAME.")

7.  Нажмите кнопку **ОК** , чтобы сохранить CNAME и просмотреть ее в диспетчере DNS.

</div>

<div>

## <a name="validate-database-connectivity"></a>Проверка возможности подключения к базе данных

Существует множество различных способов убедиться в том, что он работает. Необходимо убедиться, что база данных SQL Server прослушивает указанный порт с помощью псевдонима. Быструю проверку можно выполнить с помощью команд **netstat** и **Telnet** .

<div>


> [!NOTE]  
> Клиент Telnet — это компонент, который входит в состав Windows Server, но должен быть установлен. Компонент Windows Server можно установить, открыв диспетчер серверов и выбрав Добавить роли и компоненты в меню "Управление".



</div>

**Проверка возможности подключения к базе данных с помощью netstat и Telnet**

1.  Нажмите кнопку **Пуск**и введите **cmd** , чтобы открыть командную строку.

2.  Введите **netstat-a-f**и убедитесь, что SQL Server работает с правильным портом, как показано на следующем рисунке.
    
    ![Использование средства netstat для проверки порта.](images/Dn776290.4ff3a1b2-c5eb-4496-8be7-374c351fa027(OCS.15).jpg "Использование средства netstat для проверки порта.")

3.  Введите **Telnet \<alias name\> \<port \#\> ** , чтобы подтвердить подключение к экземпляру SQL Server. При успешном подключении Telnet будет подключаться, и вы не увидите сообщение об ошибке. Это показывает, что экземпляр SQL Server прослушивает правильный порт с правильным псевдонимом. Если возникла проблема с подключением к базе данных SQL Server, Telnet выводит сообщение о том, что не удается установить подключение. Теперь, когда вы выполнили проверку подключения к базе данных на сервере базы данных, вы можете сделать то же самое из Lync Server (по сети) и убедиться, что нет брандмауэров, блокирующих доступ.

</div>

<div>

## <a name="conclusion"></a>Заключение

После настройки псевдонима SQL Server вы можете использовать его для создания топологии Lync Server 2013 в средстве построения топологии. Дополнительные сведения о топологиях приведены в статье [Определение и Настройка топологии в Lync Server 2013](lync-server-2013-defining-and-configuring-the-topology.md).

</div>

</div>

<div>

## <a name="see-also"></a>См. также


[Microsoft Lync Server 2013](microsoft-lync-server-2013.md)  
 [Планирование безопасности в Lync Server 2013](lync-server-2013-planning-for-security.md)  
[Определение и Настройка топологии в Lync Server 2013](lync-server-2013-defining-and-configuring-the-topology.md)  
[Развертывание Lync Server 2013](lync-server-2013-deploying-lync-server.md)  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

