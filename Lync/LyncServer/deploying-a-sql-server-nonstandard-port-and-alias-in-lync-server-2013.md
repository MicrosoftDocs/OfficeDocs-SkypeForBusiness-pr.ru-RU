---
title: Развертывание нестандартного порта SQL Server и псевдонима в Lync Server 2013
TOCTitle: Развертывание нестандартного порта SQL Server и псевдонима в Lync Server 2013
ms:assetid: 2da92c1f-250e-407a-8651-fb2aec76aeb0
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Dn776290(v=OCS.15)
ms:contentKeyID: 62634510
ms.date: 12/10/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Развертывание нестандартного порта SQL Server и псевдонима в Lync Server 2013

 

_**Дата изменения раздела:** 2016-12-08_

Microsoft Lync Server 2013 поддерживает использование нестандартного порта и псевдонима на сервере SQL Server. Использование нестандартного порта и псевдонима SQL Server повышает уровень безопасности и создает более гибкую среду для развертывания Lync. Эти действия являются всего одним шагом в рамках обеспечения должного уровня безопасности для среды Lync Server 2013. Для уменьшения поверхности атак в реализации Lync Server 2013 необходимы дополнительные действия.

В следующей статье описываются действия по настройке нестандартного порта и псевдонима SQL Server в Lync Server 2013.

## Развертывание нестандартного порта и псевдонима SQL Server в Lync Server 2013

Lync Server 2013топологий поддерживает использование псевдонима SQL Server в качестве полного доменного имени (FQDN) вместо фактического FQDN SQL Server при настройке Lync Server 2013. Это позволяет скрыть FQDN SQL Server от любого вредоносного злоумышленника. Кроме того, использование нестандартного порта скрывает фактический порт от любой попытки атаки злоумышленника базы данных со стандартным портом 1433, как показано на рисунке ниже.

![Злоумышленник не знает номер порта, чтобы атаковать.](images/Dn776290.2f3923e0-2bdc-416b-a66b-bf56599eb14e(OCS.15).jpg "Злоумышленник не знает номер порта, чтобы атаковать.")

Для успешного определения порта, который используется Lync Server 2013 для взаимодействия с SQL Server злоумышленнику потребуется просканировать все порты для получения о них сведений. Сканирование порта злоумышленником увеличивает шансы обнаружения системой безопасности и остановки данных инструкций. Помимо добавления повышенного уровня безопасности с помощью нестандартного порта, можно также использовать псевдоним SQL Server для обеспечения гибкости в рамках развертывания. Это важно для сокращения количества изменений конфигурации в ситуациях, в которых требуется изменение имени SQL Server.

> [!NOTE]  
> SQL Server предоставляет два метода отказоустойчивости (отказоустойчивая кластеризация и зеркальное отображение). Все два метода отказоустойчивости SQL Server поддерживаются с помощью нестандартного порта SQL Server и псевдонима в Lync Server 2013.

При настройке подключения базы данных SQL Server из топологий или при использовании командлета Install-CsDatabase точное определение номера нестандартного порта SQL Server и связи его с экземпляром SQL невозможно. Для установки нестандартного порта потребуется использование служебных программ SQL Server и Windows Server.

Для настройки нестандартного порта SQL Server и псевдонима для использования с Lync Server 2013 потребуется выполнить следующие основные действия:

  - подтверждение наличия последних обновлений для Lync Server 2013;

  - настройка нестандартного порта SQL Server и псевдонима;

  - настройка Lync Server 2013 с помощью псевдонима SQL Server при использовании топологий;

  - публикация топологии и проверка базы данных.

## Подтверждение наличия последних обновлений для Lync Server 2013

Важно поддерживать Lync Server 2013 в актуальном состоянии. Для проверки самых последних обновлений и информацию об их применении см. в статье [Обновления для Lync Server 2013](http://support.microsoft.com/kb/2809243).

## Настройка нестандартного порта SQL Server и псевдонима

Нестандартный порт SQL Server и псевдоним должны быть настроены в экземпляре базы данных до возможности использования в качестве ссылки для Lync Server 2013топологий. Для настройки нестандартного порта SQL Server и псевдонима необходимо выполнить три следующих основных действия:

  - изменение значений протокола TCP/IP по умолчанию;

  - создание и настройка псевдонима SQL Server;

  - создание записи ресурса канонического имени (CNAME) системы доменных имен (DNS).

**Изменение значений протокола TCP/IP по умолчанию**

1.  Нажмите **Пуск** и выберите **Диспетчер конфигурации SQL Server**, как показано на рисунке ниже.
    
    ![Значок SQL Server Management Studio](images/Dn776290.6e811f27-cea9-4437-b44c-55bff013150f(OCS.15).png "Значок SQL Server Management Studio")

2.  На панели навигации разверните **Экземпляр SQL Server**, выберите **Конфигурация сети SQL Server** и нажмите **Протоколы для \<имя экземпляра\>**, как показано на рисунке ниже.
    
    ![Перейти к свойствам TCP/IP](images/Dn776290.3d7a964c-f17e-47fd-8f0c-535453da7fad(OCS.15).jpg "Перейти к свойствам TCP/IP")

3.  На панели справа нажмите правой кнопкой мыши **TCP/IP** и выберите **Свойства**. Отобразится диалоговое окно свойств TCP/IP.

4.  Выберите вкладку **IP-адреса**. На вкладке IP-адресов отобразятся все активные IP-адреса сервера. Используемый формат: IP1, IP2 до IPAll (как показано на рисунке ниже).
    
    ![Откройте свойства TCP/IP.](images/Dn776290.ed2fd70d-1836-4ebf-80fe-09191d96585e(OCS.15).jpg "Откройте свойства TCP/IP.")

5.  Очистите поле **Динамические порты TCP** для всех IP-адресов. Если поле содержит символ нуля, значит SQL Server прослушивает динамические порты. Убедитесь, что поля очищены и не содержат нулей.

6.  Для IP-адресов, которые Lync Server будет использовать для подключения к базе данных, убедитесь в установке для параметра **Включено** значение **Да**, как показано на рисунке ниже.
    
    ![Разрешите, задав "Да" для правильного IP-адреса.](images/Dn776290.7f818b91-0793-4594-8932-90447270fad9(OCS.15).jpg "Разрешите, задав \"Да\" для правильного IP-адреса.")

7.  В разделе **IPAll** в нижней части диалогового окна укажите необходимый порт в поле **Порт TCP**, как показано на рисунке ниже. В данном примере мы используем порт 50062, но вы можете использовать любой порт от 49152 до 65535. Эти порты назначаются для динамического и частного использования, что обеспечивает отсутствие конфликта с другими используемыми портами в развертывании Lync Server 2013.
    
    ![Задайте порт в разделе IPAll.](images/Dn776290.b5af53e2-7961-4664-b586-3ca8f3a17f06(OCS.15).jpg "Задайте порт в разделе IPAll.")

8.  Выберите **ОК** для выхода из диалогового окна свойств TCP/IP.

9.  Перезагрузите экземпляр SQL Server с помощью выбора **Службы SQL Server** на панели диспетчера конфигурации SQL Server слева. Затем нажмите правой кнопкой мыши **SQL Server \<имя экземпляра\>** на панели справа и выберите **Перезапустить**, как показано на рисунке ниже.
    
    ![Выполните сброс службы SQL Server для экземпляра.](images/Dn776290.a965c8cf-f769-4b52-bb38-c48a438cf491(OCS.15).jpg "Выполните сброс службы SQL Server для экземпляра.")

> [!IMPORTANT]  
> Убедитесь в обновлении параметров брандмауэра для размещения нового порта SQL Server.

**Создание и настройка псевдонима SQL Server**

1.  Нажмите **Пуск** и выберите **Диспетчер конфигурации SQL Server**, как показано на рисунке ниже.
    
    ![Значок SQL Server Management Studio](images/Dn776290.6e811f27-cea9-4437-b44c-55bff013150f(OCS.15).png "Значок SQL Server Management Studio")

2.  На панели слева разверните **Экземпляр SQL Server**, выберите **Конфигурация SQL Native Client \<версия\>** и нажмите **Псевдонимы**, как показано на рисунке ниже.
    
    ![Псевдонимы в диспетчере конфигурации SQL Server.](images/Dn776290.95341826-55d7-425f-ae19-d47d6668c5d8(OCS.15).jpg "Псевдонимы в диспетчере конфигурации SQL Server.")

3.  Правой кнопкой мыши нажмите **Псевдонимы** и выберите **Новый псевдоним…**.

4.  Укажите **имя псевдонима**, **номер порта**, **протокол** и **сервер**, как показано на рисунке ниже.
    
    ![Создание нового псевдонима](images/Dn776290.03653588-aecf-4fdd-b58a-95f5b372d478(OCS.15).jpg "Создание нового псевдонима")
    
    > [!CAUTION]  
    > Убедитесь, что введен тот же нестандартный порт, которые использовался в предыдущем шаге, так как этот порт будет использоваться SQL Server для прослушивания. Если настроенный псевдоним подключен к неверному полному доменному имени или экземпляру SQL Server, отключите и повторно включите связанный сетевой протокол. Это действие приводит к удалению любой информации о подключении из кэш-памяти и позволяет клиентам подключаться правильно.

**Создание записи ресурса DNS CNAME**

1.  Войдите в систему компьютера, управляющего DNS.

2.  Нажмите **Пуск** и выберите **Диспетчер северов**, как показано на рисунке ниже.
    
    ![Открытие диспетчера серверов](images/Dn776290.3e4bd8ad-2a65-4a05-af40-c8dd3583bc8f(OCS.15).jpg "Открытие диспетчера серверов")

3.  Нажмите раскрывающийся список **Сервис**, затем выберите **DNS**, как показано на рисунке ниже.
    
    ![Открытие DNS из диспетчера серверов.](images/Dn776290.415e1da1-7c9a-4a4e-a896-ca34a76aaeff(OCS.15).jpg "Открытие DNS из диспетчера серверов.")

4.  На панели слева разверните узел имени сервера, затем узел зон прямого просмотра и выберите подходящий домен.

5.  Правой кнопкой мыши нажмите домен и выберите **Новый псевдоним (CNAME)…**, как показано на рисунке ниже.
    
    ![Выбор варианта создания нового псевдонима CNAME](images/Dn776290.abe66cca-b53c-427a-9094-1a59dc6840ca(OCS.15).jpg "Выбор варианта создания нового псевдонима CNAME")

6.  Введите **имя псевдонима** и **FQDN для SQL Server**, как показано на рисунке ниже.
    
    ![Заполнение диалогового окна для нового псевдонима CNAME.](images/Dn776290.dd0ebd2d-3407-4459-8bd9-2b389a7bc440(OCS.15).jpg "Заполнение диалогового окна для нового псевдонима CNAME.")

7.  Нажмите **ОК** для сохранения CNAME и просмотра его в диспетчере DNS.

## Проверка подключения базы данных

Существует много разных способов убедиться в работе. Вам необходимо убедиться в том, что база данных SQL Server прослушивает указанный порт с помощью псевдонима. Можно выполнить быструю проверку с помощью команд **netstat** и **telnet**.

> [!NOTE]  
> Клиент Telnet является компонентом сервера Windows Server, но требует установки. Функция Windows Server может быть установлена с помощью открытия диспетчера серверов и выбора из меню управления пункта &quot;Добавить роли и компоненты&quot;.

**Использование netstat и telnet для проверки подключения базы данных**

1.  Нажмите **Пуск** и введите **cmd** для открытия командной строки.

2.  Введите **netstat -a -f** и подтвердите, что SQL Server запущен на правильном порту, как показано на рисунке ниже.
    
    ![Проверка порта с помощью netstat.](images/Dn776290.4ff3a1b2-c5eb-4496-8be7-374c351fa027(OCS.15).jpg "Проверка порта с помощью netstat.")

3.  Введите **telnet \<имя псевдонима\> \<порт\#\>** для подтверждения подключения к экземпляру SQL Server. Если подключение успешно, telnet подключиться без отображения ошибок. Это показывает то, что экземпляр SQL Server прослушивается на правильном порту с помощью должного псевдонима. При возникновении проблем с подключением к базе данных SQL Server команда telnet отобразит ошибку неудачного подключения. После проверки подключения базы данных к серверу базы данных можно выполнить те же действия из Lync Server (по сети) и убедиться в отсутствии блоков доступа от брандмауэров.

## Заключение

После настройки псевдонима SQL Server его можно использовать для создания топологии Lync Server 2013 в средстве топологий. Подробнее о топологиях см. в статье [Определение и настройка топологии в Lync Server 2013](lync-server-2013-defining-and-configuring-the-topology.md).

## См. также

#### Концепции

[Microsoft Lync Server 2013](microsoft-lync-server-2013.md)  

#### Другие ресурсы

[Планирование безопасности в Lync Server 2013](lync-server-2013-planning-for-security.md)  
[Определение и настройка топологии в Lync Server 2013](lync-server-2013-defining-and-configuring-the-topology.md)  
[Развертывание Lync Server 2013](lync-server-2013-deploying-lync-server.md)

