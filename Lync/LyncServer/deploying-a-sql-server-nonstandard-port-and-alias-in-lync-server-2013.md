---
title: Развертывание нестандартного порта SQL Server и псевдонима в Lync Server 2013
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
TOCTitle: Deploying a SQL Server nonstandard port and alias in Lync Server 2013
ms:assetid: 2da92c1f-250e-407a-8651-fb2aec76aeb0
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Dn776290(v=OCS.15)
ms:contentKeyID: 62634609
ms.date: 09/17/2015
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 35365cbd43aa3bea9afe5cdd036bd3834fae5037
ms.sourcegitcommit: bb53f131fabb03a66f0d000f8ba668fbad190778
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2019
ms.locfileid: "34841876"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="deploying-a-sql-server-nonstandard-port-and-alias-in-lync-server-2013"></a>Развертывание нестандартного порта SQL Server и псевдонима в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Тема последнего изменения:** 2015-09-16_

Microsoft Lync Server 2013 поддерживает использование нестандартного порта и псевдонима в SQL Server. Использование нестандартного порта SQL Server и псевдоним повышает безопасность и создает более гибкую среду для развертывания Lync. Эти действия являются единственным шагом в обеспечении надлежащей защиты среды Lync Server 2013. Чтобы уменьшить контактную зону реализации Lync Server 2013, необходимо предпринять дополнительные действия.

В следующей статье описаны действия, которые необходимо выполнить для настройки нестандартного порта и псевдонима SQL Server в Lync Server 2013.

<div>

## <a name="deploying-a-sql-server-non-standard-port-and-alias-in-lync-server-2013"></a>Развертывание нестандартного порта и псевдонима SQL Server в Lync Server 2013

Сервер Lync Server 2013 Topology Builder поддерживает использование псевдонима SQL Server в качестве полного доменного имени (FQDN) вместо фактического FQDN SQL Server при настройке Lync Server 2013. Это позволяет скрыть реальное полное доменное имя SQL Server от вредоносных злоумышленников. Кроме того, использование нестандартного порта приводит к тому, что сам порт злоумышленника не попытается атаковать базу данных на стандартном порте 1433, как показано на приведенном ниже рисунке.

![Злоумышленник не знает номер порта для атак.] (images/Dn776290.2f3923e0-2bdc-416b-a66b-bf56599eb14e(OCS.15).jpg "Злоумышленник не знает номер порта для атак.")

Чтобы получить успешный способ определения порта Lync Server 2013, который используется для взаимодействия с SQL Server, злоумышленнику потребуется проверить все порты, чтобы получать сведения о порте. Просмотр порта злоумышленник повышает вероятность того, что система безопасности может обнаружить и остановить эту инструкцию. Помимо добавления усиленной защиты с помощью нестандартного порта, вы также можете использовать псевдоним SQL Server для обеспечения гибкости развертывания. Это полезно, если вы хотите уменьшить изменения конфигурации в ситуациях, когда требуется изменить имя сервера SQL Server.

<div>


> [!NOTE]  
> В SQL Server имеется два метода обеспечения отказоустойчивости (отказоустойчивая кластеризация и зеркальное отображение). Оба метода отказоустойчивости сервера SQL Server поддерживаются с помощью нестандартного порта и псевдонима сервера SQL Server с Lync Server 2013. Если серверная база данных SQL Server, используемая пулом, находится в зеркальной конфигурации, то служба браузера SQL на внутреннем сервере SQL Server должна запускаться для того, чтобы сервер переднего плана подключается к зеркальной, когда базы данных не переносятся на зеркальный SQL-сервер. Server.



</div>

При настройке подключения к базе данных SQL Server из построителя топологии или при использовании командлета Install-Ксдатабасе невозможно явно определить нестандартный номер порта SQL Server и связать его с экземпляром SQL. Для задания нестандартного порта вам потребуется использовать сервер SQL Server и служебные программы Windows Server.

Чтобы настроить нестандартный порт и псевдоним SQL Server для использования с Lync Server 2013, вам потребуется выполнить три основные действия. Эти действия описаны ниже.

  - Убедитесь, что к Lync Server 2013 применены последние обновления.

  - Настройка нестандартного порта и псевдонима SQL Server.

  - Настройте Lync Server 2013 с псевдонимом SQL Server с помощью Topology Builder.

  - Опубликуйте топологию и проверьте базу данных.

<div>

## <a name="confirm-that-lync-server-2013-has-the-latest-updates-applied"></a>Подтверждение применения последних обновлений для Lync Server 2013

Важно поддерживать приложение Lync Server 2013 в актуальном состоянии. Чтобы узнать о последних обновлениях и о том, как их применять, ознакомьтесь с разделами [обновления для Lync Server 2013](http://support.microsoft.com/kb/2809243).

</div>

<div>

## <a name="setup-the-sql-server-non-standard-port-and-alias"></a>Настройка нестандартного порта и псевдонима SQL Server

Нестандартный порт и псевдоним SQL Server необходимо настроить в экземпляре базы данных, прежде чем на него можно будет ссылаться из сервера Lync Server 2013 Topology Builder. Для настройки нестандартного порта и псевдонима SQL Server вам потребуется выполнить три основные действия. Ниже указаны эти действия.

  - Измените значения по умолчанию для протокола TCP/IP.

  - Создайте и настройте псевдоним SQL Server.

  - Создайте запись ресурса DNS с каноническим именем (CNAME).

**Изменение значений протокола TCP/IP, используемых по умолчанию**

1.  Нажмите кнопку **Пуск**и выберите **Диспетчер конфигурации SQL Server**, как показано на рисунке ниже.
    
    ![Значок Microsoft SQL Server Management Studio] (images/Dn776290.6e811f27-cea9-4437-b44c-55bff013150f(OCS.15).png "Значок Microsoft SQL Server Management Studio")

2.  В области навигации щелкните, чтобы развернуть **экземпляр SQL Server**, затем разверните **конфигурацию сети SQL Server**и выберите **протоколы \<для имени\>экземпляра**, как показано на приведенном ниже рисунке.
    
    ![Переход к свойствам TCP/IP] (images/Dn776290.3d7a964c-f17e-47fd-8f0c-535453da7fad(OCS.15).jpg "Переход к свойствам TCP/IP")

3.  На правой панели щелкните правой кнопкой мыши **TCP/IP**и выберите пункт **свойства**. Откроется диалоговое окно "свойства TCP/IP".

4.  Перейдите на вкладку **IP-адреса** . На вкладке адреса IP отображаются все активные IP-адреса на сервере. Эти данные находятся в формате IP1, IP2, до Ипалл, как показано на рисунке ниже.
    
    ![Откройте окно свойств TCP/IP.] (images/Dn776290.ed2fd70d-1836-4ebf-80fe-09191d96585e(OCS.15).jpg "Откройте окно свойств TCP/IP.")

5.  Очистите поле **динамических портов TCP** для всех IP-адресов. Если поле содержит нулевой знак, это означает, что SQL Server прослушивает динамические порты. Убедитесь, что эти поля очищены и не содержат нуль.

6.  Для IP-адреса, который Lync Server будет использовать для подключения к базе данных, убедитесь, что для **Enabled** задано значение **Да**, как показано на приведенном ниже рисунке.
    
    ![Для правильного IP-адреса установите для него значение "включено".] (images/Dn776290.7f818b91-0793-4594-8932-90447270fad9(OCS.15).jpg "Для правильного IP-адреса установите для него значение \"включено\".")

7.  В разделе **ипалл** в нижней части диалогового окна введите нужный порт в поле **TCP Port (порт** ), как показано на приведенном ниже рисунке. В этом примере мы используем порт 50062, но можете использовать любой порт между 49152 и 65535. Это порты, назначенные динамическому и частному использованию, и это гарантирует, что вы не будете конфликтовать с другими портами, используемыми в развертывании Lync Server 2013.
    
    ![Установка порта в разделе ипалл.] (images/Dn776290.b5af53e2-7961-4664-b586-3ca8f3a17f06(OCS.15).jpg "Установка порта в разделе ипалл.")

8.  Нажмите кнопку **ОК** , чтобы закрыть диалоговое окно свойств TCP/IP.

9.  Перезапустите экземпляр SQL Server, выбрав пункт **службы SQL Server** на левой панели ДИСПЕТЧЕРА конфигурации SQL Server. Затем в области справа щелкните **имя \<\> экземпляра SQL Server** правой кнопкой мыши и выберите команду **перезапустить**, как показано на рисунке ниже.
    
    ![Сброс службы SQL Server для экземпляра.] (images/Dn776290.a965c8cf-f769-4b52-bb38-c48a438cf491(OCS.15).jpg "Сброс службы SQL Server для экземпляра.")

<div>


> [!IMPORTANT]  
> Убедитесь, что вы обновили параметры брандмауэра для размещения нового порта SQL Server.



</div>

**Создание и Настройка псевдонима SQL Server**

1.  Нажмите кнопку **Пуск**и выберите **Диспетчер конфигурации SQL Server**, как показано на рисунке ниже.
    
    ![Значок Microsoft SQL Server Management Studio] (images/Dn776290.6e811f27-cea9-4437-b44c-55bff013150f(OCS.15).png "Значок Microsoft SQL Server Management Studio")

2.  В левой области выберите пункт **экземпляр SQL Server**, затем разверните ** \<конфигурацию версии\> собственного клиента SQL**и выберите псевдонимы, как показано на **** рисунке ниже.
    
    ![Псевдонимы в диспетчере конфигурации SQL Server.] (images/Dn776290.95341826-55d7-425f-ae19-d47d6668c5d8(OCS.15).jpg "Псевдонимы в диспетчере конфигурации SQL Server.")

3.  Щелкните правой кнопкой **** мыши псевдонимы и выберите команду **создать псевдоним..**..

4.  Введите **имя псевдонима**, **номер порта**, **протокол**и **сервер**, как показано на приведенном ниже рисунке.
    
    ![Создание нового псевдонима] (images/Dn776290.03653588-aecf-4fdd-b58a-95f5b372d478(OCS.15).jpg "Создание нового псевдонима")
    
    <div>
    

    > [!CAUTION]  
    > Убедитесь, что вы ввели один и тот же нестандартный порт, который вы использовали в предыдущем шаге, так как этот порт будет прослушиваться сервером SQL Server. Если настроенный псевдоним подключается к неправильному полному доменному имени или экземпляру SQL Server, отключите и снова включите связанный сетевой протокол. Это приведет к сбросу всех кэшированных сведений о соединении и позволяет клиенту подключаться правильно.

    
    </div>

**Создание записи ресурса CNAME DNS**

1.  Войдите на компьютер, управляющий DNS.

2.  Нажмите кнопку **Пуск**и выберите **Диспетчер сервера**, как показано на рисунке ниже.
    
    ![Открытие диспетчера серверов] (images/Dn776290.3e4bd8ad-2a65-4a05-af40-c8dd3583bc8f(OCS.15).jpg "Открытие диспетчера серверов")

3.  Щелкните раскрывающийся список **Сервис** и выберите **DNS**, как показано на рисунке ниже.
    
    ![Открытие DNS из диспетчера серверов.] (images/Dn776290.415e1da1-7c9a-4a4e-a896-ca34a76aaeff(OCS.15).jpg "Открытие DNS из диспетчера серверов.")

4.  На левой панели разверните узел имя сервера, разверните узел зоны прямого просмотра и выберите нужный домен.

5.  Щелкните домен правой кнопкой мыши и выберите команду **создать псевдоним (CNAME)...**, как показано на рисунке ниже.
    
    ![Выбор параметра для создания нового псевдонима CNAME] (images/Dn776290.abe66cca-b53c-427a-9094-1a59dc6840ca(OCS.15).jpg "Выбор параметра для создания нового псевдонима CNAME")

6.  Введите псевдоним и полное доменное **имя** **SQL Server**, как показано на приведенном ниже рисунке.
    
    ![Заполните диалоговое окно Создание CNAME псевдонима.] (images/Dn776290.dd0ebd2d-3407-4459-8bd9-2b389a7bc440(OCS.15).jpg "Заполните диалоговое окно Создание CNAME псевдонима.")

7.  Нажмите кнопку **ОК** , чтобы сохранить CNAME и просмотреть ее в диспетчере DNS.

</div>

<div>

## <a name="validate-database-connectivity"></a>Проверка подключения к базе данных

Существует множество различных способов убедиться в том, что он работает. Необходимо убедиться, что база данных SQL Server прослушивает указанный порт с помощью псевдонима. Быстрая проверка может быть завершена с помощью команд **netstat** и **Telnet** .

<div>


> [!NOTE]  
> Клиент Telnet — это функция, которая входит в состав Windows Server, но должна быть установлена. Компонент Windows Server можно установить, открыв диспетчер серверов и выбрав в меню Управление пункт Добавить роли и компоненты.



</div>

**Проверка подключения к базе данных с помощью средства netstat и Telnet**

1.  Нажмите кнопку **Пуск**и введите **cmd** , чтобы открыть командную подсказку.

2.  Введите **netstat-a-f**и убедитесь, что SQL Server запущен с правильным портом, как показано на приведенном ниже рисунке.
    
    ![Использование средства netstat для проверки порта.] (images/Dn776290.4ff3a1b2-c5eb-4496-8be7-374c351fa027(OCS.15).jpg "Использование средства netstat для проверки порта.")

3.  Введите **имя \<\> \<псевдонима Telnet \# Port (порт** ) для подтверждения соединения с экземпляром SQL Server. Если подключение прошло успешно, программа Telnet будет подключаться, и вы не увидите сообщение об ошибке. Это указывает на то, что экземпляр SQL Server прослушивает правильный порт с правильным псевдонимом. Если у вас возникла проблема с подключением к базе данных SQL Server, программа Telnet выведет сообщение о том, что соединение не может быть установлено. Теперь, когда вы проверили подключение к базе данных на сервере базы данных, вы можете сделать то же самое в Lync Server (в сети) и убедиться в отсутствии брандмауэров, блокирующих доступ.

</div>

<div>

## <a name="conclusion"></a>Заключение

После того как вы настроили псевдоним SQL Server, вы можете использовать его для создания топологии Lync Server 2013 в инструменте Topology Builder. Дополнительные сведения о топологиях можно найти [в разделе Определение и Настройка топологии в Lync Server 2013](lync-server-2013-defining-and-configuring-the-topology.md).

</div>

</div>

<div>

## <a name="see-also"></a>См. также


[Microsoft Lync Server 2013](microsoft-lync-server-2013.md) 
[Планирование безопасности в Lync Server 2013](lync-server-2013-planning-for-security.md)  
[Определение и настройка топологии в Lync Server 2013](lync-server-2013-defining-and-configuring-the-topology.md)  
[Развертывание Lync Server 2013](lync-server-2013-deploying-lync-server.md)  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

