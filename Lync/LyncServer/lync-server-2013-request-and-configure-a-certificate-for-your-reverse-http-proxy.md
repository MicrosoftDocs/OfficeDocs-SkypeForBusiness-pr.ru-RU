---
title: Запрос и Настройка сертификата для обратного HTTP-прокси
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Request and configure a certificate for your reverse HTTP proxy
ms:assetid: 4b70991e-5f10-40a3-b069-0b227c3a3a0a
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg429704(v=OCS.15)
ms:contentKeyID: 48184085
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 830d9d48e68142cf32f14d428fb48e3ab20afaca
ms.sourcegitcommit: 88a16c09dd91229e1a8c156445eb3c360c942978
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2020
ms.locfileid: "42047284"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="request-and-configure-a-certificate-for-your-reverse-http-proxy-in-lync-server-2013"></a>Запрос и Настройка сертификата для обратного HTTP-прокси-сервера в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2014-02-14_

Необходимо установить сертификат корневого центра сертификации (CA) на сервере под управлением Microsoft Forefront Threat Management Gateway 2010 или IIS ARR для инфраструктуры ЦС, которая выдала сертификаты сервера внутренним серверам, на которых работает Microsoft Lync. Сервер 2013.

Вам также следует установить общий сертификат веб-сервера  на обратный прокси-сервер. Альтернативные имена субъектов этого сертификата  должны содержать опубликованные внешние полные доменные имена для каждого пула, в котором размещаются пользователи с включенной поддержкой удаленного доступа, а также внешние полные доменные имена всех Директоров или пулов Директоров, которые будут использоваться в рамках пограничной инфраструктуры. Альтернативное имя субъекта также должно содержать простой URL-адрес собрания, простой URL-адрес для телефонного подключения и — если вы развертываете мобильные приложения и планируете использовать автоматическое обнаружение — внешний URL-адрес службы автообнаружения, как показано в следующей таблице.


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Значение</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Имя субъекта</p></td>
<td><p>Полное доменное имя пула</p></td>
<td><p>webext.contoso.com</p></td>
</tr>
<tr class="even">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Полное доменное имя пула</p></td>
<td><p>webext.contoso.com</p>



> [!IMPORTANT]
> Это имя субъекта также должно присутствовать в альтернативном имени субъекта.

</td>
</tr>
<tr class="odd">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Необязательные веб-службы директора (если директор развернута)</p></td>
<td><p>webdirext.contoso.com</p></td>
</tr>
<tr class="even">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Простой URL-адрес собрания</p>



> [!NOTE]
> Все простые URL-адреса собраний должны находиться в альтернативном имени субъекта. Каждый SIP-домен должен иметь хотя бы один активный простой URL-адрес собрания.

</td>
<td><p>meet.contoso.com</p></td>
</tr>
<tr class="odd">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Простой URL-адрес для телефонного подключения</p></td>
<td><p>dialin.contoso.com</p></td>
</tr>
<tr class="even">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Сервер Office Web Apps</p></td>
<td><p>officewebapps01.contoso.com</p></td>
</tr>
<tr class="odd">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Внешний URL-адрес службы автообнаружения</p></td>
<td><p>lyncdiscover.contoso.com</p>



> [!NOTE]
> Если вы также используете Microsoft Exchange Server, вам также потребуется настроить правила обратного прокси-сервера для URL-адресов автообнаружения Exchange и веб-служб.

</td>
</tr>
</tbody>
</table>


<div>


> [!NOTE]
> Если ваше внутреннее развертывание состоит из нескольких серверов Standard Edition или интерфейсных пулов, вам следует настроить правила веб-публикации для каждого полного доменного имени внешней веб-фермы и потребуется использовать сертификат и веб-прослушиватель для каждого из них либо получить сертификат, альтернативное имя субъекта которого содержит имена, используемые всеми пулами, назначить его веб-прослушивателю и совместно использовать в нескольких правилах веб-публикации.



</div>

<div>

## <a name="create-a-certificate-request"></a>Создание запроса на сертификат

Вы создаете запрос на сертификат на обратном прокси-сервере. Вы создаете запрос на другом компьютере, но должен экспортировать подписанный сертификат с закрытым ключом и импортировать его на обратный прокси-сервер после того, как вы получили его от общедоступного центра сертификации.

<div>


> [!NOTE]
> Запрос на сертификат или запрос подписи сертификата (CSR) является запросом доверенного общедоступного центра сертификации (CA), который проверяет и подписывает открытый ключ запрашивающего компьютера. При создании сертификата создается открытый ключ и закрытый ключ. Только открытый ключ является общим и подписанным. Как следует из названия, Открытый ключ предоставляется любому общедоступному запросу. Открытый ключ предназначен для использования клиентами, серверами и другими запрашивающими стороны, которые требуют безопасного обмена данными и проверки удостоверения компьютера. Закрытый ключ защищен и используется только компьютером, на котором создана эта комбинация ключей для расшифровки сообщений, зашифрованных с помощью открытого ключа. Закрытый ключ можно использовать для других целей. Для обратного прокси-сервера использование шифрования данных является основным. Секондарили проверка подлинности на основе сертификата на уровне ключа сертификата является другой, и она ограничена только проверкой того, что у запрашивающего пользователя есть открытый ключ компьютера, или что компьютер, на котором есть открытый ключ, фактически является компьютером, на котором он находится.



</div>

<div>


> [!TIP]
> Если вы планируете одновременное планирование сертификатов пограничного сервера и сертификатов обратного прокси-сервера, обратите внимание на то, что существует много сходства между двумя требованиями к сертификатам. Когда вы настраиваете и запрашиваете сертификат пограничного сервера, объедините пограничный сервер и альтернативные имена субъектов обратного прокси-сервера. Вы можете использовать один и тот же сертификат для обратного прокси-сервера, если вы экспортируете сертификат и закрытый ключ и копируете экспортированный файл в обратный прокси-сервер, а затем импортируете сертификат/ключ и назначаете его в соответствии с предстоящими процедурами. Обратитесь к разделу требования к сертификатам для&nbsp;плана пограничного сервера<A href="lync-server-2013-plan-for-edge-server-certificates.md">для сертификатов пограничного сервера в Lync Server 2013</A> и обратной связи по сертификатам обратного прокси <A href="lync-server-2013-certificate-summary-reverse-proxy.md">-сервера в Lync Server 2013</A>. Убедитесь, что вы создаете сертификат с экспортируемым закрытым ключом. Для пограничных серверов poold требуется создать сертификат и запрос сертификата с экспортируемым закрытым ключом, поэтому в мастере установки Lync Server для пограничного сервера можно установить флаг <STRONG>сделать закрытые ключи экспортируемым</STRONG> . После получения запроса на сертификат из общедоступного центра сертификации вы экспортируете сертификат и закрытый ключ. В разделе "Экспорт сертификата с закрытым ключом для пограничных серверов в пуле" в разделе <A href="lync-server-2013-set-up-certificates-for-the-external-edge-interface.md">Настройка сертификатов для внешнего пограничного интерфейса для Lync Server 2013</A> для получения сведений о создании и экспорте сертификата с закрытым ключом. Расширение сертификата должно иметь тип <STRONG>PFX</STRONG>.



</div>

Чтобы создать запрос на подпись сертификата на компьютере, на котором будет назначен сертификат и закрытый ключ, выполните следующие действия.

**Создание запроса подписи сертификата**

1.  Откройте консоль управления (MMC) и добавьте оснастку "сертификаты" и выберите **Компьютеры**, а затем — **Личные**. Сведения о том, как создать консоль сертификатов в консоли управления (MMC), можно найти [http://go.microsoft.com/fwlink/?LinkId=282616](http://go.microsoft.com/fwlink/?linkid=282616)в статье.

2.  Щелкните правой кнопкой мыши пункт **Сертификаты**, выберите **все задачи**, а затем **Дополнительные операции**, щелкните **создать настраиваемый запрос**.

3.  На странице " **регистрация сертификата** " нажмите кнопку **Далее**.

4.  На странице " **Выбор политики регистрации сертификатов** " в разделе **настраиваемый запрос**выберите пункт **Продолжить без политики регистрации**. Нажмите кнопку **Далее**.

5.  На странице **настраиваемый запрос** для **шаблона** выберите **устаревший ключ (без шаблона)**. Если поставщик сертификата не управляется каким бы то ни было иным способом, не устанавливайте флажок **Отключить расширения по умолчанию** и выберите **Формат запроса** на **PKCS \#10**. Нажмите кнопку **Далее**.

6.  На странице **сведения о сертификате** нажмите кнопку **сведения**, а затем выберите пункт **Свойства**.

7.  На странице **свойств сертификата** на вкладке **Общие** в поле **понятное имя** введите имя этого сертификата. При необходимости введите описание в поле **Описание** . Понятное имя и описание обычно используются администратором для определения назначения сертификата, например **обратного прокси-прослушивателя для Lync Server**.

8.  Перейдите на вкладку **Тема** . В разделе **имя субъекта** для **типа**выберите **Общее имя** для типа имя субъекта. В поле **значение**введите имя субъекта, которое будет использоваться для обратного прокси-сервера, а затем нажмите кнопку **Добавить**. В примере, приведенном в таблице в этом разделе, имя субъекта — webext.contoso.com, и оно будет вводиться в поле Value (значение) для имени субъекта.

9.  На вкладке **Тема** в разделе **альтернативное имя**выберите **DNS** в раскрывающемся списке **тип**. Для каждого определенного альтернативного имени субъекта, которое требуется для сертификата, введите полное доменное имя и нажмите кнопку **Добавить**. Например, в таблице существует три альтернативных имени субъекта, meet.contoso.com, dialin.contoso.com и lyncdiscover.contoso.com. В поле **значение** введите Meet.contoso.com, а затем нажмите кнопку **Добавить**. Повторите эти действия для всех альтернативных имен субъектов, которые необходимо определить.

10. На странице **свойств сертификата** откройте вкладку **расширения** . На этой странице определяются криптографические ключи в **использовании ключа** и расширенное использование ключа в **расширенном использовании ключа (политики приложений)**.

11. Щелкните стрелку **использования ключа** , чтобы показать **Доступные параметры**. В разделе Доступные параметры выберите пункт **Цифровая подпись**, а затем нажмите кнопку **Добавить**. Щелкните **Шифрование ключей**, а затем нажмите кнопку **Добавить**. Если флажок **сделать критическими критические применения ключей** не установлен, установите флажок.

12. Щелкните стрелку **расширенного использования ключа (политики приложений)** , чтобы показать **Доступные параметры**. В разделе Доступные параметры выберите **Проверка подлинности сервера**, а затем нажмите кнопку **Добавить**. Выберите **Проверка подлинности клиента**, а затем нажмите кнопку **Добавить**. Если установлен флажок **сделать критическим использование расширенных ключей** , снимите этот флажок. В отличие от флажка использование ключа (необходимо проверить) необходимо убедиться в том, что флажок расширенного ключа использования не установлен.

13. На странице " **Свойства сертификата** " откройте вкладку **закрытый ключ** . Щелкните стрелку **Параметры ключа** . В раскрывающемся списке **Размер ключа**выберите **2048** . Если вы создаете эту комбинацию ключей и CSR на компьютере, отличном от обратного прокси-сервера, для которого предназначен этот сертификат, выберите **сделать закрытым ключ экспортируемым**.
    
    <div>
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/Gg398321.security(OCS.15).gif" title="защиты" alt="security" />Примечание о безопасности:</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>Выбор варианта <strong>сделать экспорт закрытого ключа</strong> рекомендуется, если в ферме есть несколько обратных прокси-серверов, так как сертификат и закрытый ключ будут скопированы на каждый компьютер в ферме. Если вы разрешите экспортируемый закрытый ключ, необходимо уделять особое внимание сертификату и компьютеру, на котором он создается. Закрытый ключ, если он скомпрометирован, будет отображать сертификат бесполезен, а потенциально предоставлять компьютеру или компьютерам доступ к внешним и другим уязвимостям системы безопасности.</td>
    </tr>
    </tbody>
    </table>
    
    </div>

14. На вкладке **закрытый ключ** щелкните стрелку **тип ключа** . Выберите параметр **Exchange** .

15. Нажмите кнопку **ОК** , чтобы сохранить заданные **Свойства сертификата** .

16. На странице " **регистрация сертификата** " нажмите кнопку **Далее**.

17. На странице **где вы хотите сохранить автономный запрос?** вам будет предложено указать **имя файла** и **Формат файла** для сохранения запроса подписи сертификата.

18. В поле **имя файла** введите путь и имя файла запроса или нажмите кнопку **Обзор** , чтобы выбрать расположение файла, и введите имя файла для запроса.

19. В качестве **формата файла**выберите **базовый 64** или **двоичный**. Выберите **Base 64** , если вы не указали иное у поставщика сертификатов.

20. Откройте файл запроса, сохраненный на предыдущем шаге. Отправляйте в свой общедоступный центр сертификации.
    
    <div>
    

    > [!IMPORTANT]
    > Корпорация Майкрософт выявила общедоступные ЦС, соответствующие требованиям для объединенных коммуникаций. Список хранится в следующей статье базы знаний. <A href="http://go.microsoft.com/fwlink/?linkid=282625">http://go.microsoft.com/fwlink/?LinkId=282625</A>

    
    </div>

</div>

</div>

<span> </span>

</div>

</div>

</div>

