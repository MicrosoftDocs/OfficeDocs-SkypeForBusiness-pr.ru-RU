---
title: 'Lync Server 2013: запрос и настройка сертификата для обратного HTTP-прокси'
TOCTitle: Запрос и настройка сертификата для обратного HTTP-прокси
ms:assetid: 4b70991e-5f10-40a3-b069-0b227c3a3a0a
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Gg429704(v=OCS.15)
ms:contentKeyID: 49309689
ms.date: 12/10/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Запрос и настройка сертификата для обратного HTTP-прокси в Lync Server 2013

 

_**Дата изменения раздела:** 2016-12-08_

Вам требуется установить сертификат корневого центра сертификации (ЦС) на сервере с шлюзом Microsoft Forefront Threat Management Gateway 2010 или с маршрутизацией запросов приложений IIS для инфраструктуры ЦС, выдавшего серверные сертификаты внутренним серверам с Microsoft Lync Server 2013.

Вам также следует установить общий сертификат веб-сервера на обратный прокси-сервер. Альтернативные имена субъектов этого сертификата должны содержать опубликованные внешние полные доменные имена для каждого пула, в котором размещаются пользователи с включенной поддержкой удаленного доступа, а также внешние полные доменные имена всех Директоров или пулов Директоров, которые будут использоваться в рамках пограничной инфраструктуры. Альтернативное имя субъекта также должно содержать простой URL-адрес собрания, простой URL-адрес для телефонного подключения и – если вы развертываете мобильные приложения и планируете использовать автоматическое обнаружение – внешний URL-адрес службы автообнаружения, как показано в следующей таблице.


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Значение</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Имя субъекта</p></td>
<td><p>Полное доменное имя пула</p></td>
<td><p>webext.contoso.com</p></td>
</tr>
<tr class="even">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Полное доменное имя пула</p></td>
<td><p>webext.contoso.com</p>

> [!IMPORTANT]  
> Это имя субъекта также должно присутствовать в альтернативном имени субъекта.

</td>
</tr>
<tr class="odd">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Необязательно Директор Веб-службы (если развернут Директор)</p></td>
<td><p>webdirext.contoso.com</p></td>
</tr>
<tr class="even">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Простой URL-адрес собрания</p>

> [!NOTE]  
> Все простые URL-адреса собраний должны находиться в альтернативном имени субъекта. Каждый SIP-домен должен иметь хотя бы один активный простой URL-адрес собрания.

</td>
<td><p>meet.contoso.com</p></td>
</tr>
<tr class="odd">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Простой URL-адрес для телефонного подключения</p></td>
<td><p>dialin.contoso.com</p></td>
</tr>
<tr class="even">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>сервер Office Web Apps</p></td>
<td><p>officewebapps01.contoso.com</p></td>
</tr>
<tr class="odd">
<td><p>Альтернативное имя субъекта</p></td>
<td><p>Внешний URL-адрес службы автообнаружения</p></td>
<td><p>lyncdiscover.contoso.com</p>

> [!NOTE]  
> Если вы также используете Microsoft Exchange Server, то необходимо настроить правила обратного прокси-сервера для автообнаружения Exchange и URL-адресов веб-служб.

</td>
</tr>
</tbody>
</table>


> [!NOTE]  
> Если ваше внутреннее развертывание состоит из нескольких серверов Standard Edition или интерфейсных пулов, вам следует настроить правила веб-публикации для каждого полного доменного имени внешней веб-фермы и потребуется использовать сертификат и веб-прослушиватель для каждого из них либо получить сертификат, альтернативное имя субъекта которого содержит имена, используемые всеми пулами, назначить его веб-прослушивателю и совместно использовать в нескольких правилах веб-публикации.

## Создание запроса сертификата

Вы можете создать запрос сертификата на обратном прокси-сервере. Этот запрос создается на другом компьютере, но после получения закрытого ключа из публичного центра сертификации необходимо экспортировать подписанный сертификат с этим ключом, а затем импортировать его на обратный прокси-сервер.

> [!NOTE]  
> Запрос сертификата или запрос подписи сертификата (CSR) – это запрос к доверенному публичному центру сертификации (ЦС) на проверку и подписание открытого ключа запрашивающего компьютера. При создании сертификата создаются открытый и закрытый ключи. Только открытый ключ подписывается и является общедоступным. Как следует из названия, открытый ключ делается доступным для любого общедоступного запроса. Открытый ключ предназначен для использования клиентами, серверами и другими инициаторами запросов, которым нужно безопасно обмениваться данными и проверять удостоверение компьютера. Закрытый ключ хранится в безопасном месте и используется только тем компьютером, на котором создана пара ключей для расшифровки сообщений, зашифрованных с помощью открытого ключа. Закрытый ключ можно использовать для других целей. Для потребностей обратного прокси-сервера в первую очередь используется шифрование данных. Также используется проверка подлинности с помощью сертификата на уровне ключа сертификата. В эту проверку входит только подтверждение, что инициатор запроса имеет открытый ключ компьютера или компьютер, для которого есть открытый ключ, на самом деле является тем, за кого себя выдает.


> [!TIP]
> Если вы планируете использовать сертификаты сервер и сертификаты обратного прокси-сервера одновременно, учтите, что требования к этим сертификатам очень похожи. При настройке и запросе сертификата сервер объедините альтернативные имена субъекта сервер и обратного прокси-сервера. Вы можете использовать этот же сертификат для обратного прокси-сервера, если экспортируете сертификат с закрытым ключом и скопируете экспортированный файл на обратный прокси-сервер, а затем импортируете сертификат или пару ключей и назначите их, как того требуют предстоящие процедуры. Ознакомьтесь с требованиями к сертификатам для сервер&nbsp; <A href="lync-server-2013-plan-for-edge-server-certificates.md">Планирование сертификатов пограничного сервера в Lync Server 2013</A> и обратного прокси-сервера <A href="lync-server-2013-certificate-summary-reverse-proxy.md">Сводка по сертификатам — обратный прокси-сервер в Lync Server 2013</A>. Обязательно создайте сертификат с экспортируемым закрытым ключом. Создание сертификата и запроса сертификата с экспортируемым закрытым ключом необходимо для сервера сервер, входящего в состав пула. Это обычная процедура, и мастер сертификатов в развертывания Lync Server для сервер позволит вам установить флажок <STRONG>Сделать закрытый ключ экспортируемым</STRONG> . Как только вы получите обратно запрос сертификата от публичного центра сертификации, вы экспортируете сертификат и закрытый ключ. Чтобы узнать больше о том, как создавать и экспортировать сертификат с закрытым ключом, см. раздел "Экспорт сертификата с закрытым ключом для пограничных серверов в пуле" в статье <A href="lync-server-2013-set-up-certificates-for-the-external-edge-interface.md">Настройка сертификатов для внешнего интерфейса пограничного сервера для Lync Server 2013</A>. Сертификат должен иметь расширение <STRONG>.PFX</STRONG>.



Чтобы создать запрос подписи сертификата на компьютере, на котором будут назначаться сертификат и закрытый ключ, выполните указанные ниже действия.

**Создание запроса подписи сертификата**

1.  Откройте (MMC) и добавьте оснастку сертификатов, а затем выберите пункт **Компьютеры** и разверните раздел **Личное** . Подробные сведения о создании консоли сертификатов в (MMC) см. на веб-странице [http://go.microsoft.com/fwlink/?LinkId=282616](http://go.microsoft.com/fwlink/?linkid=282616).

2.  Щелкните правой кнопкой мыши пункт **Сертификаты** и выберите команду **Все задачи**  \> **Дополнительные операции**  \> **Создать настраиваемый запрос** .

3.  На странице **Регистрация сертификата** нажмите кнопку **Далее** .

4.  На странице **Выбор политики регистрации сертификатов** в разделе **Настраиваемый запрос** выберите пункт **Продолжить без политики регистрации** . Нажмите кнопку **Далее** .

5.  На странице **Настраиваемый запрос** для значения **Шаблон** выберите пункт **Старый ключ (без шаблона)** . Если иное не указано поставщиком сертификатов, снимите флажок **Не показывать расширения по умолчанию** и выберите для параметра **Формат запроса** значение **PKCS \#10** . Нажмите кнопку **Далее** .

6.  На странице **Сведения о сертификате** щелкните пункт **Сведения** , а затем  **Свойства** .

7.  На странице **Свойства сертификата** на вкладке **Общие** в поле **Понятное имя** введите имя этого сертификата. При необходимости введите описание в поле **Описание** . Понятное имя и описание, как правило, используются администратором, чтобы узнать назначение сертификата (например, **Слушатель обратного прокси-сервера для Lync Server**).

8.  Выберите вкладку **Субъект** . В разделе **Имя субъекта** для параметра **Тип** выберите значение **Общее имя** в качестве типа имени субъекта. В поле **Значение** введите имя субъекта, которое будет использоваться для обратного прокси-сервера, а затем нажмите кнопку **Добавить** . В примере, приведенном в таблице в этом разделе, имя субъекта – webext.contoso.com; это имя было бы введено в поле "Значение" в качестве имени субъекта.

9.  На вкладке **Субъект** в разделе **Альтернативное имя** в раскрывающемся списке параметра **Тип** выберите значение **DNS** . Для каждого указанного альтернативного имени субъекта, требуемого в сертификате, введите полное доменное имя, а затем нажмите кнопку **Добавить** . Например, в таблице приведены три альтернативных имени субъекта: meet.contoso.com, dialin.contoso.com и lyncdiscover.contoso.com. В поле **Значение** введите meet.contoso.com и нажмите кнопку **Добавить** . Повторите эти действия для альтернативных имен каждого субъекта, который необходимо указать.

10. На странице **Свойства сертификата** выберите вкладку **Расширения** . На этой странице нужно указать назначения криптографических ключей в поле **Использование ключа** , а также расширенное использование ключа в поле **Расширенное использование ключа (политики применения)** .

11. Нажмите стрелку **Использование ключа** , чтобы отобразить **Доступные параметры** . В этом разделе щелкните пункт **Цифровая подпись** и выберите команду **Добавить** . Щелкните пункт **Шифрование ключей** и нажмите кнопку **Добавить** . Если флажок **Сделать критическими** снят, установите его.

12. Нажмите стрелку **Расширенное использование ключа (политики применения)** , чтобы отобразить **Доступные параметры** . В этом разделе щелкните пункт **Серверная проверка подлинности** и нажмите кнопку **Добавить** . Щелкните пункт **Проверка подлинности клиента** и нажмите кнопку **Добавить** . Если установлен флажок **Сделать расширенное использование ключа критическим** , снимите его. В отличие от флажка использования ключа (который должен быть установлен), флажок "Расширенное использование ключа" необходимо снять.

13. На странице **Свойства сертификата** выберите вкладку **Закрытый ключ** . Щелкните стрелку **Параметры ключа** . Для значения **Размер ключа** выберите в раскрывающемся списке значение **2048** . Если вы создаете эту пару ключей и запрос подписи сертификата не на обратном прокси-сервере, для которого предназначен этот сертификат, а на другом компьютере, выберите пункт **Сделать закрытый ключ экспортируемым** .
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/Gg398321.security(OCS.15).gif" title="security" alt="security" />Sicherheit Hinweis:</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>Выбор параметра <strong>Сделать закрытый ключ экспортируемым</strong> рекомендуется, если ферма содержит несколько обратных прокси-серверов, так как сертификат и закрытый ключ понадобится скопировать на каждый из них. Если экспорт закрытого ключа разрешен, необходимо проявить особое внимание к сертификату и компьютеру, на котором он создан. Взломанный закрытый ключ сделает сертификат бесполезным, так как подвергнет компьютеры опасности внешнего доступа и других атак.</td>
    </tr>
    </tbody>
    </table>

14. На вкладке **Закрытый ключ** нажмите стрелку **Тип ключа** . Выберите параметр **Обмен** .

15. Нажмите кнопку **ОК** , чтобы сохранить установленные **Свойства сертификата** .

16. На странице **Регистрация сертификата** нажмите кнопку **Далее** .

17. На странице **Где вы хотите сохранить автономный запрос?** появится запрос на ввод значений в поля **Имя поля** и **Формат файла** для сохранения запроса подписи сертификата.

18. В поле **Имя файла** введите путь и имя файла для запроса или нажмите кнопку **Обзор** , чтобы выбрать папку для файла, и введите имя файла для запроса .

19. Выберите для пункта **Формат файла** значение **Base 64** или **Двоичный** . Если поставщиком сертификатов не указано иное, выберите значение **Base 64** .

20. Найдите файл запроса, который сохранили при выполнении предыдущего действия. Отправьте его в общий центр сертификации.
    
    > [!IMPORTANT]  
    > Корпорация Майкрософт определила общие центры сертификации, отвечающие требованиям объединенных коммуникаций. Список можно просмотреть в статье базы знаний по адресу <a href="http://go.microsoft.com/fwlink/?linkid=282625">http://go.microsoft.com/fwlink/?LinkId=282625</a>
