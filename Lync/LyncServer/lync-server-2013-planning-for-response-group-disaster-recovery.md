---
title: 'Lync Server 2013: планирование аварийного восстановления для группы ответа'
TOCTitle: Планирование аварийного восстановления для группы ответа
ms:assetid: 14e0f5dc-77cd-42cd-a9c9-4d0da38fb1cf
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ204699(v=OCS.15)
ms:contentKeyID: 49309032
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Планирование аварийного восстановления для группы ответа в Lync Server 2013

 

_**Дата изменения раздела:** 2015-03-09_

В этом разделе описываются некоторые способы подготовки групп ответа к аварийному восстановлению, а также дается обзор процесса аварийного восстановления.

## Подготовка ответа к аварийному восстановлению

При подготовке и выполнении процедур аварийного восстановления необходимо учитывать следующее.

> [!NOTE]  
> В среде сосуществования процедуры аварийного восстановления, описываемые в данном документе, поддерживаются только для групп ответа сервера Lync Server 2013.

  - Планирование аварийного восстановления необходимо выполнять во время планирования мощности. При расчете мощности аварийного восстановления каждый сопряженный пул в паре должен иметь возможность обработки рабочей нагрузки от всех групп ответа в обоих пулах. Сведения о планировании мощности групп ответа см. в статье [Планирование емкости для группы ответа в Lync Server 2013](lync-server-2013-capacity-planning-for-response-group.md).

  - Используя процедуру экспорта, описываемую в этом документе, следует регулярно создавать резервные копии всех конфигураций групп ответа на всех серверах переднего плана, на которых развернуто приложение "Группа ответа". Подробности см. в разделе [Процедуры аварийного восстановления группы ответа в Lync Server 2013](lync-server-2013-response-group-disaster-recovery-procedures.md). Резервные копии должны храниться в надежном месте.

  - Следует хранить отдельную резервную копию всех исходных аудиофайлов, используемых для приложения "Группа ответа", включая все записи и файлы музыкальных заставок при удержании вызова. Резервные файлы должны храниться в надежном месте.

  - Для восстановления сервера Lync Server 2013 в аварийных ситуациях все параметры групп ответа должны иметь уникальные имена во всем развертывании. Это требование действует в отношении рабочих процессов, очередей, групп агентов, наборов праздников и рабочего времени. Необходимо убедиться в выполнении этого требования, когда основной и резервный пулы все еще активны и до инициирования любой процедуры обхода неисправности. Если возникает конфликт имен при импорте данных группы ответа в резервный пул, импорт завершается неудачей. Для выполнения импорта и процедуры обхода неисправности необходимо разрешить конфликт имен путем переименования объекта группы ответа в резервном пуле или с помощью командлета **Import-CsRgsConfiguration** с параметром –ResolveNameConflicts, чтобы автоматически разрешить конфликт посредством добавления уникального идентификационного номера к объекту группы ответа.

  - В целом рекомендуется выполнять ежедневное резервное копирование, но при наличии больших объемов изменений может потребоваться запланировать более частое создание резервных копий. Объем сведений, которые можно потерять в случае аварии, зависит от частоты резервного копирования, а также от частоты и масштабов изменений.

  - Группы ответа можно импортировать в резервный пул до возникновения аварийной ситуации или операции обхода неисправности. При заблаговременном импортировании групп ответа уменьшаются простои, поскольку группы ответа Lync Server могут быть восстановлены в резервном пуле, как только вызовы будут направлены в этот резервный пул.
    
    > [!NOTE]  
    > Агенты, размещаемые в неактивном пуле, находятся вне зоны действия приложения &quot;Группа ответа&quot;, пока не завершится обход отказа. В течение этого времени приложение &quot;Группа ответа&quot; обрабатывает вызовы так, как если бы эти агенты были недоступны.

## Процесс аварийного восстановления групп ответа

В случае аварийной ситуации группы ответа можно восстановить, используя любой из следующих способов восстановления:

  - Обойти неисправность по пути в резервный пул, а затем обойти неисправность в обратном направлении, по пути в исходный пул.

  - Обойти неисправность по пути в резервный пул, создать новый пул с другим полным доменным именем (FQDN) и затем импортировать группы ответа в этот новый пул.

Во время восстановления в аварийных ситуациях на этапе обхода неисправности группы ответа находятся в нескольких пулах: в основном пуле (который не доступен) и в резервном пуле. Группы ответа в обоих пулах имеют одно и то же имя и одного и того же владельца (основной пул), но у них разные родительские объекты.

При восстановлении путем создания нового пула с другим полным доменным именем необходимо назначить этот новый пул владельцем групп ответа при их импорте. Исходный пул продолжает оставаться владельцем этих групп ответа, пока владелец не будет явно переназначен с помощью параметра –OverwriteOwner командлета **Import-CsRgsConfiguration**.

> [!NOTE]  
> Следует также использовать параметр –OverwriteOwner, если во время восстановления пул пересоздавался (то есть, база данных ответа является пустой) независимо от того, используется или нет то же полное доменное имя. В применении параметра -OverwriteOwner нет необходимости, если вы не пересоздавали пул, однако этот параметр допускается использовать каждый раз, когда выполняется импорт групп ответа обратно в основной пул.

Можно задавать только один набор параметров конфигурации группы ответа на уровне приложения на пул. В эти параметры входит настройка музыкальных заставок при удержании вызова, период отсрочки переключения агента на удерживаемого абонента и настройка контекста вызова. Чтобы просмотреть эти параметры конфигурации, выполните командует **Get-CsRgsConfiguration**. Сведения о командлете **Get-CsRgsConfiguration** см. в описании командлета [Get-CsRgsConfiguration](https://docs.microsoft.com/powershell/module/skype/Get-CsRgsConfiguration).

Передавать эти параметры уровня приложения из одного пула в другой можно с помощью командлета **Import-CsRgsConfiguration** с параметром -ReplaceExistingSettings, но при этом будут переопределены параметры в целевом пуле.

> [!IMPORTANT]  
> Это ограничение передачи параметров в другой пул действительно только для параметров на уровне приложения и звукового файла музыкальной заставки при удержании вызова, установленного по умолчанию. Оно недействительно для групп агентов, очередей, рабочих процессов, рабочих часов и праздничных дней.

Если вы не хотите заменять параметры на уровне приложения в резервном пуле во время аварийной ситуации, а основной пул не удается восстановить, параметры уровня приложения из основного пула будут утрачены. Если во время аварийной ситуации вам нужно создать новый пул для замены основного пула с тем же самым или с другим полным доменным именем, исходные параметры уровня приложения восстановить не удастся. В этом случае потребуется настроить новый пул с этими параметрами и включить аудиофайл музыкальной заставки, используемой при удержании вызова.

Если вы решили передавать параметры уровня приложения из основного пула в резервный пул во время аварии с помощью командлета **Import-CsRgsConfiguration**, то затем можно будет передать эти параметры из резервного пула в новый во время восстановления так же, как они передавались из основного пула в резервный.

В следующей таблице дается обзор действий, из которых состоит восстановление групп ответа.

Сведения о выполнении этих действий см. в разделе [Процедуры аварийного восстановления группы ответа в Lync Server 2013](lync-server-2013-response-group-disaster-recovery-procedures.md).

### Действия по аварийному восстановлению групп ответа

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Этап</th>
<th>Шаги</th>
<th>Необходимые группы и роли</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>До сбоя</p></td>
<td><p>На регулярной основе запускайте командует <strong>Export-CsRgsConfiguration</strong> для создания резервных копий всех конфигураций групп ответа на всех серверах переднего плана, где развернуто приложение &quot;Группа ответа&quot;.</p></td>
<td><p>RTCUniversalServerAdmins</p>
<p>CsResponseGroupAdministrator</p></td>
</tr>
<tr class="even">
<td><p>Во время сбоя</p></td>
<td><p>Выполните командует <strong>Import-CsRgsConfiguration</strong> для импорта резервной копии конфигурации группы ответа Lync Server из основного пула в резервный.</p>

> [!NOTE]  
> Используйте параметр -ReplaceExistingSettings, если требуется заменить параметры группы ответа уровня приложения в резервном пуле на параметры из основного пула. Если не передать параметры уровня приложения из основного пула в резервный, и основной пул невозможно восстановить, то эти параметры в основном пуле будут потеряны.

</td>
<td><p>RTCUniversalServerAdmins</p>
<p>CsResponseGroupAdministrator</p></td>
</tr>
<tr class="odd">
<td><p>После импорта</p></td>
<td><p>Выполните командлеты ответа или с параметром -ShowAll (для отображения всех групп ответа), или с параметром -Owner (для отображения только импортированных групп ответа), чтобы проверить, все ли конфигурации групп ответа были импортированы в резервный пул.</p>

> [!IMPORTANT]  
> Если не используется ни параметр -ShowAll, ни параметр -Owner, группы ответа, импортированные в резервный пул, не выводятся в списке результатов, возвращаемых командлетами.

<p>Выполните следующие командлеты:</p><ul><li><p><strong>Get-CsRgsWorkflow</strong></p></li><li><p><strong>Get-CsRgsQueue</strong></p></li><li><p><strong>Get-CsRgsAgentGroup</strong></p></li><li><p><strong>Get-CsRgsHoursOfBusiness</strong></p></li><li><p><strong>Get-CsRgsHolidaySet</strong></p></li></ul></td>
<td><p>RTCUniversalServerAdmins</p>
<p>CsResponseGroupAdministrator</p></td>
</tr>
<tr class="even">
<td><p>После отработки отказа</p></td>
<td><ul><li><p>Выполните тестовый вызов группы ответа, которая была импортирована в резервный пул, и убедитесь, что вызов обрабатывается правильно.</p></li><li><p>Все формальные агенты должны снова войти в свои формальные группы в резервном пуле.</p></li><li><p>Управление изменениями конфигурации:</p>
<p>группы ответа в резервном пуле, как импортированные в этот пул, так и принадлежащие ему, могут быть изменены как обычно во время сбоя.</p>

> [!IMPORTANT]  
> Для управления группами ответа, импортированными в резервный пул, необходимо использовать сервер Командная консоль Lync Server. Для управления этими группами ответа, когда они находятся в резервном пуле, невозможно использовать панель управления Lync Server.

</li></ul></td>
<td><p>Н/Д</p></td>
</tr>
<tr class="odd">
<td><p>После восстановления, до возвращения</p></td>
<td><p>Выполните командует <strong>Export-CsRgsConfiguration</strong>, указав в параметре -Source резервный пул, а в параметре -Owner основной пул, чтобы экспортировать из резервного пула группы ответа, принадлежавшие основному пулу.</p></td>
<td><p>RTCUniversalServerAdmins</p>
<p>CsResponseGroupAdministrator</p></td>
</tr>
<tr class="even">
<td><p>После возвращения</p></td>
<td><ul><li><p>Выполните командует <strong>Import-CsRgsConfiguration</strong>, чтобы импортировать группы ответа обратно в основной пул.</p>

> [!NOTE]  
> Если основной пул невозможно восстановить, и для его замены был развернут новый пул, используйте параметр -ReplaceExistingSettings для передачи параметров уровня приложения из резервного пула в новый. Если не передать параметры из резервного пула, то новый пул будет использовать параметры по умолчанию.

</li><li><p>Выполните следующие командлеты с параметром -ShowAll (для отображения всех групп ответа) или с параметром -Owner (для отображения только импортированных групп ответа), чтобы убедиться, что все конфигурации групп ответа были успешно импортированы обратно в основной пул.</p><ul><li><p><strong>Get-CsRgsWorkflow</strong></p></li><li><p><strong>Get-CsRgsQueue</strong></p></li><li><p><strong>Get-CsRgsAgentGroup</strong></p></li><li><p><strong>Get-CsRgsHoursOfBusiness</strong></p></li><li><p><strong>Get-CsRgsHolidaySet</strong></p></li></ul></li><li><p>Выполните тестовый вызов группы ответа, которая была импортирована обратно в основной пул, и проверьте, правильно ли обрабатывается этот вызов.</p></li><li><p>Дополнительно можно выполнить в резервном пуле командует <strong>Export-CsRgsConfiguration</strong> с параметром -RemoveExportedConfiguration, чтобы удалить из резервного пула все группы ответа, принадлежавшие основному пулу.</p></li></ul></td>
<td><p>RTCUniversalServerAdmins</p>
<p>CsResponseGroupAdministrator</p></td>
</tr>
</tbody>
</table>

