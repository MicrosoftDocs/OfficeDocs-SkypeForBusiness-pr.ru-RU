---
title: 'Lync Server 2013: Настройка Федерации XMPP'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Setting up XMPP federation
ms:assetid: 5fda6cb7-8d4d-495d-90c7-601f1036e085
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ204939(v=OCS.15)
ms:contentKeyID: 48184270
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 4e34e47eaa5cd4bf8ffc2fccbc2a8bcb3f4f2de5
ms.sourcegitcommit: 831d141dfc5a49dd764cb296b73b63e5a9f8e599
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/21/2020
ms.locfileid: "42181952"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="setting-up-xmpp-federation-in-lync-server-2013"></a>Настройка Федерации XMPP в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2012-12-03_

Для развертывания прокси-сервера XMPP на пограничном сервере необходимо настроить пограничный сервер для федерации XMPP. Для этого выполните следующие действия.

<div>

## <a name="setting-up-xmpp-federation"></a>Настройка федерации XMPP

1.  Выполните вход на компьютер, на котором установлен мастер развертывания Lync Server, в качестве члена группы администраторов домена и группы RTCUniversalServerAdmins.

2.  На сервере переднего плана откройте мастер развертывания Lync Server. Последовательно выберите пункты "Install or Update Lync Server System" ("Установка или обновление системы Lync Server") и "Setup or Remove Lync Server Components" ("Установка или удаление компонентов Lync Server"). Нажмите "Run Again" ("Запустить снова").

3.  В диалоговом окне "Установка компонентов Lync Server" нажмите кнопку "Далее". В окне сводки будут показаны действия по мере их выполнения. После завершения развертывания нажмите кнопку "Просмотр журнала", чтобы открыть доступные файлы журналов. Нажмите кнопку "Готово", чтобы завершить развертывание.

4.  На пограничном сервере откройте мастер развертывания Lync Server. Последовательно выберите пункты "Install or Update Lync Server System" ("Установка или обновление системы Lync Server") и "Setup or Remove Lync Server Components" ("Установка или удаление компонентов Lync Server"). Нажмите "Run Again" ("Запустить снова").

5.  В окне установки компонентов Lync Server нажмите кнопку "Далее". В экране сводки будут показываться действия по мере их выполнения. После выполнения развертывания нажмите "Просмотр журнала", чтобы просмотреть доступные файлы журналов. Чтобы завершить развертывание, нажмите кнопку "Готово".

6.  На пограничном сервере в мастере развертывания рядом с пунктом "Step 3: Request, Install, or Assign Certificates" ("Шаг 3. Запрос, установка или назначение сертификатов") нажмите "Run again" ("Запустить снова").
    
    <div class=" ">
    

    > [!TIP]  
    > Если развертывание пограничного сервера выполняется впервые, то вместо кнопки "Run Again" ("Запустить снова") появится кнопка "Run" ("Запустить").

    
    </div>

7.  На странице "Available Certificate Tasks" ("Доступные задачи с сертификатами") выберите "Create a new certificate request" ("Создать новый запрос сертификата").

8.  На странице запрос сертификата щелкните сертификат внешнего пограничного сервера.

9.  На странице "Delayed or Immediate Request" ("Отложенный или немедленный запрос") установите флажок "Prepare the request now, but send it later" ("Подготовить запрос сейчас, чтобы отправить его позже").

10. На странице файл запроса сертификата введите полный путь и имя файла, в который будет сохранен запрос (например, c:\\CERT\_ексернал\_Edge. cer).

11. На странице "Specify Alternate Certificate Template" ("Указать другой шаблон сертификата")  установите флажок "Use alternative certificate template for the selected certification authority" ("Использовать другой шаблон для выбранного центра сертификации"), чтобы использовать шаблон сертификата, отличный от установленного по умолчанию шаблона WebServer.

12. На странице "Name and Security Settings" ("Имя и параметры безопасности") выполните следующие действия.
    
    1.  В поле "Friendly name" ("Понятное имя") введите отображаемое имя для сертификата.
    
    2.  В поле "Bit length" ("Длина в битах")  задайте длину в битах (обычно это установленное по умолчанию значение 2048).
    
    3.  Убедитесь, что установлен флажок "Mark certificate private key as exportable" ("Пометить закрытый ключ сертификата как экспортируемый").

13. На странице "Organization Information" ("Сведения об организации") введите имя организации и подразделение (например, отделение или отдел).

14. На странице "Geographical Information" ("Сведения о местоположении") укажите сведения о местоположении.

15. На странице "Subject Name/Subject Alternate Names" ("Имя субъекта/альтернативные имена субъектов") отображаются сведения, автоматически заполненные мастером. Если нужны дополнительные альтернативные имена субъектов, укажите их в следующих двух действиях.

16. На странице Параметры домена SIP в альтернативных именах субъектов (SAN) установите флажок домен, чтобы добавить SIP. \<sipdomain\> запись в список альтернативных имен субъектов.

17. На странице "Configure Additional Subject Alternate Names" ("Настройка дополнительных альтернативных имен субъекта") укажите все нужные дополнительные альтернативные имена субъектов.
    
    <div class=" ">
    

    > [!TIP]  
    > Если устанавливается прокси-сервер XMPP, то по умолчанию в записях SAN появляется имя домена (например, contoso.com). Если нужны дополнительные записи, добавьте их на этом шаге.

    
    </div>

18. На странице "Request Summary" ("Сводка по запросу") просмотрите сведения о сертификате, которые будут использоваться для создания запроса.

19. После завершения выполнения команд можно просмотреть журналы или для продолжения нажать кнопку "Далее".

20. На странице "Certificate Request File" ("Файл запроса сертификата") можно просмотреть файл запроса подписи сертификата (CSR-файл), нажав кнопку "View" ("Просмотр"), или выйти из мастера сертификатов, нажав кнопку "Готово".

21. Скопируйте этот файл запроса и отправьте его в свой общедоступный центр сертификации.

22. После получения, импорта и назначения общедоступного сертификата необходимо остановить и перезапустить службы пограничного сервера. Это можно сделать, введя в консоли управления Lync Server следующую команду:
    
       ```PowerShell
        Stop-CsWindowsService
       ```
    
       ```PowerShell
        Start-CsWindowsService
       ```

23. Чтобы настроить DNS для Федерации XMPP, добавьте следующую запись SRV к внешнему DNS:\_XMPP-Server. \_TCP. \<доменное\> имя. запись SRV будет РАЗРЕШАТЬся в полное доменное имя пограничного сервера доступа с портом 5269. Кроме того, вы настраиваете запись узла "A" (например, xmpp.contoso.com), которая указывает на IP-адрес пограничного сервера доступа.
    
    <div class=" ">
    

    > [!IMPORTANT]  
    > При наличии пограничных пулов в нескольких сайтах рекомендуется добавить несколько SRV-записей для федерации XMPP. Добавьте SRV-запись для каждого пограничного пула в организации и предоставьте каждой SRV-записи собственный приоритет. При работе всех пулов пограничных серверов запросы XMPP будут обрабатываться пограничным пулом с первым приоритетом, однако если этот пограничный пул станет неработоспособным,  не нужно будет добавлять новую SRV-запись для восстановления функций федерации XMPP.

    
    </div>

24. Настройте новую политику внешнего доступа, чтобы включить всех пользователей, открыв командную консоль Lync Server на сервере переднего плана и введя в ней следующую команду:
    
       ```PowerShell
        New-CsExternalAccessPolicy -Identity <name of policy to create.  If site scope, prepend with 'site:'> -EnableFederationAcces $true -EnablePublicCloudAccess $true
       ```
    
       ```PowerShell
        New-CsExternalAccessPolicy -Identity FedPic -EnableFederationAcces $true -EnablePublicCloudAccess $true
       ```
    
       ```PowerShell
        Get-CsUser | Grant-CsExternalAccessPolicy -PolicyName FedPic
       ```
    
    Включите XMPP-доступ для внешних пользователей, введя следующую команду:
    
       ```PowerShell
        Set-CsExternalAccessPolicy -Identity <name of the policy being used> EnableXmppAccess $true
       ```
    
       ```PowerShell
        Set-CsExternalAccessPolicy -Identity FedPic -EnableXmppAccess $true
       ```

25. На пограничном сервере, на котором развернут прокси-сервер XMPP, откройте командную строку или интерфейс командной строки Windows PowerShell™ и введите следующую команду:
    
       ```PowerShell
        Netstat -ano | findstr 5269
       ```
    
       ```PowerShell
        Netstat -ano | findstr 23456
       ```
    
    Команда **netstat – АНО** — это команда сетевой статистики, запрос Parameters **— АНО** , который отображает все подключения и порты, адреса и порты отображаются в виде числовых форм и с каждым подключением связан идентификатор процесса-владельца. Символ **|** определяет канал для следующей команды, **findstr**или String Find. Число 5269 и 23456, которое передается в findstr в качестве параметра, дает команду findstr для поиска в выходных данных netstat для строк 5269 и 23456. Если XMPP настроен правильно, результат выполнения команд должен привести к прослушиванию и установлению подключений как на внешнем интерфейсе (порт 5269), так и во внутреннем интерфейсе (Port 23456) пограничного сервера.
    
    Если команды не возвращают сведения об установленных подключениях или прослушивании по портам 5269 и 23456, проверьте приведенные ниже элементы.

</div>

<div>

## <a name="troubleshooting-xmpp-federation"></a>Устранение неполадок, связанных с федерацией XMPP

1.  Чтобы определить, работает ли прокси-сервер XMPP, выполните следующие действия.

2.  Выполните вход на пограничный сервер, на котором работает служба прокси-сервера XMPP, от имени члена группы локальных администраторов.

3.  Щелкните **Пуск**, **Все программы**, **Средства администрирования**, затем **Службы**

4.  В оснастке "Службы" найдите службу "Прокси-сервер шлюза преобразования XMPP Lync Server". Эта служба должна быть в состоянии **Работает**. Если она не запущена, щелкните значок **Запуск службы** на панели инструментов. Значок принимает вид зеленой стрелки, направленной вправо.

5.  Убедитесь, что состояние службы указано как **Работает**. Если служба запустилась успешно, закройте оснастку **Службы** и продолжите работу.
    
    Если служба не запустилась успешно, в средствах администрирования откройте средство просмотра событий и просмотрите ошибки и предупреждения в разделе **Lync Server****журналов приложений и служб**.

6.  После запуска службы **Шлюз преобразования XMPP Lync Server** повторно выполните вышеуказанные команды netstat. Если вы не видите установленные или прослушиваемые сеансы, проверьте и убедитесь, что в построителе топологий правильно настроен **маршрут Федерации XMPP**

7.  Войдите в систему компьютера, на котором построитель топологий установлен как член группы администраторов доменов и группы RTCUniversalServerAdmins.

8.  Запустите построитель топологий: нажмите кнопку **Пуск**, последовательно выберите пункты **все программы**, **Microsoft Lync Server 2013**и **Построитель топологий Lync Server**.

9.  В построителе топологий выберите сайт для маршрута Федерации XMPP и просмотрите его, чтобы убедиться, что **назначение маршрутизации Федерации сайтов** для **Федерации XMPP** показывает пограничный сервер или пограничный пул в качестве выбранного назначения маршрута Федерации XMPP.
    
    Если назначение маршрута неправильно или не задано, щелкните его правой кнопкой мыши и выберите команду **изменить свойства**. Установите флажок Федерация XMPP, а затем выберите правильный пограничный сервер или пограничный пул.

10. Опубликуйте топологию. Дополнительные сведения см [в статье публикация топологии в Lync Server 2013](lync-server-2013-publish-your-topology.md)
    
    <div class=" ">
    

    > [!TIP]  
    > Хотя это не обязательно и не требуется, может потребоваться перезапустить пограничные серверы.

    
    </div>

11. С помощью процесса netstat, который использовался ранее, убедитесь, что пограничный сервер прослушивает или установил сеансы на порте 5269 и порт 23456.

12. Если ожидаемых сеансов все еще не отображается, просмотрите средство просмотра событий на предмет возможных причин проблем со связью.

</div>

<div>

## <a name="see-also"></a>См. также


[Пример конфигурации XMPP в Lync Server 2013 – XMPP Федерация с Google говорите](lync-server-2013-example-xmpp-configuration-–-xmpp-federation-with-google-talk.md)  


[Управление федеративными партнерами XMPP в Lync Server 2013](lync-server-2013-manage-xmpp-federated-partners-for-your-organization.md)  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

