---
title: 'Lync Server 2013: настройка федерации XMPP'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Setting up XMPP federation
ms:assetid: 5fda6cb7-8d4d-495d-90c7-601f1036e085
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ204939(v=OCS.15)
ms:contentKeyID: 48184270
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: fd61aded33d37e4a1f5f58e9050f3cd62794f9b6
ms.sourcegitcommit: b693d5923d6240cbb865241a5750963423a4b33e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2020
ms.locfileid: "41732049"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="setting-up-xmpp-federation-in-lync-server-2013"></a>Настройка федерации XMPP в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Тема последнего изменения:** 2012-12-03_

Для развертывания прокси-сервера КСМПП на пограничном сервере необходимо настроить граничный сервер для КСМПП Федерации. Для этого выполните указанные ниже действия.

<div>

## <a name="setting-up-xmpp-federation"></a>Настройка Федерации КСМПП

1.  Войдите в систему на компьютере, на котором установлен мастер развертывания Lync Server, в группе Администраторы домена и в группу Рткуниверсалсерверадминс.

2.  На сервере переднего плана откройте мастер развертывания Lync Server. Щелкните Установка или обновление операционной системы Lync Server, а затем нажмите кнопку Настройка или удалите компоненты Lync Server. Нажмите кнопку выполнить еще раз.

3.  В разделе Настройка серверных компонентов Lync нажмите кнопку Далее. На экране сводки будут показаны действия по мере их выполнения. После завершения развертывания щелкните Просмотреть журнал, чтобы просмотреть доступные файлы журнала. Нажмите кнопку Готово, чтобы завершить развертывание.

4.  На пограничном сервере откройте мастер развертывания Lync Server. Щелкните Установка или обновление операционной системы Lync Server, а затем нажмите кнопку Настройка или удалите компоненты Lync Server. Нажмите кнопку выполнить еще раз.

5.  В разделе Настройка серверных компонентов Lync нажмите кнопку Далее. На экране сводки будут показаны действия по мере их выполнения. После завершения развертывания щелкните Просмотреть журнал, чтобы просмотреть доступные файлы журнала. Нажмите кнопку Готово, чтобы завершить развертывание.

6.  На пограничном сервере в мастере развертывания рядом с шагом 3: запрос, установка и назначение сертификатов нажмите кнопку выполнить еще раз.
    
    <div class=" ">
    

    > [!TIP]  
    > Если пограничный сервер развертывается в первый раз, вместо повторного запуска вы увидите "запустить".

    
    </div>

7.  На странице Доступные задачи сертификатов щелкните команду Создать новый запрос сертификата.

8.  На странице запроса сертификата выберите внешний Граничный сертификат.

9.  На странице Отложенный или немедленный запрос установите флажок подготовить запрос сейчас, но отправить позже.

10. На странице "файл запроса сертификата" введите полный путь и имя файла, в который нужно сохранить запрос (например, c:\\CERT\_ексернал\_Edge. cer).

11. На странице "укажите другой шаблон сертификата", чтобы использовать шаблон, отличный от шаблона веб-сервера по умолчанию, установите флажок использовать альтернативный шаблон сертификата для выбранного центра сертификации.

12. На странице  настроек имени и безопасности  выполните следующие действия.
    
    1.  В поле Понятное имя введите отображаемое имя сертификата.
    
    2.  В качестве битовой длины укажите длину в битах (обычно это значение по умолчанию — 2048).
    
    3.  Убедитесь, что установлен флажок "помечать закрытый ключ сертификата как экспортируемый"

13. На странице "сведения об организации" введите имя Организации и организационное подразделение (например, "подразделение" или "Отдел")

14. На странице сведения о географическом расположении укажите сведения о местоположении.

15. На странице имя субъекта/альтернативная тема отображается информация, которая будет автоматически заполнена мастером. Если требуются дополнительные альтернативные имена субъектов, их можно указать в следующих двух шагах.

16. В параметрах домена SIP на странице "альтернативные имена тем" (SAN) установите флажок домен, чтобы добавить SIP. \<сипдомаин\> элемент в список альтернативных имен субъектов.

17. На странице "Настройка дополнительных имен для других тем" укажите дополнительные имена для темы, которые необходимы
    
    <div class=" ">
    

    > [!TIP]  
    > Если установлен прокси-сервер КСМПП, по умолчанию доменное имя (например, contoso.com) заполнено в записях сети SAN. Если вам нужны дополнительные элементы, добавьте их на этом этапе.

    
    </div>

18. На странице сводки запроса ознакомьтесь со сведениями о сертификате, которые будут использоваться для создания запроса.

19. После завершения выполнения команд можно просмотреть журнал или нажать кнопку Далее, чтобы продолжить.

20. На странице "файл запроса на сертификат" можно просмотреть созданный файл запроса на подписывание сертификата (CSR), щелкнув Просмотреть или выйти из мастера сертификатов, нажав кнопку Готово.

21. Скопируйте файл запроса и отправьте его в общедоступный центр сертификации.

22. После получения, импорта и назначения общедоступного сертификата вы должны остановить и перезапустить службы пограничного сервера. Для этого введите в консоль управления Lync Server:
    
       ```PowerShell
        Stop-CsWindowsService
       ```
    
       ```PowerShell
        Start-CsWindowsService
       ```

23. Чтобы настроить DNS для КСМПП Федерации, добавьте следующую запись SRV для внешнего DNS:\_КСМПП-Server. \_протокол TCP. \<доменное\> имя. SRV-запись будет СОПОСТАВЛЕНа с полным доменным именем EDGE на пограничном сервере с таким же значением порта 5269. Кроме того, вы можете настроить запись узла "A" (например, xmpp.contoso.com), указывающую на IP-адрес сервера пограничного доступа.
    
    <div class=" ">
    

    > [!IMPORTANT]  
    > Если у вас есть пулы EDGE на нескольких сайтах, рекомендуем добавить несколько записей SRV для Федерации КСМПП. Добавьте запись SRV для каждого пула пограничного сервера в Организации и назначьте каждому из них другой приоритет. Когда все пулы пограничных ресурсов запущены, все запросы КСМПП будут обрабатываться пулом Edge с первым приоритетом, но если этот пул пограничного пула выходит из него, вам не нужно будет добавить новую запись SRV для восстановления функций Федерации КСМПП.

    
    </div>

24. Настройте новую политику внешнего доступа, чтобы включить всех пользователей, открыв командную консоль Lync Server Management Shell на интерфейсе и введя:
    
       ```PowerShell
        New-CsExternalAccessPolicy -Identity <name of policy to create.  If site scope, prepend with 'site:'> -EnableFederationAcces $true -EnablePublicCloudAccess $true
       ```
    
       ```PowerShell
        New-CsExternalAccessPolicy -Identity FedPic -EnableFederationAcces $true -EnablePublicCloudAccess $true
       ```
    
       ```PowerShell
        Get-CsUser | Grant-CsExternalAccessPolicy -PolicyName FedPic
       ```
    
    Включите КСМПП Access для внешних пользователей, введя:
    
       ```PowerShell
        Set-CsExternalAccessPolicy -Identity <name of the policy being used> EnableXmppAccess $true
       ```
    
       ```PowerShell
        Set-CsExternalAccessPolicy -Identity FedPic -EnableXmppAccess $true
       ```

25. На пограничном сервере, на котором развернут прокси-сервер КСМПП, откройте командную строку или интерфейс командной строки Windows PowerShell™ и введите следующую команду:
    
       ```PowerShell
        Netstat -ano | findstr 5269
       ```
    
       ```PowerShell
        Netstat -ano | findstr 23456
       ```
    
    Команда **netstat – АНО** — команда Network Statistics, запрос Parameters **— АНО** , который выводит все подключения и прослушиваемые порты, адреса и порты, отображаются в числовой форме и определяются идентификатором процесса-владельца для каждого подключения. Символ **|** определяет канал к следующей команде, **команде findstr**или строке поиска. Число 5269 и 23456, которое передается в findstr как параметр, дает команду findstr для поиска в выходных данных средства netstat для строк 5269 и 23456. Если КСМПП настроен правильно, результатом команд должно стать прослушивание и установление подключений как на внешнем (порт 5269), так и на внутреннем интерфейсе (порт 23456) пограничного сервера.
    
    Если команды не возвращают установленные и прослушиваемые порты в 5269 и 23456, проверьте следующее:

</div>

<div>

## <a name="troubleshooting-xmpp-federation"></a>Устранение неполадок Федерации КСМПП

1.  Чтобы определить, запущен ли прокси-сервер КСМПП, выполните указанные ниже действия.

2.  Войдите на пограничный сервер, на котором запущена служба прокси КСМПП, в качестве участника группы локального администратора.

3.  Нажмите кнопку **Пуск**, выберите **все программы**, а затем — **Администрирование**, а затем — **службы** .

4.  В службах найдите сервер Lync Server КСМПП reтрансляция прокси-сервера шлюза. Служба должна находиться в состоянии " **начато** ". Если он еще не запущен, щелкните значок **Пуск** на панели инструментов. Значок отображается как зеленая стрелка, направленная вправо.

5.  Убедитесь, что служба изменилась на " **начато**". Если он успешно запущен, закройте **службы** и продолжайте.
    
    Если служба сер не была успешно запущена, в разделе средства администрирования откройте окно просмотра событий и просмотрите сообщения об ошибках и предупреждениях на **сервере Lync Server** в **журналах приложений и служб**.

6.  После запуска службы **перевода КСМПП сервера Lync Server** проверьте, какие команды netstat использовались ранее. Если вы не видите установленные и прослушиваемые сеансы, убедитесь, что **маршрут Федерации КСМПП** правильно настроен в построителе топологии

7.  Войдите на компьютер, где установлен построитель топологий, с использованием учетной записи, входящей в группу администраторов домена и группу RTCUniversalServerAdmins.

8.  Запустить построитель топологии: нажмите кнопку **Пуск**, выберите пункт **все программы**, а затем — **Microsoft Lync Server 2013**и нажмите кнопку **Построитель топологии Lync Server**.

9.  В построителе топологии выберите сайт для маршрута Федерации КСМПП и проверьте, отображается ли для него **назначение маршрутов Федерации сайтов** для **КСМПП Федерации** , что вы выбрали назначение маршрута Федерации КСМПП
    
    Если назначение маршрута неверно или не задано, щелкните его правой кнопкой мыши и выберите команду **изменить свойства**. Установите флажок Федерация КСМПП и выберите правильный пограничный сервер или пул Edge.

10. Опубликуйте топологию. Подробные сведения можно найти [в разделе Публикация топологии в Lync Server 2013](lync-server-2013-publish-your-topology.md)
    
    <div class=" ">
    

    > [!TIP]  
    > Хотя это не обязательно и не требуется, возможно, потребуется перезапустить серверы пограничного сервера.

    
    </div>

11. С помощью процесса netstat, который использовался ранее, убедитесь в том, что пограничный сервер прослушивает или установил сеансы на порте 5269 и порт 23456.

12. Если вы по-прежнему не видите ожидаемые сеансы, проверьте, не отображаются ли в окне просмотра событий возможные причины проблем с подключением.

</div>

<div>

## <a name="see-also"></a>См. также


[Пример конфигурации XMPP в Lync Server 2013 — федерация XMPP с Google Talk](lync-server-2013-example-xmpp-configuration-–-xmpp-federation-with-google-talk.md)  


[Управление федеративными XMPP-партнерами в Lync Server 2013](lync-server-2013-manage-xmpp-federated-partners-for-your-organization.md)  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

