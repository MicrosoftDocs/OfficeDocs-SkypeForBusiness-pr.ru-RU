---
title: 'Lync Server 2013: настройка федерации XMPP'
TOCTitle: Настройка федерации XMPP
ms:assetid: 5fda6cb7-8d4d-495d-90c7-601f1036e085
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ204939(v=OCS.15)
ms:contentKeyID: 49309923
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Настройка федерации XMPP в Lync Server 2013

 

_**Дата изменения раздела:** 2012-12-03_

Для развертывания прокси-сервера XMPP на пограничном сервере необходимо настроить пограничный сервер для федерации XMPP. Для этого выполните следующие действия.

## Настройка федерации XMPP

1.  Войдите на компьютер, где установлен мастер развертывания Lync Server, с использованием учетной записи, входящей в группу администраторов домена и группу RTCUniversalServerAdmins.

2.  На сервере переднего плана откройте мастер развертывания Lync Server. Последовательно выберите пункты "Install or Update Lync Server System" ("Установка или обновление системы Lync Server") и "Setup or Remove Lync Server Components" ("Установка или удаление компонентов Lync Server"). Нажмите "Run Again" ("Запустить снова").

3.  В диалоговом окне "Установка компонентов Lync Server" нажмите кнопку "Далее". В окне сводки будут показаны действия по мере их выполнения. После завершения развертывания нажмите кнопку "Просмотр журнала", чтобы открыть доступные файлы журналов. Нажмите кнопку "Готово", чтобы завершить развертывание.

4.  На пограничном сервере откройте мастер развертывание Lync Server. Нажмите кнопку "Установить или обновить систему Lync Server", затем нажмите кнопку "Установить или удалить компоненты Lync Server". Затем снова нажмите "Выполнить".

5.  В диалоговом окне "Установка компонентов Lync Server" нажмите кнопку "Далее". В окне сводки будут показаны действия по мере их выполнения. После завершения развертывания нажмите кнопку "Просмотр журнала", чтобы открыть доступные файлы журналов. Нажмите кнопку "Готово", чтобы завершить развертывание.

6.  На пограничном сервере в мастере развертывания рядом с пунктом Шаг 3. Запрос, установка или назначение сертификатов нажмите кнопку Повторный запуск.
    

    > [!TIP]
    > Если развертывание пограничного сервера выполняется впервые, то вместо кнопки "Повторный запуск" будет отображаться кнопка "Запуск".



7.  На странице Available Certificate Tasks (Доступные задачи сертификатов) щелкните команду Create a new certificate request (Создать новый запрос сертификата).

8.  На странице запроса сертификата выберите пункт External Edge Certificate (Внешний сертификат пограничного сервера).

9.  На странице Отложенный или немедленный запрос установите флажок Подготовить запрос сейчас, чтобы отправить его позже.

10. На странице файла запроса сертификата введите полный путь и имя файла, в который должен сохраняться запрос (например, c:\\cert\_exernal\_edge.cer).

11. На странице указания альтернативного шаблона сертификата для использования шаблона, отличного от шаблона WebServer по умолчанию, установите флажок Use alternative certificate template for the selected certification authority (Использовать альтернативный шаблон сертификата для выбранного центра сертификации).

12. На странице настроек имени и безопасности выполните следующие действия.
    
    1.  В поле "Friendly name" ("Понятное имя") введите отображаемое имя для сертификата.
    
    2.  В поле "Bit length" ("Длина в битах") задайте длину в битах (обычно это установленное по умолчанию значение 2048).
    
    3.  Убедитесь, что установлен флажок "Mark certificate private key as exportable" ("Пометить закрытый ключ сертификата как экспортируемый").

13. На странице "Organization Information" ("Сведения об организации") введите имя организации и подразделение (например, отделение или отдел).

14. На странице "Geographical Information" ("Сведения о местоположении") укажите сведения о местоположении.

15. На странице "Subject Name/Subject Alternate Names" ("Имя субъекта/альтернативные имена субъектов") отображаются сведения, автоматически заполненные мастером. Если нужны дополнительные альтернативные имена субъектов, укажите их в следующих двух действиях.

16. На странице параметров домена SIP в альтернативных именах субъекта (SAN) установите флажок домена для добавления записи sip.\<домен\_sip\> в список альтернативных имен субъекта.

17. На странице "Configure Additional Subject Alternate Names" ("Настройка дополнительных альтернативных имен субъекта") укажите все нужные дополнительные альтернативные имена субъектов.
    

    > [!TIP]
    > Если устанавливается прокси-сервер XMPP, то по умолчанию в записях SAN заполняется имя домена (например, contoso.com). Если требуются дополнительные записи, добавьте их сейчас.



18. На странице сводки по запросу просмотрите сведения о сертификате, которые будут использоваться для создания запроса.

19. После завершения выполнения команд можно просмотреть журнал или нажат кнопку "Далее" для продолжения.

20. На странице файла запроса сертификата можно просмотреть созданный файл запроса подписи сертификата (CSR-файл), нажав кнопку Просмотр, или выйти из мастера сертификатов, нажав кнопку Готово.

21. Скопируйте файл запроса и отправьте его в ваш общедоступный центр сертификации.

22. После получения, импорта и назначения общедоступного сертификата необходимо остановить и перезапустить службы пограничного сервера. Это можно сделать, введя в консоли управления Lync Server следующую команду:
    
```
    Stop-CsWindowsService
```
```       
    Start-CsWindowsService
```


23. Чтобы настроить DNS для федерации XMPP, во внешнюю DNS добавляется следующая запись SRV:\_xmpp-server.\_tcp.\<имя\_домена\>. Эта запись SRV будет разрешаться в полное доменное имя пограничного сервера доступа, со значением порта 5269. Другой способ состоит в том, чтобы настроить А-запись узла (например, xmpp.contoso.com), которая указывает на IP-адрес этого пограничного сервера доступа.
    
    > [!IMPORTANT]
    > При наличии пограничных пулов в нескольких сайтах рекомендуется добавить несколько SRV-записей для федерации XMPP. Добавьте SRV-запись для каждого пограничного пула в организации и предоставьте каждой SRV-записи собственный приоритет. При работе всех пулов пограничных серверов запросы XMPP будут обрабатываться пограничным пулом с первым приоритетом, однако если этот пограничный пул станет неработоспособным, не нужно будет добавлять новую SRV-запись для восстановления функций федерации XMPP.


24. Настройте новую политику внешнего доступа, чтобы включить всех пользователей, открыв командную консоль Lync Server на сервере переднего плана и введя в ней следующую команду:
    
```
        New-CsExternalAccessPolicy -Identity <name of policy to create.  If site scope, prepend with 'site:'> -EnableFederationAcces $true -EnablePublicCloudAccess $true
```

```    
        New-CsExternalAccessPolicy -Identity FedPic -EnableFederationAcces $true -EnablePublicCloudAccess $true
```

```    
        Get-CsUser | Grant-CsExternalAccessPolicy -PolicyName FedPic
```


Включите XMPP-доступ для внешних пользователей, введя следующую команду:


```    
        Set-CsExternalAccessPolicy -Identity <name of the policy being used> EnableXmppAccess $true
```

```    
        Set-CsExternalAccessPolicy -Identity FedPic -EnableXmppAccess $true
```

25. На сервер, где развернут прокси-сервер XMPP, откройте командную строку или командной строки Windows PowerShell™ и введите следующую команду:
    
    ```
        Netstat -ano | findstr 5269
    ```
    ```    
        Netstat -ano | findstr 23456
    ```    
    Команда **netstat –ano** является командой сбора сетевой статистики; параметры **–ano** указывают, что нужно отобразить все подключения и порты прослушивания, адреса и порты следует отобразить в числовой форме, а также следует отобразить идентификатор процесса-владельца, связанного с каждым подключением. Символ **|** указывает на конвейерную передачу данных в следующую команду **findstr**, т. е. «найти строку». Число 5269 и 23456, переданные в команду findstr в качестве параметра, указывают, что в выходных данных netstat нужно найти строки 5269 и 23456. Если федерация XMPP настроена верно, результатом выполнения команд станет отображение установленных подключений или прослушивания как по внешнему (порт 5269), так и по внутреннему (порт 23456) интерфейсам сервер.
    
    Если команды не возвращают сведения об установленных подключениях или прослушивании по портам 5269 и 23456, проверьте приведенные ниже элементы.

## Устранение неполадок, связанных с федерацией XMPP

1.  Чтобы определить, работает ли прокси-сервер XMPP, выполните следующие действия.

2.  Выполните вход на пограничный сервер, на котором работает служба прокси-сервера XMPP, от имени члена группы локальных администраторов.

3.  Щелкните **Пуск** , **Все программы** , **Средства администрирования** , затем **Службы**

4.  В оснастке "Службы" найдите службу "Прокси-сервер шлюза преобразования XMPP Lync Server". Эта служба должна быть в состоянии **Работает** . Если она не запущена, щелкните значок **Запуск службы** на панели инструментов. Значок принимает вид зеленой стрелки, направленной вправо.

5.  Убедитесь, что состояние службы указано как **Работает** . Если служба запустилась успешно, закройте оснастку **Службы** и продолжите работу.
    
    Если служба не запустилась успешно, в средствах администрирования откройте средство просмотра событий и просмотрите ошибки и предупреждения в разделе **Lync Server** **журналов приложений и служб** .

6.  После запуска службы **Шлюз преобразования XMPP Lync Server** повторно выполните вышеуказанные команды netstat. Если установленные сеансы или сеансы прослушивания отсутствуют, проверьте правильность настройки **маршрута федерации XMPP** в построителе топологий

7.  Войдите на компьютер, где установлен построитель топологий, с использованием учетной записи, входящей в группу администраторов домена и группу RTCUniversalServerAdmins.

8.  Запустите построитель топологий: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Построитель топологий Lync Server**.

9.  В топологий выберите сайт для маршрута федерации XMPP и убедитесь, что в поле **Назначение маршрута федерации для сайта** для **федерации XMPP** отображается сервер или пул в качестве назначения для маршрута федерации XMPP.
    
    Если назначение маршрута является недопустимым или совсем не задано, щелкните правой кнопкой мыши сайт, щелкните **Изменение свойств** . Установите флажок федерации XMPP, затем выберите допустимый сервер или пул.

10. Опубликуйте топологию. Дополнительные сведения см. в разделе [Публикация топологии в Lync Server 2013](lync-server-2013-publish-your-topology.md)
    

    > [!TIP]
    > Хотя в этом, как правило, нет необходимости, может понадобиться перезапустить сервер



11. Используя ранее примененный процесс netstat, убедитесь, что теперь сервер прослушивает порт 5269 и 23456 или установил по ним подключение.

12. Если ожидаемых сеансов все еще не отображается, просмотрите средство просмотра событий на предмет возможных причин проблем со связью.

## См. также

#### Задачи

[Пример конфигурации XMPP в Lync Server 2013 — федерация XMPP с Google Talk](lync-server-2013-example-xmpp-configuration-–-xmpp-federation-with-google-talk.md)  

#### Другие ресурсы

[Управление федеративными XMPP-партнерами в Lync Server 2013](lync-server-2013-manage-xmpp-federated-partners-for-your-organization.md)

