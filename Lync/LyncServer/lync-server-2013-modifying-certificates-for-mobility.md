---
title: 'Lync Server 2013: изменение сертификатов для мобильной работы'
TOCTitle: Изменение сертификатов для мобильной работы
ms:assetid: 4e9107af-20f4-4c2a-8c98-ca35b39a4e2d
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Hh690015(v=OCS.15)
ms:contentKeyID: 49309731
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Изменение сертификатов для мобильной работы в Lync Server 2013

 

_**Дата изменения раздела:** 2014-06-20_

Для поддержки безопасных подключений между средой Lync и мобильными клиентами сертификаты протокола SSL для Директоров, переднего плана и обратного прокси-сервера должны быть обновлены с помощью некоторых дополнительных записей альтернативного имени субъекта (SAN). Дополнительные сведения о требованиях к сертификатам для обеспечения мобильности см. в разделе «Требования к сертификатам» в [Технические требования для организации мобильной работы в Lync Server 2013](lync-server-2013-technical-requirements-for-mobility.md), но в основном требуется получение новых сертификатов из ЦС с дополнительными записями SAN. Эти сертификаты необходимо добавить с помощью указанных далее действий.

Перед началом необходимо узнать, какие альтернативные имена субъектов уже есть у сертификатов. Если вы не осведомлены о текущей конфигурации, есть множеством способов для получения данных сведений. Для просмотра этой информации можно выполнить команду **Get-CsCertificate** и другие команды PowerShell (описано ниже), но по умолчанию эти данные усекаются, поэтому могут отображаться не все необходимые свойства. Для получения полного представления сертификата и всех его свойств перейдите на консоль управления (MMC) и загрузите оснастку «Сертификаты» (описано далее) или воспользуйтесь мастером развертывания Lync Server.

Как указано выше, следующие действия помогут выполнить обновление сертификатов с помощью Командная консоль Lync Server и MMC. Если вместо этого необходимо воспользоваться мастером сертификатов из мастера развертывания Lync Server, ознакомьтесь с [Настройка сертификатов для директора в Lync Server 2013](lync-server-2013-configure-certificates-for-the-director.md) из директора или пула директоров (если они настроены). Для сервера или пула переднего плана см. [Настройка сертификатов для серверов в Lync Server 2013](lync-server-2013-configure-certificates-for-servers.md).

Следует помнить, что в наличии может быть один сертификат по умолчанию в среде Lync Server 2013 или отдельные сертификаты для параметра Default (все за исключением веб-служб), WebServicesExternal и WebServicesInternal. Указанные далее действия должны помочь вне зависимости от конфигурации.

## Обновление сертификатов новыми альтернативными именами субъектов с помощью командной консоли Командная консоль Lync Server

1.  Выполните вход на сервер Lync Server 2013 с помощью учетной записи с с правами и разрешениями локального администратора. Кроме того, при использовании команды PowerShell **Request-CsCertificate** в шаге 12 и далее для учетной записи требуются права для указанного ЦС.

2.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

3.  Перед назначением обновленного сертификата необходимо определить, какие сертификаты были назначены серверу и для какого типа использования. В командной строке введите следующую команду:
    
        Get-CsCertificate

4.  Просмотрите выходные данные из предыдущего шага, чтобы узнать, назначен ли нескольким использованиям один сертификат или для каждого из них назначен отдельный сертификат. Посмотрите на параметр Use, чтобы выяснить, как используется сертификат. Сравните параметр Thumbprint для отображаемых сертификатов, чтобы узнать, имеет ли один сертификат несколько использований. Ищите параметр Thumbprint.

5.  Обновите сертификат. Введите в командной строке следующее:
    
        Set-CsCertificate -Type <type of certificate as displayed in the Use parameter> -Thumbprint <unique identifier>
    
    Например, если с помощью командлета **Get-CsCertificate** отображен сертификат с параметром Use of Default, другой с параметром Use of WebServicesInternal и другой с параметром Use of WebServicesExternal, и при условии одинакового для всех них значения Thumbprint, в командной строке введите следующее:
    
        Set-CsCertificate -Type Default,WebServicesInternal,WebServicesExternal -Thumbprint <Certificate Thumbprint>
    
    **Важно\!**
    
    For example: Если каждому использованию назначен отдельный сертификат (значение Thumbprint различно для каждого из сертификатов), важно **не** запускать командлет **Set-CsCertificate** с несколькими типами, как указано в примере выше. В данном случае отдельно запустите командлет **Set-CsCertificate** для каждого использования. Например:
    
        Set-CsCertificate -Type Default -Thumbprint <Certificate Thumbprint>
        Set-CsCertificate -Type WebServicesInternal -Thumbprint <Certificate Thumbprint>
        Set-CsCertificate -Type WebServicesExternal -Thumbprint <Certificate Thumbprint>

6.  Для просмотра сертификата (или сертификатов) нажмите **Пуск**, **Выполнить…**. Введите MMC, чтобы открыть консоль управления (MMC).

7.  В меню консоли управления (MMC) выберите **Файл** , **Добавить или удалить оснастку…** , «Сертификаты». Нажмите кнопку **Добавить** . При отображении запроса выберите **учетной записи компьютера** , а затем нажмите кнопку **Далее** .

8.  Если сертификат расположен на этом сервере, выберите **Локальный компьютер**. Если сертификат расположен на другом компьютере, выберите **Другой компьютер**, после этого введите полное доменное имя компьютера или нажмите кнопку **Обзор** в поле **Введите имена выбираемых объектов** и введите имя компьютера. Щелкните элемент **Проверить имена** . После разрешения имени компьютера оно подчеркивается. Нажмите кнопку **ОК** , а затем кнопку **Готово** . Нажмите кнопку **ОК** для подтверждения выбора и закройте диалоговое окно **Добавление и удаление оснасток** .

9.  Чтобы просмотреть свойства сертификата, разверните узел **Сертификаты** , разверните узел **Личные** и выберите элемент **Сертификаты** . Выберите сертификат для просмотра, щелкните его правой кнопкой мыши и выберите пункт **Открыть** .

10. В представлении **Сертификат** выберите элемент **Сведения** . Здесь вы можете выбрать имя субъекта сертификата, выбрав элемент **Субъект** , после чего отображаются назначенное имя субъекта и связанные свойства.

11. Чтобы просмотреть назначенные альтернативные имена субъектов, выберите **Альтернативное имя субъекта** . Отображаются все назначенные альтернативные имена субъектов. Найденные здесь альтернативные имена по умолчанию имеют тип **DNS-имя**. Вам следует просмотреть следующие элементы (в соответствии с записями DNS-узла (A либо AAAA для IPv6) все они должны быть полными доменными именами:
    
      - Имя пула для этого пула или имя отдельного сервера, если это не пул
    
      - Имя сервера, которому назначен сертификат
    
      - Записи простых URL-адресов (обычно meet и dialin)
    
      - Внутренние и внешние имена веб-служб (например, webpool01.contoso.net, webpool01.contoso.com), основанные на выбранных параметрах в построителе топологий и выборе переопределенных веб-служб.
    
      - Если они уже назначены, записи lyncdiscover.\<домен SIP\> и lyncdiscoverintrnal.\<домен SIP\>.
    
    Последний элемент представляет для вас наибольший интерес – наличие записи альтернативного имени субъекта lyncdiscover и lyncdiscoverinternal.
    
    Повторите эти шаги при необходимости проверки нескольких сертификатов. После получения этой информации вы можете закрыть представление сертификата и консоль управления (MMC).

12. Если отсутствует альтернативное имя субъекта службы автообнаружения и вы используете один сертификат Default для типов Default, WebServicesInternal и WebServiceExternal, выполните следующие действия:
    
      - Введите в командной строке командной консоли Командная консоль Lync Server следующее:
        
            Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -AllSipDomain -verbose
        
        Если у вас имеется много SIP-доменов, вы не можете использовать новый параметр AllSipDomain. Вместо этого вам следует использовать параметр DomainName. Когда вы используете параметр DomainName, вам необходимо определить полное доменное имя для записей lyncdiscoverinternal и lyncdiscover. Например:
        
            Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
    
      - Чтобы назначить сертификат, введите следующее:
        
            Set-CsCertificate -Type Default,WebServicesInternal,WebServicesExternal -Thumbprint <Certificate Thumbprint>
        
        Где «Thumbprint» – это отпечаток, отображаемый для недавно выданного сертификата.

13. В случае отсутствия внутренних альтернативных имен субъектов автообнаружения при использовании отдельных сертификатов для Default, WebServicesInternal и WebServicesExternal выполните следующие действия:
    
      - Введите в командной строке командной консоли Командная консоль Lync Server следующее:
        
            Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -AllSipDomain -verbose
        
        Если у вас имеется много SIP-доменов, вы не можете использовать новый параметр AllSipDomain. Вместо этого вам следует использовать параметр DomainName. Когда вы используете параметр DomainName, вам следует определить подходящий префикс для полного доменного имени домена SIP. Например:
        
            Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
    
      - В случае отсутствия внешнего альтернативного имени субъекта автообнаружения введите в командной строке следующее:
        
            Request-CsCertificate -New -Type WebServicesExternal -Ca dc\myca -AllSipDomain -verbose
        
        Если у вас имеется много SIP-доменов, вы не можете использовать новый параметр AllSipDomain. Вместо этого вам следует использовать параметр DomainName. Когда вы используете параметр DomainName, вам следует определить подходящий префикс для полного доменного имени домена SIP. Например:
        
            Request-CsCertificate -New -Type WebServicesExternal -Ca dc\myca -DomainName "Lyncdiscover.contoso.com, Lyncdiscover.contoso.net" -verbose
    
      - Чтобы назначить индивидуальные типы сертификатов, введите следующее:
        
            Set-CsCertificate -Type Default -Thumbprint <Certificate Thumbprint>
            Set-CsCertificate -Type WebServicesInternal -Thumbprint <Certificate Thumbprint>
            Set-CsCertificate -Type WebServicesExternal -Thumbprint <Certificate Thumbprint>
        
        Где «Thumbprint» – это отпечаток, отображаемый для недавно выданных индивидуальных сертификатов.
    
    > [!NOTE]  
    > Обратите внимание, что шаги 12 и 13 должны выполняться, только если у используемой их учетной записи есть доступ к ЦС с соответствующими разрешениями. Если вы не можете выполнить вход с помощью учетной записи с данными разрешениями или используете для сертификатов общий или локальный ЦС, необходимо запросить их с помощью мастера развертывания Lync Server, о котором упоминалось в начале статьи.
