---
title: 'Lync Server 2013: отработка отказа сервером сохраняемого чата'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Failing over Persistent Chat Server
ms:assetid: 2cd79ffd-fee6-44ce-96cf-b98bf25e2690
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ204772(v=OCS.15)
ms:contentKeyID: 48183726
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 570ed42bb2ff1d5b1f4ab58e9bbd9aad9159bef3
ms.sourcegitcommit: 831d141dfc5a49dd764cb296b73b63e5a9f8e599
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/21/2020
ms.locfileid: "42214405"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="failing-over-persistent-chat-server-in-lync-server-2013"></a>Отработка отказа сервером сохраняемого чата в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2014-02-05_

Отработка отказа для сервера сохраняемого чата разработана в основном для ручного процесса.

Процедура отработки отказа основана на предположении, что дополнительный центр обработки данных работает, но службы сервера сохраняемого чата, где расположена основная база данных сохраняемого чата, полностью недоступны, включая следующие:

  - Основная база данных сервера сохраняемого чата и зеркальная база данных сервера сохраняемого чата не работают.

  - Сервер переднего плана Lync Server не работает.

Вся процедура состоит из двух основных этапов:

  - Восстановите основную базу данных сохраняемого чата (MGC).

  - Реализация зеркального отображения для новой базы данных-источника.

Не отменяется отработка отказа базы данных соответствия сохраняемого чата (mgccomp). Содержимое этой базы данных является временным и очищается по мере обработки данных адаптером соответствия. В качестве администратора сохраняемого чата вы обязаны правильно управлять выходными данными адаптера, чтобы избежать потери данных.

<div>

## <a name="to-fail-over-persistent-chat-server"></a>Чтобы отработка отказа на сервере сохраняемого чата

1.  Удалите доставку журналов из базы данных доставки журналов резервного копирования сервера сохраняемого чата.
    
    1.  С помощью SQL Server Management Studio подключитесь к экземпляру базы данных, где находится база данных MGC резервного копирования сервера сохраняемого чата.
    
    2.  Откройте окно отправки запроса в базу данных master.
    
    3.  Используйте следующую команду для сброса доставки журналов:
        
            exec sp_delete_log_shipping_secondary_database mgc

2.  Скопируйте все нескопированные файлы резервных копий из общей папки резервных копий в конечную папку копирования на резервном сервере.

3.  По порядку примените все непримененные резервные копии журналов транзакций к базе данных-получателю. Дополнительные сведения см. в разделе "как: применение резервной копии журнала транзакций (Transact-SQL) https://go.microsoft.com/fwlink/p/?linkid=247428" по адресу.

4.  Подключите резервную базу данных mgc к сети. В окне запроса, которое было открыто в действии 1b, выполните следующие действия.
    
    1.  Завершите все подключения к базе данных mgc при их наличии:
        
        1.  **exec SP\_who2** для определения подключений к базе данных mgc.
        
        2.  **удалите \<SPID\> ** , чтобы завершить эти подключения.
    
    2.  Подключите базу данных к сети.
        
        1.  **Восстановление базы данных MGC с восстановлением**.

5.  В консоли управления Lync Server используйте команду **Set-CsPersistentChatState-Identity "Service: ATL-CS-001.litwareinc.com" – PoolState FailedOver** , чтобы отработка отказа на резервную базу данных mgc. Обязательно замените полное доменное имя пула сохраняемого чата для atl-cs-001.litwareinc.com.
    
    Резервная база данных mgc теперь выступает в качестве базы данных-источника.

6.  В командной консоли Lync Server используйте командлет **Install – CsMirrorDatabase** , чтобы установить зеркало высокой доступности для базы данных резервных копий, которая теперь выступает в качестве основной базы данных. Используйте экземпляр резервной базы данных в качестве базы данных источника и экземпляр резервной зеркальной базы данных в качестве экземпляра зеркала. Это не то же самое зеркало, которое изначально было настроено для базы данных-источника в процессе установки. Дополнительные сведения можно найти в разделе "использование командлетов командной консоли Lync Server" в разделе [Развертывание зеркального отображения SQL для обеспечения высокой доступности внутреннего сервера в Lync server 2013](lync-server-2013-deploying-sql-mirroring-for-back-end-server-high-availability.md).

7.  Задайте для сервера сохраняемого чата активные серверы. В командной консоли Lync Server используйте командлет **Set – CsPersistentChatActiveServer** , чтобы задать список активных серверов.
    
    <div>
    

    > [!IMPORTANT]  
    > Все активные серверы должны располагаться в одном центре обработки данных с новой базой данных-источником или в центре обработки данных, имеющем подключение к базе данных с низкой задержкой и высокой пропускной способностью.

    
    </div>
    
    На этом шаге отработка отказа из основной базы данных сервера сохраняемого чата в резервную базу данных сервера сохраняемого чата успешно завершена.

</div>

</div>

<span> </span>

</div>

</div>

</div>

