---
title: 'Lync Server 2013: Настройка поставщиков для централизованной службы ведения журналов'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Configuring providers for Centralized Logging Service
ms:assetid: 6a197ecf-b56b-45e0-8e7c-f532ec5164ff
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ688082(v=OCS.15)
ms:contentKeyID: 49733678
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 23ba3d903b1d4a33048f5a66738897408c36a94e
ms.sourcegitcommit: 33db8c7febd4cf1591e8dcbbdfd6fc8e8925896e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "42147282"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="configuring-providers-for-centralized-logging-service-in-lync-server-2013"></a>Настройка поставщиков для централизованной службы ведения журналов в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2014-03-19_

Основные понятия и настройка *поставщиков* централизованной службы ведения журналов — это одна из самых важных. *Поставщики* напрямую сопоставляются с компонентами роли сервера Lync Server в модели трассировки Lync Server. Поставщик определяет компоненты Lync Server 2013, которые будут трассироваться, тип сообщений (например, Неустранимая ошибка, ошибка или предупреждение) и флаги (например, TF\_Connection или TF\_diag). Поставщики — это компоненты для трассировки в каждой роли сервера Lync Server. С помощью поставщиков вы определяете уровень и тип трассировки компонентов (например, S4, SIPStack, мгновенных сообщений и сведений о присутствии). Определенный поставщик используется в сценарии для группирования всех поставщиков для указанной логической коллекции, которые относятся к определенному условию проблемы.

Для запуска функций централизованной службы ведения журналов с помощью командной консоли Lync Server необходимо быть членом группы безопасности CsAdministrator или CsServerAdministrator с управлением доступом на основе ролей (RBAC) или настраиваемой роли RBAC, содержащей любой из Эти две группы. Чтобы получить список всех ролей управления доступом на основе ролей (RBAC), которым назначен этот командлет (включая все самостоятельно созданные роли RBAC), выполните следующую команду в командной консоли Lync Server или в командной строке Windows PowerShell:

    Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Lync Server 2013 cmdlet"}

Пример:

    Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}

Оставшаяся часть этого раздела посвящена способам определения поставщиков, изменению поставщика и определениям, содержащимся в определении поставщика для оптимизации устранения неполадок. Существует два способа выдача команд службы централизованного ведения журналов. Вы можете\\использовать файл CLSController. exe, расположенный по умолчанию, в папке C: Program Files\\Common Files\\Microsoft Lync Server 2013\\CLSAgent. Вы также можете использовать командную консоль Lync Server для выполнения команд Windows PowerShell. Важное отличие заключается в том, что при использовании CLSController. exe в командной строке предусмотрен ограниченный выбор сценариев, в которых поставщики уже определены и не могут быть изменены, но вы можете определить уровень ведения журнала. С помощью Windows PowerShell вы можете определить новых поставщиков для использования в сеансах ведения журнала и получить полный контроль над их созданием, тем, что они собирают, и на каком уровне они собирают данные.

<div class="">


> [!IMPORTANT]  
> Как уже упоминалось, поставщики являются очень мощным средством. Однако сценарии имеют большее значение, так как объединяют в себе все данные, необходимые для определения и выполнения трассировок компонентов, представленных поставщиками. Сценарии, которые являются коллекциями поставщиков, можно сравнить с выполнением пакетного файла, содержащего сотни команд, для сбора большого объема данных, что отличается от выполнения сотен команд по одной в командной строке.<BR>Вместо того чтобы потребовать глубокой детализации сведений о поставщиках, Служба централизованного ведения журналов предоставляет ряд сценариев, которые уже определены для вас. Предоставленные сценарии покрывают большое количество различных проблем и неполадок, которые могут возникнуть. В редких случаях может понадобиться создать и определить поставщиков и назначить их в сценарии. Настоятельно рекомендуется ознакомиться с каждым предоставленным сценарием, прежде чем создавать новых поставщиков и сценарии. Хотя здесь предоставляются сведения о создании поставщиков, чтобы вы могли ознакомиться с тем, как сценарии используют элементы поставщиков для сбора данных трассировок, сведения о самих поставщиках в настоящее время не предоставлены.



</div>

В статье [Обзор централизованной службы ведения журналов в Lync Server 2013](lync-server-2013-overview-of-the-centralized-logging-service.md)ключевые элементы определения поставщика для использования в сценарии:

  - **Поставщики**   . Если вы знакомы с OCSLogger, поставщики — это компоненты, которые указывают OCSLogger, из чего система трассировки должна собирать журналы. Поставщики — это те же компоненты, а во многих случаях их имя совпадает с компонентами в OCSLogger. Если вы не знакомы с OCSLogger, поставщики — это компоненты, зависящие от роли сервера, из которых Служба централизованного ведения журналов может собирать журналы. В случае централизованной службы ведения журналов CLSAgent — это архитектурная часть централизованной службы ведения журналов, которая выполняет трассировку компонентов, которые вы определили в конфигурации поставщиков.

  - **Уровни ведения журнала**   OCSLogger предоставил возможность выбрать количество уровней детализации собранных данных. Эта функция является неотъемлемой частью централизованной службы ведения журналов и сценариев и определяется с помощью параметра **Type** . Вы можете выбрать следующие параметры.
    
      - **ALL**   собирает сообщения трассировки типа "Неустранимая ошибка", "ошибка", "предупреждение" и "сведения" в журнал для определенного поставщика.
    
      - **Неустранимая**   ошибка собирает только сообщения трассировки, указывающие на сбой определенного поставщика.
    
      - **Ошибка**   собирает только сообщения трассировки, указывающие на ошибку определенного поставщика, а также неустранимые сообщения.
    
      - **Предупреждение**   собирает только сообщения трассировки, указывающие предупреждение для определенного поставщика, а также неустранимые сообщения и сообщения об ошибках.
    
      - **Info**   собирает только сообщения трассировки, указывающие информационное сообщение для определенного поставщика, а также неустранимые, ошибочные и предупреждающие сообщения.
    
      - **Verbose**   собирает все сообщения трассировки типа "Неустранимая ошибка", "ошибка", "предупреждение" и "информация" для определенного поставщика.

  - **Flags**   OCSLogger предоставляет возможность выбора флагов для каждого поставщика, определяющего тип данных, которые можно получить из файлов трассировки. В зависимости от поставщика можно задать следующие флаги:
    
      - **TF\_Connection**   предоставляет записи журнала, связанные с подключением. Эти журналы включают сведения о подключениях к определенному компоненту. Кроме того, может быть включен большой объем сведений сетевого уровня (то есть для компонентов без концепции подключения).
    
      - **TF\_Security**   предоставляет все события и записи журнала, связанные с безопасностью. Например, для SipStack, это события безопасности, такие как ошибки проверки домена и ошибки проверки подлинности и авторизации клиентов.
    
      - **TF\_DIAG**   предоставляет события диагностики, которые можно использовать для диагностики или устранения неполадок в компоненте. Например, для SipStack это ошибки сертификатов или ошибки/предупреждения, связанные с DNS.
    
      - **TF\_Protocol**   предоставляет сообщения протокола, такие как SIP и Объединенные сообщения с пакетным кодеком сообщества.
    
      - **Компонент\_**   TF включает ведение журнала для компонентов, указанных как часть поставщиков.
    
      - **Все**   задает все доступные флаги, доступные для поставщика.

<div>

## <a name="to-review-information-about-existing-centralized-logging-service-scenario-providers"></a>Просмотр сведений о существующих поставщиках сценариев централизованной службы ведения журналов

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Чтобы просмотреть конфигурацию существующих поставщиков, введите следующую команду:
    
        Get-CsClsScenario -Identity <scope and scenario name> 
    
    Например, чтобы просмотреть сведения о глобальном помощнике конференц-связи, введите следующее:
    
        Get-CsClsScenario -Identity "global/CAA"
    
    Команда отображает список поставщиков со связанными флагами, параметрами и компонентами. Если отображаемая информация не хватает или слишком длинная длина списка для стандартного формата списка Windows PowerShell, можно отобразить дополнительные сведения, определив другой метод вывода. Для этого выполните следующую команду:
    
        Get-CsClsScenario -Identity "global/CAA" | Select-Object -ExpandProperty Provider
    
    В выходе этой команды отображается каждый поставщик. Каждая запись состоит из пяти строк: имя поставщика, тип ведения журнала, уровень ведения журнала, флаги, GUID и роль.

</div>

<div>

## <a name="to-define-a-new-centralized-logging-service-scenario-provider"></a>Определение нового поставщика сценария для централизованной службы ведения журналов

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Поставщик сценария состоит из отслеживаемого компонента, используемых флагов и уровня детализации собираемых данных. Это определяется следующей командой:
    
        $<variableName> = New-CsClsProvider -Name <provider component> -Type <log type> -Level <log level detail type> -Flags <provider trace log flags>
    
    Например, определение поставщика трассировки, которое указывает, что нужно собирать с поставщика Lyss и при каком уровне детализации, выглядит следующим образом.
    
        $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Info" -Flags "All"

Параметр –Level указывает сбор сообщений типа неустранимая ошибка, ошибка, предупреждение и информация. Используются все флажки, определенные для поставщика Lyss и включающие подключения TF\_, TF\_diag и TF\_Protocol.

После определения переменной $LyssProvider можно использовать ее в командлете **New-CsClsScenario** для сбора трассировок с поставщика Lyss. Чтобы завершить создание и назначение поставщика новому сценарию, введите следующую команду:

    New-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider

где $LyssProvider — это переменная, содержащая определенный сценарий, созданный с помощью командлета **New-CsClsProvider**.

</div>

<div>

## <a name="to-change-an-existing-centralized-logging-service-scenario-provider"></a>Изменение существующего поставщика сценариев централизованной службы ведения журналов

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Чтобы обновить или изменить конфигурацию существующего поставщика, введите следующую команду:
    
        $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "TF_Connection, TF_Diag"
    
    Затем обновите сценарий, чтобы назначить поставщика. Введите следующее:
    
        Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider

Конечный результат выполнения команды — обновление флагов и уровня поставщика назначенного для сайта сценария: Redmond/RedmondLyssInfo. Новый сценарий можно просмотреть с помощью командлета Get-CsClsScenario. Дополнительные сведения см. в разделе [Get-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/Get-CsClsScenario).

<div class="">


> [!WARNING]  
> <STRONG>New-ClsCsProvider</STRONG> не определяет допустимость флагов. Убедитесь, что названия флагов указаны верно (например, TF_DIAG или TF_CONNECTION). Если названия флагов указаны неверно, поставщик не вернет ожидаемые сведения журналов.



</div>

Если необходимо добавить в этот сценарий дополнительных поставщиков, введите следующую команду:

    Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Add=$ABSProvider, $CASProvider, S4Provider}

где каждый поставщик, определенный с помощью директивы Add, уже был определен с помощью процесса **New-CsClsProvider**.

</div>

<div>

## <a name="to-remove-a-scenario-provider"></a>Чтобы удалить поставщика сценария

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Приведенные командлеты позволяют обновить существующих поставщиков и создать новых. Чтобы удалить поставщика, необходимо использовать директиву Replace для параметра Provider в командлете **Set-CsClsScenario**. Единственным способом полностью удалить поставщика является замена его на переопределенного поставщика того же типа с тем же именем, что выполняется с помощью директивы Update. Например, наш поставщик LyssProvider определяется с помощью конвейера WPP в качестве типа журнала, уровня "Отладка", а флаги\_Set — TF\_Connection и TF DIAG. Необходимо изменить флаги на All. Чтобы изменить поставщика, выполните следующую команду:
    
        $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "All"

     &nbsp;
    
        Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Replace=$LyssProvider}

3.  Если необходимо полностью удалить сценарий и связанных с ним поставщиков, выполните следующую команду:
    
        Remove-CsClsScenario -Identity <scope and name of scenario>
    
    Пример:
    
        Remove-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo"
    
    <div class="">
    

    > [!WARNING]  
    > Командлет <STRONG>Remove-CsClsScenario</STRONG> не запрашивает подтверждения. Сценарий удаляется вместе со всеми назначенными ему поставщиками. Можно повторно создать сценарий, повторно выполнив команды, которые использовались для его исходного создания. Процедуры восстановления удаленных сценариев или поставщиков не существует.

    
    </div>

При удалении сценария с помощью командлета **Remove-CsClsScenario** вы полностью удаляете сценарий из области применения. Чтобы использовать созданные сценарии и поставщиков, которые являются частью сценария, необходимо создать новых поставщиков и назначить их новому сценарию.

</div>

<div>

## <a name="see-also"></a>См. также


[Get — CsClsScenario](https://docs.microsoft.com/powershell/module/skype/Get-CsClsScenario)  
[New — CsClsScenario](https://docs.microsoft.com/powershell/module/skype/New-CsClsScenario)  
[Remove — CsClsScenario](https://docs.microsoft.com/powershell/module/skype/Remove-CsClsScenario)  
[Set — CsClsScenario](https://docs.microsoft.com/powershell/module/skype/Set-CsClsScenario)  
[New — CsClsProvider](https://docs.microsoft.com/powershell/module/skype/New-CsClsProvider)  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

