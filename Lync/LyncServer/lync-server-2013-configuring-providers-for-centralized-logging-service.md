---
title: Настройка поставщиков для службы централизованного ведения журналов
TOCTitle: Настройка поставщиков для службы централизованного ведения журналов
ms:assetid: 6a197ecf-b56b-45e0-8e7c-f532ec5164ff
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ688082(v=OCS.15)
ms:contentKeyID: 49888027
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Настройка поставщиков для службы централизованного ведения журналов

 

_**Дата изменения раздела:** 2014-03-19_

Концепция и конфигурация *поставщиков* в централизованной службе ведения журнала являются одним из самых важных аспектов. *Поставщики* сопоставлены непосредственно с компонентами ролей серверов Lync Server в модели трассировки Lync Server. Поставщик определяет компоненты Lync Server 2013, которые будут отслеживаться, тип собираемых сообщений (например, неустранимая ошибка, ошибка или предупреждение) и флаги (например, TF\_Connection или TF\_Diag). Поставщики — это отслеживаемые компоненты в каждой роли сервера Lync Server. С их помощью можно определить уровень и тип трассировки компонентов (например, S4, SIPStack, IM и Presence). Определенный поставщик используется в сценарии для группировки всех поставщиков в логическую коллекцию, описывающую состояние определенной проблемы.

Чтобы запустить функции централизованной службы ведения журнала с помощью командной консоли Командная консоль Lync Server, необходимо входить в группы безопасности управления доступом на основе ролей CsAdministrator или CsServerAdministrator или в пользовательскую роль RBAC, содержащую любую из этих двух групп. Чтобы получить список всех ролей управления доступом на основе ролей (RBAC), которым назначен этот командлет (включая все самостоятельно созданные роли RBAC), выполните в командной строке Командная консоль Lync Server или Windows PowerShell следующую команду:

    Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Lync Server 2013 cmdlet"}

Пример:

    Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}

Остальная часть данное темы посвящена определению поставщиков, изменению поставщика и компонентов поставщика, упрощающих поиск и устранение неисправностей. Существует два способа использования команд централизованной службы ведения журналов. Можно использовать средство CLSController.exe, расположенное по умолчанию в каталоге C:\\Program Files\\Common Files\\Microsoft Lync Server 2013\\CLSAgent. Или же можно использовать командную консоль Командная консоль Lync Server для выполнения команд Windows PowerShell. Важное отличие заключается в том, что при использовании CLSController.exe в командной строке доступен лишь ограниченный набор сценариев, в которых поставщики уже определены и не подлежат изменениям, однако уровень ведения журнала доступен для регулирования. При использовании Windows PowerShell можно определить новых поставщиков для использования в сеансах ведения журналов и установить полный контроль их создания, сбора данных и уровня сбора данных.

> [!IMPORTANT]  
> Как уже упоминалось, поставщики являются очень мощным средством. Однако сценарии имеют большее значение, так как объединяют в себе все данные, необходимые для определения и выполнения трассировок компонентов, представленных поставщиками. Сценарии, которые являются коллекциями поставщиков, можно сравнить с выполнением пакетного файла, содержащего сотни команд, для сбора большого объема данных, что отличается от выполнения сотен команд по одной в командной строке.<br />Нет необходимости узнавать все технические подробности работы поставщиков, так как централизованная служба ведения журнала предоставляет ряд уже определенных сценариев. Предоставленные сценарии покрывают большое количество различных проблем и неполадок, которые могут возникнуть. В редких случаях может понадобиться создать и определить поставщиков и назначить их в сценарии. Настоятельно рекомендуется ознакомиться с каждым предоставленным сценарием, прежде чем создавать новых поставщиков и сценарии. Хотя здесь предоставляются сведения о создании поставщиков, чтобы вы могли ознакомиться с тем, как сценарии используют элементы поставщиков для сбора данных трассировок, сведения о самих поставщиках в настоящее время не предоставлены.

Представленные в разделе [Обзор службы централизованного ведения журналов](lync-server-2013-overview-of-the-centralized-logging-service.md), ключевые элементы определения поставщика для использования в сценарии также приведены ниже.

  - **Поставщики**   Если вы знакомы с OCSLogger, то небезынтересно будет узнать, что поставщики являются компонентами, которые оповещают OCSLogger о том, где модуль трассировки должен собирать журналы. Поставщики — это те же компоненты (зачастую под теми же именами), которые используются в OCSLogger. Если вы не знакомы с OCSLogger, то поставщики — это компоненты, относящиеся к той или иной роли сервера, из которых централизованная служба ведения журнала может собирать журналы. В случае централизованной службы ведения журнала CLSAgent является архитектурной частью этой службы, которая выполняет трассировку компонентов, определенных в конфигурации поставщиков.

  - **Уровни ведения журналов**   OCSLogger предоставляет возможность выбора количества уровней детализации для собираемых данных. Эта функциональная возможность является неотъемлемой частью централизованной службы ведения журнала и определяется параметром **Type**. Можно выбрать следующие значения:
    
      - **Все**   Собирает сообщения трассировки (неустранимые ошибки, ошибки, предупреждения и информационные) и регистрирует их в определенном поставщике.
    
      - **Неустранимая ошибка**   Собирает только сообщения трассировки, указывающие на сбой определенного поставщика.
    
      - **Ошибка**   Собирает только сообщения трассировки, оповещающие об ошибке на определенном поставщике, а также сообщения о неустранимых ошибках.
    
      - **Предупреждение**   Собирает только сообщения трассировки, оповещающие о предупреждении на определенном поставщике, а также сообщения о неустранимых и простых ошибках.
    
      - **Информация**   Собирает только сообщения трассировки, оповещающие об информационном сообщении на определенном поставщике, а также сообщения о неустранимых ошибках, простых ошибках и предупреждениях.
    
      - **Verbose**   Собирает все сообщения трассировки (неустранимые ошибки, ошибки, предупреждения и информационные) для определенного поставщика.

  - **Флаги**   OCSLogger предоставляет возможность выбирать флаги для каждого поставщика, которые определяют, какой тип сведений можно получить из файлов трассировки. В зависимости от поставщика можно задать следующие флаги:
    
      - **TF\_Connection**   Предоставляет связанные с подключением записи журнала. Эти журналы включают сведения о подключениях к определенному компоненту. Кроме того, может быть включен большой объем сведений сетевого уровня (то есть для компонентов без концепции подключения).
    
      - **TF\_Security**   Предоставляет все события/записи журнала, относящиеся к безопасности. Например, для SipStack, это события безопасности, такие как ошибки проверки домена и ошибки проверки подлинности и авторизации клиентов.
    
      - **TF\_Diag**   Предоставляет события диагностики, которые можно использовать для диагностики или устранения неполадок, связанных с компонентом. Например, для SipStack это ошибки сертификатов или ошибки/предупреждения, связанные с DNS.
    
      - **TF\_Protocol**   Предоставляет сообщения протокола, такие как сообщения SIP и CCCP.
    
      - **TF\_Component**   Включает ведение журнала на компонентах, определенных как часть поставщиков.
    
      - **All**   Определяет все доступные для поставщиков флаги.

## Чтобы просмотреть сведения о существующих поставщиков сценариев для централизованной службы ведения журнала

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Чтобы просмотреть конфигурацию существующих поставщиков, введите следующую команду:
    
        Get-CsClsScenario -Identity <scope and scenario name>
    
    Например, чтобы просмотреть сведения о глобальном помощнике конференц-связи, введите следующее:
    
        Get-CsClsScenario -Identity "global/CAA"
    
    Команда отображает список поставщиков со связанными флагами, параметрами и компонентами. Если отображаемых сведений недостаточно или список слишком длинный для формата списка Windows PowerShell по умолчанию, можно отобразить дополнительные сведения, определив другой метод вывода. Для этого выполните следующую команду:
    
        Get-CsClsScenario -Identity "global/CAA" | Select-Object -ExpandProperty Provider
    
    В выходе этой команды отображается каждый поставщик. Каждая запись состоит из пяти строк: имя поставщика, тип ведения журнала, уровень ведения журнала, флаги, GUID и роль.

## Чтобы определить новый поставщик сценария централизованной службы ведения журнала

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Поставщик сценария состоит из отслеживаемого компонента, используемых флагов и уровня детализации собираемых данных. Это определяется следующей командой:
    
        $<variableName> = New-CsClsProvider -Name <provider component> -Type <log type> -Level <log level detail type> -Flags <provider trace log flags>
    
    Например, определение поставщика трассировки, которое указывает, что нужно собирать с поставщика Lyss и при каком уровне детализации, выглядит следующим образом.
    
        $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Info" -Flags "All"

Параметр –Level указывает сбор сообщений типа неустранимая ошибка, ошибка, предупреждение и информация. Используются флаги, которые определены для поставщика Lyss, а также TF\_Connection, TF\_Diag и TF\_Protocol.

После определения переменной $LyssProvider можно использовать ее в командлете **New-CsClsScenario** для сбора трассировок с поставщика Lyss. Чтобы завершить создание и назначение поставщика новому сценарию, введите следующую команду:

    New-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider

где $LyssProvider — это переменная, содержащая определенный сценарий, созданный с помощью командлета **New-CsClsProvider**.

## Чтобы изменить существующего поставщика сценария централизованной службы ведения журналов

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Чтобы обновить или изменить конфигурацию существующего поставщика, введите следующую команду:
    
        $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "TF_Connection, TF_Diag"
    
    Затем обновите сценарий, чтобы назначить поставщика. Введите следующее:
    
        Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider

Конечный результат выполнения команды — обновление флагов и уровня поставщика назначенного для сайта сценария: Redmond/RedmondLyssInfo. Новый сценарий можно просмотреть с помощью командлета Get-CsClsScenario. Дополнительные сведения см. в разделе [Get-CsClsScenario](https://docs.microsoft.com/en-us/powershell/module/skype/Get-CsClsScenario).

> [!WARNING]  
> <strong>New-ClsCsProvider</strong> не определяет допустимость флагов. Убедитесь, что названия флагов указаны верно (например, TF_DIAG или TF_CONNECTION). Если названия флагов указаны неверно, поставщик не вернет ожидаемые сведения журналов.

Если необходимо добавить в этот сценарий дополнительных поставщиков, введите следующую команду:

    Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Add=$ABSProvider, $CASProvider, S4Provider}

где каждый поставщик, определенный с помощью директивы Add, уже был определен с помощью процесса **New-CsClsProvider**.

## Чтобы удалить поставщика сценария

1.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

2.  Приведенные командлеты позволяют обновить существующих поставщиков и создать новых. Чтобы удалить поставщика, необходимо использовать директиву Replace для параметра Provider в командлете **Set-CsClsScenario**. Единственным способом полностью удалить поставщика является замена его на переопределенного поставщика того же типа с тем же именем, что выполняется с помощью директивы Update. Например, наш поставщик LyssProvider определен с типом журнала WPP, уровнем "Отладка" и флагами TF\_CONNECTION и TF\_DIAG. Необходимо изменить флаги на All. Чтобы изменить поставщика, выполните следующую команду:
    
    ```
    $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "All"
    ```
    ```
    Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Replace=$LyssProvider}
    ```

3.  Если необходимо полностью удалить сценарий и связанных с ним поставщиков, выполните следующую команду:
    
        Remove-CsClsScenario -Identity <scope and name of scenario>
    
    Пример:
    
        Remove-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo"
    
    > [!WARNING]  
    > Командлет <strong>Remove-CsClsScenario</strong> не запрашивает подтверждения. Сценарий удаляется вместе со всеми назначенными ему поставщиками. Можно повторно создать сценарий, повторно выполнив команды, которые использовались для его исходного создания. Процедуры восстановления удаленных сценариев или поставщиков не существует.

При удалении сценария с помощью командлета **Remove-CsClsScenario** вы полностью удаляете сценарий из области применения. Чтобы использовать созданные сценарии и поставщиков, которые являются частью сценария, необходимо создать новых поставщиков и назначить их новому сценарию.

## См. также

#### Другие ресурсы

[Get-CsClsScenario](https://docs.microsoft.com/en-us/powershell/module/skype/Get-CsClsScenario)  
[New-CsClsScenario](https://docs.microsoft.com/en-us/powershell/module/skype/New-CsClsScenario)  
[Remove-CsClsScenario](https://docs.microsoft.com/en-us/powershell/module/skype/Remove-CsClsScenario)  
[Set-CsClsScenario](https://docs.microsoft.com/en-us/powershell/module/skype/Set-CsClsScenario)  
[New-CsClsProvider](https://docs.microsoft.com/en-us/powershell/module/skype/New-CsClsProvider)

