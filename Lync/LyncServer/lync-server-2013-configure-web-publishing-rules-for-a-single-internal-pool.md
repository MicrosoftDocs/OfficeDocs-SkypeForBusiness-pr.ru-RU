---
title: 'Lync Server 2013: Настройка правил веб-публикации для отдельного внутреннего пула'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Configure web publishing rules for a single internal pool
ms:assetid: 86ff4b2a-1ba9-46a2-a175-8b19e00a49dd
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg429712(v=OCS.15)
ms:contentKeyID: 48184725
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: adf6a1d777e16827f41d9a795fde54fca49750e1
ms.sourcegitcommit: 831d141dfc5a49dd764cb296b73b63e5a9f8e599
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/21/2020
ms.locfileid: "42204635"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="configure-web-publishing-rules-for-a-single-internal-pool-in-lync-server-2013"></a>Настройка правил веб-публикации для отдельного внутреннего пула в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2014-07-07_

Microsoft Forefront Threat Management Gateway 2010 и Internet Information Server Routing Server (IIS ARR) использует правила веб-публикации для публикации внутренних ресурсов, таких как URL-адрес собрания, пользователям в Интернете.

Помимо URL-адресов веб-служб для виртуальных каталогов, необходимо также создать правила публикации для простых URL-адресов, URL-адреса LyncDiscover и сервера Office Web Apps. Для каждого простого URL-адреса необходимо создать отдельное правило на обратном прокси-сервере, указывающее на этот адрес.

Если вы развертываете службу мобильности и используете автоматическое обнаружение, вам необходимо создать правило публикации для внешнего URL-адреса службы автообнаружения. Для автоматического обнаружения также необходимы правила публикации для внешнего URL-адреса веб-служб Lync Server для пула директоров и интерфейсного пула. Дополнительные сведения о создании правил веб-публикации для автоматического обнаружения приведены [в статье Настройка обратного прокси-сервера для мобильной работы в Lync Server 2013](lync-server-2013-configuring-the-reverse-proxy-for-mobility.md).

Чтобы создать правила веб-публикации, используйте следующие инструкции.

<div>


> [!NOTE]  
> В этих процедурах предполагается, что вы установили стандартный выпуск Forefront Threat Management Gateway (TMG) 2010 или установили и настроили сервер Internet Information Server с расширением маршрутизации запросов приложений (IIS ARR). Вы используете либо TMG, либо IIS ARR.



</div>

<div>

## <a name="to-create-a-web-server-publishing-rule-on-the-computer-running-tmg-2010"></a>Создание правила публикации веб-сервера на компьютере с TMG 2010

1.  В меню **Пуск** последовательно выберите пункты **Программы**, **Microsoft Forefront TMG** и **Управление Forefront TMG**.

2.  В области слева разверните узел **Имя сервера**, щелкните правой кнопкой мыши пункт **Политика брандмауэра**, выберите пункт **Создать** и щелкните **Правило публикации веб-сайта**.

3.  На странице **Новое правило веб-публикации** введите отображаемое имя правила публикации (например, LyncServerWebDownloadsRule).

4.  На странице **Выбрать действие правила** выберите пункт **Разрешить**.

5.  На странице **Тип публикации** выберите пункт **Опубликовать один веб-сайт или систему балансировки нагрузки**.

6.  На странице **Безопасность подключения к серверу** выберите пункт **Использовать SSL для подключения к опубликованному веб-серверу или ферме серверов**.

7.  На странице **Внутренние сведения публикации** в поле **Внутреннее имя сайта** введите полное доменное имя внутренней веб-фермы, в которой размещается содержимое собраний и адресной книги.
    
    <div>
    

    > [!NOTE]  
    > Если внутренний сервер представляет собой сервер Standard Edition, необходимо ввести его полное доменное имя. Если внутренний сервер является интерфейсным пулом, в качестве полного доменного имени следует указать виртуальный IP-адрес аппаратного балансировщика нагрузки, который распределяет нагрузку на веб-серверы внутренней фермы. Сервер TMG должен иметь возможность разрешать полное доменное имя в IP-адрес внутреннего веб-сервера. Если сервер TMG не может разрешить полное доменное имя по правильному IP-адресу, можно выбрать параметр <STRONG>использовать имя компьютера или IP-адрес для подключения к опубликованному серверу</STRONG>, а затем в поле <STRONG>имя компьютера или</STRONG> <STRONG>IP-адрес</STRONG> введите IP-адрес внутреннего веб-сервера. В этом случае следует убедиться в том, что на сервере TMG открыт порт 53 и что этот сервер может связаться с сервером DNS, находящимся в сети периметра. Вы также можете обеспечить разрешение имен с помощью записей в файле локальных узлов.

    
    </div>

8.  На странице **внутренние сведения публикации** в поле **путь (необязательно)** введите ** / ** путь к папке, которую нужно опубликовать.
    
    <div>
    

    > [!NOTE]  
    > В мастере публикации веб-сайта можно указать только один путь. Дополнительные пути можно добавить путем изменения свойств правила.

    
    </div>

9.  На странице **Параметры внешнего имени** убедитесь в том, что в разделе **Принимать запросы для** выбран пункт **Это имя домена**, и введите полное доменное имя внешних веб-служб в поле **Внешнее имя**.

10. На странице **Выбрать веб-прослушиватель** нажмите кнопку **Создать**, чтобы открыть мастер определения нового веб-прослушивателя.

11. На странице **Мастер создания веб-прослушивателя** в поле **Имя веб-прослушивателя** введите имя веб-прослушивателя (например, LyncServerWebServers).

12. На странице **Безопасность клиентских подключений** выберите пункт **Требовать безопасного подключения SSL для клиентов**.

13. На странице **IP-адрес веб-прослушивателя** выберите пункт **Внешний** и нажмите кнопку **Выбрать IP-адреса**.

14. На странице **Выбор внешнего IP-адреса прослушивателя** выберите пункт **Указанный IP-адрес на компьютере Forefront TMG в выбранной сети**, выберите нужный IP-адрес и нажмите кнопку **Добавить**.

15. На странице **SSL-сертификаты прослушивателя** выберите пункт **Назначить сертификат для каждого IP-адреса**, выберите IP-адрес, связанный с полным доменным именем внешнего веб-сервера, и нажмите кнопку **Выбрать сертификат**.

16. На странице **Выбор сертификата** выберите сертификат, который соответствует внешним именам, указанным в шаге 9, и нажмите кнопку **Выбрать**.

17. На странице **Параметр проверки подлинности** выберите пункт **Без проверки подлинности**.

18. На странице **Параметр единого входа** нажмите кнопку **Далее**.

19. На странице **Завершение работы мастера определения веб-прослушивателя** проверьте, верны ли параметры **веб-прослушивателя**, и нажмите кнопку **Готово**.

20. На странице **Делегирование проверки подлинности** выберите пункт **Без делегирования, но клиент может выполнять проверку подлинности напрямую**.

21. На странице **Набор учетных записей** нажмите кнопку **Далее**.

22. На странице **Завершение работы мастера создания правила веб-публикации** проверьте, верны ли параметры правила веб-публикации, и нажмите кнопку **Готово**.

23. В области сведений нажмите кнопку **Применить**, чтобы сохранить изменения и обновить конфигурацию.

</div>

<div>

## <a name="to-create-a-web-server-publishing-rule-on-the-computer-running-iis-arr"></a>Создание правила публикации веб-сервера на компьютере, на котором выполняется служба IIS ARR

1.  Привяжите сертификат, который будет использоваться для обратного прокси-сервера, к протоколу HTTPS. Нажмите кнопку **Пуск**, выберите пункт **программы**, **Администрирование**, а затем щелкните **Диспетчер служб IIS**.
    
    <div>
    

    > [!NOTE]  
    > Дополнительная справка, снимки экрана и рекомендации по развертыванию и настройке службы IIS ARR можно найти в статье NextHop <A href="https://go.microsoft.com/fwlink/?linkid=293391">с использованием IIS arr в качестве обратного прокси-сервера для Lync Server 2013</A>.

    
    </div>

2.  Если вы еще не сделали это, импортируйте сертификат, который будет использоваться для обратного прокси-сервера. В **диспетчере служб IIS**щелкните имя обратного прокси-сервера в левой части консоли. В центре консоли в **службах IIS** найдите пункт **Сертификаты сервера**. Щелкните правой кнопкой мыши пункт **Сертификаты сервера** и выберите пункт **открыть компонент**.

3.  В правой части консоли щелкните **Импорт...**. Введите путь и имя файла сертификата с расширением или нажмите кнопку **...** , чтобы найти сертификат. Выберите сертификат и нажмите кнопку **Открыть**. Укажите пароль, используемый для защиты закрытого ключа (если вы назначили пароль при экспорте сертификата и закрытого ключа). Нажмите кнопку **ОК**. Если импорт сертификата был успешным, сертификат будет отображаться в качестве записи в середине консоли как запись в **сертификатах сервера**.

4.  Назначьте сертификат для использования протоколом HTTPS. В левой части консоли выберите **веб-сайт по умолчанию** сервера IIS. В правой части нажмите кнопку **привязки...**. В диалоговом окне **привязки сайта** нажмите кнопку **Добавить..**.. В диалоговом окне **Добавление привязки сайта** в разделе **Тип:** выберите **HTTPS**. Выбор протокола HTTPS позволяет выбрать сертификат, который будет использоваться для HTTPS. В разделе **SSL-сертификат:** выберите сертификат, импортированный для обратного прокси-сервера. Нажмите кнопку **ОК**. Затем нажмите кнопку **Закрыть**. Теперь сертификат связан с обратным прокси-сервером для протокола SSL и протоколом TLS.
    
    <div>
    

    > [!IMPORTANT]  
    > Если при закрытии диалоговых окон привязки, которые отсутствуют в промежуточных сертификатах, отображается предупреждение, необходимо найти и импортировать сертификат корневого центра сертификации и сертификаты промежуточного центра сертификации. Ознакомьтесь с инструкциями в общедоступном центре сертификации, с которого вы запросили сертификат, и следуйте инструкциям по запросу и импорту цепочки сертификатов. Если вы экспортировали сертификат с пограничного сервера, вы можете экспортировать сертификат корневого центра сертификации и все сертификаты промежуточного ЦС, связанные с пограничным сервером. Импортируйте сертификат корневого центра сертификации в компьютер (не следует путать с хранилищем доверенных корневых центров сертификации и промежуточными сертификатами в промежуточном хранилище центров сертификации компьютера).

    
    </div>

5.  В левой части консоли под именем сервера IIS щелкните правой кнопкой **фермы серверов** и выберите команду **создать ферму сервера..**..
    
    <div>
    

    > [!NOTE]  
    > Если узел <STRONG>фермы серверов</STRONG> не отображается, необходимо установить маршрутизацию запросов приложений. Дополнительные сведения см. в статье <A href="lync-server-2013-setting-up-reverse-proxy-servers.md">Настройка обратных прокси-серверов для Lync Server 2013</A>.

    
    </div>
    
    В диалоговом окне **Создание фермы серверов** в **поле имя фермы серверов**введите имя (это может быть понятное имя для целей идентификации) для первого URL-адреса. Нажмите кнопку **Далее**.

6.  В диалоговом окне **Добавление сервера** в поле **адрес сервера**введите полное доменное имя (FQDN) внешних веб-служб на сервере переднего плана. Имена, которые будут использоваться в качестве примера для примера, совпадают с используемыми в разделе Планирование для обратного прокси-сервера, [Сводка по сертификатам — обратный прокси-сервер в Lync Server 2013](lync-server-2013-certificate-summary-reverse-proxy.md). При обращении к обратному планированию прокси-сервера `webext.contoso.com`необходимо ввести полное доменное имя. Убедитесь, что установлен флажок рядом с параметром **Online** . Нажмите кнопку **Добавить** , чтобы добавить сервер в пул веб-серверов для этой конфигурации.
    
    <div>
    

    > [!WARNING]  
    > Lync Server использует аппаратные средства балансировки нагрузки для директоров пула и серверов переднего плана для трафика HTTP и HTTPS. При добавлении сервера в ферму серверов IIS ARR вы будете предоставлять только одно полное доменное имя. Полное доменное имя будет сервером переднего плана или режиссером в конфигурациях серверов без пула или полным доменным именем настроенного аппаратного балансировщика нагрузки для пулов серверов. Единственным поддерживаемым методом для балансировки нагрузки на трафик HTTP и HTTPS является использование аппаратных подсистем балансировки нагрузки.

    
    </div>

7.  В диалоговом окне **Добавление сервера** нажмите **Дополнительные параметры..**.. Откроется диалоговое окно для определения маршрутизации запросов приложений для запросов к настроенному полному доменному имени. Цель состоит в том, чтобы переопределить порт, используемый при обработке запроса службой IIS ARR.
    
    По умолчанию конечный HTTP-порт должен быть определен как 8080. Нажмите кнопку Далее рядом с текущим **httpPort 80** и установите значение **8080**. Нажмите кнопку Далее рядом с текущим **хттпспорт 443** и установите значение **4443**. Оставьте значение параметра **Weight** равное 100. При необходимости вы можете переопределить весовые коэффициенты для данного правила, когда у вас будет базовая статистика. Нажмите кнопку **Готово** , чтобы завершить эту часть конфигурации правила.

8.  В диалоговом окне могут отображаться правила перезаписи, которые информирует вас о том, что диспетчер IIS может создать правило перезаписи URL-адресов, чтобы автоматически маршрутизировать все входящие запросы на ферму серверов. Нажмите кнопку **Да**. Правила будут настраиваться вручную, но при нажатии кнопки Да задается начальная конфигурация...

9.  Щелкните имя только что созданной фермы серверов. В разделе **ферма серверов** в представлении функций диспетчера IIS дважды щелкните **кэширование**. Снимите флажок **включить кэш диска**. Нажмите кнопку **Применить** на правой стороне.

10. Щелкните имя фермы серверов. В разделе **ферма серверов** в представлении функций диспетчера IIS дважды щелкните **прокси-сервер**. На странице "Параметры прокси-сервера" измените значение для параметра **время ожидания (в секундах)** на значение, соответствующее вашему развертыванию. Нажмите кнопку **Применить** , чтобы сохранить изменения.
    
    <div>
    

    > [!IMPORTANT]  
    > Значение времени ожидания прокси-сервера — это число, которое будет отличаться от развертывания до развертывания. Необходимо следить за развертыванием и изменять значение для лучшего взаимодействия с клиентами. Вы можете задать значение, равное 200. Если вы поддерживаете мобильные клиенты Lync в вашей среде, установите для этого параметра значение 960, чтобы разрешить время ожидания push-уведомлений от Office 365, у которых значение времени ожидания равно 900. Очень вероятно, что вам потребуется увеличить значение времени ожидания, чтобы избежать отключения клиента, когда значение слишком мало или не будет превышать число подключений через прокси-сервер, а затем очистить после отключения клиента. Наблюдение и структурирование для базовой среды — единственный способ определить, где именно это значение подходит для вашей среды.

    
    </div>

11. Щелкните имя фермы серверов. В разделе **ферма серверов** в представлении функций диспетчера IIS дважды щелкните **правила маршрутизации**. В диалоговом окне Правила маршрутизации в разделе Маршрутизация снимите флажок включить разгрузку SSL. Если возможность снять флажок недоступна, установите флажок **использовать переопределение URL-адресов для проверки входящих запросов**. Нажмите кнопку **Применить** , чтобы сохранить изменения.
    
    <div>
    

    > [!WARNING]  
    > Разгрузка SSL с помощью обратного прокси-сервера не поддерживается.

    
    </div>

12. Повторите шаги 5-11 для каждого URL-адреса, который должен пройти через обратный прокси-сервер. Общий список будет выглядеть следующим образом:
    
      - Внешние веб-службы сервера переднего плана: webext.contoso.com (уже настроено с помощью начального прохода)
    
      - Внешние веб-службы Director для директора: webdirext.contoso.com (необязательно, если директор развернут)
    
      - Соответствие простым URL-адресом: meet.contoso.com
    
      - Набор простых URL-адресов: dialin.contoso.com
    
      - URL-адрес автообнаружения Lync: lyncdiscover.contoso.com
    
      - URL-адрес сервера Office Web Apps: officewebapps01.contoso.com
        
        <div>
        

        > [!IMPORTANT]  
        > URL-адрес для сервера Office Web Apps будет использовать другой адрес Хттпспорт. В шаге 7 Определите <STRONG>хттпспорт</STRONG> как <STRONG>443</STRONG> и <STRONG>httpPort</STRONG> в качестве порта <STRONG>80</STRONG>. Все остальные параметры конфигурации одинаковы.

        
        </div>

13. В левой части консоли щелкните имя сервера IIS. В центре консоли найдите параметр **Перезапись URL-адресов** в **службах IIS**. Дважды щелкните элемент URL-адрес для перезаписи, чтобы открыть конфигурацию правил перезаписи URL-адресов. Должны отобразиться правила для каждой фермы серверов, созданной на предыдущих шагах. В противном случае подтвердите, что вы щелкните имя **сервера IIS** сразу под узлом **начальной страницы** в консоли диспетчера сервера IIS.

14. В диалоговом окне **перезаписи URL-адреса** с использованием webext.contoso.com в качестве примера полное имя правила, как отображается, **—\_arr\_webext.contoso.com\_лоадбаланце SSL**.
    
      - Дважды щелкните правило, чтобы открыть диалоговое окно **Изменение правила для входящих подключений** .
    
      - Нажмите кнопку **Добавить...** в диалоговом окне " **условия** ".
    
      - В поле **Добавить условие** при **входе условия:** введите **{HTTP\_Host}**. (При вводе будет открыто диалоговое окно, в котором можно выбрать условие). в разделе **проверить, если входная строка:** SELECT **соответствует шаблону**. В **\*** типе **входных данных шаблона** . Флажок **игнорировать регистр** должен быть установлен. Нажмите кнопку **ОК**.
    
      - Прокрутите вниз в диалоговом окне **Изменение правила для входящих подключений** , чтобы перейти к диалоговому окну **действие** . **Тип действия:** должен быть установлен для **маршрутизации к ферме серверов**, **схема:** задано значение **https://**, **ферма серверов:** указать URL-адрес, к которому применяется это правило. В этом примере должно быть задано значение **webext.contoso.com**. **Путь:** задано значение **/{р: 0}**
    
      - Нажмите кнопку **Применить** , чтобы сохранить изменения. Нажмите кнопку **назад,** чтобы вернуться к правилам перезаписи URL-адресов.

15. Повторите процедуру, описанную в шаге 14, для каждого определенного правила перезаписи SSL, по одному URL-адресу фермы серверов.
    
    <div>
    

    > [!WARNING]  
    > По умолчанию правила HTTP также создаются и обозначаются похожим именем для правил SSL. Для нашего текущего примера правило HTTP будет называться <STRONG>ARR_webext. contoso. com_loadbalance</STRONG>. Эти правила не требуют изменений, и их можно спокойно игнорировать.

    
    </div>

</div>

<div>

## <a name="to-modify-the-properties-of-the-web-publishing-rule-in-tmg-2010"></a>Изменение свойств правила веб-публикации в TMG 2010

1.  Нажмите кнопку **Пуск**, последовательно выберите пункты **программы**, **Microsoft FOREFRONT TMG**и **Управление Forefront TMG**.

2.  В области слева разверните узел **Имя сервера** и щелкните пункт **Политика брандмауэра**.

3.  В области сведений щелкните правой кнопкой мыши созданное ранее правило публикации веб-сервера (например, LyncServerExternalRule) и выберите пункт **Свойства**.

4.  На странице **Свойства** на вкладке **Откуда** сделайте следующее.
    
      - В списке **Это правило применяется к трафику от следующих источников** выберите пункт **Везде** и нажмите кнопку **Удалить**.
    
      - Нажмите кнопку **Добавить**.
    
      - На странице **Добавление сетевых сущностей** разверните узел **Сети**, щелкните **Внешние**, нажмите кнопку **Добавить**, а затем нажмите кнопку **Закрыть**.

5.  На вкладке **Куда** убедитесь в том, что установлен флажок **Пересылать исходный заголовок узла вместо действительного**.

6.  На вкладке **Использование моста** установите флажок **Пересылать запрос на порт SSL** и укажите порт **4443**.

7.  На вкладке **Внешнее имя** добавьте простые URL-адреса (например, meet.contoso.com и dialin.contoso.com).

8.  Нажмите кнопку **Применить**, чтобы сохранить изменения, после чего нажмите кнопку **ОК**.

9.  В области сведений нажмите кнопку **Применить**, чтобы сохранить изменения и обновить конфигурацию.

</div>

<div>

## <a name="to-modify-the-properties-of-the-web-publishing-rule-in-iis-arr"></a>Изменение свойств правила веб-публикации в службах IIS ARR

1.  Нажмите кнопку **Пуск**, выберите пункт **программы**, **Администрирование**, а затем щелкните **Диспетчер служб IIS**.

2.  В левой части консоли щелкните имя сервера IIS.

3.  В центре консоли найдите параметр **Перезапись URL-адресов** в **службах IIS**. Дважды щелкните элемент URL-адрес для перезаписи, чтобы открыть конфигурацию правил перезаписи URL-адресов.

4.  Дважды щелкните правило, которое необходимо изменить. Внесите необходимые изменения в **соответствии с URL-адресом**, **условиями**, **серверными переменными** или **действием**.

5.  Нажмите кнопку **Применить** , чтобы сохранить изменения. Нажмите кнопку **назад, чтобы** изменить другие правила, или закройте консоль **диспетчера IIS** , если вы закончите внесенные изменения.

</div>

</div>

<span> </span>

</div>

</div>

</div>

