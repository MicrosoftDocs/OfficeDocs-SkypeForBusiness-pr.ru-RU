---
title: 'Lync Server 2013: настройка правил веб-публикации для единого внутреннего пула'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Configure web publishing rules for a single internal pool
ms:assetid: 86ff4b2a-1ba9-46a2-a175-8b19e00a49dd
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg429712(v=OCS.15)
ms:contentKeyID: 48184725
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 6ea798f3d5cefa3b65194eb8afcb6e9b35aaa9c1
ms.sourcegitcommit: b693d5923d6240cbb865241a5750963423a4b33e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2020
ms.locfileid: "41741319"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="configure-web-publishing-rules-for-a-single-internal-pool-in-lync-server-2013"></a>Настройка правил веб-публикации для единого внутреннего пула в Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Тема последнего изменения:** 2014-07-07_

Microsoft Forefront Threat Management Gateway 2010 и Internet Information Server Routing (IIS ARR) использует правила веб-публикации для публикации внутренних ресурсов, таких как URL-адрес собрания, для пользователей в Интернете.

В дополнение к URL-адресам для виртуальных каталогов необходимо также создать правила публикации для простых URL, URL-адреса LyncDiscover и сервера Office Web Apps. Для каждого простого URL-адреса необходимо создать отдельное правило для обратного прокси-сервера, указывающего на этот простой URL-адрес.

Если вы развертываете мобильность и используете автоматическое обнаружение, вам нужно создать правило публикации для внешнего URL-адреса службы автообнаружения. Для автоматического обнаружения также необходимо иметь правила публикации для внешнего URL-адреса служб сервера Lync Server для вашего пула каталогов и внешнего пула. Дополнительные сведения о создании правил веб-публикации для автоматического обнаружения см. [в разделе Настройка обратного прокси-сервера для мобильных устройств в Lync Server 2013](lync-server-2013-configuring-the-reverse-proxy-for-mobility.md).

Чтобы создать правила веб-публикации, выполните указанные ниже действия.

<div>


> [!NOTE]  
> В этой процедуре предполагается, что вы установили стандартный выпуск шлюза Forefront Threat Management Gateway (TMG) 2010 или установили и настроили сервер информационных служб Интернета с помощью расширения маршрутизации запросов приложений (IIS ARR). Вы используете либо TMG, либо IIS ARR.



</div>

<div>

## <a name="to-create-a-web-server-publishing-rule-on-the-computer-running-tmg-2010"></a>Создание правила публикации веб-сервера на компьютере, на котором запущено приложение TMG 2010

1.  Нажмите кнопку **Пуск**, выберите пункт **программы**, а затем — **Microsoft FOREFRONT TMG**и выберите **Forefront TMG Management**.

2.  На левой панели разверните узел **ServerName**, щелкните правой кнопкой мыши **политику брандмауэра**, выберите пункт **создать**, а затем — **правило публикации веб-сайта**.

3.  На странице **Добро пожаловать на новую страницу правила веб-публикации** введите отображаемое имя для правила публикации (например, линксервервебдовнлоадсруле).

4.  На странице **Выбор действия правила** выберите пункт **Разрешить**.

5.  На странице **Тип публикации** выберите **Опубликовать один веб-сайт или подсистему балансировки нагрузки**.

6.  На странице " **Безопасность подключения сервера** " выберите команду " **использовать SSL" для подключения к опубликованному веб-серверу или ферме серверов**.

7.  На странице **Внутренняя публикация** введите полное доменное имя внутренней веб-фермы, в которой размещается содержимое собрания и адресная книга, в поле **внутренний сайт имя** .
    
    <div>
    

    > [!NOTE]  
    > Если внутренний сервер является стандартным сервером выпуска, это полное доменное имя сервера Standard Edition. Если внутренний сервер является пулом переднего плана, это полное доменное имя подсистемы балансировки нагрузки для внутренних серверов веб-ферм (VIP). Сервер TMG должен иметь возможность разрешения полного доменного имени на IP-адрес внутреннего веб-сервера. Если сервер TMG не может разрешить полное доменное имя для правильного IP-адреса, вы можете выбрать параметр <STRONG>использовать имя компьютера или IP-адрес для подключения к опубликованному серверу</STRONG>, а затем в поле <STRONG>имя компьютера или</STRONG> <STRONG>IP-адрес</STRONG> введите IP-адрес внутреннего веб-сервера. В этом случае необходимо убедиться, что порт 53 открыт на сервере TMG и что он может подключиться к DNS-серверу, который находится в демилитаризованной зоне. Вы также можете использовать записи в локальном файле hosts, чтобы предоставить разрешение имен.

    
    </div>

8.  На странице **внутренние сведения о публикации** в поле **путь (необязательно)** введите ** / ** путь к папке, которую нужно опубликовать.
    
    <div>
    

    > [!NOTE]  
    > В мастере публикации веб-сайта можно указать только один путь. Дополнительные пути можно добавить, изменив свойства правила.

    
    </div>

9.  На странице **сведения об общедоступном имени** убедитесь в том, что в разделе **запросы**на получение указано **имя домена** , введите полное доменное имя внешней веб-службы в поле **Public Name** .

10. На странице **выбора веб-прослушивателя** нажмите кнопку **создать** , чтобы открыть мастер создания определения веб-прослушивателя.

11. На странице **Добро пожаловать на страницу мастера создания веб-прослушивателя** введите имя веб-слушателя в поле **имя веб-прослушивателя** (например, линксервервебсерверс).

12. На странице **Безопасность подключения клиента** выберите **требования SSL Secure Connections с клиентами**.

13. На странице **IP-адрес веб-прослушивателя** выберите **внешний**и нажмите кнопку **Выбрать IP-адреса**.

14. На странице " **Выбор IP-адреса внешнего прослушивателя** " выберите **указанный IP-адрес на компьютере Forefront TMG в выбранной сети**, выберите соответствующий IP-адрес, а затем нажмите кнопку **добавить**.

15. На странице " **SSL Certificates Listener** " выберите **назначение сертификата для каждого IP-адреса**, выберите IP-адрес, связанный с внешним доменным именем, и нажмите кнопку **выбрать сертификат**.

16. На странице " **Выбор сертификата** " выберите сертификат, совпадающий с общедоступными именами, указанными на шаге 9, и нажмите кнопку **выбрать**.

17. На странице **Параметры проверки подлинности** выберите вариант **без проверки подлинности**.

18. На странице **Параметры единого входа** нажмите кнопку **Далее**.

19. На странице **Завершение работы мастера веб-прослушивателя** убедитесь, что правильно заданы параметры **веб-прослушивателя** , и нажмите кнопку **Готово**.

20. На странице **Делегирование проверки подлинности** выберите вариант **без делегирования, но клиент может пройти проверку подлинности напрямую**.

21. На странице **User Set (пользовательский** ) нажмите кнопку **Далее**.

22. На странице **завершения мастера создания правила веб-публикации** убедитесь, что параметры правила веб-публикации указаны правильно, и нажмите кнопку **Готово**.

23. В области сведений нажмите кнопку **Применить** , чтобы сохранить изменения и обновить конфигурацию.

</div>

<div>

## <a name="to-create-a-web-server-publishing-rule-on-the-computer-running-iis-arr"></a>Создание правила публикации веб-сервера на компьютере с IIS ARR

1.  Привяжите сертификат, который будет использоваться для обратного прокси-сервера, к протоколу HTTPS. Нажмите кнопку **Пуск**, выберите пункт **программы**, а затем — **Администрирование**, а затем — пункт **Диспетчер информационных служб Интернета (IIS)**.
    
    <div>
    

    > [!NOTE]  
    > Дополнительные сведения, снимки экрана и руководство по развертыванию и настройке служб ARR можно найти в статье NextHop <A href="http://go.microsoft.com/fwlink/?linkid=293391">с помощью IIS arr в качестве обратного прокси-сервера для Lync Server 2013</A>.

    
    </div>

2.  Если вы еще не сделали этого, импортируйте сертификат, который будет использоваться для обратного прокси-сервера. В **диспетчере служб IIS**выберите обратное имя прокси-сервера в левой части консоли. В центре консоли, расположенной в **службах IIS** , найдите пункт **Сертификаты сервера**. Щелкните правой кнопкой мыши **серверные сертификаты** и выберите пункт **открыть компонент**.

3.  В правой части консоли щелкните **Импорт...**. Введите путь и имя файла сертификата с расширением либо нажмите кнопку **...** для обзора сертификата. Выберите сертификат и нажмите кнопку **Открыть**. Укажите пароль, используемый для защиты закрытого ключа (если вы назначили пароль при экспорте сертификата и закрытого ключа). Нажмите кнопку **ОК**. Если импорт сертификата прошел успешно, сертификат будет отображаться в центре консоли как запись в **сертификатах сервера**.

4.  Назначьте сертификат для использования HTTPS. В левой части консоли выберите **веб-сайт по умолчанию** сервера IIS. В правой части экрана выберите пункт **привязки..**.. В диалоговом окне **привязки сайта** нажмите кнопку **Добавить..**.. В диалоговом окне **Добавление привязки сайта** в разделе **Тип:** выберите **HTTPS**. Выбрав HTTPS, вы сможете выбрать сертификат, который будет использоваться для HTTPS. В разделе **SSL-сертификат:** выберите сертификат, который вы импортировали для обратного прокси. Нажмите кнопку **ОК**. Затем нажмите кнопку **Закрыть**. Теперь сертификат привязан к обратному прокси-серверу для протокола SSL и безопасности транспортного уровня (TLS).
    
    <div>
    

    > [!IMPORTANT]  
    > Если при закрытии диалоговых окон привязки, для которых отсутствуют промежуточные сертификаты, появляется предупреждение, необходимо найти и импортировать сертификат корневого центра сертификации и все промежуточные сертификаты ЦС. Просмотрите инструкции в общедоступном центре сертификации, с которого вы запросили сертификат, и следуйте инструкциям, чтобы запросить и импортировать цепочку сертификатов. Если вы экспортировали сертификат с пограничного сервера, вы можете экспортировать сертификат корневого ЦС и все промежуточные сертификаты ЦС, связанные с пограничным сервером. Импортируйте сертификат корневого центра сертификации в компьютер (не следует путать с хранилищем пользователей) и промежуточные сертификаты в хранилище промежуточных центров сертификации компьютера.

    
    </div>

5.  В левой части консоли, расположенной под именем сервера IIS, щелкните правой кнопкой мыши пункт **фермы серверов** и выберите команду **создать ферму сервера..**..
    
    <div>
    

    > [!NOTE]  
    > Если вы не видите узел <STRONG>ферм серверов</STRONG> , вам нужно установить маршрут запросов приложений. Подробности можно найти в разделе <A href="lync-server-2013-setting-up-reverse-proxy-servers.md">Настройка обратного прокси-сервера для Lync Server 2013</A>.

    
    </div>
    
    В диалоговом окне **Создание фермы серверов** в **поле имя фермы серверов**введите имя и фамилию (это может быть понятное имя для целей идентификации) для первого URL-адреса. Нажмите кнопку **Далее**.

6.  В диалоговом окне **Добавление сервера** в **адресе сервера**введите полное доменное имя (FQDN) внешних веб-служб на сервере переднего плана. Имена, которые будут использоваться в качестве примера, такие же, как и в разделе Планирование для обратного прокси-сервера, [сведения о сертификате — обратный прокси-сервер в Lync Server 2013](lync-server-2013-certificate-summary-reverse-proxy.md). При обращении к обратному планированию прокси-сервера `webext.contoso.com`мы будем вводить полное доменное имя. Убедитесь, что установлен флажок рядом с параметром "в **сети** ". Нажмите кнопку **Добавить** , чтобы добавить сервер в пул веб-серверов для этой конфигурации.
    
    <div>
    

    > [!WARNING]  
    > Lync Server использует подсистемы балансировки нагрузки оборудования для директоров пула и серверных интерфейсов для трафика HTTP и HTTPS. При добавлении сервера в ферму серверов IIS ARR вы будете использовать только одно полное доменное имя. Полное доменное имя будет сервером или режиссером в конфигурациях серверов без пула или с помощью полного доменного имени настроенного аппаратного балансировщика балансировки нагрузки для пулов серверов. Трафик HTTP и HTTPS поддерживается только в том случае, если вы используете аппаратную подсистему балансировки нагрузки.

    
    </div>

7.  В диалоговом окне **Добавление сервера** нажмите кнопку **Дополнительные параметры..**.. Откроется диалоговое окно, в котором можно задать маршрутизацию запросов приложений для запросов к настроенному полному доменному имени. Цель — переопределение порта, используемого при обработке запроса службой IIS ARR.
    
    По умолчанию конечный HTTP-порт должен быть определен как 8080. Нажмите кнопку рядом с текущим **хттппорт 80** и установите значение **8080**. Нажмите кнопку рядом с текущим **хттпспорт 443** и установите значение **4443**. Оставьте параметр **веса** в 100. При необходимости вы можете переопределить весовые коэффициенты для определенного правила, когда будет определена базовая статистика. Нажмите кнопку **Готово** , чтобы завершить настройку правила.

8.  В диалоговом окне могут появляться правила повторной записи, в которых сообщается о том, что диспетчер IIS может создать правило перезаписи URL-адресов, чтобы автоматически маршрутизировать все входящие запросы на ферму сервера. Нажмите **Да**. Вы будете настраивать правила вручную, но при нажатии кнопки Да задается первоначальная настройка...

9.  Щелкните имя фермы серверов, которую вы только что создали. В разделе **ферма серверов** в представлении функции IIS Manager дважды щелкните **кэширование**. Снимите флажок **включить кэш на диске**. Щелкните **Apply (применить** ) в правой части экрана.

10. Щелкните имя фермы серверов. В разделе **ферма серверов** в представлении функции IIS Manager дважды щелкните **прокси-сервер**. На странице Параметры прокси-сервера измените значение для параметра **время ожидания (в секундах)** на значение, подходящее для вашего развертывания. Нажмите кнопку **Применить** , чтобы сохранить изменения.
    
    <div>
    

    > [!IMPORTANT]  
    > Значение времени ожидания прокси-сервера — число, которое будет отличаться в зависимости от развертывания до развертывания. Необходимо следить за развертыванием и изменять значение для оптимальной работы клиентов. Вы можете установить значение как минимум 200. Если вы поддерживаете мобильные клиенты Lync в своей среде, необходимо установить для этого параметра значение 960, чтобы разрешить получение push-уведомлений из Office 365 с тайм-аутм, равным 900. Возможно, вам потребуется увеличить время ожидания, чтобы избежать отключения клиента, если значение слишком низкое, либо уменьшить номер, если все подключения через прокси-сервер не отключаются и не удаляются долго после отключения клиента. Наблюдение и структурирование. что обычно является нормальным для вашей среды – единственный способ определить, где именно это значение задано.

    
    </div>

11. Щелкните имя фермы серверов. В разделе **ферма серверов** в представлении функции IIS Manager дважды щелкните **правила маршрутизации**. В диалоговом окне Правила маршрутизации в разделе Маршрутизация снимите флажок включить разгрузку SSL. Если возможность снять флажок недоступна, установите флажок **использовать функцию перезаписи URL-адресов для проверки входящих запросов**. Нажмите кнопку **Применить** , чтобы сохранить изменения.
    
    <div>
    

    > [!WARNING]  
    > Разгрузка SSL с помощью обратного прокси-сервера не поддерживается.

    
    </div>

12. Повторите шаги 5-11 для каждого URL-адреса, который должен пройти через обратный прокси-сервер. Общий список может выглядеть следующим образом:
    
      - Веб-службы сервера переднего плана внешние: webext.contoso.com (уже настроена первоначальная пошаговая проверка)
    
      - Веб-службы, внешние для Director: webdirext.contoso.com (необязательно, если режиссер развернут)
    
      - Простое соответствие URL-адресу: meet.contoso.com
    
      - URL-адрес простого набора: dialin.contoso.com
    
      - URL-адрес автообнаружения Lync: lyncdiscover.contoso.com
    
      - URL-адрес сервера Office Web Apps: officewebapps01.contoso.com
        
        <div>
        

        > [!IMPORTANT]  
        > URL-адрес сервера Office Web Apps будет использовать другой адрес Хттпспорт. На шаге 7 вы определяете <STRONG>хттпспорт</STRONG> как <STRONG>443</STRONG> и <STRONG>хттппорт</STRONG> как порт <STRONG>80</STRONG>. Все остальные параметры конфигурации одинаковы.

        
        </div>

13. В левой части консоли щелкните имя сервера IIS. В центре консоли найдите **URL-адрес для перезаписи** в **службах IIS**. Дважды щелкните элемент URL-адрес для перезаписи, чтобы открыть конфигурацию правил для перезаписи URL-адреса. Для каждой фермы серверов, созданной на предыдущих шагах, должны отобразиться правила. В противном случае подтвердите, что вы щелкаем по имени **сервера IIS** сразу под узлом **Начальная страница** консоли диспетчера сервера IIS.

14. В диалоговом окне **перезаписи URL-адреса** с использованием webext.contoso.com в качестве примера полное имя правила, которое отображается, — это **arr\_webext.contoso.com\_лоадбаланце\_SSL**.
    
      - Дважды щелкните правило, чтобы открыть диалоговое окно **Изменение правила для входящих подключений** .
    
      - Нажмите кнопку **Добавить...** в диалоговом окне **условия** .
    
      - В поле " **Добавить** условие **" на входе условия** введите **{\_HTTP Host}**. (По мере ввода появится диалоговое окно, в котором вы сможете выбрать условие). в разделе **Проверка наличия строки ввода:** SELECT **соответствует шаблону**. В **\*** типе **ввода "шаблон** ". Флажок **игнорировать регистр** должен быть установлен. Нажмите кнопку **ОК**.
    
      - Прокрутите страницу вниз в диалоговом окне **Изменение правила для входящих** сообщений, чтобы перейти к диалоговому окну **действия** . **Тип действия:** должен быть настроен для **маршрутизации на ферму сервера**, **Схема:** установлен на **https://**, **ферму сервера:** укажите URL-адрес, к которому применяется данное правило. В этом примере для этого примера должно быть установлено значение **webext.contoso.com**. **Путь:** задано значение **/{р: 0}**
    
      - Нажмите кнопку **Применить** , чтобы сохранить изменения. Нажмите кнопку **назад,** чтобы вернуться к разделу правила для перезаписи URL-адреса.

15. Повторите процедуру, определенную на шаге 14, для каждого определенного правила повторной записи SSL, для каждого из которых указан URL-адрес фермы серверов.
    
    <div>
    

    > [!WARNING]  
    > По умолчанию правила HTTP также создаются и обозначаются аналогичным именованию правил SSL. Для нашего текущего примера правило HTTP будет называться <STRONG>ARR_webext. contoso. com_loadbalance</STRONG>. Эти правила не требуют никаких изменений, и их можно игнорировать.

    
    </div>

</div>

<div>

## <a name="to-modify-the-properties-of-the-web-publishing-rule-in-tmg-2010"></a>Изменение свойств правила веб-публикации в TMG 2010

1.  Нажмите кнопку **Пуск**, наведите указатель мыши на пункт **программы**, выберите **Microsoft FOREFRONT TMG**и щелкните **Forefront TMG Management**.

2.  На левой панели разверните узел **ServerName**и выберите пункт **Политика брандмауэра**.

3.  В области сведений щелкните правой кнопкой мыши правило публикации веб-сервера, созданное в предыдущей процедуре (например, Линксерверекстерналруле), и выберите пункт **Свойства**.

4.  На странице " **Свойства** " на вкладке " **от** " выполните указанные ниже действия.
    
      - В **этом правиле применяется к трафику из списка источников** , выберите в **любом месте**и нажмите кнопку **Удалить**.
    
      - Нажмите **Добавить**.
    
      - В диалоговом окне **Добавление сетевых объектов**разверните элемент **сети**, выберите элемент **Внешние**, нажмите кнопку **Добавить**, а затем — **Закрыть**.

5.  На вкладке " **на** " убедитесь, что **вместо фактического установлен флажок переадресовать первоначальный заголовок узла** .

6.  На вкладке **мост** установите флажок **перенаправить на порт SSL** и укажите порт **4443**.

7.  На вкладке **общедоступное имя** добавьте простые URL-адреса (например, meet.contoso.com и Dialin.contoso.com).

8.  Нажмите кнопку **Применить** , чтобы сохранить изменения, а затем нажмите кнопку **ОК**.

9.  В области сведений нажмите кнопку **Применить** , чтобы сохранить изменения и обновить конфигурацию.

</div>

<div>

## <a name="to-modify-the-properties-of-the-web-publishing-rule-in-iis-arr"></a>Изменение свойств правила веб-публикации в службах IIS ARR

1.  Нажмите кнопку **Пуск**, выберите пункт **программы**, а затем — **Администрирование**, а затем — пункт **Диспетчер информационных служб Интернета (IIS)**.

2.  В левой части консоли щелкните имя сервера IIS.

3.  В центре консоли найдите **URL-адрес для перезаписи** в **службах IIS**. Дважды щелкните элемент URL-адрес для перезаписи, чтобы открыть конфигурацию правил для перезаписи URL-адреса.

4.  Дважды щелкните правило, которое необходимо изменить. Внесите необходимые изменения в **соответствии с URL-адресом**, **условиями**, **серверными переменными** или **действием**.

5.  Нажмите кнопку **Применить** , чтобы зафиксировать изменения. Нажмите кнопку " **назад к правилам** ", чтобы изменить другие правила, или закройте консоль **диспетчера IIS** , если вы закончите вносить изменения.

</div>

</div>

<span> </span>

</div>

</div>

</div>

