---
title: 'Lync Server 2013: Настройка Lync Server для использования единого хранилища контактов'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Configuring Lync Server 2013 to use the unified contact store
ms:assetid: 6aa17ae3-764e-4986-a900-85a3cdb8c1fc
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ688083(v=OCS.15)
ms:contentKeyID: 49733680
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 9875cb075f29f9f2efcb9328d1ac2d39d2f8ae89
ms.sourcegitcommit: 831d141dfc5a49dd764cb296b73b63e5a9f8e599
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/21/2020
ms.locfileid: "42188382"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="configuring-microsoft-lync-server-2013-to-use-the-unified-contact-store"></a>Настройка Microsoft Lync Server 2013 для использования единого хранилища контактов

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2014-02-07_

Единое хранилище контактов позволяет пользователям поддерживать один список контактов и иметь доступ к ним в нескольких приложениях, в том числе Microsoft Lync 2013, Microsoft Outlook 2013 и Microsoft Outlook Web App 2013. При включении единого хранилища контактов для пользователя, в котором контакты пользователя не хранятся в Microsoft Lync Server 2013, а затем извлекаются по протоколу SIP. Вместо этого его контакты хранятся в Microsoft Exchange Server 2013 и извлекаются с помощью веб-служб Exchange.

<div>


> [!NOTE]  
> С технической точки зрения контактные данные хранятся в виде папок, которые находятся в почтовом ящике Exchange 2013 пользователя. Сами контакты хранятся в папке с именем Contacts в Lync, которая видна конечным пользователям; метаданные о контактах хранятся во вложенной папке, невидимой для конечных пользователей.



</div>

<div>

## <a name="enabling-the-unified-contact-store-for-a-user"></a>Включение единого хранилища контактов для пользователей

Если вы уже настроили межсерверную проверку подлинности между Lync Server 2013 и Exchange 2013, вы также включили использование единого хранилища контактов; Дополнительная настройка сервера не является обязательной. Однако для перемещения контактов пользователя в единое хранилище контактов требуется дополнительная настройка учетной записи пользователя. По умолчанию контакты пользователей хранятся в Lync Server, а не в едином хранилище контактов.

Управление доступом к единому хранилищу контактов осуществляется с помощью политик служб пользователей Lync Server. У политик служб пользователей всего одно свойство (UcsAllowed), которое используется для определения расположения хранения контактов пользователя. Если пользователь управляется политикой служб пользователей, в которой для UcsAllowed задано значение true ($True), контакты пользователя будут храниться в едином хранилище контактов. Если пользователь управляется политикой служб пользователей, в которой для UcsAllowed задано значение false ($False), его контакты будут храниться в Lync Server.

При установке Lync Server 2013 также устанавливается одна политика служб пользователя (настроенная в глобальной области). Значение UcsAllowed в этой политике равно true, то есть по умолчанию пользовательские контакты будут храниться в едином хранилище контактов (при условии, что оно развернуто и настроено). Если вы хотите перенести все контакты пользователей в единое хранилище контактов, ничего делать не нужно.

Если вы предпочитаете не перенести все контакты в единое хранилище контактов, вы можете отключить единое хранилище контактов для всех пользователей, задав для свойства UcsAllowed в глобальной политике значение false:

    Set-CsUserServicesPolicy -Identity global -UcsAllowed $False

После отключения единого хранилища контактов в глобальной политике вы можете создать политику на уровне пользователя, которая позволит использовать единое хранилище контактов; Это позволяет некоторым пользователям хранить свои контакты в едином хранилище контактов, в то время как другие пользователи продолжают хранить свои контакты в Lync Server. Вы можете создать политику служб пользователя на уровне пользователя с помощью следующей команды:

    New-CsUserServicesPolicy -Identity "AllowUnifiedContactStore" -UcsAllowed $True

После создания политики ее необходимо назначить всем пользователям, которым требуется доступ к единому хранилищу контактов. Политики на уровне пользователей можно назначить пользователям с помощью следующей команды:

    Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "AllowUnifiedContactStore"

После назначения этой политике Lync Server начнет переносить контакты пользователя в единое хранилище контактов. После завершения миграции пользователь будет иметь свои контакты, хранящиеся в Exchange, а не в Lync Server. Если пользователь вошел в Lync 2013 после завершения миграции, появится окно сообщения, и ему будет предложено выйти из Lync, а затем снова войти в систему для завершения процесса. Контакты, которым не назначена эта политика на уровне пользователей, не будут перенесены в единое хранилище контактов. Это связано с тем, что пользователи управляются глобальной политикой, и в глобальной политике отключено использование единого хранилища контактов.

Вы можете убедиться, что контакты пользователя успешно перенесены в единое хранилище контактов, выполнив командлет [Test-CsUnifiedContactStore](https://docs.microsoft.com/powershell/module/skype/Test-CsUnifiedContactStore) в командной консоли Lync Server:

    Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"

Если Test-CsUnifiedContactStore выполнен успешно, контакты для пользователя sip:kenmyer@litwareinc.com были перенесены в единое хранилище контактов.

</div>

<div>

## <a name="rolling-back-the-unified-contact-store"></a>Откат в единое хранилище контактов

Если необходимо удалить контакты пользователя из единого хранилища контактов (например, если необходимо переадресовать пользователя в Microsoft Lync Server 2010 и таким образом не может больше использовать единое хранилище контактов), необходимо выполнить два действия. Во-первых, назначьте пользователю новую политику служб пользователей, которая запрещает хранение контактов в едином хранилище контактов. (То есть, политика, в которой для свойства UcsAllowed задано значение $False.) Если у вас нет такой политики, вы можете создать ее с помощью следующей команды:

    New-CsUserServicesPolicy -Identity NoUnifiedContactStore -UcsAllowed $False

Затем вы можете назначить эту политику на уровней пользователей (NoUnifiedContactStore) с помощью следующей команды:

    Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName NoUnifiedContactStore

Предыдущая команда назначает новую политику пользователю Ken Myer и не позволяет переносить его контакты в единое хранилище контактов.

<div>


> [!NOTE]  
> В некоторых случаях можно добиться тех же результатов, просто не назначая текущую политику служб пользователя. Например, предположим, что для Ken Myer есть политика на уровне пользователя, включающая единое хранилище контактов, но ваша глобальная политика запрещает использование хранилища. В этом случае вы можете отменить назначение политики служб пользователя Ken Myer. В этом случае этот пользователь будет контролироваться глобальной политикой и у него не будет доступа к единому хранилищу контактов.<BR>Чтобы отменить назначение ранее назначенной политики на уровне пользователей, используйте ту же команду, что и ранее, но на этот раз задайте для параметра PolicyName значение NULL:<BR>Grant-CsUserServicesPolicy –Identity "Ken Myer" –PolicyName $Null



</div>

Следует помнить о концепции "не позволяет перенести контакты пользователя Ken Myer в единое хранилище контактов" при работе с единым хранилищем контактов. Если просто назначить для Ken Myer новую политику служб пользователя, его контакты не будут перенесены из единого хранилища контактов. Когда пользователь входит в Lync Server 2013, система проверяет политику пользовательских служб, чтобы убедиться, что ее контакты должны храниться в едином хранилище контактов. Если ответ — да, (т. е. для свойства UcsAllowed задано значение $True), эти контакты будут перенесены в единое хранилище контактов (если они еще не в нем). Если вы ответили нет, Lync Server просто пропускает контакты пользователя и переходит к следующей задаче. Это означает, что Lync Server не будет автоматически перемещать контакты пользователя из единого хранилища контактов независимо от значения свойства UcsAllowed.

Это также означает, что после назначения пользователя новой политикой пользовательских служб необходимо выполнить командлет [Invoke – CsUcsRollback](https://docs.microsoft.com/powershell/module/skype/Invoke-CsUcsRollback) , чтобы переместить контакты пользователя из Exchange 2013 и обратно в Lync Server 2013. Например, после назначения Ken Myer новой политики служб пользователя можно перенести его контакты из единого хранилища контактов с помощью следующей команды:

    Invoke-CsUcsRollback -Identity "Ken Myer"

Если изменить политику служб пользователей, но не выполнять командлет Invoke-CsUcsRollback, контакты Ken Myer не будут удалены из единого хранилища контактов. Что будет, если выполнить Invoke-CsUcsRollback, но не менять политику служб пользователей Ken Myer? Тогда его контакты будут временно удалены из единого хранилища контактов. Важно помнить о том, что удаление временное. После удаления контактов Ken из единого хранилища контактов Lync Server 2013 будет ожидать 7 дней, а затем проверить, какая политика служб пользователей назначена Ken. Если все еще назначена политика, позволяющая применять единое хранилище контактов, его контакты автоматически перемещаются в хранилище контактов. Чтобы удалить контакты из хранилища контактов без возможности восстановления, в дополнение к запуску командлета Invoke-CsUcsRollback следует изменить политику служб пользователя.

В связи с большим количеством переменных, которые могут повлиять на миграцию, трудно оценить, сколько времени будет выполняться до полной миграции учетных записей в единое хранилище контактов. Однако в общем случае миграция не вступает в силу немедленно: даже при переносе небольшого числа контактов может потребоваться 10 минут или больше до завершения перемещения.

</div>

</div>

<span> </span>

</div>

</div>

</div>

