---
title: 'Lync Server 2013: Настройка сервера Lync Server для работы с единым хранилищем контактов'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Configuring Lync Server 2013 to use the unified contact store
ms:assetid: 6aa17ae3-764e-4986-a900-85a3cdb8c1fc
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ688083(v=OCS.15)
ms:contentKeyID: 49733680
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 794d14172c5932436d46fbeb66ea1da4dd7a5e44
ms.sourcegitcommit: b693d5923d6240cbb865241a5750963423a4b33e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2020
ms.locfileid: "41762787"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="configuring-microsoft-lync-server-2013-to-use-the-unified-contact-store"></a>Настройка Microsoft Lync Server 2013 для работы с единым хранилищем контактов

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Тема последнего изменения:** 2014-02-07_

Единое хранилище контактов позволяет пользователям поддерживать один список контактов, а затем включать эти контакты в несколько приложений, включая Microsoft Lync 2013, Microsoft Outlook 2013 и Microsoft Outlook Web App 2013. Если вы включите единое хранилище контактов для пользователя, который не хранится в Microsoft Lync Server 2013, а затем извлекается по протоколу SIP. Вместо этого его контакты хранятся в Microsoft Exchange Server 2013 и извлекаются с помощью веб-служб Exchange.

<div>


> [!NOTE]  
> Технически контактные данные хранятся в паре папок, которые находятся в почтовом ящике Exchange 2013 пользователя. Сами контакты хранятся в папке "Контакты Lync", которая отображается для конечных пользователей. метаданные о контактах хранятся во вложенной папке, невидимой для конечных пользователей.



</div>

<div>

## <a name="enabling-the-unified-contact-store-for-a-user"></a>Включение единого хранилища контактов для пользователей

Если вы уже настроили проверку подлинности "сервер-сервер" между Lync Server 2013 и Exchange 2013, вам также будет разрешено использовать единое хранилище контактов; Дополнительная настройка сервера не требуется. Но для перемещения контактов пользователя в единое хранилище контактов необходима дополнительная настройка учетной записи пользователя, чтобы переместить контакты пользователя в единое хранилище. По умолчанию контакты пользователей хранятся в Lync Server, а не в едином банке контактов.

Управление доступом к единому хранилищу контактов осуществляется с помощью политик служб пользователей Lync Server. Политики серверов пользователей содержат только одно свойство (UcsAllowed): оно определяет место хранения контактов пользователя. Если пользователь управляется политикой пользовательских служб, в которой для Уксалловед установлено значение true ($True), контакты пользователя будут храниться в едином банке контактов. Если пользователь управляется политикой пользовательских служб, в которой для Уксалловед установлено значение false ($False), его контакты будут храниться в Lync Server.

При установке Lync Server 2013 также устанавливаются пользовательские политики для отдельных служб (настроенные в глобальной области). Для значения Уксалловед в этой политике задано значение "true", то есть контакты пользователей по умолчанию будут храниться в едином хранилище контактов (предполагая, что оно развернуто и настроено). Если вы хотите перенести всех пользователей из списка контактов в единое хранилище контактов, вам не нужно ничего делать.

Если для вас предпочтительнее не переносить все ваши контакты в единое хранилище контактов, можно заблокировать единое хранилище контактов для всех пользователей, присвоив свойству UcsAllowed в глобальной политике значение False:

    Set-CsUserServicesPolicy -Identity global -UcsAllowed $False

После того как вы отключите единое хранилище контактов в глобальной политике, вы можете создать политику для пользователей, которая позволит использовать единое хранилище контактов; Это позволит некоторым пользователям хранить свои контакты в едином банке контактов, когда другие пользователи продолжают хранить свои контакты в Lync Server. Ниже приведен пример команды, позволяющей создать политику служб пользователей для отдельных пользователей:

    New-CsUserServicesPolicy -Identity "AllowUnifiedContactStore" -UcsAllowed $True

После создания политики ее необходимо назначить всем пользователям, которым требуется доступ к единому хранилищу контактов. Политики на уровне пользователей можно назначить пользователям с помощью следующей команды:

    Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "AllowUnifiedContactStore"

После назначения политике сервер Lync Server начнет переносить контакты пользователя в единое хранилище контактов. После завершения миграции пользователь сможет хранить свои контакты в Exchange, а не на сервере Lync Server. Если пользователь после завершения миграции в Lync 2013 будет выполнен, появится окно с сообщением, и ему будет предложено выйти из Lync, а затем снова войти в систему, чтобы завершить процесс. Контакты пользователей, которым не назначена эта политика для отдельных пользователей, не переносятся в единое хранилище контактов. Это обусловлено тем, что такие пользователи подпадают под действие глобальной политики, а в глобальной политике доступ к единому хранилищу контактов запрещен.

Вы можете убедиться, что контакты пользователя успешно перенесены в единое хранилище контактов, выполнив командлет [Test-ксунифиедконтактсторе](https://docs.microsoft.com/powershell/module/skype/Test-CsUnifiedContactStore) в командной консоли Lync Server.

    Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"

Если Test-CsUnifiedContactStore выполнен успешно, контакты для пользователя sip:kenmyer@litwareinc.com были перенесены в единое хранилище контактов.

</div>

<div>

## <a name="rolling-back-the-unified-contact-store"></a>Откат в единое хранилище контактов

Если вы хотите удалить контакты пользователя из хранилища Объединенных контактов (например, если нужно переадресовать пользователя на сервере Microsoft Lync Server 2010 и, следовательно, он больше не может использовать единое хранилище контактов), необходимо выполнить два действия. Сначала следует назначить пользователю новую политику служб пользователей, запрещающую хранение контактов в едином хранилище контактов. (То есть, политика, в которой для свойства Уксалловед задано значение $False.) Если у вас нет такой политики, вы можете создать ее с помощью следующей команды:

    New-CsUserServicesPolicy -Identity NoUnifiedContactStore -UcsAllowed $False

Затем вы можете назначить эту политику на уровней пользователей (NoUnifiedContactStore) с помощью следующей команды:

    Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName NoUnifiedContactStore

Предыдущая команда назначает новую политику пользователю Ken Myer и не позволяет переносить его контакты в единое хранилище контактов.

<div>


> [!NOTE]  
> В некоторых случаях вы можете добиться того же результата, просто отменив Назначение текущей политики пользователей. Например, предположим, что политика служб пользователя Ken Myer разрешает ему доступ к единому хранилищу контактов, но глобальная политика запрещает доступ к нему. В этом случае вы можете снять назначение Ken политики служб для пользователей. После этого пользователь Ken автоматически подпадает под действие глобальной политики и лишается доступа к единому хранилищу контактов.<BR>Чтобы отменить назначение ранее назначенной политики для пользователя, используйте ту же команду, что и при указании, но в этот раз параметру Полицинаме будет присвоено значение NULL:<BR>Grant-CsUserServicesPolicy –Identity "Ken Myer" –PolicyName $Null



</div>

При работе с единым хранилищем контактов следует учитывать правило, согласно которому контакты пользователя не переносятся в единое хранилище контактов. Если просто назначить для пользователя Ken новую политику служб пользователя, его контакты не переносятся из единого хранилища контактов. Когда пользователь входит в Lync Server 2013, система проверяет политику пользовательских служб, чтобы узнать, нужно ли хранить ее контакты в едином банке контактов. В случае утвердительного ответа (для свойства UcsAllowed задано значение $True) эти контакты переносятся в единое хранилище контактов (если они еще не находятся в нем). Если ответ отсутствует, Lync Server просто пропускает контакты пользователя и переходит к следующей задаче. Это означает, что Lync Server не будет автоматически переносить контакты пользователя из единого хранилища контактов независимо от значения свойства Уксалловед.

Это также означает, что после назначения пользователю новой политики пользовательских служб необходимо запустить командлет [Invoke-ксуксроллбакк](https://docs.microsoft.com/powershell/module/skype/Invoke-CsUcsRollback) , чтобы переместить контакты пользователя из Exchange 2013 и обратно в Lync Server 2013. Например, после назначения пользователю Ken Myer новой политики служб пользователя можно перенести его контакты из единого хранилища контактов с помощью следующей команды:

    Invoke-CsUcsRollback -Identity "Ken Myer"

Если изменить политику служб пользователя, но не выполнять командлет Invoke-CsUcsRollback, контакты пользователя Ken не удаляются из единого хранилища контактов. Что происходит, если выполнить Invoke-CsUcsRollback, не изменяя политику служб пользователя Ken Myer? Контакты этого пользователя временно удаляются из единого хранилища контактов. Важно помнить о том, что контакты удаляются временно. После того как контакты Кен были удалены из хранилища контактов, Lync Server 2013 ждет 7 дней, а затем проверит, какая политика служб пользователей назначена Кенам. Если пользователю Ken по-прежнему назначена политика, разрешающая ему доступ к единому хранилищу контактов, его контакты автоматически перемещаются в хранилище контактов. Для удаления контактов из хранилища контактов без возможности восстановления необходимо не только выполнить командлет Invoke-CsUcsRollback, но и изменить политику служб пользователя.

Из-за большого количества переменных, влияющих на перенос, трудно определить, сколько времени потребуется для полного переноса учетных записей в единое хранилище контактов. В качестве общего правила следует иметь в виду, что перенос не вступает в силу немедленно: даже при переносе небольшого числа контактов для полного завершения переноса может потребоваться около 10 минут.

</div>

</div>

<span> </span>

</div>

</div>

</div>

