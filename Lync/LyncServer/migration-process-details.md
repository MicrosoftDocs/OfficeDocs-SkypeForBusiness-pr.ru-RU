---
title: Процесс миграции — сведения
TOCTitle: Процесс миграции — сведения
ms:assetid: ca7e352c-9bde-47d9-8273-5cf2fdfdfe7e
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ205264(v=OCS.15)
ms:contentKeyID: 49311180
ms.date: 12/10/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Процесс миграции — сведения

 

_**Дата изменения раздела:** 2016-12-08_

Используйте следующие обязательные условия и выполните описанные далее действия для миграции групповой беседы Lync Server 2010 или Office Communications Server 2007 R2  бесед в Lync Server 2013  сохраняемого сеанса беседы.

## Необходимые компоненты для миграции

Убедитесь, что вы выполнили все следующие требования перед переносом групповой беседы Lync Server 2010 или Office Communications Server 2007 R2  бесед в Lync Server 2013  сохраняемого сеанса беседы.

1.  Разверните по крайней мере один пул Lync Server 2013. Если у вас несколько пулов Lync Server 2013, определите, какой пул Lync Server 2013 будет использоваться для размещения Lync Server 2013  серверов сохраняемого сеанса беседы.

2.  Установите пул Lync Server 2013  серверов сохраняемого сеанса беседы. Он будет пустым (без категорий, комнат или надстроек). Перед переносом старых категорий, комнат или надстроек можно создать новые категории, комнаты или надстройки в развертывании Lync Server 2013  сохраняемого сеанса беседы.
    
    > [!IMPORTANT]
    > Помните, что эти новые элементы могут конфликтовать со старыми переносимыми элементами. Избегайте конфликтов с именами, в противном случае элементы будут перезаписаны при миграции старых данных.


## Подготовка исходных данных к миграции

Выполните следующие действия, чтобы должным образом подготовить исходные данные для миграции.

1.  Создайте резервные копии для исходных баз данных для групповой беседы Lync Server 2010 или Office Communications Server 2007 R2 бесед. Сведения о резервном копировании SQL Server см. в статье «Общие сведения о резервном копировании (SQL Server)» по адресу <http://go.microsoft.com/fwlink/p/?linkid=254851>.
    
    > [!IMPORTANT]
    > Доменные службы Active Directory должны быть одинаковыми. В качестве условия для миграции вы не можете переносить данные в пул в другом развертывании (в частности, в другом лесу Active Directory).


2.  Изучите комнаты для бесед групповой беседы Lync Server 2010 или Office Communications Server 2007 R2  бесед и конфигурацию категорий. Любые изменения категорий, комнат или надстроек в существующем развертывании будут выполнены администрирования групповой беседы.
    

    > [!TIP]
    > Любые изменения категорий, комнат или надстроек в развертывании Lync Server 2013&nbsp; сохраняемого сеанса беседы выполняются с помощью командлетов панели управления Lync Server или Windows PowerShell.

    
    Выполните следующие действия, чтобы подготовить старую систему к миграции.
    
    1.  сохраняемого сеанса беседы поддерживает один уровень категорий в отличие от глубокого иерархического набора категорий. После миграции к подкатегориям добавляются префиксы с полными именами родительских категорий. Возможно, вы захотите упростить существующую структуру категорий, чтобы полученная структура удовлетворяла вашим требованиям.
    
    2.  Проверьте **руководителей** в корневой категории.Если на этом уровне есть руководители, после миграции эти пользователи будут добавлены как **Руководители для всех комнат**. Если это не является обязательным для вашей организации, удалите этих руководителей из корневой категории.
    
    3.  Проверьте длину имен комнат. Если после миграции из-за упрощенной структуры категорий комнаты включены в дочернюю категорию, к ним добавляется префикс с полными именами родительской категории. Длина имен не может превышать 256 символов, включая имена родительских категорий. Необходимо проверить длину имен комнат и по возможности сократить их, если они слишком длинные.
    
    4.  Если в Lync Server 2013 для настроек **приглашений** категории задано значение «True», можно выбрать значения «True» или «False» для приглашений в комнаты этой категории. Однако, если для настроек приглашений категории задано значение «False», приглашения для комнат в этой категории отключены. Перед миграцией нужно сбросить настройки приглашении в старой версии Lync Server  групповой беседы, если вы хотите, чтобы комнаты были включены в определенную категорию. В противном случае во время миграции Lync Server 2013 отображает предупреждения и устанавливает для комнат значение по умолчанию («False»).
    
    5.  Если вы использовали файлы в комнатах бесед, вы должны скопировать их с помощью команды XCOPY вручную в хранилище файлов сохраняемый сеанс беседы после миграции. Инструменты этого не делают.
    
    6.  Если у вас есть федеративные пользователи и комнаты с федеративными пользователями, помните, что сохраняемого сеанса беседы не поддерживает федерацию. Комнаты с федеративными пользователями будут перенесены, но сами пользователи не смогут получить доступ к содержимому, так как федеративный доступ не поддерживается.
    
    7.  Определите комнаты, которые не требуется переносить, и отметьте их как отключенные.
    
    8.  Определите дату, после которой необходимо перенести содержимое комнаты чата. Например, вы можете не переносить сообщения старше 1 января 2010 г., так как они могут быть неактуальными или устаревшими.

## Выполнение миграции

Выполните следующие действия для переноса старой версии групповой беседы.

1.  Завершите работу служб групповой беседы Lync Server 2010, Office Communications Server 2007 R2  бесед или Lync Server 2013, сохраняемого сеанса беседы. Необходимо остановить все службы, поэтому запланируйте для этого время с достаточным периодом простоя. Как было указано ранее, обязательно создайте резервную копию текущей базы данных бесед.

2.  Запустите командлет Windows PowerShell**Export-CsPersistentChatData** с ролью RBAC администратора сохраняемый сеанс беседы(CsPersistentChatAdministrator). Дополнительные сведения о командлетах экспорта и импорта см. в разделе [Устранение неполадок конфигурации сервера сохраняемого чата с помощью командлетов Windows PowerShell в Lync Server 2013](lync-server-2013-troubleshooting-persistent-chat-server-configuration-using-windows-powershell-cmdlets.md).
    
    Изучите экспортированное содержимое.

3.  Перед импортом завершите работу служб Lync Server 2013, сохраняемого сеанса беседы. Необходимо остановить все службы, поэтому запланируйте для этого время с достаточным периодом простоя.

4.  Создайте резервную копию базы данных сохраняемый сеанс беседы, если вы создали категории, комнаты или надстройки в развертывании Lync Server 2013 перед миграцией. Процесс экспорта или импорта сможет объединить старые данные в развертывании Lync Server 2013, но рекомендуется создать резервную копию базы данных, чтобы избежать непреднамеренной перезаписи контента (например, при конфликтах имен).

5.  Запустите командлет Windows PowerShell**Import-CsPersistentChatData** (средство импорта) с командой **WhatIf** для заполнения внутренний серверсерверов сохраняемого сеанса беседы перенесенными данными. В процессе выполняются некоторые преобразования для применения упрощенной модели администрирования. При наличии ошибок или предупреждений устраните их.

6.  Запустите командлет сохраняемого сеанса беседыWindows PowerShell**Import-CsPersistentChatData** с ролью RBAC администратора сохраняемый сеанс беседы (CsPersistentChatAdministrator). Дополнительные сведения о командлетах экспорта и импорта см. в разделе [Устранение неполадок конфигурации сервера сохраняемого чата с помощью командлетов Windows PowerShell в Lync Server 2013](lync-server-2013-troubleshooting-persistent-chat-server-configuration-using-windows-powershell-cmdlets.md).

7.  Следует скопировать с помощью команды XCOPY все загруженные файлы (всю папку) в новое файловое хранилище Lync Server 2013  сохраняемый сеанс беседы.
    
    > [!IMPORTANT]
    > Lync 2013 (клиент) не поддерживает загрузку или просмотр файлов в комнатах чата. Вы все так же можете использовать старый клиент для публикации и просмотра файлов в комнате.


8.  После успешной миграции импортируйте URI групповой беседы Lync Server 2010 или сервера поиска Office Communications Server 2007 R2бесед в объект контактов Lync Server 2013сохраняемого сеанса беседы. Необходимо выполнить следующие действия, если ваши клиенты Lync 2010 или Office Communicator 2007 R2  бесед должны подключаться к последней версии Lync 2013  сохраняемый сеанс беседы (клиент) после переноса без изменения конфигурации на стороне клиента:
    
      - Удалите учетную запись пользователя сервера поиска ocschat@ *\<имя\_домена\>* .com. Она использовалась для указания на службу поиска в групповой беседы Lync Server 2010. Удалить пул и доверенные записи можно позже.
    
      - Создайте конечную точку старой версии (объект контактов сохраняемого сеанса беседы), выполнив командлет Windows PowerShell, **New-CsPersistentChatEndpoint**, с одинаковыми URI-адресами SIP, чтобы старый клиент мог эффективно работать после перезапуска службы.
    
    Обязательный процесс миграции в этот момент завершается. Lync 2010 (клиенты) или Office Communicator 2007 R2бесед (клиенты) могут прозрачно подключаться к новому пулу серверов сохраняемого сеанса беседы.
    
    Выполните следующие дополнительные действия по списанию для групповой беседы Lync Server 2010 или Office Communications Server 2007 R2бесед.

9.  Запустите службы сохраняемого сеанса беседы, включив все компьютеры в новом пуле серверов сохраняемого сеанса беседы.

10. Используйте командлеты панели управления Lync Server и Windows PowerShell для проверки успешности переноса данных.

11. Удалите Lync 2010 или Office Communicator 2007 R2бесед с компьютеров в пуле групповой беседы.

12. Удалите доверенное приложение и пул доверенных приложений с помощью командлетов Windows PowerShell. При этом данные элементы будут удалены из управления, а связанные записи TSE – из служб Active Directory. Или же это действие можно выполнить с помощью топологий (у доверенных приложений и пулов там есть выделенный узел).

13. Теперь можно приступить к активации функций сохраняемого сеанса беседы с помощью новых клиентов. Дополнительные сведения о включении сохраняемого сеанса беседы см. в [Развертывание сервера сохраняемого чата в Lync Server 2013](lync-server-2013-deploying-persistent-chat-server.md).
    
    > [!IMPORTANT]
    > Lync Server 2013 поддерживает несколько пулов серверов сохраняемого чата. Но мы поддерживаем миграцию пула Lync 2010 или Office Communications Server 2007 R2бесед в один Lync Server 2013серверов сохраняемого сеанса беседы. Вы можете добавить новый пул серверов сохраняемого чата в свое развертывание для выполнения нормативных требований (например, для хранения данных в указанном регионе).

