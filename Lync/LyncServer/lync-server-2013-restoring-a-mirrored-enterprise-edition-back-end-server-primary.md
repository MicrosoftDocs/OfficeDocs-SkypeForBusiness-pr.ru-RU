---
title: Восстановление зеркального сервера переднего планов Enterprise Edition — основной
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Restoring a mirrored Enterprise Edition Back End Server - primary
ms:assetid: bc555b46-70c5-4eee-ae91-e195df238293
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ945648(v=OCS.15)
ms:contentKeyID: 51541512
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 6dfc3f9a44adbd4967e3d32ac7a515a55bc5d974
ms.sourcegitcommit: 33db8c7febd4cf1591e8dcbbdfd6fc8e8925896e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "42144735"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="restoring-a-mirrored-enterprise-edition-back-end-server-in-lync-server-2013---primary"></a>Восстановление зеркального сервера переднего план выпуска Enterprise Edition в Lync Server 2013 — основной

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Последнее изменение темы:** 2013-02-17_

При наличии внутреннего сервера Enterprise Edition в зеркальной конфигурации и сбоя только в основной базе данных выполните процедуры, описанные в этом разделе. Если произойдет ошибка основной базы данных и зеркала, ознакомьтесь с разделом [Восстановление внутреннего сервера Enterprise Edition в Lync server 2013](lync-server-2013-restoring-an-enterprise-edition-back-end-server.md). Если произойдет сбой только зеркального отображения, ознакомьтесь со статьей [восстановление зеркального внутреннего сервера Enterprise Edition в Lync Server 2013 — Mirror](lync-server-2013-restoring-a-mirrored-enterprise-edition-back-end-server-mirror.md). Если база данных, в которой размещается центральное хранилище управления, не проходит, ознакомьтесь со статьей [восстановление сервера, на котором размещается центральное хранилище управления в Lync server 2013](lync-server-2013-restoring-the-server-hosting-the-central-management-store.md). В случае сбоя рядового сервера Enterprise Edition, который не является внутренним сервером, ознакомьтесь со статьей [Восстановление рядового сервера Enterprise Edition в Lync server 2013](lync-server-2013-restoring-an-enterprise-edition-member-server.md).

Перед началом восстановления рекомендуется использовать копию системы в виде образа. Это изображение можно использовать в качестве точки отката, если в процессе восстановления что-то пойдет не так. Вы можете использовать копию образа после установки операционной системы и SQL Server, а также для восстановления или повторной регистрации сертификатов.

В этом разделе пример основной базы данных будет иметь полное доменное имя (FQDN) BE1.contoso.com, а зеркальная база данных будет иметь полное доменное имя BE2.contoso.com.

<div>

## <a name="to-restore-an-enterprise-edition-back-end-server-primary-database"></a>Восстановление основной базы данных внутреннего сервера Enterprise Edition

1.  Войдите на сервер переднего плана из учетной записи пользователя, которая является членом группы RTCUniversalServerAdmins.

2.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

3.  Принудительная отработка отказа для всех настроенных баз данных на зеркальном сервере. Для каждого из типов баз данных, настроенных на этом сервере, введите следующий командлет:
    
        Invoke-CsDataBaseFailover -PoolFqdn <Pool FQDN> -DatabaseType <Configured Database Type> -NewPrincipal Mirror -Force -Verbose
    
    Например:
    
        Invoke-CsDataBaseFailover -PoolFqdn pool0.vdomain.com -DatabaseType User -NewPrincipal Mirror -Force -Verbose
    
    <div>
    

    > [!WARNING]
    > Если вы настроили для серверной базы данных синхронизированное зеркальное отображение с ресурсом-свидетелем, отработка отказа выполняется автоматически.

    
    </div>

4.  После завершения отработки отказа выполните следующие действия:
    
      - Запустите построитель топологий: нажмите кнопку **Пуск**, последовательно выберите пункты **все программы**, **Microsoft Lync Server 2013**и **Построитель топологий Lync Server**.
    
      - Отключить зеркальное отображение на внутреннем сервере: щелкните правой кнопкой мыши пул в разделе **Пулы переднего плана Enterprise Edition** и выберите **изменить свойства**. На вкладке **Общие** в разделе **связи**снимите флажок **включить зеркальное отображение хранилища SQL Server** . Выполните это действие для архивации и мониторинга при необходимости. Нажмите кнопку **ОК**.
    
      - Щелкните правой кнопкой мыши узел Lync Server 2013, выберите пункт **топология**, а затем нажмите кнопку **опубликовать**.
    
      - Выберите по-прежнему работающую базу данных (BE2.contoso.com) в качестве нового хранилища SQL. Для этого щелкните правой кнопкой мыши пул в разделе **Пулы переднего плана Enterprise Edition** и выберите команду **изменить свойства**. На вкладке **Общие** в разделе **связи**введите полное доменное имя работающей базы данных в поле **хранилище SQL Server** (в нашем примере это BE2.contoso.com).
    
      - Щелкните правой кнопкой мыши узел Lync Server 2013, выберите пункт **топология**, а затем нажмите кнопку **опубликовать**.
    
      - Перезапустите службы, чтобы каждый сервер мог прочитать новую топологию. В командной консоли Lync Server выполните следующие командлеты на каждом сервере переднего плана, принадлежащем этому пулу:
        
            Stop-CsWindowsService
            Start-CsWindowsService

5.  Удаление зеркального отображения. В командной консоли Lync Server выполните следующий командлет:
    
        Uninstall-CsMirrorDatabase -DatabaseType User -SqlServerFqdn <MirrorServerFqdn> -SqlInstanceName <SQLInstance> -verbose
    
    Например:
    
        Uninstall-CsMirrorDatabase -DatabaseType User -SqlServerFqdn DB2.contoso.com -SqlInstanceName rtc -verbose
    
    Выполните это действие для всех типов баз данных на этом сервере.

6.  Создайте чистый или новый сервер с таким же полным доменным именем (в данном примере — DB1.contoso.com) в качестве компьютера, на котором произошел сбой, установите операционную систему, а затем восстановите или повторно зарегистрируйте сертификаты. Этот сервер будет работать как новый зеркальный сервер.

7.  Войдите на новый сервер из учетной записи пользователя, которая является членом группы RTCUniversalServerAdmins.

8.  Установите SQL Server 2012 или SQL Server 2008 R2, сохранив имена экземпляров так же, как и до сбоя.

9.  Войдите на сервер переднего плана из учетной записи пользователя, которая является членом группы RTCUniversalServerAdmins.

10. Используйте построитель топологий для установки зеркальной базы данных. Выполните следующие действия:
    
      - Запустите построитель топологий: нажмите кнопку **Пуск**, последовательно выберите пункты **все программы**, **Microsoft Lync Server 2013**и **Построитель топологий Lync Server**.
    
      - Включите зеркальное отображение на внутреннем сервере. Для этого щелкните правой кнопкой мыши пул в разделе **Пулы переднего плана Enterprise Edition** и выберите **изменить свойства**. На вкладке **Общие** в разделе **связи**установите флажок **включить зеркалирование хранилища SQL Server** . Кроме того, это можно сделать для архивации и мониторинга при необходимости.
        
        Затем в поле **хранилище SQL Server для зеркального отображения** введите полное доменное имя нового сервера (n — это пример BE1.contoso.com). Нажмите кнопку **ОК**.
    
      - Щелкните правой кнопкой мыши узел Lync Server 2013, выберите пункт **топология**, а затем — **установить базу данных**.
    
      - Следуйте инструкциям мастера **установки базы данных** . На странице " **Создание баз данных** " выберите базы данных, которые требуется повторно создать.
    
      - Следуйте указаниям мастера, пока не появится запрос на **Создание зеркальной базы данных**. Выберите базу данных, которую требуется установить, и выполните эту процедуру.

</div>

</div>

<span> </span>

</div>

</div>

</div>

