---
title: Восстановление зеркала внутреннего сервера Enterprise Edition — основное
TOCTitle: Восстановление зеркала внутреннего сервера Enterprise Edition — основное
ms:assetid: bc555b46-70c5-4eee-ae91-e195df238293
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ945648(v=OCS.15)
ms:contentKeyID: 52058305
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Восстановление зеркала внутреннего сервера Enterprise Edition — основное

 

_**Дата изменения раздела:** 2013-02-17_

Если вы используете внутренний сервер Enterprise Edition в зеркальной конфигурации и происходит сбой только основной базы данных, следуйте процедурам, приведенным в этом разделе. Если происходит сбой и основной базы данных, и зеркала, см. [Восстановление внутреннего сервера Enterprise Edition](lync-server-2013-restoring-an-enterprise-edition-back-end-server.md). Если происходит сбой только зеркала, см.[Восстановление зеркального внутреннего сервера Enterprise Edition — зеркало](lync-server-2013-restoring-a-mirrored-enterprise-edition-back-end-server-mirror.md). Если происходит сбой базы данных, в которой размещается центральное хранилище управления, см. [Восстановление сервера с центральным хранилищем управления](lync-server-2013-restoring-the-server-hosting-the-central-management-store.md). Если происходит сбой сервера-участника Enterprise Edition, который не является внутренним сервером, см. [Восстановление рядового сервера Enterprise Edition](lync-server-2013-restoring-an-enterprise-edition-member-server.md).

Рекомендуется создать копию образа системы, прежде чем начать восстановление. Вы можете использовать этот образ в качестве точки отката в случае, если во время восстановления что-то пойдет не так. Возможно, вы захотите создать копию образа после установки операционной системы и SQL Server, а также восстановления или повторной регистрации сертификатов.

В этом разделе образец основной базы данных имеет полное доменное имя (FQDN) BE1.contoso.com, а зеркальная база данных — полное доменное имя BE2.contoso.com.

## Порядок восстановления основной базы данных внутреннего сервера Enterprise Edition

1.  Используя учетную запись, которая является членом группы RTCUniversalServerAdmins, выполните вход в систему интерфейсного сервера.

2.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

3.  Инициируйте аварийное переключение всех настроенных баз данных в зеркало. Для каждого типа баз данных, настроенного на этом сервере, введите следующий командлет:
    
        Invoke-CsDataBaseFailover -PoolFqdn <Pool FQDN> -DatabaseType <Configured Database Type> -NewPrincipal Mirror -Force -Verbose
    
    Пример:
    
        Invoke-CsDataBaseFailover -PoolFqdn pool0.vdomain.com -DatabaseType User -NewPrincipal Mirror -Force -Verbose
    
    > [!WARNING]  
    > Если вы настроили серверную базу данных для использования синхронизированного зеркального копирования с сервером-свидетелем, отработка отказа выполняется автоматически.

4.  По завершении отработки отказа выполните следующие действия:
    
      - Запустите построитель топологий: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Построитель топологий Lync Server**.
    
      - Отключите зеркалирование на внутреннем сервере: щелкните правой кнопкой мыши пул в разделе **Интерфейсные пулы Enterprise Edition** и выберите **Редактировать свойства**. На вкладке **Общие** в разделе **Связи** снимите флажок **Разрешить зеркалирование хранилища SQL Server**. Выполните это для служб архивации и мониторинга по мере необходимости. Затем щелкните **ОК**.
    
      - Щелкните правой кнопкой мыши узел Lync Server 2013, щелкните **Топология**, а затем щелкните **Опубликовать**.
    
      - Выберите все еще функционирующий внутренний сервер (BE2.contoso.com) в качестве нового хранилища SQL. Для этого щелкните пул правой кнопкой мыши в разделе **Интерфейсные пулы Enterprise Edition** и выберите **Изменить свойства**. На вкладке **Общие** в области **Связи** введите полное доменное имя функционирующего внутреннего сервера в поле **Хранилище SQL Server** (в нашем примере — BE2.contoso.com).
    
      - Щелкните правой кнопкой мыши узел Lync Server 2013, щелкните **Топология**, а затем щелкните **Опубликовать**.
    
      - Перезапустите службы таким образом, чтобы каждый сервер мог считать новую топологию. Из Командная консоль Lync Server выполните следующие командлеты на каждом интерфейсном сервере, который относится к этому пулу:
        
            Stop-CsWindowsService
            Start-CsWindowsService

5.  Удаление зеркалирования. Из Командная консоль Lync Server выполните следующий командлет:
    
        Uninstall-CsMirrorDatabase -DatabaseType User -SqlServerFqdn <MirrorServerFqdn> -SqlInstanceName <SQLInstance> -verbose
    
    Пример:
    
        Uninstall-CsMirrorDatabase -DatabaseType User -SqlServerFqdn DB2.contoso.com -SqlInstanceName rtc -verbose
    
    Выполните эти действия для всех типов баз данных на этом сервере.

6.  Создайте чистый или новый сервер с таким же полным доменным именем (в данном примере — DB1.contoso.com), что и компьютер, на котором произошел сбой, установите операционную систему, а затем восстановите или повторно зарегистрируйте сертификаты. Этот сервер будет функционировать как новое зеркало.

7.  Используя учетную запись, которая является членом группы RTCUniversalServerAdmins, выполните вход в систему нового сервера.

8.  Установите SQL Server 2012 или SQL Server 2008 R2, используя те же имена экземпляров, что и до отказа.

9.  Используя учетную запись, которая является членом группы RTCUniversalServerAdmins, выполните вход в систему интерфейсного сервера.

10. Использование построителя топологий для установки зеркальной базы данных. Выполните следующие действия.
    
      - Запустите построитель топологий: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Построитель топологий Lync Server**.
    
      - Включите зеркалирование на внутреннем сервере: для этого щелкните правой кнопкой мыши пул в разделе **Интерфейсные пулы Enterprise Edition** и выберите **Изменение свойств**. На вкладке **Общие** в разделе **Связи** установите флажок **Разрешить зеркалирование хранилища SQL Server**. Выполните это для служб архивации и мониторинга по мере необходимости.
        
        Затем в поле **Зеркалирование хранилища SQL Server** введите полное доменное имя нового сервера (в этом примере — BE1.contoso.com). Затем щелкните **ОК**.
    
      - Щелкните правой кнопкой мыши узел Lync Server 2013, щелкните **Топология**, а затем щелкните **Установить базу данных**.
    
      - Следуйте инструкциям мастера **установки базы данных**. На странице **Создание баз данных** выберите базы данных, которые необходимо создать повторно.
    
      - Следуйте инструкциям мастера до появления запроса на **создание зеркала базы данных**. Выберите базу данных, которую необходимо установить, и выполните данный процесс.

