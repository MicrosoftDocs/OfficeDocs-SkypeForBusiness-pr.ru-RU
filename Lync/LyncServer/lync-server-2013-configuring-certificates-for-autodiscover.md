---
title: Настройка сертификатов для автообнаружения
TOCTitle: Настройка сертификатов для автообнаружения
ms:assetid: 1842191d-df9a-41e0-9286-08c25f9b5dca
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ945617(v=OCS.15)
ms:contentKeyID: 52058179
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Настройка сертификатов для автообнаружения

 

_**Дата изменения раздела:** 2012-12-12_

Сертификаты для вашего пула Директоров, пула переднего плана и обратного прокси-сервера требуют дополнительные записи альтернативных имен субъектов, чтобы обеспечить поддержку безопасных соединений с клиентами Lync.

> [!NOTE]  
> Вы можете использовать командлет <strong>Get-CsCertificate</strong> для просмотра сведений о сертификатах, назначенных в данный момент. Однако в представлении по умолчанию не указываются свойства сертификата и отображаются не все значения в свойстве SubjectAlternativeNames. Вы можете использовать командлеты <strong>Get-CsCertificate</strong>, <strong>Request-</strong>CsCertificate и <strong>Set-CsCertificate</strong>, чтобы просматривать некоторые сведения, а также запрашивать и назначать сертификаты. Однако это не самый лучший способ в том случае, когда вы не уверены в свойствах альтернативных имен субъектов в текущем сертификате. Чтобы просмотреть сертификат и все элементы свойств, рекомендуется использовать оснастку &quot;Сертификаты&quot; в <em>консоли управления (MMC)</em> или мастер развертывания Lync Server. В мастере развертывания Lync Server для просмотра свойств сертификата вы можете использовать мастер сертификатов. Процедуры просмотра, запроса и назначения сертификата с использованием командной консоли Командная консоль Lync Server и <em>консоли управления (MMC)</em> подробно рассматриваются в следующих процедурах. Чтобы использовать мастер развертывания Lync Server, см. сведения в указанном разделе, если вы развернули необязательный Директор или пул Директоров: <a href="lync-server-2013-configure-certificates-for-the-director.md">Настройка сертификатов для директора в Lync Server 2013</a>. Для сервера переднего плана или пула переднего плана см. сведения в следующем разделе: <a href="lync-server-2013-configure-certificates-for-servers.md">Настройка сертификатов для серверов в Lync Server 2013</a>.<br />Начальные шаги этой процедуры являются подготовительными действиями, призванными сориентировать вас относительно роли текущего сертификата. По умолчанию сертификаты не имеют записи lyncdiscover.&lt;домен SIP&gt; или lyncdiscoverinternal.&lt;внутреннее имя домена&gt;, если только до этого вы не установили службы мобильности или подготовили сертификаты заранее. В данной процедуре используется пример имени домена SIP «contoso.com» и пример внутреннего имени домена &quot;contoso.net&quot;.<br />Конфигурация сертификатов по умолчанию для системы Lync Server 2013 и Lync Server 2010 заключается в использовании одного сертификата (с именем &quot;Default&quot;) с целью Default (все цели, кроме веб-служб), WebServicesExternal и WebServicesInternal. Дополнительная конфигурация заключается в использовании отдельных сертификатов для каждого назначения. Сертификатами можно управлять с помощью командной консоли Командная консоль Lync Server и командлетов Windows PowerShell или с помощью мастера сертификатов в мастере развертывания Lync Server.

## Обновление сертификатов новыми альтернативными именами субъектов с помощью командной консоли Командная консоль Lync Server

1.  Войдите на компьютер, используя учетную запись с правами и разрешениями локального администратора.

2.  Запустите командную консоль Lync Server: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Microsoft Lync Server 2013** и щелкните элемент **Командная консоль Lync Server**.

3.  Определите, какие сертификаты были назначены серверу и для какого типа использования. Эта информация потребуется вам на следующем шаге для назначения обновленного сертификата. Введите в командной строке следующее:
    
        Get-CsCertificate

4.  Просмотрите выходные данные из предыдущего шага, чтобы узнать, назначен ли нескольким использованиям один сертификат или для каждого из них назначен отдельный сертификат. Посмотрите на параметр Use, чтобы выяснить, как используется сертификат. Сравните параметр Thumbprint для отображаемых сертификатов, чтобы узнать, имеет ли один сертификат несколько использований.

5.  Обновите сертификат. Введите в командной строке следующее:
    
        Set-CsCertificate -Type <type of certificate as displayed in the Use parameter> -Thumbprint <unique identifier>
    
    Например, если командлет **Get-CsCertificate** отобразил сертификат, у которого для параметра Use установлено значение Default, другой сертификат со значением WebServicesInternal и еще один со значением WebServicesExternal, и все они имеют одинаковое значение Thumbprint, введите в командной строке следующее:
    
        Set-CsCertificate -Type Default,WebServicesInternal,WebServicesExternal -Thumbprint <Certificate Thumbprint>
    
    **Важно\!**
    
    Если каждому использованию назначен отдельный сертификат (значение Thumbprint различно для каждого из сертификатов), важно не запускать командлет **Set-CsCertificate** с несколькими типами. В данном случае отдельно запустите командлет **Set-CsCertificate** для каждого использования. Например:
    
        Set-CsCertificate -Type Default -Thumbprint <Certificate Thumbprint>
        Set-CsCertificate -Type WebServicesInternal -Thumbprint <Certificate Thumbprint>
        Set-CsCertificate -Type WebServicesExternal -Thumbprint <Certificate Thumbprint>

6.  Чтобы просмотреть сертификат, нажмите кнопку **Пуск**, щелкните **Выполнить…**. Введите MMC, чтобы открыть консоль управления (MMC).

7.  В меню консоли управления (MMC) выберите **Файл**, **Добавить или удалить оснастку…**, "Сертификаты". Нажмите кнопку **Добавить**. При отображении запроса выберите **учетной записи компьютера**, а затем нажмите кнопку **Далее**.

8.  Если сертификат расположен на этом компьютере, выберите **Локальный компьютер**, если на другом, выберите **Другой компьютер**, введите полное доменное имя компьютера и нажмите кнопку **Обзор**. В поле **Введите имена выбираемых объектов**, введите имя компьютера. Щелкните элемент **Проверить имена**. После разрешения имени компьютера оно подчеркивается. Нажмите кнопку **ОК**, а затем кнопку **Готово**. Нажмите кнопку **ОК** для подтверждения выбора и закройте диалоговое окно **Добавление и удаление оснасток**.
    
    > [!IMPORTANT]  
    > Если сертификат не отображается в консоли, убедитесь, что не был выбран параметр пользователя или службы. Следует выбрать компьютер, в противном случае вы не сможете найти подходящий сертификат.

9.  Чтобы просмотреть свойства сертификата, разверните узел **Сертификаты**, разверните узел **Личные** и выберите элемент **Сертификаты**. Выберите сертификат для просмотра, щелкните его правой кнопкой мыши и выберите пункт **Открыть**.

10. В представлении **Сертификат** выберите элемент **Сведения**. Здесь вы можете выбрать имя субъекта сертификата, выбрав элемент **Субъект**, после чего отображаются назначенное имя субъекта и связанные свойства.

11. Чтобы просмотреть назначенные альтернативные имена субъектов, выберите **Альтернативное имя субъекта**. Отображаются все назначенные альтернативные имена субъектов. Найденные в свойстве альтернативные имена субъектов по умолчанию имеют тип **DNS-имя**. Вам следует просмотреть следующие элементы (в соответствии с записями DNS-узла (A либо AAAA для IPv6) все они должны быть полными доменными именами:
    
      - Имя пула для этого пула или имя отдельного сервера, если это не пул
    
      - Имя сервера, которому назначен сертификат
    
      - Записи простых URL-адресов (обычно meet и dialin)
    
      - Внутренние и внешние имена веб-служб (например, webpool01.contoso.net, webpool01.contoso.com), основанные на выбранных параметрах в построителе топологий и выборе переопределенных веб-служб.
    
      - Если они уже назначены, записи lyncdiscover.\<домен SIP\> и lyncdiscoverintrnal.\<домен SIP\>.
    
    Последний элемент представляет для вас наибольший интерес — наличие записи альтернативного имени субъекта lyncdiscover и lyncdiscoverinternal.
    
    После получения этой информации вы можете закрыть представление сертификата и консоль управления (MMC).

12. Если отсутствует альтернативное имя субъекта службы автообнаружения — подразумевается lyncdiscover.\>имя домена\> и lyncdiscoverinternal.\<имя домена\> (в зависимости от того, внешний или внутренний это сертификат) — и вы используете один сертификат Default для типов Default, WebServicesInternal и WebServiceExternal, выполните следующие действия:
    
      - Введите в командной строке командной консоли Командная консоль Lync Server следующее:
        
            Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -AllSipDomain -verbose
        
        Если у вас имеется много SIP-доменов, вы не можете использовать новый параметр AllSipDomain. Вместо этого вам следует использовать параметр DomainName. Когда вы используете параметр DomainName, вам следует определить полное доменное имя для записей lyncdisscoverinternal и lyncdiscover. Например:
        
            Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
    
      - Чтобы назначить сертификат, введите следующее:
        
            Set-CsCertificate -Type Default,WebServicesInternal,WebServicesExternal -Thumbprint <Certificate Thumbprint>
        
        Где "Thumbprint" — это отпечаток, отображаемый для недавно выданного сертификата.

13. В случае отсутствия внутренних альтернативных имен субъектов автообнаружения при использовании отдельных сертификатов для Default, WebServicesInternal и WebServicesExternal выполните следующие действия:
    
      - Введите в командной строке командной консоли Командная консоль Lync Server следующее:
        
            Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -AllSipDomain -verbose
        
        Если у вас имеется много SIP-доменов, вы не можете использовать новый параметр AllSipDomain. Вместо этого вам следует использовать параметр DomainName. Когда вы используете параметр DomainName, вам следует определить подходящий префикс для полного доменного имени. Например:
        
            Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
    
      - В случае отсутствия внешнего альтернативного имени субъекта автообнаружения введите в командной строке следующее:
        
            Request-CsCertificate -New -Type WebServicesExternal -Ca dc\myca -AllSipDomain -verbose
        
        Если у вас имеется много SIP-доменов, вы не можете использовать новый параметр AllSipDomain. Вместо этого вам следует использовать параметр DomainName. Когда вы используете параметр DomainName, вам следует определить подходящий префикс для полного доменного имени. Например:
        
            Request-CsCertificate -New -Type WebServicesExternal -Ca dc\myca -DomainName "Lyncdiscover.contoso.com, Lyncdiscover.contoso.net" -verbose
    
      - Чтобы назначить индивидуальные типы сертификатов, введите следующее:
        
            Set-CsCertificate -Type Default -Thumbprint <Certificate Thumbprint>
            Set-CsCertificate -Type WebServicesInternal -Thumbprint <Certificate Thumbprint>
            Set-CsCertificate -Type WebServicesExternal -Thumbprint <Certificate Thumbprint>
        
        Где "Thumbprint" — это отпечаток, отображаемый для недавно выданных индивидуальных сертификатов.

