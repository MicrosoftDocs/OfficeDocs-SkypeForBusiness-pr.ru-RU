---
title: Документация к инструментарию из набора ресурсов Lync Server 2013
TOCTitle: Документация к инструментарию из набора ресурсов Lync Server 2013
ms:assetid: b1c341f1-86fa-479d-ba4d-28df5a4c1622
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ945604(v=OCS.15)
ms:contentKeyID: 52058579
ms.date: 08/03/2014
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Документация к инструментарию из набора ресурсов Lync Server 2013

 

_**Дата изменения раздела:** 2014-01-09_

В этой статье описываются средства, входящие в состав набора ресурсов Lync Server 2013, рассказывается об их назначении и приводятся примеры использования каждого из них. Resource Kit Tools сервера Lync Server 2013 облегчают выполнение стандартных задач для ИТ-администраторов, которые развертывают сервер Lync Server 2013 и управляют им. Например, средство **Web Conf Data** позволяет легко контролировать данные, отправляемые пользователями во время собрания по сети. С помощью средства **SEFAUtil** можно настроить переадресацию звонков делегатов и ответы на них для пользователей. Мы рекомендуем ИТ-администраторам использовать эти средства для более эффективного управления сервером Lync Server 2013.

## Установка средств из набора ресурсов

Чтобы установить Resource Kit Tools сервера Lync Server 2013, загрузите **OCSReskit.msi**. Загрузите установщик Resource Kit Tools на странице Центра загрузки по адресу [http://go.microsoft.com/fwlink/p/?LinkID=330429](http://go.microsoft.com/fwlink/p/?linkid=330429).

Чтобы выполнить простую установку, запустите файл **OCSResKit.msi**. Файл MSI установит все средства в следующую папку: **%Program Files%\\Microsoft Lync Server 2013\\ResKit**. Средства, представляющие собой автономные исполняемые файлы, находятся непосредственно в этой папке. Средства, имеющие дополнительные файлы, находятся в отдельных вложенных папках.

## Поддерживаемые среды

Для обеспечения оптимальной производительности Resource Kit Tools сервера Lync Server 2013 следует устанавливать в среде с теми же характеристиками, которые требуются для Lync Server 2013.

## Обзор средств из набора ресурсов

Ниже приводится список средств, входящих в состав набора ресурсов Lync Server 2013. Описание каждого средства, включая требования и примеры использования, можно найти в следующем разделе.

  - ABSConfig

  - Монитор службы политики пропускной способности

  - Анализатор использования полосы пропускания

  - Счетчик парковки вызовов

  - CleanupStorageServiceData

  - DBAnalyze

  - ImportStorageServiceData

  - LCSSync

  - LookupUserConsole

  - MsTurnPing

  - Средство просмотра конфигурации сети

  - Динамический агент группы ответа

  - SEFAUtil

  - SYSPrep.ps1

  - Перенос оповещений о неназначенных номерах

  - Web Conf Data

## ABSConfig

Средство настройки службы адресной книги (ABSConfig) — это средство администрирования, которое помогает администраторам настраивать конфигурацию службы адресной книги в Lync Server 2013. Оно также позволяет администраторам Lync Server 2013 восстанавливать параметры службы адресной книги по умолчанию.

## Описание

ABSConfig — это приложение, которое предоставляет администраторам графический пользовательский интерфейс для настройки атрибутов Active Directory (AD DS), связанных со службой адресной книги.

Основные сценарии использования этого средства:

  - позволяет администраторам сопоставлять атрибуты в доменных службах Active Directory с атрибутами Lync Server 2013;

  - позволяет администраторам указывать, что атрибут доменных служб Active Directory должен быть включен в файлы службы адресной книги или исключен из них;

  - позволяет администраторам восстанавливать параметры службы адресной книги по умолчанию.

Средство ABSConfig можно запустить с помощью файла absConfig.exe. При запуске открывается вкладка **Configure Attributes** (Настройка атрибутов). В этой таблице можно сопоставить атрибуты доменных служб Active Directory с полями атрибутов Lync Server 2013 и указать, каких пользователей нужно включить в файлы службы адресной книги или исключить из них, с помощью фильтров атрибутов. Также можно настроить значение номера телефона, которое необходимо включить в файл адресной книги. Кнопка **Restore Defaults** (Восстановить параметры по умолчанию) позволяет администраторам восстановить параметры службы адресной книги по умолчанию.

## Изменения по сравнению с Lync Server 2010

В средстве ABSConfig для Lync Server 2013 атрибут (строку) можно удалить, сняв соответствующий флажок его включения. Результат будет тот же, что и при удалении строки в Lync Server 2010.

> [!NOTE]
> Флажок включения находится в самом правом столбце. Чтобы увидеть его, может потребоваться прокрутить таблицу вправо.


## Выходные данные

Средство ABSConfig сохраняет конфигурацию службы адресной книги в базе данных.

    Path: %ProgramFiles%\Microsoft Lync Server 2013\Reskit

## Назначение

Средство ABSConfig позволяет быстро и легко настраивать службу адресной книги Lync Server 2013.

## Требования

## Компьютер

Средство ABSConfig можно запустить только на присоединенном к домену компьютере, на котором установлен сервер Lync Server 2013. Если используется выпуск Lync Server 2013 Enterprise Edition, это средство можно запустить на любом сервере переднего плана, на котором во время установки была включена служба адресной книги.

## Сеть

Компьютер должен иметь возможность подключения к интерфейсному пулу и тыловой базе данных.

## Программное обеспечение

Перед запуском средства ABSConfig необходимо установить перечисленные ниже программные компоненты.

  - Microsoft Lync Server 2013

## Пользователи

Администраторы с разрешениями, необходимыми для обновления развертывания Lync Server 2013.

## Примеры

Средство ABSConfig можно запустить, введя в командной строке команду **ABSConfig.exe**. Ниже показан пользовательский интерфейс средства ABSConfig.

![Средство ABSConfig.exe.](images/JJ945604.6fb63a70-7b63-4b8b-b7d1-82fe9aa2028f(OCS.15).jpg "Средство ABSConfig.exe.")

## Сводка

Средство ABSConfig позволяет администраторам быстро и легко настраивать службу адресной книги Lync Server 2013.

## Монитор службы политики пропускной способности

Монитор службы политики пропускной способности позволяет администраторам просматривать следующие сведения:

1.  все настроенные службы политики пропускной способности Lync Server 2013 (проверка подлинности и ядро) в топологии;

2.  соединения, которые каждая служба устанавливает с другими службами политики пропускной способности и с пограничными серверами;

3.  все каналы, настроенные в документе конфигурации сети, и сведения об использовании пропускной способности в реальном времени, сообщаемые каждой службой политики пропускной способности.

## Описание

Монитор службы политики пропускной способности реализован в виде приложения с графическим пользовательским интерфейсом. Чтобы запустить средство, администраторам необходимо выполнить файл PDPMonUI.exe.

При запуске средства оно пытается обнаружить все службы политики пропускной способности в топологии. После начального обновления данных область в левой части окна заполняется списком служб, сгруппированным по кластерам, к которым они относятся.

Когда администратор выбирает определенную службу политики пропускной способности, в области справа выводятся сведения о ней. Эта область имеет две основные вкладки.

## Вкладка "Machine Info"

На вкладке **Machine Info** (Сведения о компьютере) показаны подробные сведения о выбранной службе политики пропускной способности, а также список соединений, установленных этой службой с другими службами, и их состояний.

## Вкладка "Topology Info"

На вкладке **Topology Info** (Сведения о топологии) показан список всех каналов, настроенных в параметрах конфигурации сети. Для каждого канала показана пропускная способность звука и видео. Кроме того, показана текущая используемая пропускная способность в Кбит/с и в процентах от общей пропускной способности. Для выделения каналов, пропускная способность которых используется почти максимально, в средстве применяется цветовая кодировка. Это позволяет администраторам быстро определять такие каналы.

> [!NOTE]
> Если монитору службы политики пропускной способности не удается подключиться к какой-либо из настроенных служб политики пропускной способности, сведения на вкладках <strong>Machine Info</strong> и <strong>Topology Info</strong> не заполняются. Однако также возможна ситуация, когда средству изначально удается подключиться к службе, но затем это соединение оказывается разорванным. В таких случаях администраторы будут видеть устаревшие данные. На каждой вкладке есть метка времени <strong>Last Updated</strong> (Последнее обновление), с помощью которой администраторы могут узнать, когда в последний раз обновлялись данные для определенной службы политики пропускной способности.


## Вывод данных

Вывод данных через командную строку не используется. Данные программы выводятся в основном графическом интерфейсе пользователя.

## Назначение

Монитор службы политики пропускной способности позволяет администраторам просматривать состояние каждой службы политики пропускной способности, определенной в топологии. Кроме того, администраторы могут просматривать сведения об использовании пропускной способности в реальном времени для всех каналов, определенных в документе конфигурации сети.

## Требования

Монитор службы политики пропускной способности должен выполняться на компьютере, входящем в топологию Lync Server.

## Сводка

Монитор службы пропускной способности может быть ценным ресурсом для администраторов, позволяя им наблюдать за состоянием всех служб политики пропускной способности в топологии и, что еще более важно, получать сведения об использовании пропускной способности в реальном времени для каналов, определенных в параметрах конфигурации сети.

## Анализатор использования полосы пропускания

Анализатор использования полосы пропускания — это средство, которое создает отчеты о различных аспектах использования полосы пропускания каналов глобальной сети конечными точками объединенных коммуникаций в корпоративной сети. Эти отчеты можно использовать для анализа текущей схемы использования полосы пропускания, а также при планировании емкости полосы пропускания.

## Описание

Анализатор использования полосы пропускания реализован в виде приложения с графическим пользовательским интерфейсом. Это средство создает отчеты об использовании полосы пропускания звуковых данных в сети и помогает при планировании емкости. Оно также позволяет просматривать полосу пропускания, назначенную различным каналам.

## Выходные данные

Анализатор использования пропускной способности предоставляет графическое изображение полосы пропускания звуковых данных и степени ее использования для всех каналов глобальной сети, настроенных в системе.

## Назначение

В любом развертывании системы голосовой и видеосвязи крайне важно отслеживать и анализировать тенденции использования полосы пропускания при передаче мультимедийных данных по корпоративной сети. Анализатор использования полосы пропускания позволяет администраторам решать эту задачу. Это средство предоставляет следующие возможности:

  - создает отчеты по использованию звуковых каналов в сети;

  - позволяет более эффективно планировать емкость и распределять полосы пропускания, назначенные различным каналам.

Анализатор пропускной способности позволяет создавать следующие графические отчеты о полосе пропускания и степени ее загрузки:

  - для всех каналов глобальной сети в корпоративной сети;

  - для выбранных каналов глобальной сети;

  - для каналов глобальной сети, емкость которых превышена;

  - для каналов глобальной сети, полоса пропускания которых используется недостаточно;

  - для каналов глобальной сети, использование которых достигает критического уровня (то есть превышает 90 % полосы пропускания канала глобальной сети);

  - для каналов глобальной сети, отфильтрованных по типу: каналы между сетевыми сайтами, каналы между областями и каналы внутри сайта;

  - с фильтрацией по области сети.

## Приложения

Анализатор использования полосы пропускания включает следующие два приложения (средства).

  - **WanLinkLogCollector.exe**. Это средство позволяет пользователю вводить нужные сведения.

  - **BandwidthUtilizationAnalyzer.xlsm**. Отчет в виде электронной таблицы Microsoft Excel, которая автоматически запускается программой WanLinkLogCollector.exe. Это приложение позволяет пользователю применять фильтры к отчету, как описывается далее в этой статье.

## Этапы работы с анализатором использования полосы пропускания

Работа с анализатором использования пропускной способности состоит из двух этапов:

  - сбор журналов, выполняемый с помощью программы WanLinkLogCollector.exe;

  - настройка отчетов, выполняемая с помощью электронной таблицы BandwidthUtilizationAnalyzer.xlsm.

> [!NOTE]
> Мы настоятельно рекомендуем конечным пользователям не запускать электронную таблицу BandwidthUtilizationAnalyzer.xlsm вручную.

## Запуск анализатора использования полосы пропускания

Запустите файл WanLinkLogCollector.exe с помощью командной строки или проводника.

**Использование программы WanLinkLogCollector.exe**

Использование программы WanLinkLogCollector.exe включает три этапа.

1.  **Регистрация временной шкалы**. Укажите временную шкалу, для которой нужно создать отчет.

2.  **Указание каталогов файлов**. Укажите сведения о расположении файлов.

3.  **Сбор журналов и запуск средства просмотра отчетов**. Выполните команду, чтобы создать отчет.

## Этап 1. Регистрация временной шкалы

Регистрация временной шкалы позволяет пользователю средства указать следующие сведения, как показано на рисунке ниже.

1.  **Дата начала**. Это начальная дата временной шкалы, для которой нужно создать отчет, например 1 августа 2010 г.

2.  **Дата окончания**. Это конечная дата временной шкалы, для которой нужно создать отчет, например 30 сентября 2010 г.
    
    ![Начальная и конечная дата анализа использования пропускной способности](images/JJ945604.2c597cfc-3372-4d41-816b-26202f607ad8(OCS.15).jpg "Начальная и конечная дата анализа использования пропускной способности")  

## Этап 2. Указание каталогов файлов

Пользователь может указать следующие каталоги файлов, как показано на рисунке.

  - **Расположение файлов журналов сервера**. Папка, в которой хранятся журналы сервера политики пропускной способности. Обычно это папка \<файловый\_сервер\>\\\<выбранный\_интерфейсный\_сервер\>\\AppServerFiles\\PDP.

  - **Папка хранения временных файлов**. Папка, в которой хранятся временные файлы в процессе создания отчета.

![Каталоги файлов при анализе использования пропускной способности](images/JJ945604.d66daeac-1669-45e3-932d-3f6782840c2a(OCS.15).jpg "Каталоги файлов при анализе использования пропускной способности")

> [!NOTE]
> Пользователю средства необходимо предоставить достаточные права на доступ к файлам журналов сервера и папке хранения временных файлов.


## Этап 3. Сбор журналов и запуск средства просмотра отчетов

Чтобы выполнить сбор журналов и запустить средство просмотра отчетов, нажмите кнопку **Execute** (Выполнить), как показано ниже. На этом этапе собираются необходимые данные.

![Сбор данных в средстве анализа использования пропускной способности](images/JJ945604.0019cb2c-7c01-4dc9-ac90-ac47c47d1bfd(OCS.15).jpg "Сбор данных в средстве анализа использования пропускной способности")

Если проверка входных данных прошла успешно, выводится показанное ниже сообщение.

![Уведомление о сборе данных журналов в Bandwidth Utili](images/JJ945604.eda91da8-3285-4eab-8ccb-c6d89c8cc221(OCS.15).jpg "Уведомление о сборе данных журналов в Bandwidth Utili")

Нажмите кнопку **ОК**. Автоматически откроется электронная таблица BandwidthUtilizationAnalyzer.xlsm. Следуйте инструкциям в окне сообщения. Подробные сведения см. в следующем разделе **Использование таблицы BandwidthUtilizationAnalyzer.xlsm**.


**Использование таблицы BandwidthUtilizationAnalyzer.xlsm**

1.  Когда таблица BandwidthUtilizationAnalyzer.xlsm автоматически откроется, нажмите кнопку **Refresh** (Обновить), как показано ниже.
    
    ![BandwidthUtilizationAnalyzer.xlsm](images/JJ945604.c4e675b9-1671-400e-a712-6db82d731b39(OCS.15).jpg "BandwidthUtilizationAnalyzer.xlsm")

2.  Когда откроется папка с файлами, выберите файл consolidated.csv в папке, указанной в окне сообщения, как показано ниже. Папка будет указана как **C:\\Temp**.
    
    ![Открытие папки в BandwidthUtilizationAnalyzer.](images/JJ945604.601cc572-cee9-45fb-9ed1-c4b96a2fa21e(OCS.15).jpg "Открытие папки в BandwidthUtilizationAnalyzer.")

3.  Нажмите кнопку **Импорт**.

4.  Графический отчет будет создан автоматически. Он станет доступен, когда исчезнет указатель выполнения операции в фоновом режиме.
    
    ![Применение фильтров в представлении отчета.](images/JJ945604.1416468e-e3ab-478e-b569-e42ba9c27a17(OCS.15).jpg "Применение фильтров в представлении отчета.")

## Применение фильтров к представлению отчета

Далее описываются фильтры, которые можно применить к представлению отчета и которые показаны ниже.

![Применение фильтров в представлении отчета.](images/JJ945604.1416468e-e3ab-478e-b569-e42ba9c27a17(OCS.15).jpg "Применение фильтров в представлении отчета.")

1.  **Имя**. Фильтрация по каналам глобальной сети (фильтр находится в правой части графика). Префикс означает следующие типы каналов (см. вертикальное (синее) поле):
    
      - **S (Site)** — канал глобальной сети между сетевым сайтом и областью сети;
    
      - **IS (Inter-Site)** — канал глобальной сети между двумя сетевыми сайтами;
    
      - **R (Inter-Region)** — канал глобальной сети между двумя областями сети.

2.  **Exceeded limit** (Превышение предельного значения). Фильтрация каналов глобальной сети, использование полосы пропускания которых превышает емкость.

3.  **Critical levels** (Критические уровни). Фильтрация каналов глобальной сети, использование полосы пропускания которых достигло 90 % или более от максимальной емкости.

4.  **Under-utilized** (Недостаточное использование). Фильтрация каналов глобальной сети, использование полосы пропускания которых составляет менее 25 % от максимальной емкости.

5.  **Link type** (Тип канала). Фильтрация по следующим типам каналов глобальной сети:
    
      - **Network site** (Сетевой сайт);
    
      - **Inter-site** (Между сайтами);
    
      - **Inter-Region link** (Канал между областями).

6.  **Region** (Область). Фильтрация по области сети.

На следующих рисунках показаны ранее описанные фильтры.

Применение фильтра **Name**. Выберите список каналов, которые нужно показать на графике.

![Фильтрация по имени в BandwidthUtilizationAnalyzer.](images/JJ945604.002b7c8e-f0da-48ce-9e1a-5c34d2cab063(OCS.15).jpg "Фильтрация по имени в BandwidthUtilizationAnalyzer.")

Применение фильтра **Exceeded limit**. Установите флажок **True**, чтобы применить фильтр.

![Фильтрация по превышению ограничения.](images/JJ945604.5946c95e-76ce-46ca-8f3e-a79be1e5c527(OCS.15).jpg "Фильтрация по превышению ограничения.")

Применение фильтра **Critical levels**. Установите флажок **True**, чтобы применить фильтр.

![Фильтрация по критическим уровням.](images/JJ945604.60771a52-d8ba-4cb9-a02d-d6c888cb5505(OCS.15).jpg "Фильтрация по критическим уровням.")

Применение фильтра **Under utilized**. Установите флажок **True**, чтобы применить фильтр.

![Фильтрация по параметру "Используется недостаточно".](images/JJ945604.95a2bf01-5aba-4927-af47-1ad3c459d791(OCS.15).jpg "Фильтрация по параметру \"Используется недостаточно\".")

Применение фильтра **Link Type**. Выберите один или несколько типов каналов, которые нужно показать.

![Фильтрация по типу ссылки.](images/JJ945604.08757949-06bd-4cf3-809f-d81fd23a6639(OCS.15).jpg "Фильтрация по типу ссылки.")

Применение фильтра **Region**. Выберите список областей, каналы которых нужно показать.

![Фильтрация по региону.](images/JJ945604.5de4cec4-6c09-48bb-98c7-b56f7bdb3d5a(OCS.15).jpg "Фильтрация по региону.")

## Требования

  - Платформа .NET Framework 3.5

  - Microsoft Excel 2010 или Excel 2007

## Сводка

Анализатор использования полосы пропускания предназначен для графического представления данных об использовании полосы пропускания звуковых каналов для трафика объединенных коммуникаций в сети. Это средство также можно использовать для создания отчетов об использовании полосы пропускания видеоканалов в сети.

## Счетчик парковки вызовов

Счетчик парковки вызовов — это программа командной строки, облегчающая доступ к базе данных орбиты парковки вызовов.

## Описание

Счетчик парковки вызовов — это средство для отслеживания вызовов, находящихся в настоящее время в состоянии парковки. Оно также собирает статистику по орбитам и использованию сервера парковки вызовов (CPS). Это средство командной строки предоставляет доступ к базе данных орбиты CPS SQL Server с локального или удаленного компьютера как для чтения, так и для записи.

Все параметры являются взаимоисключающими. Синтаксис командной строки имеет следующий вид:

  - параметр **–o** — выводит список всех диапазонов орбиты, настроенных для этого пула;

  - параметр **–n** — выводит список всех орбит, используемых в настоящее время в этом пуле; отображаются следующие сведения:
    
      - универсальный код ресурса (URI) протокола SIP паркуемого и паркующего;
    
      - имя узла сервера парковки вызовов, на котором паркуется вызов;
    
      - метка времени парковки вызова;

  - параметр **–f** — показывает текущее число свободных орбит в пуле;

  - параметр **–r \<n\>** — выводит список из \<n\> последних припаркованных вызовов; отображаются следующие сведения:
    
      - URI SIP паркуемого;
    
      - URI SIP паркующего;
    
      - имя узла сервера, на котором был припаркован вызов;
    
      - метка времени извлечения или пропуска вызова;

  - параметр **-t\<n\>** — тестирует резервирование орбиты в базе данных для проверки степени случайности назначенных номеров орбиты.

## Выходные данные

В зависимости от входных параметров, указанных в командной строке, счетчик парковки вызовов отображает следующие выходные данные:

  - все диапазоны орбиты, настроенные для этого пула;

  - вызовы, припаркованные в настоящее время;

  - число свободных (доступных) орбит;

  - недавно припаркованные вызовы;

  - зарезервированные орбиты для проверки универсальных и случайных значений орбиты.

## Назначение

Средство CPS предназначено для предоставления доступа к базе данных CPS из командной строки. Администратор может просматривать сведения об использовании CPS и определять число орбит, назначенных пулу.

## Требования

Если это средство запускается на компьютере с сервером парковки вызовов, то дополнительные требования не предъявляются. Если оно запускается на удаленном компьютере, необходимо разрешить удаленный доступ к базе данных SQL Server, используемой сервером Lync Server 2013. Для счетчика парковки вызовов необходимо настроить строку подключения к базе данных SQL Server, обеспечивающую подключение к серверу SQL Server пула. Эта строка подключения к базе данных SQL Server определяется в файле конфигурации **parkometer.exe.config**. Его необходимо поместить в каталог, в котором находится файл parkometer.exe. Ниже приведен пример XML-файла parkometer.exe.config. Параметры, которые необходимо настроить, включают имя пользователя (например, mydomain\\Administrator), пароль (например, mypassword) и имя узла (например, myserver).

```xml
    <?xml version="1.0" encoding="utf-8" ?>
    <configuration>
      <appSettings>
       <add key="SQL" value="server=myserver\RTC;
    database=cpsdyn;
    User Id=mydomain\Administrator;
    Password=mypassword.;
    Integrated Security=false;"/>
      </appSettings>
    </configuration>
```

## Примеры

Развернутые диапазоны орбиты: параметр –o выводит список всех диапазонов орбиты, настроенных для этого пула, как показано ниже.

![Диапазоны орбит в службе парковки вызовов Call Parkometer.](images/JJ945604.9ede64cb-29d9-4782-a34b-b76c42fbdcad(OCS.15).jpg "Диапазоны орбит в службе парковки вызовов Call Parkometer.")

Текущие припаркованные вызовы: параметр –n выводит список всех орбит, используемых в настоящее время в этом пуле, как показано ниже.

![Вызовы, в настоящий момент приостановленные в Call Parkometer.](images/JJ945604.07a7eec4-7999-4c92-93f0-95525b244b4c(OCS.15).jpg "Вызовы, в настоящий момент приостановленные в Call Parkometer.")

Число свободных орбит: параметр –f выводит текущее число свободных орбит в пуле, как показано ниже.

![Освобожденные орбиты в службе парковки вызовов Call Parkometer.](images/JJ945604.ecc1d621-0ca0-4ecf-a579-08b41c6f08ed(OCS.15).jpg "Освобожденные орбиты в службе парковки вызовов Call Parkometer.")

Последние припаркованные вызовы: параметр –r \<n\> выводит список из \<n\> последних припаркованных вызовов, как показано ниже.

![Недавно приостановленные вызовы в Call Parkometer.](images/JJ945604.1c5eb27d-faa1-491b-b4aa-b484255c3353(OCS.15).jpg "Недавно приостановленные вызовы в Call Parkometer.")

Проверка резервирования орбиты: параметр –t \<n\> тестирует резервирование орбиты в базе данных, как показано ниже.

![Тестовые резервирования орбит в Call Parkometer.](images/JJ945604.84c9b69e-7af0-4224-8711-a43a28f08691(OCS.15).jpg "Тестовые резервирования орбит в Call Parkometer.")

## Сводка

Счетчик парковки вызовов — это средство командной строки, предоставляющее подробные сведения о сервере парковки вызовов.

## CleanupStorageServiceData

Средство CleanupStorageServiceData из набора ресурсов позволяет удалять потерянные данные из базы данных, используемой службой хранилища Lync Server (LYSS). Одной из функций службы хранилища является буферизация данных, которые передаются между сервером Lync Server и различными конечными точками хранения данных, такими как SQL Server и Exchange.

## Описание

Для обеспечения высокой доступности служба LYSS принимает и временно сохраняет копии данных на нескольких серверах переднего плана в пуле, а затем удаляет эти данные, после того как они будут доставлены в конечное расположение для долгосрочного хранения. Во время этой операции могут произойти непредвиденные ситуации, например сбой сервера или ошибка обработки, в результате чего некоторые данные не будут удалены. Эти данные не представляют опасности, но потребляют ограниченные ресурсы. Большинство стандартных операций по обслуживанию данных выполняется автоматически, однако это средство позволяет выявлять и удалять такие потерянные данные, когда автоматическое удаление невозможно. Использовать его рекомендуется в том случае, когда появляется предупреждение мониторинга работоспособности System Center Operations Manager (SCOM) о том, что необходимо удалить ненужные данные из локальных баз данных LYSS в пуле. В журнале событий на сервере переднего плана, который вызвал это предупреждение, будет зарегистрировано соответствующее событие. В подробных сведениях события будет содержаться информация об объеме потерянных данных на сервере переднего плана. Это событие возникает, когда объем таких данных превышает некоторое заданное пороговое значение.

## Требования

Установите Resource Kit Tools сервера Lync Server 2013. Средство выполняется на присоединенных к домену компьютерах, на которых установлен сервер Lync Server и командная консоль Lync Server 2013. Оно использует командлет командной консоли для обнаружения всех серверов переднего плана в пуле. Во-вторых, это средство необходимо запускать на компьютере в пуле, на котором установлена база данных **RtcLocal**. Эта база данных используется средством CleanupStorageServiceData для получения сведений о подключении, необходимых для обмена данными со службой маршрутизации Lync Server. Наконец, при запуске средства нужно использовать учетную запись или учетные данные с разрешениями на чтение и запись в общую папку, в которую будет записываться журнал выходных данных. Кроме того, работа средства зависит от стабильного состояния пула. По сути, это означает, что должен работать каждый сервер переднего плана, должна быть возможность подключения к экземпляру LYNCLOCAL SQL Server и базе данных LYSS, и каждая группа маршрутизации должна иметь полный набор из одного основного и двух дополнительных серверов переднего плана.

## Примеры

C:\\Program Files\\Microsoft Lync Server 2013\\ResKit\\StorageService\> ImportStorageServiceData.exe

    Description:
    This tool will remove orphaned data from the Storage Service database
    for a pool. You are required to run this tool on a machine inside the
    pool which has the Lync Server Management Shell installed and has RtcLocal database installed.
    Usage: Default behavior is to clean up orphaned data from the all the 
           Storage Service databases in the current pool.
    Additional Options:
    -Verbose    : Turn verbose output on.
    -LogPath    : The UNC path to which to write the log.
    ------------------------------------------------------------------------------
    Please wait while we initialize...
    Found 4 front end servers
    Replica Instances for LYSS Service
    Address: server2.vdomain.com - Primaries: 7 Secondaries: 14
    Address: server.vdomain.com - Primaries: 7 Secondaries: 14
    Address: server1.vdomain.com - Primaries: 7 Secondaries: 14
    Address: server3.vdomain.com - Primaries: 7 Secondaries: 14
    Primary Total Count = 28, Secondary Total Count = 56
    Finding and removing orphaned data for 28 routing groups
    Removing 1 stale groups from FE server.vdomain.com
    No stale routing groups detected on FE server2.vdomain.com
    No stale routing groups detected on FE server1.vdomain.com
    No stale routing groups detected on FE server3.vdomain.com
    Searching for stale queue items
    Removed 20 stale queue items for routing group 17D5435AE40259F7BBDF1866776386E4
    No stale queue items found for routing group 1975349662315F90B119DACB4F2AE3AD
    No stale queue items found for routing group 1A23E3D58BDB5A458A0B73F34AB7ACBE
    No stale queue items found for routing group 1AC91E3A1029535A80123121989CEADC
    No stale queue items found for routing group 3313935458E35B9B9759E08A15D251E6
    No stale queue items found for routing group 39BB0035B06B5427873FC6099720462A
    No stale queue items found for routing group 40721948E7B55CE893A53E911F76D185
    No stale queue items found for routing group 4501E04EAE4856059346949FF817C220
    No stale queue items found for routing group 4D833C98801F546F8E45E417EE028E2E
    No stale queue items found for routing group 5AD77443AD955A22A876749BE66D5317
    No stale queue items found for routing group 69844A271E6C5633A1F2B46A42287DD6
    No stale queue items found for routing group 69DA3BE407A95C7284EB4B1337718C93
    No stale queue items found for routing group 8437358AB34A5CC8967D5EF39494AB8D
    No stale queue items found for routing group 8ED455B1789655359816E1C5BF4C430F
    No stale queue items found for routing group 904F6C9B8AC951AE8B3C86684D3832E4
    No stale queue items found for routing group 90AAB3AE9A1950E0ADE7809A27021D63
    No stale queue items found for routing group 944F5724C65C5F93900DC1C8C898B102
    No stale queue items found for routing group 9E8A2630250C51769E39F63F0FB552BA
    No stale queue items found for routing group A11E27AE439A582288D4657EDA86B565
    No stale queue items found for routing group A9B10C76E764556FAEA3E47301EDF518
    No stale queue items found for routing group AEA2699E74ED59848ACEA7896699430D
    No stale queue items found for routing group B269961603E75065AFDA4F4F006DA5E4
    No stale queue items found for routing group BB873D9A3DA959DAB2FD743E5AA619F7
    No stale queue items found for routing group BCC6A48FBA2454B79B9EDB276657A404
    No stale queue items found for routing group C8EF4805722B5F6C876EBC0440B420FD
    No stale queue items found for routing group CA38EBDAC4845489ACE208C2240E4056
    No stale queue items found for routing group F5921887DB025C5F908CE42DB7F1AEE8
    No stale queue items found for routing group F9E606A825395422B3BF7A01ECBB7B1F
    Writing log: M:\Dev\Server\ResKit\StorageService\CleanupStorageServiceData.Log_20121009_151040
    Tool has finished execution.  Errors encountered: 0
    C:\Program Files\Microsoft Lync Server 2013\ResKit\StorageService>

## DBAnalyze

## Описание

DBAnalyze — это средство командной строки, позволяющее администраторам собирать аналитические отчеты о базах данных Lync Server 2013. Средство DBAnalyze имеет следующие режимы: диагностика, пользовательские данные, конференция, узлы MCU и фрагментация дисков.

  - **Режим диагностики**. Создает отчет, включающий сведения о таблицах (число записей, фрагментация, размер данных и размер индекса), размерах файлов данных и журналов, времени последнего резервного копирования, распределении контактов между серверами Microsoft Office Communications Server, среднем числе разрешений, контактов, контейнеров, подписок, публикаций и конечных точек на пользователя, неправильно размещенных пользователях, пользователях, для которых не удается выполнить маршрутизацию, среднем числе организованных конференций на пользователя, запланированных конференциях, активных конференциях и версии базы данных.
    
    > [!NOTE]
    > Запуск средства в режиме диагностики может повлиять на производительность сервера.


  - **Режим пользовательских данных**. Создает отчет о контактах, контейнерах, подписках, публикациях, разрешениях и группах контактов для указанного пользователя или для пользователей, в списки контактов и разрешений которых добавлен этот пользователь. Этот режим также предоставляет сводные данные по конференциям, которые организовал пользователь или на которые он приглашен.

  - **Режим конференции**. Выводит подробные данные для определенной конференции, включая сведения о запланированном времени проведения, список приглашенных, список типов мультимедиа, разрешенных для конференции, список активных узлов MCU (многоточечных управляющих узлов), список активных участников и состояние сигнализации каждого участника.

  - **Расшифровка идентификатора собрания**. Расшифровывает идентификатор собрания в телефонной сети общего пользования (ТСОП), заданный с помощью параметра **/pstnid**. Однако подключение к серверу для получения подробных сведений не производится.

  - **Разрешение конференции**. Расшифровывает идентификатор собрания в ТСОП, заданный с помощью параметра **/pstnid**, и выводит сведения о конференции с этим идентификатором.

  - **Режим узлов MCU**. Выводит сведения об идентификаторе, типе мультимедиа, URL-адресе, состоянии пульса, нагрузке конференции и нагрузке участников для каждого узла MCU в пуле.

  - **Режим фрагментации дисков**. Выводит состояние фрагментации всех дисков.

Администраторы могут использовать это средство для диагностики различных проблем или при планировании емкости. Например, если большинство пользователей, размещенных на сервере А, выбрали в качестве контактов пользователей, размещенных на сервере Б, администратор может перенести пользователей с сервера А на сервер Б, чтобы уменьшить объем трафика между серверами.

## Выходные данные

Это средство выводит предварительно определенные отчеты по базе данных Lync Server 2013. **Путь:** %ProgramFiles%\\Microsoft Lync Server 2013\\Reskit

## Назначение

Чтобы установить средство, скопируйте файл Dbanalyze.exe в локальную папку, а затем запустите его. Чтобы использовать средство, в командной строке выполните следующую команду: `dbanalyze.exe [/v] [/report:value] [/sqlserver:value] [/user:user@domain.com] [/conf:value][/pstnid:Value] [/maxcontacts:value]` Ниже приведены описания параметров командной строки.

![Параметры командной строки для Dbanalyze.exe.](images/JJ945604.22bf3432-af6d-495b-8f48-d94c5d259523(OCS.15).jpg "Параметры командной строки для Dbanalyze.exe.")

## Требования

**Компьютер**. Средство DBAnalyze можно запустить только на присоединенном к домену компьютере с сервером Lync Server 2013.

**Сеть**. Компьютер должен иметь возможность подключения к внутренней базе данных.

**Программное обеспечение**. Перед запуском средства DBAnalyze должны быть установлены программные компоненты Lync Server 2013.

**Пользователи**. В приведенной ниже таблице перечислены администраторы, которые имеют необходимые разрешения на доступ к базам данных Lync Server 2013.

![Таблица разрешений для Dbanalyze.exe.](images/JJ945604.b8931e9e-834e-4dec-8a84-2fc47d1613e9(OCS.15).jpg "Таблица разрешений для Dbanalyze.exe.")

> [!NOTE]
> Для режима <strong>/report:disk</strong> необходима учетная запись локального администратора.

## Примеры

Ниже приведены примеры допустимых команд Dbanalyze.exe.

    dbanalyze.exe /report:diag
    dbanalyze.exe /report:user /user:usera@domainb.com
    dbanalyze.exe /report:conf /user:bob@example.com /conf:1W9J71SKSX2X
    dbanalyze.exe /report:resolve /pstnid:12345
    dbanalyze.exe /report:mcus
    dbanalyze.exe /report:disk

## Сводка

Средство DBAnalyzer позволяет администраторам быстро и легко анализировать базы данных Lync Server 2013.

## ImportStorageServiceData

Средство ImportStorageServiceData из набора ресурсов позволяет повторно импортировать данные очереди и конечных точек, записанные на диск из службы хранилища (LYSS), обратно в эту службу.

## Описание

Данные могут записываться на диск из службы хранилища автоматически (периодически) в зависимости от состояния элемента очереди или размера базы данных. Это может происходить в результате вызова командлета отработки отказа пула вручную или вызова командлета StorageServiceFullFlush (командлетом отработки отказа пула). Обратите внимание на то, что в идеале данные не следует импортировать повторно, если размер хотя бы одной базы данных службы хранилища (LYSS) на серверах переднего плана превышает нормальный, так как скорее всего это приведет к экспорту еще большего объема данных. Кроме того, сначала следует устранить проблемы, которые могли привести к росту очереди службы хранилища (например, ошибки конечных точек Exchange, неполадки в сети или иные проблемы).

**Сценарий 1.** Во время отработки отказа пула файлы могут записываться на диск из службы хранилища для каждого сервера переднего плана. После завершения отработки отказа следует запустить средство, чтобы повторно импортировать данные.

**Сценарий 2.** Данные записываются на диск автоматически каждый день или при превышении базой данных службы хранилища определенного порогового значения размера (например, заполненность на 60 %, 80 % или 90 %). Администратору следует повторно импортировать эти автоматически записанные на диск данные. Если в описанной выше ситуации не развернут пакет мониторинга SCOM, создаются события службы хранилища Lync Server, связанные с записью на диск данных из нее, а именно события с идентификаторами 32075 (началась операция полной записи на диск), 32076 (полная запись на диск завершена), 32082 (началась запись на диск на уровне обслуживания), 32083 (запись на диск на уровне обслуживания завершена) и 32089 (запись на диск выполнена в связи с заполнением базы данных). Обратите внимание, что эти идентификаторы событий соответствуют окончательному первоначальному выпуску (RTM). Если администратор видит эти события, это означает, что имеются записанные на диск файлы. Эти данные следует периодически импортировать обратно с помощью этого средства, например, раз в неделю.

В веб-службе, если развернут пакет мониторинга SCOM для Lync Server, могут создаваться новые оповещения о том, что администратору необходимо повторно импортировать записанные на диск данные в службу хранилища. В журнале событий на сервере переднего плана, создавшем оповещение, будет зарегистрировано соответствующее событие. В описании события указывается родительский путь, по которому находятся записанные на диск файлы, а также число файлов, соответствующих критерию оповещения. Критерий оповещения заключается в том, что по родительскому пути находится X или более файлов, которым не менее Y дней (значения X и Y предварительно заданы в службе хранилища, но их можно переопределить, внеся изменения в файл APPCONFIG). Ниже показаны два примера событий, которые могут создавать оповещения о работоспособности. Различие между ними заключается в родительском пути. Он может указывать на общую папку веб-службы или на локальный каталог "Application Data" на каждом сервере переднего плана (например, c:\\ProgramData\\Microsoft\\Lync Server\\StorageService). После получения оповещения администратору следует запустить это средство из набора ресурсов.

Это средство повышает загрузку ЦП и интенсивность операций ввода-вывода на сервере переднего плана, на котором оно запущено, а также на других серверах переднего плана, если данные не принадлежат серверу, на котором выполняется средство. Мы не рекомендуем запускать это средство, когда загрузка ЦП и интенсивность операций ввода-вывода на серверах переднего плана высоки (например, в часы пиковой нагрузки). Во-вторых, на импорт одного файла данных средству может потребоваться 2–3 минуты. Учитывайте это при оценке времени работы средства. Подробный файл журнала, создаваемый средством, по умолчанию находится в хранилище файлов. Удалите его, если он не содержит ошибок, так как его размер может составлять десятки мегабайт и более.

![События журнала событий сервера Sample Storage Server.](images/JJ945604.3a903ef7-ea8a-4606-8229-a3e32f13af3a(OCS.15).jpg "События журнала событий сервера Sample Storage Server.")

## Требования

Установите Resource Kit Tools сервера Lync Server 2013. Средство выполняется на присоединенных к домену компьютерах, на которых установлен сервер Lync Server и Lync Server. Оно использует командлет командной консоли для обнаружения всех серверов переднего плана в пуле. Во-вторых, это средство необходимо запускать на компьютере в пуле, на котором установлена база данных **RtcLocal**. Эта база данных используется средством для определения расположения общей папки WEBSERVICE в пуле. Кроме того, перед использованием средства на каждом сервере переднего плана нужно сначала включить удаленное взаимодействие Windows PowerShell, выполнив командлет **Enable-PSRemoting** на каждом из этих серверов, а также на компьютере, на котором запускается средство. В противном случае удаленные команды Windows PowerShell, выполняемые из этого средства, будут завершаться сбоем. По завершении работы со средством удаленное взаимодействие Windows PowerShell можно отключить на всех серверах переднего плана в пуле. Наконец, при запуске средства нужно использовать учетную запись или учетные данные с разрешениями на чтение и запись в общую папку веб-службы в пуле, в котором выполняется средство. В противном случае будут возникать ошибки разрешений ввода-вывода.

> [!NOTE]
> В Windows Server 2012 удаленное взаимодействие Windows PowerShell по умолчанию включено, но в ОС Windows Server 2008 — нет.

## Примеры

    >  C:\StorageService>ImportStorageServiceData.exe
    Description:
    This tool will re-import Storage Service (LYSS) flushed queue data back in.  For a pool: you are required to run this tool on a machine inside the pool which has the Lync Server Management Shell installed.  Additionally, all front end machines need to have Windows Powershell Remoting enabled before executing this tool by executing Enable-PSRemoting.  Also, please ensure that all Storage Service instance DB Size are at the 'Normal' level (verify this by viewing Eventlog events). Otherwise re-importing may cause data to be flushed out again if any Storage Service instance DB size level goes above 'Normal'.
    Usage: Default behavior is to Import data from web service file share as well as any files on all Front End machines in pool.
    Additional Options:
    -Verbose                    : Turn verbose output on.
    
    -StorageServiceHostName     : Host Name of Storage Service WCF endpoint.  ( Default=localhost netnamedpipe binding. )
                                        
    -FileSharePath              : Import only all data from just under the UNC path specified.
    
    ActivityID: cc3b62ff-bb66-4e61-a6e2-96cb3626315c. <-- Use this to correlate with StorageService trace logs if troubleshooting.
    Type Server name (TCP binding) or press <enter> for localhost (NamePipe binding):
    Using NetNamedPipeBinding...
    OnTopologyChanged Event received
    Web Service File Share: \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService
    
    Front Ends:
    server.vdomain.com
    server2.vdomain.com
    server1.vdomain.com
    server3.vdomain.com
    Looking under directory: \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService for exported data.
    # Files found: 8
    Starting Import for file:\\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\2
    0120910\SERVER.vdomain.com\944f5724c65c5f93900dc1c8c898b102__0.xml
    Items deserialized: 20
    
    All items in file were enqueued successfully, will try to delete file: \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER.vdomain.com\944f5724c65c5f93900dc1c8c898b102__0.xml
    
    All items in file failed to enqueue so file will not be deleted.  File path: \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER.vdomain.com\944f5724c65c5f93900dc1c8c898b102__0.xml
    
    Summary for file \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER.vdomain.com\944f5724c65c5f93900dc1c8c898b102__0.xml: succeeded: 20, failed: 0
    
    Starting Import for file:\\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER1.vdomain.com\17d5435ae40259f7bbdf1866776386e4__0.xml
    Items deserialized: 20
    
    [cc3b62ff-bb66-4e61-a6e2-96cb3626315c] Send EnqueueMessages to redirected, targetServer=server1.vdomain.com, queueItems=20
    
    All items in file were enqueued successfully, will try to delete file: \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER1.vdomain.com\17d5435ae40259f7bbdf1866776386e4__0.xml
    
    All items in file failed to enqueue so file will not be deleted.  File path: \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER1.vdomain.com\17d5435ae40259f7bbdf1866776386e4__0.xml
    
    Summary for file \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\
    SERVER1.vdomain.com\17d5435ae40259f7bbdf1866776386e4__0.xml: succeeded: 20, failed: 0
    
    Starting Import for file:\\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER1.vdomain.com\904f6c9b8ac951ae8b3c86684d3832e4__0.xml
    
    Items deserialized: 20
    [cc3b62ff-bb66-4e61-a6e2-96cb3626315c] Send EnqueueMessages to redirected, targetServer=server1.vdomain.com, queueItems=20
    
    All items in file were enqueued successfully, will try to delete file: \\dc.vdomain.com\OcsFileStore
    \co1-WebServices-1\StorageService\DataExport\20120910\SERVER1.vdomain.com\904f6c9b8ac951ae8b3c86684d
    3832e4__0.xml
    
    All items in file failed to enqueue so file will not be deleted.  File path: \\dc.vdomain.com\OcsFil
    eStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER1.vdomain.com\904f6c9b8ac951ae8b3c
    86684d3832e4__0.xml
    
    
    Summary for file \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\
    SERVER1.vdomain.com\904f6c9b8ac951ae8b3c86684d3832e4__0.xml: succeeded: 20, failed: 0
    
    Starting Import for file:\\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\2
    0120910\SERVER2.vdomain.com\69844a271e6c5633a1f2b46a42287dd6__0.xml
    
    Items deserialized: 20
    
    [cc3b62ff-bb66-4e61-a6e2-96cb3626315c] Send EnqueueMessages to redirected, targetServer=server2.vdom
    ain.com, queueItems=20
    
    All items in file were enqueued successfully, will try to delete file: \\dc.vdomain.com\OcsFileStore
    \co1-WebServices-1\StorageService\DataExport\20120910\SERVER2.vdomain.com\69844a271e6c5633a1f2b46a42
    287dd6__0.xml
    
    All items in file failed to enqueue so file will not be deleted.  File path: \\dc.vdomain.com\OcsFil
    eStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER2.vdomain.com\69844a271e6c5633a1f2
    b46a42287dd6__0.xml
    
    Summary for file \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\
    SERVER2.vdomain.com\69844a271e6c5633a1f2b46a42287dd6__0.xml: succeeded: 20, failed: 0
    
    Starting Import for file:\\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\2
    0120910\SERVER3.vdomain.com\3313935458e35b9b9759e08a15d251e6__0.xml
    
    Items deserialized: 20
    
    [cc3b62ff-bb66-4e61-a6e2-96cb3626315c] Send EnqueueMessages to redirected, targetServer=server3.vdom
    ain.com, queueItems=1
    
    All items in file were enqueued successfully, will try to delete file: \\dc.vdomain.com\OcsFileStore
    \co1-WebServices-1\StorageService\DataExport\20120910\SERVER3.vdomain.com\3313935458e35b9b9759e08a15
    d251e6__0.xml
    
    All items in file failed to enqueue so file will not be deleted.  File path: \\dc.vdomain.com\OcsFil
    eStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER3.vdomain.com\3313935458e35b9b9759
    e08a15d251e6__0.xml
    
    Summary for file \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\
    SERVER3.vdomain.com\3313935458e35b9b9759e08a15d251e6__0.xml: succeeded: 20, failed: 0
    
    Starting Import for file:\\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\2
    0120910\SERVER3.vdomain.com\4501e04eae4856059346949ff817c220__0.xml
    Items deserialized: 20
    [cc3b62ff-bb66-4e61-a6e2-96cb3626315c] Send EnqueueMessages to redirected, targetServer=server3.vdom
    ain.com, queueItems=1
    All items in file were enqueued successfully, will try to delete file: \\dc.vdomain.com\OcsFileStore
    \co1-WebServices-1\StorageService\DataExport\20120910\SERVER3.vdomain.com\4501e04eae4856059346949ff8
    17c220__0.xml
    All items in file failed to enqueue so file will not be deleted.  File path: \\dc.vdomain.com\OcsFil
    eStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER3.vdomain.com\4501e04eae4856059346
    949ff817c220__0.xml
    
    Summary for file \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\
    SERVER3.vdomain.com\4501e04eae4856059346949ff817c220__0.xml: succeeded: 20, failed: 0
    Starting Import for file:\\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\2
    0120910\SERVER3.vdomain.com\5ad77443ad955a22a876749be66d5317__0.xml
    
    Items deserialized: 20
    [cc3b62ff-bb66-4e61-a6e2-96cb3626315c] Send EnqueueMessages to redirected, targetServer=server3.vdom
    ain.com, queueItems=20
    All items in file were enqueued successfully, will try to delete file: \\dc.vdomain.com\OcsFileStore
    \co1-WebServices-1\StorageService\DataExport\20120910\SERVER3.vdomain.com\5ad77443ad955a22a876749be6
    6d5317__0.xml
    All items in file failed to enqueue so file will not be deleted.  File path: \\dc.vdomain.com\OcsFil
    eStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER3.vdomain.com\5ad77443ad955a22a876
    749be66d5317__0.xml
    Summary for file \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\
    SERVER3.vdomain.com\5ad77443ad955a22a876749be66d5317__0.xml: succeeded: 20, failed: 0
    Starting Import for file:\\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\2
    0120910\SERVER3.vdomain.com\a11e27ae439a582288d4657eda86b565__0.xml
    Items deserialized: 20
    [cc3b62ff-bb66-4e61-a6e2-96cb3626315c] Send EnqueueMessages to redirected, targetServer=server3.vdom
    ain.com, queueItems=20
    All items in file were enqueued successfully, will try to delete file: \\dc.vdomain.com\OcsFileStore
    \co1-WebServices-1\StorageService\DataExport\20120910\SERVER3.vdomain.com\a11e27ae439a582288d4657eda
    86b565__0.xml
    All items in file failed to enqueue so file will not be deleted.  File path: \\dc.vdomain.com\OcsFil
    eStore\co1-WebServices-1\StorageService\DataExport\20120910\SERVER3.vdomain.com\a11e27ae439a582288d4
    657eda86b565__0.xml
    Summary for file \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\DataExport\20120910\
    SERVER3.vdomain.com\a11e27ae439a582288d4657eda86b565__0.xml: succeeded: 20, failed: 0
    All files have been imported into Storage Service for path: \\dc.vdomain.com\OcsFileStore\co1-WebSer
    vices-1\StorageService
    Importing files for: server.vdomain.com
    No files founds.
    Importing files for: server2.vdomain.com
    No files founds.
    Importing files for: server1.vdomain.com
    No files founds.
    Importing files for: server3.vdomain.com
    No files founds.
    Writing log: \\dc.vdomain.com\OcsFileStore\co1-WebServices-1\StorageService\ImportStorageServiceData
    Log20120910_1609SS
    Tool has finished execution.
    >  C:\StorageService>

## LCSSync

Средство LCSSync помогает в развертывании программного обеспечения для связи Lync Server 2013 в среде с несколькими лесами. Оно используется для синхронизации пользователей и групп из разных лесов в качестве контактного объекта доменных служб Active Directory с центральным лесом, в котором установлен сервер Lync Server 2013.

## Описание

Средство LCSSync использует синхронизированные контактные объекты доменных служб Active Directory в центральном лесу для включения поддержки Lync Server для пользователей. Для обеспечения единого входа основная учетная запись пользователя должна быть сопоставлена с контактным объектом доменных служб Active Directory в центральном лесу Lync Server 2013. Это средство помогает выполнить такое сопоставление. Оно предоставляет шаблоны для создания агентов управления на сервере Microsoft Identity Integration Server.

## Сводка

Средство LCSSync помогает в развертывании Lync Server в среде с несколькими лесами.

## LookupUserConsole

Средство LookupUserConsole выводит внутренние сведения о маршрутизации Lync Server для определенных пользователей. Эти сведения могут быть полезны специалистам службы поддержки Майкрософт при диагностике проблем с развертыванием и маршрутизацией.

## Описание

При запуске файла LookupUserConsole.exe открывается окно командной строки, в котором вводятся SIP-адреса, для которых нужно показать внутренние сведения о маршрутизации Lync Server. Чтобы выйти из средства LookupUserConsole, введите команду **exit**.

## Требования

Установите Resource Kit Tools сервера Lync Server 2013. Средство выполняется на присоединенных к домену компьютерах, на которых установлен сервер Lync Server.

## Примеры

C:\\Program Files\\Microsoft Lync Server 2013\\ResKit\>LookupUserConsole.exe

    > sip:john.doe@vdomain.com
    
      Execution time (ms):                            171.094
      Exeuction result:                               Success
      SIP URI:                                        sip:john.doe@vdomain.com
      User info:
        SID:                                          S-1-5-21-2831376166-29632525...    Display name:                                     John Doe
        Grouping ID:                                  00000000-0000-0000-0000-...
        Line URI:                                     <null>
        Policy assignment:                            TenantId={00000000--0000-000....
        SIP enabled:                                  True
        UC enabled:                                   False
        Tenant ID:                                    00000000-0000-0000-0000-...  Cluster info:
        Active cluster:                               pool0.vdomain.com
        Backup registrar cluster:                     <null>
        Deployment location:                          <null>
        Home Front-End FQDN:                          SERVER.vdomain.com
        Primary Registrar cluster:                    pool0.vdomain.com
        Remote Director external SIP FQDN:            <null>
        Remote Director internal SIP FQDN:            <null>
        Remote Director Web FQDN:                     <null>
        Routing group ID:                             4501e04e-ae48-5605-9346...
        Service tag ID:                               1266953005
        User Front-End resolved:                      True
        User in local forest:                         True
        User in remote forest:                        False
        User in split domain:                         False
        User-Services cluster:                        pool0.vdomain.com
    
    > sip:nouser@vdomain.com
    
      Execution time (ms):                            948.7574
      Exeuction result:                               UserDoesNotExist
    
    > exit

## MsTurnPing

Средство MSTurnPing позволяет администратору программного обеспечения для связи Microsoft Lync Server 2013 проверять состояние серверов, на которых работают пограничная служба передачи аудио- и видеоданных и служба проверки подлинности аудио- и видеоконференций, а также серверов со службами политики пропускной способности в топологии.

## Описание

Средство MSTurnPing позволяет администратору программного обеспечения для связи Lync Server 2013 проверять состояние серверов, на которых работают пограничная служба передачи аудио- и видеоданных и служба проверки подлинности аудио- и видеоконференций, а также серверов со службами политики пропускной способности в топологии.

Средство позволяет администратору выполнять перечисленные ниже проверки.

1.  Проверка пограничных серверов аудио- и видеоданных — средство тестирует все пограничные серверы аудио- и видеоданных в топологии, выполняя следующие действия:
    
      - проверяя, запущена ли служба проверки подлинности аудио- и видеоконференций Lync Server и может ли она выдавать соответствующие учетные данные;
    
      - проверяя, запущена ли пограничная служба передачи аудио- и видеоданных Lync Server и может ли она выделять ресурсы на внешних пограничных серверах.

2.  Проверка службы политики пропускной способности — средство тестирует все серверы в топологии, на которых запущены службы политики пропускной способности, выполняя следующие действия:
    
      - проверяя, запущена ли служба политики пропускной способности Lync Server (проверка подлинности) и может ли она выдавать соответствующие учетные данные;
    
      - проверяя, запущена ли служба политики пропускной способности Lync Server (ядро) и может ли она выполнить проверку пропускной способности.

Это средство необходимо запускать на компьютере, который входит в топологию и на котором установлено локальное хранилище.

## Выходные данные

Средство выводит результаты каждой операции.

  - Если выполняется тест **AudioVideoEdgeServer**, выходные данные включают следующие сведения:
    
      - результаты тестирования компьютеров в топологии, на которых работает служба проверки подлинности аудио- и видеоконференций Lync Server;
    
      - результаты тестирования компьютеров в топологии, на которых работает пограничная служба передачи аудио- и видеоданных Lync Server.

  - Если выполняется тест **BandwidthPolicyServer**, выходные данные включают следующие сведения:
    
      - результаты тестирования компьютеров в топологии, на которых работает служба политики пропускной способности Lync Server (проверка подлинности);
    
      - результаты тестирования компьютеров в топологии, на которых работает служба политики пропускной способности Lync Server (ядро).

## Требования

  - Это средство необходимо запускать на компьютере, который входит в топологию и на котором установлено локальное хранилище.

  - Средство должно запускаться администратором, который имеет доступ к локальному хранилищу.

## Примеры

Ниже приведен пример входных данных средства.

    MsTurnPing -ServerRole AudioVideoEdgeServer
    
    MsTurnPing -ServerRole BandwidthPolicyServer

## Сводка

Это средство может быть ценным ресурсом для администраторов Lync Server 2013, которым необходимо проверить состояние серверов со службами передачи аудио- и видеоданных и политики пропускной способности.

## Средство просмотра конфигурации сети

Администраторы программного обеспечения для связи Microsoft Lync Server 2013 могут использовать средство просмотра конфигурации сети для просмотра сетевой топологии контроля допуска звонков (CAC) в организации, которая служит для обеспечения сеансов связи в реальном времени, таких как голосовые или видеозвонки, в соответствии с заданной пропускной способностью. Администраторы Lync Server 2013 определяют политики CAC, которые применяются службами политики пропускной способности, устанавливаемыми вместе с Lync Server 2013.

## Описание

Средство просмотра конфигурации сети (NetworkConfigurationViewer.exe) позволяет администраторам выполнять следующие задачи:

  - загружать и просматривать сетевую топологию CAC для развертывания Lync Server 2013 в графическом формате;

  - загружать и просматривать сетевую топологию CAC из файла журнала сервера политики пропускной способности в графическом формате;

  - сохранять сетевую топологию CAC в формате XML на диске;

  - сохранять схему сетевой топологии CAC в формате JPG или BMP;

  - просматривать данные конфигурации сетевой топологии CAC;

  - просматривать сетевую топологию CAC в виде древовидного представления;

  - определять настраиваемые соединители для каналов сетевой топологии CAC (например, каналов между сайтом и областью, между двумя областями или между двумя сайтами);

  - просматривать сведения о сайтах и областях сетевой топологии CAC, а также о настроенных политиках пропускной способности и сетевых каналах.

## Назначение

Просмотр каналов корпоративной сетевой топологии CAC в графическом интерфейсе.

## Примеры

**Загрузка и просмотр сетевой топологии CAC для развертывания Lync Server 2013 в графическом формате**. Администраторы Lync Server 2013 могут загружать и просматривать конфигурацию сетевой топологии CAC на любом компьютере Lync Server 2013 с помощью команды **Download Network Configuration** (Загрузить конфигурацию сети), показанной на рисунке ниже. Если средство развернуто на компьютере, не имеющем подключения к хранилищу конфигурации Lync, загрузить и просмотреть конфигурацию не удастся.

![Загрузка конфигурации сети.](images/JJ945604.8d126d3f-2545-4f13-a244-974f09614982(OCS.15).jpg "Загрузка конфигурации сети.")

**Загрузка и просмотр сетевой топологии CAC из файла журнала сервера политики пропускной способности в графическом формате**. Серверы политики пропускной способности Lync Server 2013 сохраняют сетевую топологию CAC в процессе ведения журнала в общей папке Lync Server 2013. Администраторы Lync Server могут просмотреть этот файл в графическом формате с помощью команды **Open Network Configuration** (Открыть конфигурацию сети), показанной ниже.

![Открытие файла журнала сервера Bandwidth Policy Server.](images/JJ945604.3e503e92-aacb-4921-a8d2-23f860fe2df6(OCS.15).jpg "Открытие файла журнала сервера Bandwidth Policy Server.")

Сохранение сетевой топологии CAC в формате XML на диске. Администраторы Lync Server 2013 могут сохранить файл конфигурации сетевой топологии CAC в формате XML с помощью команды **Save a copy of Network Configuration** (Сохранить копию конфигурации сети), показанной ниже. Сохраненный файл конфигурации затем можно использовать в автономном режиме для просмотра в графическом формате.

![Сохранение конфигурации сети как XML-файл.](images/JJ945604.6eeef3b0-78b5-4ee6-8d94-1a4ddf3d8676(OCS.15).jpg "Сохранение конфигурации сети как XML-файл.")

Сохранение схемы сетевой топологии CAC в формате JPG или BMP. Администраторы Lync Server 2013 могут сохранить конфигурацию сетевой топологии CAC в графическом формате (в виде файла JPG или BMP) с помощью команды **Save Network Configuration diagram as picture** (Сохранить схему конфигурации сети как рисунок), показанной ниже.

![Сохранение конфигурации сети как изображение.](images/JJ945604.145a6fb9-58b1-46b1-bbd5-a661ceba07b4(OCS.15).jpg "Сохранение конфигурации сети как изображение.")

**Просмотр данных конфигурации сетевой топологии CAC**. Администраторы Lync Server 2013 могут просматривать данные конфигурации сети, например области сети, сетевые сайты, профили пропускной способности и IP-адреса подсетей сайтов, в текстовом формате с помощью команды "View Network Configuration data" (Просмотреть данные конфигурации сети), показанной ниже.

![Просмотр данных конфигурации сети.](images/JJ945604.b72a4c21-a042-4d91-bf96-fcb396af0679(OCS.15).jpg "Просмотр данных конфигурации сети.")

**Просмотр сетевой топологии CAC в виде древовидного представления**. Администраторы Lync Server 2013 могут просматривать данные конфигурации сети в виде графического древовидного представления с помощью панели управления в левой части окна средства, как показано ниже.

![Просмотр данных конфигурации сети в представлении дерева.](images/JJ945604.4d924ac9-fd96-430f-b211-ee35b7ef9a23(OCS.15).jpg "Просмотр данных конфигурации сети в представлении дерева.")

**Определение настраиваемых соединителей для каналов сетевой топологии CAC (например, каналов между сайтом и областью, между двумя областями или между двумя сайтами)**. Администраторы Lync Server 2013 могут определять настраиваемые графические соединители для каналов глобальной сети в сетевой конфигурации CAC с помощью меню "Settings" (Параметры), показанного ниже. Это позволяет различать типы сетевых каналов, настроенных в конфигурации сети.

![b20bea67-c8e1-453e-b1dd-e2aa17b62566](images/JJ945604.b20bea67-c8e1-453e-b1dd-e2aa17b62566(OCS.15).jpg "b20bea67-c8e1-453e-b1dd-e2aa17b62566")

**Просмотр сведений о сайтах и областях в сетевой топологии CAC, а также о настроенных политиках пропускной способности**. Администраторы Lync Server 2013 могут просматривать сведения об областях и сайтах в сетевой топологии CAC, а также о пропускной способности CAC с помощью показанных ниже команд. (Например, нажав кнопку **Info** (Сведения) в объекте области сети или сетевого сайта.)

![Определение настраиваемого соединителя для сети.](images/JJ945604.26262c75-4342-41c3-bc98-1793aa6a7713(OCS.15).jpg "Определение настраиваемого соединителя для сети.")

## Сводка

Это средство может быть ценным ресурсом для администраторов Lync Server 2013, которым необходимо просмотреть сетевую топологию CAC для развертывания в графическом формате.

## Динамический агент группы ответа

Приложение группы ответа дает агентам возможность доступа к полезной информации в режиме реального времени с помощью встроенной веб-службы. К сожалению, графическое представление этих данных вне приложения недоступно. Средство "Динамический агент группы ответа" из набора ресурсов решает эту проблему, обеспечивая простой доступ к этой информации в графической форме. Также предоставляются дополнительные сведения Microsoft Lync 2013 в режиме реального времени, такие как сведения о присутствии других агентов.

## Описание

Динамический агент группы ответа — это приложение Windows, которое предоставляет агентам группы ответа функции входа и выхода и некоторые сведения в режиме реального времени (такие как членство в группах и текущее число звонков). Оно служит в качестве расширенной версии страницы "Группы агентов" (доступной в Lync 2013.

## Назначение

Приложение группы ответа помещает входящие звонки в очередь, а затем направляет их группам агентов. Для принятия обоснованных решений по поводу того, какие звонки следует обслуживать, агенты могут получать доступ к информации о своих группах агентов в режиме реального времени, например, к сведениям о том, какие еще агенты доступны и сколько звонков помещено в каждую очередь. Динамический агент группы ответа обеспечивает интуитивно понятный доступ к этой информации, которая ранее была доступна только через службу группы ответа.

## Возможности

Динамический агент группы ответа построен на основе службы группы ответа и пакета SDK Microsoft Lync 2013. Он предоставляет агентам группы ответа информацию и возможности, доступные в службе группе ответа (например, сведения о членстве в группах, присутствии других агентов и числе ожидающих звонков).

На рисунке ниже показан главный интерфейс динамического агента группы ответа.

![Инструмент Response Group Agent Live.](images/JJ945604.63cb0374-a6ef-4a59-b60e-bec86a880d09(OCS.15).jpg "Инструмент Response Group Agent Live.")

В динамическом агенте группы ответа доступны следующие три основные функции.

  - **Вход и выход**. В отличие от страницы "Группы агентов" (доступной в Lync 2013), динамический агент группы ответа позволяет агентам входить во все группы агентов или выходить из всех групп одновременно. Это приложение предоставляет агентам три быстрых способа входа или выхода.
    
      - Нажмите в приложении кнопку входа или выхода (зеленую или красную соответственно).
    
      - Щелкните значок в области уведомлений и выберите команду входа или выхода.
    
      - Используйте настраиваемые сочетания клавиш.

  - **Членство в группах.** Когда выбрана группа агентов, в правой области динамического агента группы ответа выводится список агентов этой группы. Если приложение работает на том же компьютере, что и Lync 2013, в нем отображаются сведения о присутствии и карточка контакта. Агенты могут отправлять мгновенные сообщения или звонить другим агентам непосредственно отсюда.

  - **Статистика в режиме реального времени**. Динамический агент группы ответа предоставляет статистику в режиме реального времени по всем группам агентов. Частота обновления составляет одну минуту. Когда группа ответа отвечает на звонок, рядом с именем группы появляется визуальный индикатор с текущим числом звонков в очереди. Если навести указатель на группу, также отображается самое долгое время ожидания.

## Требования

Для динамического агента группы ответа требуется платформа .NET Framework 4.0. Кроме того, для использования сведений о присутствии и карточки контакта на том же компьютере должна быть установлена (и запущена) программа Lync 2013.

## Настройка

Динамический агент группы ответа можно настроить в соответствии с личными предпочтениями с помощью диалогового окна "Options" (Параметры) приложения. Кроме того, администратор может определить адрес узла по умолчанию, изменив свойство defaultHostAddress в файле RGAgentLive.exe.config.

На приведенном ниже рисунке показано диалоговое окно "Options", с помощью которого агенты могут настраивать адрес узла и сочетания клавиш. Чтобы открыть его, нажмите кнопку "Options" в правом верхнем углу главного интерфейса.

![Диалоговое окно параметров Response Group Agent Live.](images/JJ945604.3cc15e29-8699-45ab-90c3-e1565fa6ebf6(OCS.15).jpg "Диалоговое окно параметров Response Group Agent Live.")

В конфигурации динамического агента группы ответа можно настроить следующие три параметра.

  - "Host address" (Имя узла) — обычно это полное доменное имя веб-пула, входящего в домашний пул агента. Адрес службы группы ответа автоматически формируется на основе этой информации (путем добавления соответствующего пути после имени узла).

  - "Shortcuts" (Сочетания клавиш) — можно настроить сочетания клавиш, используемые для входа и выхода. Единственным условием является то, что оба сочетания клавиш должны включать клавишу с логотипом Windows (и по крайней мере еще одну клавишу).

  - "Start with Windows" (Запускать при загрузке Windows) — приложение можно настроить так, чтобы оно запускалось автоматически при загрузке ОС Windows.

## Примеры

На приведенном ниже рисунке показано, как позвонить или отправить мгновенное сообщение другому агенту, щелкнув правой кнопкой мыши контакт в области справа.

![Звонок или отправка сообщения.](images/JJ945604.009cebe0-5a93-4745-89c3-8a16c7c13009(OCS.15).jpg "Звонок или отправка сообщения.")

На приведенном ниже рисунке показано, как в динамическом агенте группы ответа отображается текущее число звонков в очереди и самое долгое время ожидания для входящих звонков.

![Просмотр сведений очереди.](images/JJ945604.131d7f79-b7ed-41f5-a9da-ffc556e31037(OCS.15).jpg "Просмотр сведений очереди.")

## Сводка

Агент группы ответа предоставляет такие полезные функции, как быстрый вход и выход, сведения о членстве в группах и базовая статистика в режиме реального времени, которые вне приложения доступны только посредством службы группы ответа. С помощью средства "Динамический агент группы ответа" из набора ресурсов администраторы Lync могут предоставить агентам приложение Windows, позволяющее им выполнять задачи более быстро и интуитивно понятными способами.

## SEFAUtil

SEFAUtil (средство активации функций добавочных номеров) — это средство командной строки, которое позволяет администраторам ПО для связи Microsoft Lync Server 2013 и агентам службы технической поддержки настраивать параметры делегированных звонков, переадресации звонков, одновременных звонков, групповых звонков, а также групповой ответ на звонки от имени пользователя Lync Server 2013. Оно также позволяет администраторам запрашивать параметры маршрутизации звонков, опубликованные для определенного пользователя. С помощью средства SEFAUtil администраторы могут включать, отключать и изменять переадресацию звонков или одновременные звонки от имени пользователя. Администратор может указать назначение (в виде URI SIP) или использовать назначение, уже опубликованное пользователем. Это средство также позволяет администраторам добавлять или удалять делегатов или членов группы приема звонков от имени пользователя. Средство построено на основе Microsoft Unified Communications Managed API (UCMA) 3.0. Администраторам необходимо создать доверенное приложение в центральном хранилище управления для SEFAUtil

Средство SEFAUtil позволяет администраторам Lync Server 2013 и агентам службы технической поддержки настраивать параметры делегированных звонков, переадресации звонков, одновременных звонков, групповых звонков, а также групповой ответ на звонки от имени пользователя Lync Server 2013. Оно также позволяет администраторам запрашивать параметры маршрутизации звонков, опубликованные для определенного пользователя.

## Описание

В текущей версии SEFAUtil — это средство командной строки. Графический пользовательский интерфейс не поддерживается. Средство основано на Microsoft Unified Communications Managed API (UCMA) 3.0. Функции средства позволяют администраторам и агентам службы технической поддержки выполнять следующие действия:

  - просматривать все параметры маршрутизации звонков для пользователя (включая параметры переадресации звонков, делегирования, одновременных звонков, групповых звонков и группового ответа на звонки);

  - включать, отключать и изменять параметры переадресации звонков (включая назначение и таймер ожидания ответа);

  - включать, отключать и изменять непосредственные конфигурации переадресации звонков;

  - включать, отключать и изменять параметры делегирования;

  - включать, отключать и изменять параметры группы приема звонков;
    
    > [!NOTE]
    > Появилось в версии средства SEFAUtil для Lync Server 2013.


  - включать, отключать и изменять параметры одновременных звонков (включая назначение);
    
    > [!NOTE]
    > Появилось в версии средства SEFAUtil для Lync Server 2013.


  - включать, отключать и изменять параметры группового ответа на звонки.
    
    > [!WARNING]
    > Появилось в версии средства SEFAUtil для Lync Server 2013.


В отношении средства действуют перечисленные ниже ограничения.

  - Поддерживается только для пользователей, размещенных в пуле Lync Server.

  - Групповое изменение параметров маршрутизации звонков для нескольких пользователей не поддерживается.

## Выходные данные

В текущей версии средства данные выводятся только в окне командной строки. Подробные сведения см. в разделе "Примеры" далее в этой статье.

## Назначение

Ниже приведены некоторые основные сценарии, в которых можно использовать это средство.

  - Владимир является руководителем. Он был переведен на систему телефонной связи на основе Lync Server. В существующей системе УАТС для него настроено делегирование. В процессе перехода на Lync администратор может настроить для Владимира маршрутизацию в соответствии с ранее существовавшей конфигурацией делегирования.

  - Юлия находится в командировке и должна получить важный звонок от одного из клиентов. Однако она находится в гостинице и не имеет доступа к компьютеру. Юлия звонит в службу технической поддержки и просит, чтобы все звонки на ее рабочий номер переадресовывались на номер мобильного телефона. Специалисты службы поддержки производят настройку от ее имени.

  - Звонки на рабочий номер Алексея поступают в его мобильную голосовую почту, когда он находится на работе. Однако в других местах все работает правильно. Специалист службы технической поддержки просматривает настройки маршрутизации Алексея и обнаруживает, что у него настроены одновременные звонки на мобильный телефон. Специалист интересуется у Алексея, насколько стабильна мобильная связь в его офисе, и устанавливает, что звонки поступают в мобильную голосовую почту из-за правила одновременных звонков, если сигнал мобильной сети слабый.

  - Руслан — новый сотрудник в компании Contoso. Он присоединяется к рабочей группе, для всех членов которой настраиваются групповые звонки при включении поддержки Microsoft Lync. Администратор настраивает для него параметры группы приема звонков, включая в нее всех членов его новой рабочей группы. Кроме того, администратор добавляет Руслана в качестве члена группы приема звонков для каждого члена его рабочей группы.

  - В отделе кадров компании Contoso все абоненты обслуживаются специалистами с первого звонка. При групповых звонках все телефоны звонят одновременно, что отвлекает сотрудников отдела от работы. Чтобы обеспечить качественное обслуживание, не создавая затруднений в работе, администратор Lync использует возможность группового ответа на звонки. Он добавляет всех сотрудников отдела в группу ответа и сообщает им номер этой группы. Когда Светланы нет на рабочем месте, Алексей, замечая, что ее телефон звонит, может ответить на звонок со своего рабочего места.

## Требования

Средство SEFAUtil можно запускать только на компьютере, входящем в пул доверенных приложений. На этом компьютере должен быть установлен интерфейс UCMA 3.0. Для запуска средства в пуле необходимо создать доверенное приложение с идентификатором приложения SEFAUtil.

**Создание доверенного приложения для средства SEFAUtil**

1.  Средство SEFAUTil можно запускать только на компьютере, входящем в пул доверенных приложений. При необходимости можно добавить пул в качестве нового пула доверенных приложений с помощью командной консоли Lync Server, выполнив следующий командлет:
    
        New-CsTrustedApplicationPool -id <Pool FQDN> -Registrar <Pool Registrar FQDN> -site Site:<Pool Site>
    
    > [!NOTE]
    > Интерфейс UCMA 3.0 нужно установить на всех компьютерах, на которых будет запускаться средство SEFAUtil.


2.  В топологии нужно определить доверенное приложение для средства SEFAUtil. Чтобы определить SEFAUtil в качестве нового доверенного приложения, в командной консоли Lync Server выполните следующий командлет:
    
        New-CsTrustedApplication -ApplicationId sefautil -TrustedApplicationPoolFqdn <Pool FQDN>  -Port 7489
    
    > [!NOTE]
    > При необходимости можно использовать другой порт.

3.  Изменения, внесенные в топологию, необходимо применить. Для этого в командной консоли Lync Server можно выполнить следующий командлет:
    
        Enable-CsToplogy

4.  При необходимости установите средства из набора ресурсов Lync Server 2013 на сервере, который будет использоваться для запуска средства SEFAUtil (сервер должен входить в пул доверенных приложений).

5.  Убедитесь в том, что средство SEFAUtil работает правильно. Для этого запустите его из командной строки Windows с правами администратора, чтобы отобразить параметры переадресации звонков пользователя в развертывании. По умолчанию средство находится в папке "…\\Program Files\\Microsoft Lync Server 2013\\Reskit". Чтобы отобразить параметры переадресации звонков пользователя, используйте следующую команду:
    
        SEFAUtil.exe <user SIP address> /server:<Lync Server/Pool FQDN>
    
    На экране должны появиться параметры переадресации звонков пользователя.

## Групповой ответ на звонки

Для полноценной работы функции группового ответа на звонки необходимо произвести дополнительную настройку в Lync Server. Перед тем как назначать группы ответа пользователям, обратитесь к документации по функции группового ответа на звонки, чтобы получить инструкции по ее планированию и развертыванию.

## Примеры

## Отображение текущих параметров обработки звонков

Следующая команда выводит параметры обработки звонков для пользователя: `SEFAUtil.exe /server:lyncserver.contoso.com katarina@contoso.com`

> [!NOTE]
> В этом примере используется параметр <strong>/server</strong> для указания сервера Lync Server, к которому нужно подключиться.


**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Simulring enabled: False
    User Ring time: 00:00:20
    Call Forward No Answer to: voicemail

## Задание назначения для переадресации звонков и неотвеченных звонков

В этом примере задается назначение для переадресации звонков и неотвеченных звонков, а также задержка звонка. Параметр /server не указан. Средство SEFAUtil пытается автоматически обнаружить сервер Lync Server.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /enablefwdnoanswer /callanswerwaittime:30 /setfwddestination:+1425555 0126@contoso.com;user=phone

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Simulring enabled: False
    User Ring time: 00:00:30
    Call Forward No Answer to: sip:+14255550126@contoso.com;user=phone

## Немедленное включение переадресации звонков

В этом примере немедленно включается переадресация звонков другому пользователю.

    SEFAUtil.exe sip:katarina@contoso.com /enablefwdimmediate /setfwddestination:anders@contoso.com

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Simulring enabled: False
    Forward immediate to: sip:anders@contoso.com

## Немедленное отключение переадресации звонков

В этом примере немедленно отключается переадресация звонков.

    SEFAUtil.exe /server:lyncserver.contoso.com katarina@contoso.com  /disablefwdimmediate

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Simulring enabled: False
    User Ring time: 00:00:30
    Call Forward No Answer to: voicemail

## Добавление пользователя в качестве делегата и настройка одновременных звонков делегатам

В этом примере пользователь добавляется в качестве делегата и настраиваются одновременные звонки делегатам.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /adddelegate:joe@contoso.com /simulringdelegates

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Simultaneously Ringing Delegates: sip:joe@contoso.com

## Изменение правила одновременных звонков делегатам

В этом примере правило одновременных звонков, настроенное в предыдущем примере, изменяется на правило задержки звонков.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /delayringdelegates:10

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Simulring enabled: False
    Delay Ringing Delegates (delay:10 seconds): sip:joe@contoso.com

## Удаление делегата

В этом примере удаляется делегат.

> [!NOTE]
> После удаления последнего делегата делегированные звонки автоматически отключаются.


    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /removedelegate:joe@contoso.com

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Simulring enabled: False
    User Ring time: 00:00:30
    Call Forward No Answer to: voicemail

## Добавление делегата и настройка правила переадресации звонков делегатам

В этом примере добавляется делегат и настраивается правило переадресации звонков делегатам.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /adddelegate:anders@contoso.com /fwdtodelegates

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Forwarding calls to Delegates: sip:anders@contoso.com

## Включение одновременных звонков и задание номера назначения

В этом примере включаются одновременные звонки и задается номер назначения для них.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /setsimulringdestination:+14255550126 /enablesimulring

> [!NOTE]
> Чтобы изменить номер назначения одновременных звонков для пользователя, для которого уже включены одновременные звонки, используйте в команде параметр /enablesimulring. В противном случае номер назначения не изменится.


**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Simulring enabled: True
    Simul_Ringing to: sip:+14255550126@contoso.com;user=phone

## Отключение одновременных звонков

В этом примере отключаются одновременные звонки.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /disablesimulring

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Simulring enabled: False
    User Ring time: 00:00:30
    Call Forward No Answer to: voicemail

## Добавление пользователя в группу приема звонков и настройка одновременных звонков группе приема звонков

В этом примере добавляется член группы приема звонков и включаются одновременные звонки этой группе.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /addteammember:anders@contoso.com /simulringteam

> [!NOTE]
> При добавлении члена в группу приема звонков пользователя параметры одновременных звонков автоматически изменяются на выполнение одновременных звонков в эту группу.


**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Team ringing enabled. Team: sip:anders@contoso.com

## Удаление члена из группы приема звонков

В этом примере удаляется один из членов группы приема звонков пользователя.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /removeteammember:anders@contoso.com

> [!NOTE]
> Если удаляемый член является единственным в группе приема звонков, одновременные звонки группе приема звонков автоматически отключаются.


**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    User Ring time: 00:00:30
    Call Forward No Answer to: voicemail

## Настройка задержки звонков в группу приема звонков

В этом примере изменяется параметр задержки звонков в группу приема звонков.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /delayringteam:5

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Delay Ringing Team (delay:5 seconds). Team: sip:anders@contoso.com

## Включение группового звонка

В этом примере включается групповой звонок для определенного пользователя.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /simulringteam

> [!NOTE]
> Если группа ответа звонков пользователя не имеет членов, групповой звонок не будет включен.


**Выходные данные**

## Отключение группового звонка

В этом примере отключается групповой звонок для определенного пользователя.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /disableteamcall

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    User Ring time: 00:00:30
    Call Forward No Answer to: voicemail

## Включение группового ответа на звонки и назначение группы ответа пользователю

В этом примере пользователю назначается группа ответа и включается групповой ответ на звонки.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /enablegrouppickup:199

**Выходные данные**

    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True
    Group Pickup Orbit: sip:199;phone-context=user-default@ contoso.com;user=phone

## Отключение группового ответа на звонки

В этом примере отключается групповой ответ на звонки для определенного пользователя.

    SEFAUtil.exe /server:lyncserver.contoso.com sip:katarina@contoso.com /disablegrouppickup

> [!NOTE]
> Когда вы отключаете функцию группового ответа на звонки для пользователя, номер группы, который был назначен пользователю, не сохраняется. Если вы впоследствии повторно включаете функцию группового ответа на звонки для данного пользователя, необходимо снова назначить номер группы с помощью параметра /enablegrouppickup.


    User Aor: sip:katarina@contoso.com
    Display Name: Katarina Larsson
    UM Enabled: True

## SYSPrep.ps1

## Описание

SYSPrep.ps1 — это скрипт Windows PowerShell, который устанавливает следующие необходимые компоненты Lync Server 2013 на компьютере ОС Windows Server 2008.

  - Microsoft .Net Framework 4.5

  - Microsoft SQL, экспресс-выпуск

  - Windows PowerShell версии 3.0

  - Распространяемый пакет Visual C++ 2010

  - Обновления для сервера IIS

  - Windows Identity Foundation

  - Файлы основных данных Lync Server 2013

Хотя имя этого скрипта совпадает с именем средства SysPrep для операционных систем Microsoft Windows, эти средства отличаются. Данный скрипт устанавливает только необходимые компоненты для Lync Server 2013. После установки этих компонентов можно создать образ сервера с помощью средства SysPrep Windows.

## Требования

Перед выполнением скрипта SYSPrep.ps1 нужно скопировать файлы необходимых компонентов в локальную папку на компьютере ОС Windows Server 2008 (например, **D:\\Setup)**. В этой папке также должны находиться копии файлов Lync Server 2013, в частности файла **Setup.exe.** Файлы необходимых компонентов можно загрузить на следующих страницах.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Необходимый компонент</th>
<th>Расположение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Microsoft .Net Framework 4.5</p></td>
<td><p>http://go.microsoft.com/?linkid=9816306</p></td>
</tr>
<tr class="even">
<td><p>Microsoft SQL Server 2008 R2, экспресс-выпуск</p></td>
<td><p>http://www.microsoft.com/ru-ru/download/details.aspx?id=23650</p></td>
</tr>
<tr class="odd">
<td><p>Windows PowerShell версии 3.0</p></td>
<td><p>http://www.microsoft.com/ru-ru/download/details.aspx?id=34595</p></td>
</tr>
<tr class="even">
<td><p>Распространяемый пакет Visual C++ 2010</p></td>
<td><p>http://www.microsoft.com/ru-ru/download/details.aspx?id=5555</p></td>
</tr>
<tr class="odd">
<td><p>Обновления для сервера IIS</p></td>
<td><p>http://www.microsoft.com/ru-ru/download/details.aspx?id=34869</p></td>
</tr>
<tr class="even">
<td><p>Windows Identity Foundation</p></td>
<td><p>http://www.microsoft.com/ru-ru/download/details.aspx?id=17331</p></td>
</tr>
<tr class="odd">
<td><p>Файл Setup.exe для Lync Server 2013</p></td>
<td><p>Скопируйте с установочного носителя Lync Server 2013</p></td>
</tr>
</tbody>
</table>


## Примеры

Параметр **–SetupFolder** использует в качестве аргумента расположение каталога с файлами необходимых компонентов.

## Примеры

Чтобы запустить скрипт SYSPrep.ps1 и установить необходимые компоненты Lync Server 2013, в командной строке с повышенными привилегиями выполните следующую команду:

    ./SysPrep.PS1 -SetupFolder D:\Setup

## Перенос оповещений о неназначенных номерах

Средство переноса оповещений о неназначенных номерах позволяет администратору Lync перенести конфигурацию неназначенных номеров, обслуживаемую приложением "Оповещение", с исходного сервера или из исходного пула Lync Server на конечный сервер или в конечный пул Lync Server.

## Описание

Средство переноса оповещений о неназначенных номерах — это скрипт Windows PowerShell, который перемещает конфигурацию неназначенных номеров, обслуживаемую приложением "Оповещение", с исходного сервера (или пула) на другой.

При запуске скрипт переноса оповещений о неназначенных номерах выполняет следующие операции.

1.  Переносит все звуковые файлы, которые используются оповещениями о неназначенных номерах в приложении "Оповещение", размещенном на исходном сервере или в исходном пуле, в хранилище файлов конечного сервера или пула.
    
    > [!NOTE]
    > После копирования звуковых файлов в конечный пул они удаляются из исходного пула.


2.  Переносит все оповещения о неназначенных номерах, которые настроены для приложения "Оповещение", размещенного на исходном сервере или в исходном пуле, на конечный сервер или в конечный пул.

3.  Переназначает все диапазоны неназначенных номеров, которые обслуживаются приложением "Оповещение", размещенным на исходном сервере или в исходном пуле, конечному серверу или пулу.

После успешного выполнения скрипта все диапазоны неназначенных номеров, которые обслуживались приложением "Оповещение", размещенным на исходном сервере или в исходном пуле, будут обслуживаться конечным сервером или пулом с сохранением конфигурации.

## Выходные данные

При выполнении скрипта **Move-CsAnnouncementConfiguration** в окне командной консоли Lync выводятся сведения о том, прошла ли операция переноса успешно или в ее процессе произошел сбой.

Если выполнение операции было прервано в результате ошибки, успешно перенесенные диапазоны неназначенных номеров останутся на конечном сервере или в конечном пуле и будут работоспособны, а остальные диапазоны останутся на исходном сервере или в исходном пуле и также будут работоспособны. Чтобы полностью перенести конфигурацию, устраните причину ошибки и повторно запустите скрипт.

## Назначение

Скрипт переноса оповещений о неназначенных номерах можно использовать в следующих трех сценариях.

  - **Перенос параметров конфигурации в новую версию Lync Server**. Компания Contoso выполняет миграцию на Lync Server 2013, и в рамках этого процесса администратор Lync Server хотел бы перенести конфигурацию неназначенных номеров, обслуживаемую приложением "Оповещение", из развертывания Lync Server 2010 в новое развертывание Lync Server 2013. Чтобы перенести параметры конфигурации, администратор Lync Server использует средство переноса оповещений о неназначенных номерах.

  - **Откат развертывания Lync Server 2013 к версии Lync Server 2010**. Из-за непредвиденных факторов компании Contoso приходится выполнить откат перехода на новое развертывание Lync Server 2013. Чтобы свести к минимуму перерывы в обслуживании, администратор Lync Server использует средство переноса оповещений о неназначенных номерах для отката конфигурации с версии Lync Server 2013 к версии Lync Server 2010.

  - **Перенос данных между развертываниями Lync**. Компания Contoso заменяет все серверы в одном из пулов на новые. Стратегия состоит в том, чтобы развернуть новый пул Lync Server 2013, перенести в него все данные из старого пула, а затем вывести старый пул из эксплуатации. После развертывания нового пула конфигурация переносится из старого пула в новый с помощью средства переноса оповещений о неназначенных номерах.

## Требования

Для успешной работы средства должны выполняться перечисленные ниже основные требования.

1.  Скрипт необходимо запускать на компьютере, на котором установлена командная консоль Lync Server 2013.

2.  Приложение "Оповещение" должно быть успешно развернуто на исходном и конечном серверах или в исходном и конечном пулах Lync Server.

## Скрипт Move-CsAnnouncementConfiguration

Скрипт Move-CsAnnouncementConfiguration требует использования двух параметров, которые описаны в таблице ниже.

![Параметры Move-CsAnnouncementConfiguration.](images/JJ945604.7ab66ad3-d0db-4d77-8b93-ebccf0cb0663(OCS.15).jpg "Параметры Move-CsAnnouncementConfiguration.")

## Примеры

## Перенос конфигурации оповещений о неназначенных номерах из пула Lync Server 2010 в пул Lync Server 2013

В этом примере оповещения о неназначенных номерах переносятся из исходного пула (Lync Server 2010) в конечный пул (Lync Server 2013).

    Move-CsAnnouncementConfiguration.ps1 -Source LS2010Pool.contoso.com -Destination LS2013Pool.contoso.com

## Перенос конфигурации оповещений о неназначенных номерах из пула Lync Server 2013 в пул Lync Server 2010

В этом примере оповещения о неназначенных номерах переносятся из исходного пула (Lync Server 2013) в конечный пул (Lync Server 2010).

    Move-CsAnnouncementConfiguration.ps1 -Source LS2013Pool.contoso.com -Destination LS2010Pool.contoso.com

## Web Conf Data

Средство Web Conf Data предоставляет администраторам ПО для связи Lync Server 2013 дополнительные возможности контроля данных, связанных с веб-конференциями организатора. К ним относится возможность удаления данных, связанных с собраниями определенного пользователя, на основе критерия метки времени.

## Описание

Это средство позволяет администратору выполнять следующие операции:

1.  находить все данные веб-конференций, связанные с отдельным пользователем;

2.  удалять все данные веб-конференций, связанные с отдельным пользователем;

3.  удалять все данные веб-конференций, связанные с отдельным пользователем, старше определенной даты;

4.  переносить все данные веб-конференций, связанные с отдельным пользователем, если этот пользователь переносится из одного пула в другой.

> [!NOTE]
> Resource Kit Tools для Lync Server 2010 поддерживал перенос всех данных веб-конференций, связанных с отдельным пользователем, при переносе этого пользователя из одного пула в другой. В текущей версии средства эта функция заменена параметром <strong>MoveConferenceData</strong>. Подробные сведения об этом параметре см. в описании командлета <a href="https://technet.microsoft.com/ru-ru/library/gg398528(v=ocs.15)">Move-CsUser</a>.


Средство удаляет данные только для неактивных собраний. Активные собрания (или собрания в рамках сеансов) удалить нельзя.

Это средство необходимо запускать на компьютере, который входит в тот же пул, что и целевой пользователь. Пользователь, для управления данными собраний которого используется это средство, должен быть размещен в том же пуле пользователей.

## Выходные данные

Средство выводит результаты каждой операции.

  - Если выполняется запрос, средство выводит список всех папок с данными неактивных собраний, организатором которых является указанный пользователь.

  - Если выполняется удаление, средство выводит список всех папок с данными собраний, которые будут удалены.

## Требования

Средство необходимо запускать в том же пуле, в котором в настоящее время размещен организатор.

Средство должно запускаться с правами администратора на доступ к хранилищу файлов содержимого.

## Примеры

В приведенной ниже таблице описываются параметры, некоторые из которых используются в примерах.

![Параметры Web Conf Data Tool.](images/JJ945604.a733c1c6-5dfc-4874-a74f-bfdee81c1401(OCS.15).jpg "Параметры Web Conf Data Tool.")

    WebConfDataTool.exe /User:user0@contoso.com /Action:query ""/ExpirationDate:08/09/2010 12:00:00""

В предыдущем примере показано, как выполняется команда запроса. Выходные данные этой команды представляют собой список всех папок с содержимым собраний, которые будут затронуты при работе средства.

    WebConfDataTool.exe /User:user0@contoso.com /Action:delete

Выше приведен пример команды удаления. Она удаляет все папки неактивных собраний для указанного пользователя.

## Сводка

Это средство может быть ценным ресурсом для администраторов, которым требуется более полный контроль над данными конференций.

