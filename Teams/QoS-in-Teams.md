---
title: Качество обслуживания в Microsoft Teams
author: LolaJacobsen
ms.author: lolaj
manager: Serdars
ms.topic: article
ms.service: msteams
ms.reviewer: vkorlep, siunies
audience: admin
description: Узнайте, как подготовить сеть Организации к качеству обслуживания (QoS) в Microsoft Teams.
localization_priority: Normal
search.appverid: MET150
f1.keywords:
- CSH
ms.custom:
- ms.teamsadmincenter.meetingsettings.qos
- ms.teamsadmincenter.meetingsettings.network.qosmarkers
- seo-marvel-apr2020
ms.collection:
- M365-collaboration
appliesto:
- Microsoft Teams
ms.openlocfilehash: ef2fca810a7125c4150ff4de2c3eea8fd7970d2e
ms.sourcegitcommit: 90939ad992e65f840e4c2e7a6d18d821621319b4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "45085285"
---
# <a name="implement-quality-of-service-qos-in-microsoft-teams"></a><span data-ttu-id="db399-103">Реализация качества обслуживания (QoS) в Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="db399-103">Implement Quality of Service (QoS) in Microsoft Teams</span></span>

<span data-ttu-id="db399-104">Качество обслуживания (QoS) в Microsoft Teams — это способ разрешить сетевой трафик в реальном времени, чувствительный к задержкам сети (например, голосовые и видеопотокы), чтобы подать сообщение "вырезать в линии" перед трафиком, который менее чувствителен (как загрузить новое приложение, где дополнительная секунда для скачивания не является серьезной).</span><span class="sxs-lookup"><span data-stu-id="db399-104">Quality of Service (QoS) in Microsoft Teams is a way to allow real-time network traffic that is sensitive to network delays (for example, voice or video streams) to "cut in line" in front of traffic that is less sensitive (like downloading a new app, where an extra second to download isn't a big deal).</span></span> <span data-ttu-id="db399-105">Качество обслуживания определяет и помечает все пакеты в потоках в реальном времени (с помощью объектов групповой политики Windows и функции маршрутизации, называемые списками управления доступом на основе порта, больше об этом ниже), что позволяет сети предоставлять потокам голосовой, видеосвязи и демонстрации экрана специальную часть пропускной способности сети.</span><span class="sxs-lookup"><span data-stu-id="db399-105">QoS identifies and marks all packets in real-time streams (using Windows Group Policy Objects and a routing feature called Port-based Access Control Lists, more about those is below) which then helps your network to give voice, video, and screen share streams a dedicated portion of network bandwidth.</span></span>

<span data-ttu-id="db399-106">Если вы поддерживаете крупную группу пользователей и столкнулись с одной из проблем, описанных ниже, вам, возможно, потребуется реализовать QoS.</span><span class="sxs-lookup"><span data-stu-id="db399-106">If you're supporting a large group of users and they're experiencing any of the problems described below, you probably need to implement QoS.</span></span> <span data-ttu-id="db399-107">Для малых предприятий с небольшим количеством пользователей может не потребоваться качество обслуживания, но даже там оно должно быть полезным.</span><span class="sxs-lookup"><span data-stu-id="db399-107">A small business with few users may not need QoS, but even there it should be helpful.</span></span>

<span data-ttu-id="db399-108">Вы можете столкнуться со следующими проблемами качества в голосовой и видеосвязи, не имея некоторых форм качества обслуживания.</span><span class="sxs-lookup"><span data-stu-id="db399-108">Without some form of QoS, you might see the following quality issues in voice and video:</span></span>

- <span data-ttu-id="db399-109">Колебание – пакеты мультимедиа, поступающие на разные тарифы, что может привести к невозможности поиска слов и слогов в звонках.</span><span class="sxs-lookup"><span data-stu-id="db399-109">Jitter – media packets arriving at different rates, which can result in missing words or syllables in calls</span></span>
- <span data-ttu-id="db399-110">Потери пакетов – пакеты отбрасываются, что также может привести к снижению качества голоса и сложному понятию речи</span><span class="sxs-lookup"><span data-stu-id="db399-110">Packet loss – packets dropped, which can also result in lower voice quality and hard to understand speech</span></span>
- <span data-ttu-id="db399-111">Время задержки приема-передачи (RTT) – пакеты мультимедиа занимают много времени, что приводит к значительным задержкам между двумя сторонами в разговоре, что приводит к тому, что люди говорят друг другу.</span><span class="sxs-lookup"><span data-stu-id="db399-111">Delayed round trip time (RTT) – media packets taking a long time to reach their destinations, which results in noticeable delays between two parties in a conversation, causing people to talk over each other</span></span>

<span data-ttu-id="db399-112">Самый сложный способ решить эти проблемы — это уменьшить размер подключений к данным, как внутренним, так и к Интернету.</span><span class="sxs-lookup"><span data-stu-id="db399-112">The least complex way to address these issues is to increase the size of the data connections, both internally and out to the internet.</span></span> <span data-ttu-id="db399-113">Так как это часто недорогие, QoS обеспечивает более эффективное управление ресурсами вместо добавления пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="db399-113">Since that is often cost-prohibitive, QoS provides a way to more effectively manage the resources you have instead of adding bandwidth.</span></span> <span data-ttu-id="db399-114">Для устранения проблем с качеством рекомендуется сначала использовать QoS, а затем добавить пропускную способность только в нужном месте.</span><span class="sxs-lookup"><span data-stu-id="db399-114">To address quality issues, we recommend that you first use QoS, then add bandwidth only where necessary.</span></span>

<span data-ttu-id="db399-115">Для обеспечения эффективности качества обслуживания вы будете применять согласованные параметры QoS для всей Организации, поскольку любая часть пути, которая не поддерживает приоритеты QoS, может снизить качество звонков, видео и демонстрации экрана.</span><span class="sxs-lookup"><span data-stu-id="db399-115">For QoS to be effective, you'll apply consistent QoS settings throughout your organization, because any part of the path that fails to support your QoS priorities can degrade the quality of calls, video, and screen sharing.</span></span> <span data-ttu-id="db399-116">Сюда входят параметры применения параметров ко всем пользовательским ПК или устройствам, сетевым коммутаторам, маршрутизаторам в Интернете и службе Teams.</span><span class="sxs-lookup"><span data-stu-id="db399-116">This includes applying settings to all user PCs or devices, network switches, routers to the internet, and the Teams service.</span></span>

<span data-ttu-id="db399-117">_Рисунок 1. Связь между сетями Организации и Microsoft 365 или службами Office 365_</span><span class="sxs-lookup"><span data-stu-id="db399-117">_Figure 1. The relationship between an organization's networks and Microsoft 365 or Office 365 services_</span></span>

<span data-ttu-id="db399-118">![Схема связи между сетями и службами](media/Qos-in-Teams-Image1.png "Связь между сетями Организации и Microsoft 365 и службами Office 365: локальная сеть и устройства подключаются к сети Интернет-соединения, которая, в свою очередь, подключается к службе Microsoft 365 или Office 365 Cloud голосовой и видеоконференции.")</span><span class="sxs-lookup"><span data-stu-id="db399-118">![Illustration of the relationship between networks and services](media/Qos-in-Teams-Image1.png "The relationship between an organization's networks and Microsoft 365 or Office 365 services: on-premises network and devices connect with an interconnect network, which in turn connects with Microsoft 365 or Office 365 Cloud Voice and Audio Conferencing services.")</span></span>

## <a name="qos-implementation-checklist"></a><span data-ttu-id="db399-119">Контрольный список реализации QoS</span><span class="sxs-lookup"><span data-stu-id="db399-119">QoS implementation checklist</span></span>

<span data-ttu-id="db399-120">На высоком уровне выполните указанные ниже действия, чтобы реализовать QoS.</span><span class="sxs-lookup"><span data-stu-id="db399-120">At a high level, do the following to implement QoS:</span></span>

1. [<span data-ttu-id="db399-121">Убедитесь в том, что сеть готова</span><span class="sxs-lookup"><span data-stu-id="db399-121">Make sure your network is ready</span></span>](#make-sure-your-network-is-ready)

1. [<span data-ttu-id="db399-122">Выбор метода реализации QoS</span><span class="sxs-lookup"><span data-stu-id="db399-122">Select a QoS implementation method</span></span>](#select-a-qos-implementation-method)

1. [<span data-ttu-id="db399-123">Выберите начальные диапазоны портов для каждого типа мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="db399-123">Choose initial port ranges for each media type</span></span>](#choose-initial-port-ranges-for-each-media-type)

1. <span data-ttu-id="db399-124">Реализация параметров качества обслуживания:</span><span class="sxs-lookup"><span data-stu-id="db399-124">Implement QoS settings:</span></span>
   1. <span data-ttu-id="db399-125">На клиентах, использующих объект групповой политики, для [настройки диапазонов портов и пометки клиентских устройств](QoS-in-Teams-clients.md)</span><span class="sxs-lookup"><span data-stu-id="db399-125">On clients using a GPO to [set client device port ranges and markings](QoS-in-Teams-clients.md)</span></span>
   2. <span data-ttu-id="db399-126">На маршрутизаторах (ознакомьтесь с документацией производителя) или другими сетевыми устройствами.</span><span class="sxs-lookup"><span data-stu-id="db399-126">On routers (see the manufacturer documentation) or other network devices.</span></span> <span data-ttu-id="db399-127">Это может быть список ACL на основе порта или просто определение очередей QoS и пометки DSCP.</span><span class="sxs-lookup"><span data-stu-id="db399-127">This may include port-based ACLs or simply defining the QoS queues and DSCP markings, or all of these.</span></span>

      > [!IMPORTANT]
      > <span data-ttu-id="db399-128">Мы рекомендуем реализовать эти политики качества обслуживания с помощью исходных портов клиента и IP-адреса источника и назначения "Any".</span><span class="sxs-lookup"><span data-stu-id="db399-128">We recommend implementing these QoS policies using the client source ports and a source and destination IP address of “any.”</span></span> <span data-ttu-id="db399-129">Это будет перехватывать входящий и исходящий трафик мультимедиа во внутренней сети.</span><span class="sxs-lookup"><span data-stu-id="db399-129">This will catch both incoming and outgoing media traffic on the internal network.</span></span>  

   3. [<span data-ttu-id="db399-130">Настройка обработки трафика мультимедиа для собраний Teams</span><span class="sxs-lookup"><span data-stu-id="db399-130">Set how you want to handle media traffic for Teams meetings</span></span>](meeting-settings-in-teams.md#set-how-you-want-to-handle-real-time-media-traffic-for-teams-meetings)

5. <span data-ttu-id="db399-131">[Проверка реализации QoS](#validate-your-qos-implementation) путем анализа трафика Teams в сети.</span><span class="sxs-lookup"><span data-stu-id="db399-131">[Validate your QoS implementation](#validate-your-qos-implementation) by analyzing Teams traffic on the network.</span></span>

<span data-ttu-id="db399-132">По мере подготовки к реализации QoS следует учитывать следующие моменты.</span><span class="sxs-lookup"><span data-stu-id="db399-132">As you prepare to implement QoS, keep the following guidelines in mind:</span></span>

- <span data-ttu-id="db399-133">Наиболее короткий путь к Microsoft 365 является наилучшим вариантом</span><span class="sxs-lookup"><span data-stu-id="db399-133">The shortest path to Microsoft 365 is best</span></span>
- <span data-ttu-id="db399-134">Закрытие портов может привести к ухудшению качества</span><span class="sxs-lookup"><span data-stu-id="db399-134">Closing ports will only lead to quality degradation</span></span>
- <span data-ttu-id="db399-135">Не рекомендуется использовать любые препятствия (например, прокси-серверы).</span><span class="sxs-lookup"><span data-stu-id="db399-135">Any obstacles in between, such as proxies, aren't recommended</span></span>
- <span data-ttu-id="db399-136">Ограничьте число прыжков:</span><span class="sxs-lookup"><span data-stu-id="db399-136">Limit the number of hops:</span></span>
  - <span data-ttu-id="db399-137">Клиент в сети (от 3 до 5 переходов)</span><span class="sxs-lookup"><span data-stu-id="db399-137">Client to network edge – 3 to 5 hops</span></span>
  - <span data-ttu-id="db399-138">Поставщик услуг Интернета в Microsoft Network EDGE – 3 прыжка</span><span class="sxs-lookup"><span data-stu-id="db399-138">ISP to Microsoft network edge – 3 hops</span></span>
  - <span data-ttu-id="db399-139">Сеть Microsoft Network Edge с конечным расположением – нет значения</span><span class="sxs-lookup"><span data-stu-id="db399-139">Microsoft network edge to final destination – irrelevant</span></span>

<span data-ttu-id="db399-140">Сведения о настройке портов брандмауэра можно найти в [адресах URL Office 365 и диапазонах IP-](office-365-urls-ip-address-ranges.md)адресов.</span><span class="sxs-lookup"><span data-stu-id="db399-140">For information about configuring firewall ports, go to [Office 365 URLs and IP ranges](office-365-urls-ip-address-ranges.md).</span></span>


## <a name="make-sure-your-network-is-ready"></a><span data-ttu-id="db399-141">Убедитесь в том, что сеть готова</span><span class="sxs-lookup"><span data-stu-id="db399-141">Make sure your network is ready</span></span>

<span data-ttu-id="db399-142">Если вы просматриваете реализацию QoS, вы уже должны определить требования к пропускной способности и другие [сетевые требования](prepare-network.md).</span><span class="sxs-lookup"><span data-stu-id="db399-142">If you're considering a QoS implementation, you should already have determined your bandwidth requirements and other [network requirements](prepare-network.md).</span></span> 
  
<span data-ttu-id="db399-143">Перегрузка трафика в сети значительно повлияет на качество мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="db399-143">Traffic congestion across a network will greatly impact media quality.</span></span> <span data-ttu-id="db399-144">Недостаток пропускной способности приводит к снижению производительности и плохому взаимодействию с пользователем.</span><span class="sxs-lookup"><span data-stu-id="db399-144">A lack of bandwidth leads to performance degradation and a poor user experience.</span></span> <span data-ttu-id="db399-145">По мере роста и использования команд в команде следует использовать функцию создания отчетов, [аналитических вызовов пользователей](use-call-analytics-to-troubleshoot-poor-call-quality.md)и [панель мониторинга качества звонков (CQD)](turning-on-and-using-call-quality-dashboard.md) , чтобы выявить проблемы, а затем внести изменения с помощью QoS и выборочных дополнений к пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="db399-145">As Teams adoption and usage grows, use reporting, [per-user call analytics](use-call-analytics-to-troubleshoot-poor-call-quality.md), and [Call Quality Dashboard (CQD)](turning-on-and-using-call-quality-dashboard.md) to identify problems and then make adjustments using QoS and selective bandwidth additions.</span></span>

### <a name="vpn-considerations"></a><span data-ttu-id="db399-146">Общие сведения о VPN</span><span class="sxs-lookup"><span data-stu-id="db399-146">VPN considerations</span></span>

<span data-ttu-id="db399-147">Качество обслуживания QoS работает должным образом только при реализации всех связей между абонентами.</span><span class="sxs-lookup"><span data-stu-id="db399-147">QoS only works as expected when implemented on all links between callers.</span></span> <span data-ttu-id="db399-148">Если вы используете службу QoS во внутренней сети и пользователь входит в удаленное место, вы можете установить приоритет только в пределах внутренней управляемой сети.</span><span class="sxs-lookup"><span data-stu-id="db399-148">If you use QoS on an internal network and a user signs in from a remote location, you can only prioritize within your internal, managed network.</span></span> <span data-ttu-id="db399-149">Несмотря на то, что удаленные расположения могут принимать управляемое подключение, реализуя виртуальную частную сеть (VPN), VPN по сути добавляет служебные пакеты и создает задержку в трафике в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="db399-149">Although remote locations can receive a managed connection by implementing a virtual private network (VPN),  a VPN inherently adds packet overhead and creates delays in real-time traffic.</span></span> <span data-ttu-id="db399-150">Мы рекомендуем не использовать трафик для обмена данными в режиме реального времени через VPN.</span><span class="sxs-lookup"><span data-stu-id="db399-150">We  recommend that you avoid running real-time communications traffic over a VPN.</span></span>

<span data-ttu-id="db399-151">В глобальной Организации с управляемыми связями, охватывающими континенты, настоятельно рекомендуется использовать QoS, так как пропускная способность для этих ссылок ограничена сравнением с локальной сетью.</span><span class="sxs-lookup"><span data-stu-id="db399-151">In a global organization with managed links that span continents, we strongly recommend QoS because bandwidth for those links is limited in comparison to the LAN.</span></span>

## <a name="introduction-to-qos-queues"></a><span data-ttu-id="db399-152">Общие сведения об очередях QoS</span><span class="sxs-lookup"><span data-stu-id="db399-152">Introduction to QoS queues</span></span>

<span data-ttu-id="db399-153">Для обеспечения качества обслуживания сетевые устройства должны иметь способ классификации трафика и должны быть в состоянии отличать голосовую или видеосвязь от другого сетевого трафика.</span><span class="sxs-lookup"><span data-stu-id="db399-153">To provide QoS, network devices must have a way to classify traffic and must be able to distinguish voice or video from other network traffic.</span></span>

<span data-ttu-id="db399-154">Когда сетевой трафик входит в маршрутизатор, трафик помещается в очередь.</span><span class="sxs-lookup"><span data-stu-id="db399-154">When network traffic enters a router, the traffic is placed into a queue.</span></span> <span data-ttu-id="db399-155">Если политика качества обслуживания не настроена, то имеется только одна очередь, и все данные обрабатываются как first-in — первый из них с одинаковым приоритетом.</span><span class="sxs-lookup"><span data-stu-id="db399-155">If a QoS policy isn't configured, there is only one queue, and all data is treated as first-in, first-out with the same priority.</span></span> <span data-ttu-id="db399-156">Это означает, что голосовая связь (которая очень важна для задержек) может зависнуть за трафик, в течение которого задержка, связанная с несколькими дополнительными миллисекундами, не будет проблемой.</span><span class="sxs-lookup"><span data-stu-id="db399-156">That means voice traffic (which is very sensitive to delays) might get stuck behind traffic where a delay of a few extra milliseconds wouldn't be a problem.</span></span>

<span data-ttu-id="db399-157">При реализации QoS вы определяете несколько очередей с помощью одной из нескольких функций управления перегрузкой (например, очереди приоритетов Cisco и [взвешенной долевой очереди)](https://www.cisco.com/en/US/docs/ios/12_0t/12_0t5/feature/guide/cbwfq.html#wp17641), а также функций предотвращения перегрузки (например, [взвешенного случайного поиска ранней версии (WRED)](https://en.wikipedia.org/wiki/Weighted_random_early_detection)).</span><span class="sxs-lookup"><span data-stu-id="db399-157">When you implement QoS, you define multiple queues using one of several congestion management features (such as Cisco’s priority queuing and [Class-Based Weighted Fair Queueing (CBWFQ)](https://www.cisco.com/en/US/docs/ios/12_0t/12_0t5/feature/guide/cbwfq.html#wp17641)) and congestion avoidance features (such as [weighted random early detection (WRED)](https://en.wikipedia.org/wiki/Weighted_random_early_detection)).</span></span>

<span data-ttu-id="db399-158">_На рисунке 2. Примеры очередей QoS_</span><span class="sxs-lookup"><span data-stu-id="db399-158">_Figure 2. Examples of QoS queues_</span></span>

<span data-ttu-id="db399-159">![Изображение очередей QoS и разделение пропускной способности](media/Qos-in-Teams-Image2.png "Общая доступная пропускная способность делится между несколькими очередями, звуком, видео и другим трафиком, которым назначены разные приоритеты.")</span><span class="sxs-lookup"><span data-stu-id="db399-159">![Illustration of QoS queues and bandwidth division](media/Qos-in-Teams-Image2.png "Total available bandwidth is divided among multiple queues—audio, video, and other traffic—that have been assigned different priorities.")</span></span>

<span data-ttu-id="db399-160">Простым аналогом является то, что QoS создает виртуальную "carpoolные желобы" в сети данных, поэтому некоторые типы данных никогда или редко сталкиваются с задержкой.</span><span class="sxs-lookup"><span data-stu-id="db399-160">A simple analogy is that QoS creates virtual "carpool lanes" in your data network so some types of data never or rarely encounter a delay.</span></span> <span data-ttu-id="db399-161">Создав эти дорожки, вы можете изменить их относительный размер и значительно повысить эффективность управления пропускной способностью соединения, сохранив при этом возможности бизнес-задач для пользователей организации.</span><span class="sxs-lookup"><span data-stu-id="db399-161">Once you create those lanes, you can adjust their relative size and much more effectively manage the connection bandwidth you have, while still delivering business-grade experiences for your organization's users.</span></span>

## <a name="select-a-qos-implementation-method"></a><span data-ttu-id="db399-162">Выбор метода реализации QoS</span><span class="sxs-lookup"><span data-stu-id="db399-162">Select a QoS implementation method</span></span>

<span data-ttu-id="db399-163">Вы можете реализовать качество обслуживания с помощью тегов на основе порта, используя списки управления доступом (ACL) на маршрутизаторах вашей сети.</span><span class="sxs-lookup"><span data-stu-id="db399-163">You could implement QoS via port-based tagging, using Access Control Lists (ACLs) on your network's routers.</span></span> <span data-ttu-id="db399-164">Маркировка на основе порта является наиболее надежным способом, так как она работает в средах с Windows, Mac и Linux и проще в реализации.</span><span class="sxs-lookup"><span data-stu-id="db399-164">Port-based tagging is the most reliable method because it works in mixed Windows, Mac, and Linux environments and is the easiest to implement.</span></span> <span data-ttu-id="db399-165">Мобильные клиенты не предоставляют механизм для пометки трафика с помощью значений DSCP, поэтому им потребуется этот метод.</span><span class="sxs-lookup"><span data-stu-id="db399-165">Mobile clients don't provide a mechanism to mark traffic by using DSCP values, so they will require this method.</span></span>  

<span data-ttu-id="db399-166">С помощью тегов на основе порта маршрутизатор сети проверяет входящий пакет и, если он поступил на определенный порт или диапазон портов, он идентифицирует его как конкретный тип мультимедиа и помещает его в очередь для этого типа, добавляя предварительно определенную метку [DSCP](https://tools.ietf.org/html/rfc2474) к заголовку IP-пакета, чтобы другие устройства могли распознать тип трафика и присвоить ему приоритет в очереди.</span><span class="sxs-lookup"><span data-stu-id="db399-166">Using port-based tagging, your network's router examines an incoming packet, and if the packet arrived using a certain port or range of ports, it identifies it as a certain media type and puts it in the queue for that type, adding a predetermined [DSCP](https://tools.ietf.org/html/rfc2474) mark to the IP Packet header so other devices can recognize its traffic type and give it priority in their queue.</span></span>

<span data-ttu-id="db399-167">Несмотря на то, что она работает на разных платформах, она помечает трафик только в глобальной сети (не все возможности на клиентском компьютере) и создает дополнительные затраты на управление.</span><span class="sxs-lookup"><span data-stu-id="db399-167">Although this works across platforms, it only marks traffic at the WAN edge (not all the way to the client machine) and creates management overhead.</span></span> <span data-ttu-id="db399-168">Инструкции по реализации этого метода вы можете найти в документации, предоставленной изготовителем маршрутизатора.</span><span class="sxs-lookup"><span data-stu-id="db399-168">You should refer to the documentation provided by the router manufacturer for instructions on implementing this method.</span></span>

### <a name="insert-dscp-markers"></a><span data-ttu-id="db399-169">Вставка маркеров DSCP</span><span class="sxs-lookup"><span data-stu-id="db399-169">Insert DSCP markers</span></span>

<span data-ttu-id="db399-170">Кроме того, вы можете реализовать QoS с помощью объекта групповой политики (GPO), чтобы клиентские устройства могли вставить в заголовки IP-пакетов маркер DSCP, определяющий его как конкретный тип трафика (например, голосовую почту).</span><span class="sxs-lookup"><span data-stu-id="db399-170">You could also implement QoS by using a Group Policy Object (GPO) to direct client devices to insert a DSCP marker in IP packet headers identifying it as particular type of traffic (for example, voice).</span></span> <span data-ttu-id="db399-171">Маршрутизаторы и другие сетевые устройства можно настроить таким образом, чтобы они могли распознавать это и размещать трафик в отдельной очереди более приоритетных сообщений.</span><span class="sxs-lookup"><span data-stu-id="db399-171">Routers and other network devices can be configured to recognize this and put the traffic in a separate, higher-priority queue.</span></span>

<span data-ttu-id="db399-172">Несмотря на то, что этот сценарий полностью действителен, он будет работать только для клиентов Windows, присоединенных к домену.</span><span class="sxs-lookup"><span data-stu-id="db399-172">Although this scenario is entirely valid, it will only work for domain-joined Windows clients.</span></span> <span data-ttu-id="db399-173">Для любого устройства, которое не входит в состав домена, не нужно включать подстановку DSCP в клиенте Windows.</span><span class="sxs-lookup"><span data-stu-id="db399-173">Any device that isn't a domain-joined Windows client won't be enabled for DSCP tagging.</span></span> <span data-ttu-id="db399-174">Клиенты, такие как Mac OS, имеют жестко закодированные Теги и всегда заключают трафик в тег.</span><span class="sxs-lookup"><span data-stu-id="db399-174">Clients such as Mac OS have hard-coded tags and will always tag traffic.</span></span>

<span data-ttu-id="db399-175">На стороне плюс управление пометкой DSCP через GPO обеспечивает получение одинаковых параметров для всех компьютеров, присоединенных к домену, и управление ими разрешено только администратором.</span><span class="sxs-lookup"><span data-stu-id="db399-175">On the plus side, controlling the DSCP marking via GPO ensures that all domain-joined computers receive the same settings and that only an administrator can manage them.</span></span> <span data-ttu-id="db399-176">Клиенты, которые могут использовать объект групповой политики, будут помечены на исходном устройстве, а затем настроенные сетевые устройства смогут распознавать поток реального времени с помощью кода DSCP и присвоить ему подходящий приоритет.</span><span class="sxs-lookup"><span data-stu-id="db399-176">Clients that can use GPO will be tagged on the originating device, and then configured network devices can recognize the real-time stream by the DSCP code and give it an appropriate priority.</span></span>

### <a name="best-practice"></a><span data-ttu-id="db399-177">Практические рекомендации</span><span class="sxs-lookup"><span data-stu-id="db399-177">Best practice</span></span>

<span data-ttu-id="db399-178">Мы рекомендуем использовать сочетание DSCP для конечной точки и ACL на основе порта на маршрутизаторах, если это возможно.</span><span class="sxs-lookup"><span data-stu-id="db399-178">We recommend a combination of DSCP markings at the endpoint and port-based ACLs on routers, if possible.</span></span> <span data-ttu-id="db399-179">С помощью объекта групповой политики для перехвата большинства клиентов, а также с помощью разметки DSCP на основе порта, вы будете гарантировать, что мобильные, Mac-и другие клиенты будут получать обработку QoS (хотя бы частично).</span><span class="sxs-lookup"><span data-stu-id="db399-179">Using a Group Policy object to catch the majority of clients, and also using port-based DSCP tagging will ensure that mobile, Mac, and other clients will still get QoS treatment (at least partially).</span></span>

<span data-ttu-id="db399-180">Маркировка DSCP может быть likenedа для почтового штампа, указывающего на почтовые работники, как срочно доставляться и как лучше отсортировать ее для ускорения доставки.</span><span class="sxs-lookup"><span data-stu-id="db399-180">DSCP markings can be likened to postage stamps that indicate to postal workers how urgent the delivery is and how best to sort it for speedy delivery.</span></span> <span data-ttu-id="db399-181">После настройки сети для предоставления приоритетов для потоков мультимедиа в реальном времени потерянные и просроченные пакеты должны значительно уменьшиться.</span><span class="sxs-lookup"><span data-stu-id="db399-181">Once you've configured your network to give priority to real-time media streams, lost packets and late packets should diminish greatly.</span></span>

<span data-ttu-id="db399-182">После того как все устройства в сети будут использовать одну и ту же классификацию, маркировку и приоритеты, можно уменьшить или устранить задержки, отброшенные пакеты и колебание, изменив размер диапазонов портов, назначенных очередям, используемым для каждого типа трафика.</span><span class="sxs-lookup"><span data-stu-id="db399-182">Once all devices in the network are using the same classifications, markings, and priorities, it's possible to reduce or eliminate delays, dropped packets, and jitter by changing the size of the port ranges assigned to the queues used for each traffic type.</span></span> <span data-ttu-id="db399-183">С точки зрения рабочих групп, наиболее важной частью конфигурации является классификация и пометка пакетов, но для успешного завершения QoS необходимо также тщательно согласовать конфигурацию приложения с базовой конфигурацией сети.</span><span class="sxs-lookup"><span data-stu-id="db399-183">From the Teams perspective, the most important configuration step is the classification and marking of packets, but for end-to-end QoS to be successful you also need to carefully align the application's configuration with the underlying network configuration.</span></span> <span data-ttu-id="db399-184">После того как качество обслуживания полностью реализовано, текущее управление является вопросом настройки диапазонов портов, назначаемых каждому типу трафика, в зависимости от потребностей Организации и фактического использования.</span><span class="sxs-lookup"><span data-stu-id="db399-184">Once QoS is fully implemented, ongoing management is a question of adjusting the port ranges assigned to each traffic type based on your organization's needs and actual usage.</span></span>

## <a name="choose-initial-port-ranges-for-each-media-type"></a><span data-ttu-id="db399-185">Выберите начальные диапазоны портов для каждого типа мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="db399-185">Choose initial port ranges for each media type</span></span>

<span data-ttu-id="db399-186">Значение DSCP указывает в соответствующей конфигурации сеть, приоритет которой следует предоставить пакету или потоку, определяет назначение метки DSCP клиентами или самой сетью на основе параметров ACL.</span><span class="sxs-lookup"><span data-stu-id="db399-186">The DSCP value tells a correspondingly configured network what priority to give a packet or stream, whether the DSCP mark is assigned by clients or the network itself based on ACL settings.</span></span> <span data-ttu-id="db399-187">Каждая рабочая нагрузка получает собственное уникальное значение DSCP (другие службы могут разрешать рабочим нагрузкам предоставлять доступ к разметке DSCP, Teams — нет) и определенному и отдельному диапазону портов, используемому для каждого типа мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="db399-187">Each media workload gets its own unique DSCP value (other services might allow workloads to share a DSCP marking, Teams does not) and a defined and separate port range used for each media type.</span></span> <span data-ttu-id="db399-188">Другие среды могут иметь существующую стратегию QoS, что поможет вам определить приоритет рабочих нагрузок в сети.</span><span class="sxs-lookup"><span data-stu-id="db399-188">Other environments might have an existing QoS strategy in place, which will help you determine the priority of network workloads.</span></span>

<span data-ttu-id="db399-189">Относительный размер диапазонов портов для разных рабочих нагрузок в реальном времени задает долю общей доступной пропускной способности, выделенной для этой рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="db399-189">The relative size of the port ranges for different real-time streaming workloads sets the proportion of the total available bandwidth dedicated to that workload.</span></span> <span data-ttu-id="db399-190">Чтобы вернуться к предыдущей почтовой корреспонденции: письмо с меткой "Air Mail" может поступить в течение часа до ближайшего аэропорта, а небольшой пакет, помеченный меткой "массовая почта", может подождать, пока он не попадет на серию грузовиков.</span><span class="sxs-lookup"><span data-stu-id="db399-190">To return to our earlier postal analogy: a letter with an "Air Mail" stamp might get taken within an hour to the nearest airport, while a small package marked "Bulk Mail" mark can wait for a day before traveling over land on a series of trucks.</span></span>

<span data-ttu-id="db399-191">_Рекомендуемые начальные диапазоны портов_</span><span class="sxs-lookup"><span data-stu-id="db399-191">_Recommended initial port ranges_</span></span>

|<span data-ttu-id="db399-192">Тип медиатрафика</span><span class="sxs-lookup"><span data-stu-id="db399-192">Media traffic type</span></span>| <span data-ttu-id="db399-193">Диапазон портов источника клиента </span><span class="sxs-lookup"><span data-stu-id="db399-193">Client source port range</span></span> |<span data-ttu-id="db399-194">Протокол</span><span class="sxs-lookup"><span data-stu-id="db399-194">Protocol</span></span>|<span data-ttu-id="db399-195">Значение DSCP</span><span class="sxs-lookup"><span data-stu-id="db399-195">DSCP value</span></span>|<span data-ttu-id="db399-196">Класс DSCP</span><span class="sxs-lookup"><span data-stu-id="db399-196">DSCP class</span></span>|
|:--- |:--- |:--- |:--- |:--- |
|<span data-ttu-id="db399-197">Звук</span><span class="sxs-lookup"><span data-stu-id="db399-197">Audio</span></span>| <span data-ttu-id="db399-198">50,000–50,019</span><span class="sxs-lookup"><span data-stu-id="db399-198">50,000–50,019</span></span>|<span data-ttu-id="db399-199">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="db399-199">TCP/UDP</span></span>|<span data-ttu-id="db399-200">46</span><span class="sxs-lookup"><span data-stu-id="db399-200">46</span></span>|<span data-ttu-id="db399-201">Беспрепятственная переадресация (EF)</span><span class="sxs-lookup"><span data-stu-id="db399-201">Expedited Forwarding (EF)</span></span>|
|<span data-ttu-id="db399-202">Видео</span><span class="sxs-lookup"><span data-stu-id="db399-202">Video</span></span>| <span data-ttu-id="db399-203">50,020–50,039</span><span class="sxs-lookup"><span data-stu-id="db399-203">50,020–50,039</span></span>|<span data-ttu-id="db399-204">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="db399-204">TCP/UDP</span></span>|<span data-ttu-id="db399-205">34</span><span class="sxs-lookup"><span data-stu-id="db399-205">34</span></span>|<span data-ttu-id="db399-206">Гарантированная переадресация (AF41)</span><span class="sxs-lookup"><span data-stu-id="db399-206">Assured Forwarding (AF41)</span></span>|
|<span data-ttu-id="db399-207">Приложение / Разделение экрана</span><span class="sxs-lookup"><span data-stu-id="db399-207">Application/Screen Sharing</span></span>| <span data-ttu-id="db399-208">50,040–50,059</span><span class="sxs-lookup"><span data-stu-id="db399-208">50,040–50,059</span></span>|<span data-ttu-id="db399-209">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="db399-209">TCP/UDP</span></span>|<span data-ttu-id="db399-210">18</span><span class="sxs-lookup"><span data-stu-id="db399-210">18</span></span>|<span data-ttu-id="db399-211">Гарантированная пересылка (AF21)</span><span class="sxs-lookup"><span data-stu-id="db399-211">Assured Forwarding (AF21)</span></span>|
||||||

<span data-ttu-id="db399-212">При использовании этих параметров имейте в виду следующее:</span><span class="sxs-lookup"><span data-stu-id="db399-212">Be aware of the following when you use these settings:</span></span>

- <span data-ttu-id="db399-213">Если вы планируете реализовать ExpressRoute в будущем, но еще не реализовали QoS, мы рекомендуем следовать рекомендациям, чтобы значения DSCP были теми же, что и у отправителя и получателя.</span><span class="sxs-lookup"><span data-stu-id="db399-213">If you plan to implement ExpressRoute in the future and haven't yet implemented QoS, we recommend that you follow the guidance so that DSCP values are the same from sender to receiver.</span></span>
- <span data-ttu-id="db399-214">Все клиенты, в том числе мобильные клиенты и устройства с рабочими группами, будут использовать эти диапазоны портов и будут зависеть от того, какая политика DSCP реализуется с использованием этих диапазонов исходного порта.</span><span class="sxs-lookup"><span data-stu-id="db399-214">All clients, including mobile clients and Teams devices, will use these port ranges and will be affected by any DSCP policy you implement that uses these source port ranges.</span></span> <span data-ttu-id="db399-215">Клиенты, которые будут продолжать использовать динамические порты, — это клиенты на базе браузера (то есть клиенты, которые позволяют участникам присоединяться к собраниям с помощью браузеров).</span><span class="sxs-lookup"><span data-stu-id="db399-215">The only clients that will continue to use dynamic ports are the browser-based clients (that is, those clients that let participants join meetings by using their browsers).</span></span>
- <span data-ttu-id="db399-216">Несмотря на то, что клиент Mac использует один и тот же диапазон портов, он также использует жестко закодированные значения для аудиоподсистемы (EF) и Video (AF41).</span><span class="sxs-lookup"><span data-stu-id="db399-216">Although the Mac client uses the same port ranges, it also uses hard-coded values for audio (EF) and video (AF41).</span></span> <span data-ttu-id="db399-217">Эти значения нельзя настраивать.</span><span class="sxs-lookup"><span data-stu-id="db399-217">These values are not configurable.</span></span>
- <span data-ttu-id="db399-218">Если позже вам потребуется настроить диапазоны портов для улучшения взаимодействия с пользователем, диапазоны портов не могут перекрываться и должны находиться рядом друг с другом.</span><span class="sxs-lookup"><span data-stu-id="db399-218">If you later need to adjust the port ranges to improve user experience, the port ranges can not overlap and should be adjacent to each other.</span></span>

## <a name="migrate-qos-to-teams"></a><span data-ttu-id="db399-219">Миграция QoS в Teams</span><span class="sxs-lookup"><span data-stu-id="db399-219">Migrate QoS to Teams</span></span>

<span data-ttu-id="db399-220">Если вы ранее развернули Skype для бизнеса Online, в том числе разметку QoS и диапазоны портов, а теперь разворачиваете группы, Teams будет учитывать текущую конфигурацию и использовать те же диапазоны портов и разметку, что и в клиенте Skype для бизнеса.</span><span class="sxs-lookup"><span data-stu-id="db399-220">If you've previously deployed Skype for Business Online, including QoS tagging and port ranges, and are now deploying Teams, Teams will respect the existing configuration and will use the same port ranges and tagging as the Skype for Business client.</span></span> <span data-ttu-id="db399-221">В большинстве случаев дополнительные настройки не требуются.</span><span class="sxs-lookup"><span data-stu-id="db399-221">In most cases, no additional configuration will be needed.</span></span>

> [!NOTE]
> <span data-ttu-id="db399-222">Если вы используете Теги QoS с именем приложения с помощью групповой политики, необходимо добавить Teams.exe в качестве имени приложения.</span><span class="sxs-lookup"><span data-stu-id="db399-222">If you're using Application Name QoS tagging via Group Policy, you must add Teams.exe as the application name.</span></span>


## <a name="managing-source-ports-in-the-teams-admin-center"></a><span data-ttu-id="db399-223">Управление портами источников в центре администрирования Teams</span><span class="sxs-lookup"><span data-stu-id="db399-223">Managing source ports in the Teams admin center</span></span>

<span data-ttu-id="db399-224">В Teams исходные порты QoS, используемые в различных рабочих нагрузках, должны быть активно управляемыми и скорректированы по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="db399-224">In Teams, QoS source ports used by the different workloads should be actively managed, and adjusted as necessary.</span></span> <span data-ttu-id="db399-225">При обращении к таблице в разделе [Выбор начальных диапазонов портов для каждого типа мультимедийного](#choose-initial-port-ranges-for-each-media-type)диапазона диапазоны портов изменяются, но маркировка DSCP не настраивается.</span><span class="sxs-lookup"><span data-stu-id="db399-225">Referring to the table in [Choose initial port ranges for each media type](#choose-initial-port-ranges-for-each-media-type), the port ranges are adjustable, but the DSCP markings are not configurable.</span></span> <span data-ttu-id="db399-226">После того как вы реализовали эти параметры, вы можете обнаружить, что требуется больше или меньше портов для определенного типа мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="db399-226">Once you have implemented these settings, you may find that more or fewer ports are needed for a given media type.</span></span> <span data-ttu-id="db399-227">Для настройки диапазонов портов после реализации Teams и периодического изменения в случае необходимости можно использовать панель мониторинга [звонков для каждого пользователя](use-call-analytics-to-troubleshoot-poor-call-quality.md) и средства [контроля качества звонков (CQD)](turning-on-and-using-call-quality-dashboard.md) .</span><span class="sxs-lookup"><span data-stu-id="db399-227">[Per-user call analytics](use-call-analytics-to-troubleshoot-poor-call-quality.md) and [Call Quality Dashboard (CQD)](turning-on-and-using-call-quality-dashboard.md) should be used in making a decision to adjust port ranges after Teams has been implemented, and periodically as needs change.</span></span>

> [!NOTE]
> <span data-ttu-id="db399-228">Если вы уже настроили качество обслуживания на основе диапазонов исходного порта и меток DSCP для Skype для бизнеса Online, то эта же конфигурация будет применяться к группам, и дальнейшие изменения, внесенные в клиентские или сетевые параметры сопоставления, будут обязательными, но вам может понадобиться [задать диапазоны, используемые в Teams](meeting-settings-in-teams.md#set-how-you-want-to-handle-real-time-media-traffic-for-teams-meetings) в соответствии с настройками Skype для бизнеса Online.</span><span class="sxs-lookup"><span data-stu-id="db399-228">If you've already configured QoS based on source port ranges and DSCP markings for Skype for Business Online, the same configuration will apply to Teams and no further client or network changes to the mapping will be required, though you may have to [set the ranges used in Teams](meeting-settings-in-teams.md#set-how-you-want-to-handle-real-time-media-traffic-for-teams-meetings) to match what was configured for Skype for Business Online.</span></span>

<span data-ttu-id="db399-229">Если вы ранее развернули локальную версию Skype для бизнеса Server, вам может потребоваться повторно изучить политики QoS и настроить их так, чтобы они соответствовали параметрам диапазонов портов, которые вы проверили, чтобы обеспечить качество работы пользователей.</span><span class="sxs-lookup"><span data-stu-id="db399-229">If you’ve previously deployed Skype for Business Server on-premises, you may need to re-examine your QoS policies and adjust them to match port range settings you've verified provide a quality user experience for Teams.</span></span>

## <a name="validate-your-qos-implementation"></a><span data-ttu-id="db399-230">Проверка реализации QoS</span><span class="sxs-lookup"><span data-stu-id="db399-230">Validate your QoS implementation</span></span>

<span data-ttu-id="db399-231">Для обеспечения эффективности QoS значение DSCP, заданное объектом групповой политики, должно быть представлено на обоих концах вызова.</span><span class="sxs-lookup"><span data-stu-id="db399-231">For QoS to be effective, the DSCP value set by the Group Policy object needs to be present at both ends of a call.</span></span> <span data-ttu-id="db399-232">Проанализировав трафик, сформированный клиентом Teams, вы можете проверить, что значение DSCP не изменилось или выброшено, когда трафик рабочей нагрузки Teams перемещается по сети.</span><span class="sxs-lookup"><span data-stu-id="db399-232">By analyzing the traffic generated by the Teams client, you can verify that the DSCP value isn’t changed or stripped out when the Teams workload traffic moves through the network.</span></span>

<span data-ttu-id="db399-233">Лучше всего захватывать трафик в точке выхода сети.</span><span class="sxs-lookup"><span data-stu-id="db399-233">Preferably, you capture traffic at the network egress point.</span></span> <span data-ttu-id="db399-234">С помощью зеркального отображения порта на коммутаторе или маршрутизаторе вы можете помочь.</span><span class="sxs-lookup"><span data-stu-id="db399-234">You can use port mirroring on a switch or router to help with this.</span></span>


## <a name="related-topics"></a><span data-ttu-id="db399-235">Связанные статьи</span><span class="sxs-lookup"><span data-stu-id="db399-235">Related topics</span></span>

[<span data-ttu-id="db399-236">Видео: планирование сети</span><span class="sxs-lookup"><span data-stu-id="db399-236">Video: Network Planning</span></span>](https://aka.ms/teams-networking)

[<span data-ttu-id="db399-237">Подготовка сети организации к использованию Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="db399-237">Prepare your organization's network for Microsoft Teams</span></span>](prepare-network.md)

[<span data-ttu-id="db399-238">Реализация QoS в клиенте Teams</span><span class="sxs-lookup"><span data-stu-id="db399-238">Implement QoS in the Teams client</span></span>](QoS-in-Teams-clients.md)
