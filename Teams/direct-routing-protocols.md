---
title: Прямая маршрутизация телефонной системы
author: CarolynRowe
ms.author: crowe
manager: serdars
ms.date: 12/16/2019
ms.topic: article
ms.service: msteams
audience: admin
ms.collection:
- Teams_ITAdmin_Help
- M365-voice
ms.reviewer: nmurav
search.appverid: MET150
f1.keywords:
- NOCSH
description: Протоколы прямой маршрутизации
appliesto:
- Microsoft Teams
ms.openlocfilehash: 7462822626b698f95b80a716a55f94dfe92148ff
ms.sourcegitcommit: ed3d7ebb193229cab9e0e5be3dc1c28c3f622c1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2020
ms.locfileid: "41835029"
---
# <a name="direct-routing---definitions-and-rfc-standards"></a>Прямые маршруты — определения и стандарты RFC

В этой статье объясняется, как в Microsoft Direct Routing System реализовано использование стандартных протоколов RFC. Эта статья предназначена для администраторов голосовой связи, которые отвечают за настройку соединения между локальным контроллером границ сеанса (SBC) и прокси-службой протокола запуска сеансов (SIP).

SBC клиента интерфейсов со следующими компонентами в серверной части Microsoft teams: 

- **Прокси-сервер SIP** для сигнализации. Это Интернет-компонент прямой маршрутизации, который обрабатывает соединения SIP (TLS) между SBCs и прямой маршрутизацией.

- Мультимедийные **процессоры** . Это Интернет-компонент прямой маршрутизации, который обрабатывает трафик мультимедиа. Этот компонент использует протоколы SRTP и SRTCP.


Дополнительные сведения о прямой маршрутизации можно найти в разделе прямая маршрутизация [телефонной системы](direct-routing-landing-page.md).

Дополнительные сведения о том, как прямая маршрутизация реализует протокол SIP, можно найти по [протоколу Direct Routing-SIP](direct-routing-protocols-sip.md).

## <a name="rfc-standards"></a>Стандарты RFC

Прямая маршрутизация соответствует стандартам RFC.  SBC, подключенный к прямой маршрутизации, также должен соответствовать следующим документам RFC (или их последователей). 

### <a name="standards-applicable-to-devices-that-support-non-media-bypass-mode"></a>Стандарты, применимые к устройствам, которые поддерживают режим обхода не мультимедиа 

Следующие стандарты применимы к устройствам, которые поддерживают только режим обхода не мультимедиа:

- [RFC 3261 SIP](https://tools.ietf.org/html/rfc3261): протокол запуска сеанса
- [RFC 3325](https://www.ietf.org/rfc/rfc3325). Личное расширение протокола инициирования сеанса для утвержденных удостоверений в доверенных сетях — разделы об обработке заголовков P-Assert-Identity. Прямая маршрутизация отправляет P-утвержденные идентификационные данные с ИДЕНТИФИКАЦИОНными заголовками. 
- [RFC 4244](https://www.ietf.org/rfc/rfc4244.txt) Расширение протокола SIP для необходимых сведений о журнале. Дополнительные сведения можно найти в описании протокола SIP "Маршрутизация".
- [RFC 3892](https://www.ietf.org/rfc/rfc3892.txt) Механизм запуска сеанса, на который ссылается протокол
- [RFC 3891](https://www.ietf.org/rfc/rfc3891.txt) Заголовок "заменяет протоколом запуска сеансов (SIP)" 
- [RFC 6337](https://tools.ietf.org/html/rfc6337) Использование протокола SIP для модели предложения и ответа.
  Ознакомьтесь с разделом "отклонение от RFC".
- [Rfc 3711](https://tools.ietf.org/html/rfc3711) и [RFC 4771](https://tools.ietf.org/html/rfc4771). Защитите трафик RTP с помощью SRTP. SBC должен иметь возможность устанавливать клавиши с помощью SDES. 
- [RFC 8035](https://www.ietf.org/rfc/rfc8035.txt) Уточнение и ответные сведения о протоколе описания сеансов (SDP) для мультиплексирования RTP/RTCP

### <a name="standards-applicable-to-devices-that-support-media-bypass-mode"></a>Стандарты, применимые к устройствам, которые поддерживают режим обхода мультимедиа

В дополнение к стандартам, перечисленным в режиме без обхода, для режима обхода мультимедиа используются следующие стандарты:

- [RFC 5245 (ICE) для пропуска мультимедийного](https://tools.ietf.org/html/rfc5245)взаимодействия.  SBC должен поддерживать следующие возможности:
  - ICE Lite — клиенты Teams являются полноценными клиентами ICE
  - [Перезапускам Ice](https://tools.ietf.org/html/rfc5245#section-9.1.1.1). Дополнительные сведения о возможностях повторного запуска ICE: функция "использовать вариант" и примеры в разделе "перезагрузка". вызов обхода мультимедиа переключен на конечную точку, не поддерживающую обход мультимедиа   
- [Управление вызовами по протоколу SIP rfc 5589 – передача](https://tools.ietf.org/html/rfc5589). 
- [RFC 3960 Early Media и Звонок в протоколе SIP](https://tools.ietf.org/html/rfc3960)— разделы 3,1, разветвления и 3,2, создание звукового звонка 
- [Служебные программы обхода сеанса RFC 5389 для NAT (STUN)](https://tools.ietf.org/html/rfc5389)
- [Обходные номера для RFC 5766 с помощью ретрансляций в NAT (включение): ретрансляция расширений в служебные программы обхода сеансов для NAT (STUN)](https://tools.ietf.org/html/rfc5766)

### <a name="standards-applicable-to-support-conveying-location-information-to-e911-providers"></a>Стандарты, применимые для поддержки передачи сведений о расположении поставщикам услуг E911

- [RFC 6442, передача местоположений для протокола инициирования сеанса](https://tools.ietf.org/html/rfc6442)

### <a name="deviations-from-the-rfcs"></a>Отклонения от RFC

В приведенной ниже таблице перечислены разделы документов RFC, в которых реализация модуля SIP или мультимедийного стека корпорацией Майкрософт отличается от стандарта.

| RFC и разделы | Описание | Отклонение |
| :---------------------  |:---------------------- |:-----------------------|
| [RFC 6337, раздел 5,3 Хранение и возобновление мультимедиа](https://tools.ietf.org/html/rfc6337#section-5.3) | RFC допускает использование "a = неактивен", "a = sendonly", a = recvonly "для помещения звонка на удержание. |Прокси-сервер SIP поддерживает только "a = неактивен" и не понимает, отправляет ли SBC "a = sendonly" или "a = recvonly".
| [RFC 6337, раздел 5,4 "поведение при получении SDP с помощью c = 0.0.0.0](https://tools.ietf.org/html/rfc6337#section-5.4) | [RFC3264](https://tools.ietf.org/html/rfc3264) требует, чтобы агент получал SDP с адресом соединения 0.0.0.0, в этом случае это означает, что одноранговый канал и RTCP не должны отправляться. | Прокси-сервер SIP не поддерживает этот параметр. |

## <a name="operational-modes"></a>Рабочие режимы

Существует два рабочих режима прямой маршрутизации.

- **Без пропуска мультимедиа** , в котором весь трафик RTP проходит между клиентом Teams, мультимедийными процессорами и SBC.  

- **С пропуском мультимедийного содержимого** , в котором все RTP проходит между конечными точками группы и SBC. 

Обратите внимание, что трафик SIP всегда проходит через прокси-сервер SIP.   
