---
title: Установка соединителя Power BI для использования шаблонов запросов CQD
author: CarolynRowe
ms.author: crowe
manager: serdars
ms.reviewer: siunies
ms.topic: article
ms.tgt.pltfrm: cloud
ms.service: msteams
ms.collection:
- M365-voice
search.appverid: MET150
audience: Admin
appliesto:
- Microsoft Teams
ms.localizationpriority: medium
description: Установка соединителя Power BI для использования шаблонов запросов панели мониторинга качества вызовов (CQD)
ms.openlocfilehash: 80d1b39c6fbe26f04998b06b22fb527b60bbb6a0
ms.sourcegitcommit: 0dda332951df3b946097d90a4923eb191fd86b4c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/14/2022
ms.locfileid: "66789874"
---
# <a name="install-microsoft-call-quality-connector-for-power-bi-to-use-call-quality-dashboard-query-templates"></a>Установка соединителя Microsoft Call Quality для Power BI для использования шаблонов запросов панели мониторинга качества звонков

Прежде чем использовать шаблоны запросов Power BI (PBIX-файлы) для панели мониторинга качества звонков (CQD) Microsoft Teams, необходимо установить соединитель Microsoft Call Quality для Power BI с помощью файла *MicrosoftCallQuality.pqx*, включенного в скачивание [.](https://github.com/MicrosoftDocs/OfficeDocs-SkypeForBusiness/blob/live/Teams/downloads/CQD-Power-BI-query-templates.zip?raw=true)

[Дополнительные сведения об этих шаблонах](CQD-Power-BI-query-templates.md) см. в статье "Использование Power BI для анализа данных CQD для Teams".

Убедитесь, что у вас есть права [доступа к CQD](./turning-on-and-using-call-quality-dashboard.md#assign-admin-roles-for-access-to-cqd) для доступа к отчетам Power BI.

> [!NOTE]
> Соединитель Microsoft Call Quality поддерживает только DirectQuery в Power BI. Режим импорта не поддерживается. 

## <a name="installation"></a>Установка

Процесс установки пользовательского соединителя и настройки безопасности для включения использования соединителя подробно описан в [документации Power BI](/power-bi/desktop-connector-extensibility). Для простоты ознакомьтесь с кратким объяснением:

1. Проверьте, есть ли на компьютере *\[папка Documents\]\\ Power BI Desktop\\ Custom Connectors*. В противном случае создайте эту папку. <sup>1</sup>

2. Скачайте файл соединителя ( *\*MEZ-файл* *\*или PQX-файл* ) и поместите его в каталог *Пользовательских соединителей* .

3. **Если файл соединителя *\*является MEZ-файлом* ,** необходимо также настроить параметры безопасности, как описано в документации по настройке настраиваемого [соединителя](/power-bi/desktop-connector-extensibility#data-extension-security).

Если выпущена новая версия соединителя Microsoft Call Quality, замените старый файл соединителя в каталоге пользовательских соединителей новым файлом.

## <a name="setup"></a>Установка

Чтобы создать отчет и выполнить запросы, сначала необходимо подключиться к источнику данных CQD. Чтобы подключиться, выполните следующие действия.

1. На вкладке "Главная" Power BI Desktop нажмите кнопку "*Получить данные"*.

    ![Получение данных в соединителе Power BI.](media/CQD-power-bi-connector1-resize.png)

2. На *этом этапе* должно появиться окно "Получение данных". Перейдите *к веб-службам*, выберите *Microsoft Call Quality (Бета-версия)* и нажмите *кнопку "Подключиться"*.

    ![Качество звонков Майкрософт в соединителе Power BI.](media/CQD-power-bi-connector2-resize.png)

3. Вам будет предложено выполнить вход далее. Используйте те же учетные данные, что и для панели мониторинга качества звонков. <sup>2</sup>

4. Следующий запрос предоставит вам возможность между двумя режимами *подключения к данным*. Выберите *DirectQuery и* нажмите кнопку *"ОК"*.

5. Наконец, появится окончательный запрос, показывающий всю модель данных для панели мониторинга качества звонков. На этом этапе данные не будут видны, только модель данных для CQD. Выберите *"Загрузить* ", чтобы завершить процесс установки.

6. На этом этапе Power BI загрузит модель данных в правой части окна. В противном случае страница останется пустой, и запросы не будут загружены по умолчанию. Чтобы создать **запрос** и вернуть данные, перейдите к приведенной ниже статье.

Если какие-либо из действий в процессе установки не были понятны, более подробное описание этого процесса можно найти в кратком руководстве [по](/power-bi/desktop-quickstart-connect-to-data) подключению к данным в Power BI Desktop.

## <a name="building-queries"></a>Создание запросов

После завершения настройки на панели "Поля" должны появиться имена нескольких сотен измерений и мер. Создавать фактические запросы здесь очень просто. Просто выберите нужные измерения и меры для запроса, а затем перетащите их на страницу. Ниже приведено более подробное описание с простым примером:

1. Выберите визуализацию, которую вы хотите *использовать, на* панели "Визуализации". На странице должна появиться пустая версия этой визуализации. В этом примере мы будем *использовать визуализацию* таблицы.

    ![Область "Визуализации" в соединителе Power BI.](media/CQD-power-bi-connector3-resize.png)

2. Определите, какие измерения и меры (обозначаемые символом агрегирования по их имени) вы хотите использовать для запроса, а затем вручную выберите их и перетащите на черную визуализацию. Кроме того, перетащите их в поле *"Значения* " под вариантами визуализации.

    ! Запрос визуализаций в соединителе Power BI.] (media/CQD-power-bi-connector4-resize2.png)

    > [!IMPORTANT]
    > Панель мониторинга качества звонков требует меры для выполнения любого запроса. Если не добавить меру в запрос, запрос завершится ошибкой.

3. Затем выберите все измерения, по которым нужно выполнить фильтрацию, и перетащите  их в фильтры в этом визуальном поле на панели *"* Фильтры". Соединитель Качества звонков (Майкрософт) в настоящее время поддерживает базовую  фильтрацию *(выбор* значений из списка возможных значений *измерений*), расширенную фильтрацию (вручную укажите значения и операнды для фильтрации, аналогично панели мониторинга качества вызовов) и относительную фильтрацию  *дат (доступна* только для измерений времени окончания и начала). Фильтрация по верхнему *N* не поддерживается панелью мониторинга качества звонков.

    ![Фильтры визуализаций в соединителе Power BI.](media/CQD-power-bi-connector5-resize.png)

    > [!IMPORTANT]
    > Фильтры поддерживаются только при применении к измерениям. Фильтрация по значениям измерений не поддерживается на панели мониторинга качества звонков.

4. Наконец, выберите *вкладку "Формат* " на панели *"* Визуализации", чтобы создать стиль и отформатировать запрос.

    > [!NOTE]
    > Для выполнения запросов панели мониторинга качества вызовов требуется по крайней мере одна мера. Если запрос не загружается, проверьте, включена ли мера в запрос.

## <a name="creating-a-drillthrough-report"></a>Создание детализированного отчета

[Детализация в Power BI](/power-bi/desktop-drillthrough) позволяет создавать отсортированные отчеты, которые можно быстро отфильтровать, используя значения других отчетов в качестве контекста. Когда вы узнаете, как создать первый запрос с помощью соединителя Microsoft Call Quality, детализация будет еще проще.

1. Создайте еще одну страницу для отсортированных отчетов, а затем добавьте запросы на эту страницу.

2. Выберите измерение, которое вы хотите использовать в качестве фильтра детализации, и перетащите его в поле *детализации* в области " *Визуализации* ".

    ![Детализация в соединителе Power BI.](media/CQD-power-bi-connector6-resize.png)

3. **Ну вот\!** Любой другой запрос на другой странице, использующей это измерение, теперь может выполнять детализацию до этой страницы, автоматически применяя значение детализированного измерения в качестве фильтра.

    ![Фильтр детализации в соединителе Power BI.](media/CQD-power-bi-connector7-resize.png)

В отличие от панели мониторинга качества звонков, Power BI поддерживает неконтейентную детализацию. Если запрос содержит необходимое измерение, он может выполнить детализацию до любой другой страницы.

### <a name="best-practice"></a>Рекомендации

Запросы соединителя Microsoft Call Quality должны быть разработаны с учетом функций детализации. Вместо того чтобы пытаться загрузить все данные одновременно, а затем выполнить срез с помощью фильтров, начните с более широких запросов с низкой кратностью и выполните детализацию до запросов с высокой кратностью. Например, при попытке диагностировать, какие подсети больше всего влияют на проблемы с качеством, полезно сначала определить регионы и страны, которые влияют на проблему, а затем перейти к подсетям в этом регионе или стране. Шаблоны соединителя качества звонков были разработаны таким образом, чтобы действовать в качестве примера.

## <a name="limitations"></a>Ограничения

Несмотря на использование Power BI, не все функции Power BI поддерживаются соединителем Microsoft Call Quality из-за ограничений модели данных панели мониторинга качества звонков или соединителей DirectQuery в целом. В приведенном ниже списке перечислены некоторые из наиболее важных ограничений соединителя, но этот список не следует считать исчерпывающим:

1. **Вычисляемые столбцы —** Соединители DirectQuery в целом имеют ограниченную поддержку вычисляемых столбцов в Power BI. Некоторые вычисляемые столбцы могут работать с соединителем, что эти столбцы являются исключениями. Как правило, вычисляемые столбцы не поддерживаются.

2. **Агрегаты —** Модель данных панели мониторинга качества вызовов построена на модели куба, то есть агрегаты уже поддерживаются в виде мер. Попытка вручную добавить агрегаты в различные измерения или изменить тип агрегирования меры не будет работать с соединителем, и обычно это приведет к ошибке.

3. **Пользовательские визуальные элементы —** Хотя соединитель Microsoft Call Quality работает с диапазоном пользовательских визуальных элементов, мы не можем гарантировать совместимость со всеми пользовательскими визуальными элементами. Многие пользовательские визуальные элементы используют вычисляемые столбцы или импортированные данные, ни один из которых не поддерживается соединителями DirectQuery.

4. **Ссылки на кэшированные данные —** В настоящее время Power BI не поддерживает ссылки на кэшированные данные из соединителя DirectQuery. Любая попытка ссылаться на результаты запроса приведет к новому запросу.

5. **Относительная фильтрация данных —** Поддерживается в соединителе Microsoft Call Quality, но только с измерениями *времени начала* и  окончания. Хотя измерение *Date* может быть очевидным выбором для фильтрации относительных дат, *date* не хранится как объект даты и времени, поэтому не поддерживает фильтрацию относительных дат в Power BI.

6. **Запросы только для измерений —** В настоящее время в соединителе Microsoft Call Quality не поддерживаются. При создании визуализации с тремя или более измерениями без измерений данные столбца будут транспонируются. Чтобы избежать этого, всегда включайте по крайней мере одно измерение (например, Month Year) в визуализации. Эта проблема будет решена в предстоящем выпуске соединителя Microsoft Call Quality для Power BI.

7. **Поддержка облака сообщества для государственных организаций (GCC) —** Для клиентов в среде GCC соединитель Microsoft Call Quality будет работать только при использовании Power BI Desktop. Соединитель Microsoft Call Quality в настоящее время не совместим с служба Power BI для клиентов GCC.

Большинство из этих проблем являются либо ограничениями для проектирования соединителя DirectQuery в Power BI, либо фундаментальными для разработки модели данных CQD.

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="im-trying-to-use-the-date-column-as-a-date-slicer-as-soon-as-i-convert-the-data-type-of-this-column-to-date-i-get-this-error"></a>Я пытаюсь использовать столбец Date в качестве среза даты. Как только я преобразую тип данных этого столбца в Date, возникает эта ошибка.

> **Не удалось загрузить** данные для этого визуального элемента: ошибка OLE DB или ODBC: [Expression.Error] Нам не удалось скитать выражение в источник данных. Попробуйте более простое выражение.

Срезы дат не поддерживаются соединителем Microsoft Call Quality. Чтобы указать диапазон дат, примените к отчету два фильтра, указав значение меньше и больше даты.

Кроме того, если даты, которые вы хотите просмотреть, являются последними, примените относительный фильтр дат, чтобы отобразить только данные за последние N дней, недель и месяцев.


### <a name="when-i-add-certain-dimensions-to-my-reports-the-visual-immediately-returns-couldnt-load-the-data-for-this-visual-removing-the-dimension-fixes-the-visual----what-is-happening"></a>При добавлении определенных измерений в отчеты визуальный элемент немедленно возвращает **сообщение "Не удалось загрузить данные для этого визуального элемента"**. Удаление измерения исправляет визуальный элемент — что происходит?

Это известная проблема в соединителе Microsoft Call Quality. Любое измерение, которое предоставляется в виде целого числа, будет отображаться в Power BI как столбец "агрегат", где Power BI попытается выполнить действие суммирования по умолчанию (обычно Sum). В некоторых случаях это поведение будет успешным при сумме значений, даже если результат не полезен, так как "сумма" измерения, например Second WiFi Channel, не имеет смысла. В других случаях это действие суммирования завершится ошибкой и вызовет ошибки в визуальном элементе.

Чтобы обойти эту проблему, сначала удалите измерение из визуального элемента. Выберите измерение в списке "Поля", перейдите на вкладку "Инструменты столбцов" на ленте, щелкните раскрывающееся меню "Сводка" и выберите "Не **суммировать**". Теперь измерение можно снова добавить в визуальный элемент.


## <a name="error-codes"></a>Коды ошибок

Так как соединитель Microsoft Call Quality для Power BI менее ограничен, чем приложение браузера с точки зрения типов запросов, которые можно создать, иногда может возникнуть ряд ошибок при создании запросов. В случае получения сообщения об ошибке типа CQDError. RunQuery — ошибка выполнения запроса", укажите в приведенном ниже списке номер errorType, чтобы устранить возможные проблемы с запросом. Ниже приведены наиболее распространенные коды типов ошибок, которые могут возникнуть с соединителем CQD Power BI.

- **ErrorType 1 — ошибка структуры запроса:** Ошибка структуры запроса обычно вызвана тем, что соединителю не удается создать правильно отформатированный запрос. Чаще всего это происходит при использовании неподдерживаемых функций, как указано в описании ограничений выше. Убедитесь, что для этого запроса не используются вычисляемые столбцы или пользовательские визуальные элементы.

  - **ErrorType 2 — ошибка построения запроса:** Ошибка сборки запроса вызвана тем, что соединитель Microsoft Call Quality не может правильно проанализировать запрос, который вы пытаетесь создать. Чаще всего это происходит при использовании неподдерживаемых функций, как указано в описании ограничений выше. Убедитесь, что для этого запроса не используются вычисляемые столбцы или пользовательские визуальные элементы.

  - **ErrorType 5 . Время ожидания выполнения:** Запрос достиг максимально возможной среды выполнения до истечения времени ожидания. Попробуйте добавить дополнительные фильтры в запрос, чтобы ограничить его область. Сужение диапазона данных часто является наиболее эффективным способом достижения этой цели.

  - **ErrorType 7 — ошибка без измерений:** Для работы запросов панели мониторинга качества вызовов требуется мера. Убедитесь, что запрос содержит меру. Меры в соединителе Качества звонков (Майкрософт) обозначаются символом агрегирования (суммы) перед их именем.

Если вы столкнулись с дополнительными ошибками за пределами этой области, сообщите группе панели мониторинга качества звонков, чтобы мы могли помочь устранить проблему и обновить документацию соответствующим образом.

## <a name="footnotes"></a>Сноски

**<sup>1. Некоторые</sup>** процессы и приложения (например, OneDrive) могут привести к изменению корневой папки "Документы"; Убедитесь, *что каталог Power BI Desktop\\ Custom Connectors* находится в текущей корневой папке "Документы".

**<sup>2</sup>** Учетные данные входа, которые вы используете для панели мониторинга качества  звонков, не обязательно должны совпадать с учетными данными, которые используются для входа в Power BI Desktop приложения.

## <a name="frequently-asked-questions"></a>Вопросы и ответы

### <a name="when-will-the-power-bi-connector-be-updated-from-beta-status"></a>Когда соединитель Power BI будет обновлен с состояния "Бета-версия"?

Несмотря на тег бета-версии, соединитель Microsoft Call Quality (Beta) для Power BI является первой версией "выпуска" соединителя и официально был подписан командой Power BI, чтобы отразить это. На момент первоначального выпуска соединителя команде Power BI не удалось предоставить поддержку и более широкую сертификацию, но она по-прежнему была готова подтвердить безопасность, аутентификацию и общие функции соединителя Microsoft Call Quality. В ближайшее время мы планируем инвестировать в соединитель Microsoft Call Quality для Power BI.

### <a name="why-does-the-connector-seem-slower-compared-to-call-quality-dashboard-in-the-browser-what-can-i-do-to-improve-performance"></a>Почему соединитель выглядит медленнее по сравнению с панелью мониторинга качества звонков в браузере? Что можно сделать для повышения производительности?

Производительность запросов для различных шаблонов на самом деле совпадает как в браузере, так и в соединителе.  Как и любое другое автономное приложение, Power BI добавляет время проверки подлинности и отрисовки в производительность. Кроме того, разница заключается в количестве выполняемых параллельных запросов. Так как в версии панели мониторинга качества звонков в браузере были менее хорошо разработанные и с высокой плотностью информации параметры визуализации, большинство наших отчетов были ограничены загрузкой 2–3 запросов за раз. С другой стороны, шаблоны соединителей часто отображают более 20 одновременных запросов. Если вы хотите создавать отчеты так же, как и предыдущие, попробуйте создать отчеты не более чем с 2–3 запросами на вкладку.

Дополнительные сведения см. в следующих статьях:

- [Руководство по оптимизации для Power BI](/power-bi/guidance/power-bi-optimization)
- [Руководство по модели DirectQuery](/power-bi/guidance/directquery-model-guidance)

### <a name="i-find-that-i-routinely-run-into-the-10000-row-limit-when-running-queries-how-can-i-get-the-connector-to-return-more-than-10000-rows"></a>Я могу обнаружить, что при выполнении запросов регулярно выполняется ограничение в 10 000 строк. Как получить от соединителя более 10 000 строк?

Ограничение в 10 000 строк фактически указывается в конце API и предназначено для значительного повышения производительности и снижения риска ошибок выполнения запросов, связанных с нехваткой памяти.

Вместо того чтобы пытаться увеличить количество результирующих строк, лучше реструктурировать отчеты в соответствии с рекомендациями соединителя. Шаблоны, которые мы добавили, предназначены для демонстрации этих рекомендаций. По возможности начните с просмотра ключевых показателей эффективности с более широкими измерениями с низкой кратностью, такими как Месяц, Год, Дата, Регион, Страна и т. д. После этого можно детализировать все более высокие измерения кратности. Отчеты службы технической Location-Enhanced и отчеты предоставляют хорошие примеры этого рабочего процесса детализации.



## <a name="related-topics"></a>См. также

[Анализ данных CQD для Teams с помощью Power BI](CQD-Power-BI-query-templates.md)
