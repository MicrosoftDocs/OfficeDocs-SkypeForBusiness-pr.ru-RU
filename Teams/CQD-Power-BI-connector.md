---
title: Установка Power BI Connector для использования шаблонов запросов CQD
ms.author: serdars
author: SerdarSoysal
manager: serdars
ms.reviewer: siunies
ms.topic: article
ms.tgt.pltfrm: cloud
ms.service: msteams
ms.collection:
- M365-voice
search.appverid: MET150
audience: Admin
appliesto:
- Microsoft Teams
localization_priority: Normal
description: Установка Power BI Connector для использования шаблонов запросов запросов качества звонка (CQD)
ms.openlocfilehash: 7af8da203eb6a69bf5db443444c0ca35eff9bb70
ms.sourcegitcommit: 01087be29daa3abce7d3b03a55ba5ef8db4ca161
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2021
ms.locfileid: "51101525"
---
# <a name="install-power-bi-connector-to-use-cqd-query-templates"></a>Установка Power BI Connector для использования шаблонов запросов CQD

Прежде чем использовать шаблоны запросов Power BI (PBIX-файлы) для панели мониторинга качества звонка Microsoft Teams (CQD), необходимо установить Power BI Connector для Microsoft CQD, используя файл *MicrosoftCallQuality.pqx,* включенный в скачанную [скачать.](https://github.com/MicrosoftDocs/OfficeDocs-SkypeForBusiness/blob/live/Teams/downloads/CQD-Power-BI-query-templates.zip?raw=true)

Чтобы [изучить эти шаблоны, проанализируйте данные CQD](CQD-Power-BI-query-templates.md) для Teams с помощью Power BI.

Убедитесь, что у вас есть права на доступ к отчетам Power BI с правильной ролью "Доступ к [CQD".](./turning-on-and-using-call-quality-dashboard.md#assign-admin-roles-for-access-to-cqd)

> [!NOTE]
> CQD Power BI Connector поддерживает только DirectQuery в Power BI. Режим импорта не поддерживается. 

## <a name="installation"></a>Установка

Процесс установки пользовательского соединителя и настройки безопасности для его использования подробно описан в документации [Power BI.](/power-bi/desktop-connector-extensibility) Для простоты при этом краткое объяснение:

1. Проверьте, есть ли на компьютере папка пользовательских соединитеров *\[ Power BI Desktop \] \\ \\ Documents.* Если нет, создайте эту папку. <sup>1</sup>

2. Скачайте файл соединитела *\* (mez-* или *\* PQX-файл)* и поместите его в каталог *пользовательских* соединитеителей.

3. **Если это *\* MEZ-файл,*** вам также потребуется настроить параметры безопасности, как описано в документации по настройке [соединители.](/power-bi/desktop-connector-extensibility#data-extension-security)

Если выпущена новая версия Power BI Connector для Microsoft Teams, просто замените старый файл соединитела в каталоге *Custom Connectors* новым файлом.

## <a name="setup"></a>Установка

Чтобы создать отчет и выполнить запросы, необходимо сначала подключиться к источнику данных CQD. Чтобы подключиться, выполните следующие действия:

1. На вкладке "Главная" в Power BI Desktop нажмите кнопку *"Получить данные".*

    ![Снимок экрана: Power BI Connector](media/CQD-power-bi-connector1-resize.png)

2. На *этом этапе* должно появиться окно "Получить данные". Перейдите *в веб-службы,* выберите "Качество звонка *(бета-версия) Майкрософт" и* нажмите *"Подключиться".*

    ![Снимок экрана: Power BI Connector](media/CQD-power-bi-connector2-resize.png)

3. Вам будет предложено войти далее. Используйте те же учетные данные, что и для CQD. <sup>2</sup>

4. В следующем запросе будет предложено выбрать один из двух режимов *подключения к данным.* Выберите *DirectQuery и* нажмите *ОК.*

5. Наконец, вам будет выдан итоговое запрос, в котором будет показана вся модель данных для CQD. На этом этапе данные не будут видны, только модель данных для CQD. Чтобы *завершить настройку,* выберите "Загрузить".

6. На этом этапе Power BI загрузит модель данных в правую часть окна. В противном случае страница останется пустой, а запросы не будут загружены по умолчанию. Чтобы создать **запрос** и вернуть данные, перенастройте его на приведенную ниже порядок создания запросов.

Если какие-либо из шагов настройки не были полностью понятными, более подробное описание процесса можно найти в кратком описании процесса: подключение к данным в [Power BI Desktop.](/power-bi/desktop-quickstart-connect-to-data)

## <a name="building-queries"></a>Запросы на создание

После завершения настройки на области "Поля" должны быть названия  нескольких сотен размеров и мер. Создать фактические запросы здесь очень просто: достаточно выбрать нужные измерения и меры, а затем перетащить их на страницу. Вот более подробное объяснение и простой пример:

1. В области "Визуализации" выберите визуализацию, которая вам *нужна.* На странице должна появиться пустая версия визуализации. В данном примере используется визуализация *таблицы.*

    ![Снимок экрана: Power BI Connector](media/CQD-power-bi-connector3-resize.png)

2. Определите измерения и меры (обозначается символом агрегирования под их именем), которые вы хотите использовать в запросе, а затем вручную выберите их и перетащите в черную визуализацию. Кроме того, перетащите их в *поле "Значения"* под вариантами визуализации.

    ![Снимок экрана: Power BI Connector](media/CQD-power-bi-connector4-resize2.png)

    > [!IMPORTANT]
    > Панель мониторинга качества звонка требует меры для выполнения любого запроса. Неудача добавления меры в запрос приведет к его сбою.

3. Затем выберите любые измерения, по которых вы  хотите отфильтровать, и перетащите их в фильтры этого поля визуального поля в области *фильтров.* CQD Power BI Connector в настоящее время поддерживает базовую фильтрацию *(выбор* значений из списка возможных значений измерений), расширенный фильтр (вручную укажите значения и операнды  для фильтрации, аналогично advanced CQD) и относительный фильтр дат *(доступен* только для измерений времени окончания и начала).   Фильтрация по N *верхнего приоритета* не поддерживается CQD.

    ![Снимок экрана: Power BI Connector](media/CQD-power-bi-connector5-resize.png)

4. Наконец, выберите вкладку *"Формат"* в *области* визуализаций, чтобы отформатировать и стиль запроса.

    > [!NOTE]
    > Для запуска запросов CQD требуется хотя бы одна мера. Если запрос не загружается, убедитесь, что мера включена в запрос.

## <a name="creating-a-drillthrough-report"></a>Создание отчета drillthrough

[С помощью drillthrough](/power-bi/desktop-drillthrough) в Power BI можно создавать отфильтрованные отчеты, которые можно быстро фильтровать, используя значения других отчетов в качестве контекста. После того как вы узнаете, как создать первый запрос с помощью соединители CQD, процесс drillthrough будет еще проще.

1. Создайте еще одну страницу отчета, а затем добавьте на нее запросы.

2. Выберите размер, который вы хотите использовать в качестве фильтра *drillthrough,* и перетащите его в поле Drillthrough в области *"Визуализации".*

    ![Снимок экрана: Power BI Connector](media/CQD-power-bi-connector6-resize.png)

3. **Ну вот\!** Теперь любой другой запрос на другой странице, использующий это измерение, теперь может обращаться к ней с помощью фильтра, автоматически применяя значение измерения drillthrough.

    ![Снимок экрана: Power BI Connector](media/CQD-power-bi-connector7-resize.png)

В отличие от Advanced CQD, Power BI поддерживает непоэтапный drillthrough. Если запрос содержит необходимое измерение, он может перебираться на любую другую страницу.

### <a name="best-practice"></a>Методика

Запросы на качество звонка должны быть разработаны с учетом функций drillthrough. Вместо того чтобы одновременно загружать все данные, а затем использовать фильтры, начните с более общих запросов с низкой емкостью и отфильтруйте данные до запросов с высокой емкостью. Например, при попытке диагностировать подсети, в которых чаще всего возникает проблема с качеством, необходимо сначала определить регионы и страны, в которых возникает проблема, а затем оказаться на подсетях в этом регионе или стране. Шаблоны соединители для качества звонка разработаны таким образом, чтобы выступать в качестве примера.

## <a name="limitations"></a>Ограничения

Несмотря на использование Power BI, не все функции Power BI поддерживаются соединительной линией CQD из-за ограничений модели данных CQD или соединитеров DirectQuery в целом. В списке ниже приведены некоторые наиболее заслуживающие внимания ограничения соединитела, но он не должен считаться исчерпывающим:

1. **Вычисляемая колонка —** Соединители DirectQuery в целом имеют ограниченную поддержку вычисляемых столбцов в Power BI. Хотя некоторые вычисляемые столбцы могут работать с соединитетелем, эти столбцы следует считать исключениями. Как правило, вычисляются столбцы не будут работать.

2. **Агрегаты —** Модель данных CQD построена на модели куба, то есть агрегаты уже поддерживаются в виде мер. Попытка вручную добавить агрегаты в различные измерения или изменить тип агрегирования меры не будет работать с соединитетелем и, как правило, приведет к ошибке.

3. **Настраиваемые визуальные эффекты —** Хотя соединительность CQD работает с диапазоном настраиваемой визуальной информации, мы не можем гарантировать совместимость со всеми визуальными эффектами. Многие настраиваемые визуальные данные не зависят от использования вычисляемого столбца или импортируемых данных и не поддерживаются соединительными линиями DirectQuery.

4. **Ссылки на кэшные данные —** Power BI в настоящее время не поддерживает ссылки на кэшные данные с соединитела DirectQuery. Любая попытка ссылки на результаты запроса приведет к новому запросу.

5. **Относительная фильтрация данных —** Поддерживается в соединители CQD,  но только  для измерений времени начала и окончания. Измерение *Date может* быть очевидным для относительной фильтрации *дат,* но не хранится как объект даты и поэтому не поддерживает относительную фильтрацию дат в Power BI.

6. **Поддержка Сообщества государственных организаций (GCC):** Для клиентов в среде GCC соединительная система CQD Power BI Connector будет работать при работе с Power BI Desktop. Соединитель CQD Power BI совместим со службой Power BI для GCC.

Большинство из этих проблем являются ограничениями для разработки соединительные линии DirectQuery в Power BI или основой модели данных CQD.

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="im-trying-to-use-the-date-column-as-a-date-slicer-as-soon-as-i-convert-the-data-type-of-this-column-to-date-i-get-this-error"></a>Я пытаюсь использовать столбец "Дата" в качестве среза даты. Как только я преобразую тип данных этого столбца в date, я получаю эту ошибку

> **Не удалось загрузить** данные для этого визуального выражения: ошибка OLE DB или ODBC: [Expression.Error] Не удалось сложить выражение с источником данных. Попробуйте более простое выражение.

Срезы дат не поддерживаются в Power BI Connector. Чтобы указать диапазон дат, применим к отчету два фильтра, которые не должны быть больше даты.

Кроме того, если даты, которые вы хотите просмотреть, являются недавними, применим относительный фильтр дат, чтобы отфильтровать только данные за последние N дней/недель/месяцев.

## <a name="error-codes"></a>Коды ошибок

Так как ограничения CQD Power BI Connector меньше, чем у браузера, с точки зрения запросов, которые можно создать, иногда может возникнуть ряд ошибок при построении запросов. В случае получения сообщения об ошибке типа "CQDError. RunQuery — Ошибка выполнения запроса", в приведенной ниже ссылке на номер ErrorType, предоставленный для устранения возможной проблемы с запросом. Ниже ются наиболее распространенные коды типов ошибок, которые могут возникнуть с соединитетелем CQD Power BI Connector:

- **Тип ошибки 1. Ошибка структуры запроса:** Ошибка структуры запроса обычно вызвана тем, что соединителю не удается построить правильно отформатированный запрос. Чаще всего это происходит при использовании неподтверченных функций, как указано в указанных выше ограничениях. Убедитесь, что для этого запроса не используется вычисляемый столбец или визуальные данные.

  - **ErrorType 2 — ошибка при построении запроса:** Ошибка при построении запроса вызвана тем, что соединитеку CQD не удается правильно оценить запрос, который вы создаете. Чаще всего это происходит при использовании неподтверченных функций, как указано в указанных выше ограничениях. Убедитесь, что для этого запроса не используется вычисляемый столбец или визуальные данные.

  - **Тип ошибки 5. Время выполнения:** Для запроса достигнуто максимальное возможное время выполнения до времени выполнения. Попробуйте добавить в запрос дополнительные фильтры, чтобы ограничить область его действия. Часто для этого наиболее эффективно сужение диапазона данных.

  - **ErrorType 7 — ошибка "Нет измерений":** Для работы запросов CQD требуется мера. Убедитесь, что ваш запрос содержит меру. Меры в соединительных соединителях CQD обозначаются символом агрегирования (sum) перед их именем.

Если вы столкнулись с другими ошибками вне этой области, сообщите об этом группе, чтобы мы помогли устранить проблему и при необходимости обновить документацию.

## <a name="footnotes"></a>Сноски

**<sup>1.</sup>** Некоторые процессы и приложения (например, OneDrive) могут привести к изменению корневой папки "Документы". Убедитесь, что каталог пользовательских соединитеров *Power BI Desktop \\* находится в текущей корневой папке "Документы".

**<sup>2 Учетные</sup>** данные для входа,  которые вы используете для CQD, не должны быть учетными данными, которые вы используете для входа в само приложение Power BI Desktop.

## <a name="frequently-asked-questions"></a>Вопросы и ответы

### <a name="when-will-the-power-bi-connector-be-updated-from-beta-status"></a>Когда Power BI Connector будет обновлен со статусом "Бета".

Несмотря на тег "Бета-версия", соединитель качества звонка для Power BI является выпуском соединителю и официально подписан командой Power BI с учетом этого. Процесс сертификации для удаления этого тега бета-версии является масштабным и требует от группы Power BI обязательств по предоставлению прямой поддержки соединителе. Из-за ограничений по времени группа Power BI в настоящее время не может предоставить эту поддержку и более широкую сертификацию, но все еще готова проверить безопасность, подлинность и общий уровень функциональности соединитера Microsoft Call Quality.

### <a name="why-does-the-connector-seem-slower-compared-to-advanced-cqd-in-the-browser-what-can-i-do-to-improve-performance"></a>Почему соединитетель выглядит медленнее, чем расширенный CQD в браузере? Что можно сделать для повышения производительности

Производительность запросов для различных шаблонов на самом деле будет одинаковой как в браузере, так и в соединители.  Как и любое другое приложение, Power BI добавляет свою проверку подлинности и время отрисовки к производительности. Кроме того, разница возникает из-за количества одновременно вы выполнение запросов. Так как в версии CQD в браузере был менее разработан и у нас менее плотные возможности визуализации, большинство наших отчетов имели ограничение на загрузку 2–3 запросов одновременно. С другой стороны, в шаблонах соединителок часто отображается не более 20 одновременно запросов. Если вы хотите создавать отчеты с такой же быстрой реакцией, как и в старых, попробуйте создать отчеты не более чем с 2–3 запросами на вкладку.

Дополнительные сведения см. в следующих статьях:

- [Руководство по оптимизации для Power BI](/power-bi/guidance/power-bi-optimization)
- [Руководство по модели DirectQuery](/power-bi/guidance/directquery-model-guidance)

### <a name="i-find-that-i-routinely-run-into-the-10000-row-limit-when-running-queries-how-can-i-get-the-connector-to-return-more-than-10000-rows"></a>Я постоянно сжимаю предел в 10 000 строк при запуске запросов. Как получить соединителя для возврата более 10 000 строк

Ограничение в 10 000 строк фактически указывается в конце API и предназначено для существенного повышения производительности и снижения риска выполнения запросов, связанных с низкими условиями памяти.

Вместо того чтобы увеличивать количество строк результатов, лучше изменить структуру отчетов в соответствии с лучшими методиками соединителя. Шаблоны, которые мы включили, разработаны для демонстрации этих лучших методик. По возможности начните с того, что для начала нужно получить КПОП с более широкими измерениями с более низкими градиториями, такими как "Месяц", "Год", "Дата", "Регион", "Страна" и т. д. Оттуда вы можете drill down into increasingly higher-cardinality dimensions. Хороший пример для этого Location-Enhanced отчетов helpdesk и Location-Enhanced.



## <a name="related-topics"></a>Статьи по теме

[Анализ данных CQD для Teams с помощью Power BI](CQD-Power-BI-query-templates.md)
