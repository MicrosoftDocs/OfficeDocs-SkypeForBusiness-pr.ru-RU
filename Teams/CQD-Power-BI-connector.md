---
title: Установка соединителя Power BI для использования шаблонов запросов CQD
author: CarolynRowe
ms.author: crowe
manager: serdars
ms.reviewer: siunies
ms.topic: article
ms.tgt.pltfrm: cloud
ms.service: msteams
ms.collection:
- M365-voice
search.appverid: MET150
audience: Admin
appliesto:
- Microsoft Teams
ms.localizationpriority: medium
description: Установка соединителя Power BI для использования шаблонов запросов панели мониторинга качества звонков (CQD)
ms.openlocfilehash: 534103fc2bec48566a1d0a57eeb390ed6ae0606c
ms.sourcegitcommit: 66d8e3d7a29a03c5deba9780964bc03f6587017f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/11/2023
ms.locfileid: "69774754"
---
# <a name="install-microsoft-call-quality-connector-for-power-bi-to-use-call-quality-dashboard-query-templates"></a>Установка соединителя Microsoft Call Quality для Power BI для использования шаблонов запросов панели мониторинга качества звонков

Прежде чем использовать шаблоны запросов Power BI (PBIX-файлы) для панели мониторинга качества звонков Microsoft Teams (CQD), необходимо установить соединитель Качества звонков (Майкрософт) для Power BI с помощью файла *MicrosoftCallQuality.pqx* , включенного в [скачиваемую версию](https://www.microsoft.com/download/details.aspx?id=102291).

Сведения об этих шаблонах см. в статье [Использование Power BI для анализа данных CQD для Teams](CQD-Power-BI-query-templates.md) .

Убедитесь, что у вас есть [правильная роль доступа CQD](./turning-on-and-using-call-quality-dashboard.md#assign-admin-roles-for-access-to-cqd) для доступа к отчетам Power BI.

> [!NOTE]
> Соединитель Качества звонков (Майкрософт) поддерживает DirectQuery только в Power BI. Режим импорта не поддерживается. 

## <a name="installation"></a>Установка

Процесс установки пользовательского соединителя и настройки безопасности для включения использования соединителя подробно описан в [документации по Power BI](/power-bi/desktop-connector-extensibility). Для простоты, вот краткое объяснение:

1. Проверьте, есть ли на компьютере папка *Documents\]\\ Power BI Desktop\\ Custom Connectors.\[* Если нет, создайте эту папку. <sup>1</sup>

2. Скачайте файл соединителя ( *\*mez* или *\*PQX-файл* ) и поместите его в каталог *Настраиваемые соединители* .

3. **Если файл соединителя является *mez-файлом\**,** вам также потребуется настроить параметры безопасности, как описано в [документации по настройке пользовательского соединителя](/power-bi/desktop-connector-extensibility#data-extension-security).

Если выпущена новая версия соединителя Microsoft Call Quality, замените старый файл соединителя в каталоге *Настраиваемые соединители* новым файлом.

## <a name="setup"></a>Установка

Чтобы создать отчет и выполнить запросы, сначала необходимо подключиться к источнику данных CQD. Чтобы подключиться, выполните следующие действия.

1. На вкладке Главная Power BI Desktop щелкните *Получить данные*.

    ![Получение данных в соединителе Power BI.](media/CQD-power-bi-connector1-resize.png)

2. На этом этапе должно появиться окно *Получить данные* . Перейдите в *раздел Веб-службы*, выберите *Microsoft Call Quality (бета-версия)* и нажмите *кнопку Подключить*.

    ![Качество вызовов (Майкрософт) в соединителе Power BI.](media/CQD-power-bi-connector2-resize.png)

3. Далее вам будет предложено войти в систему. Используйте те же учетные данные, что и для панели мониторинга качества звонков. <sup>2</sup>

4. В следующем запросе вы получите возможность между двумя *режимами подключения к данным*. Выберите *DirectQuery* и нажмите *кнопку ОК*.

5. Наконец, вы получите последнюю подсказку, показывающую всю модель данных для панели мониторинга качества звонков. На этом этапе данные не будут отображаться, только модель данных для CQD. Выберите *Загрузить* , чтобы завершить процесс установки.

6. На этом этапе Power BI загрузит модель данных в правой части окна. В противном случае страница останется пустой, и по умолчанию запросы не будут загружены. Перейдите к **следующему элементу Создание запросов** , чтобы создать запрос и вернуть данные.

Если какой-либо из шагов во время этого процесса установки не был ясным, более подробное описание процесса можно найти в [разделе Краткое руководство. Подключение к данным в Power BI Desktop](/power-bi/desktop-quickstart-connect-to-data).

## <a name="building-queries"></a>Создание запросов

После завершения настройки вы увидите имена нескольких сотен измерений и нагрузки мер в области *Поля* . Создать фактические запросы здесь просто: просто выберите нужные измерения и меры для запроса, а затем перетащите их на страницу. Ниже приведено более подробное объяснение с простым примером:

1. Выберите визуализацию, которую вы хотите использовать, в области *Визуализации* . На странице должна появиться пустая версия этой визуализации. В этом примере мы будем использовать визуализацию *таблицы* .

    ![Область визуализаций в соединителе Power BI.](media/CQD-power-bi-connector3-resize.png)

2. Определите, какие измерения и меры (обозначаемые символом агрегирования по их имени), которые вы хотите использовать для запроса, а затем вручную выделите их и перетащите на черную визуализацию. Кроме того, перетащите их в поле *Значения* под параметрами визуализации.

    ! Запрос визуализаций в соединителе Power BI.] (media/CQD-power-bi-connector4-resize2.png)

    > [!IMPORTANT]
    > Панель мониторинга качества вызовов требует меры для выполнения любого запроса. Сбой при добавлении меры в запрос приведет к сбою запроса.

3. Затем выберите все измерения, по которым требуется отфильтровать, и перетащите их в поле *Фильтры этого визуального элемента* в области *Фильтры* . Соединитель качества вызовов (Майкрософт) в настоящее время поддерживает *фильтрацию "Базовый* " (выбор значений из списка возможных значений измерений), *расширенную фильтрацию* (вручную указывать значения и операнды для фильтрации, аналогично панели мониторинга качества звонка) и *фильтрацию относительных дат* (доступно только для измерений *Времени окончания* и *времени начала* ). Фильтрация по *верхнему N* не поддерживается панелью мониторинга качества звонков.

    ![Фильтры визуализаций в соединителе Power BI.](media/CQD-power-bi-connector5-resize.png)

    > [!IMPORTANT]
    > Фильтры поддерживаются только при применении к измерениям. Фильтрация по значениям измерений не поддерживается на панели мониторинга качества вызовов.

4. Наконец, выберите вкладку *Формат* в области *Визуализации* , чтобы изменить стиль и формат запроса.

    > [!NOTE]
    > Для выполнения запросов панели мониторинга качества вызовов требуется по крайней мере одна мера. Если запрос не загружается, убедитесь, что вы включили меру в запрос.

## <a name="creating-a-drillthrough-report"></a>Создание отчета детализации

[Детализация в Power BI](/power-bi/desktop-drillthrough) позволяет создавать ориентированные отчеты, которые можно быстро фильтровать, используя значения других отчетов в качестве контекста. Как только вы узнаете, как создать свой первый запрос с помощью соединителя Microsoft Call Quality, создать детализацию будет еще проще.

1. Создайте другую страницу для ориентированного отчета, а затем добавьте на нее запросы.

2. Выберите измерение, которое вы хотите использовать в качестве фильтра детализации, и перетащите его в поле *Детализация* в области *Визуализации* .

    ![Детализация в соединителе Power BI.](media/CQD-power-bi-connector6-resize.png)

3. **Ну вот\!** Любой другой запрос на другой странице, использующий это измерение, теперь может детализировать на этой странице, автоматически применяя значение измерения детализации в качестве фильтра.

    ![Фильтр детализации в соединителе Power BI.](media/CQD-power-bi-connector7-resize.png)

В отличие от панели мониторинга качества вызовов, Power BI поддерживает не последовательную детализацию. Если запрос содержит необходимое измерение, он может детализировать любую другую страницу.

### <a name="best-practice"></a>Рекомендация

Запросы соединителя качества вызовов (Майкрософт) должны разрабатываться с учетом функций детализации. Вместо того, чтобы пытаться загрузить все данные одновременно, а затем срезов с фильтрами, начните с более широких запросов с низкой кратностью и детализации до запросов с высокой кратностью. Например, при попытке определить, какие подсети больше всего влияют на проблемы качества, полезно сначала определить регионы и страны, которые способствуют возникновению проблемы, а затем детализировать подсети в этом регионе или стране. Шаблоны соединителя качества звонков были разработаны таким образом, чтобы служить примером.

## <a name="limitations"></a>Ограничения

Несмотря на использование Power BI, соединитель Качества звонков (Майкрософт) поддерживает не все функции Power BI в результате ограничений модели данных панели мониторинга качества звонков или соединителей DirectQuery в целом. В приведенном ниже списке отмечаются некоторые из более примечательных ограничений соединителя, но этот список не следует считать исчерпывающим:

1. **Вычисляемые столбцы —** Соединители DirectQuery обычно имеют ограниченную поддержку вычисляемых столбцов в Power BI. Некоторые вычисляемые столбцы могут работать с соединителем, что эти столбцы являются исключениями. Как правило, вычисляемые столбцы не работают.

2. **Агрегаты–** Модель данных панели мониторинга качества вызовов построена на модели куба, что означает, что агрегаты уже поддерживаются в виде мер. Попытка вручную добавить агрегаты в различные измерения или изменить тип агрегирования меры не будет работать с соединителем, и обычно это приведет к ошибке.

3. **Пользовательские визуальные элементы —** Хотя соединитель качества звонков (Майкрософт) работает с рядом пользовательских визуальных элементов, мы не можем гарантировать совместимость со всеми пользовательскими визуальными элементами. Многие пользовательские визуальные элементы используют вычисляемые столбцы или импортированные данные, ни один из которых не поддерживается соединителями DirectQuery.

4. **Ссылка на кэшированные данные —** В настоящее время Power BI не поддерживает ссылки на кэшированные данные из соединителя DirectQuery. Любая попытка сослаться на результаты запроса приведет к созданию нового запроса.

5. **Относительная фильтрация данных —** Поддерживается в соединителе Качества звонков (Майкрософт), но только с измерениями *Времени начала* и *окончания* . Хотя измерение *даты* может быть очевидным выбором для фильтрации относительных дат, *Дата* не хранится в качестве объекта даты и времени, поэтому не поддерживает фильтрацию относительных дат в Power BI.

6. **Запросы только для измерения .** В настоящее время не поддерживаются в соединителе Качества звонков Майкрософт. При создании визуализации с тремя или более измерениями без измерений данные столбцов будут транспонироваться. Чтобы избежать этого, всегда включите в визуализации хотя бы одно измерение (например, год месяца). Эту проблему планируется устранить в предстоящем выпуске соединителя Microsoft Call Quality для Power BI.

7. **Поддержка облака сообщества для государственных организаций (GCC) —** Для клиентов в среде GCC соединитель качества звонков (Майкрософт) будет работать только при использовании Power BI Desktop. Соединитель Microsoft Call Quality в настоящее время несовместим с служба Power BI для клиентов GCC.

Большинство из этих проблем являются либо ограничениями на конструкцию соединителя DirectQuery в Power BI, либо имеют основополагающее значение для проектирования модели данных CQD.

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="im-trying-to-use-the-date-column-as-a-date-slicer-as-soon-as-i-convert-the-data-type-of-this-column-to-date-i-get-this-error"></a>Я пытаюсь использовать столбец Дата в качестве среза даты. Как только я преобразую тип данных этого столбца в Date, я получаю эту ошибку.

> **Не удалось загрузить данные для этого визуального элемента**: ошибка OLE DB или ODBC: [Expression.Error] Не удалось сложить выражение в источник данных. Попробуйте более простое выражение.

Срезы даты не поддерживаются соединителем Качества звонков (Майкрософт). Чтобы указать диапазон дат, примените к отчету два фильтра, указав дату меньше и больше.

Кроме того, если даты, которые вы хотите просмотреть, являются последними, примените относительный фильтр дат, чтобы отобразить только данные за последние N дней,недель/месяцев.


### <a name="when-i-add-certain-dimensions-to-my-reports-the-visual-immediately-returns-couldnt-load-the-data-for-this-visual-removing-the-dimension-fixes-the-visual----what-is-happening"></a>При добавлении определенных измерений в отчеты визуальный элемент немедленно возвращает **сообщение "Не удалось загрузить данные для этого визуального элемента".** Удаление измерения исправляет визуальный элемент — что происходит?

Это известная проблема в соединителе качества звонков Майкрософт; Любое измерение, которое предоставляется как целое число, будет отображаться в Power BI в виде столбца "агрегат", где Power BI попытается выполнить действие суммирования по умолчанию (обычно "Сумма"). В некоторых случаях это поведение будет успешным при сумме значений, даже если результат не является полезным, так как "сумма" измерения, такого как Second WiFi Channel, бессмысленна. В других случаях это действие сводки завершится ошибкой и вызовет ошибки в визуальном элементе.

Чтобы обойти эту проблему, начните с удаления измерения из визуального элемента. Выберите измерение в списке "Поля", перейдите на вкладку "Инструменты столбцов" на ленте, щелкните раскрывающееся меню "Сводка" и выберите **Не суммировать**. Теперь измерение можно снова добавить в визуальный элемент.


## <a name="error-codes"></a>Коды ошибок

Так как соединитель Качества звонков (Майкрософт) для Power BI менее ограничен, чем браузерное приложение с точки зрения типов запросов, которые вы можете создать, иногда при создании запросов может возникнуть ряд ошибок. В случае, если появляется сообщение об ошибке типа "CQDError. RunQuery — ошибка выполнения запроса», составьте ссылку на приведенный ниже список с указанным номером ErrorType, чтобы устранить возможную проблему с запросом. Ниже приведены наиболее распространенные коды типов ошибок, которые могут возникнуть в соединителе CQD Power BI.

- **ErrorType 1 — ошибка структуры запроса:** Ошибка структуры запроса обычно возникает из-за того, что соединителю не удалось создать правильно отформатированный запрос. Чаще всего это происходит при использовании неподдерживаемых функций, как указано в разделе Ограничения выше. Убедитесь, что для этого запроса не используются вычисляемые столбцы или пользовательские визуальные элементы.

  - **ErrorType 2 — ошибка построения запроса:** Ошибка построения запроса вызвана тем, что соединителю Качества вызовов (Майкрософт) не удается правильно проанализировать запрос, который вы пытаетесь создать. Чаще всего это происходит при использовании неподдерживаемых функций, как указано в разделе Ограничения выше. Убедитесь, что для этого запроса не используются вычисляемые столбцы или пользовательские визуальные элементы.

  - **ErrorType 5 — время ожидания выполнения:** Запрос достиг максимально возможной среды выполнения до истечения времени ожидания. Попробуйте добавить дополнительные фильтры в запрос, чтобы ограничить его область. Сужение диапазона данных часто является наиболее эффективным способом достижения этой цели.

  - **ErrorType 7 — ошибка без измерений:** Для работы запросов панели мониторинга качества вызовов требуется мера. Убедитесь, что запрос содержит меру. Меры в соединителе Качества звонков (Майкрософт) обозначаются символом агрегирования (суммы) перед их именем.

Если вы столкнулись с дополнительными ошибками за пределами этой области, сообщите команде панели мониторинга качества звонков, чтобы мы могли помочь устранить проблему и обновить документацию соответствующим образом.

## <a name="footnotes"></a>Сноски

**<sup>1</sup>** Некоторые процессы и приложения (например, OneDrive) могут привести к изменению корневой папки "Документы". Убедитесь, что каталог *Power BI Desktop\\ Custom Connectors* размещен в текущей корневой папке Документы.

**<sup>2</sup>** Учетные данные входа, используемые для панели мониторинга качества звонков, *не* должны совпадать с учетными данными, которые вы используете для входа в само приложение Power BI Desktop.

## <a name="frequently-asked-questions"></a>Вопросы и ответы

### <a name="when-will-the-power-bi-connector-be-updated-from-beta-status"></a>Когда соединитель Power BI будет обновлен из состояния "Бета-версия"?

Несмотря на тег beta, соединитель Microsoft Call Quality (Beta) для Power BI является первой версией соединителя "выпуск" и официально подписан командой Power BI для обеспечения безопасности, чтобы отразить это. На момент первоначального выпуска соединителя команда Power BI не смогла обеспечить поддержку и более широкую сертификацию, но по-прежнему была готова подтвердить безопасность, подлинность и общую функциональность соединителя Качества звонков Майкрософт. В будущем мы планируем инвестировать в соединитель Качества звонков (Майкрософт) для Power BI в ближайшем будущем.

### <a name="why-does-the-connector-seem-slower-compared-to-call-quality-dashboard-in-the-browser-what-can-i-do-to-improve-performance"></a>Почему соединитель выглядит медленнее по сравнению с панелью мониторинга качества вызовов в браузере? Что можно сделать для повышения производительности?

Производительность запросов для различных шаблонов практически одинакова как в браузере, так и в соединителе.  Как и любое другое автономное приложение, Power BI добавляет время проверки подлинности и отрисовки к нашей производительности. Кроме того, разница заключается в количестве одновременно выполняемых запросов. Так как в версии панели мониторинга качества звонков в браузере были менее хорошо разработаны параметры визуализации с высокой плотностью информации, большинство наших отчетов ограничивались загрузкой 2–3 запросов за раз. С другой стороны, шаблоны соединителей часто отображают более 20 одновременных запросов. Если вы хотите создавать отчеты с таким же быстродействием, как и предыдущие, попробуйте создать отчеты с не более чем 2–3 запросами на вкладку.

Дополнительные сведения см. в следующих статьях:

- [Руководство по оптимизации для Power BI](/power-bi/guidance/power-bi-optimization)
- [Руководство по модели DirectQuery](/power-bi/guidance/directquery-model-guidance)

### <a name="i-find-that-i-routinely-run-into-the-10000-row-limit-when-running-queries-how-can-i-get-the-connector-to-return-more-than-10000-rows"></a>Я считаю, что при выполнении запросов я регулярно натыкаюсь на ограничение в 10 000 строк. Как заставить соединитель возвращать более 10 000 строк?

Ограничение в 10 000 строк фактически указано в конце API и предназначено для значительного повышения производительности и снижения риска ошибок выполнения запросов, вызванных нехваткой памяти.

Вместо того, чтобы пытаться увеличить число результирующих строк, лучше перестроить отчеты в соответствии с рекомендациями соединителя. Включенные шаблоны предназначены для демонстрации этих рекомендаций. По возможности начните с просмотра ключевых показателей эффективности с использованием более широких измерений с меньшей кратностью, таких как месяц, год, дата, регион, страна и т. д. Оттуда вы можете детализировать все более высокие измерения кратности. Отчеты службы поддержки и Location-Enhanced предоставляют хорошие примеры этого рабочего процесса детализации.



## <a name="related-topics"></a>См. также

[Использование Power BI для анализа данных CQD для Teams](CQD-Power-BI-query-templates.md)
