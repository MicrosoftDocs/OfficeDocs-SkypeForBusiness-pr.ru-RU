---
title: Установка соединителя Power BI для использования шаблонов запросов CQD
ms.author: lolaj
author: LolaJacobsen
manager: serdars
ms.reviewer: siunies
ms.topic: article
ms.tgt.pltfrm: cloud
ms.service: msteams
ms.collection:
- M365-voice
search.appverid: MET150
audience: Admin
appliesto:
- Microsoft Teams
localization_priority: Normal
description: Установка соединителя Power BI для использования шаблонов запросов на панели мониторинга качества звонков (CQD)
ms.openlocfilehash: 1647497cf2551a125e28d5a3920625bee15eca9f
ms.sourcegitcommit: 70b80892a152f86a6d596f0f5b58cf391bc29098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2020
ms.locfileid: "45138068"
---
# <a name="install-power-bi-connector-to-use-cqd-query-templates"></a>Установка соединителя Power BI для использования шаблонов запросов CQD

Прежде чем использовать шаблоны запросов Power BI (PBIX-файлы) для панели мониторинга качества звонков Microsoft Teams (CQD), вам потребуется установить соединитель Power BI для Microsoft CQD с помощью файла *MicrosoftCallQuality. PQx* , включенного в файл для [скачивания](https://github.com/MicrosoftDocs/OfficeDocs-SkypeForBusiness/blob/live/Teams/downloads/CQD-Power-BI-query-templates.zip?raw=true).

Читайте в статье [Power BI, чтобы проанализировать CQD данные для Teams](CQD-Power-BI-query-templates.md) , чтобы узнать об этих шаблонах.

Убедитесь в том, что у вас есть права [доступа CQD](https://docs.microsoft.com/microsoftteams/turning-on-and-using-call-quality-dashboard#assign-roles-for-accessing-cqd) для доступа к отчетам Power BI.

## <a name="installation"></a>Установка

Процесс установки настраиваемого соединителя и настройки безопасности для включения использования соединителя подробно описан в [документации по Power BI](https://docs.microsoft.com/power-bi/desktop-connector-extensibility). Вот краткое описание простоты:

1. Убедитесь, что на вашем компьютере уже есть папка " * \[ документы" \] \\ \\ настраиваемых соединителей Power BI для настольных систем*   . В противном случае создайте эту папку. <sup>1</sup>

2. Скачайте файл соединителя (файл с * \* расширением MEZ* или * \* PQx* ) и поместите его в каталог *Custom Connectors* .

3. **Если файл соединителя является файлом * \* . MEZ* ,** вам также потребуется настроить параметры безопасности, как описано в [документации по настройке настраиваемого соединителя](https://docs.microsoft.com/power-bi/desktop-connector-extensibility#data-extension-security).

Если вы выпускает новую версию этого соединителя Power BI для Microsoft Teams, просто замените старый файл соединителя в каталоге *Custom Connectors* новым файлом.

## <a name="setup"></a>Установка

Для создания отчета и выполнения запросов сначала необходимо подключиться к источнику данных CQD. Выполните указанные ниже действия, чтобы выполнить подключение.

1. На вкладке Главная на рабочем столе Power BI нажмите кнопку *получить данные*.

    ![Снимок экрана: соединитель Power BI](media/CQD-power-bi-connector1-resize.png)

2. На этом этапе появится окно " *Получение данных* ". Перейдите к *веб-службам*, а затем выберите *качество связи Майкрософт (Beta)* и нажмите кнопку *Подключиться*.

    ![Снимок экрана: соединитель Power BI](media/CQD-power-bi-connector2-resize.png)

3. Вам будет предложено войти далее. Используйте те же учетные данные, которые вы используете для CQD. <sup>2</sup>

4. В следующем запросе вы сможете выбрать два *режима подключения к данным*. Выберите *DirectQuery* и нажмите *ОК*.

5. Наконец, вам будет предложено выполнить Последнее предложение, показывающее всю модель данных для CQD. На этом этапе данные не будут видны, а только модель данных для CQD. Нажмите кнопку *загрузить* , чтобы завершить процесс настройки.

6. На этом этапе Power BI загрузит модель данных в правой части окна. Страница останется пустой, и никакие запросы не будут загружаться по умолчанию. Чтобы создать запрос и вернуть данные, перейдите к **созданию запросов** ниже.

Если какие-либо из действий, описанных в этом процессе настройки, не были полностью очищены, вы [можете найти более](https://docs.microsoft.com/power-bi/desktop-quickstart-connect-to-data)подробное описание процесса.

## <a name="building-queries"></a>Создание запросов

После завершения установки на панели *поля* должны отобразиться названия нескольких сотен измерений и показателей нагрузки. Создание реальных запросов с помощью этой функции очень просто: выберите нужные размеры и меры для запроса, а затем перетащите их на страницу. Ниже приведено более подробное описание, а вот простой пример.

1. Выберите визуализацию, которую вы хотите использовать, в области *зрительных образов* . На странице должна появиться пустая версия этого зрительного образа. Для целей этого примера мы будем использовать визуализацию *таблицы* .

    ![Снимок экрана: соединитель Power BI](media/CQD-power-bi-connector3-resize.png)

2. Определите, какие измерения и меры (обозначенные символом агрегирования по имени), которые вы хотите использовать для запроса, выбери их вручную и перетащите их на черную визуализацию. Кроме того, перетащите их в поле *значения* под параметрами зрительных образов.

    ![Снимок экрана: соединитель Power BI](media/CQD-power-bi-connector4-resize2.png)

    > [!IMPORTANT]
    > Для выполнения запроса на панели мониторинга качества звонков требуется мера. Ошибка при добавлении меры в запрос приведет к сбою запроса.

3. Затем выберите измерения, по которым вы хотите отфильтровать, и перетащите их в *фильтры для этого визуального* поля в области *фильтров* . Соединитель Power BI CQD в настоящее время *поддерживает базовую фильтрацию* (выбирайте значения из списка возможных значений измерения), *расширенную фильтрацию* (вручную указывайте значения и операнды для фильтрации, как в расширенном CQD) и *относительную фильтрацию по дате* (только для измерений *время окончания* и *начала* ). Фильтрация в соответствии с *Top N* не поддерживается CQD.

    ![Снимок экрана: соединитель Power BI](media/CQD-power-bi-connector5-resize.png)

4. Наконец, выберите вкладку *Формат* в области *зрительные образы* для стиля и форматирования запроса.

    > [!NOTE]
    > Для выполнения запросов CQD требуется хотя бы одна мера. Если запрос не загружается, дважды убедитесь, что вы включили в запрос меру.

## <a name="creating-a-drillthrough-report"></a>Создание детализированного отчета

[Детализация в Power BI](https://docs.microsoft.com/power-bi/desktop-drillthrough) позволяет создавать отсортированные отчеты, которые можно быстро отфильтровать с использованием значений других отчетов в качестве контекста. После того как вы знаете, как создать первый запрос с помощью соединителя CQD, создание детализации стало еще проще.

1. Создайте другую страницу для отчета с фокусом, а затем добавьте на эту страницу запросы.

2. Выберите измерение, которое вы хотите использовать в качестве фильтра детализации, и перетащите его в поле *Детализация* в области *зрительные образы* .

    ![Снимок экрана: соединитель Power BI](media/CQD-power-bi-connector6-resize.png)

3. **Ну вот\!** Любой другой запрос на другой странице, использующий это измерение, теперь может иметь детализацию на эту страницу, автоматически применяя значение измерения детализации в качестве фильтра.

    ![Снимок экрана: соединитель Power BI](media/CQD-power-bi-connector7-resize.png)

В отличие от Advanced CQD, Power BI поддерживает непоследовательную детализацию. Пока запрос содержит необходимое измерение, оно может быть детализировано до любой другой страницы.

### <a name="best-practice"></a>Практические рекомендации

Запросы на соединитель качества звонков должны быть спроектированы с учетом функциональных возможностей детализации. Вместо того, чтобы загружать сразу все данные, а затем разбить их на части с помощью фильтров, начните с запросов с большим количеством элементов, а также детализировать запросы с большим количеством запросов. Например, при попытке выявить подсети, которые применяют наиболее высокое качество, полезно сначала определить регионы и страны, которые применяют проблему, а затем перейти к подсетям в этой стране или регионе. Шаблон соединителя качества звонков разработан таким образом, чтобы действовать как пример.

## <a name="limitations"></a>Предел

Несмотря на использование Power BI, не все функции Power BI поддерживаются соединителем CQD в результате ограничений на модель данных CQD или соединители DirectQuery в целом. В списке ниже описаны некоторые более заметные ограничения для соединителя, но этот список не должен считаться исчерпывающим:

1. **Вычисляемые столбцы —** Соединители DirectQuery в общем имеют ограниченную поддержку для вычисляемых столбцов в Power BI. Хотя некоторые вычисляемые столбцы могут работать с соединительной линией, они должны считаться исключениями. В качестве общего правила вычисляемые столбцы не будут работать.

2. **Агрегаты —** Модель данных CQD строится на основе модели Куба, то есть агрегаты уже поддерживаются в форме мер. При попытке вручную добавить агрегаты в различные измерения или изменить тип статистической обработки для меры не будет работать с соединительной линией, а обычно это приведет к ошибке.

3. **Пользовательские визуальные элементы:** Несмотря на то, что соединитель CQD работает с диапазоном настраиваемых визуальных элементов, мы не можем гарантировать совместимость со всеми пользовательскими визуальными элементами. Многие пользовательские визуальные элементы основываются на использовании вычисляемых столбцов или импортированных данных, которые не поддерживаются соединителями DirectQuery.

4. **Обращение к кэшированным данным —** Power BI в настоящее время не поддерживает ссылки на кэшированные данные из соединительной линии DirectQuery каким-либо способом. Любая попытка сослаться на результаты запроса будет приводить к новому запросу.

5. **Фильтрация относительных данных —** Поддерживается в соединителе CQD, но только с измерениями " *время начала* " и " *время окончания* ". Несмотря на то, что измерение *дат* может быть очевидным вариантом относительной фильтрации по дате, *Дата* не сохраняется как объект даты и времени, поэтому не поддерживает относительную фильтрацию по дате в Power BI.

6. **Поддержка облачных сообществ для государственных организаций (GCC) –** Для пользователей в среде GCC соединитель Power BI CQD будет работать при использовании Power BI Desktop. Соединитель Power BI CQD в настоящее время не совместим с службой Power BI для пользователей GCC.

Обратите внимание, что несмотря на то, что соединительная линия в предварительной версии, скорее всего, вы не сможете изменить эти ограничения в окончательном выпуске соединителя. Большинство из этих проблем являются ограничениями проектирования соединителей DirectQuery в Power BI или основы для разработки модели данных CQD.

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="im-trying-to-use-the-date-column-as-a-date-slicer-as-soon-as-i-convert-the-data-type-of-this-column-to-date-i-get-this-error"></a>Я пытаюсь использовать столбец "Дата" в качестве среза даты. После преобразования типа данных этого столбца в дату появляется это сообщение об ошибке

> **Не удалось загрузить данные для этого визуального**элемента: OLE DB или ODBC Error: [expression. Error] нам не удалось сложить это выражение с источником данных. Пожалуйста, попробуйте более простое выражение.

Срезы дат не поддерживаются с помощью соединителя Power BI. Чтобы задать диапазон дат, примените к отчету два фильтра, указав значение меньше или больше даты.

Кроме того, если вы хотите просмотреть последние даты, примените относительный фильтр по дате, чтобы отобразить только данные за последние N дней/недель/месяцев.

## <a name="error-codes"></a>Коды ошибок

Поскольку соединитель Power BI CQD менее ограничен, чем приложение браузера, в том числе типов запросов, которые вы можете конструировать, при построении запросов может возникнуть ряд ошибок. В том случае, если вы получаете сообщение об ошибке с типом "CQDError. RunQuery — ошибка выполнения запроса. для устранения возможной проблемы с запросом щелкните приведенный ниже список, чтобы указать номер ErrorType. Ниже перечислены наиболее распространенные коды ошибок, которые могут возникать при использовании соединителя Power BI CQD:

- **ErrorType 1 — ошибка в структуре запроса:** Ошибка структуры запроса обычно возникает из-за того, что соединитель не завершил создание правильно отформатированного запроса. Это происходит чаще всего при использовании неподдерживаемой функции, как указано в описанных выше ограничениях. Убедитесь, что вы не используете вычисляемые столбцы или пользовательские визуальные элементы для этого запроса.

  - **ErrorType 2 — ошибка построения запроса:** Ошибка построения запроса, вызванная тем, что соединитель CQD не смог правильно разобрать запрос, который вы пытаетесь построить. Это происходит чаще всего при использовании неподдерживаемой функции, как указано в описанных выше ограничениях. Убедитесь, что вы не используете вычисляемые столбцы или пользовательские визуальные элементы для этого запроса.

  - **ErrorType 5 — время ожидания выполнения:** Запрос достиг максимально возможного времени выполнения. Попробуйте добавить в запрос дополнительные фильтры, чтобы ограничить их область. Чтобы добиться этого, очень удобно сузить диапазон данных.

  - **ErrorType 7 — ошибки без единиц измерения:** Для функционирования запросов CQD требуется измерение. Дважды убедитесь, что запрос содержит меру. Меры в соединителе CQD обозначаются символом агрегирования (SUM) перед его именем.

Если вы столкнулись с дополнительными ошибками за пределами этой области, пожалуйста, уведомите группу CQD, чтобы мы смогли устранить эту проблему и при необходимости обновить документацию.

## <a name="footnotes"></a>Обычных

**<sup>1</sup>** . Некоторые процессы и приложения (например, OneDrive) могут привести к изменению корневой папки "документы". Убедитесь в том, что каталог * \\ настраиваемых соединителей на рабочем СТОЛЕ Power BI* помещен в текущую папку "документы корневой папки".

**<sup>2</sup>** . учетные данные для входа, используемые для CQD, *не* должны совпадать с учетными данными, которые используются для входа в классическое приложение Power BI.

## <a name="frequently-asked-questions"></a>Вопросы и ответы

### <a name="when-will-the-power-bi-connector-be-updated-from-beta-status"></a>Когда будет обновлен соединитель Power BI с "бета-состояние"

Несмотря на метку бета-версии, соединитель качества связи для Power BI является выпускной версией соединителя и является официальной безопасностью, подписанной командой Power BI, для ее отражения. Процесс сертификации для удаления этого тега бета-версии является значительным и требует подтверждения от команды Power BI для обеспечения прямой поддержки соединительной линии. Из-за ограничений по времени группа Power BI не может предоставить такую техническую поддержку и более обширную сертификацию, но по-прежнему готова к утверждению безопасности, подлинности и общей функциональности соединителя качества звонков Microsoft.

### <a name="why-does-the-connector-seem-slower-compared-to-advanced-cqd-in-the-browser-what-can-i-do-to-improve-performance"></a>Почему соединительная линия кажется медленнее по сравнению с расширенными CQD в браузере? Что можно сделать, чтобы улучшить производительность

Производительность запросов для различных шаблонов в действительности одинакова в браузере и в соединительной линии.  Так же, как и любое другое автономное приложение, Power BI добавляет проверку подлинности и время отрисовки к нашему снижению производительности. Кроме того, разница определяется количеством выполняемых параллельных запросов. Поскольку версия CQD в браузере имеет менее качественно разработанные и более сжатые параметры визуализации, большая часть наших отчетов была ограничена загрузкой запросов 2-3 за один раз. С другой стороны, шаблоны соединителей часто отображают 20 + параллельных запросов. Если вы хотите, чтобы вы работали с отчетами, а не более ранними, чем вы использовались, попробуйте создавать отчеты, не превышающие 2-3 запросов на каждую вкладку.

Дополнительные сведения можно найти в следующих статьях:

- [Руководство по оптимизации для Power BI](https://docs.microsoft.com/power-bi/guidance/power-bi-optimization)
- [Руководство по моделям DirectQuery](https://docs.microsoft.com/power-bi/guidance/directquery-model-guidance)

### <a name="i-find-that-i-routinely-run-into-the-10000-row-limit-when-running-queries-how-can-i-get-the-connector-to-return-more-than-10000-rows"></a>Я могу присоединиться к ограничению строки 10 000 при выполнении запросов. Как сделать так, чтобы соединитель возвращал больше 10 000 строк

Ограничение на количество строк в 10 000 в действительности задается на окончании API-интерфейса, и оно предназначено для повышения производительности и снижения риска ошибок при выполнении запроса, полученных из-за нехватки памяти.

Вместо того, чтобы попытаться увеличивать количество строк результатов, лучше структурировать отчеты согласно рекомендациям по соединительной линии. Шаблоны, которые мы включили, предназначены для демонстрации этих рекомендаций. Там, где это возможно, начните с просмотра ключевых показателей эффективности с помощью более широкой и более узкой размерности, например месяц, год, Дата, регион, страна и т. д. В этом случае вы можете детализировать все более высокие измерения. В справочных службах и расширенных отчетах о местонахождении есть хорошие примеры этого рабочего процесса детализации.



## <a name="related-topics"></a>Статьи по теме

[Анализ данных CQD для Teams с помощью Power BI](CQD-Power-BI-query-templates.md)
