---
title: Отслеживание и устранение неполадок прямой маршрутизации
ms.reviewer: ''
ms.author: crowe
author: CarolynRowe
manager: serdars
audience: ITPro
ms.topic: troubleshooting
ms.service: msteams
localization_priority: Normal
search.appverid: MET150
ms.collection:
- M365-voice
appliesto:
- Microsoft Teams
f1.keywords:
- NOCSH
description: В этой статье описано, как отслеживать и устранять проблемы с настройкой прямой маршрутизации.
ms.openlocfilehash: 5dcae4d734c146c92c0cda4ac988d6010f90cc6f
ms.sourcegitcommit: ed3d7ebb193229cab9e0e5be3dc1c28c3f622c1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2020
ms.locfileid: "41836049"
---
# <a name="monitor-and-troubleshoot-direct-routing"></a>Отслеживание и устранение неполадок прямой маршрутизации

В этой статье описано, как отслеживать и устранять проблемы с настройкой прямой маршрутизации. 

Возможность совершать и принимать звонки с помощью Direct Routing состоит из следующих компонентов: 

- Контроллеры границ сеансов (SBCs) 
- Прямые компоненты маршрутизации в Microsoft Cloud 
- Коммуникационные магистрали 

Если у вас возникли проблемы при устранении неполадок, вы можете открыть обращение в службу поддержки с поставщиком SBC или корпорацией Майкрософт. 

Корпорация Майкрософт работает над предоставлением дополнительных инструментов для устранения неполадок и мониторинга. Пожалуйста, периодически проверяйте документацию на наличие обновлений. 

## <a name="monitoring-availability-of-session-border-controllers-using-session-initiation-protocol-sip-options-messages"></a>Наблюдение за доступностьми контроллеров границ сеанса с помощью сообщений параметров протокола запуска сеанса (SIP)

Прямая маршрутизация использует параметры SIP, отправленные контроллерами границ сеанса для мониторинга работоспособности SBC. Для включения наблюдения за параметрами SIP в администраторе клиента не требуется никаких действий. Собранные сведения учитываются при принятии решений о маршрутизации. 

Например, если для определенного пользователя доступно несколько однородных данных для маршрутизации звонка, прямая маршрутизация рассматривает сведения о параметрах SIP, полученные от каждого SBC, для определения маршрутизации. 

На приведенной ниже схеме показан пример конфигурации. 

![Пример настройки параметров SIP](media/sip-options-config-example.png)

Когда пользователь выполняет звонок на номер + 1 425 \<в любой семь цифр>, прямая маршрутизация оценивает маршрут. В Route: sbc1.contoso.com и sbc2.contoso.com есть две SBCs. В маршруте есть одинаковый приоритет для обоих SBCs. Перед тем как выбрать объект SBC, механизм маршрутизации оценивает работоспособность SBCs на основе того, когда SBC отправляет параметры SIP в прошлый раз. 

SBC считается работоспособным, если статистика на момент отправки звонка показывает, что SBC отправляет параметры каждую минуту.  

При совершении звонка применяется следующая логика:

- SBC был парным в 11:00 AM.  
- Параметры SBC отправляются в 11:01 AM, 11:02 AM и т. д.  
- В 11:15 пользователь выполняет звонок, а механизм маршрутизации — для выбора этого SBC. 

Интервалы между прямыми маршрутами занимают три значения. обычно интервал составляет один минута. Если параметры были отправлены в течение последних трех минут, SBC считается работоспособным.

Если объект SBC в примере отправляется в любой точке между 11:12 AM и 11:15 AM (время совершения звонка), это считается работоспособным. В противном случае SBC будет понижен из маршрута. 

Понижение роли означает, что SBC не будет применяться первыми. Например, у нас есть sbc1.contoso.com и sbc2.contoso.com с одинаковым приоритетом.  

Если sbc1.contoso.com не отправляет параметры SIP в обычном интервале, как описано выше, это понизить уровень. Затем sbc2.contoso.com пытается позвонить. Если sbc2. contoso. Con не может допустить звонок, то sbc1.contoso.com (понижение роли) предпринимается повторно, пока не будет создан сбой. 

Если две (или более) SBCs в одном маршруте считаются работоспособными и равны, функция Фишер-Ятес перемещается в случайном порядке, которая применяется для передачи вызовов между SBCs.

## <a name="monitor-call-quality-analytics-dashboard-and-sbc-logs"></a>Наблюдение за анализом качества связи на информационной панели и в журналах SBC 
 
В некоторых случаях, особенно при первоначальном связывании, могут возникать проблемы, связанные с невозможностью настройки SBCs или прямой маршрутизации. 

Для мониторинга конфигурации можно использовать следующие инструменты:  
 
- Панель мониторинга качества вызовов 
- Журналы SBC 

У службы прямой маршрутизации есть очень описательные коды ошибок, которые выводятся в разделе анализ звонков или в журналы SBC. 

На панели мониторинга качества звонков содержатся сведения о качестве и надежности связи. Подробнее о том, как устранять неполадки с помощью средства аналитики звонков, приведены в [статье Включение и использование панели мониторинга качества звонков для Microsoft Teams и Skype для бизнеса Online](https://docs.microsoft.com/SkypeForBusiness/using-call-quality-in-your-organization/turning-on-and-using-call-quality-dashboard) и [Использование средства аналитики звонков для устранения](https://docs.microsoft.com/SkypeForBusiness/using-call-quality-in-your-organization/use-call-analytics-to-troubleshoot-poor-call-quality)некачественной связи. 

В случае отказов в вызовах аналитика звонков предлагает стандартные коды SIP, которые помогут вам устранить неполадки. 

![Образец кода SIP для отказа в звонке](media/failed-response-code.png)

Тем не менее, служба поддержки может помогать вам только в том случае, если во время звонков достигается внутренний компонент Direct Routing. В случае проблем с связыванием или проблемами с SBC, в которых было отказано в использовании SIP "INVITE" (например, неправильно настроено имя узла магистральной магистрали), средство анализа вызовов не поможет. В этом случае вы можете обратиться к журналам SBC. Прямая маршрутизация отправляет подробное описание проблем с SBCs-записью; Эти проблемы можно прочитать в журналах SBC. 
