---
title: Мониторинг прямой маршрутизации
ms.reviewer: ''
ms.author: crowe
author: CarolynRowe
manager: serdars
audience: ITPro
ms.topic: troubleshooting
ms.service: msteams
ms.localizationpriority: medium
search.appverid: MET150
ms.collection:
- M365-voice
appliesto:
- Microsoft Teams
f1.keywords:
- NOCSH
description: Узнайте, как отслеживать и устранять неполадки конфигурации прямой маршрутизации, включая пограничные контроллеры сеансов, компоненты прямой маршрутизации и магистрали телекоммуникаций.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 47a86e8dd98cdb86cd698b187b21453daa003b07
ms.sourcegitcommit: 9de6b0b03f433e71fe239d292387eed33c11b531
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2022
ms.locfileid: "67657249"
---
# <a name="monitor-direct-routing"></a>Мониторинг прямой маршрутизации

В этой статье описывается мониторинг и устранение неполадок конфигурации прямой маршрутизации. 

Возможность совершать и принимать вызовы с помощью прямой маршрутизации включает в себя следующие компоненты: 

- Пограничные контроллеры сеансов (SBC) 
- Компоненты прямой маршрутизации в Microsoft Cloud 
- Магистрали телекоммуникаций 

Если у вас возникли проблемы с устранением неполадок, обратитесь в службу поддержки к поставщику SBC или корпорации Майкрософт. 

Корпорация Майкрософт работает над предоставлением дополнительных средств для устранения неполадок и мониторинга. Периодически проверяйте наличие обновлений в документации. 

## <a name="troubleshoot-direct-routing"></a>Устранение неполадок прямой маршрутизации

Сведения об устранении неполадок прямой маршрутизации см. в разделе ["Диагностика проблем с прямой маршрутиза службой](/MicrosoftTeams/troubleshoot/phone-system/direct-routing/diagnose-direct-routing-issues)".

## <a name="monitoring-availability-of-session-border-controllers-using-session-initiation-protocol-sip-options-messages"></a>Мониторинг доступности пограничных контроллеров сеансов с помощью сообщений параметров протокола Инициации сеанса (SIP)

Прямая маршрутизация использует параметры SIP, отправляемые пограничными контроллерами сеансов для мониторинга работоспособности SBC. Для включения мониторинга параметров SIP администратор клиента не должен выполнять никаких действий. Собранные сведения принимаются во внимание при принятии решений о маршрутизации. 

Например, если для определенного пользователя существует несколько контроллеров SBC, доступных для маршрутизации вызова, прямая маршрутизация рассматривает сведения о параметрах SIP, полученные от каждого SBC, для определения маршрутизации. 

На следующей схеме показан пример конфигурации: 

![Пример конфигурации параметров SIP.](media/sip-options-config-example.png)

Когда пользователь вызывает номер +1 425 \<any seven digits>, прямая маршрутизация оценивает маршрут. В маршруте есть два контроллера SBC: sbc1.contoso.com и sbc2.contoso.com. Оба контроллера SBC имеют одинаковый приоритет в маршруте. Перед выбором SBC механизм маршрутизации оценивает работоспособность SBC на основе того, когда SBC отправил параметры SIP в последний раз. 

SBC считается работоспособным, если статистика на момент отправки вызова показывает, что SBC отправляет параметры каждую минуту.  

При вызове применяется следующую логику:

- SBC был связан в 11:00.  
- SBC отправляет параметры в 11:01, 11:02 и т. д.  
- В 11:15 пользователь выполняет вызов, и механизм маршрутизации выбирает этот SBC. 

Прямая маршрутизация принимает параметры регулярного интервала три раза (обычный интервал — одна минута). Если параметры были отправлены в течение последних трех минут, SBC считается работоспособным.

Если SBC в примере отправил параметры в любой период между 11:12 и 11:15 (время вызова), он считается работоспособным. В противном случае SBC будет понижен с маршрута. 

Понижение уровня означает, что SBC не будет использоваться в первую очередь. Например, у нас есть sbc1.contoso.com и sbc2.contoso.com с одинаковым приоритетом.  

Если sbc1.contoso.com не отправляет параметры SIP через регулярный интервал, как описано выше, оно понижается. Затем sbc2.contoso.com пытается выполнить вызов. Если sbc2.contoso.con не удается доставить вызов, sbc1.contoso.com (пониженный) будет предпринята еще раз перед созданием сбоя. 

Если два (или более) SBC в одном маршруте считаются работоспособными и равными, Fisher-Yates для распределения вызовов между SBC.

## <a name="monitor-call-quality-analytics-dashboard-and-sbc-logs"></a>Мониторинг панели мониторинга аналитики качества звонков и журналов SBC 
 
В некоторых случаях, особенно во время начального связывания, могут возникнуть проблемы, связанные с неправильной настройкой контроллеров безопасности или службой прямой маршрутизации. 

Для мониторинга конфигурации можно использовать следующие средства:  
 
- Панель мониторинга качества вызовов 
- Журналы SBC 

Служба прямой маршрутизации содержит описательные коды ошибок, передаваемые в аналитику звонков или в журналы SBC.

Панель мониторинга качества звонков предоставляет сведения о качестве и надежности звонков. Дополнительные сведения об устранении неполадок с помощью аналитики звонков см. в статье "Включение и использование панели мониторинга качества звонков для [Microsoft Teams и Skype для бизнеса Online](/SkypeForBusiness/using-call-quality-in-your-organization/turning-on-and-using-call-quality-dashboard) и использование аналитики звонков для устранения неполадок низкого качества [звонков".](/SkypeForBusiness/using-call-quality-in-your-organization/use-call-analytics-to-troubleshoot-poor-call-quality) 

В случае сбоев звонков аналитика звонков предоставляет стандартные коды SIP, которые помогут вам в устранении неполадок. 

![Пример кода SIP для сбоя вызова.](media/failed-response-code.png)

Однако аналитика звонков может помочь только в том случае, если вызовы достигают внутренних компонентов прямой маршрутизации и завершались сбоем. В случае проблем с связываниями SBC или проблем с отклонением SIP "Invite" (например, неправильно настроено имя полного доменного имени магистрали) аналитика звонков не поможет. В этом случае см. журналы SBC. Прямая маршрутизация отправляет подробное описание проблем в контроллеры SBC. эти проблемы можно прочитать из журналов SBC.
