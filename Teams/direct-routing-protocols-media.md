---
title: Телефон обзор прямой маршрутии системы
author: CarolynRowe
ms.author: crowe
manager: serdars
ms.date: 01/28/2019
ms.topic: article
ms.service: msteams
audience: admin
ms.collection:
- Teams_ITAdmin_Help
- M365-voice
ms.reviewer: nmurav
search.appverid: MET150
f1.keywords:
- NOCSH
description: hHw Direct Routing поддерживает обход мультимедиа, если для ICE Lite включен контроллер границы сеанса.
appliesto:
- Microsoft Teams
ms.openlocfilehash: c32838d282d6f5fff5eb1e85c36d78eee8828d41
ms.sourcegitcommit: 97c2faab08ec9b8fc9967827883308733ec162ea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/13/2021
ms.locfileid: "58234574"
---
# <a name="overview"></a>Обзор

В этой статье описано, как прямая маршрутизирование поддерживает обход мультимедиа с помощью контроллера границы сеанса (SBC) для ICE Lite, как описано в [RFC 5245.](https://tools.ietf.org/html/rfc5245) Эта статья предназначена для администраторов голосовой связи, которые отвечают за настройку подключения между локальной службой SBC и прокси-службой SIP.

В этой статье приводится обзор сценариев и требований ICE Lite для обеспечения связи. В этой статье описаны форматы сообщений и необходимые переходы между компьютерами для обеспечения надежного потока звонка и передачи мультимедиа.

## <a name="terminology"></a>Терминологии

- First Hello — первые слова, произнесенные звонив и звонив. Важно сделать все возможное, чтобы обеспечить надежное доставку первых пакетов с конечных точек в большинстве случаев использования.

- Forking — предложение от вызываемой стороны может быть доставлено на несколько конечных точек, если вызывающий пользователь доступен на нескольких устройствах (например, пользователь Teams может быть подписан на Teams для Windows и Teams для Android или iPhone).

- Временный ответ (183). Конечные точки для ускорения настройки звонка отправят ответ с кандидатами и ключами, необходимыми для настройки потока мультимедиа. Это делается в том случае, если пользователь может ответить на звонок (200OK) из определенного экземпляра. При помощи функции предварительного вызова вызывающий должен быть готов получить несколько предварительных ответов.

- Re-Invite — предложение с конечными кандидатами, выбранными управляющей конечной точкой ICE. Атрибут a=remote-candidate будет иметь атрибут a=remote-candidate для устранения любых условий соревнований при обработке нескольких вилок.

- Teams Конечная точка: это может быть сервер (процессор мультимедиа, ретранслятор транспорта) Teams клиента.

## <a name="message-format"></a>Формат сообщения

Инфраструктура Teams будет следовать за RFC 5245 для ICE-Lite. Это подразумевает, что все сообщения STUN соответствуют [RFC 5389.](https://tools.ietf.org/html/rfc5389)

В SBCs, как требуется RFC 5389, необходимо игнорировать все атрибуты STUN, которые они не распознают, и продолжать обрабатывать сообщения с известными атрибутами. 

При получении неформатированной упаковки пакеты необходимо удалить, не влияя на сеанс мультимедиа.

## <a name="ice-lite-requirements"></a>Требования ICE Lite

В этом разделе кратко фиксироваться требования для ICE Lite.

### <a name="candidate-gathering"></a>Соищание кандидатов

В SBC должен быть только один кандидат, с который можно будет связаться с общественностью. В настоящее время поддерживается только IPV4-кандидатов.


#### <a name="connectivity-checks"></a>Проверки подключения

Внедрение ICE Lite должно реагировать на все полученные проверки подключения. Конечная точка ICE Lite не должна отправлять запросы на проверку подключения. (Если проверки подключения отправляются с нарушением, будет реагировать полная реализация, что может привести к обнаружению потенциальных кандидатов, которые не являются однорангами, и, возможно, привести к сбоям звонка.)

#### <a name="nominations"></a>Номинациях

Конечной точкой полной реализации ICE всегда будет контрольная конечная точка, и она будет следовать за тем, как выбрать окончательных кандидатов, которые будут использоваться для потока мультимедиа. Конечная точка ICE Lite может использовать эти средства, чтобы завершить путь к использованию мультимедиа и завершить вызов.

Примечание. Если одноранговые конечные точки отправляют 183 предварительных ответа, SBC должен быть готов к реагированию на проверки с нескольких конечных точек, а также с нескольких конечных точек, если до 200 года произойдет такое же количество ответов. В зависимости от сходимости компьютера ice к конечному пути и времени ответа пользователя, эти действия могут произойти до или после 200OK. У SBC должна быть возможность обработки обоих случаев.

#### <a name="converging-for-forking"></a>Сходящиеся для разгона

Если предложение SBC предлагается для нескольких конечных точек Teams, Teams могут отвечать с помощью предварительного ответа и запуска проверки подключения. SBC должен быть подготовлен к приему проверок подключения и реагированию на проверки подключения с нескольких конечных точек. Например, можно Teams на рабочий стол и мобильный телефон. Оба устройства будут уведомлены о входящий звонок и попытаются проверки подключения с помощью SBC.

В конечном итоге только одна из конечных точек ответит на звонок (200OK). Получив пакет 200OK, SBC может настроить контекст для обработки пакетов мультимедиа.

## <a name="scenarios"></a>Scenarios

###  <a name="inbound-call-from-sbc"></a>Входящий звонок из SBC

В этом сценарии существует несколько конечных точек, которые должны обрабатываться СКА.

- Как правило, конечные точки сервера отвечают непосредственно в 200OK. Это полные конечные точки ICE, которые обычно участвуют в сценариях голосовой почты, очереди зовов и автоответчиков.

- Конечные точки клиента могут отправлять несколько предварительных ответов с разными тегами "От" и "На" (183), за которыми следует 200OK с конечной точки, которая отвечает на звонок. Это полные конечные точки ICE, которые обычно представляют клиенты конечных пользователей.

- Другие конечные точки SBC. Это конечные точки ICE Lite, обычно участвующие в сценарии одновременных звонков на конечные точки клиента и другие телефонные номера.

SBC должен отвечать на все допустимые запросы проверки подключения, полученные от полных конечных точек ICE. В RFC полные конечные точки ICE становятся контрольным конечными точками. Конечные Teams (клиенты или серверы) выполняют "Обычные" проверки подключения. Итоговая 200Ok может быть либо с конечной точки, отправив раннее мультимедиа, либо с другой конечной точки. При получении 200Ok SBC должен настроить контекст для потока мультимедиа. 

###  <a name="early-media"></a>Ранние мультимедиа

Если имеется ранний поток мультимедиа, SBC должен быть защелковым к первой конечной точке, которая запускает потоковую передачу мультимедиа; Поток мультимедиа может начаться до того, как будут назначены кандидаты. На этом этапе УАЦ должна поддерживать отправку DTMF, чтобы включить сценарии IVR и голосовой почты. В SBC следует использовать путь с наивысшим приоритетом, по которому он получает проверки, если не выполнены все задачи.

### <a name="outbound-call-to-sbc"></a>Исходящие вызовы на SBC

Конечные Teams являются вызывающим в этом сценарии и будут управляющей конечной точкой. При получении предварительного ответа (183) или окончательного ответа (200OK) конечная точка Teams начнет проверки подключения и переходит к обычным( для завершения проверок подключения).

Примечание. Если SBC отправляет предварительный ответ (183), он должен быть готов получать запросы на проверку подключения и, возможно, завершить проверку перед отправкой 200OK. Если проверки и(или) проверки завершались до 2000 года, то после 200 года проверки и/или проверки не будут выполняться повторно. SBC не должен изменять ice candidates, password и ufrag (фрагмент имени пользователя) между 183 и 200.

Для поддержки ранних сетей мультимедиа SBC может начать потоковую передачу мультимедиа на одноранговую службу ICE с наивысшим приоритетом на основе полученных проверок подключения, еще до того, как Teams конечной точкой. В SBC следует ожидать, что Teams со всех кандидатов, пока не будут завершены все кандидаты. После того как будет назначен кандидат, SBC должен восстановить контекст, чтобы отправлять и получать пакеты мультимедиа.

## <a name="srtp-support-requirements"></a>Требования к поддержке SRTP

SBC должен поддерживать шифрование SRTP AES_CM_128_HMAC_SHA1_80 для предложения и ответа в следующем формате:

```console
"inline:" <key||salt> ["|" lifetime]
```

Ниже приводится пример криптографа в предложении SDP из SBC:

```console
a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:V/Lr6Lsvhad/crSB9kCQ28jrYDxR2Yfk5bXryH5V|2^31
```

Параметры MKI и Length не требуются.

Дополнительные сведения см. в разделе [RFC 4568(раздел 6.1).](https://tools.ietf.org/html/rfc4568#section-6.1)

## <a name="sdes-support-requirements"></a>Требования к поддержке SDES

Устройство должно иметь возможность предлагать SDES в формате, как описано ниже. Процессоры Microsoft Media Всегда предпочитают SDES.

- При обходе без мультимедиа, даже если клиент поддерживает только DTLS, процессоры мультимедиа преобразуются в SDES.

- При обходе мультимедиа, если клиент использует только DTLS (будущий штат Google Chrome), Прямая маршрутия вставит MP в путь, преобразуя звонок из обхода мультимедиа в обход мультимедиа. Между компонентом SBC и процессором мультимедиа direct Routing всегда используется SDES.

В настоящее время клиент Teams, который предлагает только DTLS, не существует. Однако Google объявил, что в какой-то момент времени прекратит поддержку SDES.

## <a name="format-for-offer-from-sbc-in-bypass-mode"></a>Формат предложения из SBC в режиме обхода 

Предложение должно содержать SDES и может содержать необязательный DTLS в следующем формате:

```console
m=audio 54056 UDP/TLS/RTP/SAVP 0 8 76 77 18 9 101 13
a=rtcp:54056
a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:krXco0QRglwErMqtbMs2zSw29tBdmdgXpEYZhQmp|2^31
a=fingerprint:sha-256 AE:24:07:15:5C:B7:45:1A:E4:45:60:C1:1E:68:0E:CC:8D:A6:78:3B:76:65:BB:B0:77:88:07:F8:98:18:62:34
a=setup:actpass
a=rtcp-mux
```

### <a name="format-for-answer-containing-sdes-to-sbc"></a>Формат ответа, содержащего SDES в SBC

```console
m=audio 54056 RTP/SAVP 111 103 104 9 0 8 description 106 13 110 112 113 126
a=rtcp:54056
a=crypto:2 AES_CM_128_HMAC_SHA1_80 inline:fBc61ikv1kMy0sF85DblNqTzVAbFa7hJQ9GKb6Yj|2^31|1:1
a=crypto:3 AES_CM_128_HMAC_SHA1_80 inline:O1qT9tWbs/NwJVwhfrgF5tCrbNOxnVDqkIqTx4rz|2^31
a=rtcp-mux

```

## <a name="format-for-offer-from-teams-to-sbc"></a>Формат предложения от Teams до SBC 

### <a name="format-for-sdes-only-offer-to-sbc"></a>Формат SDES предлагается только SBC

```console
m=audio 52884 RTP/SAVP 111 103 104 9 0 8 106 13 110 112 113 126
a=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:Hr4D2cgUu9+Uza5Igz/JkVx59DAxDbaxJg862ibQ|2^31
a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:JPEaIxHegfuv53ykBPZk8hV0GO8kTiiqRMfHimEE|2^31
a=rtcp:52884
a=rtcp-mux
```

