---
title: Установка интеграции Moodle с Microsoft Teams
author: DaniEASmith
ms.author: danismith
manager: serdars
ms.topic: article
ms.service: msteams
audience: admin
ms.reviewer: ''
search.appverid: MET150
description: Узнайте, как установить и настроить приложение Moodle с открытым Обучение системы управления (LMS) для Microsoft Teams.
keywords: Подключаемый модуль интеграции приложения Moodle для Teams
ms.localizationpriority: medium
f1.keywords:
- NOCSH
ms.collection:
- M365-collaboration
ms.custom:
- seo-marvel-apr2020
- seo-marvel-mar2020
appliesto:
- Microsoft Teams
ms.openlocfilehash: 1c6118fe7f9ffe00eb9b8cb657d1a6ea3221311b
ms.sourcegitcommit: 766199440a152d97c95c2c45b7c4654815e64d9a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/25/2022
ms.locfileid: "62963390"
---
# <a name="installing-the-moodle-integration-with-microsoft-teams"></a>Интеграция Moodle с Microsoft Teams 

> [!VIDEO https://www.youtube.com/embed/OHlPt22nKoE]

[Moodle](https://moodle.org/) — самая популярная система управления обучением (LMS) с открытым кодом в мире теперь интегрируется с Microsoft Teams! Эта интеграция позволяет педагогам и преподавателям совместно работать над курсами Moodle, задавать вопросы об оценках и заданиях, а также получать уведомления прямо в приложении Teams!

Чтобы помочь ИТ-администраторам легко настроить эту интеграцию, мы обновили подключаемый модуль Moodle Plugin с открытым кодом со следующими возможностями:

* Автоматическая регистрация сервера Moodle в Azure AD.
* Развертывание бота-помощника Moodle в Azure одним щелчком мыши.
* Автоматическая подготовка команд и автоматическая синхронизация их регистраций во всех или выбранных курсах Moodle.
* Автоматическая установка вкладки Moodle и бота-помощника Moodle в каждой синхронизированной команде (ожидается в ближайшее время).
* Публикация приложения Moodle в закрытом магазине приложений Teams одним щелчком мыши (ожидается в ближайшее время).

Дополнительные информацию о функциях, которые предоставляет эта интеграция, см. в этой [Microsoft Teams.](/microsoftteams/platform/resources/moodleinstructions)

## <a name="prerequisites"></a>Необходимые компоненты

Чтобы установить и настроить это приложение, требуется следующее:

1. Учетные данные администратора Moodle
2. Учетные данные администратора Azure AD
3. Подписка на Azure, в которой можно создавать ресурсы

## <a name="step-1-install-the-moodle-plugin"></a>Шаг 1. Установка подключаемой модуль Moodle

> [!VIDEO https://www.youtube.com/embed/SETEC5nzMgk]

Интеграция Moodle в Microsoft Teams с помощью подключаемой надстройки [Moodle с открытым кодом](https://github.com/Microsoft/o365-moodle). Чтобы установить подключаемый модуль на сервере Moodle, выполните следующее:

1. Сначала скачайте набор [подключаемых модульов Moodle](https://moodle.org/plugins/pluginversions.php?plugin=local_o365) и сохраните его на локальном компьютере. Необходимо использовать версию 3.5 или более позднюю.
    * При установке подключаемого модуля local_o365 также устанавливаются подключаемые модули [auth_oidc](https://moodle.org/plugins/auth_oidc) и [boost_o365Teams](https://moodle.org/plugins/pluginversions.php?plugin=theme_boost_o365teams).
1. Во sign in to your Moodle server as an administrator, and select **Site administration** from the left navigation panel.
1. Откройте вкладку **Подключаемые модули** и щелкните **Установить подключаемые модули**.
1. В разделе **Установить подключаемый модуль из ZIP-файла** нажмите кнопку **Выбрать файл**.
1. Выберите Upload **в** области навигации слева, найдите файл, который вы скачали выше, **Upload файл**.
1. В левой области навигации снова выберите параметр **Администрирование сайта**, чтобы вернуться к панели мониторинга администратора. Прокрутите страницу до раздела **Локальные подключаемые модули** и щелкните ссылку **Интеграция с Microsoft Office 365**. Оставьте эту страницу настройки открытой в отдельной вкладке браузера, так как она потребуется в ходе этого процесса.

Дополнительные сведения об установке подключаемых модулей Moodle см. в [документации по Moodle](https://docs.moodle.org/34/en/Installing_plugins).

**Важное примечание.** Не открывая Microsoft 365 или Office 365-подключаемого модульа Moodle, на отдельной вкладке браузера, так как вы будете возвращаться к этому набору страниц на протяжении всего процесса.

*У вас еще нет сайта Moodle?* Вы можете обратиться к нашему [репозиторию](https://github.com/azure/moodle) Moodle в Azure, где можно быстро развернуть экземпляр Moodle в Azure и настроить его под свои потребности.

## <a name="step-2-configure-the-connection-between-the-microsoft-365-or-office-365-plugin-and-azure-active-directory"></a>Шаг 2. Настройка подключения между подключаемым Microsoft 365 или Office 365 и Azure Active Directory

> [!VIDEO https://www.youtube.com/embed/FpGEezaJ3SA]

Затем требуется зарегистрировать Moodle в качестве приложения в Azure Active Directory. Мы предоставили скрипт PowerShell для выполнения этого процесса. Сценарий PowerShell подстроит новое приложение Azure AD для вашей Microsoft 365 или Office 365 организации, которое будет использоваться модульом Moodle Plugin. Сценарий подстроит приложение для клиента Microsoft 365 или Office 365, настроит для него все необходимые URL-адреса и разрешения для ответа, а затем возвратит AppID и ключ. Вы можете использовать созданные AppID и Key на странице настройки подключаемого модульа Moodle для настройки сервера Moodle Server с помощью Azure AD. Подробные сведения о действиях, автоматизируемых скриптом PowerShell, см. в полной [документации для подключаемого модуля](https://docs.moodle.org/34/en/Office365#Register_your_Moodle_instance_as_an_Application).

### <a name="moodle-tab-for-microsoft-teams-information-flow"></a>Поток данных вкладки Moodle для Microsoft Teams

<img width="530px" src="media/MoodleTabInformationFlow.png" alt="Illustration of Moodle tab for Microsoft Teams information flow" title="Изображение потока данных вкладки Moodle для Microsoft Teams" />

1. На странице Microsoft 365 или Office 365 Интеграция выберите **вкладку Настройка**.
1. Нажмите кнопку **Скачать скрипт PowerShell** и сохраните его на локальном компьютере.
1. Вам потребуется подготовить скрипт PowerShell из ZIP-файла. Для этого:
    * Скачайте и извлеките файл `Moodle-AzureAD-Powershell.zip`.
    * Откройте извлеченную папку.
    * Щелкните файл `Moodle-AzureAD-Script.ps1` правой кнопкой мыши и выберите пункт **Свойства**.
    * На вкладке **Общие** окна свойств, установите флажок `Unblock` рядом с атрибутом **Безопасность** в нижней части окна.
    * Нажмите кнопку **ОК**.
    * Скопируйте путь к извлеченной папке.
1. Затем запустите PowerShell от имени администратора.
    * Нажмите кнопку "Пуск".
    * Введите "PowerShell".
    * Щелкните правой кнопкой приложение Windows PowerShell.
    * Выберите пункт "Запуск от имени администратора".
1. Перейдите к извлеченному каталогу, введя `cd ...\...\Moodle-AzureAD-Powershell`, где `...\...` — путь к каталогу.
1. Запустите скрипт PowerShell, выполнив следующие действия:
    * Введите `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`.
    * Введите `.\Moodle-AzureAD-Script.ps1`.
    * Войдите в свою учетную Microsoft 365 или Office 365 учетную запись администратора во всплывающее окно.
    * Введите имя приложения Azure AD (например, Moodle или подключаемый модуль Moodle).
    * Введите URL-адрес сервера Moodle.
    * Скопируйте **идентификатор приложения** и **ключ приложения**, созданные скриптом, и сохраните их.
1. Затем нужно добавить ID и Key в подключаемый модуль Moodle. Вернись на страницу администрирования подключаемых модульов (администрирование сайта > подключаемых > Microsoft 365 Интеграция).
1. На вкладке **Настройка** добавьте **идентификатор приложения** и **ключ приложения**, скопированные ранее, и нажмите **Сохранить изменения**.
1. После обновления страницы отобразится новый раздел **Выбор метода подключения**. Установите флажок **По умолчанию** и снова нажмите кнопку **Сохранить изменения**.
1. После обновления страницы отобразится еще один новый раздел **Согласие администратора и дополнительные сведения**.
    * Щелкните **ссылку Предоставить** согласие администратора, введите свои Microsoft 365 или Office 365 учетные данные глобального администратора и  нажмите кнопку Принять, чтобы предоставить разрешения.
    * Нажмите кнопку **Определить** рядом с полем **Клиент Azure AD**.
    * Нажмите кнопку **Определить** рядом с полем **URL-адрес OneDrive для бизнеса**.
    * После заполнения полей снова нажмите кнопку **Сохранить изменения**.
1. Нажмите кнопку **Обновить**, чтобы проверить установку, затем нажмите **Сохранить изменения**.
1. После этого вам потребуется синхронизировать пользователей между сервером Moodle и Azure Active Directory. На этом этапе вы можете выбирать разные параметры в зависимости от вашей среды. Обратите внимание, что эта конфигурация будет применяться с каждым запуском программы cron Moodle (обычно раз в день) для обеспечения синхронизации. Чтобы приступить к работе:
    * Перейдите на вкладку **Параметры синхронизации**.
    * В разделе **Синхронизация пользователей с Azure AD** установите флажки, применяющиеся к вашей среде. Обычно устанавливаются следующие флажки:
        * Создать учетные записи в Moodle для пользователей Azure AD
        * Обновить все учетные записи в Moodle для пользователей Azure AD
    * В разделе **Ограничение на создание** пользователей можно настроить фильтр, чтобы ограничить пользователей Azure AD, которые будут синхронизироваться с Moodle.
    * В разделе **Сопоставление полей пользователей** можно настроить сопоставление полей профилей пользователей Moodle с Azure AD.
    * В разделе **Синхронизация команд** можно выбрать автоматическое создание групп (т. е. команд) для всех или некоторых существующих курсов Moodle.
1. Чтобы проверить задания cron (и выполнить их вручную, если это нужно для первого запуска), щелкните ссылку **Страница управления запланированными задачами** в разделе **Синхронизация пользователей с Azure AD**. Вы будете перенаправлены на страницу **Запланированные задачи**.
    * Прокрутите страницу вниз до задания **Синхронизация пользователей с Azure AD** и нажмите кнопку **Выполнить**.
    * Если вы решили создать группы на основе существующих курсов, вы также можете запустить задание **Создание группы пользователей в Office 365**.
1. Вернись на страницу администрирования подключаемых модульов (> подключаемых модульов > Microsoft 365 Интеграция) и выберите страницу **Teams Параметры.** Вам потребуется настроить некоторые параметры безопасности, чтобы включить интеграцию приложения Teams.
    * Чтобы включить OpenID Connect, щелкните ссылку **Управление проверкой подлинности** и щелкните значок с изображением глаза в строке **OpenId Connect**, если он затенен.
    * После этого вам потребуется включить внедрение фреймов. Щелкните ссылку **HTTP-безопасность** и установите флажок рядом с пунктом **Разрешить внедрение фреймов**.
    * Следующим этапом является включение веб-служб, что обеспечивает поддержку функций API Moodle. Щелкните ссылку **Дополнительные функции** и убедитесь, что установлен флажок рядом с пунктом **Включить веб-службы**.
    * Наконец, необходимо включить внешние службы для Microsoft 365 или Office 365. Щелкните ссылку **Внешние службы** и выполните следующие действия:
        * Щелкните **Изменить** в строке **Веб-службы Moodle Office 365**.
        * Установите флажок рядом с пунктом **Включено** и нажмите **Сохранить изменения**.
    * Затем вам потребуется изменить разрешения авторизованного пользователя, чтобы позволить ему создавать маркеры веб-служб. Щелкните ссылку **Изменение роли "Авторизованный пользователь"**. Прокрутите страницу вниз до функции **Создание маркера веб-службы** и установите флажок **Разрешить**.

## <a name="step-3-deploy-the-moodle-assistant-bot-to-azure"></a>Шаг 3. Развертывание бота-помощника Moodle в Azure

> [!VIDEO https://www.youtube.com/embed/gbkJxf8FlfY]

Бесплатный бот-помощник Moodle для Microsoft Teams позволяет преподавателям и учащимся отвечать на вопросы о курсах, заданиях, оценках и других сведениях в Moodle. Кроме того, бот отправляет уведомления Moodle для учащихся и преподавателей прямо в Teams. Этот бот является проектом с открытым кодом, поддерживаемым корпорацией Майкрософт. Он [доступен на сайте GitHub](https://github.com/microsoft/Moodle-Teams-Bot).

> [!NOTE]
> В этом разделе вы разворачиваете ресурсы в своей подписке Azure. Все ресурсы будут настроены с использованием **бесплатного** уровня. В зависимости от применения бота вам может потребоваться изменить масштаб этих ресурсов.
> Если вы хотите только использовать вкладку Moodle без бота, перейдите к [шагу 4](#step-4-deploy-your-microsoft-teams-app).

### <a name="moodle-bot-information-flow"></a>Поток данных бота Moodle

<img width="530px" src="media/MoodleBotInformationFlow.png" alt="llustration of Moodle bot for Microsoft Teams information flow" title="Изображение потока данных бота Moodle для Microsoft Teams" />


Чтобы установить бота, сначала необходимо зарегистрировать его в [платформе удостоверений Майкрософт](https://identity.microsoft.com/Landing). Это позволит боту проверять подлинность с использованием конечных точек Майкрософт. Регистрация бота:

1. Вернись на страницу администрирования подключаемых модульов (> Подключаемый модуль > Microsoft 365 Интеграция) и выберите вкладку **Teams Параметры.**
1. Щелкните ссылку **Портал регистрации приложений Майкрософт** и войдите с использованием идентификатора Майкрософт.
1. Введите имя приложения (например. MoodleBot) и нажмите кнопку **Создать**.
1. Скопируйте **идентификатор приложения** и вставьте его в поле **ИД приложения бота** на странице **Параметры команды**.
1. Нажмите кнопку **Создать новый пароль**. Скопируйте созданный пароль и в поле Пароль  приложения-бота **на странице Параметры** группы.
1. Прокрутите до нижней части формы и нажмите кнопку **Сохранить изменения**.

Теперь, когда вы создали идентификатор приложения и пароль, можно развернуть бот в Azure. Нажмите кнопку **Развернуть в Azure** и заполните форму нужными сведениями (идентификатор приложения бота, пароль приложения бота и секрет Moodle находятся на странице **Параметры команды**, а сведения Azure находятся на странице **Настройка**). После заполнения формы установите флажок, чтобы принять условия, и нажмите кнопку **Купить** (все ресурсы Azure разворачиваются в бесплатном уровне).

После завершения развертывания ресурсов в Azure необходимо настроить подключаемый модуль Moodle с его конечной точкой обмена сообщениями. Сначала вам нужно получить конечную точку от бота в Azure. Для этого:

1. Если вы еще не сделали этого, войдите на [портал Azure](https://portal.azure.com).
2. В области слева выберите **Группы ресурсов**.
3. В списке выберите группу ресурсов, которую вы только что использовали (или создали) при развертывании бота.
4. Выберите ресурс **Бот WebApp** из списка ресурсов в группе.
5. Скопируйте **конечную точку обмена сообщениями** из раздела **Обзор**.
6. В Moodle откройте **страницу командной Параметры** подключаемого модульа Moodle.
7. В поле **Конечная точка бота** вставьте скопированный URL-адрес и измените слово *messages* на *webhook*. URL-адрес теперь должен выглядеть так: `https://botname.azurewebsites.net/api/webhook`
8. Нажмите кнопку **Сохранить изменения**.
9. После сохранения изменений вернитесь на вкладку **Параметры команды**, нажмите кнопку **Скачать файл манифеста** и сохраните пакет манифеста на компьютере (он потребуется в следующем разделе).

## <a name="step-4-deploy-your-microsoft-teams-app"></a>Шаг 4. Развертывание приложения Microsoft Teams

> [!VIDEO https://www.youtube.com/embed/2rMb7gtM_ZM]

Теперь, когда у вас есть бот, развернутый в Azure и настроенный для общения с сервером Moodle, можно развернуть приложение Microsoft Teams. Для этого необходимо загрузить файл манифеста, загруженный со страницы Moodle Plugin Team Параметры на предыдущем шаге.

Перед установкой приложения вам нужно убедиться, что включены внешние приложения и загрузка неопубликованных приложений. Для этого можно выполнить [следующие действия](./admin-settings.md). Убедившись, что внешние приложения включены, можно выполнить указанные ниже действия, чтобы развернуть приложение.

1. Откройте Microsoft Teams.
2. Щелкните **значок** Магазин в левой нижней части панели навигации.
3. Щелкните ссылку **Загрузить пользовательское приложение** в списке параметров. *Примечание.* Если вы выполнили вход в качестве глобального администратора, вы можете загрузить приложение в магазин приложений своей организации. В противном случае вы сможете загрузить приложение только для команд, участником которых вы являетесь (загрузка неопубликованных приложений).
4. Выберите пакет `manifest.zip`, скачанный ранее, и нажмите кнопку **Сохранить**. Если вы еще не скачали пакет манифеста, это можно сделать на вкладке **Параметры команды** страницы настройки подключаемого модуля в Moodle.

После установки приложения вы можете добавить вкладку в любой канал, к которому у вас есть доступ. Для этого перейдите в канал, щелкните значок **+** и выберите приложение из списка. Следуйте инструкциям, чтобы завершить добавление вкладки курса Moodle в канал.

Вот и все! Теперь вы и ваша команда можете приступить к работе с курсами Moodle непосредственно в Microsoft Teams.

Чтобы поделиться с нами любыми запросами на функции или отзывами, посетите наш портал [отзывов](https://feedbackportal.microsoft.com).

[!INCLUDE [uservoice-disclaimer-note](includes/uservoice-disclaimer-note.md)]
