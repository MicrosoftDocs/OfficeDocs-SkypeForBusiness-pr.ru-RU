---
title: Установка интеграции Moodle с Microsoft Teams
author: MicrosoftHeidi
ms.author: heidip
manager: serdars
ms.topic: article
ms.service: msteams
audience: admin
ms.reviewer: ''
search.appverid: MET150
description: Узнайте, как установить и настроить приложение интеграции Moodle для Microsoft Teams.
keywords: Подключаемый модуль интеграции приложения Moodle для Teams
localization_priority: Normal
f1.keywords:
- NOCSH
ms.collection:
- M365-collaboration
ms.custom: seo-marvel-mar2020
appliesto:
- Microsoft Teams
ms.openlocfilehash: 3a3ee51fdbbda7c3d49ac5a7b2a65b977f8fb245
ms.sourcegitcommit: cddaacf1e8dbcdfd3f94deee7057c89cee0e5699
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2020
ms.locfileid: "43137139"
---
# <a name="installing-the-moodle-integration-with-microsoft-teams"></a>Интеграция Moodle с Microsoft Teams 

> [!VIDEO https://www.youtube.com/embed/OHlPt22nKoE]

[Moodle](https://moodle.org/) — самая популярная система управления обучением (LMS) с открытым кодом в мире теперь интегрируется с Microsoft Teams! Эта интеграция позволяет педагогам и преподавателям совместно работать над курсами Moodle, задавать вопросы об оценках и заданиях, а также получать уведомления прямо в приложении Teams!

Чтобы облегчить администраторам настройку этой интеграции, мы добавили в подключаемый модуль Office 365 Moodle с открытым кодом следующие возможности:

* Автоматическая регистрация сервера Moodle в Azure AD.
* Развертывание бота-помощника Moodle в Azure одним щелчком мыши.
* Автоматическая подготовка команд и автоматическая синхронизация их регистраций во всех или выбранных курсах Moodle.
* Автоматическая установка вкладки Moodle и бота-помощника Moodle в каждой синхронизированной команде (ожидается в ближайшее время).
* Публикация приложения Moodle в закрытом магазине приложений Teams одним щелчком мыши (ожидается в ближайшее время).

Дополнительные сведения о функциональных возможностях, обеспечиваемых этой интеграцией см. [здесь](https://education.microsoft.com/courses-and-resources/resources/microsoft-teams-moodle).

## <a name="prerequisites"></a>Предварительные требования

Чтобы установить и настроить это приложение, требуется следующее:

1. Учетные данные администратора Moodle
2. Учетные данные администратора Azure AD
3. Подписка на Azure, в которой можно создавать ресурсы

## <a name="step-1-install-the-office-365-moodle-plugin"></a>Шаг 1. Установка подключаемого модуля Office 365 Moodle

> [!VIDEO https://www.youtube.com/embed/SETEC5nzMgk]

Интеграция Moodle в Microsoft Teams выполняется с помощью [комплекта подключаемого модуля Office 365 Moodle](https://github.com/Microsoft/o365-moodle) с открытым кодом. Чтобы установить подключаемый модуль на сервере Moodle, выполните следующее:

1. Сначала скачайте [комплект подключаемого модуля Office 365](https://moodle.org/plugins/pluginversions.php?plugin=local_o365) и сохраните его на локальном компьютере. Необходимо использовать версию 3.5 или более позднюю.
    * При установке подключаемого модуля local_o365 также устанавливаются подключаемые модули [auth_oidc](https://moodle.org/plugins/auth_oidc) и [boost_o365Teams](https://moodle.org/plugins/pluginversions.php?plugin=theme_boost_o365teams).
1. Войдите на сервер Moodle в качестве администратора и выберите пункт **Администрирование сайта** в левой панели навигации.
1. Откройте вкладку **Подключаемые модули** и щелкните **Установить подключаемые модули**.
1. В разделе **Установить подключаемый модуль из ZIP-файла** нажмите кнопку **Выбрать файл**.
1. Выберите параметр **Добавление файла** в области навигации слева, перейдите к скачанному ранее файлу и нажмите кнопку **Добавить файл**.
1. В левой области навигации снова выберите параметр **Администрирование сайта**, чтобы вернуться к панели мониторинга администратора. Прокрутите страницу до раздела **Локальные подключаемые модули** и щелкните ссылку **Интеграция с Microsoft Office 365**. Оставьте эту страницу настройки открытой в отдельной вкладке браузера, так как она потребуется в ходе этого процесса.

Дополнительные сведения об установке подключаемых модулей Moodle см. в [документации по Moodle](https://docs.moodle.org/34/en/Installing_plugins).

**Важно!** Оставьте страницу настройки подключаемого модуля Office 365 Moodle открытой в отдельной вкладке браузера, так как вы будете к ней возвращаться в ходе этого процесса.

*У вас еще нет сайта Moodle?* Вы можете обратиться к нашему [репозиторию](https://github.com/azure/moodle) Moodle в Azure, где можно быстро развернуть экземпляр Moodle в Azure и настроить его под свои потребности.

## <a name="step-2-configure-the-connection-between-the-office-365-plugin-and-azure-active-directory"></a>Шаг 2. Настройка соединения между подключаемым модулем Office 365 и Azure Active Directory

> [!VIDEO https://www.youtube.com/embed/FpGEezaJ3SA]

Затем требуется зарегистрировать Moodle в качестве приложения в Azure Active Directory. Мы предоставили скрипт PowerShell для выполнения этого процесса. Скрипт PowerShell подготавливает новое приложение Azure AD для клиента Office 365, которое будет использоваться подключаемым модулем Office 365 Moodle. Скрипт подготавливает приложение для клиента Office 365, настраивая все обязательные URL-адреса ответов и разрешения для подготовленного приложения, а также возвращает AppID и ключ. Вы можете использовать созданный AppID и ключ на странице настройки подключаемого модуля Office 365 Moodle, чтобы настроить сервер Moodle в Azure AD. Подробные сведения о действиях, автоматизируемых скриптом PowerShell, см. в полной [документации для подключаемого модуля](https://docs.moodle.org/34/en/Office365#Register_your_Moodle_instance_as_an_Application).

### <a name="moodle-tab-for-microsoft-teams-information-flow"></a>Поток данных вкладки Moodle для Microsoft Teams

<img width="530px" src="media/MoodleTabInformationFlow.png" alt="Illustration of Moodle tab for Microsoft Teams information flow" title="Изображение потока данных вкладки Moodle для Microsoft Teams" />

1. На странице подключаемого модуля интеграции с Microsoft Office 365 выберите вкладку **Настройка**. 
1. Нажмите кнопку **Скачать скрипт PowerShell** и сохраните его на локальном компьютере.
1. Вам потребуется подготовить скрипт PowerShell из ZIP-файла. Для этого:
    * Скачайте и извлеките файл `Moodle-AzureAD-Powershell.zip`.
    * Откройте извлеченную папку.
    * Щелкните файл `Moodle-AzureAD-Script.ps1` правой кнопкой мыши и выберите пункт **Свойства**.
    * На вкладке **Общие** окна свойств, установите флажок `Unblock` рядом с атрибутом **Безопасность** в нижней части окна.
    * Нажмите кнопку **ОК**.
    * Скопируйте путь к извлеченной папке.
1. Затем запустите PowerShell от имени администратора.
    * Нажмите кнопку "Пуск".
    * Введите "PowerShell".
    * Щелкните правой кнопкой приложение Windows PowerShell.
    * Выберите пункт "Запуск от имени администратора".
1. Перейдите к извлеченному каталогу, введя `cd ...\...\Moodle-AzureAD-Powershell`, где `...\...` — путь к каталогу.
1. Запустите скрипт PowerShell, выполнив следующие действия:
    * Введите `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`.
    * Введите `.\Moodle-AzureAD-Script.ps1`.
    * Войдите в свою учетную запись администратора Office 365 во всплывающем окне.
    * Введите имя приложения Azure AD (например, Moodle или подключаемый модуль Moodle).
    * Введите URL-адрес сервера Moodle.
    * Скопируйте **идентификатор приложения** и **ключ приложения**, созданные скриптом, и сохраните их.
1. Затем вам потребуется добавить идентификатор и ключ в подключаемый модуль Office 365 Moodle. Вернитесь на страницу администрирования подключаемого модуля ("Администрирование сайта" > "Подключаемые модули" > "Интеграция с Microsoft Office 365").
1. На вкладке **Настройка** добавьте **идентификатор приложения** и **ключ приложения**, скопированные ранее, и нажмите **Сохранить изменения**.
1. После обновления страницы отобразится новый раздел **Выбор метода подключения**. Установите флажок **По умолчанию** и снова нажмите кнопку **Сохранить изменения**.
1. После обновления страницы отобразится еще один новый раздел **Согласие администратора и дополнительные сведения**.
    * Щелкните ссылку **Предоставить согласие администратора**, введите учетные данные глобального администратора Office 365 и нажмите **Принять**, чтобы предоставить разрешения.
    * Нажмите кнопку **Определить** рядом с полем **Клиент Azure AD**.
    * Нажмите кнопку **Определить** рядом с полем **URL-адрес OneDrive для бизнеса**.
    * После заполнения полей снова нажмите кнопку **Сохранить изменения**.
1. Нажмите кнопку **Обновить**, чтобы проверить установку, затем нажмите **Сохранить изменения**.
1. После этого вам потребуется синхронизировать пользователей между сервером Moodle и Azure Active Directory. На этом этапе вы можете выбирать разные параметры в зависимости от вашей среды. Обратите внимание, что эта конфигурация будет применяться с каждым запуском программы cron Moodle (обычно раз в день) для обеспечения синхронизации. Чтобы приступить к работе:
    * Перейдите на вкладку **Параметры синхронизации**.
    * В разделе **Синхронизация пользователей с Azure AD** установите флажки, применяющиеся к вашей среде. Обычно устанавливаются следующие флажки:
        * Создать учетные записи в Moodle для пользователей Azure AD
        * Обновить все учетные записи в Moodle для пользователей Azure AD
    * В разделе **Ограничение создания пользователей** можно настроить фильтр, чтобы ограничить число пользователей Azure AD, которые будут синхронизированы с Moodle.
    * В разделе **Сопоставление полей пользователей** можно настроить сопоставление полей профилей пользователей Moodle с Azure AD.
    * В разделе **Синхронизация команд** можно выбрать автоматическое создание групп (т. е. команд) для всех или некоторых существующих курсов Moodle.
1. Чтобы проверить задания cron (и выполнить их вручную, если это нужно для первого запуска), щелкните ссылку **Страница управления запланированными задачами** в разделе **Синхронизация пользователей с Azure AD**. Вы будете перенаправлены на страницу **Запланированные задачи**.
    * Прокрутите страницу вниз до задания **Синхронизация пользователей с Azure AD** и нажмите кнопку **Выполнить**.
    * Если вы решили создать группы на основе существующих курсов, вы также можете запустить задание **Создание группы пользователей в Office 365**.
1. Вернитесь на страницу администрирования подключаемого модуля ("Администрирование сайта" > "Подключаемые модули" > "Интеграция с Microsoft Office 365") и выберите страницу **Параметры Teams**. Вам потребуется настроить некоторые параметры безопасности, чтобы включить интеграцию приложения Teams.
    * Чтобы включить OpenID Connect, щелкните ссылку **Управление проверкой подлинности** и щелкните значок с изображением глаза в строке **OpenId Connect**, если он затенен.
    * После этого вам потребуется включить внедрение фреймов. Щелкните ссылку **HTTP-безопасность** и установите флажок рядом с пунктом **Разрешить внедрение фреймов**.
    * Следующим этапом является включение веб-служб, что обеспечивает поддержку функций API Moodle. Щелкните ссылку **Дополнительные функции** и убедитесь, что установлен флажок рядом с пунктом **Включить веб-службы**.
    * Наконец, вам потребуется включить внешние службы для Office 365. Щелкните ссылку **Внешние службы** и выполните следующие действия:
        * Щелкните **Изменить** в строке **Веб-службы Moodle Office 365**.
        * Установите флажок рядом с пунктом **Включено** и нажмите **Сохранить изменения**.
    * Затем вам потребуется изменить разрешения авторизованного пользователя, чтобы позволить ему создавать маркеры веб-служб. Щелкните ссылку **Изменение роли "Авторизованный пользователь"**. Прокрутите страницу вниз до функции **Создание маркера веб-службы** и установите флажок **Разрешить**.

## <a name="step-3-deploy-the-moodle-assistant-bot-to-azure"></a>Шаг 3. Развертывание бота-помощника Moodle в Azure

> [!VIDEO https://www.youtube.com/embed/gbkJxf8FlfY]

Бесплатный бот-помощник Moodle для Microsoft Teams позволяет преподавателям и учащимся отвечать на вопросы о курсах, заданиях, оценках и других сведениях в Moodle. Кроме того, бот отправляет уведомления Moodle для учащихся и преподавателей прямо в Teams. Этот бот является проектом с открытым кодом, поддерживаемым корпорацией Майкрософт. Он [доступен на сайте GitHub](https://github.com/microsoft/Moodle-Teams-Bot).

> [!NOTE]
> В этом разделе вы разворачиваете ресурсы в своей подписке Azure. Все ресурсы будут настроены с использованием **бесплатного** уровня. В зависимости от применения бота вам может потребоваться изменить масштаб этих ресурсов.
> Если вы хотите только использовать вкладку Moodle без бота, перейдите к [шагу 4](#step-4-deploy-your-microsoft-teams-app).

### <a name="moodle-bot-information-flow"></a>Поток данных бота Moodle

<img width="530px" src="media/MoodleBotInformationFlow.png" alt="llustration of Moodle bot for Microsoft Teams information flow" title="Изображение потока данных бота Moodle для Microsoft Teams" />


Чтобы установить бота, сначала необходимо зарегистрировать его в [платформе удостоверений Майкрософт](https://identity.microsoft.com/Landing). Это позволит боту проверять подлинность с использованием конечных точек Майкрософт. Регистрация бота:

1. Вернитесь на страницу администрирования подключаемого модуля ("Администрирование сайта" > "Подключаемые модули" > "Интеграция с Microsoft Office 365") и выберите вкладку **Параметры Teams**.
1. Щелкните ссылку **Портал регистрации приложений Майкрософт** и войдите с использованием идентификатора Майкрософт.
1. Введите имя своего приложения (например, MoodleBot) и нажмите кнопку **Создать**.
1. Скопируйте **идентификатор приложения** и вставьте его в поле **ИД приложения бота** на странице **Параметры команды**.
1. Нажмите кнопку **Создать новый пароль**. Скопируйте созданный пароль и вставьте его в поле **Пароль приложения бота** на странице **Параметры команды**.
1. Прокрутите до нижней части формы и нажмите кнопку **Сохранить изменения**.

Теперь, когда вы создали идентификатор приложения и пароль, можно развернуть бот в Azure. Нажмите кнопку **Развернуть в Azure** и заполните форму нужными сведениями (идентификатор приложения бота, пароль приложения бота и секрет Moodle находятся на странице **Параметры команды**, а сведения Azure находятся на странице **Настройка**). После заполнения формы установите флажок, чтобы принять условия, и нажмите кнопку **Купить** (все ресурсы Azure разворачиваются в бесплатном уровне).

После завершения развертывания ресурсов в Azure необходимо настроить в подключаемом модуле Office 365 Moodle его конечную точку обмена сообщениями. Сначала вам потребуется получить конечную точку из бота в Azure. Для этого:

1. Если вы еще не сделали этого, войдите на [портал Azure](https://portal.azure.com).
2. В области слева выберите **Группы ресурсов**.
3. В списке выберите группу ресурсов, которую вы только что использовали (или создали) при развертывании бота.
4. Выберите ресурс **Бот WebApp** из списка ресурсов в группе.
5. Скопируйте **конечную точку обмена сообщениями** из раздела **Обзор**.
6. В Moodle откройте страницу **Параметры команды** подключаемого модуля Office 365 Moodle.
7. В поле **Конечная точка бота** вставьте скопированный URL-адрес и измените слово *messages* на *webhook*. URL-адрес теперь должен выглядеть так: `https://botname.azurewebsites.net/api/webhook`
8. Нажмите кнопку **Сохранить изменения**.
9. После сохранения изменений вернитесь на вкладку **Параметры команды**, нажмите кнопку **Скачать файл манифеста** и сохраните пакет манифеста на компьютере (он потребуется в следующем разделе).

## <a name="step-4-deploy-your-microsoft-teams-app"></a>Шаг 4. Развертывание приложения Microsoft Teams

> [!VIDEO https://www.youtube.com/embed/2rMb7gtM_ZM]

Теперь, когда у вас есть бот, развернутый в Azure и настроенный для общения с сервером Moodle, можно развернуть приложение Microsoft Teams. Для этого загрузите файл манифеста, скачанный со страницы параметров команды подключаемого модуля Office 365 Moodle на предыдущем шаге.

Перед установкой приложения вам нужно убедиться, что включены внешние приложения и загрузка неопубликованных приложений. Для этого можно выполнить [следующие действия](https://docs.microsoft.com/MicrosoftTeams/admin-settings). Убедившись, что внешние приложения включены, можно выполнить указанные ниже действия, чтобы развернуть приложение.

1. Откройте Microsoft Teams.
2. Щелкните значок **магазина** в левом нижнем углу панели навигации.
3. Щелкните ссылку **Загрузить пользовательское приложение** в списке параметров. *Примечание.* Если вы выполнили вход в качестве глобального администратора, вы можете загрузить приложение в магазин приложений своей организации. В противном случае вы сможете загрузить приложение только для команд, участником которых вы являетесь (загрузка неопубликованных приложений).
4. Выберите пакет `manifest.zip`, скачанный ранее, и нажмите кнопку **Сохранить**. Если вы еще не скачали пакет манифеста, это можно сделать на вкладке **Параметры команды** страницы настройки подключаемого модуля в Moodle.

После установки приложения вы можете добавить вкладку в любой канал, к которому у вас есть доступ. Для этого перейдите в канал, щелкните значок **+** и выберите приложение из списка. Следуйте инструкциям, чтобы завершить добавление вкладки курса Moodle в канал.

Вот и все! Теперь вы и ваша команда можете приступить к работе с курсами Moodle непосредственно в Microsoft Teams.

Чтобы отправить нам запрос любой функции или отзыв, посетите нашу [страницу пользовательских предложений](https://microsoftteams.uservoice.com/forums/916759-moodle).