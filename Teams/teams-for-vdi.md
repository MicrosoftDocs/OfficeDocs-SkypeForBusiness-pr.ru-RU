---
title: Teams для инфраструктуры виртуальных рабочих столов
author: dstrome
ms.author: dstrome
manager: serdars
ms.topic: article
ms.service: msteams
ms.reviewer: rafarhi, jmorrow
audience: admin
description: Узнайте, как запускать Microsoft Teams в среде инфраструктуры виртуализированных рабочих столов (VDI).
ms.localizationpriority: medium
search.appverid: MET150
f1.keywords:
- NOCSH
ms.collection:
- M365-collaboration
- m365initiative-deployteams
appliesto:
- Microsoft Teams
ms.openlocfilehash: 1e557e0901293c26d48e30ed163883f9cd97f12e
ms.sourcegitcommit: 0dda332951df3b946097d90a4923eb191fd86b4c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/14/2022
ms.locfileid: "66790354"
---
# <a name="teams-for-virtualized-desktop-infrastructure"></a>Teams для инфраструктуры виртуальных рабочих столов

В этой статье описываются требования и ограничения использования Microsoft Teams в виртуализированной среде.

## <a name="what-is-vdi"></a>Что такое VDI?

инфраструктура виртуальных рабочих столов (VDI) — это технология виртуализации, в которой размещена операционная система и приложения на централизованном сервере в центре обработки данных. Это обеспечивает полное и персонализированное взаимодействие с рабочим столом для пользователей с полностью защищенным и соответствующим требованиям централизованным источником.

Teams в виртуализированной среде поддерживает чат и совместную работу. Кроме того, в виртуальных рабочих столах Azure, платформах Citrix и VMware поддерживаются функции звонков и собраний.

Teams также поддерживает несколько конфигураций в виртуальных средах. К ним относятся VDI, выделенный, общий, постоянный и постоянный режимы. Функции находятся в непрерывной разработке и добавляются на регулярной основе, а функциональные возможности будут расширяться со временем.

Использование Teams в виртуализированной среде может немного отличаться от использования Teams в неиртуализированной среде. Например, некоторые расширенные функции могут быть недоступны в виртуализированной среде, а разрешение видео может отличаться.

Чтобы обеспечить оптимальное взаимодействие с пользователем, следуйте указаниям, приведенным в этой статье.

> [!Note]
> Дополнительные сведения о Teams VDI на разных платформах см. в разделе [о функциях Teams по платформам](https://support.microsoft.com/office/teams-features-by-platform-debe7ff4-7db4-4138-b7d0-fcc276f392d3).

## <a name="teams-on-vdi-components"></a>Teams в компонентах VDI

Для использования Teams в виртуализированной среде требуются следующие компоненты.

- **Брокер виртуализации**: диспетчер ресурсов и соединений для поставщика виртуализации, например Azure
- **Виртуальный рабочий стол**: стек виртуальных машин, на котором выполняется Teams
- **Тонкий клиент**: устройство, с помощью которого пользователь физически интерфейсирует
- **Настольное приложение Teams**: клиентское приложение Teams для настольных компьютеров

## <a name="teams-on-vdi-requirements"></a>Требования Teams к VDI

### <a name="virtualization-provider-requirements"></a>Требования к поставщику виртуализации

Классические приложения Teams были проверены ведущими поставщиками решений для виртуализации. При наличии нескольких поставщиков на рынке мы рекомендуем обратиться к поставщику решений для виртуализации, чтобы убедиться, что выполнены минимальные требования.
  
В настоящее время Teams в VDI с оптимизацией аудио-видео (AV) сертифицирована с помощью Виртуального рабочего стола Azure, Citrix и VMware. Просмотрите сведения в этом разделе, чтобы убедиться, что вы соответствуете всем требованиям к надлежащей функциональности.

### <a name="platforms-certified-for-teams"></a>Платформы, сертифицированные для Teams

На следующих платформах есть решения инфраструктуры виртуальных рабочих столов для Teams.

|Платформа|Решение|
|----|---|
|![Логотип, представляющий корпорацию Майкрософт.](media/microsoft-logo.png)| <a href="/azure/virtual-desktop/teams-on-wvd" target="_blank">Виртуальный рабочий стол Azure</a>, <a href="/windows-365/enterprise/teams-on-cloud-pc" target="_blank">Windows 365</a> |
|![Логотип, представляющий Citrix.](media/citrix-logo.png)| <a href="https://www.citrix.com/products/citrix-virtual-apps-and-desktops/" target="_blank">Виртуальные приложения и рабочие столы Citrix</a> |
|![Логотип, представляющий VMware.](media/vmware-logo.png)| <a href="https://www.vmware.com/products/horizon.html" target="_blank">VMware Horizon</a> |

### <a name="azure-virtual-desktop"></a>Виртуальный рабочий стол Azure

Виртуальный рабочий стол Azure обеспечивает оптимизацию av для Teams в VDI. Дополнительные сведения о требованиях и установке см. в статье ["Использование Teams на Виртуальном рабочем столе Azure"](/azure/virtual-desktop/teams-on-wvd).

### <a name="windows-365"></a>Windows 365

Windows 365 использует оптимизацию av, предоставляемую Виртуальным рабочим столом Azure, чтобы обеспечить оптимальное взаимодействие Teams с облачных компьютеров. Дополнительные сведения о требованиях и установке см. в статье ["Использование Teams на облачном компьютере"](/windows-365/enterprise/teams-on-cloud-pc).

### <a name="citrix-virtual-apps-and-desktops-requirements"></a>Требования к виртуальным приложениям и рабочим столам Citrix

Виртуальные приложения и рабочие столы Citrix (прежнее название — XenApp и XenDesktop) обеспечивают оптимизацию av для Teams в VDI. Благодаря виртуальным приложениям и рабочим столам Citrix Teams в VDI поддерживает функции звонков и собраний, а также чата и совместной работы.

Последнюю версию виртуальных приложений и рабочих столов Citrix можно скачать на сайте [загрузки Citrix](https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/). (Сначала необходимо выполнить вход.) По умолчанию необходимые компоненты включены в приложение [Citrix Workspace (CWA)](https://www.citrix.com/downloads/workspace-app/) и виртуальный агент доставки (VDA). Вам не нужно устанавливать дополнительные компоненты или подключаемые модули в CWA или VDA.

Последние требования к серверу и клиенту см. в статье "Оптимизация для [Microsoft Teams](https://docs.citrix.com/en-us/citrix-virtual-apps-desktops/multimedia/opt-ms-teams.html) " на веб-сайте Citrix.

### <a name="vmware-horizon-workspace-and-desktop-requirements"></a>Требования к рабочей области и рабочему столу VMware Horizon

VMware Horizon — это современная платформа для безопасной доставки виртуальных рабочих столов и приложений в гибридном облаке. Чтобы предложить пользователю отличный интерфейс, VMware Horizon обеспечивает оптимизацию мультимедиа для Teams. Эта оптимизация повышает общую производительность виртуальных рабочих столов и приложений, а также улучшает взаимодействие с пользователем при звонках и собраниях с помощью Teams.

Последнюю версию VMware Horizon можно скачать на странице [загрузки VMware](https://customerconnect.vmware.com/downloads/#all_products) . Необходимые компоненты оптимизации мультимедиа являются частью агента Horizon и клиента Horizon по умолчанию, и нет необходимости устанавливать дополнительный подключаемый модуль для использования функции оптимизации для Teams.

Последние требования и инструкции по настройке оптимизации мультимедиа для Teams см. в статье "Настройка оптимизации мультимедиа для [Microsoft Teams](https://docs.vmware.com/en/VMware-Horizon/2006/horizon-remote-desktop-features/GUID-F68FA7BB-B08F-4EFF-9BB1-1F9FC71F8214.html) " на веб-сайте VMware.

## <a name="install-or-update-the-teams-desktop-app-on-vdi"></a>Установка или обновление классических приложений Teams в VDI

Вы можете развернуть настольное приложение Teams для VDI с помощью установки на компьютер или для каждого пользователя с помощью пакета MSI. Выбор подхода к использованию зависит от того, используете ли вы постоянную или постоянную настройку и связанные с ней функциональные потребности вашей организации.

При выделенной постоянной установке будет работать как для каждого компьютера, так и для каждого пользователя. Однако для постоянной установки Teams требуется установка на компьютере, чтобы обеспечить эффективную работу. См. [раздел "Постоянная настройка](#non-persistent-setup) ".

При установке на компьютере автоматические обновления отключаются. Это означает, что для обновления приложения Teams необходимо удалить текущую версию для обновления до более новой версии. При установке для каждого пользователя автоматические обновления включены.

> [!IMPORTANT]
> Следите за тем, чтобы классические приложения Teams были в вашей среде VDI в актуальном состоянии. Версии классических приложений Teams с датами выпуска более чем на 90 дней старше даты выпуска текущей [](/officeupdates/teams-app-versioning) версии не поддерживаются. Неподдерживаемые версии классических приложений Teams отображают страницу блокировки для пользователей и запрашивают обновление приложения.

Для большинства развертываний VDI рекомендуется развертывать Teams с помощью установки на компьютере. Чтобы обновить версию Teams до последней версии, начните с процедуры удаления, за которой следует развертывание последней версии Teams.

Для правильной работы оптимизации Teams AV в средах VDI устройство с тонкой версией клиента должно иметь доступ к Интернету. Если доступ к Интернету недоступен на устройстве с тонким клиентом, запуск оптимизации не будет успешным. Это означает, что пользователь находится в не оптимизированной области мультимедиа.

#### <a name="dedicated-persistent-setup"></a>Выделенная постоянная настройка

При выделенной постоянной настройке изменения локальной операционной системы пользователей сохраняются после того, как пользователи выйдите из системы. Для постоянной установки Teams поддерживает установку как для отдельных пользователей, так и для отдельных компьютеров.

Ниже приведена рекомендуемая минимальная конфигурация виртуальной машины.

|Параметр  |Операционная система рабочей станции  |Серверная операционная система  |
|---------|---------|---------|
|Виртуальный ЦП   |    2 ядра     |  4, 6 или 8 ядер<br>Важно понимать базовую конфигурацию доступа к памяти (NUMA) и соответствующим образом настраивать виртуальные машины.     |
|ОЗУ     |   4 ГБ      | От 512 МБ до 1 ГБ на пользователя        |
|Хранилище    | 8 ГБ        | От 40 ГБ до 60 ГБ        |

#### <a name="non-persistent-setup"></a>Постоянная настройка

При постоянной настройке изменения локальной операционной системы пользователей не сохраняются после того, как пользователи выйдите из системы. Такие настройки обычно являются общими сеансами с несколькими пользователями. Конфигурация виртуальной машины зависит от количества пользователей и доступных ресурсов физического сервера.

Для непрестанной установки необходимо установить настольное приложение Teams на каждом компьютере в golden image. Это обеспечивает эффективный запуск приложения Teams во время сеанса пользователя. Дополнительные сведения см. в разделе ["Установка или обновление классических приложений Teams в VDI](#install-or-update-the-teams-desktop-app-on-vdi) ".

Для использования Teams в несохраняемой настройке также требуется диспетчер кэширования профилей для эффективной синхронизации данных среды выполнения Teams. Эффективная синхронизация данных гарантирует кэширование соответствующей пользовательской информации (например, данных, профиля или параметров пользователя) во время сеанса пользователя. Убедитесь, что данные в этих двух папках синхронизированы:<br>

- `C:\Users\username\AppData\Local\Microsoft\IdentityCache (%LocalAppData%\Microsoft\IdentityCache)`
- `C:\Users\username\AppData\Roaming\Microsoft\Teams (%AppData%\Microsoft\Teams)`

> [!NOTE]
> Чтобы убедиться, что приложение Teams содержит данные и файлы среды выполнения, необходимые для запуска приложения, требуется перемещаемая папка (или, если вы используете перенаправление папок, диспетчер кэширования). Это необходимо для устранения проблем с задержкой в сети или сетевых сбоев, которые в противном случае приводят к ошибкам приложений и медленному интерфейсу из-за недоступности данных и файлов.

Доступно множество решений диспетчера кэширования, таких как [FSLogix](/fslogix/overview). Для получения конкретных инструкций по настройке обратитесь к поставщику диспетчера кэширования.

##### <a name="teams-cached-content-exclusion-list-for-non-persistent-setup"></a>Список исключений кэшированного содержимого Teams для несохраняемой установки

Исключите следующее из папки кэширования Teams. `%AppData%/Microsoft/Teams` Исключение этих элементов помогает уменьшить размер кэширования пользователей для дальнейшей оптимизации неповременных настроек.

- .txt файлов
- Папка стека мультимедиа
- `%AppData%\Microsoft\Teams\meeting-addin\Cache`

### <a name="microsoft-365-apps-for-enterprise-considerations"></a>Приложения Microsoft 365 для предприятий рекомендации

При развертывании Teams с Приложения Microsoft 365 для предприятий VDI учитывайте следующее.

#### <a name="new-deployments-of-teams-through-microsoft-365-apps-for-enterprise"></a>Новые развертывания Teams через Приложения Microsoft 365 для предприятий

Прежде чем развертывать Teams через Приложения Microsoft 365 для предприятий, необходимо сначала удалить все существующие приложения Teams, если они были развернуты с помощью установки на компьютер.

Teams через Приложения Microsoft 365 для предприятий устанавливается для каждого пользователя. Дополнительные сведения см. в разделе ["Установка или обновление классических приложений Teams в VDI](#install-or-update-the-teams-desktop-app-on-vdi) ".

#### <a name="teams-deployments-through-microsoft-365-apps-for-enterprise-updates"></a>Развертывания Teams с помощью Приложения Microsoft 365 для предприятий обновлений

Teams также добавляется в существующие установки Приложения Microsoft 365 для предприятий. Так Приложения Microsoft 365 для предприятий устанавливает Teams только для каждого пользователя, см. раздел "Установка или обновление классических приложений [Teams" в разделе VDI](#install-or-update-the-teams-desktop-app-on-vdi).

#### <a name="using-teams-with-per-machine-installation-and-microsoft-365-apps-for-enterprise"></a>Использование Teams с установкой на компьютер и Приложения Microsoft 365 для предприятий

Приложения Microsoft 365 для предприятий не поддерживает установку Teams на компьютере. Чтобы использовать установку на компьютере, необходимо исключить Teams из Приложения Microsoft 365 для предприятий. Сведения о [развертывании классических приложений Teams](#deploy-the-teams-desktop-app-to-the-vm) на виртуальной машине и о том, как исключить развертывание [Teams, см.](#how-to-exclude-teams-deployment-through-microsoft-365-apps-for-enterprise) в Приложения Microsoft 365 для предприятий разделах.

#### <a name="how-to-exclude-teams-deployment-through-microsoft-365-apps-for-enterprise"></a>Как исключить развертывание Teams с помощью Приложения Microsoft 365 для предприятий

Дополнительные сведения о Teams и Приложения Microsoft 365 для предприятий см. в статье о том, как исключить [Teams из новых](/DeployOffice/teams-install#how-to-exclude-microsoft-teams-from-new-installations-of-microsoft-365-apps) установок Приложения Microsoft 365 для предприятий и использовать групповая политика для управления установкой [Teams](/DeployOffice/teams-install#use-group-policy-to-control-the-installation-of-microsoft-teams).

### <a name="deploy-the-teams-desktop-app-to-the-vm"></a>Развертывание классических приложений Teams на виртуальной машине

1. Скачайте пакет MSI Teams, соответствующий операционной системе виртуальной машины VDI, по одной из следующих ссылок:

    - [32-разрядная версия](https://teams.microsoft.com/downloads/desktopurl?env=production&plat=windows&managedInstaller=true&download=true)
    - [64-разрядная версия](https://teams.microsoft.com/downloads/desktopurl?env=production&plat=windows&arch=x64&managedInstaller=true&download=true)

    > [!NOTE]
    > Ссылки для скачивания MSI-файлов см. в статье "Массовая установка Teams с помощью [установщика Windows (MSI](msi-deployment.md) )".

2. Установите MSI на виртуальную машину VDI, выполнив одну из следующих команд:

    - Установка для каждого пользователя (по умолчанию)
  
        ```console
        msiexec /i <path_to_msi> /l*v <install_logfile_name> ALLUSERS=1
        ```

        Этот процесс является установкой по умолчанию, которая устанавливает Teams в папку `%AppData%` пользователя. На этом этапе завершается установка "золотого образа".

        > [!IMPORTANT]
        > Teams не будет правильно работать с установкой для каждого пользователя при постоянной установке.

    - Установка на компьютере

        ```console
        reg add "HKLM\SOFTWARE\Microsoft\Teams" /v IsWVDEnvironment /t REG_DWORD /d 1 /f
        ```

        Этот процесс добавляет необходимый раздел реестра на компьютер, который позволяет установщику Teams знать, что это экземпляр VDI.  Без него установщик завершится ошибкой, указав следующее: "Установка завершилася сбоем.  Не удается установить для всех пользователей, если среда VDI не обнаружена".

        ```console
        msiexec /i <path_to_msi> /l*v <install_logfile_name> ALLUSER=1 ALLUSERS=1
        ```

        Этот процесс устанавливает Teams в `%ProgramFiles(x86)%` папку в 64-разрядной `%ProgramFiles%` операционной системе и в папку в 32-разрядной операционной системе. На этом этапе завершается установка "золотого образа".

        > [!IMPORTANT]
        >  Установка Teams на компьютере необходима для постоянных настроек.

        Когда начнется следующий интерактивный сеанс входа, Teams запустится и запросит учетные данные.

        > [!NOTE]
        > В этих примерах также используется `ALLUSERS=1` параметр. При установке этого параметра **установщик Teams Machine-Wide** отображается в приложениях  и компонентах панель управления и  в приложениях **&** в параметрах **Windows** для всех пользователей компьютера. После этого все пользователи могут удалить Teams, если у них есть учетные данные администратора.
        >
        > Важно понимать разницу между и `ALLUSERS=1` `ALLUSER=1`. Этот `ALLUSERS=1` параметр можно использовать в средах, отличных от VDI и VDI, `ALLUSER=1` а параметр используется только в средах VDI для указания установки на компьютер.

3. Удалите MSI из виртуальной машины VDI. Удалить Teams можно двумя способами.

    - **Сценарий PowerShell**. Вы можете использовать сценарий [PowerShell](scripts/powershell-script-deployment-cleanup.md) для очистки развертывания Teams, чтобы удалить Teams и папку Teams для пользователя. Запустите скрипт для каждого профиля пользователя, в котором teams был установлен на компьютере.
    - **Командная строка**: выполните следующую команду.
  
      ```console
      msiexec /passive /x <path_to_msi> /l*v <uninstall_logfile_name>
      ```

      Этот процесс удаляет Teams `%ProgramFiles(x86)%` `%ProgramFiles%` из папки или папки в зависимости от среды операционной системы.

## <a name="teams-on-vdi-performance-considerations"></a>Рекомендации по производительности Teams в VDI

Существует множество конфигураций виртуализированной установки, каждая из которых имеет разные параметры оптимизации. Например, конфигурация может сосредоточиться на плотности пользователей. При планировании учитывайте следующее, чтобы оптимизировать настройку в зависимости от потребностей вашей организации в рабочей нагрузке.

- **Минимальное требование**. Для некоторых рабочих нагрузок может потребоваться настройка с использованием ресурсов, которые выше минимальных требований. Например, рабочие нагрузки для разработчиков, использующих приложения, которым требуется больше вычислительных ресурсов.
- **Зависимости:** к ним относятся зависимости от инфраструктуры, рабочей нагрузки и других аспектов среды за пределами настольного приложения Teams.
- **Отключенные функции в VDI**: Teams отключает функции с интенсивным использованием GPU для VDI, что может помочь повысить временную загрузку ЦП. Отключены следующие функции:
    - Анимация Teams CSS
    - Автозапуск Giphy

## <a name="teams-on-vdi-with-calling-and-meetings"></a>Teams в VDI с звонками и собраниями

Помимо чата и совместной работы, Teams на VDI с вызовами и собраниями доступен на поддерживаемых платформах поставщиков виртуализации. Поддерживаемые функции основаны на стеке мультимедиа WebRTC и реализации поставщика виртуализации. На следующей схеме представлен обзор архитектуры.

![Схема архитектуры Teams в VDI.](media/teams-on-vdi-architecture.png)

> [!IMPORTANT]
> Если в настоящее время вы используете Teams без оптимизации av в VDI и используете функции, которые еще не поддерживаются для оптимизации (например, предоставление и контроль при совместном использовании приложений), необходимо настроить политики поставщика виртуализации, чтобы отключить перенаправление Teams. Это означает, что сеансы мультимедиа Teams не будут оптимизированы. Чтобы узнать, как настроить политики для отключения перенаправления Teams, обратитесь к поставщику виртуализации.

### <a name="network-requirements"></a>Требования к сети

Мы рекомендуем оценить среду, чтобы определить все риски и требования, которые могут повлиять на общее развертывание голосовой и видеосвязи в облаке. Используйте средство [Skype для бизнеса оценки](https://www.microsoft.com/download/details.aspx?id=53885) сети, чтобы проверить, готова ли сеть к использованию Teams.

Дополнительные сведения о том, как подготовить сеть для Teams, см. в статье "Подготовка сети организации [к Teams"](prepare-network.md).

### <a name="migrate-from-skype-for-business-on-vdi-to-teams-on-vdi"></a>Переход с Skype для бизнеса VDI на Teams в VDI

Если вы выполняете миграцию Skype для бизнеса VDI в Teams на VDI, помимо различий между двумя приложениями, существуют некоторые отличия при реализации VDI. Ниже перечислены некоторые возможности, которые в настоящее время не поддерживаются в Teams VDI, Skype для бизнеса VDI.

- Политика для каждой платформы для отключения некоторых функций AV в VDI
- Предоставление и контроль при совместном использовании приложений
- Демонстрация экрана из чата без звука
- Отправка и получение одновременных видео- и демонстраций экрана

### <a name="teams-on-chrome-browser-versus-teams-desktop-app-for-vdi"></a>Teams в браузере Chrome и классические приложения Teams для VDI

Teams в браузере Chrome не предоставляет замену классическим приложениям Teams для VDI с оптимизацией AV. Взаимодействие в чате и совместной работе работает должным образом. При необходимости мультимедиа в браузере Chrome могут возникать некоторые возможности, которые могут не соответствовать ожиданиям пользователей:

- Интерфейс потоковой передачи звука и видео может быть неоптимальным. У пользователей могут возникать задержки или снижение качества.
- Параметры устройства недоступны в параметрах браузера.
- Управление устройствами обрабатывается через браузер и требует нескольких параметров в параметрах сайта браузера.
- Также может потребоваться задать параметры устройства в управлении устройствами Windows.

## <a name="teams-on-vdi-with-chat-and-collaboration"></a>Teams в VDI с чатом и совместной работой

Если ваша организация хочет использовать только функции чата и совместной работы в Teams, можно настроить политики уровня пользователя, чтобы отключить функции звонков и собраний в Teams.

### <a name="set-policies-to-turn-off-calling-and-meeting-functionality"></a>Настройка политик для отключения функций звонков и собраний

Политики можно задать с помощью Центра администрирования Teams или PowerShell. Распространение изменений политики занимает до нескольких часов. Если изменения для данной учетной записи не отображаются немедленно, повторите попытку через несколько часов.

[**Политики вызовов**](teams-calling-policy.md): Teams включает встроенную политику вызовов **DisallowCalling** , в которой отключены все функции звонков. **Назначьте политику DisallowCalling** всем пользователям в организации, которые используют Teams в виртуализированной среде.

[**Политики собраний**](meeting-policies-overview.md): Teams включает встроенную политику **собраний AllOff** , в которой отключены все функции собраний. **Назначьте политику AllOff** всем пользователям в организации, которые используют Teams в виртуализированной среде.

#### <a name="assign-policies-using-the-teams-admin-center"></a>Назначение политик с помощью Центра администрирования Teams

Чтобы назначить **пользователю политику звонков DisallowCalling** и **политику собраний AllOff** , выполните указанные ниже действия.

1. В левой области навигации Центра администрирования Teams перейдите к разделу " **Пользователи"**.
2. Выберите пользователя, щелкнув слева от его имени, затем нажмите кнопку **Изменить параметры**.
3. Выполните указанные ниже действия.
    1. В **разделе политики звонков** щелкните **DisallowCalling**.
    2. В **разделе "Политика собраний**" нажмите **кнопку "AllOff"**.
4. Нажмите кнопку **Применить**.

Чтобы назначить политику нескольким пользователям одновременно:

1. В левой области навигации Центра администрирования Teams перейдите к разделу "Пользователи **", а** затем найдите пользователей или отфильтруйте представление, чтобы отобразить нужных пользователей.
2. В столбце **&#x2713;** (галочка) выберите пользователей. Чтобы выбрать всех пользователей, щелкните **&#x2713;(** флажок) в верхней части таблицы.
3. Щелкните **Изменить настройки**, внесите нужные изменения и нажмите **Применить**.

Кроме того, можно выполнить следующие действия:

1. В левой области навигации Центра администрирования Teams перейдите к политике, которую вы хотите назначить. Например:
    - Перейдите **к политикам** > **голосовых** звонков и нажмите кнопку **DisallowCalling**.
    - Перейдите **к политикам собраний** >  и нажмите кнопку **"AllOff"**.
2. Выберите **Управление пользователями**.
3. В области **Управление пользователями** выполните поиск по отображаемому имени или по имени пользователя, выберите имя и нажмите кнопку **Добавить**. Повторите это действие для каждого пользователя, которого нужно добавить.
4. Завершив добавление пользователей, нажмите кнопку " **Сохранить"**.

#### <a name="assign-policies-using-powershell"></a>Назначение политик с помощью PowerShell

В следующем примере показано, как использовать [Grant-CsTeamsCallingPolicy](/powershell/module/skype/grant-csteamscallingpolicy) `DisallowCalling` для назначения политики вызова пользователю.

```PowerShell
Grant-CsTeamsCallingPolicy -PolicyName DisallowCalling -Identity "user email id"
```

Дополнительные сведения об использовании PowerShell для управления политиками вызовов см. в [разделе Set-CsTeamsCallingPolicy](/powershell/module/skype/set-csteamscallingpolicy).

В следующем примере показано, как использовать [Grant-CsTeamsMeetingPolicy](/powershell/module/skype/grant-csteamsmeetingpolicy) `AllOff` для назначения политики собраний пользователю.

```PowerShell
Grant-CsTeamsMeetingPolicy -PolicyName AllOff -Identity "user email id"
```

Дополнительные сведения об использовании PowerShell для управления политиками собраний см. в [разделе Set-CsTeamsMeetingPolicy](/powershell/module/skype/set-csteamsmeetingpolicy).

## <a name="migrate-teams-on-vdi-with-chat-and-collaboration-to-optimize-teams-with-calling-and-meetings"></a>Перенос Teams в VDI с помощью чата и совместной работы для оптимизации Teams с помощью звонков и собраний

Если у вас есть существующая реализация Teams в VDI с чатом и совместной работой, в которой вы настроили политики уровня пользователя, чтобы отключить функции звонков и собраний, и вы переносите в Teams с оптимизацией AV, необходимо настроить политики, чтобы включить функции звонков и собраний для этих пользователей Teams в VDI.

### <a name="set-policies-to-turn-on-calling-and-meeting-functionality"></a>Настройка политик для включения функций звонков и собраний

Вы можете использовать Центр администрирования Teams или PowerShell для настройки и назначения политик звонков и собраний пользователям. Распространение изменений политики может занять некоторое время (несколько часов). Если изменения для данной учетной записи не отображаются немедленно, повторите попытку через несколько часов.

[**Политики вызовов**](teams-calling-policy.md): политики звонков в Teams определяют, какие функции звонков доступны пользователям. Teams включает встроенную политику вызовов **AllowCalling** , в которой включены все функции звонков. Чтобы включить все функции вызова, назначьте **политику AllowCalling** . Или создайте настраиваемую политику звонков, чтобы включить требуемые функции звонков и назначить ее пользователям.

[**Политики собраний**](meeting-policies-overview.md). Политики собраний в Teams контролирует типы собраний, которые пользователи могут создавать, и функции, доступные участникам собрания, запланированным пользователями в вашей организации. Teams включает встроенную политику **собраний AllOn** , в которой включены все функции собраний. Чтобы включить все функции собраний, назначьте политику **AllOn** . Или создайте настраиваемую политику собраний, чтобы включить нужные функции собраний и назначить ее пользователям.

#### <a name="assign-policies-using-the-teams-admin-center"></a>Назначение политик с помощью Центра администрирования Teams

Чтобы назначить **пользователю политику звонков AllowCalling** и политику собраний **AllOn** :

1. В левой области навигации Центра администрирования Teams перейдите к разделу " **Пользователи"**.
2. Выберите пользователя, щелкнув слева от его имени, затем нажмите кнопку **Изменить параметры**.
3. Выполните указанные ниже действия.
    1. В **разделе "Политика звонков**" щелкните **AllowCalling**.
    2. В **разделе "Политика собраний**" щелкните **AllOn**.
4. Нажмите кнопку **Применить**.

Чтобы назначить политику нескольким пользователям одновременно:

1. В левой области навигации Центра администрирования Teams перейдите к разделу "Пользователи **", а** затем найдите пользователей или отфильтруйте представление, чтобы отобразить нужных пользователей.
2. В столбце **&#x2713;** (галочка) выберите пользователей. Чтобы выбрать всех пользователей, щелкните **&#x2713;(** флажок) в верхней части таблицы.
3. Щелкните **Изменить настройки**, внесите нужные изменения и нажмите **Применить**.

Кроме того, можно выполнить следующие действия:

1. В левой области навигации Центра администрирования Teams перейдите к политике, которую вы хотите назначить. Например:
    - Перейдите к **политикам** > **голосовых** звонков и нажмите кнопку **AllowCalling**.
    - Перейдите **к политикам** > **собраний** собраний и нажмите кнопку **AllOn**.
2. Выберите **Управление пользователями**.
3. В области **Управление пользователями** выполните поиск по отображаемому имени или по имени пользователя, выберите имя и нажмите кнопку **Добавить**. Повторите это действие для каждого пользователя, которого нужно добавить.
4. Завершив добавление пользователей, нажмите кнопку " **Сохранить"**.

#### <a name="assign-policies-using-powershell"></a>Назначение политик с помощью PowerShell

В следующем примере показано, как использовать [Grant-CsTeamsCallingPolicy](/powershell/module/skype/grant-csteamscallingpolicy) `AllowCalling` для назначения политики вызова пользователю.

```PowerShell
Grant-CsTeamsCallingPolicy -PolicyName AllowCalling -Identity "user email id"
```

Дополнительные сведения об использовании PowerShell для управления политиками вызовов см. в [разделе Set-CsTeamsCallingPolicy](/powershell/module/skype/set-csteamscallingpolicy).

В следующем примере показано, как использовать [Grant-CsTeamsMeetingPolicy](/powershell/module/skype/grant-csteamsmeetingpolicy) `AllOn` для назначения политики собраний пользователю.

```PowerShell
Grant-CsTeamsMeetingPolicy -PolicyName AllOn -Identity "user email id"
```

Дополнительные сведения об использовании PowerShell для управления политиками собраний см. в [разделе Set-CsTeamsMeetingPolicy](/powershell/module/skype/set-csteamsmeetingpolicy).

## <a name="control-fallback-mode-in-teams"></a>Управление резервным режимом в Teams

Когда пользователи подключаются из неподдерживаемой конечной точки, пользователи находятся в резервном режиме, в котором антивирусная программа не оптимизирована. Вы можете отключить или включить резервный режим, указав одно из `DWORD` следующих значений реестра:

- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Teams\DisableFallback`
- `HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\Teams\DisableFallback`

Чтобы отключить резервный режим, установите значение **1**. Чтобы включить только звук, задайте значение **2**. Если значение отсутствует или равно **0 (ноль** ), включен резервный режим.

Эта функция доступна в Teams версии 1.3.00.13565 и более поздних.

## <a name="disable-audio-and-video-settings-for-vdi"></a>Отключение параметров звука и видео для VDI

Политики VDI Teams доступны в модуле Teams. Эти политики активны и применяются в не оптимизированных средах VDI.

- `New-CsTeamsVdiPolicy`
- `Grant-CsTeamsVdiPolicy`
- `Remove-CsTeamsVdiPolicy`
- `Set-CsTeamsVdiPolicy`

> [!NOTE]
> Это применимо только к не оптимизированным средам.

### <a name="update-a-module-name"></a>Обновление имени модуля

```PowerShell
Update-Module -Name MicrosoftTeams -AllowPrerelease

<# Import and connect to online (CSOnline runs the policies) #>
Import-Module microsoftTeams
if( -not $sess){
    $session = New-CsOnlineSession
    $pss = Import-PSSession $session
}
<# Check out the commands #>
Get-Command -Noun *VDI*
<#
```

### <a name="set-policies-to-limit-calling-features"></a>Настройка политик для ограничения функций вызова

Пользователи, для которых настроена политика VDI `DisableCallsAndMeetings` `$true` для входа в Teams в VDI, не могут:

- Выполните вызовы.
- Присоединяйтесь к собраниям.
- Демонстрация экрана из чата.

Все типы вызовов должны быть отключены.

> [!NOTE]
> Это применимо только к не оптимизированным средам.

```PowerShell
New-CsTeamsVdiPolicy -Identity DisableCallsAndMeetingsTrue -DisableCallsAndMeetings $true -DisableAudioVideoInCallsAndMeetings $false

<# Assign policy #>
$user = 'meganb@jvteams.xyz'
Grant-CsTeamsVdiPolicy -Identity $user -PolicyName DisableCallsAndMeetingsTrue

<# Wait for some time until the policy is applied #>
Get-CSOnlineUser -Identity $user | FL UserPrincipalName, *vdi*

<# Show all policies #>
Get-CsTeamsVdiPolicy | FT Iden*, Disable*
```

Когда пользователи, для которых настроена `$true` политика VDI `DisableAudioVideoInCallsAndMeetings` для входа в Teams в VDI, они:

- Может просматривать общий доступ из чата.
- Может присоединяться к собранию, делиться экраном и перемещать звук на телефон.
- Не может выполнять голосовые и видеозвонки из VDI.

> [!NOTE]
> Это применимо только к не оптимизированным средам.

```powershell
$PolName = "DisableCallsAndMeetingsAV"

New-CsTeamsVdiPolicy -Identity $PolName -DisableCallsAndMeetings $false -DisableAudioVideoInCallsAndMeetings $true
Grant-CsTeamsVdiPolicy -Identity $user -PolicyName $PolName

<# Wait for some time until the policy is applied #>
Get-CSOnlineUser -identity $user | FL UserPrincipalName, *vdi*

<# Cleanup afterwards #>
$cleanup = $false
if($cleanup){

    "Doing cleanup"

    # De-assign policy from user  
    Grant-CsTeamsVdiPolicy -Identity $user -PolicyName $null
    Get-CSOnlineUser -identity $user | FL UserPrincipalName, *vdi*

    # Remove policies
    Get-CsTeamsVdiPolicy | ?{$_.identity -ne 'Global'} | remove-csTeamsVdiPolicy
}
```

## <a name="known-issues-and-limitations"></a>Известные проблемы и ограничения

### <a name="client-deployment-installation-and-setup"></a>Развертывание, установка и настройка клиента

- При установке на компьютер Teams в VDI не обновляется автоматически так, как клиенты Teams, отличные от VDI. Чтобы обновить образ виртуальной машины, установите новый MSI, как описано в разделе "Установка или обновление рабочего приложения [Teams в VDI](#install-or-update-the-teams-desktop-app-on-vdi) ". Необходимо удалить текущую версию, чтобы обновиться до новой версии.
- В средах Citrix, если пользователь отключается от виртуальной машины во время работы Teams, обновления Teams могут привести к не оптимизированной работе пользователя для av при повторном подключении. Мы рекомендуем пользователям выйти из Teams перед отключением от виртуальной машины Citrix, чтобы избежать этого сценария.
- Teams следует развертывать как для каждого пользователя, так и для каждого компьютера. Развертывание Teams для одновременных операций на пользователя и на компьютер не поддерживается. Чтобы перейти с компьютера или пользователя на один из этих режимов, выполните процедуру удаления и повторно разверните его в любом режиме.
- В настоящее время Виртуальный рабочий стол Azure не поддерживает клиенты macOS и Linux.
- Быстрый переключение клиента может привести к ошибкам, связанным с вызовами в VDI, таким как недоступное совместное использование экрана. Перезапуск клиента устраните эти проблемы.

### <a name="notifications"></a>Уведомления

- Уведомление о количестве сообщений и сведения о присутствии на панели задач Windows не поддерживаются на Windows Server 2016 узла.

### <a name="calling-and-meetings"></a>Звонки и собрания

Следующие функции звонков и собраний не поддерживаются:

- Кнопки HID и светодиодные индикаторы между приложением Teams и устройствами для Citrix и VMware
- Размытие фона и эффекты для Citrix и VMware
- Роли организатора и выступающего трансляции и трансляции
- Location-Based маршрутизации (LBR)
- Звуковой сигнал обратного вызова ТСОП
- Общий системный звук или звук компьютера
- Обход сервера-посредника для прямой маршрутизации
- Элемент управления "Масштаб"

> [!NOTE]
> Мы работаем над добавлением функций звонков и собраний, которые в настоящее время доступны только в средах, отличных от VDI. К ним могут относится дополнительный контроль над качеством, дополнительные сценарии демонстрации экрана и расширенные функции, недавно добавленные в Teams. Обратитесь к представителю Teams, чтобы узнать больше о предстоящих функциях.

Ниже приведены известные проблемы и ограничения для звонков и собраний.

- Взаимодействие с Skype для бизнеса ограничивается звуковым вызовом; модальность видео отсутствует.
- Разрешение входящего и исходящего видеопотока ограничено разрешением 720p.
- Teams не переключается на использование последнего звукового устройства, выбранного пользователем, если устройство отключено, а затем повторно подключается.
- Трансляции не оптимизированы.
- Общий доступ к исходящим экранам:
  - Общий доступ к приложениям не поддерживается для VMware и AVD/W365.
- Предоставьте управление и контроль:
  - Не поддерживается во время сеанса общего доступа к приложениям.

Сведения о известных проблемах Teams, не связанных с VDI, см. в разделе ["Группы поддержки" в вашей организации](/MicrosoftTeams/troubleshoot/teams-welcome).

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="troubleshoot-citrix-components"></a>Устранение неполадок с компонентами Citrix

#### <a name="teams-crashes-or-the-teams-sign-in-screen-is-blank"></a>Teams аварийно завершает работу или экран входа в Teams пуст

Это известная проблема с Citrix VDA версий 1906 и 1909. Чтобы обойти эту проблему, добавьте `DWORD` следующее значение реестра и `204` задайте для него шестнадцатеричное значение.

```console

HKEY_LOCAL_MACHINE\SOFTWARE\Citrix\CtxHook\AppInit_Dlls\SfrHook\Teams.exe

```

Затем перезапустите VDA. Дополнительные сведения см. в этой статье о поддержке Citrix, в статье об устранении неполадок с оптимизацией [HDX для Microsoft Teams](https://support.citrix.com/article/CTX253754).

## <a name="related-topics"></a>См. также

- [Массовая установка Teams с помощью установщика Windows (MSI)](msi-deployment.md)
- [Обзор PowerShell в Teams](teams-powershell-overview.md)
- [Использование Microsoft Teams на Виртуальном рабочем столе Azure](/azure/virtual-desktop/teams-on-wvd)
