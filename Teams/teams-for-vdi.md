---
title: Teams для инфраструктуры виртуальных рабочих столов
author: dstrome
ms.author: dstrome
manager: serdars
ms.topic: article
ms.service: msteams
ms.reviewer: rafarhi, jmorrow
audience: admin
description: Узнайте, как запустить Майкрософт Teams в среде инфраструктуры виртуализированных рабочих столов (VDI).
ms.localizationpriority: medium
search.appverid: MET150
f1.keywords:
- NOCSH
ms.collection:
- M365-collaboration
- m365initiative-deployteams
appliesto:
- Microsoft Teams
ms.openlocfilehash: 3a3193b48559fdfc941181963e493d73668bef52
ms.sourcegitcommit: aa398950cc2f10b268c72a2b25caa0cf893e8230
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/08/2022
ms.locfileid: "69307754"
---
# <a name="teams-for-virtualized-desktop-infrastructure"></a>Teams для инфраструктуры виртуальных рабочих столов

В этой статье описываются требования и ограничения использования Майкрософт Teams в виртуализированной среде.

## <a name="what-is-vdi"></a>Что такое VDI?

инфраструктура виртуальных рабочих столов (VDI) — это технология виртуализации, которая размещает настольную операционную систему и приложения на централизованном сервере в центре обработки данных. Это обеспечивает полный и персонализированный интерфейс рабочего стола для пользователей с полностью защищенным и совместимым централизованным источником.

Teams в виртуализированной среде поддерживает чат и совместную работу. Кроме того, на платформах Виртуального рабочего стола Azure, Citrix и VMware также поддерживаются функции звонков и собраний.

Teams также поддерживает несколько конфигураций в виртуальных средах. К ним относятся режимы VDI, выделенные, общие, постоянные и непостоянный режимы. Функции находятся в непрерывной разработке и добавляются на регулярной основе, а функциональность будет расширяться со временем.

Использование Teams в виртуализированной среде может несколько отличаться от использования Teams в невиртуализированной среде. Например, некоторые расширенные функции могут быть недоступны в виртуализированной среде, а разрешение видео может отличаться.

Чтобы обеспечить оптимальный пользовательский интерфейс, следуйте инструкциям в этой статье.

> [!Note]
> Дополнительные сведения о Teams VDI на разных платформах см. в разделе [Возможности Teams по платформам](https://support.microsoft.com/office/teams-features-by-platform-debe7ff4-7db4-4138-b7d0-fcc276f392d3).

## <a name="teams-on-vdi-components"></a>Teams на компонентах VDI

Для использования Teams в виртуализированной среде требуются следующие компоненты.

- **Брокер виртуализации**: диспетчер ресурсов и подключений к поставщику виртуализации, например Azure.
- **Виртуальный рабочий стол**: стек виртуальной машины, на котором выполняется Teams
- **Тонкий клиент**: устройство, с которым пользователь физически взаимодействует.
- **Классическое приложение Teams**: классическое клиентское приложение Teams

## <a name="teams-on-vdi-requirements"></a>Требования Teams к VDI

### <a name="virtualization-provider-requirements"></a>Требования к поставщику виртуализации

Классическое приложение Teams было проверено ведущими поставщиками решений для виртуализации. При наличии нескольких поставщиков на рынке рекомендуется обратиться к поставщику решений виртуализации, чтобы убедиться, что вы соответствуете минимальным требованиям.
  
В настоящее время Teams на VDI с оптимизацией аудио-видео (AV) сертифицирована с помощью Виртуального рабочего стола Azure, Citrix и VMware. Просмотрите сведения в этом разделе, чтобы убедиться, что вы соответствуете всем требованиям для надлежащей функциональности.

### <a name="platforms-certified-for-teams"></a>Платформы, сертифицированные для Teams

На следующих платформах есть решения инфраструктуры виртуальных рабочих столов для Teams.

|Платформа|Решение|
|----|---|
|![Логотип, представляющий Майкрософт.](media/microsoft-logo.png)| <a href="/azure/virtual-desktop/teams-on-wvd" target="_blank">Виртуальный рабочий стол Azure</a><a href="/windows-365/enterprise/teams-on-cloud-pc" target="_blank">, Windows 365</a> |
|![Логотип Citrix.](media/citrix-logo.png)| <a href="https://www.citrix.com/products/citrix-virtual-apps-and-desktops/" target="_blank">Виртуальные приложения и рабочие столы Citrix</a> |
|![Логотип, представляющий VMware.](media/vmware-logo.png)| <a href="https://www.vmware.com/products/horizon.html" target="_blank">VMware Horizon</a> |

### <a name="azure-virtual-desktop"></a>Виртуальный рабочий стол Azure

Виртуальный рабочий стол Azure обеспечивает оптимизацию av для Teams на VDI. Дополнительные сведения о требованиях и установке см. в статье [Использование Teams на Виртуальном рабочем столе Azure](/azure/virtual-desktop/teams-on-wvd).

### <a name="windows-365"></a>Windows 365

Windows 365 использует оптимизацию AV, предоставляемую Виртуальным рабочим столом Azure, чтобы обеспечить оптимальные возможности Teams на облачных компьютерах. Дополнительные сведения о требованиях и установке см. [в статье Использование Teams на облачном компьютере](/windows-365/enterprise/teams-on-cloud-pc).

### <a name="citrix-virtual-apps-and-desktops-requirements"></a>Требования к виртуальным приложениям и рабочим столам Citrix

Виртуальные приложения и рабочие столы Citrix (ранее известные как XenApp и XenDesktop) обеспечивают оптимизацию av для Teams на VDI. Благодаря Виртуальным приложениям и рабочим столам Citrix Teams на VDI поддерживает функции звонков и собраний в дополнение к чату и совместной работе.

Последнюю версию Citrix Virtual Apps and Desktops можно скачать на [сайте загрузки Citrix](https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/). (Сначала необходимо выполнить вход.) Необходимые компоненты по умолчанию объединяются в [приложение Citrix Workspace (CWA)](https://www.citrix.com/downloads/workspace-app/) и виртуальный агент доставки (VDA). Вам не нужно устанавливать дополнительные компоненты или подключаемые модули в CWA или VDA.

Последние требования к серверу и клиенту см. в статье [Оптимизация для Майкрософт Teams](https://docs.citrix.com/en-us/citrix-virtual-apps-desktops/multimedia/opt-ms-teams.html) на веб-сайте Citrix.

### <a name="vmware-horizon-workspace-and-desktop-requirements"></a>Требования к рабочей области и рабочему столу VMware Horizon

VMware Horizon — это современная платформа для безопасной доставки виртуальных рабочих столов и приложений в гибридном облаке. Чтобы обеспечить отличный интерфейс для конечных пользователей, VMware Horizon обеспечивает оптимизацию мультимедиа для Teams. Эта оптимизация повышает общую производительность виртуальных рабочих столов и приложений, а также улучшает взаимодействие с пользователем при вызове и собрании с помощью Teams.

Последнюю версию VMware Horizon можно скачать на странице [загрузки VMware](https://customerconnect.vmware.com/downloads/#all_products) . Необходимые компоненты оптимизации мультимедиа являются частью агента Horizon и клиента Horizon по умолчанию, и нет необходимости устанавливать дополнительный подключаемый модуль для использования функции оптимизации для Teams.

Последние требования и инструкции по настройке оптимизации мультимедиа для Teams см. в статье [Настройка оптимизации мультимедиа для Майкрософт Teams](https://docs.vmware.com/en/VMware-Horizon/2006/horizon-remote-desktop-features/GUID-F68FA7BB-B08F-4EFF-9BB1-1F9FC71F8214.html) на веб-сайте VMware.

## <a name="install-or-update-the-teams-desktop-app-on-vdi"></a>Установка или обновление классического приложения Teams на VDI

Классическое приложение Teams для VDI можно развернуть с помощью установки на компьютер или пользователя с помощью пакета MSI. Выбор того, какой подход следует использовать, зависит от того, используете ли вы постоянную или непрекращающуюся настройку, а также от потребностей вашей организации в соответствующих функциональных возможностях.

Для выделенной постоянной установки будет работать установка как для компьютера, так и для каждого пользователя. Однако для непрекращающейся установки Teams требуется установка на отдельный компьютер, чтобы эффективно работать. См. раздел [Непрекращающаяся настройка](#non-persistent-setup) .

При установке на компьютере автоматические обновления отключаются. Это означает, что для обновления приложения Teams необходимо удалить текущую версию, чтобы обновить ее до более новой версии. При установке на пользователя автоматические обновления включены.

> [!IMPORTANT]
> Обновляйте классическое приложение Teams в среде VDI. Версии классических приложений Teams с датами выпуска, которые более чем на 90 дней старше [даты выпуска текущей версии](/officeupdates/teams-app-versioning) , не поддерживаются. Неподдерживаемые версии классических приложений Teams показывают пользователям страницу блокировки и запрашивают обновление приложения.

Для большинства развертываний VDI рекомендуется развертывать Teams с помощью установки на каждом компьютере. Чтобы выполнить обновление до последней версии Teams, начните с процедуры удаления и развертывания последней версии Teams.

Для правильной работы оптимизации av Teams в средах VDI устройство с тонким клиентом должно иметь доступ к Интернету. Если доступ к Интернету недоступен на тонком клиентском устройстве, запуск оптимизации не будет успешным. Это означает, что пользователь находится в неоптимном состоянии мультимедиа.

#### <a name="dedicated-persistent-setup"></a>Выделенная постоянная настройка

В выделенной постоянной настройке изменения локальной операционной системы пользователей сохраняются после выхода пользователей из системы. Для постоянной установки Teams поддерживает установку как для пользователя, так и для каждого компьютера.

Ниже приведена рекомендуемая минимальная конфигурация виртуальной машины.

|Параметр  |Операционная система рабочей станции  |Операционная система сервера  |
|---------|---------|---------|
|виртуальный ЦП   |    2 ядра     |  4, 6 или 8 ядер<br>Важно понимать базовую конфигурацию неоднородного доступа к памяти (NUMA) и соответствующим образом настроить виртуальные машины.     |
|ОЗУ     |   4 ГБ      | От 512 МБ до 1 ГБ на пользователя        |
|Хранилище    | 8 ГБ        | От 40 ДО 60 ГБ        |

#### <a name="non-persistent-setup"></a>Непрекращающаяся настройка

В непрекращающейся настройке изменения локальной операционной системы пользователей не сохраняются после выхода пользователей из системы. Такие настройки обычно являются общими многопользовательскими сеансами. Конфигурация виртуальной машины зависит от количества пользователей и доступных ресурсов физического сервера.

Для непрекращающейся настройки классическое приложение Teams должно быть установлено на каждом компьютере в золотой образ. Это обеспечивает эффективный запуск приложения Teams во время сеанса пользователя. Дополнительные сведения см. в разделе [Установка или обновление классического приложения Teams на VDI](#install-or-update-the-teams-desktop-app-on-vdi) .

Для использования Teams в непрекращающейся настройке также требуется диспетчер кэширования профилей для эффективной синхронизации данных среды выполнения Teams. Эффективная синхронизация данных гарантирует, что соответствующая пользовательская информация (например, данные пользователя, профиль или параметры) кэшируется во время сеанса пользователя. Убедитесь, что данные в этих двух папках синхронизированы:<br>

- `C:\Users\username\AppData\Local\Microsoft\IdentityCache (%LocalAppData%\Microsoft\IdentityCache)`
- `C:\Users\username\AppData\Roaming\Microsoft\Teams (%AppData%\Microsoft\Teams)`

> [!NOTE]
> Перемещаемая папка (или, если вы используете перенаправление папок, диспетчер кэширования), необходима, чтобы убедиться, что приложение Teams содержит данные и файлы среды выполнения, необходимые для запуска приложения. Это необходимо для устранения проблем с задержкой в сети или сбоев сети, которые в противном случае приводили бы к ошибкам приложения и медленному взаимодействию из-за недоступности данных и файлов.

Существуют различные решения диспетчера кэширования, например [FSLogix](/fslogix/overview). Обратитесь к поставщику диспетчера кэширования для получения конкретных инструкций по настройке.

##### <a name="teams-cached-content-exclusion-list-for-non-persistent-setup"></a>Список исключений кэшированного содержимого Teams для постоянной настройки

Исключите следующее из папки кэширования Teams , `%AppData%/Microsoft/Teams`. Исключение этих элементов помогает уменьшить размер кэширования пользователей для дальнейшей оптимизации непрекращающихся настроек.

- файлы .txt
- Папка Media-stack
- `%AppData%\Microsoft\Teams\meeting-addin\Cache`

### <a name="microsoft-365-apps-for-enterprise-considerations"></a>Рекомендации по Приложения Microsoft 365 для предприятий

При развертывании Teams с Приложения Microsoft 365 для предприятий в VDI следует учитывать следующее.

#### <a name="new-deployments-of-teams-through-microsoft-365-apps-for-enterprise"></a>Новые развертывания Teams через Приложения Microsoft 365 для предприятий

Перед развертыванием Teams с помощью Приложения Microsoft 365 для предприятий необходимо сначала удалить все существующие приложения Teams, если они были развернуты с помощью установки на каждом компьютере.

Teams через Приложения Microsoft 365 для предприятий устанавливается для каждого пользователя. Дополнительные сведения см. в разделе [Установка или обновление классического приложения Teams на VDI](#install-or-update-the-teams-desktop-app-on-vdi) .

#### <a name="teams-deployments-through-microsoft-365-apps-for-enterprise-updates"></a>Развертывания Teams с помощью обновлений Приложения Microsoft 365 для предприятий

Teams также добавляется в существующие установки Приложения Microsoft 365 для предприятий. Так как Приложения Microsoft 365 для предприятий устанавливает Teams только для каждого пользователя, см. раздел [Установка или обновление классического приложения Teams на VDI](#install-or-update-the-teams-desktop-app-on-vdi).

#### <a name="using-teams-with-per-machine-installation-and-microsoft-365-apps-for-enterprise"></a>Использование Teams с установкой на каждом компьютере и Приложения Microsoft 365 для предприятий

Приложения Microsoft 365 для предприятий не поддерживает установку Teams на отдельных компьютерах. Чтобы использовать установку на каждом компьютере, необходимо исключить Teams из Приложения Microsoft 365 для предприятий. См. разделы [Развертывание классического приложения Teams на виртуальной машине](#deploy-the-teams-desktop-app-to-the-vm) и [Исключение развертывания Teams с помощью Приложения Microsoft 365 для предприятий](#how-to-exclude-teams-deployment-through-microsoft-365-apps-for-enterprise) разделов.

#### <a name="how-to-exclude-teams-deployment-through-microsoft-365-apps-for-enterprise"></a>Как исключить развертывание Teams с помощью Приложения Microsoft 365 для предприятий

Дополнительные сведения о Teams и Приложения Microsoft 365 для предприятий см. в [разделах Как исключить Teams из новых установок Приложения Microsoft 365 для предприятий](/DeployOffice/teams-install#how-to-exclude-microsoft-teams-from-new-installations-of-microsoft-365-apps) и [Использование групповая политика для управления установкой Teams](/DeployOffice/teams-install#use-group-policy-to-control-the-installation-of-microsoft-teams).

### <a name="deploy-the-teams-desktop-app-to-the-vm"></a>Развертывание классического приложения Teams на виртуальной машине

⁠1. Скачайте пакет MSI Teams, соответствующий операционной системе виртуальной машины VDI, по одной из следующих ссылок:
    - [32-разрядная версия](https://teams.microsoft.com/downloads/desktopurl?env=production&plat=windows&managedInstaller=true&download=true)
    - [64-разрядная версия](https://teams.microsoft.com/downloads/desktopurl?env=production&plat=windows&arch=x64&managedInstaller=true&download=true)
    > [!NOTE]
    > Сведения об облаках для государственных организаций см. в статье [Массовая установка Teams с помощью установщика Windows (MSI)](msi-deployment.md) для скачивания msi-файлов.

2. Установите MSI на виртуальную машину VDI, выполнив одну из следующих команд:

    - Установка на пользователя (по умолчанию)
  
        ```console
        msiexec /i <path_to_msi> /l*v <install_logfile_name> ALLUSERS=1
        ```

        Этот процесс является установкой по умолчанию, которая устанавливает Teams в папку `%AppData%` пользователя. На этом этапе завершается установка "золотого образа".

        > [!IMPORTANT]
        > Teams не будет работать должным образом при установке на пользователя в непрекращающемся режиме установки.

    - Установка на компьютере

        ```console
        reg add "HKLM\SOFTWARE\Microsoft\Teams" /v IsWVDEnvironment /t REG_DWORD /d 1 /f
        ```

        Этот процесс добавляет на компьютер необходимый раздел реестра, который позволяет установщику Teams знать, что это экземпляр VDI.  Без этого установщик завершит ошибку, заявив: "Установка завершилась сбоем.  Не удается установить для всех пользователей, если среда VDI не обнаружена.

        ```console
        msiexec /i <path_to_msi> /l*v <install_logfile_name> ALLUSER=1 ALLUSERS=1
        ```

        Этот процесс устанавливает Teams в папку `%ProgramFiles(x86)%` в 64-разрядной операционной системе и в папку `%ProgramFiles%` в 32-разрядной операционной системе. На этом этапе завершается установка "золотого образа".

        > [!IMPORTANT]
        >  Установка Teams на компьютер требуется для непрекращающихся настроек.

        Когда начнется следующий интерактивный сеанс входа, Teams запускается и запрашивает учетные данные.

        > [!NOTE]
        > В этих примерах также используется `ALLUSERS=1` параметр . При задании этого параметра **установщик Teams Machine-Wide** отображается в **разделе Программы и компоненты** в **панель управления**, а также в **разделе Приложения & функции** в **параметрах Windows** для всех пользователей компьютера. Все пользователи могут удалить Teams, если у них есть учетные данные администратора.
        >
        > Важно понимать разницу между `ALLUSERS=1` и `ALLUSER=1`. Параметр `ALLUSERS=1` можно использовать в средах, отличных от VDI и VDI, в то время как `ALLUSER=1` параметр используется только в средах VDI для указания установки на отдельный компьютер.

3. Удалите MSI с виртуальной машины VDI. Существует два способа удаления Teams.

    - **Сценарий PowerShell**. Вы можете использовать сценарий PowerShell [для очистки развертывания Teams](scripts/powershell-script-deployment-cleanup.md) , чтобы удалить Teams и папку Teams для пользователя. Запустите сценарий для каждого профиля пользователя, в котором на компьютере была установлена Teams.
    - **Командная строка**: выполните следующую команду.
  
      ```console
      msiexec /passive /x <path_to_msi> /l*v <uninstall_logfile_name>
      ```

      Этот процесс удаляет Teams из `%ProgramFiles(x86)%` папки или `%ProgramFiles%` папки в зависимости от среды операционной системы.

## <a name="teams-on-vdi-performance-considerations"></a>Рекомендации по производительности VDI в Teams

Существуют различные виртуализированные конфигурации настройки, каждая из которых имеет разную направленность на оптимизацию. Например, конфигурация может сосредоточиться на плотности пользователей. При планировании учитывайте следующее, чтобы оптимизировать настройку в зависимости от потребностей вашей организации в рабочей нагрузке.

- **Минимальное требование**. Для некоторых рабочих нагрузок может потребоваться настройка с использованием ресурсов, превышающих минимальные требования. Например, рабочие нагрузки для разработчиков, использующих приложения, требующие большего объема вычислительных ресурсов.
- **Зависимости**. К ним относятся зависимости от инфраструктуры, рабочей нагрузки и других факторов окружающей среды за пределами классического приложения Teams.
- **Отключенные функции в VDI**. Teams отключает для VDI функции, интенсивно использующие GPU, что может помочь улучшить временную загрузку ЦП. Отключены следующие функции:
    - Анимация CSS Teams
    - Автоматический запуск Giphy

## <a name="teams-on-vdi-with-calling-and-meetings"></a>Teams на VDI с звонками и собраниями

Помимо чата и совместной работы, Teams на VDI с звонками и собраниями доступен на поддерживаемых платформах поставщиков виртуализации. Поддерживаемые функции основаны на реализации стека мультимедиа WebRTC и поставщика виртуализации. На следующей схеме представлен обзор архитектуры.

![Схема, показывающая архитектуру Teams в VDI.](media/teams-on-vdi-architecture.png)

> [!IMPORTANT]
> Если в настоящее время вы запускаете Teams без оптимизации av в VDI и используете функции, которые еще не поддерживаются для оптимизации (например, предоставление и контроль при совместном использовании приложений), необходимо настроить политики поставщика виртуализации, чтобы отключить перенаправление Teams. Это означает, что сеансы мультимедиа Teams не будут оптимизированы. Чтобы узнать, как настроить политики для отключения перенаправления Teams, обратитесь к поставщику виртуализации.

### <a name="network-requirements"></a>Требования к сети

Мы рекомендуем оценить среду, чтобы выявить риски и требования, которые могут повлиять на общее развертывание голосовой связи и видео в облаке. Используйте [средство оценки сети Skype для бизнеса](https://www.microsoft.com/download/details.aspx?id=53885), чтобы проверить, готова ли ваша сеть для Teams.

Дополнительные сведения о подготовке сети для Teams см. в статье [Подготовка сети вашей организации для Teams](prepare-network.md).

### <a name="migrate-from-skype-for-business-on-vdi-to-teams-on-vdi"></a>Миграция из Skype для бизнеса в VDI в Teams на VDI

При миграции с Skype для бизнеса в VDI на Teams на VDI, помимо различий между двумя приложениями, существуют некоторые различия при реализации VDI. Ниже перечислены некоторые возможности, которые в настоящее время не поддерживаются в VDI Teams, которые находятся в Skype для бизнеса VDI.

- Политика для каждой платформы для отключения некоторых функций AV в VDI
- Предоставление и контроль над общим доступом к приложениям
- Общий доступ к экрану из чата без звука
- Одновременная отправка и получение видео и демонстрации экрана

### <a name="teams-on-chrome-browser-versus-teams-desktop-app-for-vdi"></a>Teams в браузере Chrome и классическое приложение Teams для VDI

В браузере Teams в Chrome не предусмотрена замена классического приложения Teams для VDI с оптимизацией AV. Чат и совместная работа работают должным образом. Если требуется мультимедиа, существуют некоторые возможности, которые могут не соответствовать ожиданиям пользователей в браузере Chrome:

- Потоковая передача звука и видео может оказаться неоптимальной. У пользователей могут возникнуть задержки или снижение качества.
- Параметры устройства недоступны в параметрах браузера.
- Управление устройствами осуществляется через браузер и требует нескольких параметров в параметрах сайта браузера.
- Также может потребоваться задать параметры устройства в управлении устройствами Windows.

## <a name="teams-on-vdi-with-chat-and-collaboration"></a>Teams в VDI с чатом и совместной работой

Если ваша организация хочет использовать только функции чата и совместной работы в Teams, вы можете настроить политики на уровне пользователей, чтобы отключить функции звонков и собраний в Teams.

### <a name="set-policies-to-turn-off-calling-and-meeting-functionality"></a>Настройка политик для отключения функций звонков и собраний

Политики можно задать с помощью Центра администрирования Teams или PowerShell. Это до нескольких часов для распространения изменений политики. Если вы не видите изменения для определенной учетной записи сразу, повторите попытку через несколько часов.

[**Политики вызовов**](teams-calling-policy.md). Teams включает встроенную политику **запретаcalling** звонков, в которой отключены все функции звонков. Назначьте политику **DisallowCalling** всем пользователям в организации, которые используют Teams в виртуализированной среде.

[**Политики собраний**](meeting-policies-overview.md). Teams включает встроенную политику **собраний AllOff** , в которой отключены все функции собраний. Назначьте политику **AllOff** всем пользователям в организации, которые используют Teams в виртуализированной среде.

#### <a name="assign-policies-using-the-teams-admin-center"></a>Назначение политик с помощью Центра администрирования Teams

Чтобы назначить пользователю политику звонков **DisallowCalling** и политику **собраний AllOff** , выполните следующие действия.

1. В левой области навигации Центра администрирования Teams перейдите в раздел **Пользователи**.
2. Выберите пользователя, щелкнув слева от его имени, затем нажмите кнопку **Изменить параметры**.
3. Выполните указанные ниже действия.
    1. В разделе **Политика вызовов** щелкните **ЗапретитьCalling**.
    2. В разделе **Политика собраний** нажмите кнопку **Все.**
4. Нажмите кнопку **Применить**.

Чтобы назначить политику нескольким пользователям одновременно:

1. В левой области навигации Центра администрирования Teams перейдите в раздел **Пользователи**, а затем найдите пользователей или отфильтруйте представление, чтобы отобразить нужных пользователей.
2. В столбце **&#x2713;** (галочка) выберите пользователей. Чтобы выбрать всех пользователей, щелкните **&#x2713;** (флажок) в верхней части таблицы.
3. Щелкните **Изменить настройки**, внесите нужные изменения и нажмите **Применить**.

Кроме того, можно выполнить следующие действия.

1. В левой области навигации Центра администрирования Teams перейдите к политике, которую вы хотите назначить. Например:
    - Перейдите в раздел Политики **голосовых** > **вызовов**, а затем щелкните **ЗапретитьCalling**.
    - Перейдите  >  в раздел **Политики собраний**, а затем нажмите кнопку **Все.**
2. Выберите **Управление пользователями**.
3. В области **Управление пользователями** выполните поиск по отображаемому имени или по имени пользователя, выберите имя и нажмите кнопку **Добавить**. Повторите это действие для каждого пользователя, которого нужно добавить.
4. Завершив добавление пользователей, нажмите кнопку **Сохранить**.

#### <a name="assign-policies-using-powershell"></a>Назначение политик с помощью PowerShell

В следующем примере показано, как использовать [Grant-CsTeamsCallingPolicy](/powershell/module/skype/grant-csteamscallingpolicy) для назначения `DisallowCalling` политики вызовов пользователю.

```PowerShell
Grant-CsTeamsCallingPolicy -PolicyName DisallowCalling -Identity "user email id"
```

Дополнительные сведения об использовании PowerShell для управления политиками [вызовов см. в разделе Set-CsTeamsCallingPolicy](/powershell/module/skype/set-csteamscallingpolicy).

В следующем примере показано, как использовать [Grant-CsTeamsMeetingPolicy](/powershell/module/skype/grant-csteamsmeetingpolicy) для назначения `AllOff` политики собраний пользователю.

```PowerShell
Grant-CsTeamsMeetingPolicy -PolicyName AllOff -Identity "user email id"
```

Дополнительные сведения об использовании PowerShell для управления политиками собраний см. в разделе [Set-CsTeamsMeetingPolicy](/powershell/module/skype/set-csteamsmeetingpolicy).

## <a name="migrate-teams-on-vdi-with-chat-and-collaboration-to-optimize-teams-with-calling-and-meetings"></a>Миграция Teams на VDI с помощью чата и совместной работы для оптимизации Teams с помощью звонков и собраний

Если у вас есть существующая реализация Teams на VDI с чатом и совместной работой, в которой вы настроили политики на уровне пользователей, чтобы отключить функции звонков и собраний, и вы переходите в Teams с оптимизацией av, необходимо настроить политики для включения функций звонков и собраний для этих пользователей Teams на VDI.

### <a name="set-policies-to-turn-on-calling-and-meeting-functionality"></a>Настройка политик для включения функций звонков и собраний

Вы можете использовать Центр администрирования Teams или PowerShell для настройки и назначения политик звонков и собраний пользователям. Распространение изменений политики может занять некоторое время (несколько часов). Если изменения для данной учетной записи не отображаются сразу, повторите попытку через несколько часов.

[**Политики вызовов**](teams-calling-policy.md). Политики звонков в Teams определяют, какие функции вызовов доступны пользователям. Teams включает встроенную политику **вызовов AllowCalling** , в которой включены все функции звонков. Чтобы включить все функции звонков, назначьте политику **AllowCalling** . Или создайте настраиваемую политику звонков, чтобы включить нужные функции вызовов и назначить их пользователям.

[**Политики собраний**](meeting-policies-overview.md). Политики собраний в Teams управляют типами собраний, которые могут создавать пользователи, и функциями, доступными участникам собрания, запланированными пользователями в вашей организации. Teams включает встроенную политику собраний **AllOn** , в которой включены все функции собраний. Чтобы включить все функции собраний, назначьте политику **AllOn** . Или создайте настраиваемую политику собраний, чтобы включить нужные функции собрания и назначить их пользователям.

#### <a name="assign-policies-using-the-teams-admin-center"></a>Назначение политик с помощью Центра администрирования Teams

Чтобы назначить политику звонков **AllowCalling** и политику собраний **AllOn** пользователю, выполните следующие действия:

1. В левой области навигации Центра администрирования Teams перейдите в раздел **Пользователи**.
2. Выберите пользователя, щелкнув слева от его имени, затем нажмите кнопку **Изменить параметры**.
3. Выполните указанные ниже действия.
    1. В разделе **Политика вызовов** щелкните **AllowCalling**.
    2. В разделе **Политика собрания** щелкните **AllOn**.
4. Нажмите кнопку **Применить**.

Чтобы назначить политику нескольким пользователям одновременно:

1. В левой области навигации Центра администрирования Teams перейдите в раздел **Пользователи**, а затем найдите пользователей или отфильтруйте представление, чтобы отобразить нужных пользователей.
2. В столбце **&#x2713;** (галочка) выберите пользователей. Чтобы выбрать всех пользователей, щелкните **&#x2713;** (флажок) в верхней части таблицы.
3. Щелкните **Изменить настройки**, внесите нужные изменения и нажмите **Применить**.

Кроме того, можно выполнить следующие действия.

1. В левой области навигации Центра администрирования Teams перейдите к политике, которую вы хотите назначить. Например:
    - Перейдите в **раздел Политики** **голосовых** >  вызовов и нажмите кнопку **РазрешитьМасштабирование**.
    - Перейдите в раздел **Политики собраний** > , а затем щелкните **AllOn**.
2. Выберите **Управление пользователями**.
3. В области **Управление пользователями** выполните поиск по отображаемому имени или по имени пользователя, выберите имя и нажмите кнопку **Добавить**. Повторите это действие для каждого пользователя, которого нужно добавить.
4. Завершив добавление пользователей, нажмите кнопку **Сохранить**.

#### <a name="assign-policies-using-powershell"></a>Назначение политик с помощью PowerShell

В следующем примере показано, как использовать [Grant-CsTeamsCallingPolicy](/powershell/module/skype/grant-csteamscallingpolicy) для назначения `AllowCalling` политики вызовов пользователю.

```PowerShell
Grant-CsTeamsCallingPolicy -PolicyName AllowCalling -Identity "user email id"
```

Дополнительные сведения об использовании PowerShell для управления политиками [вызовов см. в разделе Set-CsTeamsCallingPolicy](/powershell/module/skype/set-csteamscallingpolicy).

В следующем примере показано, как использовать [Grant-CsTeamsMeetingPolicy](/powershell/module/skype/grant-csteamsmeetingpolicy) для назначения `AllOn` политики собраний пользователю.

```PowerShell
Grant-CsTeamsMeetingPolicy -PolicyName AllOn -Identity "user email id"
```

Дополнительные сведения об использовании PowerShell для управления политиками собраний см. в разделе [Set-CsTeamsMeetingPolicy](/powershell/module/skype/set-csteamsmeetingpolicy).

## <a name="control-fallback-mode-in-teams"></a>Управление резервным режимом в Teams

Когда пользователи подключаются из неподдерживаемой конечной точки, они находятся в резервном режиме, в котором av's не оптимизирован. Вы можете отключить или включить резервный режим, задав одно из следующих значений реестра `DWORD` :

- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Teams\DisableFallback`
- `HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\Teams\DisableFallback`

Чтобы отключить резервный режим, задайте для параметра значение **1**. Чтобы включить только звук, задайте для параметра значение **2**. Если значение отсутствует или равно **0** (ноль), включен резервный режим.

Эта функция доступна в Teams версии 1.3.00.13565 и более поздних версиях.

## <a name="disable-audio-and-video-settings-for-vdi"></a>Отключение параметров звука и видео для VDI

Политики VDI Teams доступны в модуле Teams. Эти политики активны и применяются в неоптимизируемых средах VDI.

- `New-CsTeamsVdiPolicy`
- `Grant-CsTeamsVdiPolicy`
- `Remove-CsTeamsVdiPolicy`
- `Set-CsTeamsVdiPolicy`

> [!NOTE]
> Это касается только неоптимизированных сред.

### <a name="connect-to-microsoft-teams-powershell"></a>Подключение к PowerShell Майкрософт Teams

Следуйте инструкциям в разделе [Установка модуля PowerShell Майкрософт Teams](/Teams/teams-powershell-install.md), чтобы подключиться к модулю PowerShell Майкрософт Teams. Затем выполните следующую команду, чтобы убедиться, что все командлеты VDI доступны:

```PowerShell
Get-Command -Noun *VDI*
```

### <a name="set-policies-to-limit-calling-features"></a>Настройка политик для ограничения возможностей звонков

Когда пользователи, для которых настроена политика VDI `DisableCallsAndMeetings` для `$true` входа в Teams на VDI, они не могут:

- Совершать звонки.
- Присоединяйтесь к собраниям.
- Общий доступ к экрану из чата.

Все типы вызовов должны быть отключены.

> [!NOTE]
> Это касается только неоптимизированных сред.

```PowerShell
New-CsTeamsVdiPolicy -Identity DisableCallsAndMeetingsTrue -DisableCallsAndMeetings $true -DisableAudioVideoInCallsAndMeetings $false

<# Assign policy #>
$user = 'meganb@jvteams.xyz'
Grant-CsTeamsVdiPolicy -Identity $user -PolicyName DisableCallsAndMeetingsTrue

<# Wait for some time until the policy is applied #>
Get-CSOnlineUser -Identity $user | FL UserPrincipalName, *vdi*

<# Show all policies #>
Get-CsTeamsVdiPolicy | FT Iden*, Disable*
```

Когда пользователи, для которых настроена политика VDI `DisableAudioVideoInCallsAndMeetings` для `$true` входа в Teams на VDI, они:

- Может экранить общий доступ из чата.
- Может присоединиться к собранию, предоставить общий доступ к экрану и переместить звук на телефон.
- Не удается провести аудио- и видеозвонки от пользователя из VDI.

> [!NOTE]
> Это касается только неоптимизированных сред.

```powershell
$PolName = "DisableCallsAndMeetingsAV"

New-CsTeamsVdiPolicy -Identity $PolName -DisableCallsAndMeetings $false -DisableAudioVideoInCallsAndMeetings $true
Grant-CsTeamsVdiPolicy -Identity $user -PolicyName $PolName

<# Wait for some time until the policy is applied #>
Get-CSOnlineUser -identity $user | FL UserPrincipalName, *vdi*

<# Cleanup afterwards #>
$cleanup = $false
if($cleanup){

    "Doing cleanup"

    # De-assign policy from user  
    Grant-CsTeamsVdiPolicy -Identity $user -PolicyName $null
    Get-CSOnlineUser -identity $user | FL UserPrincipalName, *vdi*

    # Remove policies
    Get-CsTeamsVdiPolicy | ?{$_.identity -ne 'Global'} | remove-csTeamsVdiPolicy
}
```

## <a name="known-issues-and-limitations"></a>Известные проблемы и ограничения

### <a name="client-deployment-installation-and-setup"></a>Развертывание, установка и настройка клиента

- При установке на компьютер Teams в VDI не обновляется автоматически так, как клиенты Teams, отличные от VDI. Необходимо обновить образ виртуальной машины, установив новый MSI, как описано в разделе [Установка или обновление классического приложения Teams в VDI](#install-or-update-the-teams-desktop-app-on-vdi) . Необходимо удалить текущую версию, чтобы обновиться до новой версии.
- В средах Citrix, если пользователь отключается от виртуальной машины Teams во время выполнения, обновления Teams могут привести к тому, что пользователь будет находиться в неоптимном состоянии для av при повторном подключении. Мы рекомендуем пользователям выйти из Teams перед отключением от виртуальной машины Citrix, чтобы избежать этого сценария.
- Teams следует развертывать для каждого пользователя или компьютера. Развертывание Teams для одновременного использования для каждого пользователя и каждого компьютера не поддерживается. Чтобы перейти с каждого компьютера или пользователя в один из этих режимов, выполните процедуру удаления и повторно выполните повторное развертывание в любой из режимов.
- Виртуальный рабочий стол Azure в настоящее время не поддерживает клиенты под управлением Linux.
- Быстрое переключение клиента может привести к проблемам, связанным с вызовами на VDI, например к недоступности общего доступа к экрану. Перезапуск клиента позволит устранить эти проблемы.

### <a name="notifications"></a>Уведомления

- Уведомление о количестве сообщений и о присутствии на панели задач Windows не поддерживается на узле Windows Server 2016.

### <a name="calling-and-meetings"></a>Звонки и собрания

Следующие функции звонков и собраний не поддерживаются:

- Кнопки HID и светодиодные элементы управления между приложением Teams и устройствами для Citrix и VMware
- Размытие фона и эффекты для Citrix и VMware
- Роли продюсера трансляции и докладчика трансляции
- Маршрутизация Location-Based (LBR)
- Тон обратного вызова вызовов ТСОП
- Общий системный звук или звук компьютера
- Обход сервера-посредника для прямой маршрутизации
- Элемент управления "Масштаб"

> [!NOTE]
> Мы работаем над добавлением функций звонков и собраний, которые в настоящее время доступны только в средах, отличных от VDI. Это может быть дополнительный контроль администратора над качеством, дополнительные сценарии совместного использования экрана и расширенные функции, недавно добавленные в Teams. Обратитесь к представителю Teams, чтобы узнать больше о предстоящих функциях.

Ниже приведены известные проблемы и ограничения для звонков и собраний.

- Взаимодействие с Skype для бизнеса ограничено аудиозвонками. Модальность видео отсутствует.
- Разрешение входящего и исходящего видеопотока ограничено разрешением 720p.
- Teams не переключается на использование последнего выбранного пользователем звукового устройства, если устройство отключено, а затем повторно подключено.
- Трансляции не оптимизированы.
- Исходящий общий доступ к экрану:
  - Общий доступ к приложениям не поддерживается для VMware и AVD/W365.
- Предоставьте управление и возьмите под контроль:
  - Не поддерживается во время сеанса общего доступа к приложениям.

Сведения об известных проблемах Teams, которые не связаны с VDI, см. [в разделе Группы поддержки в вашей организации](/MicrosoftTeams/troubleshoot/teams-welcome).

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="troubleshoot-citrix-components"></a>Устранение неполадок с компонентами Citrix

#### <a name="teams-crashes-or-the-teams-sign-in-screen-is-blank"></a>Сбой Teams или пустой экран входа в Teams

Это известная проблема с Citrix VDA версий 1906 и 1909. Чтобы обойти эту проблему, добавьте следующее значение реестра `DWORD` и задайте для `204` него значение (шестнадцатеричное).

```console

HKEY_LOCAL_MACHINE\SOFTWARE\Citrix\CtxHook\AppInit_Dlls\SfrHook\Teams.exe

```

Затем перезапустите VDA. Дополнительные сведения см. в этой статье поддержки Citrix, [посвященной устранению неполадок с оптимизацией HDX для Майкрософт Teams](https://support.citrix.com/article/CTX253754).

## <a name="related-topics"></a>См. также

- [Массовая установка Teams с помощью установщика Windows (MSI)](msi-deployment.md)
- [Обзор PowerShell в Teams](teams-powershell-overview.md)
- [Использование Майкрософт Teams на Виртуальном рабочем столе Azure](/azure/virtual-desktop/teams-on-wvd)
