---
title: Teams для инфраструктуры виртуальных рабочих столов
author: serdars
ms.author: v-mahoffman
manager: serdars
ms.topic: article
ms.service: msteams
ms.reviewer: rafarhi, jmorrow
audience: admin
description: Узнайте, как Microsoft Teams в среде инфраструктуры виртуальных рабочих столов (VDI).
ms.localizationpriority: medium
search.appverid: MET150
f1.keywords:
- NOCSH
ms.collection:
- M365-collaboration
- m365initiative-deployteams
appliesto:
- Microsoft Teams
ms.openlocfilehash: 2461620fa70ba6bf3b3db4db613e6d5adb908ddb
ms.sourcegitcommit: 65a10f80e5dfd67b2778e09f5f92c21ef09ce36a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2021
ms.locfileid: "60753860"
---
# <a name="teams-for-virtualized-desktop-infrastructure"></a>Teams для инфраструктуры виртуальных рабочих столов

В этой статье описаны требования и ограничения для использования Microsoft Teams в виртуализированной среде.

## <a name="what-is-vdi"></a>Что такое VDI?

инфраструктура виртуальных рабочих столов (VDI) — это технология виртуализации, которая размещена на настольной операционной системе и приложениях на централизованном сервере в центре обработки данных. Это обеспечивает полностью персонализированный рабочий стол для пользователей с полностью защищенным и совместимым централизованным источником.

Microsoft Teams виртуализированной среде поддерживает чат и совместную работу. Кроме того, на платформах Azure Virtual Desktop, Citrix и VMware поддерживаются функции звонков и собраний.

Teams виртуализированной среде поддерживает несколько конфигураций. К ним относятся VDI, выделенный, общий, сохраняемый и неохраняемый режим. Функции постоянно находятся в разработке и добавляются регулярно, а функциональные возможности будут расширяться в ближайшие месяцы и годы.

Использование Teams в виртуализированной среде может несколько отличается от Teams в неиртуализированной среде. Например, некоторые дополнительные функции могут быть недоступны в виртуализированной среде, а разрешение видео может различаться.

Чтобы обеспечить оптимальный пользовательский интерфейс, следуйте указаниям в этой статье.

> [!Note]
> Подробные сведения о Teams VDI на разных платформах см. в Teams [по платформам.](https://support.microsoft.com/office/teams-features-by-platform-debe7ff4-7db4-4138-b7d0-fcc276f392d3)

## <a name="teams-on-vdi-components"></a>Teams компонентов VDI

Для Teams виртуализированной среды требуются следующие компоненты:

- **Брокер виртуализации:** диспетчер ресурсов и подключений к поставщику виртуализации, например Azure
- **Виртуальный рабочий** стол: стопка виртуальной машины (VM), которая работает Microsoft Teams
- **Тонкий** клиент: конечная точка, с помощью которую пользователь физически взаимодействует с
- **Teams:** клиентская Teams для настольных пк

## <a name="teams-on-vdi-requirements"></a>Teams требования к VDI

### <a name="virtualization-provider-requirements"></a>Требования к поставщику виртуализации

Настольное Teams проверено ведущими поставщиками решений для виртуализации. Мы рекомендуем обратиться к поставщику решений для виртуализации, чтобы убедиться в том, что вы соответствуете минимальным требованиям.
  
В настоящее Teams на VDI с помощью функций аудио- и видеофайлов, которые сертифицированы с помощью виртуальных рабочих столов Azure, Citrix и VMWARE. Просмотрите сведения в этом разделе, чтобы убедиться, что вы соответствуете всем требованиям к необходимым функциям.

### <a name="platforms-certified-for-teams"></a>Платформы, сертифицированные для Teams

На следующих платформах есть решения инфраструктуры виртуальных рабочих Teams.

|Платформа|Решение|
|----|---|
|![Логотип Корпорации Майкрософт.](media/microsoft-logo.png)| <a href="/azure/virtual-desktop/teams-on-wvd" target="_blank">Виртуальный рабочий стол Azure</a> |
|![Логотип, представляющий Citrix.](media/citrix-logo.png)| <a href="https://www.citrix.com/products/citrix-virtual-apps-and-desktops/" target="_blank">Виртуальные приложения и рабочие столы Citrix</a> |
|![Логотип, представляющий VMware.](media/vmware-logo.png)| <a href="https://www.vmware.com/products/horizon.html" target="_blank">VMware Horizon</a> |

### <a name="azure-virtual-desktop"></a>Виртуальный рабочий стол Azure

Виртуальный рабочий стол Azure обеспечивает оптимизацию av для Teams в VDI. Дополнительные узнать о требованиях и установке см. в Teams [на виртуальном](/azure/virtual-desktop/teams-on-wvd)рабочем столе Azure.

### <a name="citrix-virtual-apps-and-desktops-requirements"></a>Требования к виртуальным приложениям и рабочим столам Citrix

Виртуальные приложения и рабочие столы Citrix (прежнее название — XenApp и XenDesktop) обеспечивают оптимизацию av для Teams vDI. Виртуальные приложения и настольные компьютеры Citrix Teams VDI поддерживают вызовы и собрания, а также чат и совместную работу.

Вы можете скачать последнюю версию виртуальных приложений и рабочих стола Citrix на сайте [загрузки Citrix.](https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/) (Сначала необходимо войти в нее.) Необходимые компоненты по умолчанию объединены в приложения [Citrix Workspace (CWA)](https://www.citrix.com/downloads/workspace-app/) и виртуальный агент доставки (VDA). Вам не нужно устанавливать дополнительные компоненты или подключаемый модуль на CWA или VDA.

Последние требования к серверу и клиенту см. на [этом веб-сайте Citrix.](https://docs.citrix.com/en-us/citrix-virtual-apps-desktops/multimedia/opt-ms-teams.html)

### <a name="vmware-horizon-workspace-and-desktop-requirements"></a>Требования к VMware Horizon Workspace и рабочему столу

VMware Horizon — это современная платформа для безопасной доставки виртуальных рабочих столов и приложений в гибридном облаке. Чтобы предложить пользователям отличный интерфейс, VMware Horizon обеспечивает оптимизацию мультимедиа для Teams. Эта оптимизация повышает общую производительность виртуальных рабочих столов и приложений, а также улучшает пользовательский интерфейс при звонках и собраниях с помощью Teams.

Последнюю версию VMware Horizon можно скачать на странице [Загрузки VMware.](https://customerconnect.vmware.com/downloads/#all_products) По умолчанию необходимые компоненты оптимизации мультимедиа являются частью службы "Агент Горизонта" и клиента Horizon, и для использования функции оптимизации для работы с Teams не требуется устанавливать дополнительный подключаемый модуль.

Последние требования и инструкции по настройке оптимизации мультимедиа для Teams см. на этом веб-сайте [VMWARE.](https://docs.vmware.com/en/VMware-Horizon/2006/horizon-remote-desktop-features/GUID-F68FA7BB-B08F-4EFF-9BB1-1F9FC71F8214.html)

## <a name="install-or-update-the-teams-desktop-app-on-vdi"></a>Установка или обновление Teams версии в VDI

Вы можете развернуть Teams для VDI с помощью установки на компьютере или на пользователя с помощью пакета MSI. Выбор того, какой подход следует использовать, зависит от того, какую конфигурацию следует использовать: постоянную или нестойкость, и от потребностей организации в функциональных возможностях.

При специальной сохраняемой настройке будет работать любой из них. Однако для неохраняемой настройки Teams для эффективной работы требуется установка на компьютере. См. [раздел Неохраняемая](#non-persistent-setup) настройка.

При установке на компьютере автоматические обновления отключаются. Это означает, что чтобы обновить Teams, необходимо удалить текущую версию, чтобы обновить ее до более новой версии. При установке по пользователям автоматические обновления включены. Для большинства развертывание VDI рекомендуется развернуть Teams с помощью установки на компьютере.

Чтобы обновить версию до последней Teams, начните с процедуры удалить, а затем — Teams версии.

Чтобы Teams VDI в средах VDI, тонкая конечная точка должна иметь доступ к Интернету. Если доступ к Интернету не доступен на тонкой конечной точке клиента, запуск оптимизации не будет успешным. Это означает, что пользователь находится в не оптимизированной области мультимедиа.

#### <a name="dedicated-persistent-setup"></a>Специальная постоянная настройка

При выделенной сохраняемой настройке изменения локальной операционной системы пользователей сохраняются после входа пользователей. Для сохраняемой настройки Teams поддерживает установку как по пользователям, так и по компьютерам.

Ниже данная конфигурация является рекомендуемой минимальной конфигурацией VM.

|Параметр  |Операционная система Рабочей станции  |Операционная система сервера  |
|---------|---------|---------|
|vCPU   |    2 ядра     |  4,6 или 8<br>Важно разобраться в конфигурации доступа к памяти, которая не является единообразным, и соответствующим образом настроить свои ВМ-памяти.     |
|ОЗУ     |   4 ГБ      | От 512 до 1024 МБ на пользователя        |
|Хранилище    | 8 ГБ        | От 40 до 60 ГБ        |

#### <a name="non-persistent-setup"></a>Неохраняемая настройка

При неохраняемой настройке изменения локальной операционной системы пользователей не сохраняются после входа пользователей. Такие настройки обычно являются общими для нескольких пользователей. Конфигурация VM зависит от количества пользователей и доступных физических полей.

Для нестойкой настройки Teams на компьютере должно быть установлено золотое изображение. (Дополнительные информацию см. в разделе Установка или обновление Teams настольного приложения [на веб-сайте VDI.)](#install-or-update-the-teams-desktop-app-on-vdi) Это обеспечивает эффективный запуск приложения Teams во время сеанса пользователя.

Для Teams неустандартной настройки требуется диспетчер кэширования профилей, что Teams синхронизации данных во время работы. Эффективная синхронизация данных обеспечивает кэширование соответствующих пользовательских данных (например, данных, профилей или параметров) во время сеанса пользователя. Убедитесь, что данные в этих двух папках синхронизированы.<br>

- C:\Users\имя пользователя\AppData\Local\Microsoft\IdentityCache (%localAppdata%\Microsoft\IdentityCache)
- C:\Users\имя пользователя\AppData\Roaming\Microsoft\Teams (%appdata%\Microsoft\Teams)

> [!NOTE]
> Папка в роуминге (или, если вы используете перенаправление папок, диспетчер кэшинга) необходима, чтобы гарантировать, что в приложении Teams есть данные и файлы, необходимые для запуска приложения. Это необходимо для уменьшения проблем с сетевыми задержками или сбоев в сети, что в противном случае приведет к ошибкам приложения и замедлению работы из-за недоступных данных и файлов.

Существует множество решений для диспетчера кэшов. Например, [FSLogix](/fslogix/overview). За конкретными инструкциями по настройке обратитесь к поставщику диспетчера кэшов.

##### <a name="teams-cached-content-exclusion-list-for-non-persistent-setup"></a>Teams списка исключений из кэшного содержимого для неохраняемой настройки

Исключите из Teams кэша %appdata%/Microsoft/Teams. Исключая эти элементы, можно уменьшить размер кэша пользователей, чтобы оптимизировать неохраняемую настройку.

- .txt файлы
- Папка стека мультимедиа
- meeting-addin\Cache (%appdata%\Microsoft\Teams\meeting-addin\Cache)

### <a name="microsoft-365-apps-for-enterprise-considerations"></a>Приложения Microsoft 365 для предприятий вопросы

При развертывании Teams с Приложения Microsoft 365 для предприятий VDI учитывайте следующее:

#### <a name="new-deployments-of-teams-through-microsoft-365-apps-for-enterprise"></a>Новые развертывания Teams-Приложения Microsoft 365 для предприятий

Перед развертыванием Teams до Приложения Microsoft 365 для предприятий необходимо удалить все приложения, которые уже Teams, если они были развернуты с помощью установки на компьютере.

Teams-Приложения Microsoft 365 для предприятий устанавливается для каждого пользователя. Дополнительные информацию см. в [разделе Установка или обновление Teams настольного приложения на веб-сайте VDI.](#install-or-update-the-teams-desktop-app-on-vdi)

#### <a name="teams-deployments-through-microsoft-365-apps-for-enterprise-updates"></a>Teams развертывания с помощью Приложения Microsoft 365 для предприятий обновлений

Teams также добавляется в существующие установки Приложения Microsoft 365 для предприятий. Поскольку Приложения Microsoft 365 для предприятий установки Teams только для каждого пользователя, см. раздел Установка или обновление Teams настольного приложения [на VDI.](#install-or-update-the-teams-desktop-app-on-vdi)

#### <a name="using-teams-with-per-machine-installation-and-microsoft-365-apps-for-enterprise"></a>Использование Teams с установкой и установкой на Приложения Microsoft 365 для предприятий

Приложения Microsoft 365 для предприятий не поддерживает установку Teams. Чтобы использовать установку на компьютере, необходимо исключить Teams из Приложения Microsoft 365 для предприятий. См. [статьи Развертывание Teams на](#deploy-the-teams-desktop-app-to-the-vm) компьютере с VM и Исключение Teams помощью [Приложения Microsoft 365 для предприятий](#how-to-exclude-teams-deployment-through-microsoft-365-apps-for-enterprise) разделах.

#### <a name="how-to-exclude-teams-deployment-through-microsoft-365-apps-for-enterprise"></a>Исключение Teams с помощью Приложения Microsoft 365 для предприятий

Дополнительные Teams и Приложения Microsoft 365 для предприятий см. в Teams из новых установок [Приложения Microsoft 365 для предприятий](/DeployOffice/teams-install#how-to-exclude-microsoft-teams-from-new-installations-of-microsoft-365-apps) и Управление установкой [Teams.](/DeployOffice/teams-install#use-group-policy-to-control-the-installation-of-microsoft-teams)

### <a name="deploy-the-teams-desktop-app-to-the-vm"></a>Развертывание Teams на компьютере с VM

1. Скачайте пакет Teams MSI, который соответствует вашей операционной системе VDI VM, по одной из следующих ссылок:

    - [32-разрядная версия](https://teams.microsoft.com/downloads/desktopurl?env=production&plat=windows&managedInstaller=true&download=true)
    - [64-разрядная версия](https://teams.microsoft.com/downloads/desktopurl?env=production&plat=windows&arch=x64&managedInstaller=true&download=true)

    > [!NOTE]
    > Ссылки на [MSI-файлы см.](msi-deployment.md) в Microsoft Teams с Microsoft Endpoint Configuration Manager с помощью Microsoft Endpoint Configuration Manager для скачивания файлов.

    Минимальной версией Teams является версия 1.3.00.4461. (В более ранних версиях удержание по ННР не поддерживается.)

2. Установите MSI-решение в VDI VM с помощью одной из следующих команд:

    - Установка по пользователю (по умолчанию)
  
        ```console
        msiexec /i <path_to_msi> /l*v <install_logfile_name> ALLUSERS=1
        ```

        Этот процесс устанавливается по умолчанию и устанавливает Teams в папку пользователя %AppData%. На этом этапе завершается установка "золотого образа". Teams не будет правильно работать с установкой "на пользователя" при непосохраняемой настройке.

    - Установка на компьютере

        ```console
        reg add "HKLM\SOFTWARE\Microsoft\Teams" /v IsWVDEnvironment /t REG_DWORD /d 1 /f
        ```

        Этот процесс добавляет на компьютер необходимый реестр, который позволяет установщику Teams узнать, что это экземпляр VDI.  Если не сделать этого, установщик выберет ошибку, указав: "Не удалось установить.  Не удается установить для всех пользователей, если среда VDI не обнаружена".

        ```console
        msiexec /i <path_to_msi> /l*v <install_logfile_name> ALLUSER=1 ALLUSERS=1
        ```

        Этот процесс Teams в папку "Файлы программ" (x86) в 64-битной операционной системе и в папку "Файлы программ" в 32-битной операционной системе. На этом этапе завершается установка "золотого образа". Установка Teams на компьютере требуется для непосохраняемой настройки.

        Следующий интерактивный сеанс входа запускает Teams и запрашивает учетные данные.

        > [!NOTE]
        > В этих примерах также используется параметр **ALLUSERS=1.** При установке этого параметра, установщик Teams на уровне компьютера отображается в пункте "Программы и компоненты" на панели управления и в пункте "Приложения и функция" в параметрах Windows для всех пользователей компьютера. После этого все пользователи могут удалить Teams, если у них есть учетные данные администратора.
        Важно понимать разницу между **ALLUSERS=1** и **ALLUSER=1.** Параметр **ALLUSERS=1** можно использовать не в средах VDI и VDI, а параметр **ALLUSER=1** используется только в средах VDI для указания установки на компьютере.

3. Удалить MSI-решение из VDI VM. Удалить эти Teams можно двумя Teams.

    - Сценарий PowerShell: с помощью этого сценария [PowerShell](scripts/powershell-script-deployment-cleanup.md) можно удалить Teams и удалить Teams папку пользователя. Запустите сценарий для каждого профиля пользователя, в Teams на компьютере.
    - Командная строка: запустите следующую команду:
  
      ```console
      msiexec /passive /x <path_to_msi> /l*v <uninstall_logfile_name>
      ```

      Этот процесс Teams из папки "Файлы программ" (x86) или "Файлы программ" в зависимости от среды операционной системы.

## <a name="teams-on-vdi-performance-considerations"></a>Teams о производительности VDI

Существует множество конфигураций виртуализированной настройки, каждая из которых посвящена оптимизации. Например, конфигурация может сосредоточиться на плотности пользователей. При планировании учитывайте следующие моменты, чтобы оптимизировать настройки с учетом потребностей вашей организации в рабочей нагрузке.

- Минимальное требование. Для некоторых рабочих нагрузок может потребоваться настройка с использованием ресурсов, которые больше минимальных требований. Например, рабочие нагрузки для разработчиков, которые используют приложения, для которых требуются дополнительные вычислительные ресурсы.
- Зависимости: к ним относятся зависимости от инфраструктуры, рабочей нагрузки и других факторов, не влиять на Teams приложения.
- Отключенные функции VDI: Teams отключает емкие функции GPU для VDI, что помогает улучшить их использование. Отключены следующие возможности:
    - Teams Анимация CSS
    - Автоматическое начало Giphy

## <a name="teams-on-vdi-with-calling-and-meetings"></a>Teams VDI с помощью звонков и собраний

Помимо чата и совместной работы, Teams VDI с звонками и собраниями доступны на поддерживаемых платформах поставщиков виртуализации. Поддерживаемые функции основаны на внедрении стека мультимедиа WebRTC и поставщика виртуализации. На следующей схеме представлен обзор архитектуры.

![Схема, показывающая Teams архитектуре VDI.](media/teams-on-vdi-architecture.png)

> [!IMPORTANT]
> Если в настоящее время вы Teams VDI без оптимизации av и используете функции, которые пока не поддерживаются для оптимизации (например, предоставить и получить управление при совместном использовании приложений), необходимо настроить политики поставщиков виртуализации, чтобы отключить Teams перенаправление. Это означает, Teams сеансы мультимедиа не будут оптимизированы. Чтобы узнать, как настроить политики для отключения Teams перенаправления, обратитесь к поставщику виртуализации.

### <a name="network-requirements"></a>Требования к сети

Мы рекомендуем оценить вашу среду, чтобы выявить все риски и требования, которые могут повлиять на общее развертывание облачной голосовой и видеосвязи. С помощью [Skype для бизнеса оценки](https://www.microsoft.com/download/details.aspx?id=53885) сети проверьте, готова ли сеть к Teams.

Дополнительные информацию о подготовке сети к Teams см. в этой [Teams.](prepare-network.md)

### <a name="migrate-from-skype-for-business-on-vdi-to-teams-on-vdi"></a>Переход с Skype для бизнеса VDI на Teams в VDI

При переходе с Skype для бизнеса VDI на Teams VDI помимо различий между двумя приложениями существуют некоторые отличия при внедрении VDI. Некоторые возможности, которые в настоящее время не поддерживаются Teams VDI, Skype для бизнеса VDI:

- Политика на платформе для отключения некоторых функций av в VDI
- Управление при совместном использовании приложений
- "Поделиться экраном из чата без звука"
- Отправка и получение одновременного общего доступа к видео и экрану

### <a name="teams-on-chrome-browser-versus-teams-desktop-app-for-vdi"></a>Teams браузере Chrome и Teams для VDI

Teams браузере Chrome не заменяет настольное приложение Teams для VDI с оптимизацией av. Взаимодействие и взаимодействие в чате работают так, как ожидалось. При необходимости мультимедиа в браузере Chrome некоторые интерфейсы могут не соответствовать ожиданиям пользователей.

- Возможно, потоковая передача звука и видео не является оптимальной. У пользователей могут возникнуть задержки или снижение качества.
- Параметры устройства недоступны в параметрах браузера.
- Управление устройствами обрабатывается через браузер и требует нескольких параметров в параметрах сайта браузера.
- Кроме того, может потребоваться настроить параметры устройства Windows управления устройствами.

## <a name="teams-on-vdi-with-chat-and-collaboration"></a>Teams VDI с помощью чата и совместной работы

Если ваша организация хочет использовать только функции чата и совместной работы в Teams, вы можете настроить политики на уровне пользователей, чтобы отключить функции звонков и собраний в Teams.

### <a name="set-policies-to-turn-off-calling-and-meeting-functionality"></a>Настройка политик для отключения функций звонков и собраний

Вы можете настроить политики с помощью Microsoft Teams или PowerShell. Распространение изменений политики может занять некоторое время (несколько часов). Если вы не видите изменений для учетной записи сразу, попробуйте еще раз через несколько часов.

[**Политики звонков:**](teams-calling-policy.md)Teams включает встроенную политику звонков DisallowCalling, в которой отключены все функции звонков. Назначьте политику DisallowCalling всем пользователям в организации, Teams виртуализированной среде.

[**Политики собраний:**](meeting-policies-overview.md)Teams включает встроенную политику собраний AllOff, в которой все функции собраний отключены. Назначьте политику AllOff всем пользователям в организации, Teams виртуализированной среде.

#### <a name="assign-policies-using-the-microsoft-teams-admin-center"></a>Назначение политик с помощью центра Microsoft Teams администрирования

Чтобы назначить пользователю политику звонков DisallowCalling и политику собраний AllOff:

1. В левой области навигации центра администрирования Microsoft Teams перейдите в меню **Пользователи**.
2. Выберите пользователя, щелкнув слева от его имени, затем нажмите кнопку **Изменить параметры**.
3. Выполните указанные ниже действия.
    1. В **области Политика звонков** нажмите **кнопку DisallowCalling (DisallowCalling)**.
    2. В **области Политика собраний** щелкните **AllOff**.
4. Нажмите кнопку **Применить**.

Чтобы назначить политику нескольким пользователям одновременно:

1. В левой области навигации Центра администрирования Microsoft Teams выберите **Пользователи** и найдите пользователей или отфильтруйте представление, чтобы отобразить нужных пользователей.
2. В столбце **&#x2713;** (галочка) выберите пользователей. Чтобы выбрать всех пользователей, щелкните &#x2713; (галочку) в верхней части таблицы.
3. Щелкните **Изменить настройки**, внесите нужные изменения и нажмите **Применить**.

Кроме того, вы можете сделать следующее:

1. В левой области навигации центра администрирования Microsoft Teams перейдите к нужной политике. Например:
    - Перейдите **к**  >  **политикам голосовых** звонков и нажмите кнопку **DisallowCalling (DisallowCalling)**.
    - Перейдите **в политику**  >  **собраний собраний** и нажмите кнопку **AllOff**.
2. Выберите **Управление пользователями**.
3. В области **Управление пользователями** выполните поиск по отображаемому имени или по имени пользователя, выберите имя и нажмите кнопку **Добавить**. Повторите это действие для каждого пользователя, которого нужно добавить.
4. Завершив добавление пользователей, нажмите кнопку **Сохранить**.

#### <a name="assign-policies-using-powershell"></a>Назначение политик с помощью PowerShell

В следующем примере показано, как использовать [grant-CsTeamsCallingPolicy](/powershell/module/skype/grant-csteamscallingpolicy) для назначения пользователю политики звонков DisallowCalling.

```PowerShell
Grant-CsTeamsCallingPolicy -PolicyName DisallowCalling -Identity "user email id"
```

Дополнительные информацию об управлении политиками звонков с помощью PowerShell см. в теме [Set-CsTeamsCallingPolicy.](/powershell/module/skype/set-csteamscallingpolicy)

В следующем примере показано, как использовать [Grant-CsTeamsMeetingPolicy](/powershell/module/skype/grant-csteamsmeetingpolicy) для назначения пользователю политики собраний AllOff.

```PowerShell
Grant-CsTeamsMeetingPolicy -PolicyName AllOff -Identity "user email id"
```

Дополнительные информацию об управлении политиками собраний с помощью PowerShell см. в теме [Set-CsTeamsMeetingPolicy.](/powershell/module/skype/set-csteamsmeetingpolicy)

## <a name="migrate-teams-on-vdi-with-chat-and-collaboration-to-optimize-teams-with-calling-and-meetings"></a>Перенос Teams vDI с помощью чата и совместной работы для оптимизации Teams звонками и собраниями

Если у вас уже есть реализация Teams в VDI с чатом и совместной работой, в которых вы настроили политики на уровне пользователей, чтобы отключить функции звонков и собраний, и вы хотите перейти на Teams с помощью оптимизации av, необходимо настроить политики, чтобы включить функции звонков и собраний для пользователей Teams для пользователей VDI.

### <a name="set-policies-to-turn-on-calling-and-meeting-functionality"></a>Настройка политик для того, чтобы включить функции звонков и собраний

Вы можете использовать Microsoft Teams или PowerShell для назначения пользователям политик звонков и собраний. Распространение изменений политики может занять некоторое время (несколько часов). Если вы не видите изменений для учетной записи сразу, попробуйте еще раз через несколько часов.

[**Политики звонков.**](teams-calling-policy.md)Политики звонков в Teams контролировать, какие функции звонков доступны пользователям. Teams включает встроенную политику звонков AllowCalling, в которой включены все функции звонков. Чтобы включить все функции звонков, назначьте политику AllowCalling. Кроме того, можно создать настраиваемую политику звонков, чтобы включить нужные функции звонков и назначить их пользователям.

[**Политики собраний.**](meeting-policies-overview.md)Политики собраний в Teams управлять типами собраний, которые пользователи могут создавать, и возможностями, доступными для участников собрания, запланированных пользователями в организации. Teams включает встроенную политику собраний AllOn, в которой включены все функции собраний. Чтобы включить все функции собраний, назначьте политику AllOn. Кроме того, можно создать настраиваемую политику собраний, чтобы включить нужные функции собраний и назначить ее пользователям.

#### <a name="assign-policies-using-the-microsoft-teams-admin-center"></a>Назначение политик с помощью центра Microsoft Teams администрирования

Чтобы назначить пользователю политику звонков AllowCalling и политику собраний AllOn:

1. В левой области навигации центра администрирования Microsoft Teams перейдите в меню **Пользователи**.
2. Выберите пользователя, щелкнув слева от его имени, затем нажмите кнопку **Изменить параметры**.
3. Выполните указанные ниже действия.
    1. В **области Политика звонков** щелкните **AllowCalling**.
    2. В **области Политика собраний** щелкните **AllOn**.
4. Нажмите кнопку **Применить**.

Чтобы назначить политику нескольким пользователям одновременно:

1. В левой области навигации Центра администрирования Microsoft Teams выберите **Пользователи** и найдите пользователей или отфильтруйте представление, чтобы отобразить нужных пользователей.
2. В столбце **&#x2713;** (галочка) выберите пользователей. Чтобы выбрать всех пользователей, **щелкните**&#x2713;(check mark) в верхней части таблицы.
3. Щелкните **Изменить настройки**, внесите нужные изменения и нажмите **Применить**.

Кроме того, вы можете сделать следующее:

1. В левой области навигации центра администрирования Microsoft Teams перейдите к нужной политике. Например:
    - Перейдите к  >  **политикам голосовых** звонков и нажмите **кнопку AllowCalling**.
    - Перейдите **в политику**  >  **собраний собраний** и нажмите кнопку **AllOn**.
2. Выберите **Управление пользователями**.
3. В области **Управление пользователями** выполните поиск по отображаемому имени или по имени пользователя, выберите имя и нажмите кнопку **Добавить**. Повторите это действие для каждого пользователя, которого нужно добавить.
4. Завершив добавление пользователей, нажмите кнопку **Сохранить**.

#### <a name="assign-policies-using-powershell"></a>Назначение политик с помощью PowerShell

В следующем примере показано, как назначить политику звонков AllowCalling пользователю с помощью [Grant-CsTeamsCallingPolicy.](/powershell/module/skype/grant-csteamscallingpolicy)

```PowerShell
Grant-CsTeamsCallingPolicy -PolicyName AllowCalling -Identity "user email id"
```

Дополнительные информацию об управлении политиками звонков с помощью PowerShell см. в теме [Set-CsTeamsCallingPolicy.](/powershell/module/skype/set-csteamscallingpolicy)

В следующем примере показано, как использовать [Grant-CsTeamsMeetingPolicy](/powershell/module/skype/grant-csteamsmeetingpolicy) для назначения пользователю политики собраний AllOn.

```PowerShell
Grant-CsTeamsMeetingPolicy -PolicyName AllOn -Identity "user email id"
```

Дополнительные информацию об управлении политиками собраний с помощью PowerShell см. в теме [Set-CsTeamsMeetingPolicy.](/powershell/module/skype/set-csteamsmeetingpolicy)

## <a name="control-fallback-mode-in-teams"></a>Управление режимом отката в Teams

При подключении пользователей с неподдерживания конечной точки пользователи находятся в режиме запасного времени, в котором av не оптимизирован. Вы можете отключить или включить режим отката, задав одно из следующих значений DWORD реестра:

- HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Teams\DisableFallback
- HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\Teams\DisableFallback

Чтобы отключить режим экономии, установите значение **1**. Чтобы включить только звук, установите значение **2**. Если значение не присутствует или установлено **значение 0 (ноль),** включен режим экономии времени.

Эта функция доступна в Teams версии 1.3.00.13565 и более поздних.

## <a name="disable-audio-and-video-settings-for-vdi"></a>Отключение параметров звука и видео для VDI

Teams Политики VDI доступны в модуле Microsoft Teams. Эти политики активны и применяются для не оптимизированных сред VDI.

- New-CsTeamsVdiPolicy  
- Grant-CsTeamsVdiPolicy
- Remove-CsTeamsVdiPolicy
- Set-CsTeamsVdiPolicy

> [!NOTE]
> Это только для не оптимизированных сред.

### <a name="update-a-module-name"></a>Обновление имени модуля

update-Module -Name MicrosoftTeams -AllowPrerelease

```PowerShell
<# Import and connect to online (CSOnline runs the policies) #>
Import-Module microsoftTeams
if( -not $sess){
    $session = New-CsOnlineSession
    $pss = Import-PSSession $session
}
<# Check out the commands #>
Get-Command -Noun *VDI*
<#
```

### <a name="set-policies-to-limit-calling-features"></a>Настройка политик для ограничения возможностей звонков

Когда пользователи с этим параметром политики VDI -DisableCallsAndMeetings $true для Teams в VDI, они не смогут:

- Звонить.
- Присоединяйтесь к собраниям.
- Вы можете поделиться своим экраном из чата.

Все типы звонков должны быть отключены.

> [!NOTE]
> Это только для не оптимизированных сред.

```PowerShell
#>
New-CsTeamsVdiPolicy -Identity DisableCallsAndMeetingsTrue -DisableCallsAndMeetings $true -DisableAudioVideoInCallsAndMeetings $false
<# Assign Policy #>
$user = 'meganb@jvteams.xyz'
Grant-CsTeamsVdiPolicy -Identity $user -PolicyName DisableCallsAndMeetingsTrue
<# wait for some time until the policy is applied #>
get-CSOnlineUser -identity $user | FL UserPrincipalName, *vdi*
<#
Show all Policies  
#>
Get-CsTeamsVdiPolicy | FT Iden*, Disable*
<#
```

Когда пользователи с параметром политики VDI -DisableAudioVideoInCallsAndMeetings $true войти в Teams VDI, они должны иметь возможность:

- Вы можете поделиться своим экраном из чата.
- Присоединяйтесь к собранию и делитесь экраном. Перемещение звука на телефон.
- Пользователи не должны иметь возможность лично звонить и видеозвонок из VDI.

> [!NOTE]
> Это только для не оптимизированных сред.

```powershell
#>
$PolName = "DisableCallsAndMeetingsAV"
New-CsTeamsVdiPolicy -Identity $PolName -DisableCallsAndMeetings $false -DisableAudioVideoInCallsAndMeetings $true
Grant-CsTeamsVdiPolicy -Identity $user -PolicyName $PolName
<# wait for some time until the policy is applied #>
get-CSOnlineUser -identity $user | FL UserPrincipalName, *vdi*
<# ## Cleanup afterwards #>
$cleanup = $false
if($cleanup){
    "Doing cleanup"
    # de-assign policy from user  
    Grant-CsTeamsVdiPolicy -Identity $user -PolicyName $null
    get-CSOnlineUser -identity $user | FL UserPrincipalName, *vdi*
    # remove Policies
    Get-CsTeamsVdiPolicy | ?{$_.identity -ne 'Global'} | remove-csTeamsVdiPolicy
}
```

## <a name="known-issues-and-limitations"></a>Известные проблемы и ограничения

### <a name="client-deployment-installation-and-setup"></a>Развертывание, установка и настройка клиента

- При установке на Teams VDI автоматически не обновляется так, как Teams VDI. Вам нужно обновить изображение VM, установив новый MSI-версию, как описано в разделе Установка или обновление Teams настольного приложения [на VDI.](#install-or-update-the-teams-desktop-app-on-vdi) Необходимо удалить текущую версию, чтобы обновиться до новой версии.
- В средах Citrix, если пользователь отключается от виртуальной машины во время Teams, Teams обновления могут привести к не оптимизированной работе пользователя для av при повторном подключении. Мы рекомендуем пользователям выйти из Teams перед отключением от виртуальной машины Citrix, чтобы избежать этого.
- Teams должны быть развернуты на каждого пользователя или на компьютере. Развертывание Teams для одного пользователя и каждого компьютера не поддерживается. Чтобы перейти с одного компьютера на одного пользователя в один из этих режимов, выполните процедуру удаление и перезагрузите данные в любой из них.
- В настоящее время виртуальный рабочий стол Azure не поддерживает клиенты macOS и Linux.
- Быстрый переключение клиента может привести к проблемам со звонками в VDI, например к недоступнию общего доступа к экрану. При перезапуске клиента эти проблемы устраняются.

### <a name="calling-and-meetings"></a>Вызовы и собрания

Не поддерживаются следующие функции звонков и собраний:

- Любые функции в нескольких окнах, такие как новые возможности собраний или все функции, которые функциональность поставляется с новыми возможностями собрания
- Улучшенные экстренные службы
- Кнопки HID и элементы управления со Teams и устройствами
- Размытие фона и эффекты
- Роли организатора трансляций и трансляций
- Location-Based маршрутии (LBR)
- Мелодия звонка по ОКП
- Звуковой/компьютерный звук в общей системе
- Обход сервера-посредника для прямой маршрутизации
- Парковка вызовов
- Управление масштабом

> [!NOTE]
> Мы работаем над добавлением функций звонков и собраний, которые в настоящее время доступны только в средах без VDI. К ним относятся дополнительные возможности контроля качества, дополнительные сценарии общего доступа к экрану и дополнительные функции, недавно добавленные в Teams. Чтобы получить дополнительные Teams возможности, обратитесь к представителю.

Ниже даны известные проблемы и ограничения для звонков и собраний.

- Возможность связи с Skype для бизнеса ограничена звукозаписью; модальность видео не существует.
- Разрешение входящих и исходяющих видеопотоков ограничено разрешением 720p.
- Поддерживается только один видеопоток с входящих камер или потоков передачи экрана. Когда отображается входящий экранный диктор, отображается эта часть экрана, а не видео выступающего.
- Teams не переключается на последнее звуковое устройство, выбранное пользователем, если устройство отключено, а затем повторно подключено.
- Трансляции не оптимизированы.
- Общий доступ к исходя выйти на экран:
    - Общий доступ к приложениям.
- Предо влияйте на себя и возьмите под контроль:
    - Не поддерживается во время сеанса совместного доступа к экрану или приложениям.
    - Поддерживается во время PowerPoint общего доступа.
- Ограничения только для Citrix
   - Высокое масштабирование DPI в CWA не поддерживается.

О Teams известных проблемах, не связанных с VDI, см. в Teams поддержки [организации.](/MicrosoftTeams/troubleshoot/teams-welcome)

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="troubleshoot-citrix-components"></a>Устранение неполадок с компонентами Citrix

#### <a name="teams-crashes-or-the-teams-sign-in-screen-is-blank"></a>Teams сбоя или Teams вход в пустую страницу

Это известная проблема с Citrix VDA версий 1906 и 1909. Чтобы обойти эту проблему, добавьте следующее значение DWORD реестра и задайте для него значение 204 (hexadecimal).

HKEY_LOCAL_MACHINE\SOFTWARE\Citrix\CtxHook\AppInit_Dlls\SfrHook\Teams.exe

Затем перезапустите VDA. Подробнее см. в статье поддержки Citrix Устранение неполадок с оптимизацией [HDX для](https://support.citrix.com/article/CTX253754)Teams.

## <a name="related-topics"></a>Статьи по теме

- [Установка Microsoft Teams с помощью MSI](msi-deployment.md)
- [Обзор PowerShell в Teams](teams-powershell-overview.md)
- [Использование Microsoft Teams на виртуальном рабочем столе Azure](/azure/virtual-desktop/teams-on-wvd)
