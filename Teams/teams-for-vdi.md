---
title: Teams для инфраструктуры виртуальных рабочих столов
author: LanaChin
ms.author: v-lanac
manager: serdars
ms.topic: article
ms.service: msteams
ms.reviewer: rafarhi, jmorrow
audience: admin
description: Сведения о том, как запускать Microsoft Teams в среде виртуализованной инфраструктуры для настольных компьютеров (VDI).
localization_priority: Normal
search.appverid: MET150
f1.keywords:
- NOCSH
ms.collection:
- M365-collaboration
appliesto:
- Microsoft Teams
ms.openlocfilehash: b0d7d20c9faa8dd214c73e1ea759d32c931c7442
ms.sourcegitcommit: 4f7870f0958a3c73bbf57ad4d4f6b228f8dead73
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/26/2020
ms.locfileid: "48286115"
---
# <a name="teams-for-virtualized-desktop-infrastructure"></a>Teams для инфраструктуры виртуальных рабочих столов

В этой статье описаны требования и ограничения для использования Microsoft Teams в виртуализованной среде.

## <a name="what-is-vdi"></a>Что такое VDI?

Инфраструктура виртуальных рабочих столов (VDI) — это технология виртуализации, в которой на центральном сервере в центре обработки данных размещены приложения для настольных систем и приложений. Это обеспечивает полное персонализированное взаимодействие с пользователями с полностью защищенным и совместимым централизованным источником.

Microsoft Teams в виртуализованной среде поддерживает чат и совместную работу. Кроме того, для платформ виртуальных рабочих столов Windows, Citrix и VMware также поддерживаются функции звонков и собраний.

Teams в виртуализованной среде поддерживает несколько конфигураций. К ним относятся VDI, выделенные, общие, сохраняемые и неустойчивые режимы. Функциональные возможности непрерывно разносятся и добавляются на регулярной основе, и функциональность будет расширяться в течение ближайших месяцев и лет.

Использование Teams в виртуализованной среде может немного отличаться от использования команд в невиртуализованной среде. Например, некоторые расширенные функции могут быть недоступны в виртуализованной среде, а разрешение экрана может отличаться.

Для обеспечения оптимального взаимодействия с пользователем следуйте рекомендациям, приведенным в этой статье.

 > [!Note]
> Дополнительные сведения о Teams VDI на разных платформах, можно найти в разделе [функции групп на платформе](https://support.microsoft.com/office/teams-features-by-platform-debe7ff4-7db4-4138-b7d0-fcc276f392d3).

## <a name="teams-on-vdi-components"></a>Teams в компонентах VDI

Для использования команд в виртуализованной среде требуются следующие компоненты:

- **Брокер виртуализации**: ресурс и диспетчер подключений для поставщика виртуализации, например Azure
- **Виртуальный рабочий стол**: стек виртуальной машины (ВМ), на котором запущены Microsoft Teams
- **Тонкий клиент**: конечная точка, с которой пользователь физически взаимодействует
- **Классическое приложение Teams**: классическое приложение для настольных компьютеров Teams

## <a name="teams-on-vdi-requirements"></a>Команды на соответствие требованиям VDI

### <a name="virtualization-provider-requirements"></a>Требования поставщика виртуализации

Классическое приложение Teams было проверено ведущими поставщиками решений для виртуализации. С несколькими поставщиками рынка мы рекомендуем вам обратиться к своему поставщику решений по виртуализации, чтобы убедиться, что вы отвечаете минимальным требованиям.
  
В настоящее время команды в VDI с оптимизацией аудио-и видеофайлов (AV) — сертифицированы с помощью виртуальных рабочих столов Windows, Citrix и VMware. Ознакомьтесь со сведениями, приведенными в этом разделе, чтобы убедиться, что вы отвечаете на все требования для правильной работы.

### <a name="platforms-certified-for-teams"></a>Платформы, сертифицированные для Teams

На следующих платформах есть решения инфраструктуры виртуальных рабочих столов для Teams.

|Платформа|Решения|
|----|---|
|![Эмблема, представляющая Майкрософт](media/microsoft-logo.png)| <a href="https://docs.microsoft.com/azure/virtual-desktop/teams-on-wvd" target="_blank">Виртуальный рабочий стол Windows</a> |
|![Эмблема, представляющая Citrix](media/citrix-logo.png)| <a href="https://www.citrix.com/products/citrix-virtual-apps-and-desktops/" target="_blank">Виртуальные приложения и настольные компьютеры Citrix</a> |
|![Эмблема, представляющая VMware](media/vmware-logo.png)| <a href="https://www.vmware.com/products/horizon.html" target="_blank">Горизонт VMware</a> |

### <a name="windows-virtual-desktop"></a>Виртуальный рабочий стол Windows

Виртуальный рабочий стол Windows обеспечивает оптимизацию антивирусных приложений для Teams в VDI. Дополнительные сведения и требования к установке можно найти [в статье Использование Teams в виртуальном рабочем столе Windows](https://docs.microsoft.com/azure/virtual-desktop/teams-on-wvd).

### <a name="citrix-virtual-apps-and-desktops-requirements"></a>Требования для виртуальных приложений и настольных компьютеров Citrix

Виртуальные приложения и настольные компьютеры Citrix (прежнее название — XenApp и XenDesktop) предоставляют оптимизацию антивирусных программ для Teams в VDI. С помощью виртуальных приложений и настольных компьютеров Citrix Teams в VDI поддерживают функции звонков и собраний, а также для общения и совместной работы.

Вы можете скачать самую последнюю версию Citrix виртуальных приложений и настольных систем на [сайте Citrix downloads](https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/). (Сначала необходимо выполнить вход). Необходимые компоненты загружаются в [приложение Citrix Workspace (CWA)](https://www.citrix.com/downloads/workspace-app/) и агент виртуальных доставок (VDA) по умолчанию. Вам не нужно устанавливать дополнительные компоненты или подключаемые модули на CWA или VDA.

Последние требования для серверов и клиентов можно найти на [веб-сайте Citrix](https://docs.citrix.com/en-us/citrix-virtual-apps-desktops/multimedia/opt-ms-teams.html).

### <a name="vmware-horizon-workspace-and-desktop-requirements"></a>Рабочие области горизонта VMware и требования к рабочему столу

Система VMware горизонт является современной платформой для безопасной доставки виртуальных рабочих столов и приложений в гибридном облаке. Для того чтобы обеспечить удобство работы конечных пользователей, в VMware предусмотрена оптимизация мультимедиа для Teams. Эта оптимизация улучшает общую производительность виртуальных рабочих столов и приложений и улучшает взаимодействие с пользователями при звонке и собрании с помощью Teams.

Последнюю версию VMware горизонта можно загрузить на странице [загрузки VMware](https://my.vmware.com/web/vmware/downloads/#all_products) . Необходимые компоненты оптимизации мультимедиа являются частью агента горизонта и клиента горизонта по умолчанию, поэтому нет необходимости устанавливать дополнительные модули, чтобы использовать функцию оптимизации для Teams.

Чтобы получить последние требования и инструкции по настройке оптимизации мультимедиа для Teams, посетите [веб-сайт VMware](https://docs.vmware.com/en/VMware-Horizon/2006/horizon-remote-desktop-features/GUID-F68FA7BB-B08F-4EFF-9BB1-1F9FC71F8214.html).

## <a name="install-or-update-the-teams-desktop-app-on-vdi"></a>Установка и обновление классического приложения Teams в VDI

Вы можете развернуть классическое приложение Teams для VDI с помощью установки на компьютере или установки для каждого пользователя с помощью пакета MSI. Выбор способа использования зависит от того, используете ли вы постоянную или непостоянную настройку, а также необходимость в функционировании соответствующей организации.

Для выделенной постоянной настройки можно использовать любой из подходов. Однако для эффективной настройки для неустойчивой установки Teams требуется установка на компьютере, чтобы работать эффективнее. Ознакомьтесь с разделом [Настройка не постоянной](#non-persistent-setup) .

При установке на компьютере автоматическое обновление отключено. Это означает, что чтобы обновить приложение Teams, необходимо удалить текущую версию, чтобы обновить ее до новой версии. При установке "на пользователя" включена функция автоматического обновления. Для большинства развертываний VDI рекомендуется развертывать группы с помощью установки на компьютере.

Чтобы выполнить обновление до последней версии Teams, начните с процедуры удаления, а затем нажмите последнюю версию Teams Deployment.

Для правильной работы оптимизации в средах VDI, конечная точка тонкого клиента должна иметь доступ к Интернету. Если доступ к Интернету недоступен в конечной точке клиента, оптимизация запуска не будет выполнена. Это означает, что пользователь находится в неоптимизированном состоянии мультимедиа.

#### <a name="dedicated-persistent-setup"></a>Выделенная постоянная Настройка

В выделенной постоянной настройке изменения локальной операционной системы пользователей сохраняются после выхода пользователя из системы. Для постоянной настройки Teams поддерживает установку на уровне пользователя и на компьютере.

Ниже приведена рекомендуемая минимальная конфигурация виртуальной машины.

|Параметр  |Операционная система рабочей станции  |Операционная система сервера  |
|---------|---------|---------|
|vCPU   |    2 ядра     |  4, 6 или 8<br>Важно понимать основную конфигурацию неоднородного доступа к памяти (NUMA) и настраивать виртуальные компьютеры соответствующим образом.     |
|ОЗУ     |   4 ГБ      | 512 – 1024 МБ на одного пользователя        |
|Хранилище    | 8 ГБ        | 40 – 60 ГБ        |

#### <a name="non-persistent-setup"></a>Настройка не постоянной

При непостоянной установке изменения локальной операционной системы пользователей не сохраняются после выхода пользователя из системы. Такие настройки обычно используются совместно с несколькими пользователями. Настройка виртуальных машин зависит от количества пользователей и ресурсов физических полей.

Для неустойчивой настройки классическое приложение Teams должно быть установлено на компьютере по эталонному изображению. (Дополнительные сведения можно найти в разделе [Установка или обновление классического приложения Teams в VDI](#install-or-update-the-teams-desktop-app-on-vdi) .) Это позволяет эффективно запускать приложение Teams во время сеанса пользователя.

Для эффективной синхронизации данных среды выполнения Teams с помощью Teams с непостоянной настройкой также требуется диспетчер кэширования профилей. Это гарантирует, что в сеансе пользователя будут кэшироваться соответствующие сведения о пользователе (например, данные пользователя, профиль и параметры). Убедитесь в том, что данные в этих двух папках синхронизированы.  

- C:\Users\username\AppData\Local\Microsoft\IdentityCache (%localAppdata%\Microsoft\IdentityCache)
- C:\Users\username\AppData\Roaming\Microsoft\Teams (%appdata%\Microsoft\Teams)

Доступно множество решений диспетчера кэширования. Например, [FSLogix](https://docs.microsoft.com/fslogix/overview). Подробные инструкции по настройке можно найти в поставщике диспетчера Caching.

##### <a name="teams-cached-content-exclusion-list-for-non-persistent-setup"></a>Список исключений из кэшированного содержимого Teams для неустойчивой настройки

Исключите из папки Caching teams:% AppData%/Microsoft/Teams. За исключением этих элементов, можно уменьшить размер кэширования пользователей для дальнейшей оптимизации несохраненной настройки.

- файлы. txt
- Папка "мультимедиа-стопка"
- meeting-addin\Cache (%appdata%\Microsoft\Teams\meeting-addin\Cache)

### <a name="microsoft-365-apps-for-enterprise-considerations"></a>Общие сведения о приложениях Microsoft 365 для предприятий

При развертывании Teams с помощью приложений Microsoft 365 для предприятий в VDI следует иметь в виду следующее.

#### <a name="new-deployments-of-teams-through-microsoft-365-apps-for-enterprise"></a>Новые развертывания Teams с помощью приложений Microsoft 365 для предприятий

Прежде чем развертывать команды с помощью приложений Microsoft 365 для предприятий, необходимо сначала удалить все уже существующие приложения Teams, если они были развернуты с помощью установки на компьютере.

Teams через приложения Microsoft 365 для предприятий устанавливаются для каждого пользователя. Дополнительные сведения можно найти в статье [Установка и обновление классического приложения Teams в VDI](#install-or-update-the-teams-desktop-app-on-vdi) .

#### <a name="teams-deployments-through-microsoft-365-apps-for-enterprise-updates"></a>Развертывание Teams в приложениях Microsoft 365 для корпоративных обновлений

Кроме того, Teams также добавляется к существующим установкам приложений Microsoft 365 для предприятий. Так как приложения Microsoft 365 для предприятий устанавливают команды только для пользователей, ознакомьтесь с разделом [Установка или обновление в классическом приложении Teams в VDI](#install-or-update-the-teams-desktop-app-on-vdi) .

#### <a name="using-teams-with-per-machine-installation-and-microsoft-365-apps-for-enterprise"></a>Использование Teams с установкой на компьютере и приложениями Microsoft 365 для предприятий

Приложения Microsoft 365 для предприятий не поддерживают установку на уровне компьютера для Teams. Для использования установки на компьютере необходимо исключить команды из приложений Microsoft 365 для предприятий. Ознакомьтесь с разделом [развертывание приложений Teams на виртуальной машине](#deploy-the-teams-desktop-app-to-the-vm) и [как исключить развертывание групп с помощью приложений Microsoft 365 для корпоративных](#how-to-exclude-teams-deployment-through-microsoft-365-apps-for-enterprise) разделов.

#### <a name="how-to-exclude-teams-deployment-through-microsoft-365-apps-for-enterprise"></a>Как исключить развертывание команд с помощью приложений Microsoft 365 для предприятий

Дополнительные сведения о Teams и приложениях Microsoft 365 для предприятий можно найти [в статье как исключить группы из новых установок приложений microsoft 365 для предприятий](https://docs.microsoft.com/DeployOffice/teams-install#how-to-exclude-microsoft-teams-from-new-installations-of-office-365-proplus) и [использовать групповую политику для управления установкой Teams](https://docs.microsoft.com/DeployOffice/teams-install#use-group-policy-to-control-the-installation-of-microsoft-teams).

### <a name="deploy-the-teams-desktop-app-to-the-vm"></a>Развертывание классического приложения Teams на виртуальной машине

1. Скачайте пакет MSI для Teams, соответствующий вашей операционной системе VDI, по одной из следующих ссылок:

    - [32-разрядная версия](https://statics.teams.cdn.office.net/production-windows/1.3.00.21759/Teams_windows.msi)
    - [64-разрядная версия](https://statics.teams.cdn.office.net/production-windows-x64/1.3.00.21759/Teams_windows_x64.msi)

    Минимальной версией классического приложения Teams, которая требуется, является версия 1.3.00.4461. (Удержание PSTN не поддерживается в более ранних версиях).

2. Установите MSI на виртуальной машине VDI, выполнив одну из следующих команд:

    - Установка на уровне пользователей (по умолчанию)
  
        ```console
        msiexec /i <path_to_msi> /l*v <install_logfile_name> ALLUSERS=1
        ```

        Этот процесс является установкой по умолчанию, в результате чего команды устанавливаются в папку пользователя% AppData%. На этом этапе завершается установка "золотого образа". Teams не работает должным образом с установкой отдельных пользователей на непостоянную настройку.

    - Установка на компьютере

        ```console
        msiexec /i <path_to_msi> /l*v <install_logfile_name> ALLUSER=1 ALLUSERS=1
        ```

        Эта процедура устанавливает команды в папку Program Files (x86) в 64-разрядной операционной системе и в папку Program Files в 32-разрядной операционной системе. На этом этапе завершается установка "золотого образа". Установка групп на компьютере необходима для неустойчивой настройки.

        Следующий интерактивный сеанс входа запускает Teams и запрашивает учетные данные.

        > [!NOTE]
        > В этих примерах также используется параметр **ALLUSERS = 1** . Если вы задаете этот параметр, программа установки на уровне компьютера будет отображаться в окне "программы и компоненты" на панели управления, а также в приложениях & функциях в параметрах Windows для всех пользователей компьютера. Все пользователи могут удалять команды, если у них есть учетные данные администратора.
        Важно понимать разницу между **ALLUSERS = 1** и **ALLUSER = 1**. Параметр **ALLUSERS = 1** можно использовать в средах без VDI и VDI, а параметр **ALLUSER = 1** используется только в средах VDI для задания установки на компьютере.

3. Удалите MSI из виртуальной машины VDI.
  
      ```console
      msiexec /passive /x <path_to_msi> /l*v <uninstall_logfile_name>
      ```

      Этот процесс удаляет команды из папки Program Files (x86) или Program Files (в зависимости от среды операционной системы).

## <a name="teams-on-vdi-performance-considerations"></a>Общие сведения о производительности в VDI

Существует множество виртуализированных конфигураций настройки, каждый из которых имеет другой фокус для оптимизации. Например, конфигурация может сосредоточиться на плотности пользователей. При планировании учитывайте следующие сведения, чтобы оптимизировать настройку в зависимости от потребностей Организации.

- Минимальные требования. для некоторых рабочих нагрузок может потребоваться настройка с использованием ресурсов, превышающих минимальные требования. Например, рабочие нагрузки для разработчиков, использующих приложения, которые требуют больше вычислительных ресурсов.
- Зависимости: они включают в себя зависимости от инфраструктуры, рабочей нагрузки и другие аспекты среды, находящиеся за пределами классического приложения Teams.
- Отключенные функции в VDI: teams отключает функции, интенсивно использующие GPU, для VDI, что может способствовать повышению временной нагрузки центрального процессора. Следующие функции отключены:
    - Анимация CSS для Teams
    - Автоматический запуск GIF

## <a name="teams-on-vdi-with-calling-and-meetings"></a>Teams в VDI с помощью звонков и собраний

Помимо общения и совместной работы, Teams в VDI с помощью звонков и собраний предоставляется с помощью поддерживаемых платформ провайдеров виртуализации. Поддерживаемые функции основываются на WebRTCе и реализации поставщика виртуализации мультимедиа. На приведенной ниже схеме представлен обзор архитектуры.

![Схема, на которой показаны группы на архитектуре VDI](media/teams-on-vdi-architecture.png)

> [!IMPORTANT]
> Если в настоящее время вы запускаете команды без оптимизации антивирусной программы VDI и используете функции, которые еще не поддерживаются для оптимизации (например, предоставление и управление при совместном доступе к приложениям), необходимо настроить политики поставщика виртуализации, чтобы отключить перенаправление групп. Это означает, что сеансы работы с файлами Teams не оптимизируются. Инструкции по настройке политик для отключения перенаправления групп можно получить в поставщике виртуализации.

### <a name="network-requirements"></a>Требования к сети

Мы рекомендуем оценить среду, чтобы определить риски и требования, которые могут повлиять на весь облачный голос и развертывание видео. Используйте [средство оценки Skype для бизнеса](https://www.microsoft.com/download/details.aspx?id=53885) , чтобы проверить, готова ли сеть для Teams.

Чтобы узнать больше о том, как подготовить сеть для Teams, ознакомьтесь со статьей [Подготовка сети организации для Teams](prepare-network.md).

### <a name="migrate-from-skype-for-business-on-vdi-to-teams-on-vdi"></a>Переход с Skype для бизнеса на VDI в Teams в VDI

Если вы выполняете миграцию из Skype для бизнеса на VDI в Teams в VDI, помимо различий между двумя приложениями, существует ряд отличий, которые также реализованы в VDI. Ниже перечислены некоторые возможности, которые в настоящее время не поддерживаются в VDI для бизнеса VDI.

- Управление опытом звонков в VDI с помощью политик для ограничения скорости воспроизведения мультимедиа
- Политика для отдельных платформ, позволяющая отключить некоторые функции антивирусной системы в VDI
- Предоставление и управление совместным доступом к приложениям
- Демонстрация экрана из чата без звука
- Одновременное использование видео и приема экрана

### <a name="teams-on-chrome-browser-versus-teams-desktop-app-for-vdi"></a>Teams в браузере Chrome и классическом приложении Teams для VDI

Teams в браузере Chrome не предоставляет замену для классического приложения Teams для VDI с оптимизацией вирусов. Работа в чате и совместной работе работают должным образом. Если требуется мультимедиа, в браузере Chrome есть некоторые возможности, которые могут не соответствовать ожиданиям пользователей.

- Потоковая передача звука и видео может быть неоптимальной. Пользователи могут столкнуться с задержкой или снижением качества.
- Параметры устройства недоступны в параметрах браузера.
- Управление устройствами осуществляется через браузер и требует нескольких параметров в параметрах сайта браузера.
- Для управления устройствами Windows также может потребоваться настройка параметров устройства.

## <a name="teams-on-vdi-with-chat-and-collaboration"></a>Участие в чате и совместной работе в VDI

Если в вашей организации требуется использовать только возможности общения и совместной работы в Teams, вы можете настроить политики на уровне пользователей, чтобы отключить функции звонков и собраний в Teams. 

### <a name="set-policies-to-turn-off-calling-and-meeting-functionality"></a>Настройка политик для отключения функций звонков и собраний

Политики можно настроить с помощью центра администрирования Microsoft Teams или PowerShell. Для распространения изменений политики может потребоваться некоторое время (несколько часов). Если вы сразу же не видите изменения для указанной учетной записи, повторите попытку через несколько часов.

[**Политики звонков**](teams-calling-policy.md): команды включают встроенную политику вызовов DisallowCalling, в которой все функции вызова отключены. Назначьте политику DisallowCalling для всех пользователей в вашей организации, которые используют команды в виртуализованной среде.

[**Политики собраний**](meeting-policies-in-teams.md): команды включают встроенную политику собраний AllOff, в которой отключены все функции собраний. Назначьте политику AllOff для всех пользователей в вашей организации, которые используют команды в виртуализованной среде.

#### <a name="assign-policies-using-the-microsoft-teams-admin-center"></a>Назначение политик с помощью центра администрирования Microsoft Teams

Чтобы назначить пользователю политику вызова DisallowCalling и политику собрания AllOff, выполните указанные ниже действия.

1. В левой области навигации центра администрирования Microsoft Teams перейдите к разделу **Пользователи**.
2. Выберите пользователя, щелкнув слева от его имени, затем нажмите кнопку **Изменить параметры**.
3. Выполните указанные ниже действия.
    1.  В разделе **Политика звонков**щелкните **DisallowCalling**.
    2.  В разделе **политика собраний**щелкните **AllOff**.
4. Нажмите кнопку **Применить**.

Чтобы назначить политику нескольким пользователям одновременно:

1. В левой области навигации Центра администрирования Microsoft Teams выберите **Пользователи** и найдите пользователей или отфильтруйте представление, чтобы отобразить нужных пользователей.
2. В столбце **&#x2713;** (галочка) выберите пользователей. Чтобы выбрать всех пользователей, щелкните &#x2713; (галочку) в верхней части таблицы.
3. Щелкните **Изменить настройки**, внесите нужные изменения и нажмите **Применить**.

Кроме того, вы можете сделать следующее:

1. В левой области навигации центра администрирования Microsoft Teams выберите политику, которую вы хотите назначить. Например:
    - Перейдите к разделу политики **голосовой связи**  >  **Calling policies**и нажмите кнопку **DisallowCalling**.
    - Перейдите в **раздел**  >  **политики собраний по собраниям**и нажмите кнопку **AllOff**.
2. Выберите **Управление пользователями**.
3. В области **Управление пользователями** выполните поиск по отображаемому имени или по имени пользователя, выберите имя и нажмите кнопку **Добавить**. Повторите это действие для каждого пользователя, которого нужно добавить.
4. Завершив добавление пользователей, нажмите кнопку **сохранить**.

#### <a name="assign-policies-using-powershell"></a>Назначение политик с помощью PowerShell

В следующем примере показано, как использовать [Grant-CsTeamsCallingPolicy](https://docs.microsoft.com/powershell/module/skype/grant-csteamscallingpolicy) для назначения пользователю политики вызова DisallowCalling.

```PowerShell
Grant-CsTeamsCallingPolicy -PolicyName DisallowCalling -Identity "user email id"
```

Чтобы узнать больше об использовании PowerShell для управления политиками вызовов, ознакомьтесь с статьей [Set-CsTeamsCallingPolicy](https://docs.microsoft.com/powershell/module/skype/set-csteamscallingpolicy).

В следующем примере показано, как с помощью [Grant-CsTeamsMeetingPolicy](https://docs.microsoft.com/powershell/module/skype/grant-csteamsmeetingpolicy) назначить пользователю политику собрания AllOff.

```PowerShell
Grant-CsTeamsMeetingPolicy -PolicyName AllOff -Identity "user email id"
```

Чтобы узнать больше об использовании PowerShell для управления политиками собраний, ознакомьтесь с статьей [Set-CsTeamsMeetingPolicy](https://docs.microsoft.com/powershell/module/skype/set-csteamsmeetingpolicy).

## <a name="migrate-teams-on-vdi-with-chat-and-collaboration-to-optimize-teams-with-calling-and-meetings"></a>Перенесите команды в VDI с помощью чата и совместной работы, чтобы оптимизировать группы с помощью звонков и собраний

Если у вас есть существующая реализация Teams в VDI с помощью чата и совместной работы, в которой вы настроили политики на уровне пользователей для отключения функций звонков и собраний, а затем вы выполняете миграцию в Teams с оптимизацией антивирусной программы, вы должны настроить политики для включения функций звонков и собраний для групп на пользователей VDI.

### <a name="set-policies-to-turn-on-calling-and-meeting-functionality"></a>Настройка политик для включения функции звонков и собраний

Вы можете использовать центр администрирования Microsoft Teams или PowerShell для настройки и назначения политик звонков и собраний для пользователей. Для распространения изменений политики может потребоваться некоторое время (несколько часов). Если вы сразу же не видите изменения для указанной учетной записи, повторите попытку через несколько часов.

Управление [**звонками**](teams-calling-policy.md): политики вызовов в Teams управляют тем, какие функции вызова доступны пользователям. Команды включают встроенную политику вызовов AllowCalling, в которой включены все функции вызова. Чтобы включить все функции вызова, назначьте политику AllowCalling. Вы также можете создать собственную политику вызова, чтобы включить необходимые функции вызова и назначить ее пользователям. 

[**Политики для собраний**](meeting-policies-in-teams.md): политики собраний в Teams управляют типами собраний, которые пользователи могут создавать, и доступными в них функциям для участников, запланированных пользователями в Организации. Команды включают встроенную политику собраний AllOn, в которой включены все функции собраний. Чтобы включить все функции собрания, назначьте политику AllOn. Вы также можете создать собственную политику собраний, чтобы включить необходимые функции собрания и назначить их пользователям.

#### <a name="assign-policies-using-the-microsoft-teams-admin-center"></a>Назначение политик с помощью центра администрирования Microsoft Teams

Чтобы назначить пользователю политику вызова AllowCalling и политику собрания AllOn, выполните указанные ниже действия.

1. В левой области навигации центра администрирования Microsoft Teams перейдите к разделу **Пользователи**.
2. Выберите пользователя, щелкнув слева от его имени, затем нажмите кнопку **Изменить параметры**.
3. Выполните указанные ниже действия.
    1.  В разделе **Политика звонков**щелкните **AllowCalling**.
    2.  В разделе **политика собраний**щелкните **AllOn**.
4. Нажмите кнопку **Применить**.

Чтобы назначить политику нескольким пользователям одновременно:

1. В левой области навигации Центра администрирования Microsoft Teams выберите **Пользователи** и найдите пользователей или отфильтруйте представление, чтобы отобразить нужных пользователей.
2. В столбце **&#x2713;** (галочка) выберите пользователей. Чтобы выбрать всех пользователей, щелкните **&#x2713;** (галочка) в верхней части таблицы.
3. Щелкните **Изменить настройки**, внесите нужные изменения и нажмите **Применить**.

Кроме того, вы можете сделать следующее:

1. В левой области навигации центра администрирования Microsoft Teams выберите политику, которую вы хотите назначить. Например:
    - Перейдите к разделу политики **голосовой связи**  >  **Calling policies**и нажмите кнопку **AllowCalling**.
    - Перейдите в **раздел**  >  **политики собраний по собраниям**и нажмите кнопку **AllOn**.
2. Выберите **Управление пользователями**.
3. В области **Управление пользователями** выполните поиск по отображаемому имени или по имени пользователя, выберите имя и нажмите кнопку **Добавить**. Повторите это действие для каждого пользователя, которого нужно добавить.
4. Завершив добавление пользователей, нажмите кнопку **сохранить**.

#### <a name="assign-policies-using-powershell"></a>Назначение политик с помощью PowerShell

В следующем примере показано, как использовать [Grant-CsTeamsCallingPolicy](https://docs.microsoft.com/powershell/module/skype/grant-csteamscallingpolicy) для назначения пользователю политики вызова AllowCalling.

```PowerShell
Grant-CsTeamsCallingPolicy -PolicyName AllowCalling -Identity "user email id"
```

Чтобы узнать больше об использовании PowerShell для управления политиками вызовов, ознакомьтесь с статьей [Set-CsTeamsCallingPolicy](https://docs.microsoft.com/powershell/module/skype/set-csteamscallingpolicy).

В следующем примере показано, как с помощью [Grant-CsTeamsMeetingPolicy](https://docs.microsoft.com/powershell/module/skype/grant-csteamsmeetingpolicy) назначить пользователю политику собрания AllOn.

```PowerShell
Grant-CsTeamsMeetingPolicy -PolicyName AllOn -Identity "user email id"
```

Чтобы узнать больше об использовании PowerShell для управления политиками собраний, ознакомьтесь с статьей [Set-CsTeamsMeetingPolicy](https://docs.microsoft.com/powershell/module/skype/set-csteamsmeetingpolicy).

## <a name="control-fallback-mode-in-teams"></a>Режим резервного управления в Teams

Когда пользователи подключаются из неподдерживаемой конечной точки, пользователи находятся в резервном режиме, в котором не оптимизирован AV. Вы можете включить или отключить резервный режим, задавая один из следующих значений реестра DWORD:

- HKEY_LOCAL_MACHINE \SOFTWARE\Microsoft\Teams\DisableFallback
- HKEY_CURRENT_USER \SOFTWARE\Microsoft\Office\Teams\DisableFallback

Чтобы отключить резервный режим, установите для него значение **1**. Чтобы включить только звук, установите для него значение **2**. Если значение не представлено или равно **0** (нулю), резервный режим включен.

Эта функция доступна в Teams версии 1.3.00.13565 и более поздних версий.

## <a name="known-issues-and-limitations"></a>Известные проблемы и ограничения

### <a name="client-deployment-installation-and-setup"></a>Развертывание, установка и Настройка клиента

- При установке на компьютере команды в VDI не обновляются автоматически в соответствии с клиентами групп, не связанных с VDI. Вы должны обновить образ виртуальной машины установкой нового MSI-файла, как описано в разделе [Установка или обновление в классическом приложении Teams в VDI](#install-or-update-the-teams-desktop-app-on-vdi) . Вы должны удалить текущую версию, чтобы обновить ее до новой версии.
- Команды должны развертываться для каждого пользователя или для каждого компьютера. Развертывание Teams для одновременных пользователей и для каждого компьютера не поддерживается. Чтобы выполнить миграцию с одного компьютера на другой или отдельно для каждого пользователя в один из этих режимов, следуйте инструкциям по удалению и повторному развертыванию в обоих режимах.
- В настоящее время виртуальные столы и VMware для Windows не поддерживают MacOS и клиенты на базе Linux.
- В настоящее время клиенты Citrix не поддерживают MacOs.
- Citrix не поддерживает использование явных прокси-серверов HTTP, определенных в конечной точке.

### <a name="calling-and-meetings"></a>Звонки и собрания

Следующие функции звонков и собраний не поддерживаются:

- Улучшенные службы экстренной помощи
- Кнопки HID и элементы управления ИНДИКАТОРами между приложением Teams и устройствами
- Размытие и эффекты фона
- Широковещательные и живые роли для событий и выступающих
- Маршрутизация на основе местоположения (LBR)
- Парковка вызовов
- Очередь звонков
- Звуковой и компьютерный звук в общей системе
- Обход сервера-посредника для прямой маршрутизации

> [!NOTE]
> Мы работаем над добавлением функций звонков и собраний, которые в настоящее время доступны только в средах, не поддерживающих VDI. Это может включать большее управление качеством, дополнительные сценарии отображения экрана и расширенные функции, добавленные в Teams недавно. Чтобы узнать больше о предстоящих функциях, свяжитесь с представителем Teams.

Ниже описаны известные проблемы, а также ограничения для звонков и собраний.

- Взаимодействие с Skype для бизнеса ограничено использованием голосовых вызовов. Модальность видео отсутствует.
- Для собраний и групповых звонков поддерживается только один входящий поток видео. При отправке видео нескольким людям в каждый момент времени отображается только видео главного динамика.
- Разрешение входящего и исходящего видеопотока ограничено разрешением 720p. Это WebRTC ограничение.
- Поддерживается только один видеопоток из входящей камеры или потока общего доступа к экрану. Если на экране есть демонстрация экрана для входящей почты, вместо видеоролика главного динамика отображается экранная демонстрация.
- Исходящее демонстрация экрана:
    - Общий доступ к приложениям.
- Предоставление управления и управление:
    - Не поддерживается во время демонстрации экрана или сеанса совместного использования приложений.
    - Поддерживается в сеансе совместного использования PowerPoint.
- Ограничения Citrix-only
    - Взаимодействие с несколькими сигналами многочастотной связи с телефонными системами в настоящее время не поддерживается.
    - Если в настройке с несколькими мониторами вы предоставляете общий доступ к экрану, для него предоставляется доступ только к главному монитору.
    - Масштабирование с высоким разрешением в CWA не поддерживается.

Известные проблемы, которые не относятся к VDI, можно найти [в разделе Поддержка Teams в Организации](Known-issues.md).

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="troubleshoot-citrix-components"></a>Устранение неполадок в компонентах Citrix

#### <a name="teams-crashes-or-the-teams-sign-in-screen-is-blank"></a>Teams аварийно завершает работу, или экран входа в Teams пуст

Это известная проблема, связанная с Citrix VDA версиями 1906 и 1909. Чтобы устранить эту ошибку, добавьте следующий параметр реестра DWORD и установите для него значение 204 (шестнадцатеричное).

HKEY_LOCAL_MACHINE\SOFTWARE\Citrix\CtxHook\AppInit_Dlls\SfrHook\Teams.exe

Затем перезапустите VDA. Дополнительные сведения об этом можно найти в статье Служба поддержки Citrix и [Устранение неполадок оптимизации HDX для Teams](https://support.citrix.com/article/CTX253754).

## <a name="related-topics"></a>Связанные статьи

- [Установка Microsoft Teams с помощью MSI](msi-deployment.md)
- [Обзор PowerShell в Teams](teams-powershell-overview.md)
- [Использование Microsoft Teams на виртуальном рабочем столе Windows](https://docs.microsoft.com/azure/virtual-desktop/teams-on-wvd)
