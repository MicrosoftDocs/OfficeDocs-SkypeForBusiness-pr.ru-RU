---
title: Управление внешним доступом (федерация)
ms.author: mikeplum
author: MikePlumleyMSFT
manager: serdars
ms.topic: article
ms.service: msteams
audience: admin
ms.collection:
- Teams_ITAdmin_GuestAccess
- M365-collaboration
- m365initiative-externalcollab
ms.reviewer: vinbel
search.appverid: MET150
f1.keywords:
- CSH
ms.custom:
- ms.teamsadmincenter.externalaccess.overview
- seo-marvel-mar2020
description: Ваш администратор Teams или ИТ-администратор может настроить внешний доступ для других доменов (федеративный), чтобы позволить пользователям из этих доменов находить ваших пользователей, звонить им, общаться с ними в чате и настраивать собрания с их участием.
appliesto:
- Microsoft Teams
ms.localizationpriority: high
ms.openlocfilehash: ae0eb1b15c44dc85a82a87dfd92786c16c65cfc4
ms.sourcegitcommit: 109be23768ae183e07a0833fa9a9e5cb0369cb43
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2022
ms.locfileid: "63368394"
---
# <a name="manage-external-access-in-microsoft-teams"></a>Управление внешним доступом в Microsoft Teams

Внешний доступ — это способ, с помощью которого пользователи Teams, не входящие в вашу организацию, могут находить вас, звонить вам, общаться с вами в чате и настраивать собрания с вашим участием в Teams. Вы также можете использовать внешний доступ для общения с пользователями из других организаций, по-прежнему использующих Skype для бизнеса (в сети или в локальной среде) и Skype.

Если вы хотите, чтобы у пользователей из других организаций был доступ к вашим командам и каналам, используйте вместо этого гостевой доступ. Дополнительные сведения о различиях между внешним доступом и гостевым доступом см. В разделе [Сравнение внешнего и гостевого доступа](communicate-with-users-from-other-organizations.md#compare-external-and-guest-access). 

Использовать внешний доступ, когда:
  
- У вас есть пользователи во внешних доменах, которым нужно общаться в чатах. Например, Rob@contoso.com и Ann@northwindtraders.com работают над проектом вместе с некоторыми другими пользователями в доменах contoso.com и northwindtraders.com.

- Вы хотите, чтобы сотрудники вашей организации использовали Teams для связи с сотрудниками из других организаций.

- Вы хотите, чтобы любой пользователь Teams по всему миру мог вас найти и с вами связаться по адресу электронной почты. 

## <a name="plan-for-external-access"></a>План внешнего доступа

Политики внешнего доступа включают элементы управления для каждого типа федерации как на уровне организации, так и на уровне пользователей. Отключение политики на уровне организации отключит ее для всех пользователей независимо от параметров на уровне пользователя. Все параметры внешнего доступа включены по умолчанию.

Центр администрирования Teams управляет внешним доступом на уровне организации. Если вы хотите управлять внешним доступом на уровне пользователя, необходимо использовать PowerShell. Дополнительные сведения см. в разделе [Использование PowerShel](#using-powershell) ниже.

> [!NOTE]
> Если в вашей организации выключен внешний доступ, пользователи за пределами организации по-прежнему смогут присоединяться к собраниям анонимно. Дополнительные сведения см. в статье [Управление параметрами собраний в Teams](meeting-settings-in-teams.md).

> [!NOTE]
> Пользователи Teams могут добавлять приложения, когда они проводят собрания или чаты с пользователями из других организаций. Они также могут использовать приложения, предоставленные пользователями из других организаций, когда они присоединяются к собраниям или чатам, проводимым в этих организациях. Применяются политики данных организации пользователя узла, а также методы совместного использования данных сторонних приложений, предоставленных организацией этого пользователя.

## <a name="allow-or-block-domains"></a>Разрешите или заблокируйте домены

Если вы добавите заблокированные домены, все остальные домены будут разрешены; и если вы добавите разрешенные домены, все остальные домены будут заблокированы. Для этого правила действует исключение, если на собраниях разрешены анонимные участники. Существует четыре сценария настройки внешнего доступа в Центре администрирования Teams (**Пользователи** > **Внешний доступ**):

- **Разрешить все внешние домены**. Это настройка, заданная в Teams по умолчанию, которая позволяет сотрудникам вашей организации находить пользователей, внешних для вашей организации, в любом домене, звонить им, общаться с ними в чате и настраивать собрания с их участием.

    При этом сценарии ваши пользователи могут общаться со всеми внешними доменами, в которых работает Teams или Skype для бизнеса, если другой клиент тоже поддерживает внешнюю связь.
    
- **Разрешить только определенные домены**. Добавляя домены в список **разрешений**, вы ограничиваете внешний доступ только разрешенными доменами. После настройки списка разрешенных доменов все остальные домены будут заблокированы. 

- **Блокировать определенные домены** - добавляя домены в **список блокированных**, вы можете общаться со всеми внешними доменами, *кроме* заблокированных.  После настройки списка заблокированных доменов все остальные домены будут разрешены.

- **Блокировать все внешние домены**. Запрещает сотрудникам вашей организации находить пользователей, внешних для вашей организации, в любом домене, звонить им, общаться с ними в чате и настраивать собрания с их участием.

> [!NOTE]
> Разрешенные и заблокированные домены применяются к собраниям лишь в случае, если анонимный доступ к собраниям отключен.

![Снимок экрана: параметры внешних доменов](./media/external-access-domain-settings.png)

**С помощью Центра администрирования Microsoft Teams**

Разрешение определенных доменов

1. В Центре администрирования Teams перейдите в раздел **Пользователи** > **Внешний доступ**.

2. В разделе **Выберите домены, к которым имеют доступ ваши пользователи**, выберите **Разрешить только определенные внешние домены**.

3. Нажмите **Разрешить домены**.

4. В поле **Домен** введите домен, который вы хотите разрешить, и щелкните **Готово.**

5. Если вы хотите разрешить еще один домен, щелкните **Добавить домен**.

6. Нажмите кнопку **Сохранить**.

Блокировка определенных доменов

1. В Центре администрирования Teams перейдите в раздел **Пользователи** > **Внешний доступ**.

2. В разделе **Выберите домены, к которым имеют доступ ваши пользователи**, выберите **Заблокировать только определенные внешние домены**.

3. Нажмите **Заблокировать домены**.

4. В поле **Домен** введите домен, который вы хотите разрешить, и щелкните **Готово.**

5. Если вы хотите заблокировать еще один домен, щелкните **Добавить домен**.

6. Нажмите кнопку **Сохранить**.

Для связи с другим клиентом необходимо включить **Разрешить все внешние домены** или добавить свой клиент в список разрешенных доменов, выполнив действия, описанные выше.  

## <a name="manage-contact-with-external-teams-users-not-managed-by-an-organization"></a>Управление контактами с внешними пользователями Teams, не управляемыми организацией

Администраторы могут включить или отключить связь с внешними пользователями Teams, которые не управляются организацией ("неуправляемые"). Если этот параметр включен, администраторы также смогут управлять возможностью неуправляемых учетных записей Teams связываться с пользователями (см. следующий рисунок). Если параметр **Внешние пользователи с учетными записями Teams, не управляемыми организацией, могут связываться с пользователями в моей организации** отключен, неуправляемые пользователи Teams не смогут искать полные адреса электронной почты для поиска контактов организации, а все общение с неуправляемыми пользователями Teams может быть инициировано только пользователями в организации.

В Центре администрирования Teams перейдите в раздел **Пользователи** > **Внешний доступ**.

![Снимок экрана: параметры внешних учетных записей](./media/external-access-accounts-not-managed-by-org.png)

Чтобы заблокировать для пользователей Teams в своей организации возможность связываться с внешними пользователями Teams, чьи учетные записи не управляются организацией, сделайте следующее.
1. Отключите параметр **Пользователи в моей организации могут общаться с пользователями Teams, учетные записи которых не управляются организацией**.
2. Снимите флажок **Внешние пользователи с учетными записями Teams, не управляемыми организацией, могут связываться с пользователями в моей организации**.

Чтобы разблокировать для пользователей Teams в своей организации возможность связываться с внешними пользователями Teams, чьи учетные записи не управляются организацией, если связь инициировали ваши пользователи Teams, сделайте следующее.
1. Включите параметр **Пользователи в моей организации могут общаться с пользователями Teams, учетные записи которых не управляются организацией**.
2. Снимите флажок **Внешние пользователи с учетными записями Teams, не управляемыми организацией, могут связываться с пользователями в моей организации**.

Чтобы разблокировать для пользователей Teams в своей организации возможность связываться с внешними пользователями Teams, чьи учетные записи не управляются организацией, и получать запросы на связь от этих внешних пользователей Teams, сделайте следующее.
1. Включите параметр **Пользователи в моей организации могут общаться с пользователями Teams, учетные записи которых не управляются организацией**.
2. Установите флажок **Внешние пользователи с учетными записями Teams, не управляемыми организацией, могут связываться с пользователями в моей организации**.

## <a name="communicate-with-skype-users"></a>Общение с пользователями Skype

Выполните следующие действия, чтобы пользователи Teams в вашей организации общались и общались с пользователями Skype. Пользователи Teams  могут затем искать и начинать индивидуальную текстовую беседу или аудио- / видео вызов с пользователями Skype и наоборот.

![Снимок экрана: параметр пользователей Skype.](./media/external-access-skype-settings.png)

**С помощью Центра администрирования Microsoft Teams**

1. В области навигации слева выберите **Пользователи** > **Внешний доступ**.

2. Включите параметр **Разрешить пользователям в моей организации общаться с пользователями Skype**.

Чтобы узнать больше о способах взаимодействия пользователей Команд и пользователей Skype, в том числе о применяемых ограничениях, см. [Совместимость Teams и Skype](teams-skype-interop.md).

## <a name="using-powershell"></a>С помощью PowerShell

Параметры уровня организации можно настроить с помощью [Set-CSTenantFederationConfiguration](/powershell/module/skype/set-cstenantfederationconfiguration), а параметры уровня пользователей можно настроить с помощью [Set-CsExternalAccessPolicy](/powershell/module/skype/set-csexternalaccesspolicy).

В следующей таблице показаны параметры командлетов, используемые для настройки федерации.

|Конфигурация|Уровень организации (Set-CSTenantFederationConfiguration)|Уровень пользователя (Set-CsExternalAccessPolicy)|
|:-------|:--------|:------------------|
|Включение и отключение федерации с другими организациями Teams и Skype для бизнеса|`-AllowFederatedUsers`|`-EnableFederationAccess`|
|Включение федерации с определенными доменами|`-AllowedDomains`|Н/Д|
|Отключение федерации с определенными доменами|`-Blocked Domains`|Н/Д|
|Включение и отключение федерации с пользователями Teams, которые не управляются организацией|`-AllowTeamsConsumer`|`-EnableTeamsConsumerAccess`|
|Включение и отключение для пользователей Teams, которые не управляются организацией, возможности начинать беседы|`-AllowTeamsConsumerInbound`|`-EnableTeamsConsumerInbound`|
|Включение или отключение федерации со Skype|`-AllowPublicUsers`|`-EnablePublicCloudAccess`|

Важно отметить, что отключение политики "наследуется" от клиента к пользователям. Например:

```PowerShell
Set-CsTenantFederationConfiguration -AllowFederatedUsers $false
Set-CsExternalAccessPolicy -EnableFederationAccess $true
```

В этом примере политика на уровне пользователей включена, однако пользователи не смогут общаться с управляемыми пользователями Teams или пользователями Skype для бизнеса, так как этот тип федерации был отключен на уровне организации. Таким образом, если вы хотите включить эти элементы управления для подмножества пользователей, необходимо включить элемент управления на уровне организации и создать две групповые политики — одну для пользователей с выключенным элементом управления и одну для пользователей с включенным элементом управления.

## <a name="limit-external-access-to-specific-people"></a>Внешний доступ только для определенных людей

Если вы включили любые элементы управления внешним доступом на уровне организации, вы можете ограничить внешний доступ определенным пользователям с помощью PowerShell.

Можно использовать следующий пример сценария, заменив *Control* на нужный элемент управления, *PolicyName* на имя, которое вы хотите присвоить политике, и *UserName* на каждого пользователя, для которого необходимо включить или отключить внешний доступ.

Перед запуском скрипта убедитесь, что установлен [Модуль PowerShell в Microsoft Teams](/microsoftteams/teams-powershell-install).

```PowerShell
Connect-MicrosoftTeams

# Disable external access globally
Set-CsExternalAccessPolicy -<Control> $false

# Create a new external access policy
New-CsExternalAccessPolicy -Identity <PolicyName> -<Control> $true

# Assign users to the policy
$users_ids = @("<UserName1>", "<UserName2>")
New-CsBatchPolicyAssignmentOperation -PolicyType ExternalAccessPolicy -PolicyName "<PolicyName>" -Identity $users_ids

```

Например, включите связь с внешними пользователями Teams, не управляемыми организацией:

```PowerShell
Connect-MicrosoftTeams

Set-CsExternalAccessPolicy -EnableTeamsConsumerAccess $false

New-CsExternalAccessPolicy -Identity ContosoExternalAccess -EnableTeamsConsumerAccess $true

$users_ids = @("MeganB@contoso.com", "AlexW@contoso.com")
New-CsBatchPolicyAssignmentOperation -PolicyType ExternalAccessPolicy -PolicyName "ContosoExternalAccess" -Identity $users_ids

```

Чтобы ознакомиться с дополнительными примерами компиляции списка пользователей, см. [New-CsBatchPolicyAssignmentOperation](/powershell/module/teams/new-csbatchpolicyassignmentoperation).

Новую политику можно просмотреть, запустив `Get-CsExternalAccessPolicy`.

См. также [New-CsExternalAccessPolicy](/powershell/module/skype/new-csexternalaccesspolicy) и [Set-CsExternalAccessPolicy](/powershell/module/skype/set-csexternalaccesspolicy).

## <a name="common-external-access-scenarios"></a>Общие сценарии внешнего доступа

В следующих сценариях описано включение федерации для распространенных сценариев внешнего доступа, а также использование TeamsUpgradePolicy для управления доставкой входящих чатов и звонков.

### <a name="enable-federation-between-users-in-your-organization-and-other-organizations"></a>Включите федерацию между пользователями вашей организации и другими организациями

Чтобы пользователи вашей организации могли общаться с пользователями другой организации, в обеих организациях должна быть включена федерация. Действия для включения федерации зависят от того, как устроена ваша организация: полностью сетевая, гибридная или полностью локальная.

| Если ваша организация | Выполните следующие действия для включения федерации |
|:---------|:-----------------------|
|Сетевая без Skype для бизнеса в локальной среде. К этому типу относятся организации, в которых есть пользователи с режимом TeamsOnly и/или пользователи Skype для бизнеса Online.| Если вы используете Центр администрирования Teams: <br>- Убедитесь, что домены, с которыми необходимо взаимодействовать, разрешены для внешнего доступа.<br><br>Если вы используете PowerShell:<br>- Убедитесь, что клиент включен для федерации: для `Get-CsTenantFederationConfiguration` должно отображаться значение `AllowFederatedUsers=true`. <br>- Убедитесь, что для параметра пользователя `CsExternalAccessPolicy` установлено эффективное значение `EnableFederationAccess=true`.<br>- Если вы не используете открытую федерацию, убедитесь, что целевой домен указан в списке `AllowedDomains` конфигурации `CsTenantFederationConfiguration`. |
|Только локальные| В инструментах локальной среды: <br>- Убедитесь, что федерация включена в `CsAccessEdgeConfiguration`.<br>- Убедитесь, что федерация для пользователя включена с помощью `ExternalAccessPolicy` (глобальная политика, политика сайта или политика, назначенная пользователю). <br> - Если вы не используете открытую федерацию, убедитесь, что целевой домен указан в списке `AllowedDomains`.|
|Гибридная, причем некоторые пользователи находятся в сети (в Skype для бизнеса или Teams), а некоторые пользователи — в локальной среде. | Выполните перечисленные выше действия для организаций в сети и в локальной среде. |

### <a name="delivery-of-incoming-chats-and-calls"></a>Доставка входящих чатов и звонков 

Входящие чаты и звонки из организации федерации будут направляться в клиент Teams или Skype для бизнеса пользователя в зависимости от режима получателя в TeamsUpgradePolicy.

| Задача | Действие |
|:---------|:-----------------------|
|Убедитесь, что входящие федеративные чаты и звонки поступают в клиент Teams пользователя|Настройте для пользователей режим TeamsOnly.
|Убедитесь, что входящие федеративные чаты и звонки поступают в клиент Skype для бизнеса пользователя|Настройте для пользователей любой режим, отличный от TeamsOnly.|

### <a name="enable-federation-between-users-in-your-organization-and-unmanaged-teams-users"></a>Включите федерацию между пользователями вашей организации и неуправляемыми пользователями Teams

Чтобы включить федерацию между пользователями вашей организации и неуправляемыми пользователями Teams, выполните следующие действия.

| Если ваша организация | Выполните следующие действия для включения федерации |
|:---------|:-----------------------|
|Сетевая без Skype для бизнеса в локальной среде. К этому типу относятся организации, в которых есть пользователи с режимом Teams Only и/или пользователи Skype для бизнеса Online.| Если вы используете Центр администрирования Teams:<br>- Убедитесь, что параметр **Пользователи в моей организации могут общаться с пользователями Teams, учетные записи которых не управляются организацией** в разделе **Внешний доступ** включен.<br>- Если вы хотите, чтобы неуправляемые учетные записи Teams инициировали чаты, проверьте поле **Внешние пользователи с учетными записями Teams, не управляемыми организацией, могут связываться с пользователями в моей организации**.<br><br>Если вы используете PowerShell:<br>- Убедитесь, что клиент включен для федерации: для `Get-CsTenantFederationConfiguration` должно отображаться значение `AllowTeamsConsumer=true`.<br>- Убедитесь, что для параметра пользователя `CsExternalAccessPolicy` установлено эффективное значение `EnableTeamsConsumerAccess=true`.<br>- Убедитесь, что в клиенте у неуправляемых пользователей включена возможность инициировать чаты: параметр `Get-CsTenantFederationConfiguration` должен показывать `AllowTeamsConsumerInbound=true`.<br>- Убедитесь, что для параметра пользователя `CsExternalAccessPolicy` установлено эффективное значение `EnableTeamsConsumerInbound=true`.|
|Только локальные| Чат с неуправляемыми пользователями Teams не поддерживается для только локальных организаций.|
|Гибридная, причем некоторые пользователи находятся в сети (в Skype для бизнеса или Teams), а некоторые пользователи — в локальной среде. | Выполните описанные выше действия для онлайн-организаций. Обратите внимание, что чат с неуправляемыми пользователями Teams не поддерживается для локальных пользователей.|

> [!IMPORTANT]
> Вам не нужно добавлять какие-либо **домены Teams** в качестве разрешенных доменов, чтобы дать возможность пользователям Teams общаться с неуправляемыми пользователями Teams за пределами вашей организации. Все **неуправляемые домены Teams** разрешены.

### <a name="enable-federation-between-users-in-your-organization-and-consumer-users-of-skype"></a>Включите федерацию между пользователями вашей организации и потребителями-пользователями Skype

Чтобы включить федерацию между пользователями вашей организации и потребителями-пользователями Skype, выполните следующие действия:

| Если ваша организация | Включите федерацию потребителей следующим образом |
|:---------|:-----------------------|
|Работа только в сети без Skype для бизнеса в локальной среде. К этому типу относятся организации, в которых есть пользователи с режимом TeamsOnly и/или пользователи Skype для бизнеса Online. | Если вы используете Центр администрирования Teams: <br>- Убедитесь, что в разделе "Внешний доступ" включен параметр **Разрешить пользователям в моей организации общаться с пользователями Skype**.<br><br>Если вы используете PowerShell: <br>- Убедитесь, что клиент включен для федерации: для `Get-CsTenantFederationConfiguration` должно отображаться значение `AllowPublicUsers=true`. <br> - Убедитесь, что для параметра пользователя `CsExternalAccessPolicy` установлено эффективное значение `EnablePublicCloudAccess=true`. |
|Только локальные| В инструментах локальной среды: <br> - Убедитесь, что решение Skype включено в качестве федеративного партнера. <br> - Убедитесь, что параметр `EnablePublicCloudAccess=true` включен для пользователя с помощью `ExternalAccessPolicy` (глобальная политика, политика сайта или политика, назначенная пользователю).|
| Гибридная, причем некоторые пользователи находятся в сети (в Skype для бизнеса или Teams), а некоторые пользователи — в локальной среде.| Выполните перечисленные выше действия для организаций в сети и в локальной среде.

> [!IMPORTANT]
> Вам не нужно добавлять какие-либо **домены Skype** в качестве разрешенных доменов, чтобы дать возможность пользователям Teams или Skype для бизнеса Online общаться с пользователями Skype внутри или за пределами вашей организации. Все **домены Skype** разрешены.

## <a name="federation-diagnostic-tool"></a>Средство диагностики федерации

Администратор может использовать следующее средство диагностики, чтобы проверить, может ли пользователь Teams общаться с федеративным пользователем Teams:

1. Выберите **Выполнить тесты** ниже, чтобы заполнить диагностику в Центре администрирования Microsoft 365. 

   > [!div class="nextstepaction"]
   > [Выполнить тесты: федерация Teams](https://aka.ms/TeamsFederationDiag)

2. В области запуска диагностики введите **Адрес протокола SIP сеанса** и **Доменное имя федеративного клиента**, а затем выберите **Выполнить тесты**.

3. По итогам тестов будут предоставлены оптимальные дальнейшие действия для устранения любых проблем конфигурации клиента или политики, которые препятствуют взаимодействию с федеративным пользователем.


## <a name="related-topics"></a>Статьи по теме

[Встроенный чат для внешних (федеративных) пользователей](native-chat-for-external-users.md)
