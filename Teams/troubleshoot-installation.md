---
title: Устранение неполадок при установке и обновлении Microsoft Teams в Windows
author: lanachin
ms.author: v-lanac
manager: serdars
ms.reviewer: lenatarhun
ms.topic: article
ms.service: msteams
audience: Admin
ms.collection:
- M365-collaboration
f1.keywords:
- NOCSH
appliesto:
- Microsoft Teams
localization_priority: Normal
search.appverid: MET150
description: Узнайте, как устранять проблемы с установкой и обновлением клиентского приложения Teams для настольных компьютеров в Windows.
ms.openlocfilehash: 7b8d4984a8ee40f9a013155ad28b682e000260ba
ms.sourcegitcommit: 90939ad992e65f840e4c2e7a6d18d821621319b4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "45086145"
---
# <a name="troubleshoot-microsoft-teams-installation-and-update-issues-on-windows"></a>Устранение неполадок при установке и обновлении Microsoft Teams в Windows

В этой статье приводятся рекомендации по диагностике и устранению неполадок при установке и обновлении клиентского приложения Teams, работающего в Windows.

## <a name="check-whether-teams-is-updated-successfully"></a>Проверьте, обновлен ли Teams успешно

Выполните следующие действия, чтобы проверить, успешно ли установлено обновление Teams.

1. В Teams выберите свою фотографию профиля, а затем щелкните **сведения** > **версия**.
2. В том же меню нажмите **Проверить наличие обновлений**.
3. Подождите, пока баннер в верхней части приложения не укажет на необходимость «обновления» Teams. Ссылка должна появиться примерно через минуту, поскольку этот процесс загружает новую версию Teams. Баннер также дает вам знать, если вы уже используете последнюю версию, в этом случае обновление не требуется.
4. Нажмите на ссылку обновления в баннере.
5. Дождитесь перезапуска Teams, а затем повторите шаг 1, чтобы проверить, обновлено ли приложение.

Если вы видите сообщение об ошибке или номер версии такой же, как на шаге 4, процесс обновления завершился неудачно.

## <a name="troubleshoot-installation-and-update-issues"></a>Устранение неполадок при установке и обновлении

### <a name="troubleshoot-installation-issues"></a>Устранение проблем с установкой

Когда Teams установлен, установщик Teams регистрирует последовательность событий в %LocalAppData%\SquirrelTemp\SquirrelSetup.log. Первое, что нужно искать - это сообщение об ошибке или стек вызовов в конце журнала. Обратите внимание, что стеки вызовов в начале журнала могут не означать, что существует проблема установки. Может быть проще сравнить ваш журнал с журналом успешной установки (даже на другой машине), чтобы увидеть, что ожидается.

Если SquirrelSetup.log не указывает причину или вам нужна дополнительная информация для устранения проблемы, см. раздел [Сбор и анализ журналов приложений и системы](#collect-and-analyze-application-and-system-logs).

### <a name="troubleshoot-update-issues"></a>Устранение неполадок при обновлении

Когда Teams успешно установлен, расположение журнала изменяется с %LocalAppData%\SquirrelTemp на %AppData%\Microsoft\Teams. В этом месте есть два файла журнала, представляющих интерес, SquirrelSetup.log и logs.txt.

- Файл SquirrelSetup.log в этом месте записывается с помощью Update.exe, который является исполняемым файлом, обслуживающим приложение Teams.
- Файл Logs.txt используется приложением Teams (в частности, Teams.exe) для записи важных событий приложения. Скорее всего, он будет содержать информацию об ошибках.

Эти файлы журнала содержат информацию, позволяющую установить личность (PII), поэтому они не отправляются в Microsoft.

Teams может автоматически запускать процесс обновления (в зависимости от политики), или пользователи могут вручную проверять наличие обновлений, перейдя к своей картинке профиля> **Проверить наличие обновлений**. Оба метода используют следующую последовательность событий.

1. **Проверьте наличие обновлений**. Teams делает веб-запрос и включают текущую версию приложения и информацию о кольце развертывания. Цель этого шага - получить ссылку для скачивания. Ошибка на этом этапе регистрируется в Logs.txt.
2. **Скачивание обновления**. Teams загружает обновление, используя ссылку для скачивания, полученную на шаге 1. Когда загрузка завершится, Teams вызывает Update.exe, чтобы выполнить загрузку. Ошибка загрузки также регистрируется в Logs.txt.
3. **Поставьте обновление.**. Загруженный контент проверяется и распаковывается в промежуточную папку %LocalAppData%\Microsoft\Teams\stage), которая выполняется Update.exe. Сбои на этом этапе регистрируются в SquirrelTemp.log.
4. **Установите обновление**. Есть несколько способов запуска Teams. Система автоматически запускает Teams, когда пользователь входит в систему, или вы можете запускать команды с помощью ярлыка. На этом этапе Update.exe проверяет наличие промежуточной папки, снова проверяет содержимое и выполняет операции с файлами, чтобы отключить приложение. Для старой папки приложения в %LocalAppData%\Microsoft\Teams\current создается резервная копия в %LocalAppData%\Microsoft\Teams\previous, а папка рабочей области переименовывается в «текущая». Сбои на этом этапе регистрируются в SquirrelTemp.log.

Если SquirrelTemp.log или Logs.txt не содержат достаточной информации для определения основной причины и вам требуется дополнительная информация для устранения проблемы, перейдите к разделу [Сбор и анализ журналов приложений и системы](#collect-and-analyze-application-and-system-logs).

## <a name="collect-and-analyze-application-and-system-logs"></a>Собирать и анализировать журналы приложений и системы

В этом разделе описывается, как собирать и анализировать журналы приложений и системы, чтобы получить более полную информацию для устранения проблемы. Для выполнения этих шагов вы будете использовать инструменты Sysinternals. Чтобы узнать больше, см. [Windows Sysinternals](https://docs.microsoft.com/sysinternals/).

### <a name="collect-logs"></a>Соберите журналы.

1. Загрузите [инструменты Sysinternals](https://download.sysinternals.com/files/SysinternalsSuite.zip).
2. Распакуйте zip-файл в папку %TEMP% на локальном диске.
3. Откройте командную строку с повышенными правами и выполните следующие действия:

    1. Выполните следующее, чтобы перейти в папку TEMP:

        ```console
        cd /d %TEMP%
        ```
    2. Скопируйте настройки и журналы приложений. Обратите внимание, что в зависимости от точки сбоя некоторые из этих журналов могут отсутствовать.

        ```console
        copy %LocalAppData%\SquirrelTemp\SquirrelSetup.log SquirrelSetup.log
        copy %AppData%\Microsoft\Teams\logs.txt logs.txt
        copy %LocalAppData%\Microsoft\Teams\SquirrelSetup.log SquirrelSetup_Teams.log
        ```
    3. Запустите следующее, чтобы захватить открытые ручки.

        ```console
        handle > handles.txt
        ```

    4. Запустите следующее, чтобы захватить открытые библиотеки DLL.

        ```console
        listdlls -v Teams > dlls.txt
        ```
    5. Запустите следующее, чтобы перехватить работающие драйверы.

        ```console
        driverquery /v > driverquery.txt
        ```

    6. Выполните следующее, чтобы получить списки контроля доступа (ACL) папки Teams.

        ```console 
        icacls %LOCALAPPDATA%\Microsoft\Teams /save icacls.txt /T
        ```

### <a name="analyze-logs-for-advanced-users"></a>Анализировать логи (для опытных пользователей)

Неудачное обновление может привести к непредсказуемому поведению приложения. Например, пользователи могут быть не в состоянии выйти из Teams, иметь устаревшую версию Teams или не могут запустить Teams. Если у вас возникла проблема во время обновления, первое место, чтобы найти причину, это SquirrelTemp.log. Ниже перечислены различные типы сбоев обновления, перечисленные от наиболее распространенных до наименее распространенных, и способы их анализа и устранения неполадок с использованием журналов.

#### <a name="unable-to-exit-teams"></a>Невозможно выйти из Teams

Поскольку Teams определяет, что им необходимо обновить себя до более новой версии, они загружают и запускают новое приложение, а затем ждут возможности перезагрузить себя в следующий раз, когда машина простаивает. Распространенной проблемой в этом процессе является случай, когда другой процесс или драйвер файловой системы блокирует процесс Teams.exe, что препятствует выходу Teams.exe. В результате приложение Teams не может быть заменено недавно загруженным и подготовленным приложением.

Советы по устранению неполадок

- Чтобы подтвердить, что это проблема, с которой вы столкнулись, закройте Teams (щелкните правой кнопкой мыши Teams на панели задач и выберите **Выйти**). Затем откройте диспетчер задач в Windows, чтобы увидеть, работает ли экземпляр Teams.  
- Если вы не на компьютере, на котором возникла эта проблема, проверьте файл SquirrelTemp.log, собранный с компьютера, на котором возникла эта проблема, и найдите запись «Программа: невозможно завершить процесс в журнале».
- Чтобы определить, что препятствует выходу Teams.exe, просмотрите журналы Dlls.txt и Handles.txt. Они рассказывают вам о процессах, которые препятствовали выходу Teams.
- Другим виновником, который может помешать выходу Teams, является драйвер фильтра файловой системы режима ядра. Используйте инструмент SysInternals, [ProcDump](https://docs.microsoft.com/sysinternals/downloads/procdump), чтобы собрать дамп процесса в режиме ядра, запустив ```procdump -mk <pid>```, где <pid> - это идентификатор процесса, полученный из диспетчера задач. Вы также можете проверить файл журнала Driverquery.txt, чтобы увидеть активные драйверы фильтров, которые могут мешать командам.
- Чтобы выйти из этого состояния, перезагрузите компьютер.

#### <a name="file-permissions"></a>Разрешения для файлов

Teams создает несколько подпапок и файлов в профиле пользователя на протяжении всего процесса установки и обновления. Поскольку приложение и средство обновления работают как пользователь без повышенных прав, разрешения на чтение и запись должны быть предоставлены в следующих папках:

|Folder  |Используется  |
|---------|---------|
|%LocalAppData%\SquirrelTemp     | Установщик Teams (например, Teams_Windows_x64.exe) на этапе установки        |
|%LocalAppData%\Microsoft\Teams  | Приложение для обновления Teams (Update.exe) для извлечения и установки пакета приложения во время процесса обновления        |
|%AppData%\Microsoft\Teams   |  Приложение Teams (Teams.exe) для сохранения настроек, состояний приложения и (предварительно подготовленного) загруженного пакета обновления       |

Если Teams отказало в доступе из-за невозможности записи в файл, это может помешать другому программному приложению или запись дескриптора безопасности может ограничить доступ для записи в папку.

Советы по устранению неполадок

- Ищите доказательства «отказано в доступе» в SquirrelTemp.log или Logs.txt. Проверьте эти файлы, чтобы увидеть, была ли попытка записи в файл, который не удался.
- Откройте Icacls.txt и найдите эффективную запись управления доступом (ACE), которая блокирует операции записи пользователем, который не является администратором. Как правило, это в одной из записей DACL. Для получения дополнительной информации см. [Документацию icacls](https://docs.microsoft.com/windows-server/administration/windows-commands/icacls).

#### <a name="file-corrupted"></a>Файл поврежден

В некоторых случаях программное обеспечение для шифрования может изменять файлы в папке %LocalAppData%\Microsoft\Teams, что может препятствовать запуску Teams. Это может произойти в любое время, даже если приложение не обновляется. К сожалению, когда файл поврежден, единственный способ восстановиться из этого состояния - удалить и переустановить Teams.

> [!NOTE]
> Если вы не можете определить основную причину проблемы с помощью любого из этих шагов, вы можете попробовать сеанс [Монитор процесса](https://docs.microsoft.com/sysinternals/downloads/procmon). Process Monitor - это инструмент Sysinternals, который записывает доступ к реестру и файловой системе.

## <a name="related-topics"></a>Статьи по теме

- [Получите клиенты для Teams](get-clients.md)
- [Обновления клиента Teams](teams-client-update.md)
- [Устранение неполадок Teams](https://docs.microsoft.com/MicrosoftTeams/troubleshoot/teams)