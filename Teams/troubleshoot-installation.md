---
title: Устранение проблем с установкой и обновлением Microsoft Teams в Windows
author: lanachin
ms.author: v-lanac
manager: serdars
ms.reviewer: lenatarhun
ms.topic: article
ms.service: msteams
audience: Admin
ms.collection:
- M365-collaboration
appliesto:
- Microsoft Teams
localization_priority: Normal
search.appverid: MET150
description: Сведения о том, как устранять проблемы с установкой и обновлением для клиентского приложения Teams для настольных систем в Windows.
ms.openlocfilehash: 812beb3471a1d4ee2cbc1e8e7f7b36b2a42e0e2d
ms.sourcegitcommit: 0dba0ad1f8f00415c6437cadabed0548ce3281b1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2019
ms.locfileid: "39920158"
---
# <a name="troubleshoot-microsoft-teams-installation-and-update-issues-on-windows"></a>Устранение проблем с установкой и обновлением Microsoft Teams в Windows

В этой статье приведены инструкции по диагностике и устранению проблем с установкой и обновлением для клиентского приложения Teams для настольных систем, работающего под управлением Windows.

## <a name="check-whether-teams-is-updated-successfully"></a>Проверьте, успешно ли обновлены Teams

Выполните указанные ниже действия, чтобы проверить, успешно ли установлено обновление Teams.

1. В Teams выберите свой аватар и щелкните **о** > **версии**.
2. В этом же меню выберите пункт **проверить наличие обновлений**.
3. Дождитесь появления баннера в верхней части окна приложения, чтобы указать, что требуется "Обновить" для Teams. После того как этот процесс загрузит новую версию Teams, должна быть показана примерно минутная ссылка. В заголовке также вы узнаете, что вы уже используете последнюю версию, и в этом случае обновление не требуется.
4. Щелкните ссылку Обновить в заголовке.
5. Дождитесь перезапуска Teams, а затем повторите шаг 1, чтобы проверить, обновлено ли приложение.

Если вы видите сообщение об ошибке или номер версии совпадает на этапе 4, процесс обновления завершился сбоем.

## <a name="troubleshoot-installation-and-update-issues"></a>Устранение проблем с установкой и обновлением

### <a name="troubleshoot-installation-issues"></a>Устранение проблем с установкой

После установки Teams установщик Teams заносит в журнал последовательность событий в%Локалаппдата%\скуиррелтемп\скуиррелсетуп.лог. Первое, что нужно найти, — это сообщение об ошибке или стек вызовов в конце журнала. Обратите внимание, что стеки вызовов в начале журнала могут не означать, что у вас есть неполадка с установкой. Чтобы узнать, что требуется, можно легко сравнить журнал с журналом из успешной установки (даже на другом компьютере).

Если Скуиррелсетуп. log не указывает на причины или вам нужны дополнительные сведения, ознакомьтесь с разрешениями [сбор и анализ журналов приложений и систем](#collect-and-analyze-application-and-system-logs).

### <a name="troubleshoot-update-issues"></a>Устранение проблем с обновлением

После успешной установки Teams расположение журнала переключается с%Локалаппдата%\скуиррелтемп на%Аппдата%\микрософт\теамс. В этом расположении есть два файла журнала: Скуиррелсетуп. log и Logs. txt.

- Файл Скуиррелсетуп. log в этом расположении пишется Update. exe, который является исполняемым файлом, который используется для обслуживания приложения Teams.
- Файл Logs. txt используется приложением Teams (в частности, Teams. exe) для записи значительных событий приложения. Возможно, он будет содержать сведения об ошибке.

Эти файлы журналов содержат личные данные (PII) и не отправляются в корпорацию Майкрософт.

Teams может автоматически запускать процесс обновления (в зависимости от политики), а пользователи могут вручную проверять наличие обновлений, отправив аватар на свой профиль > **проверить наличие обновлений**. Оба метода используют следующую последовательность событий.

1. **Проверка наличия обновлений**. Teams делает веб-запрос и включает в себя текущую версию приложения и сведения о его развернутом. Цель этого этапа — получить ссылку Загрузить. Сбой на этом этапе заносится в журнал Logs. txt.
2. **Скачать обновление**. Teams загружает обновление с помощью ссылки для скачивания, полученной на шаге 1. После завершения скачивания Teams вызывает Update. exe для поэтапной загрузки. Ошибка скачивания также заносится в журнал Logs. txt.
3. **Поэтапное обновление**. Загруженное содержимое будет проверено и распаковано в промежуточную папку,%Локалаппдата%\микрософт\теамс\стаже), которая выполняется приложением Update. exe. Отказы на этом этапе регистрируются в Скуиррелтемп. log.
4. **Установите обновление**. Существует несколько способов запуска Teams. Система автоматически запускает Teams, когда пользователь входит в систему, или вы можете запускать Teams с помощью ярлыка. На этом этапе программа Update. exe проверяет наличие промежуточной папки, повторно проверяет содержимое и выполняет файловые операции для отмены размещения приложения. Старая папка приложения в%Локалаппдата%\микрософт\теамс\куррент заархивирована в%Локалаппдата%\микрософт\теамс\превиаус, а папка Stage переименовывается на "Текущая". Отказы на этом этапе регистрируются в Скуиррелтемп. log.

Если Скуиррелтемп. log или Logs. txt не содержат достаточно сведений для определения причины, и вам понадобятся дополнительные сведения, чтобы устранить проблему, перейдите к разделу [сбор и анализ журналов приложений и систем](#collect-and-analyze-application-and-system-logs).

## <a name="collect-and-analyze-application-and-system-logs"></a>Сбор и анализ журналов приложений и систем

В этом разделе объясняется, как собрать и проанализировать журналы приложений и системы, чтобы получить более подробные сведения, чтобы устранить проблему. Для выполнения этих действий вы будете пользоваться средствами Sysinternals. Дополнительные сведения можно найти в статье [Windows Sysinternals](https://docs.microsoft.com/sysinternals/).

### <a name="collect-logs"></a>Сбор журналов

1. Скачайте [инструменты Sysinternals](https://download.sysinternals.com/files/SysinternalsSuite.zip).
2. Извлеките ZIP-файл в папку% TEMP% на локальном диске.
3. Откройте командную команду с повышенными привилегиями, а затем выполните указанные ниже действия.

    1. Чтобы перейти в ВРЕМЕНную папку, выполните указанные ниже действия.

        ```
        cd /d %TEMP%
        ```
    2. Скопируйте журналы настройки и приложений. Обратите внимание, что в зависимости от точки сбоя некоторые из этих журналов могут отсутствовать.

        ```
        copy %LocalAppData%\SquirrelTemp\SquirrelSetup.log SquirrelSetup.log
        copy %AppData%\Microsoft\Teams\logs.txt logs.txt
        copy %LocalAppData%\Microsoft\Teams\SquirrelSetup.log SquirrelSetup_Teams.log
        ```
    3. Выполните указанные ниже действия, чтобы захватить открытые дескрипторы.

        ```
        handle > handles.txt
        ```

    4. Выполните указанные ниже действия, чтобы сохранить открытые библиотеки DLL.

        ```
        listdlls -v Teams > dlls.txt
        ```
    5. Выполните указанные ниже действия, чтобы захватить запущенные драйверы.

        ```
        driverquery /v > driverquery.txt
        ```

    6. Выполните указанные ниже действия, чтобы записать списки управления доступом (ACL) для папки "группы".

        ``` 
        icacls %LOCALAPPDATA%\Microsoft\Teams /save icacls.txt /T
        ```

### <a name="analyze-logs-for-advanced-users"></a>Анализ журналов (для опытных пользователей)

Сбой обновления может привести к непредсказуемому поведению приложения. Например, пользователи не могут выйти из группы, иметь устаревшую версию Teams или не смогут запустить Teams. Если во время обновления возникла неполадка, первое из них — найти причину ошибки — Скуиррелтемп. log. Ниже приведены различные типы сбоев обновления, перечисленные в списке наиболее распространенные, и способы их анализа и устранения неполадок с помощью журналов.

#### <a name="unable-to-exit-teams"></a>Не удается выйти из Teams

Поскольку в Teams определена необходимость его обновления до новой версии, она скачивается и размещает новое приложение, а затем ждет, пока компьютер не перезапускается в следующий раз. Обычно проблема возникает в том случае, если другой процесс или драйвер файловой системы заблокировал (-а) процесс Teams. exe, который не допускает выхода из Teams. exe. В результате приложение Teams нельзя заменить новым скачанным и поэтапным приложением.

Советы по устранению неполадок:

- Чтобы убедиться в том, что возникла проблема, выйдите из группы (щелкните правой кнопкой мыши команды на панели задач и выберите команду **выход**). Затем откройте диспетчер задач в Windows, чтобы убедиться, что экземпляр Teams еще выполняется.  
- Если вы не подключены к компьютеру, на котором возникла эта проблема, изучите Скуиррелтемп. log, собранные на компьютере с этой проблемой, и найдите сообщение "программа: не удается завершить процесс в журнале".
- Чтобы определить, что не мешает работе Teams. exe, Взгляните на журналы DLLs. txt и Handles. txt. Они указывают на процессы, которые не позволили Teams завершить работу.
- Еще один виновник, который может препятствовать выходу Teams, — это драйвер фильтра файловой системы в режиме ядра. С помощью средства SysInternals [ProcDump](https://docs.microsoft.com/sysinternals/downloads/procdump)можно собрать дамп процесса в режиме ядра, запустив ```procdump -mk <pid>```, где <pid> находится идентификатор процесса, полученный от диспетчера задач. Вы также можете проверить файл журнала driverquery. txt, чтобы увидеть драйверы активного фильтра, которые могут помешать работе Teams.
- Чтобы восстановить базу данных из этого состояния, перезагрузите компьютер.

#### <a name="file-permissions"></a>Разрешения для файлов

Команды создают в профиле пользователя несколько вложенных папок и файлов в рамках процесса установки и обновления. Так как приложение и средство обновления выполняются в качестве пользователя без повышенных привилегий, разрешения на чтение и запись должны быть предоставлены в следующих папках:

|Нее  |Используется  |
|---------|---------|
|%локалаппдата%\скуиррелтемп     | Установка установщика Teams (например, Teams_Windows_x64. exe) на этапе установки        |
|%локалаппдата%\микрософт\теамс  | Средство обновления Teams (Update. exe) для извлечения и поэтапного размещения пакета приложения в процессе обновления        |
|%аппдата%\микрософт\теамс   |  Приложение Teams (Teams. exe) для сохранения параметров, состояний приложений и (предварительно зафиксированных) скачанного пакета обновления       |

Если в Teams отказано в доступе из-за того, что не удается выполнить запись в файл, то может возникнуть угроза, если запись дескриптора безопасности ограничивает доступ на запись в папку.

Советы по устранению неполадок:

- Найдите свидетельство "отказано в доступе" в Скуиррелтемп. log или Logs. txt. Проверьте эти файлы, чтобы узнать, была ли попытка записи в файл, не прошедших из-за сбоя.
- Откройте icacls. txt и найдите действующий элемент управления доступом (ACE), который блокирует операции записи пользователем, который не является администратором. Обычно она находится в одной из записей DACL. Дополнительные сведения можно найти в [документации icacls](https://docs.microsoft.com/windows-server/administration/windows-commands/icacls).

#### <a name="file-corrupted"></a>Файл поврежден

В некоторых случаях программа для шифрования может изменять файлы в папке%Локалаппдата%\микрософт\теамс, что может препятствовать запуску групп. Это может происходить в любое время, даже если приложение не обновляется. К сожалению, если файл поврежден, единственным способом восстановления из этого состояния является удаление и повторная установка групп.

> [!NOTE]
> Если вы не можете определить основную причину проблемы, выполните одно из указанных ниже действий. [](https://docs.microsoft.com/sysinternals/downloads/procmon) Монитор процесса — это средство Sysinternals, записывающее доступ к реестру и файловой системе.

## <a name="related-topics"></a>Статьи по теме

- [Работа с клиентами для Teams](get-clients.md)
- [Обновления клиента Teams](teams-client-update.md)