---
title: Настройка иерархии целей для команды
ms.author: mikeplum
author: MikePlumleyMSFT
manager: serdars
ms.topic: conceptual
ms.service: msteams
ms.reviewer: andfried, acolonna
search.appverid: MET150
description: Узнайте, как настроить иерархию команд в организации для публикации содержимого в большом наборе команд.
audience: admin
ms.localizationpriority: medium
appliesto:
- Microsoft Teams
ms.collection:
- M365-collaboration
ms.openlocfilehash: dc4e7e88e855432f17c7daed9584e20e0e4739f1
ms.sourcegitcommit: fcbbc197e43bcd63bf95cb329df9cb52e06ee356
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2022
ms.locfileid: "68842117"
---
# <a name="set-up-your-team-targeting-hierarchy"></a>Настройка иерархии целей для команды

Настройка иерархии нацеливания на команды позволит вашей организации публиковать содержимое в большом наборе команд. Иерархия целевых групп определяет, как все команды в иерархии связаны друг с другом, какие пользователи могут публиковать задачи и в каких командах пользователи имеют разрешения на публикацию. Функции публикации отключены для всех пользователей, если для вашей организации не настроена иерархия целевых групп. Чтобы настроить иерархию целевых групп, необходимо создать файл, определяющий иерархию, а затем отправить его в Teams, чтобы применить его к вашей организации. После отправки схемы приложения в Teams могут использовать ее.

> [!IMPORTANT]
> В первоначальном выпуске только приложение "Задачи" поддерживает иерархические команды.  Применение иерархии целевых групп к организации позволит публиковать [задачи](https://support.microsoft.com/office/publish-task-lists-to-create-and-track-work-in-your-organization-095409b3-f5af-40aa-9f9e-339b54e705df) в приложении "Задачи". Вы не увидите иерархию команд в других областях Microsoft Teams.

Ниже приведен пример представления иерархии в приложении "Задачи" в Teams. После создания списка задач члены команды публикации могут выбрать команды получателей для отправки (публикации) списка задач. При выборе команд команда публикации может выполнять фильтрацию по иерархии, атрибутам или сочетанию обоих команд.<br>

![Снимок экрана: публикация задач.](media/manage-tasks-app-publish.png)

## <a name="terminology"></a>Терминологии

Следующие термины будут иметь важное значение при переходе по иерархиям. Teams будут называться **узлами**.

* **Корневые узлы** — это самые верхние узлы в иерархии. В этом примере розничные коммуникации являются корневым узлом.
* **Родительские** и **дочерние узлы — это термины** , представляющие связь между двумя подключенными узлами. В примере Район 01 является дочерним узлом области 1.
* Несколько уровней детей называются **потомками**. Район 01, Магазин 01, Магазин 03, Магазин 07, Район 02 и Район 03 являются потомками Области 1.
* Узел без дочерних называется **конечным узлом**. Они находятся в нижней части иерархии.
* **Команды получателей** — это команды, выбранные для получения определенного набора содержимого для публикации. Они должны быть конечными узлами.

## <a name="plan-your-hierarchy"></a>Планирование иерархии

Перед созданием схемы, определяющей иерархию, необходимо выполнить некоторое планирование и решить, как вы хотите сформировать организацию.  Одним из первых приоритетов является определение того, какие организационные группы должны публиковать задачи в других группах. Каждый узел в иерархии представляет рабочую группу или группу групп.

### <a name="permissions-to-publish"></a>Разрешения на публикацию

Разрешение на публикацию зависит от того, является ли пользователь членом каких-либо команд в иерархии, а также от связи этой команды или набора команд с другими командами в иерархии.

> [!NOTE]
> Владельцу команды также предоставляются разрешения на публикацию.

* Если пользователь является членом по крайней мере одной команды, которая имеет потомков в иерархии, этот пользователь может опубликовать для этих потомков, не будучи членом всех команд, в которых они хотят опубликовать.
* Если пользователь является членом по крайней мере одной команды в иерархии, но не является членом какой-либо команды с потомками в иерархии, он может просматривать и получать опубликованное содержимое из своей организации.
* Если пользователь не является членом какой-либо команды в иерархии, он не увидит никаких функциональных возможностей, связанных с публикацией.

### <a name="guidelines"></a>Руководящие принципы

* Для каждой организации может применяться только один файл иерархии. Однако вы можете включить различные части организации в виде отдельных иерархий узлов в одном файле. Например, Contoso Pharmaceuticals имеет корневой узел Pharmacy и корневой узел Розничной торговли. Оба корневых узла имеют несколько строк потомков, и между ними нет перекрытия.
* Получателями публикации могут быть только конечные узлы. Другие узлы в иерархии полезны для выбора получателей публикации.
* Команда может быть представлена только один раз в иерархии.
* Иерархия может содержать до 15 000 узлов. Мы планируем работать с клиентами, чтобы увеличить это ограничение для крупных организаций.

### <a name="example-hierarchy"></a>Пример иерархии

Например, в следующей иерархии можно опубликовать задачи в каждом нижнем узле (команде) иерархии, а северо-восточная зона может публиковать задачи только в нью-йоркском магазине и бостонском магазине. Пример иерархии позволяет группам отзывов, коммуникаций и отдела кадров публиковать задачи, относящиеся ко всей компании, такие как сведения о преимуществах или сообщения от генерального директора. Северо-восточная зона может публиковать задачи, такие как планирование персонала, сведения о погоде и т. д., только для команд нью-йоркского магазина и Boston Store.

![Пример иерархии команды.](media/team-targeting-schema-example-new.png)

## <a name="create-your-hierarchy"></a>Создание иерархии

> [!NOTE]
> В оставшейся части этой статьи рассматривается настройка иерархии команд в контексте публикации задач в командах получателей. Общие сведения о приложении "Задачи" см. [в статье Управление приложением "Задачи" для вашей организации в Teams](./manage-tasks-app.md) , где публикация задач отображается при включении.

Схема, которая определяет иерархию, основана на файле с разделиющими запятыми значениями (CSV). Файл должен быть в формате UTF-8. Каждая строка в CSV-файле соответствует одному узлу в иерархии команд. Каждая строка содержит сведения, которые именуют узел в иерархии, при необходимости связывают его с командой и включают атрибуты, которые можно использовать для фильтрации команд в приложениях, которые его поддерживают.

Вы также можете определить **контейнеры**, которые представляют собой категории, которые команда публикации может использовать для организации содержимого, отправляемого группам получателей, чтобы упростить просмотр, сортировку и фокус на соответствующем содержимом.

### <a name="add-required-columns"></a>Добавление обязательных столбцов

CSV-файл должен содержать следующие три столбца в следующем порядке, начиная с первого столбца. Узел должен быть связан с командой, чтобы он получал задачи.

| Имя столбца   | Обязательно | Описание   |
----------------|----------|---------------|
| DisplayName    | Да      | Это поле — имя узла. Имя может содержать до 100 символов и содержать только символы A–Z, a–z и 0–9. Имена узлов должны быть уникальными. |
| ParentName    | Да       | Это имя родительского узла. Указанное здесь значение должно точно соответствовать значению в поле **DisplayName** родительского узла. Если вы хотите добавить несколько родительских узлов, разделите имена каждого родительского узла точкой с запятой (;). Можно добавить до 25 родительских узлов, а имя каждого родительского узла может содержать до 2500 символов. Узел может иметь несколько родительских узлов, только если они являются корневыми.   <br><br>**ВАЖНО** Не создавайте цикл, в котором родитель выше в иерархии ссылается на дочерний узел ниже в иерархии. Это не поддерживается. |
| TeamId        | Да, если команда публикует задачи или получает задачи от родительского узла.       | Он содержит идентификатор команды, с которой вы хотите связать узел. Каждый узел должен ссылаться на уникальную команду, поэтому каждое значение TeamId может отображаться только один раз в файле иерархии. Чтобы получить идентификатор команды, с которой вы хотите связать узел, выполните следующую команду PowerShell: `Get-Team | Export-Csv TeamList.csv`. Эта команда выводит список команд в вашей организации и включает имена и идентификаторы для каждой команды. Найдите имя команды, с которой вы хотите связать ссылку, а затем скопируйте идентификатор в это поле.|

> [!NOTE]
> Если узел не является корневым или конечным узлом и вам не требуется членство в команде для предоставления соответствующих разрешений на публикацию и создание отчетов, вы можете оставить TeamId пустым. Этот метод можно использовать для повышения детализации при выборе команд получателей или для просмотра отчетов о завершении без соответствующей команды.

### <a name="add-attribute-columns"></a>Добавление столбцов атрибутов

После добавления трех обязательных столбцов можно добавить необязательные столбцы атрибутов. Эти атрибуты можно использовать для фильтрации узлов, чтобы было проще выбирать те, в которых нужно опубликовать задачи. Существует два способа определения атрибутов в зависимости от того, являются ли значения для этого атрибута взаимоисключающими.

|Способы добавления атрибутов|Описание |Пример  |
|---|---------|---------|
|Если значения атрибута являются взаимоисключающими, указанное имя столбца становится именем атрибута.|Каждая строка может содержать одно значение для этого атрибута, а каждый столбец атрибута может содержать до 50 уникальных значений. Каждое значение может содержать до 100 символов. Набор значений атрибутов, указанных в столбце атрибута, будет отображаться в виде значений фильтра для этого атрибута при выборе команд-получателей с помощью иерархии целевых групп команд.|Вы хотите, чтобы пользователи могли фильтровать хранилища по макету. Значения этого атрибута являются взаимоисключающими, так как хранилище может иметь только один макет. <br><br>Чтобы добавить атрибут для фильтрации хранилищ по макету, добавьте столбец с именем Макет магазина. В этом примере для атрибута макета Store используются значения Compact, Standard и Large.
|Если необходимо указать несколько значений атрибута и значения не являются взаимоисключающими, используйте формат **AttributeName:UniqueValue** для имен столбцов. <br><br>**ВАЖНО** Убедитесь, что используется двоеточие только для английского языка (:) Как юникод не поддерживается в качестве разделителя столбцов атрибутов. |Текстовая строка перед двоеточием (:) становится именем атрибута. Все столбцы, содержащие одну текстовую строку перед двоеточиями (:) группируются в раздел в меню фильтрации. Каждая из строк после двоеточия становится значениями для этого раздела.<br><br>Каждая строка может иметь значение 0 (ноль) или 1 для этого атрибута. Значение 0 означает, что атрибут не применяется к узлу, а значение 1 означает, что атрибут применяется к этому узлу.|Вы хотите, чтобы пользователи могли фильтровать хранилища по отделам. Хранилище может иметь несколько отделов, поэтому значения для этого атрибута не являются взаимоисключающими.<br><br>В этом примере мы добавим в качестве столбцов атрибутов Отделы:Одежда, Отделы:Электроника, Отделы:Продукты питания, Отделы:Главная и Сад, Отделы:Спортивные товары. Отделы становятся именем атрибута, и пользователи могут фильтровать по отделам одежды, электроники, продуктов питания, дома и сада и спортивных товаров.|

При добавлении столбца атрибутов учитывайте следующее:

* Указанное имя столбца или имя столбца, указанное перед двоеточием (:) становится именем атрибута. Это значение будет отображаться в приложениях Teams, использующих иерархию.
* В иерархии может быть до 50 столбцов атрибутов.
* Имя столбца может содержать до 100 символов и содержать только символы A–Z, a–z и 0–9 и пробелы. Имена столбцов должны быть уникальными.

### <a name="add-bucket-columns"></a>Добавление столбцов контейнера

Вы можете добавить столбцы контейнеров для создания контейнеров, которые представляют собой группы, в которые можно упорядочить задачи. Каждый контейнер получает собственный столбец в CSV-файле. Создаваемые контейнеры становятся доступными для команды публикации. Затем команда публикации может использовать эти контейнеры для классификации задач для команд получателей. Если контейнер еще не существует в команде, контейнеры создаются по запросу при публикации задач.

Классифицируя рабочие элементы один раз централизованно, команда публикации может предварительно упорядочить список задач для всех десятков, сотен или тысяч команд получателей, которые получают список задач. Затем команды получателей могут сортировать и фильтровать свои задачи по контейнеру, чтобы сосредоточиться на области, наиболее подходящей для их работы.

При добавлении столбца контейнера обратите внимание на следующее:

* Имя столбца становится именем контейнера. Каждый указанный контейнер будет отображаться в списке Контейнеры в приложениях Teams, использующих иерархию.
* Рекомендуется не включать конфиденциальную информацию в имена контейнеров. В настоящее время команды публикации не могут удалить контейнер через публикацию после его создания.
* Имени столбца должен предшествовать хэштег (#). Он может содержать до 100 символов и содержать только символы A-Z, a-z и 0-9. Например, #Operations и #Frozen Goods.
* Иерархия может содержать до 25 столбцов контейнера. Мы планируем работать с клиентами, чтобы увеличить это ограничение для крупных организаций.

### <a name="example"></a>Пример

Ниже приведен пример CSV-файла схемы, который будет создан для поддержки иерархии, показанной на предыдущем рисунке. Эта схема содержит следующее:

* Три обязательных столбца с именем `TargetName`, `ParentName`и `TeamId`
* Три столбца атрибутов с именем `Store layout`, `Departments:Clothing`и `Departments:Foods`
* Три столбца контейнера с именем `Fresh Foods`, `Frozen Foods`и `Women's Wear`

Атрибут `Store layout` содержит значения , `Compact``Standard`, и `Large`. Для `Departments` столбцов атрибутов `0` можно задать значение (ноль) или `1`. Макет `Store` и `Departments` атрибуты не отображаются на изображении выше. Они добавляются сюда, чтобы показать, как можно добавлять атрибуты в записи узла. То же самое относится и к трем столбцам контейнера.

```CSV
TargetName,ParentName,TeamId,Store layout,Departments:Clothing,Departments:Foods,#Fresh Foods,#Frozen Foods,#Women's Wear
Recall,,db23e6ba-04a6-412a-95e8-49e5b01943ba,,,,,,
Communications,,145399ce-a761-4843-a110-3077249037fc,,,,,,
HR,,125399ce-a761-4983-a125-3abc249037fc,,,,,,
East Regional Office,HR;Communications;Recall,,,,,,,
West Regional Office,HR;Communications;Recall,,,,,,,
Northeast Zone,East Regional Office,,,,,,,
Southeast Zone,East Regional Office,,,,,,,
New York Store,Northeast Zone,e2ba65f6-25e7-488b-b8f0-b8562d5de60a,Large,1,1,,,
Boston Store,Northeast Zone,0454f08a-0507-437c-969a-682eb2fae7fc,Standard,1,1,,,
Miami Store,Southeast Zone,619d6e4e-5f68-4b36-8e1f-16c98d7396c1,Compact,0,1,,,
New Orleans Store,Southeast Zone,6be960b8-72af-4561-a343-9ac4711874eb,Compact,0,1,,,
Seattle Store,West Regional Zone,487c0d20-4e55-4dc2-8187-a24c826e0fee,Standard,1,1,,,
Los Angeles Store,West Regional Zone,204a1287-2efb-4a8a-88e0-56fbaf5a2389,Large,1,1,,,
```

## <a name="apply-your-hierarchy"></a>Применение иерархии

> [!NOTE]
> Для выполнения этого шага необходимо использовать командлеты PowerShell Microsoft Teams. Следует использовать командлеты Microsoft Teams версии 4.6.0 или более поздней. Это требование также относится к клиентам облака сообщества для государственных организаций (GCC).

Определив иерархию в CSV-файле схемы, вы можете отправить ее в Teams. Для этого выполните следующую команду. Для выполнения этого шага необходимо быть глобальным администратором или администратором службы Teams.

```powershell
Set-TeamTargetingHierarchy -FilePath "C:\ContosoTeamSchema.csv"
```

### <a name="update-your-hierarchy"></a>Обновление иерархии

Вы можете отправить новую иерархию для замены старой с помощью той же команды PowerShell, что и выше. Каждый раз при отправке новой иерархии она заменяет предыдущую иерархию.

### <a name="check-the-status-of-your-hierarchy"></a>Проверка состояния иерархии

Чтобы проверить состояние отправки иерархии, можно выполнить следующую команду.

```powershell
Get-TeamTargetingHierarchyStatus
```

Команда вернет следующие поля:

Поле|Описание
-----|------------
Id | Уникальный идентификатор для отправки.
Статус | Состояние отправки. Значения: **"Запуск"**, **"Проверка"**, **"Успешно"** и **"Сбой".**
ErrorDetails | Сведения об ошибке отправки. Дополнительные сведения об ошибке см. в разделе Устранение неполадок. Если ошибка отсутствует, это поле будет пустым.
LastUpdatedAt | Метка времени и дата последнего обновления файла.
LastModifiedBy | Идентификатор последнего пользователя, изменившего файл.
FileName | Имя файла CSV.

## <a name="remove-your-hierarchy"></a>Удаление иерархии

Если вы хотите немедленно отключить вкладку **Опубликованные списки** для всех пользователей в организации, можно удалить иерархию. У пользователей не будет доступа к вкладке **Опубликованные списки** или каким-либо функциям на вкладке.  Сюда входит возможность создавать новые списки задач для публикации, доступа к черновикам списков, публикации, отмены публикации и дублирования списков, а также просмотра отчетов. Удаление иерархии не отменяет публикацию ранее опубликованных задач. Эти задачи останутся доступными для выполнения команд получателей.

Чтобы удалить иерархию, выполните следующую команду. Для выполнения этого шага необходимо быть администратором.

```powershell
Remove-TeamTargetingHierarchy
```

При подтверждении удаления в сообщении о состоянии по-прежнему отображается предыдущая схема, хотя при попытке удалить снова возвращается сообщение об ошибке, указывающее, что объект имеет значение NULL.

## <a name="create-a-sample-hierarchy"></a>Создание примера иерархии

### <a name="install-the-teams-powershell-module"></a>Установка модуля PowerShell для Teams

> [!IMPORTANT]
> Для выполнения этого шага необходимо установить и использовать модуль PowerShell Teams из [коллекция PowerShell](https://www.powershellgallery.com/packages/MicrosoftTeams/). Инструкции по установке модуля см. в статье [Установка модуля Microsoft Teams PowerShell](teams-powershell-install.md).

### <a name="sample-script"></a>Пример сценария

Следующий скрипт можно использовать для создания команд и отправки файла .csv в клиент Microsoft Teams. Если у вас есть существующая иерархия, этот скрипт заменит ее.

#### <a name="create-teams-for-a-simple-hierarchy"></a>Создание команд для простой иерархии

```powershell
$tm1 = New-Team -DisplayName "HQ"
$tm2 = New-Team -DisplayName "North"
$tm3 = New-Team -DisplayName "Store 1"
$tm4 = New-Team -DisplayName "Store 2"
$tm5 = New-Team -DisplayName "South"
$tm6 = New-Team -DisplayName "Store 3"
$tm7 = New-Team -DisplayName "Store 4"
```

#### <a name="use-team-data-to-create-comma-separated-output-displayname-parentname-teamid"></a>Использование данных команды для создания выходных данных, разделенных запятыми (DisplayName, ParentName, TeamId)

```powershell
$csvOutput = "DisplayName" + "," + "ParentName" + "," + "TeamId" + "`n"
$csvOutput = $csvOutput + $tm1.DisplayName + "," + "," + $tm1.GroupID + "`n"
$csvOutput = $csvOutput + $tm2.DisplayName + "," + $tm1.DisplayName + "," + $tm2.GroupID + "`n"
$csvOutput = $csvOutput + $tm3.DisplayName + "," + $tm2.DisplayName + "," + $tm3.GroupID + "`n"
$csvOutput = $csvOutput + $tm4.DisplayName + "," + $tm2.DisplayName + "," + $tm4.GroupID + "`n"
$csvOutput = $csvOutput + $tm5.DisplayName + "," + $tm1.DisplayName + "," + $tm5.GroupID + "`n"
$csvOutput = $csvOutput + $tm6.DisplayName + "," + $tm5.DisplayName + "," + $tm6.GroupID + "`n"
$csvOutput = $csvOutput + $tm7.DisplayName + "," + $tm5.DisplayName + "," + $tm7.GroupID 
```

#### <a name="save-output-to-a-csv-file-in-the-downloads-folder"></a>Сохранение выходных данных в файл .csv в папке **"Загрузки"**

```powershell
$csvOutputPath = $env:USERPROFILE + "\downloads\testhierarchy-" + (Get-Date -Format "yyyy-MM-dd-hhmmss") + ".csv" 
$csvOutput | Out-File $csvOutputPath
```

#### <a name="upload-the-hierarchy"></a>Отправка иерархии

```powershell
Set-TeamTargetingHierarchy -FilePath $csvOutputPath
Get-TeamTargetingHierarchyStatus
```

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="how-to-view-error-details"></a>Просмотр сведений об ошибке

Вы можете выполнить следующую команду, чтобы понять, что вызывает ошибку, и вернуть сведения об ошибке.

```powershell
(Get-TeamTargetingHierarchyStatus).ErrorDetails.ErrorMessage
```

### <a name="you-receive-an-error-message-when-you-upload-your-schema-csv-file"></a>При отправке CSV-файла схемы появляется сообщение об ошибке

Запишите сообщение об ошибке, так как оно должно содержать сведения об устранении неполадок, чтобы указать, почему не удалось отправить схему. Просмотрите и измените CSV-файл схемы на основе сведений в сообщении об ошибке, а затем повторите попытку.

### <a name="you-receive-an-error-invalidteamid-error-message-when-you-upload-your-schema-csv-file"></a>При отправке CSV-файла схемы появляется сообщение об ошибке "Error: InvalidTeamId"

При попытке отправить CSV-файл схемы появляется следующее сообщение об ошибке:

```console
Error: InvalidTeamId
Description: TeamID in row # doesn't match a valid Group ID. Please view our documentation to learn how to get the proper GroupID for each team.
```

Убедитесь, что вы используете правильный TeamId для команды в CSV-файле схемы. Идентификатор TeamId должен совпадать с идентификатором группы Microsoft 365, которая поддерживает команду. Идентификатор группы можно найти в Центре администрирования Microsoft Teams.

1. В левой области навигации [Центра администрирования Microsoft Teams](https://admin.teams.microsoft.com/) перейдите в раздел **Управление командами** **Teams** > .
2. Если столбец **Идентификатор группы** не отображается в таблице, выберите **Изменить столбцы** в правом верхнем углу таблицы, а затем включите **параметр Идентификатор группы**.
3. Найдите команду в списке, а затем найдите идентификатор группы.

Убедитесь, что идентификатор TeamId в CSV-файле схемы соответствует идентификатору группы, который отображается в Центре администрирования Microsoft Teams.

## <a name="related-topics"></a>См. также

* [Управление приложением "Задачи" для организации в Teams](manage-tasks-app.md)
* [Обзор PowerShell в Teams](teams-powershell-overview.md)
