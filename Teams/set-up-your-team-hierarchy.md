---
title: Настройка иерархии целей для команды
author: cichur
ms.author: v-cichur
manager: serdars
ms.topic: conceptual
ms.service: msteams
ms.reviewer: andfried, acolonna
search.appverid: MET150
description: Узнайте, как настроить иерархию групп в организации для публикации контента в большом наборе команд.
audience: admin
localization_priority: Normal
MS.collection:
- Teams_ITAdmin_Help
- M365-collaboration
appliesto:
- Microsoft Teams
ms.openlocfilehash: fcdae04ce87db82bd5f18e818dcf194fc7ff38c7
ms.sourcegitcommit: 31a585cc0fe6350efacf3a7771d1e590d5e4233c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "50615045"
---
# <a name="set-up-your-team-targeting-hierarchy"></a>Настройка иерархии целей для команды

Настройка иерархии целевого контента группы позволит вашей организации публиковать контент в большом наборе команд. Иерархия целевых групп определяет, как все группы в вашей иерархии связаны друг с другом, какие пользователи могут публиковать задачи и на какие группы у пользователей есть разрешения на публикацию. Функции публикации отключены для всех пользователей, если в вашей организации не настроена иерархия целевой группы. Чтобы настроить иерархию целевой аудитории команды, необходимо создать файл, определяющий ее, а затем отправить его в Teams, чтобы применить его к вашей организации. После добавления схемы приложения в Teams могут использовать ее.

> [!IMPORTANT]
> В первом выпуске только приложение "Задачи" поддерживает иерархические группы.  Применение иерархии целевой группы к организации позволит публиковать задачи [в](https://support.microsoft.com/office/publish-task-lists-to-create-and-track-work-in-your-organization-095409b3-f5af-40aa-9f9e-339b54e705df) приложении "Задачи". Иерархия команд в других областях Microsoft Teams не будет отвена.

Ниже представлен пример представления иерархии в приложении "Задачи" в Teams. После создания списка задач участники группы публикации могут выбрать группы получателей, в которые нужно отправить (опубликовать) список задач. При выборе команд команда публикации может фильтроваться по иерархии, атрибутам или сочетанию обеих команд.<br>

![Снимок экрана: публикация задачи](media/manage-tasks-app-publish.png)

## <a name="terminology"></a>Терминология

При переходе по иерархиям важно использовать следующие термины: Команды будут называться **узлами.**

* **Корневые узлы** являются верхними узлами в иерархии. В этом примере retail Communications — это корневой узел.
* **Родительские и** **потомки —** это термины, которые представляют связь между двумя подключенными узлами. В этом примере округ 01 — это ребенку узел в области 1.
* Несколько уровней детей называют висяками. Район 01, Магазин 01, Магазин 03, Магазин 07, Округ 02 и Район 03 — это все в части 1.
* Узел без детей называется узлом **листа.** Они находятся внизу иерархии.
* **Группы получателей** — это группы, выбранные для получения определенного набора содержимого для публикации. Это должны быть узлы с листьями.

## <a name="plan-your-hierarchy"></a>Планирование иерархии

Перед созданием схемы, определяемой иерархией, необходимо спланируя схему и решите, как вы хотите сформировать свою организацию.  Одним из первых приоритетов является выбор групп организации, которые должны публиковать задачи в других группах. Каждый узел в иерархии представляет рабочую группу или группу.

### <a name="permissions-to-publish"></a>Разрешения на публикацию

Разрешение на публикацию зависит от того, является ли пользователь участником любой из команд в иерархии, а также от отношения этой группы или набора команд к другим командам в иерархии.

> [!NOTE]
> Владельцу группы также предоставлены разрешения на публикацию.

* Если пользователь является участником хотя бы одной команды, у кого есть в иерархии влиять на нее, он может опубликовать ее, не влияя на все группы, в которые он хочет опубликовать данные.
* Если пользователь является членом хотя бы одной группы в иерархии, но не является участником группы, влияемой на иерархию, он может видеть и получать опубликованное содержимое из своей организации.
* Если пользователь не является участником какой-либо команды в иерархии, он не будет видеть функции, связанные с публикацией.

### <a name="guidelines"></a>Рекомендации

* В организации может быть применен только один файл иерархии. Однако вы можете использовать различные части организации как отдельные иерархии узлов в одном CSV-файле. Например, у компании Contoso Pharmaceuticals есть корневой узел "Весячий" и корневой узел Retail. Оба корневых узла имеют несколько строк ветвей, и между ними нет перекрытия.
* Получателями публикации могут быть только узлы с листами. Другие узлы в иерархии полезны для выбора получателей публикации.
* В иерархии команда может быть представлена только один раз.
* Иерархия может содержать до 15 000 узлов. Мы планируем вместе с клиентами повысить это ограничение для крупных организаций.

### <a name="example-hierarchy"></a>Пример иерархии

Например, в следующей иерархии задачи "Отзыв", "Связь" и "Отдел кадров" могут публиковаться на всех нижних узлах (группах) в иерархии, но к северо-восточному региону можно публиковать задачи только в командах "Нью-Йорк" и "Яродонский магазин". Иерархия примера позволяет группам отзывов, коммуникаций и отдела кадров публиковать задачи, которые относятся к всей компании, например сведения о преимуществах или сообщения от директора. Северо-восток может публиковать такие задачи, как планирование персонала, прогноз погоды и так далее, только в командах "Нью-Йорк" и "Магазин в Москве".

![Пример иерархической группы](media/team-targeting-schema-example-new.png)

## <a name="create-your-hierarchy"></a>Создание иерархии

> [!NOTE]
> В оставшейся части этой статьи обсуждается настройка иерархии группы в контексте публикации задач в командах получателей. Обзор [](https://docs.microsoft.com/MicrosoftTeams/manage-tasks-app) приложения "Задачи", в котором публикация задач отображается при включенной функции, обратитесь к приложению "Управление задачами" для вашей организации в Teams.

Схема, определяемая иерархией, основана на CSV-файле. Каждая строка в CSV-файле соответствует одному узлу в иерархии команд. В каждой строке содержится информация, которая содержит имя узла в иерархии, при желании связывает его с командой, а также атрибуты, которые можно использовать для фильтрации команд в приложениях, которые его поддерживают.

Вы также можете определить сегменты, которые являются категориями, с помощью которых группа публикации может упорядочеть содержимое, отправленное в группы получателей, чтобы упростить для них просмотр, сортировку и фокус на релевантном контенте.

### <a name="add-required-columns"></a>Добавление необходимых столбцов

CSV-файл должен содержать три столбца начиная с первого столбца в следующем порядке: Для получения задач узел должен быть связан с командой.

| Имя столбца   | Обязательный? | Описание   |
----------------|----------|---------------|
| DisplayName    | Да      | Это поле называется узлом. Имя может содержать не более 100 знаков и содержать только символы A–Z, a–z и 0–9. Имена узлов должны быть уникальными. |
| ParentName    | Да       | Это имя родительского узла. Это значение должно в точности соответствовать значению в поле **DisplayName** родительского узла. Если вы хотите добавить несколько родительских узлов, разделите их имена точками с заточкими (;). Вы можете добавить до 25 родительских узлов, каждый из которых может иметь длину до 2500 символов. Узел может иметь несколько родительских узлов, только если родительские узлы являются корневыми.   <br><br>**ВАЖНО!** Будьте осторожны, чтобы не создать цикл, в котором родительский узел выше в иерархии ссылается на узел ребенка, который находится ниже в иерархии. Эта поддержка не поддерживается. |
| TeamId        | Да, если группа публикует задачи или получает задачи из родительского узла       | Он содержит ИД группы, с командой, с которая будет связывать узел. Каждый узел должен ссылаться на уникальную команду, поэтому каждое значение TeamId может отображаться в файле иерархии только один раз. Чтобы получить ИД группы, с которая связывает узел, запустите следующую команду PowerShell: `Get-Team | Export-Csv TeamList.csv` Эта команда содержит список групп в организации, а также имя и ИД каждой из них. Найдите имя группы, с командой, с которая будет связываться, и скопируйте в это поле ее имя.|

> [!NOTE]
> Если узел не является корневым узлом или узлом листа и вам не требуется членство в группе для предоставления соответствующих разрешений на публикацию и отчеты, оставьте teamId пустым. Этот метод можно использовать для добавления дополнительной детализации при выборе команд получателей или при просмотре отчетов о завершении, не применяя соответствующую группу.

### <a name="add-attribute-columns"></a>Добавление столбцов атрибута

После добавления трех необходимых столбцов можно добавить необязательные столбцы атрибутов. Эти атрибуты можно использовать для фильтрации узлов, чтобы можно было легко выбрать те из них, в которые вы хотите опубликовать задачи. Существует два способа определения атрибутов в зависимости от того, являются ли значения этого атрибута взаимоисключающими.

|Способы добавления атрибутов|Описание |Пример  |
|---|---------|---------|
|Если значения атрибута являются взаимоисключающими, имя столбца, которое вы указываете, становится именем атрибута.|Каждая строка может содержать одно значение для этого атрибута, а каждый столбец атрибута может содержать до 50 уникальных значений. Каждое значение может иметь длину до 100 знаков. Набор значений атрибутов, которые вы указываете в столбце атрибута, будет отображаться как значения фильтра для этого атрибута при выборе команд получателей с помощью иерархии целевого отбора группы.|Вы хотите, чтобы пользователи могли фильтровать хранилища по макетам. Значения этого атрибута являются взаимоисключающими, так как в хранилище может быть только один макет. <br><br>Чтобы добавить атрибут для фильтрации хранилищ по макету, добавьте столбец "Макет Магазина". В этом примере атрибуты макета Store имеют такие значения: "Сжатая", "Стандартная" и "Большая".
|Если необходимо указать несколько значений для атрибута, которые не являются взаимоисключающими, используйте формат **AttributeName:UniqueValue** для имен столбцов. <br><br>**ВАЖНО!** Используйте только английский двоеточие (:) так как Юникод не поддерживается как один из столбцов атрибута. |Текстовая строка перед двоеточием (:) становится именем атрибута. Все столбцы, содержащие одинаковые текстовые строки перед двоеточиями (:) группуются в раздел в меню фильтрации. Каждая строка после двоеточия становится значениями для этого раздела.<br><br>Каждая строка может иметь значение 0 (ноль) или 1 для этого атрибута. Значение 0 означает, что атрибут не применяется к узлу, а значение 1 означает, что атрибут применяется к этому узлу.|Вы хотите, чтобы пользователи могли фильтровать хранилища по отделам. Магазин может иметь несколько отделов, поэтому значения этого атрибута не являются взаимоисключающими.<br><br>В этом примере мы добавляем столбцы "Отделы:одежда", "Отделы:электронная", "Отделы:продукты", "Отделы:дом" и "Саду", "Отделы:товаров и услуг" в качестве столбцов атрибутов. Названия атрибутов становятся отделами, и пользователи могут фильтровать их по отделам "Одежда", "Электронная компания", "Продукты", "Дом" и "Садовый" и "Потребительские товары".|

При добавлении столбца атрибутов необходимо помнить следующее:

* Имя столбца, которое вы указываете, или имя столбца, за которое вы указываете перед двоеточием (:) становится именем атрибута. Это значение будет отображаться в приложениях Teams, которые используют иерархию.
* В иерархии может быть до 50 столбцов атрибутов.
* Имя столбца может содержать не более 100 знаков и содержать только символы A–Z, a-z и 0-9 и пробелы. Имена столбцов должны быть уникальными.

### <a name="add-bucket-columns"></a>Добавление столбцов сегмента

Вы можете добавить столбцы сегментов, чтобы создать сегменты, которые являются группировками, в которые можно организовать задачи. Каждый сегмент получает свой столбец в CSV-файле. Сегменты, которые вы создаете, доступны команде публикации. После этого группа публикации может классифицировать задачи для команд получателей с помощью этих сегментов. Если в команде еще нет сегмента, сегменты создаются по запросу при публикации задач.

Централизованно классифицируя элементы работы один раз, группа публикации может предварительно упорядоизировать список задач для всех групп, в которые были поставлены десятки, сотни или тысячи получателей. Затем группы получателей могут сортировать и фильтровать свои задачи по сегментам, чтобы сосредоточиться на области, наиболее релевантной для их работы.

При добавлении столбца сегмента обратите внимание на следующее:

* Имя столбца становится именем сегмента. Каждый из этих сегментов появится в списке "Сегменты" в приложениях Teams, которые используют иерархию.
* Не рекомендуется включать конфиденциальную информацию в имена сегментов. В настоящее время группы публикации не могут удалить сегмент с помощью публикации после его создания.
* Перед именем столбца должен быть хэштег (#). Оно может содержать не более 100 знаков и содержать только символы A–Z, a–z и 0–9. Например, #Operations и #Frozen товары.
* Иерархия может содержать до 25 столбцов сегментов. Мы планируем вместе с клиентами увеличить это ограничение для крупных организаций.

### <a name="example"></a>Пример

Ниже показан пример CSV-файла схемы, который будет создан для поддержки иерархии, показанной на предыдущем рисунке. Эта схема содержит следующие данные:

* Три необходимых столбца с `TargetName` именем `ParentName` и `TeamId`
* Три столбца с именами `Store layout` и `Departments:Clothing``Departments:Foods`
* Три столбца с `Fresh Foods` названием `Frozen Foods` "сегмент" и `Women's Wear`

Атрибут `Store layout` имеет значения, которые включают `Compact` , `Standard` и `Large` . Для `Departments` столбцов атрибута можно установить значение `0` (ноль) или `1` . Макет `Store` и `Departments` атрибуты не показаны на рисунке выше. Они добавлены здесь, чтобы показать, как добавлять атрибуты к записям узлов. То же самое относится и к трем столбцам сегментов.

```CSV
TargetName,ParentName,TeamId,Store layout,Departments:Clothing,Departments:Foods,#Fresh Foods,#Frozen Foods,#Women's Wear
Recall,,db23e6ba-04a6-412a-95e8-49e5b01943ba,,,,,,
Communications,,145399ce-a761-4843-a110-3077249037fc,,,,,,
HR,,,,,,,,
East Regional Office,,,,,,,,
West Regional Office,,,,,,,,
Northeast Zone,East Regional Office,,,,,,,
Southeast Zone,East Regional Office,,,,,,,
New York Store,Northeast Zone,e2ba65f6-25e7-488b-b8f0-b8562d5de60a,Large,1,1,,,
Boston Store,Northeast Zone,0454f08a-0507-437c-969a-682eb2fae7fc,Standard,1,1,,,
Miami Store,Southeast Zone,619d6e4e-5f68-4b36-8e1f-16c98d7396c1,Compact,0,1,,,
New Orleans Store,Southeast Zone,6be960b8-72af-4561-a343-9ac4711874eb,Compact,0,1,,,
Seattle Store,West Regional Zone,487c0d20-4e55-4dc2-8187-a24c826e0fee,Standard,1,1,,,
Los Angeles Store,West Regional Zone,204a1287-2efb-4a8a-88e0-56fbaf5a2389,Large,1,1,,,
```

## <a name="apply-your-hierarchy"></a>Применение иерархии

После определения иерархии в CSV-файле схемы вы можете отправить ее в Teams. Для этого запустите следующую команду: Для этого необходимо быть глобальным администратором или администратором служб Teams.

```powershell
Set-TeamTargetingHierarchy -FilePath "C:\ContosoTeamSchema.csv"
```

### <a name="update-your-hierarchy"></a>Обновление иерархии

Вы можете добавить новую иерархию, чтобы заменить старую с помощью той же команды PowerShell, что и выше. Каждый раз при добавлении новой иерархии она заменяет предыдущую.

### <a name="check-the-status-of-your-hierarchy"></a>Проверка состояния иерархии

Чтобы проверить состояние отправки иерархии, можно выполнить следующую команду:

```powershell
Get-TeamTargetingHierarchyStatus
```

Команда возвращает следующие поля:

Поле|Описание
-----|------------
ИД | Уникальный ИД для отправки.
Состояние | Состояние отправки. К ним относятся следующие значения: **"Запуск",** **"Проверка",** **"Успешно"** **и "Сбой"**
ErrorDetails | Сведения об ошибке отправки. Дополнительные сведения об ошибках см. в разделе "Устранение неполадок". Если ошибки нет, это поле пусто.
LastUpdatedAt | Timestamp and date of when the file was last updated.
LastModifiedBy | ИД последнего пользователя, который изменил файл.
FileName | Имя CSV-файла.

## <a name="remove-your-hierarchy"></a>Удаление иерархии

Если вы хотите немедленно  отключить вкладку "Опубликованные списки" для всех пользователей в организации, вы можете удалить иерархию. У пользователей не будет  доступа к вкладке "Опубликованные списки" и функциям на ней.  Это включает возможность создавать новые списки задач для публикации, доступа к черновикам списков, публикации, от публикации и дублирования списков, а также просмотра отчетов. При удалении иерархии не удаляются опубликованные ранее задачи. Группы получателей не смогут выполнить эти задачи.

Чтобы удалить иерархию, запустите следующую команду: Для выполнения этого шага необходимо быть администратором.

```powershell
Remove-TeamTargetingHierarchy
```

При подтверждении удаления в сообщении о состоянии по-прежнему будет отображаться предыдущая схема, хотя попытка удалить ее снова возвращает ошибку со статусом NULL.

## <a name="create-a-sample-hierarchy"></a>Создание примера иерархии

### <a name="install-the-teams-powershell-module"></a>Установка модуля Teams PowerShell

> [!IMPORTANT]
> Для выполнения этого шага необходимо установить и использовать общедоступный предварительный модуль Teams PowerShell из [коллекции PowerShell.](https://www.powershellgallery.com/packages/MicrosoftTeams/) По шагам об установке модуля см. в [.оке "Установка Teams PowerShell".](teams-powershell-install.md)

### <a name="sample-script"></a>Пример сценария

Следующий сценарий можно использовать для создания групп и добавления CSV-файла в клиент Microsoft Teams. Если у вас уже есть иерархия, сценарий заменит ее.

#### <a name="create-teams-for-a-simple-hierarchy"></a>Создание команд для простой иерархии

```powershell
$tm1 = New-Team -DisplayName "HQ"
$tm2 = New-Team -DisplayName "North"
$tm3 = New-Team -DisplayName "Store 1"
$tm4 = New-Team -DisplayName "Store 2"
$tm5 = New-Team -DisplayName "South"
$tm6 = New-Team -DisplayName "Store 3"
$tm7 = New-Team -DisplayName "Store 4"
```

#### <a name="use-team-data-to-create-comma-separated-output-displayname-parentname-teamid"></a>Использование данных группы для создания выходных данных с разделами-запятами (DisplayName, ParentName, TeamId)

```powershell
$csvOutput = "DisplayName" + "," + "ParentName" + "," + "TeamId" + "`n"
$csvOutput = $csvOutput + $tm1.DisplayName + "," + "," + $tm1.GroupID + "`n"
$csvOutput = $csvOutput + $tm2.DisplayName + "," + $tm1.DisplayName + "," + $tm2.GroupID + "`n"
$csvOutput = $csvOutput + $tm3.DisplayName + "," + $tm2.DisplayName + "," + $tm3.GroupID + "`n"
$csvOutput = $csvOutput + $tm4.DisplayName + "," + $tm2.DisplayName + "," + $tm4.GroupID + "`n"
$csvOutput = $csvOutput + $tm5.DisplayName + "," + $tm1.DisplayName + "," + $tm5.GroupID + "`n"
$csvOutput = $csvOutput + $tm6.DisplayName + "," + $tm5.DisplayName + "," + $tm6.GroupID + "`n"
$csvOutput = $csvOutput + $tm7.DisplayName + "," + $tm5.DisplayName + "," + $tm7.GroupID 
```

#### <a name="save-output-to-a-csv-file-in-the-downloads-folder"></a>Сохранение выходных данных в CSV-файл **в** папке "Загрузки"

```powershell
$csvOutputPath = $env:USERPROFILE + "\downloads\testhierarchy-" + (Get-Date -Format "yyyy-MM-dd-hhmmss") + ".csv" 
$csvOutput | Out-File $csvOutputPath
```

#### <a name="upload-the-hierarchy"></a>Загрузка иерархии

```powershell
Set-TeamTargetingHierarchy -FilePath $csvOutputPath
Get-TeamTargetingHierarchyStatus
```

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="how-to-view-error-details"></a>Просмотр сведений об ошибке

Чтобы понять, что вызывает ошибку, и получить сведения об ошибке, можно выполнить следующую команду:

```powershell
(Get-TeamTargetingHierarchyStatus).ErrorDetails.ErrorMessage
```

### <a name="you-receive-an-error-message-when-you-upload-your-schema-csv-file"></a>При отправке CSV-файла схемы вы получаете сообщение об ошибке

Обратите внимание на сообщение об ошибке, которое должно включать информацию об устранении неполадок, чтобы указать, почему не удалось отправить схему. Просмотрите и отредактйте CSV-файл схемы на основе сведений в сообщении об ошибке и попробуйте еще раз.

### <a name="you-receive-an-error-invalidteamid-error-message-when-you-upload-your-schema-csv-file"></a>При отправке CSV-файла схемы вы получаете сообщение об ошибке "Ошибка: InvalidTeamId"

При попытке отправить CSV-файл схемы вы получаете следующее сообщение об ошибке:

```console
Error: InvalidTeamId
Description: TeamID in row # doesn't match a valid Group ID. Please view our documentation to learn how to get the proper GroupID for each team.
```

Убедитесь, что в CSV-файле схемы используется правильный TeamId для команды. Он должен быть таким же, как и у группы Microsoft 365, который является backs-группой. Вы можете найти ИД группы в Центре администрирования Microsoft Teams.

1. В левой области навигации [Центра администрирования Microsoft Teams](https://admin.teams.microsoft.com/)перейдите в teams **Manage**  >  **teams.**
2. Если **столбец "ИД** группы" не отображается  в таблице, выберите "Изменить столбцы" в правом верхнем углу таблицы, а затем включит ИД **группы.**
3. Найдите группу в списке и найдите ее ИД.

Убедитесь, что CSV-файл TeamId в схеме соответствует ИД группы, который отображается в Центре администрирования Microsoft Teams.

## <a name="related-topics"></a>Статьи по теме

* [Приложение "Задачи" для организации в Teams](manage-tasks-app.md)
* [Обзор PowerShell в Teams](teams-powershell-overview.md)
