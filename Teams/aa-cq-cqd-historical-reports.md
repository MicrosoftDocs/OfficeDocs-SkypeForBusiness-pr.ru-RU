---
title: Обновленные отчеты об истории автосекретаря и очереди вызовов
author: DaniEASmith
ms.author: danismith
manager: serdars
ms.reviewer: colongma
ms.topic: article
ms.tgt.pltfrm: cloud
ms.service: msteams
ms.collection:
- M365-voice
search.appverid: MET150
audience: Admin
appliesto:
- Skype for Business
- Microsoft Teams
ms.localizationpriority: medium
f1.keywords:
- CSH
ms.custom:
- Reporting
- ms.teamsadmincenter.directrouting.cqd
- ms.lync.lac.ToolsCallQualityDashboard
description: Узнайте, как использовать обновленный отчет "Автосекретарь Teams" & отчета Power BI об истории очереди вызовов для просмотра исторических данных автосекретаря и очереди вызовов.
ms.openlocfilehash: dad1fa07d476aa5bcfa1e39818d9d7a01b7fdc56
ms.sourcegitcommit: 776820a6c927fafabdfad9f50654fe7648d77bf3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/20/2023
ms.locfileid: "69845916"
---
# <a name="auto-attendant-and-call-queue-historical-reports"></a>Отчеты об истории автосекретаря и очереди вызовов

>[!NOTE]
> Клиенты GCC HIgh и DOD должны продолжать использовать версию 1.63 [автосекретаря & исторические отчеты очереди вызовов (CQD).](aa-cq-cqd-historical-reports-v163.md)

Этот шаблон Power BI предоставляет три отчета, которые позволяют организациям сообщать о количестве вызовов, обрабатываемых автосекретарями и очередями звонков.  Он также предоставляет аналитические сведения о производительности агента.

## <a name="v305-published-on-january-9-2023"></a>Версия 3.0.5 опубликована 9 января 2023 г.

Шаблон Power BI "Автосекретарь Teams & очереди вызовов" предоставляет следующие три отчета:

- В отчете [Автосекретарь](media/aa-cq-historical-report-sample-aa-v305.png) отображается аналитика звонков, поступающих в автосекретаря.
- В отчете ["Очередь вызовов](media/aa-cq-historical-report-sample-cq-v305.png) " отображается аналитика звонков, поступающих в очереди звонков.
- В отчете ["Временная шкала агента"](media/aa-cq-historical-report-sample-at-v305.png) отображается представление временной шкалы агентов, активных в вызовах очереди вызовов.

В этих отчетах используются данные из службы "Сборщик аналитики голосовых приложений" (VAAC).

## <a name="v3xx-prerequisites"></a>Предварительные требования для V3.x.x

### <a name="power-bi-desktop"></a>Power BI Desktop

Необходимо установить Power BI Desktop. Вы можете установить и использовать бесплатную версию из [Microsoft Store.](https://aka.ms/pbidesktopstore)

Минимальная совместимая версия — 2.85.681.0 (сентябрь 2020 г.).

### <a name="permissions-to-access-the-cqd-pipeline"></a>Разрешения на доступ к конвейеру CQD

Хотя в этой версии отчетов не используется конвейер данных панели мониторинга качества звонков (CQD), учетная запись, используемая для просмотра исторических данных, по-прежнему требует доступа к панели мониторинга качества звонков. Дополнительные сведения см. в разделе [Роль доступа CQD](./turning-on-and-using-call-quality-dashboard.md#assign-admin-roles-for-access-to-cqd).

Любая роль CQD с полями **"Просмотр отчетов"** и **"Просмотр EUII****" будет работать**.

- Это требование будет удалено в будущем выпуске.

## <a name="v3xx-installation"></a>Установка V3.x.x 

В следующих шагах предполагается, что вы уже установили Power BI Desktop на компьютере и что у вашей учетной записи есть необходимые разрешения для доступа к конвейеру данных CQD.

Выполните следующие действия.

1. Скачайте и сохраните файл [журналов отчетов об очереди вызовов & Teams V3.0.5.zip](https://www.microsoft.com/download/details.aspx?id=104623) на компьютере.

2. Откройте ZIP-файл.

3. `Teams Auto Attendant & Call Queue Historical Reports V3.0.5.pbit` Откройте файл шаблона. Power BI Desktop должно запуститься.

4. Вам будет предложено выбрать **источник данных**.  `api.interfaces.records.teams.microsoft.com` Выберите запись.

  :::image type="content" source="media/aa-cq-historical-report-01-v305.png" alt-text="Снимок экрана: выбор api.interfaces.records.teams.microsoft.com Data Soure":::

5. Вам будет предложено войти с помощью учетной записи. Выберите **Учетная запись организации**, а затем — **Войти**.

  :::image type="content" source="media/aa-cq-historical-report-03-v300.png" alt-text="Снимок экрана: вход для версии 3.0.0.":::

6. Выберите **Подключиться**, и данные обновятся.

> [!NOTE]
> Если вы использовали версию 1.63 или более раннюю версию, может возникнуть ошибка при попытке v3.x.x получить данные из VAAC.  Чтобы устранить эту ошибку, необходимо удалить все предыдущие учетные данные из Power BI.
> 
> 1. Откройте шаблон v3.x.x.x, чтобы удалить ошибку. 
> 1. Выберите **Параметры файла** > **& Параметры** > **Параметры Источника данных**.
> 1. Выберите раскрывающийся список **Очистить разрешения**, а затем выберите **Очистить все разрешения**.
> 1. Закройте шаблон после его очистки и перезапустите Power BI. Вам будет предложено авторизоваться еще раз. 

## <a name="data-latency-for-auto-attendant-and-call-queue-analytics"></a>Задержка данных для автосекретаря и аналитики очередей вызовов

Данные обычно доступны в течение 30 минут после завершения вызова; однако бывают случаи, когда на появление данных может потребоваться несколько часов. 

Вам потребуется обновить данные, чтобы увидеть новые данные.

## <a name="auto-attendant-and-call-queue-historical-reports-definitions"></a>Определения журналов отчетов автосекретаря и очереди вызовов

### <a name="cloud-auto-attendant-analytics-report"></a>Отчет аналитики облачного автосекретаря

#### <a name="report-description"></a>Описание отчета

|Раздел отчета                          |Описание                                                       |
|:---------------------------------------|:-----------------------------------------------------------------|
|Источник входящих вызовов                    |Распределение вызовов по внутреннему или внешнему источнику вызовов            |
|Метод поиска в каталоге                 |Распределение вызовов по типу поиска                              |
|Количество действий вызывающего объекта                     |Распределение вызовов по числу действий, используемых во время вызова       |
|Среднее значение секунд в AA                   |Среднее количество секунд, в течение которых абоненты проводят в AA                 |
|Средние действия вызывающего абонента                  |Среднее число действий, выполняемых вызывающими в AA               |
|Результаты вызова                            |Распределение вызовов по состоянию конечного вызова                         |
|Нижний раздел отчета                 |Разбивка потока вызовов                                               |

#### <a name="report-visual-and-field-mapping"></a>Сопоставление визуальных элементов и полей отчета

|Вкладка "Отчет"            |Имя таблицы отчета     |Глобальный фильтр                          |
|:---------------------|:---------------------|:--------------------------------------|
|Автосекретаря        |fAutoAttendant        |Нет                                   |

|Раздел отчета                               |Используемые поля                                                                                    |Примененные фильтры |
|:--------------------------------------------|:------------------------------------------------------------------------------------------------|:----------|
|Селектор даты                                |AAStartTime                                                                                      |Нет       |
|Селектор диапазона времени                          |AAStartHour                                                                                      |Нет       |
|Учетные записи ресурсов автосекретаря             |Имя AA                                                                                          |Нет       |
|Источник входящих вызовов                         |Тип вызова<br>Сумма totalCallCount         |Внешние вызовы: тип вызова — external<br>Внутренние вызовы: тип вызова — internal |
|Метод поиска в каталоге                      |AADirectorySearchMethod<br>AADirectorySearchMethodLegend<br>TotalCallCount  |AADirectorySearchMethod является abs_search_dtmf или abs_search_name    |
|Количество действий вызывающего объекта                          |AACallerActionCount<br>TotalCallCount                                                            |Нет       |
|Среднее значение секунд в AA                        |AAChainDuration                                                                                  |Нет       |
|Средние действия вызывающего абонента                       |AACallerActionCount                                                                              |Нет       |
|Результаты вызова                                 |AACallResult<br>AACallResultLegend<br>TotalCallCount                                             |Нет       |
|Нижний раздел отчета                      |ММ-ДД<br>Имя AA<br>AACallFlow<br>Тип вызова<br>AACallResult<br>TotalCallCount<br>AAChainDuration |Нет       |

#### <a name="fautoattendant-field-description"></a>Описание поля fAutoAttendant

|Имя                                    |Тип данных                |Описание                            |
|:---------------------------------------|:------------------------|:--------------------------------------|
|Имя AA                                 |Текст                     |Имя учетной записи ресурса, присоединенной к автосекретарю<br><br>Если полное имя учетной записи ресурса **aa_test@microsoft.com**, то это значение будет следующим: **aa_test** |
|Время начала AA в формате UTC                       |Дата и время                |Время начала вызова автосекретаря — UTC                                                     |
|AACallerActionCount                     |Целое число             |Суммирование: Сумма<br>Количество действий, выбранных вызывающим в автосекретаре во время вызова  |
|AACallerActionCount (Measure)           |Целое число             |То же, что и AACallerActionCount, кроме того, будет иметь значение 0, если нет вызовов вместо пустых                |
|AACallFlow                              |Текст                     |См. раздел Измерения автосекретаря -> AutoAttendantCallFlow                                   |
|AACallResult                            |Текст                     |См. раздел Измерения автосекретаря -> AutoAttendantCallResult                                 |
|AACallResultLegend                      |Текст                     |Настройка элементов условных обозначений на основе AACallResult                                               |
|AAChainDuration                         |Десятичное число           |Суммирование: Сумма<br>Длительность вызова в автосекретаре                                     |
|AAChainDuration (Measure)               |Десятичное число           |То же, что и AAChainDuration, за исключением, будет иметь значение 0, если нет вызовов вместо пустых                    |
|AAChainIndex                            |Целое число             |                                                                                         |
|AAConnectivityType                      |Текст                     |См. общие измерения -> PSTNConnectivityType.                                            |
|AACount                                 |Целое число             |Количество автосекретарей, участвующих в вызове                                               |
|AADirectorySearchMethod                 |Текст                     |См. раздел Измерения автосекретаря -> AutoAttendantDirectorySearchMethod                      |
|AADirectorySearchMethodLegend           |Текст                     |Настройка элементов условных обозначений на основе AADirectorySearchMethod                                    |
|AAStartHour                             |Целое число             |Час начала вызова автосекретаря                                                           |
|AAStartTime                             |Дата и время                |Время начала вызова автосекретаря                                                           |
|AATransferAction                        |Текст                     |См. раздел Измерения автосекретаря - > AutoAttendantTransferAction                             |
|Длительность звонка в секундах                   |Целое число             |Длительность звонка                                                                            |
|Локальное время окончания звонка                     |Дата и время                |Время окончания вызова — локальная (на основе часового пояса компьютера, работающего в отчете)                    |
|Время окончания звонка в формате UTC                       |Дата и время                |Время окончания вызова — UTC                                                                      |
|Локальное время начала звонка                   |Дата и время                |Время начала вызова — локальная (на основе часового пояса запущенного компьютера)                  |
|Время начала звонка в формате UTC                     |Дата и время                |Время начала звонка — UTC                                                                    |
|Тип вызова<sup>1</sup>                   |Текст                     |См. общие измерения -> PSTNCallType.                                                    |
|ConferenceID                            |Текст                     |Используется для устранения неполадок — укажите эти сведения при открытии билета.       |
|DialogID                                |Текст                     |Используется для устранения неполадок — укажите эти сведения при открытии билета.       |
|DocumentID                              |Текст                     |Используется для устранения неполадок — укажите эти сведения при открытии билета.       |
|ММ-ДД                                   |Текст                     |Вызов автосекретаря месяц-день                                                            |
|PSTNMinutes                             |Целое число             |Суммирование: Сумма<br>Общее использование минут                                                     |
|Сумма totalCallCount (Measure)         |Целое число             |То же самое, что и TotalCallCount, но будет иметь значение 0, если нет вызовов вместо пустых                     |
|TotalCallCount                          |Целое число             |Суммирование: Сумма<br>Всегда 1 — используется для предоставления суммы всех вызовов                            |


### <a name="cloud-call-queue-analytics-report"></a>Отчет аналитики очереди вызовов в облаке

#### <a name="report-description"></a>Описание отчета

|Раздел отчета                          |Описание                                                        |
|:---------------------------------------|:------------------------------------------------------------------|
|Источник входящих вызовов                    |Распределение вызовов по внутреннему или внешнему источнику вызовов             |
|Среднее время ожидания (в секундах)             |Время ожидания ответов и отмененных вызовов                         |
|Количество звонков и количество согласия агента      |Распределение вызовов по очередям вызовов / Максимальное число согласия агента  |
|Результаты вызова                            |Распределение вызовов по результату вызова                               |
|Отмененные вызовы                         |Распределение отмененных вызовов по очередям вызовов                     |
|Средняя продолжительность сеанса (в секундах)        |Длительность вызова в секундах сгруппирована по результату вызова                      |
|Назначения переполнения и времени ожидания вызовов      |Распределение вызовов, которые истекли или переполнены                 |


#### <a name="report-visual-and-field-mapping"></a>Сопоставление визуальных элементов и полей отчета

|Вкладка "Отчет"            |Имя таблицы отчета                                   |Глобальный фильтр       |
|:---------------------|:---------------------------------------------------|:-------------------|
|Очередь вызовов            |fCallQueueAnalytics<br>fCallQueueFinalStateAction   |Нет                |

|Раздел отчета                      |Используемые поля таблицы >                |Примененные фильтры       |
|:-----------------------------------|:-------------------------------------|:---------------------|
|Селектор даты                       |fCallQueueAnalytics -> дата           |Нет                  |
|Селектор диапазона времени                 |fCallQueueAnalytics -> CQHour         |Нет                  |
|Учетная запись ресурса очереди вызовов         |fCallQueueAnalytics -> имя CQ        |Нет                  |
|Источник входящих вызовов                |fCallQueueAnalytics -> сумма количества вызовов (мера)  |Внешние вызовы: тип вызова — external<br>Внутренние вызовы: тип вызова — internal |
|Среднее время ожидания (в секундах) — до ответа |fCallQueueFinalStateAction -> среднее среднее значение средней длительности CQ (measure) |Результат вызова очереди звонков agent_joined_conference или transferred_to_agent|
|Среднее время ожидания (в секундах) — до отмены |fCallQueueFinalStateAction -> среднее среднее время вызова (мера) |Результат вызова очереди вызовов не agent_joined_conference, transferred_to_agent, переполнен, timed_out |
|Число Opt-In вызовов и Opt-In агента   |fCallQueueAnalytics -> число вызовов<br>fCallQueueAnalytics -> число согласия агента очереди вызовов<br>fCallQueueAnalytics -> имя CQ<br>fCallQueueAnalytics -> дата |Нет |
|Отмененные вызовы                     |fCallQueueAnalytics -> дата<br>fCallQueueAnalytics -> TotalCallCount | Условные обозначения результата вызова очереди вызовов отброшены |
|Средняя продолжительность сеанса (в секундах)    |fCallQueueFinalStateAction -> средняя длительность очереди звонков (с)<br>Условные обозначения результата вызова очереди вызовов |Средняя длительность очереди звонков (с) > 0 |
|Назначения переполнения и времени ожидания вызовов  |fCallQueueAnalytics -> число вызовов<br>Тип целевого объекта очереди вызовов fCallQueueAnalytics -><br>Условные обозначения целевого типа fCallQueue |Условные обозначения целевого типа очереди вызовов не содержат отказов и ответ агента |


#### <a name="fcallqueueanalytics-field-description"></a>Описание поля fCallQueueAnalytics

|Имя                                    |Тип данных                |Описание                                                                              |
|:---------------------------------------|:------------------------|:----------------------------------------------------------------------------------------|
|Число вызовов                              |Целое число             |Суммирование: Сумма<br>Число звонков                                                        |
|Длительность звонка в секундах                   |Целое число             |Длительность звонка                                                                            |
|Локальное время окончания звонка                     |Дата и время                |Время окончания вызова — локальная (на основе часового пояса компьютера, работающего в отчете)                    |
|Время окончания звонка в формате UTC                       |Дата и время                |Время окончания вызова — UTC                                                                      |
|Число агентов очереди вызовов                  |Целое число             |Суммирование: Сумма<br>Число агентов, настроенных в очереди вызовов                          |
|Количество согласия агента очереди вызовов           |Целое число             |Суммирование: Сумма<br>Количество агентов, согласились на очередь вызовов                            |
|Результат вызова очереди вызовов                  |Текст                     |См. раздел Измерения очереди вызовов - > CallQueueCallResult                                         |
|Условные обозначения результата вызова очереди вызовов           |Текст                     |Настройка элементов условных обозначений на основе результата очереди вызовов                                          |
|Тип целевого объекта очереди вызовов                  |Текст                     |См. раздел Измерения очереди вызовов - > CallQueueTargetType                                         |
|Условные обозначения типа целевого объекта очереди вызовов           |Текст                     |Настройка элементов условных обозначений на основе типа целевого объекта очереди вызовов                                     |
|Локальное время начала звонка                   |Дата и время                |Время начала вызова — локальная (на основе часового пояса запущенного компьютера)                  |
|Время начала звонка в формате UTC                     |Дата и время                |Время начала звонка — UTC                                                                    |
|Тип вызова                               |Текст                     |См. общие измерения -> PSTNCallType.                                                    |
|ConferenceID                            |Текст                     |Используется для устранения неполадок — укажите эти сведения при открытии билета.       |
|Имя CQ                                 |Текст                     |Имя учетной записи ресурса, присоединенной к очереди вызовов<br><br>Если полное имя учетной записи ресурса **cq_test@microsoft.com**, то это значение будет следующим: **cq_test** |
|Час CQ                                 |Целое число             |Час начала вызова очереди звонков                                                               |
|Дата                                    |Дата и время                |Дата и время начала вызова очереди вызовов (час)                                               | 
|DateTimeCQName                          |Текст                     |Уникальный ключ для фильтрации в fCallQueueFinalStateAction                                   |
|DialogID                                |Текст                     |Используется для устранения неполадок — укажите эти сведения при открытии билета.       |
|DocumentID                              |Текст                     |Используется для устранения неполадок — укажите эти сведения при открытии билета.       |
|Тип подключения ТСОП                  |Текст                     |См. общие измерения -> PSTNConnectivityType.                                            |
|Общее количество минут ТСОП                      |Целое число             |Суммирование: Сумма<br>Общее использование минут для вызовов ТСОП                                     |
|Сумма количества вызовов (мера)             |Целое число             |То же самое, что и число вызовов, однако будет равно 0, если вызов отсутствует                                        |
|TotalCallCount (Measure)                |Целое число             |Суммирование: Сумма<br>Число вызовов                                                             |


#### <a name="fcallqueuefinalstateaction-field-description"></a>Описание поля fCallQueueFinalStateAction

|Имя                                    |Тип данных                |Описание                                                                |
|:---------------------------------------|:------------------------|:--------------------------------------------------------------------------|
|Средняя длительность вызова (в секундах)         |Десятичное число           |Суммирование: Сумма<br>Средняя длительность вызова в секундах для отмененных вызовов     |
|Средняя длительность очереди звонков (с)       |Десятичное число           |Суммирование: Сумма<br>Среднее время ожидания в секундах для ответов на звонки       |
|Среднее значение средней продолжительности звонка (мера)  |Целое число             |То же самое, что и средняя длительность звонка (в секундах), однако будет равно 0, если вызовы отсутствуют    |
|Среднее значение средней продолжительности CQ (мера)    |Целое число             |То же самое, что и средняя длительность очереди звонков (с), однако будет равно 0, если вызовы отсутствуют.  |
|Число вызовов                              |Целое число             |Суммирование: Сумма<br>Число звонков                                          |
|Результат вызова очереди вызовов                  |Текст                     |См. раздел Измерения очереди вызовов - > CallQueueCallResult                           |
|Условные обозначения результата вызова очереди вызовов           |Текст                     |Настройка элементов условных обозначений на основе результата вызова очереди вызовов                       |
|Действие конечного состояния очереди вызовов           |Текст                     |См. раздел Измерения очереди вызовов - > CallQueueFinaleStateAction                    |
|Имя CQ                                 |Текст                     |Имя учетной записи ресурса, присоединенной к очереди вызовов<br><br>Если полное имя учетной записи ресурса **cq_test@microsoft.com**, то это значение будет следующим: **cq_test** |
|Час CQ                                 |Число                   |Час, в который состоялся звонок
|Дата                                    |Дата и время                |Дата и время начала вызова очереди вызовов (час)                                 |
|DateTimeCQName                          |Текст                     |Уникальный ключ для фильтрации в fCallQueueFinalStateAction                     |
|IsAbandoned                             |Значение true/false               |Значение true, если агент не ответил на вызов                                    |


### <a name="cloud-call-queue-agent-timeline-report"></a>Отчет о временной шкале агента очереди вызовов в облаке

#### <a name="report-description"></a>Описание отчета

|Раздел отчета                                          |Описание                                                         |
|:-------------------------------------------------------|:-------------------------------------------------------------------|
|Количество вызовов по агенту                                |Распределение вызовов по очереди вызовов и агенту                       |
|Распределение по агенту и всем очередям                     |Распределение вызовов по агенту и очереди вызовов                       |
|Таблица (внизу слева)                                     |Распределение вызовов по агенту со средней и общей длительностью вызова |
|Средняя длительность вызова (в секундах) по агенту (справа внизу) |Средняя длительность (в секундах) вызова по агенту                         |

#### <a name="report-visual-field-mapping"></a>Сопоставление визуального поля отчета

|Вкладка "Отчет"            |Имя таблицы отчета           |Глобальный фильтр       |
|:---------------------|:---------------------------|:-------------------|
|Временная шкала агента        |fAgentTimelineAnalytics     |Нет                |


|Раздел отчета                                |Используемые поля                         |Примененные фильтры       |
|:---------------------------------------------|:-------------------------------------|:---------------------|
|Селектор даты                                 |Datetime                              |Нет                  |
|Селектор имени агента                       |Имя агента                            |Нет                  |
|Селектор учетных записей ресурсов очереди вызовов         |Имя CQ                               |Нет                  |
|Количество вызовов по агенту                      |Число вызовов<br>Имя агента<br>Дата<br>Hour      |Нет                  |
|Распределение по агенту и очереди вызовов          |Имя агента<br>Средняя длительность вызовов (в секундах)<br>Число вызовов<br>Имя CQ |Нет                      |
|Нижний левый                                   |Имя агента<br>Средняя длительность вызова (в секундах)<br>Число вызовов<br>Длительность звонка (минута)<br>Имя CQ<br>Hour<br>ММ-ДД | Нет |
|Средняя длительность вызова (в секундах) по агенту      |Имя агента<br>Средняя длительность вызова (в секундах) | Нет |

#### <a name="fagenttimelineanalytics-field-description"></a>Описание поля fAgentTimelineAnalytics

|Имя                                    |Тип данных                |Описание                                         |
|:---------------------------------------|:------------------------|:---------------------------------------------------|
|Имя агента                              |Текст                     |Имя участника-пользователя<br>Если полное имя пользователя — **user@microsoft.com**, это значение будет: **user** |
|Средняя длительность вызова (в секундах)         |Десятичное число           |Суммирование: Сумма<br>Средняя продолжительность вызовов очереди ответов в секундах |
|Длительность звонка (в минутах)                 |Целое число             |Суммирование: Сумма<br>Общая продолжительность звонков в очереди вызовов с ответами в минутах (округляется до ближайшей минуты)  |
|Ответы на звонки                          |Целое число             |Количество вызовов, на которые отвечает агент                        |
|Звонки не ответили                      |Целое число             |Количество вызовов, на которые агент не ответил                    |
|Имя CQ                                 |Текст                     |Имя учетной записи ресурса, присоединенной к очереди вызовов<br><br>Если полное имя учетной записи ресурса **cq_test@microsoft.com**, то это значение будет следующим: **cq_test** |
|Дата                                    |Дата                     |Дата звонка                                             |
|Datetime                                |Datetime                 |Дата звонка                                             |
|Hour                                    |Целое число             |Час звонка                                             |
|ММ-ДД                                   |Текст                     |Месяц и день звонка                                    |
|Общее число вызовов                        |Целое число             |Суммирование: Сумма<br>Количество вызовов, представленных агенту     |

> [!NOTE]
> При поступлении звонка в первую очередь звонков, если количество вызовов, уже ожидающих в этой очереди, достигло предела **обработки переполнения вызовов** и если параметр перенаправления отправляет новые вызовы во вторую очередь звонков, агенты во второй очереди вызовов будут отображаться как в первой очереди вызовов в этом отчете. 

## <a name="known-issues"></a>Известные проблемы

- Визуальный элемент **"Результаты звонков** " в отчете **"Очередь звонков"** может сообщать о большом количестве **_неизвестных_** вызовов. Это связано с проблемой классификации вызовов, которую служба поддержки работает над устранением.  Это только проблема классификации вызовов, и эти вызовы были успешно обработаны системой.

- Сообщается только о вызовах и действиях звонящего в первом автосекретаре или очереди вызовов, которые отвечают на вызов.  Вызовы и действия вызывающего абонента в связанных автосекретарях (когда один автосекретарь передает другому автосекретарю) или в цепочке очередей вызовов (когда одна очередь звонков передается в другую очередь вызовов) не сообщаются. 

- Очереди вызовов и автосекретари отображаются по идентификатору учетной записи ресурса вместо имен очередей вызовов или автосекретаря.  Чтобы отобразить весь трафик для автосекретаря или очереди вызовов, необходимо выбрать все учетные записи ресурсов, назначенные автосекретарю или очереди вызовов.

- На панели мониторинга доступно только 28 дней истории, так как данные очереди вызовов и автосекретаря считаются персональными данными и регулируются политиками конфиденциальности данных.

- В некоторых сценариях количество ответных вызовов агента на **временной шкале агента очереди облачных вызовов** может отличаться от количества вызовов, указанного в журнале вызовов клиента Teams. Журнал вызовов клиента Teams является правильным. Поддержка изучается, но в настоящее время не существует предполагаемого времени на восстановление.

## <a name="customization"></a>Настройки 

Вы можете настроить определенные аспекты визуализации отчетов, такие как добавление или удаление полей для отображения в различных визуализациях, изменение типа диаграммы и многое другое.

### <a name="change-color-schema"></a>Изменение цветовой схемы 

При выполнении следующих действий предполагается, что вы уже выполнили установку.

Выполните следующие действия.

1. Выберите **вкладку Вид** на ленте.

  :::image type="content" source="media/aa-cq-historical-report-04.png" alt-text="Снимок экрана: выбор вкладки представления для изменения цветовой схемы.":::

2. Выберите цветовую схему в раскрывающемся списке.

  :::image type="content" source="media/aa-cq-historical-report-05.png" alt-text="Снимок экрана: различные цветовые схемы.":::
  
## <a name="dimensions-and-measurements"></a>Измерения и измерения

Доступны следующие измерения и измерения.

### <a name="common-dimensions"></a>Общие измерения

Эти измерения являются общими для автосекретарей и очередей вызовов:

|Имя (тип)                                            |Возможные значения                |Описание                                                       |
|:------------------------------------------------------|:------------------------------|:-----------------------------------------------------------------|
|ConferenceId<br>(Текст)                                 |Глобальный уникальный идентификатор (GUID)                           |Идентификатор вызова                                                   |
|Дата<br>(DateTime)                                     |                               |Дата звонка (UTC)                                                |
|DialogId<br>(Текст)                                     |Глобальный уникальный идентификатор (GUID)                           |Идентификатор вызова                                                   |
|DocumentId<br>(Текст)                                   |Глобальный уникальный идентификатор (GUID)                           |Идентификатор вызова                                                   |
|Duration (Длительность)<br>(Целое число)                             |                               |Длительность вызова в секундах                                      |
|EndTime<br>(DateTime)                                  |                               |Время окончания вызова (UTC)                                             |
|FirstIsCaller<br>(Логическое значение)                             |                               |[Классификация первой и второй конечных точек](dimensions-and-measures-available-in-call-quality-dashboard.md)     |
|FirstUPN<br>(Текст)                                     |                               |Имя участника-пользователя (UPN) пользователя первой конечной точки        |
|Hour<br>(Текст)                                         |                               |Часовой звонок запущен (UTC)                                           |
|Minute<br>(Текст)                                       |                               |Минутный звонок запущен (UTC)                                         |
|PSTNCallDuration<br>(Целое число)                     |                               |Длительность вызова                                              |
|PSTNCallType<br>(Текст)                                 |                               |                                                                  |
|                                                       |Внешняя                       |Вызов поступает извне клиента                            |
|                                                       |Internal                       |Вызов поступает из клиента                             |
|PSTNConnectivityType<sup>1</sup><br>(Текст)             |                               |                                                                  |
|                                                       |CallingPlan                    |                                                                  |
|                                                       |DirectRouting                  |                                                                  |
|Второй<br>(Текст)                                       |                               |Второй вызов запущен (UTC)                                         |
|SecondUPN<br>(Текст)                                    |                               |Имя участника-пользователя (UPN) пользователя второй конечной точки       |
|Идентификатор клиента<br>(Текст)                                     |                               |Идентификатор клиента                                                         |
|Timestamp<br>(DateTime)                                |                               |Запись времени была написана (UTC)                                     |
|UserStartTimeUTC<br>(DateTime)                         |                               |Время начала вызова (UTC)                                           |

- <sup>1</sup> **PSTNConnectivityType** будет отображать последний источник этапа вызова, а не исходный источник этапа вызова. Например, если автосекретарь получает внешний вызов и передает его другому автосекретарю или очереди вызовов, **источник входящих звонков** будет сообщаться как **внутренний**.


### <a name="auto-attendant-dimensions"></a>Измерения автосекретаря

|Имя (тип)                                            |Возможные значения                |Описание                                                       |
|:------------------------------------------------------|:------------------------------|:-----------------------------------------------------------------|
|AutoAttendantCallFlow<br>(Текст)                        |                               |Инкапсулирует различные состояния вызова автосекретаря          |
|                                                       |abs_search                     |                                                                  |
|                                                       |Объявление                   |                                                                  |
|                                                       |automatic_menu                 |                                                                  |
|                                                       |call_termination               |                                                                  |
|                                                       |call_transfer                  |                                                                  |
|                                                       |first_level_menu               |                                                                  |
|                                                       |main_menu                      |                                                                  |
|                                                       |speech_input_confirmation      |                                                                  |
|                                                       |user_selection                 |                                                                  |
|AutoAttendantCallResult<br>(Текст)                      |                               |Окончательный результат вызова                                                 |
|                                                       |failed_to_establish_media      |Не удалось установить медиа-часть звонка             |
|                                                       |failover_to_operator           |Вызов, передаваемый оператору, как правило, из-за системной ошибки      |
|                                                       |oaa_chain_too_long             |Слишком много ног в АА                                           |
|                                                       |oaa_session_too_long           |Сеанс AA длился слишком долго                                    |
|                                                       |service_declined               |AA не принял звонок                                         |
|                                                       |service_terminated             |Конфигурация AA отключает вызов или завис вызов             |
|                                                       |terminated_automatic_selection |Конфигурация AA отключает вызовы                           |
|                                                       |terminated_no_operator         |Все завершены из-за ошибки, оператор не определен                   |
|                                                       |terminated_transfer_failed     |Вызов завершен из-за сбоя передачи — обычно на внешний номер |
|                                                       |transfer_in_progress           |Передача AA->AA                                                   |
|                                                       |transferred_to_operator        |Вызов передан оператору                                  |
|                                                       |transferred_to_cq              |Звонок был перемещен в очередь вызовов                                |
|                                                       |transferred_to_receptionist    |То же, что и transferred_to_operator                                   |
|                                                       |transferred_to_self            |Вызов был возвращен в начало AA                          |
|                                                       |transferred_to_shared_voicemail |Звонок был перемещен на общую голосовую почту                         |
|                                                       |transferred_to_user            |Звонок был передан пользователю                                    |
|                                                       |Неизвестный                        |Произошло неизвестное условие                                 |
|                                                       |user_terminated                |Вызывающий повесил трубку                                                    |
|AutoAttendantCallerActionCounts<br>(Целое число)      |                               |                                                                  |
|AutoAttendantChainDurationInSecs<br>(Реальное число)      |                               |                                                                  |
|AutoAttendantChainIndex<br>(Целое число)              |                               |                                                                  |
|AutoAttendantChainStartTime<br>(DateTime)              |                               |                                                                  |
|AutoAttendantCount<br>(Целое число)                   |                               |                                                                  |
|AutoAttendantDirectorySearchMethod<br>(Текст)           |                               |Метод поиска по каталогу                                           |
|                                                       |abs_search_dtmf                |Сенсорный тон                                                        |
|                                                       |abs_search_voice               |Голос                                                             |
|AutoAttendantIdentity<br>(Текст)                        |                               |Поступил вызов URI учетной записи ресурсов                              |
|AutoAttendantTransferAction<br>(Текст)                  |                               |Тип целевого объекта передачи вызовов                                         |
|                                                       |АА                             |Перенос в AA                                              |
|                                                       |CQ                             |Перенос в CQ                                               |
|                                                       |external_pstn                  |Перенос на внешний номер                                 |
|                                                       |общая голосовая почта               |Перенос в общую голосовую почту                                   |
|                                                       |Неизвестный                        |Неизвестное действие                                                    |
|HasAA<br>(Логическое значение)                                     |                               |Участвует ли AA в вызове                                            |


### <a name="call-queue-dimensions"></a>Измерения очереди вызовов

|Имя (тип)                                            |Возможные значения                |Описание                                                       |
|:------------------------------------------------------|:------------------------------|:-----------------------------------------------------------------|
|CallQueueAgentCount<br>(Целое число)                  |                               |Количество агентов в очереди звонков                                    |
|CallQueueAgentOptInCount<br>(Целое число)             |                               |Число агентов, согласились на очередь звонков                           |
|CallQueueCallResult<br>(Текст)                          |                               |Конечное состояние вызова очереди вызовов                                       |
|                                                       |agent_joined_conference        |Ответ на звонок — CQ в режиме конференции                                |
|                                                       |Отказался                       |                                                                  |
|                                                       |Отключен                   |                                                                  |
|                                                       |error                          |                                                                  |
|                                                       |Сбой при                         |                                                                  |
|                                                       |Недопустимый                        |                                                                  |
|                                                       |переполнение                      |Выполнено условие переполнения                                            |
|                                                       |timed_out                      |Условие ожидания выполнено                                             |
|                                                       |transferred_to_agent           |Ответ на вызов — CQ в режиме передачи                                  |
|CallQueueDurationSeconds<br>(Реальное число)              |                               |Длительность вызова в очереди вызовов                                   |
|CallQueueFinaleStateAction<br>(Текст)                   |                               |Окончательное действие очереди вызовов                                           |
|                                                       |Отключите                     |time_out вызовы                                                    |
|                                                       |disconnect_with_busy           |переполненные вызовы                                                   |
|                                                       |failed_to_accept_call          |                                                                  |
|                                                       |Вперед                        |Вызов перенаправлен пользователю или извне                        |
|                                                       |shared_voicemail               |Звонок отправлен на общую голосовую почту                                 |
|                                                       |Других                          |                                                                  |
|                                                       |Голосовую почту                      |                                                                  |
|CallQueueIdentity<br>(Текст)                            |                               |Поступил вызов URI учетной записи ресурсов                              |
|CallQueueTargetType<br>(Текст)                          |                               |Целевой объект перенаправления вызовов                                           |
|                                                       |ApplicationEndpoint            |                                                                  |
|                                                       |почтовый ящик.                        |                                                                  |
|                                                       |Other                          |                                                                  |
|                                                       |Телефон                          |                                                                  |
|                                                       |Пользователь                           |                                                                  |
|HasCQ<br>(Логическое значение)                                     |                               |Участвует ли CQ в вызове                                            |
|TransferredFromCallQueueIdentity<br>(Текст)             |                               |                                                                  |

### <a name="measurements"></a>Измерения

|Имя (тип)                                            |Возможные значения                |Описание                                                       |
|:------------------------------------------------------|:------------------------------|:-----------------------------------------------------------------|
|AvgAutoAttendantChainDurationSeconds<br>(Реальное число)  |                               |                                                                  |
|AvgCallDuration<br>(Реальное число)                       |                               |                                                                  |
|AvgCallQueueDurationSeconds<br>(Реальное число)           |                               |                                                                  |
|PSTNTotalMinutes<br>(Реальное число)                      |                               |                                                                  |
|TotalAudioStreamDuration<br>(Реальное число)              |                               |                                                                  |
|TotalCallCount<br>(Целое число)                       |                               |                                                                  |

### <a name="constructing-a-valid-query"></a>Создание допустимого запроса

Допустимый запрос состоит из нескольких атрибутов в объекте JSON:

```json
{
   "Filters":[
      {
         "DataModelName":"Date",
         "Value":"2022-04-01",
         "Operand":4
      },
      {
         "DataModelName":"Date",
         "Value":"2022-04-30",
         "Operand":6
      }
   ],
   "Dimensions":[
      {
         "DataModelName":"AutoAttendantIdentity"
      },
      {
         "DataModelName":"AutoAttendantDirectorySearchMethod"
      }
   ],
   "Measurements":[
      {
         "DataModelName":"PSTNTotalMinutes"
      },
      {
         "DataModelName":"TotalCallCount"
      }
   ],
   "Parameters":{
      "UserAgent":"Power BI Desktop"
   },
   "LimitResultRowsCount":100000
}
```

#### <a name="required-fields"></a>Обязательные поля

- Фильтры: используются для фильтрации данных, возвращаемых VAAC
- - DataModelName должен быть одним из поддерживаемых измерений
- - Значение должно быть в правильном формате (datetime, string, number и т. д.)
- - Операндов:
- - - 0 — равно
- - - 1 — не равно
- - - 2 . Содержит
- - - 3 . Начинается с
- - - 4 - Больше чем
- - - 5 — больше или равно
- - - 6 — меньше, чем
- - - 7 — меньше или равно
- - - 8 — не содержит
- - - 9 — не начинается с

- Размеры:
- - DataModelName должен быть одним из поддерживаемых измерений

- Измерения:
- - DataModelName должен быть одним из поддерживаемых измерений.

- Параметры: в настоящее время поддерживается только UserAgent.

- LimitResultRowsCount: максимальное число строк, возвращаемых VAAC.

## <a name="accessing-vaac-outside-of-power-bi"></a>Доступ к VAAC за пределами Power BI

Доступ к API VAAC может получить любое приложение, которое может получить доступ к приложениям RESTful.  В приведенном ниже примере будет использоваться [Postman](https://www.postman.com/) .

### <a name="preparation"></a>Подготовка

1. Скачайте [Postman](https://www.postman.com/).
1. Распакуйте `sync_pstn_avs-analytics.zip` файл в [скачанных инструкциях по ZIP-файлу](#v3xx-installation).
1. Импортируйте папку в Postman. 

:::image type="content" source="media/aa-cq-historical-report-postman-01.png" alt-text="Снимок экрана: импорт завершен":::

### <a name="accessing-vaac-using-postman"></a>Доступ к VAAC с помощью Postman

1. Выберите **VAAC — msit** в верхнем правом раскрывающемся **_списке Нет среды_** .
2. Выберите **Среды** в меню слева.
3. Выберите **VAAC — msit** в разделе **Глобальные**.
4. Замените **userName**, **password** и **tenantId** соответствующими учетными данными.
5. Щелкните **Сбросить все** в правом верхнем углу.
6. Нажмите кнопку **Сохранить**.

:::image type="content" source="media/aa-cq-historical-report-postman-02.png" alt-text="Снимок экрана: настроенные поля имени пользователя, пароля и идентификатора клиента":::

7. Выберите **Коллекции** в меню слева.
8. Выберите **Config API Access Token — Prod** и перейдите на вкладку **Текст** .
9. Нажмите кнопку **Отправить**.

Будет возвращен маркер доступа.

:::image type="content" source="media/aa-cq-historical-report-postman-03.png" alt-text="Снимок экрана: результат с возвращенным маркером доступа":::

Если маркер доступа не возвращается, проверьте учетные данные, чтобы они имели [достаточные разрешения](#permissions-to-access-the-cqd-pipeline).

10. Выберите **VAAC ConfigAPI Prod** и перейдите на вкладку **Params (Параметры** ).

- [Сжатие](#compress-the-json-query) запроса, как описано ниже
- [URL-адрес кодирует](#url-encode-the-compressed-json-query) сжатый результат, как описано ниже

11. Заполните строку [запроса](#constructing-a-valid-query) .
12. Нажмите кнопку **Отправить**.

### <a name="reading-the-result"></a>Чтение результата

После отправки входных данных появится несколько возможных результатов:

- Если входные данные недопустимы, будет возвращено сообщение об ошибке с фактической причиной.
- Если входные данные допустимы, результат будет выглядеть следующим образом:

:::image type="content" source="media/aa-cq-historical-report-postman-04.png" alt-text="Снимок экрана: результат запроса с полем dataResult":::

В этом случае данные будут находиться в поле dataResult в том же порядке, что и в атрибутах измерения запроса и измерений.

### <a name="compress-the-json-query"></a>Сжатие запроса JSON

API VAAC принимает в качестве входных данных только строки в кодировке GZip или Base64.

Найдите любой веб-сайт для сжатия большого двоичного объекта JSON с помощью GZIP или Base64.

- GZIP: (https://www.multiutil.com/text-to-gzip-compress/)
- Base64: (https://www.multiutil.com/text-to-base64-converter/)

Выходные данные GZIP должны выглядеть следующим образом:
````
H4sIAAAAAAAACq2SQWsCMRCF7/6KkLNC3EoPe9u6FISuFbW9lB4GM9TQbEaSCSLif+9mV4uCBwXnMkze5L0vkH1PCCFfjWX0QeZfaWxqf+xJLIGhIo12CjXKPM0o+2cLn2BjEjKVZQM1Gqjhhfy+QQ9Oy3x0PDz0H5HypK6nPJ9SUv9uV2RpanTBkLvxiUVkKpjRaXA80ejY8E7eg3/hUBqPKya/WyD41bpCXpP+tzvjrBBC9NjA8o2ks8VyuiQGWxkXGcNdkO3FMVg7puj4GtAMfLPa/Y2Tk/wI6IufhjHl0xa9eJmIEsMv06Y16cLlm6kNzzFEy3Pahi4kH6pUvcMfrAhUU3oCAAA=
````

Выходные данные Base64 должны выглядеть следующим образом:
````
ew==
IkZpbHRlcnMiOls=
ew==
IkRhdGFNb2RlbE5hbWUiOiJEYXRlIiw=
IlZhbHVlIjoiMjAyMi0wNC0wMSIs
Ik9wZXJhbmQiOjQ=
fSw=
ew==
IkRhdGFNb2RlbE5hbWUiOiJEYXRlIiw=
IlZhbHVlIjoiMjAyMi0wNC0zMCIs
Ik9wZXJhbmQiOjY=
fQ==
XSw=
IkRpbWVuc2lvbnMiOls=
ew==
IkRhdGFNb2RlbE5hbWUiOiJBdXRvQXR0ZW5kYW50SWRlbnRpdHki
fSw=
ew==
IkRhdGFNb2RlbE5hbWUiOiJBdXRvQXR0ZW5kYW50RGlyZWN0b3J5U2VhcmNoTWV0aG9kIg==
fQ==
XSw=
Ik1lYXN1cmVtZW50cyI6Ww==
ew==
IkRhdGFNb2RlbE5hbWUiOiJQU1ROVG90YWxNaW51dGVzIg==
fSw=
ew==
IkRhdGFNb2RlbE5hbWUiOiJUb3RhbENhbGxDb3VudCI=
fQ==
XSw=
IlBhcmFtZXRlcnMiOns=
IlVzZXJBZ2VudCI6IlBvd2VyIEJJIERlc2t0b3Ai
fSw=
IkxpbWl0UmVzdWx0Um93c0NvdW50IjoxMDAwMDA=
fQ==
````

### <a name="url-encode-the-compressed-json-query"></a>URL-Encode сжатый запрос JSON

Сжатый запрос JSON GZIP или Base64 должен быть [закодирован в формате URL-адреса](https://meyerweb.com/eric/tools/dencoder/).

Выходные данные в кодировке URL-адреса GZIP будут выглядеть следующим образом:
````
H4sIAAAAAAAACq2SQWsCMRCF7%2F6KkLNC3EoPe9u6FISuFbW9lB4GM9TQbEaSCSLif%2B9mV4uCBwXnMkze5L0vkH1PCCFfjWX0QeZfaWxqf%2BxJLIGhIo12CjXKPM0o%2B2cLn2BjEjKVZQM1Gqjhhfy%2BQQ9Oy3x0PDz0H5HypK6nPJ9SUv9uV2RpanTBkLvxiUVkKpjRaXA80ejY8E7eg3%2FhUBqPKya%2FWyD41bpCXpP%2BtzvjrBBC9NjA8o2ks8VyuiQGWxkXGcNdkO3FMVg7puj4GtAMfLPa%2FY2Tk%2FwI6IufhjHl0xa9eJmIEsMv06Y16cLlm6kNzzFEy3Pahi4kH6pUvcMfrAhUU3oCAAA%3D
````

Выходные данные в кодировке BASE64 URL будут выглядеть следующим образом:
````
%0Aew%3D%3D%0AIkZpbHRlcnMiOls%3D%0Aew%3D%3D%0AIkRhdGFNb2RlbE5hbWUiOiJEYXRlIiw%3D%0AIlZhbHVlIjoiMjAyMi0wNC0wMSIs%0AIk9wZXJhbmQiOjQ%3D%0AfSw%3D%0Aew%3D%3D%0AIkRhdGFNb2RlbE5hbWUiOiJEYXRlIiw%3D%0AIlZhbHVlIjoiMjAyMi0wNC0zMCIs%0AIk9wZXJhbmQiOjY%3D%0AfQ%3D%3D%0AXSw%3D%0AIkRpbWVuc2lvbnMiOls%3D%0Aew%3D%3D%0AIkRhdGFNb2RlbE5hbWUiOiJBdXRvQXR0ZW5kYW50SWRlbnRpdHki%0AfSw%3D%0Aew%3D%3D%0AIkRhdGFNb2RlbE5hbWUiOiJBdXRvQXR0ZW5kYW50RGlyZWN0b3J5U2VhcmNoTWV0aG9kIg%3D%3D%0AfQ%3D%3D%0AXSw%3D%0AIk1lYXN1cmVtZW50cyI6Ww%3D%3D%0Aew%3D%3D%0AIkRhdGFNb2RlbE5hbWUiOiJQU1ROVG90YWxNaW51dGVzIg%3D%3D%0AfSw%3D%0Aew%3D%3D%0AIkRhdGFNb2RlbE5hbWUiOiJUb3RhbENhbGxDb3VudCI%3D%0AfQ%3D%3D%0AXSw%3D%0AIlBhcmFtZXRlcnMiOns%3D%0AIlVzZXJBZ2VudCI6IlBvd2VyIEJJIERlc2t0b3Ai%0AfSw%3D%0AIkxpbWl0UmVzdWx0Um93c0NvdW50IjoxMDAwMDA%3D%0AfQ%3D%3D
````

## <a name="version-3xx-history"></a>Журнал версии 3.x.x

Подробный список изменений см. в статье Автосекретарь Teams & журналы очередей вызовов — изменение Log.docx в скачанном ZIP-файле 

|Версия  |Дата публикации     |Имени файла                                                    |Описание                                                             |
|:--------|:------------------|:-----------------------------------------------------------|:-----------------------------------------------------------------------|
|3.0.5    |9 января 2023 г.    |Автосекретарь Teams & отчеты об истории очереди вызовов версии 3.0.5 |Улучшенные визуальные элементы временной шкалы агента и назначений переполнения вызовов и времени ожидания  |
|3.0.4    |18 ноября 2022 г.  |Автосекретарь Teams & отчеты об очереди вызовов версии 3.0.4 |Исправлена ошибка, улучшена классификация вызовов, добавлена легенда             |
|3.0.3    |8 ноября 2022 г.   |Автосекретарь Teams & исторические отчеты очереди вызовов версии 3.0.3 |Исправлена ошибка, добавлена ссылка на документацию, оптимизированные запросы            |
|3.0.1    |26 октября 2022 г.   |Автосекретарь Teams & исторические отчеты очереди вызовов версии 3.0.1 |Удалена запись источника данных тестирования                                       |
|3.0.0    |25 октября 2022 г.   |Автосекретарь Teams & отчеты об истории очереди вызовов версии 3.0.0 |Новый серверный источник данных                                                 |
