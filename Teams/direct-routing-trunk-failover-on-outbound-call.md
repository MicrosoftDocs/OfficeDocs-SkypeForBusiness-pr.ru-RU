---
title: Отработка отказа канала связи при исходящих звонках
ms.author: crowe
author: CarolynRowe
manager: serdars
audience: ITPro
ms.reviewer: NMuravlyannikov
ms.topic: article
ms.service: msteams
ms.localizationpriority: medium
search.appverid: MET150
ms.collection:
- M365-voice
appliesto:
- Microsoft Teams
f1.keywords:
- NOCSH
description: Прочтите этот раздел, чтобы узнать, как обрабатывать отработку отказа магистралей при исходящих вызовах из Teams к пограничному контроллеру сеансов (SBC).
ms.openlocfilehash: 0fa0d452a2611874be570f4e80a746bb07da0163
ms.sourcegitcommit: d7a86b3a72005764c18acb60eedf5163523ffae3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2022
ms.locfileid: "67457139"
---
# <a name="trunk-failover-on-outbound-calls"></a>Отработка отказа канала связи при исходящих звонках

В этом разделе описывается, как избежать отработки отказа магистралей при исходящих звонках — от Teams до пограничного контроллера сеансов (SBC).

## <a name="failover-on-network-errors"></a>Отработка отказа при ошибках сети

Если магистраль не может быть подключена по какой-либо причине, подключение к той же магистрали будет предпринята из другого центра обработки данных Майкрософт. Центр обработки данных может находиться в другом географическом регионе, за пределами текущего. Магистраль может не быть подключена, если отказано в подключении, если истекло время ожидания TLS или есть другие проблемы на уровне сети.

Например, подключение может завершиться сбоем, если администратор ограничивает доступ к SBC только с известных IP-адресов, но забудет поместить IP-адреса всех центров обработки данных Прямой маршрутизации Майкрософт в список контроль доступа (ACL) SBC. 

## <a name="failover-of-specific-sip-codes-received-from-the-session-border-controller-sbc"></a>Отработка отказа определенных кодов SIP, полученных от пограничного контроллера сеансов (SBC)

Если прямая маршрутизация получает коды ошибок SIP 4xx или 6xx в ответ на исходящее приглашение, вызов считается завершенным по умолчанию. Исходящий трафик означает вызов клиента Teams в общедоступную телефонную сеть (ТСОП) со следующим потоком трафика: Клиент Teams -> Прямая маршрутизация -> SBC -> Телефонная сеть.

Список кодов SIP можно найти в [RFC протокола Инициации сеанса (SIP](https://tools.ietf.org/html/rfc3261)).

Предположим, что SBC ответил на входящее приглашение с кодом "408 Request Timeout: The server couldn't produce a response within asuitable amount of time, for example, if it couldn't determine the location of the user in time. Клиент может повторить запрос без внесения изменений в любой последующий момент".

У этого конкретного SBC могут возникнуть проблемы с подключением к вызываемому объекту, например из-за неправильной конфигурации сети или другой ошибки. Однако в маршруте есть еще один SBC, который может получить доступ к вызываемому объекту.

На следующей схеме, когда пользователь выполняет звонок на номер телефона, в маршруте есть два контроллера SBC, которые могут доставить этот звонок. Изначально SBC1.contoso.com для вызова, но SBC1.contoso.com не удается подключиться к сети ТСОП из-за проблемы с сетью.
По умолчанию вызов будет завершен в данный момент. 
 
![Схема, показывающая, что SBC не удается подключиться к ТСОП из-за проблемы с сетью.](media/direct-routing-failover-response-codes1.png)

В маршруте есть еще один SBC, который потенциально может доставить звонок.
Если вы настроите параметр `Set-CSOnlinePSTNGateway -Identity sbc1.contoso.com -FailoverResponseCodes "408"`, будет предпринята вторая попытка SBC (SBC2.contoso.com на следующей схеме):

![Схема, показывающая маршрутизацию на второй SBC.](media/direct-routing-failover-response-codes2.png)

Задание параметра -FailoverResponseCodes и указание кодов помогает точно настроить маршрутизацию и избежать потенциальных проблем, когда SBC не может выполнить вызов из-за сетевых или других проблем.

Значения по умолчанию: 408, 503, 504

