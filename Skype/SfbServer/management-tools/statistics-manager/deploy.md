---
title: Развертывание диспетчера статистики в Skype для бизнеса Server
ms.reviewer: ''
ms.author: serdars
author: SerdarSoysal
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.collection: IT_Skype16
ms.assetid: 37b2bb9c-c5d4-4fb0-a976-670b7594b82f
description: Сводка. Ознакомьтесь с этой статьей, чтобы узнать, как развернуть диспетчер статистики для Skype для бизнеса Server.
ms.openlocfilehash: 1debe0c38b3e3df0b6be193e892991c09e15fb61
ms.sourcegitcommit: 296862e02b548f0212c9c70504e65b467d459cc3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/25/2022
ms.locfileid: "65675991"
---
# <a name="deploy-statistics-manager-for-skype-for-business-server"></a>Развертывание диспетчера статистики в Skype для бизнеса Server

**Сводка:** Ознакомьтесь с этой статьей, чтобы узнать, как развернуть диспетчер статистики для Skype для бизнеса Server.

 Диспетчер статистики для Skype для бизнеса Server — это мощное средство, которое позволяет просматривать Skype для бизнеса Server работоспособности и производительности в режиме реального времени. Вы можете опрашивать данные о производительности на нескольких сотнях серверов каждые несколько секунд и мгновенно просматривать результаты на веб-сайте диспетчера статистики.

Прежде чем пытаться установить Диспетчер статистики, убедитесь, что вы знакомы с требованиями к программному обеспечению, сети и оборудованию. Дополнительные сведения см. в [разделе Plan for Statistics Manager for Skype для бизнеса Server](plan.md).

> [!NOTE]
> Если выполняется обновление с предыдущей версии Диспетчера статистики, см. сведения об обновлении диспетчера статистики для [Skype для бизнеса Server](upgrade.md).

> [!NOTE]
> Веб-сайт диспетчера статистики протестен и работает правильно в Internet Explorer 11+, Edge 20.10240+ и Chrome 46+ (текущая версия evergreen).

Диспетчер статистики можно скачать по адресу [https://aka.ms/StatsManDownload](https://aka.ms/StatsManDownload).

Этот раздел содержит следующие разделы:

- [Развертывание диспетчера статистики](deploy.md#BKMK_Deploy)

- [Устранение неполадок развертывания](deploy.md#BKMK_Troubleshoot)

- [Создание самозаверяющего сертификата](deploy.md#BKMK_SelfCert)

## <a name="deploy-statistics-manager"></a>Развертывание диспетчера статистики
<a name="BKMK_Deploy"> </a>

Чтобы развернуть диспетчер статистики, выполните следующие действия.

1. Подготовьте хост-компьютер прослушивателя, установите систему кэширования Redis в памяти и убедитесь, что установлены соответствующие сертификаты.

2. Установите службу прослушивателя на хост-компьютере.

3. Установите веб-сайт на хост-компьютере.

4. Установите агент на каждом Skype для бизнеса Server компьютере, который вы хотите отслеживать.

5. Импортируйте топологию для отслеживаемого сервера.

> [!NOTE]
> Redis, служба прослушивателя и веб-сайт должны быть установлены на одном хост-компьютере. Убедитесь, что на хост-компьютере Skype для бизнеса Server установлено.

### <a name="prepare-the-listener-host-machine"></a>Подготовка хост-компьютера прослушивателя

Чтобы подготовить хост-компьютер, необходимо установить систему кэширования Redis в памяти и убедиться, что на компьютере установлен действительный сертификат. Корпорация Майкрософт рекомендует установить последнюю стабильную сборку Redis 3.0. Диспетчер статистики версии 2.0 протестировать с redis 3.2.100.

1. Скачайте Redis со следующего сайта: [https://github.com/MSOpenTech/redis](https://github.com/MSOpenTech/redis).

    Неподписанный установщик можно скачать из [https://github.com/MSOpenTech/redis/releases](https://github.com/MSOpenTech/redis/releases)

    Подписанные двоичные файлы доступны через популярные диспетчеры пакетов: [Nuget](https://www.nuget.org/packages/Redis-64/) и [Choclatey](https://chocolatey.org/packages/redis-64).

   - Запустите предоставленный msi и следуйте инструкциям.

   - Не установите флажок, чтобы добавить правило брандмауэра.

2. Службе прослушивателя требуется сертификат. Корпорация Майкрософт настоятельно рекомендует иметь сертификат, подписанный доверенным центром сертификации.

    Если вы хотите использовать самозаверяющий сертификат (например, для тестирования в лаборатории), см. статью "Создание самозаверяющего [сертификата"](deploy.md#BKMK_SelfCert).

    Агент использует проверку отпечатка сертификата (вместо проверки цепочки). Он не будет выполнять полную проверку сертификатов, так как можно использовать самозаверяющие сертификаты.

### <a name="install-the-listener-service"></a>Установка службы прослушивателя

Установите службу прослушивателя на хост-компьютере, запустив StatsManPerfAgentListener.msi и указав следующее:

1. Просмотрите лицензионное соглашение и, если вы согласны, выберите "Я принимаю условия лицензионного **соглашения" и** нажмите кнопку " **Далее"**.

2. На следующей странице укажите следующие сведения:

   - **Пароль службы:** Этот пароль используется удаленными агентами для проверки подлинности в службе прослушивателя.

   - **Порт службы:** Этот номер порта HTTPS используется прослушивателем для обмена данными с агентами. Во время установки этот порт будет разрешен через локальный брандмауэр, будет создан ACL URL- и SSL-сертификат будет привязан к этому порту. Значение по умолчанию — 8443.

   - **Отпечаток сертификата:** Этот сертификат используется прослушивателем для шифрования протокола HTTPS. Сетевая служба должна иметь доступ на чтение к закрытому ключу.

     Нажмите **кнопку "Выбрать...** ", чтобы выбрать отпечаток.

     Отпечаток сертификата можно найти с помощью диспетчера сертификатов или с помощью следующей команды PowerShell:

      ```PowerShell
      Get-ChildItem -path cert:\LocalMachine\My
      ```

   - **Установите Dir:** В этом каталоге будут установлены двоичные файлы. Вы можете изменить его по умолчанию с помощью кнопки **"Обзор** ...".

   - **Каталог AppData:** В этом каталоге будет храниться папка Logs и другие данные. Его можно изменить по умолчанию. Он не будет удален при удалении.

3. Нажмите **Установить**.

Чтобы проверить установку, выполните следующие действия.

1. Откройте браузер и перейдите по адресу `https://localhost:<service-port>/healthcheck/`

    По умолчанию порт службы — 8443 (если вы не указали другой порт).

2. Чтобы убедиться, что прослушиватель установлен правильно, найдите следующее:

   - Если отображается страница проверки работоспособности, установка прослушивателя прошла успешно.

   - Если значение KnownServerCount равно 1 или выше, устанавливается подключение к Redis.

   - Подождите несколько минут, а после установки хотя бы одного агента убедитесь, что счетчик ValuesWritten увеличивается.

### <a name="install-the-website"></a>Установка веб-сайта

Установите веб-сайт на хост-компьютере, запустив StatsManWebSite.msi (входит в [Skype для бизнеса Server, Real-Time Statistics Manager (64-разрядная версия)](https://www.microsoft.com/download/details.aspx?id=57518)):

1. Просмотрите лицензионное соглашение и, если вы согласны, выберите "Я принимаю условия лицензионного **соглашения" и** нажмите кнопку " **Далее"**.

2. На следующей странице укажите следующие сведения:

   - **Порт службы:** Этот TCP-порт будет прослушивать веб-сайт. Его можно изменить позже с помощью привязки диспетчера IIS. Во время установки этот порт будет разрешен через локальный брандмауэр.

   - **Установите Dir:** В этом каталоге будут установлены двоичные файлы. Вы можете изменить его по умолчанию с помощью кнопки **"Обзор** ...".

   - **Каталог AppData:** В этом каталоге будет храниться папка Logs и другие данные. Его можно изменить по умолчанию. Он не будет удален при удалении.

3. Нажмите **Установить**.

Чтобы просмотреть веб-сайт, откройте браузер и перейдите к следующему разделу. `http://<localhost:webport/>`

Чтобы просмотреть только сведения о работоспособности, откройте браузер и перейдите к: `http://localhost:<webport>/healthcheck/`.

По умолчанию номер веб-порта — 8080. Привязку порта веб-сайта можно изменить с помощью диспетчера IIS.

Веб-установщик добавляет локальную группу безопасности с именем StatsManWebSiteUsers. Вы можете добавить учетные записи в эту группу безопасности, чтобы предоставить доступ к веб-сайту.

### <a name="install-the-agents"></a>Установка агентов

Установите агент на каждом Skype для бизнеса Server, который вы хотите отслеживать, запустив StatsManPerfAgent.msi:

1. Просмотрите лицензионное соглашение и, если вы согласны, выберите "Я принимаю условия лицензионного **соглашения" и** нажмите кнопку " **Далее"**.

2. На следующей странице укажите следующие сведения:

   - **Пароль службы:** Этот пароль используется удаленным агентом для проверки подлинности в службе прослушивателя.

   - **URI службы:** В этом URL-адресе находится прослушиватель. Используйте формат `https://name:port` .

     Можно использовать netBIOS-имя или полное доменное имя. Вы можете использовать имя, которое также указано в качестве альтернативного  имени субъекта или субъекта сертификата в службе прослушивателя, но это не является требованием.

   - **Отпечаток службы:** Этот SS: сертификат используется прослушивателем. Агент будет использовать этот отпечаток для проверки подлинности прослушивателя. Он не будет выполнять полную проверку сертификатов, так как можно использовать самозаверяющие сертификаты.

   - **Установите Dir:** В этом каталоге будут установлены двоичные файлы. Вы можете изменить его по умолчанию с помощью кнопки **"Обзор** ...".

   - **Каталог AppData:** В этом каталоге будут храниться папка Logs и зашифрованный password.txt файл. Вы можете благодарить за изменение значения по умолчанию. Он не будет удален при удалении.

3. Нажмите **Установить**.

При установке агента на множество компьютеров, вероятно, потребуется сделать это в автоматическом режиме. Например:

```console
msiexec /l install.log /i StatsManPerfAgent.msi SERVICE_THUMBPRINT=<thumbprint> SERVICE_PASSWORD=<password> SERVICE_URI=https://<hostname>:<servicePort>/[INSTALLDIR=<directory>][DIR_STATSMANAPPDATA=<directory>]
```

### <a name="import-the-topology"></a>Импорт топологии
<a name="BKMK_ImportTopology"> </a>

После установки и запуска диспетчера статистики необходимо импортировать топологию Skype для бизнеса Server, чтобы диспетчер статистики знал сайт, пул и роль каждого сервера. Чтобы импортировать топологию Skype для бизнеса Server, используйте командлет [Get-CsPool](/powershell/module/skype/get-cspool) для получения сведений о каждом пуле, используемом в организации, а затем импортируйте эти сведения в Диспетчер статистики.

Чтобы импортировать топологию Skype для бизнеса Server, выполните следующие действия.

1. На узле с Skype для бизнеса Server командлетами PowerShell:

    а. Выполните следующую команду:

   ```PowerShell
   Get-CsPool | Export-Clixml -Path mypoolinfo.xml
   ```

    б. Скопируйте файл mypoolinfo.xml на сервер, на котором выполняется прослушиватель.

2. На узле, на котором выполняется прослушиватель:

   а. Запустите PowerShell.

   б. Перейдите в каталог, в котором установлен прослушиватель. Значение по умолчанию:

   ```console
   cd C:\Program Files\Skype for Business Server StatsMan Listener
   ```

3. Чтобы проверить, какие серверы добавляются и обновляются, выполните следующую команду:

   ```console
   .\Update-StatsManServerInfo.ps1 -CsPoolFile  <path to mypoolinfo.xml>
   ```

С помощью следующей команды можно просмотреть все параметры:

```powershell
Get-Help .\Update-StatsManServerInfo.ps1 -Detailed
```

Чтобы просмотреть данные импортированного сервера, выполните следующий сценарий:

```powershell
.\Get-StatsManServerInfo.ps1
```

Если вы хотите отслеживать серверы, которые не находятся в топологии Skype для бизнеса Server ( например, Exchange Server), можно выполнить импорт с одним сервером на узле, на котором выполняется прослушиватель. Чтобы выполнить импорт с одним сервером, выполните следующие действия.

1. Перейдите в каталог, в котором установлен прослушиватель. Значение по умолчанию:

   ```console
   cd C:\Program Files\Skype for Business Server StatsMan Listener
   ```

2. Выполните следующую команду:

   ```powershell
   .\Update-StatsManServerInfo.ps1 -HostName <hostname> -SiteName <name of site> -PoolName <poolName> -Roles <role1>[,<role2>,<roleN>]
   ```

## <a name="troubleshoot-your-deployment"></a>Устранение неполадок развертывания
<a name="BKMK_Troubleshoot"> </a>

Если агент не запускается, проверьте наличие следующих проблем:

- Зарегистрирован ли агент в диспетчере статистики?

   1. Убедитесь, что вы выполнили инструкции по импорту топологии. См [. раздел "Импорт топологии"](deploy.md#BKMK_ImportTopology).

   2. Если агент находится на сервере, который не указан в топологии (например, узлы в кластере SQL AlwaysOn), необходимо добавить агент вручную, следуя инструкциям в разделе "Импорт топологии[".](deploy.md#BKMK_ImportTopology)

- Может ли агент связаться с прослушивателем?

   1. Убедитесь, что служба прослушивателя запущена.

      Если он не запущен, убедитесь, что Redis запущен, а затем попробуйте перезапустить прослушиватель.

   2. Убедитесь, что порт открыт для службы прослушивателя и что компьютер агента может взаимодействовать с портом.

- Чтобы убедиться, что диспетчер статистики собирает данные, можно проверить CSV-файл следующим образом.

    Следующую команду извлекает имена хранилища счетчиков:

  ```console
  .\PerfAgentStorageManager.exe -redis=localhost -a=listcounterstoragenames -mode=verbose | findstr /i processor
  ```

    Следующая команда извлекает значения для указанных счетчиков:

  ```console
  .\PerfAgentStorageManager.exe -redis=localhost -a=getcountervalues  -counter="\\*\Processor Information\% Processor Time_Mean_Mean\_Total" -file:all-processor.csv
  ```

Сведения обо всех событиях, которые могут отображаться в журнале событий приложения, см. в разделе «Устранение неполадок диспетчера статистики для [Skype для бизнеса Server.](troubleshoot.md)

## <a name="create-a-self-signed-certificate"></a>Создание самозаверяющего сертификата
<a name="BKMK_SelfCert"> </a>

Корпорация Майкрософт настоятельно рекомендует использовать сертификат, подписанный доверенным центром сертификации. Однако если вы хотите использовать самозаверяющий сертификат для тестирования, выполните следующие действия.

1. В консоли PowerShell во время входа от имени администратора выполните следующую команду:

   ```powershell
   New-SelfSignedCertificate -DnsName StatsManListener -CertStoreLocation Cert:\LocalMachine\My
   ```

2. Введите .`certlm.msc` Откроется диспетчер сертификатов для локального компьютера.

3. Перейдите в **раздел "** Личные", а затем **откройте раздел "Сертификаты"**.

4. Щелкните правой кнопкой **мыши StatsManListener — \> "Все задачи— управление \>закрытыми ключами"...**

5. Нажмите **Добавить**.

6. В поле **"Ввод имен объектов для выбора** " введите следующий текст: "Сетевая служба".

7. Нажмите кнопку **ОК**.

8. В **разделе "Полный доступ**" снимите флажок **"Разрешить** ". (Требуется только доступ на чтение.)

9. Нажмите кнопку **ОК**.

## <a name="for-more-information"></a>Дополнительные сведения
<a name="BKMK_SelfCert"> </a>

Дополнительную информацию см. в следующих статьях:

- [Планирование диспетчера статистики в Skype для бизнеса Server](plan.md)

- [Обновление диспетчера статистики в Skype для бизнеса Server](upgrade.md)

- [Устранение проблем диспетчера статистики в Skype для бизнеса Server](troubleshoot.md)
