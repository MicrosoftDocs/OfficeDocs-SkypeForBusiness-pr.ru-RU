---
title: Развертывание диспетчера статистики в Skype для бизнеса Server
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.collection: IT_Skype16
ms.assetid: 37b2bb9c-c5d4-4fb0-a976-670b7594b82f
description: Сводка. Ознакомьтесь с этой темой, чтобы узнать, как развернуть диспетчер статистики для Skype для бизнеса Server.
ms.openlocfilehash: 966d6aa71eff93f616ae0eb1a7443aebab600016
ms.sourcegitcommit: 556fffc96729150efcc04cd5d6069c402012421e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "58612098"
---
# <a name="deploy-statistics-manager-for-skype-for-business-server"></a>Развертывание диспетчера статистики в Skype для бизнеса Server
 
**Сводка:** Ознакомьтесь с этой темой, чтобы узнать, как развернуть диспетчер статистики для Skype для бизнеса Server.
  
 Диспетчер статистики для Skype для бизнеса Server — это мощный инструмент, позволяющий просматривать данные о Skype для бизнеса Server работоспособности и производительности в режиме реального времени. Вы можете просматривать данные о производительности на сотнях серверов каждые несколько секунд и мгновенно просматривать результаты на веб-сайте диспетчера статистики.
  
Прежде чем пытаться установить Диспетчер статистики, убедитесь, что вы знакомы с требованиями программного обеспечения, сетей и оборудования. Дополнительные сведения см. в [проекте Plan for Statistics Manager for Skype для бизнеса Server.](plan.md)
  
> [!NOTE]
> Если вы обновляете предыдущую версию диспетчера статистики, см. в [Skype для бизнеса Server.](upgrade.md) 
  
> [!NOTE]
> Веб-сайт диспетчера статистики был протестирован и работает правильно в Internet Explorer 11+, Edge 20.10240+ и Chrome 46+ (текущая вечнозеленая версия). 
  
Вы можете найти диспетчер статистики, загружаемый по [https://aka.ms/StatsManDownload](https://aka.ms/StatsManDownload) ссылке . 
  
В этом разделе содержатся следующие разделы:
  
- [Диспетчер развертывания статистики](deploy.md#BKMK_Deploy)
    
- [Устранение неполадок при развертывании](deploy.md#BKMK_Troubleshoot)
    
- [Создание самозаверяемого сертификата](deploy.md#BKMK_SelfCert)
    
## <a name="deploy-statistics-manager"></a>Диспетчер развертывания статистики
<a name="BKMK_Deploy"> </a>

Чтобы развернуть диспетчер статистики, выполните следующие действия:
  
1. Подготовка хост-машины для прослушивания, установив систему кэшинга Redis в памяти и убедившись, что вы установили соответствующие сертификаты.
    
2. Установите службу прослушиватель на хост-машине. 
    
3. Установите веб-сайт на хост-машине.
    
4. Установите агент на каждый Skype для бизнеса Server, который вы хотите отслеживать.
    
5. Импорт топологии для отслеживаемого сервера.
    
> [!NOTE]
> Redis, служба прослушиватель и веб-сайт должны быть установлены на одной и той же хост-машине. Убедитесь, что на компьютере-Skype для бизнеса Server установлена система. 
  
### <a name="prepare-the-listener-host-machine"></a>Подготовка хост-машины слушателя

Чтобы подготовить хост-машину, необходимо установить систему кэшинга Redis в памяти и убедиться, что на компьютере имеется действительный сертификат. Корпорация Майкрософт рекомендует установить последнюю стабильную сборку Redis 3.0. Диспетчер статистики версии 2.0 был протестирован с помощью Redis 3.2.100. 
  
1. Скачайте Redis со следующего сайта: [https://github.com/MSOpenTech/redis](https://github.com/MSOpenTech/redis) . 
    
    Неподписаные установщики можно скачать из [https://github.com/MSOpenTech/redis/releases](https://github.com/MSOpenTech/redis/releases)
    
    При необходимости подписанные биналоги доступны через популярных менеджеров пакетов: [Nuget](https://www.nuget.org/packages/Redis-64/) и [Choclatey.](https://chocolatey.org/packages/redis-64)
    
   - Запустите предоставленные msi и следуйте подсказкам.
    
   - Не проверяйте поле, чтобы добавить правило брандмауэра.
    
2. Для службы "Прослушиватель" требуется сертификат. Корпорация Майкрософт настоятельно рекомендует иметь сертификат, подписанный доверенным органом сертификата. 
    
    Если вы хотите использовать самозаверяемый сертификат для тестирования в лаборатории, например, см. в справке [Create a self-signed.](deploy.md#BKMK_SelfCert)
    
    Обратите внимание, что агент использует проверку отпечатков пальцев сертификата (вместо проверки цепочки). Он не будет делать полную проверку сертификата, так как можно использовать самозаверяемые сертификаты.
    
### <a name="install-the-listener-service"></a>Установка службы прослушиватель

Установите службу listener на хост-компьютере, StatsManPerfAgentListener.msi и укажите следующее:
  
1. Просмотрите лицензионный договор, и если вы согласны, выберите я **принимаю** условия лицензионного соглашения, а затем нажмите **кнопку Далее**. 
    
2. На следующей странице укажите следующие сведения:
    
   - **Пароль службы:** Это пароль, который удаленные агенты будут использовать для проверки подлинности службы прослушиватель.
    
   - **Порт службы:** Это номер порта HTTPS, который прослушиватель будет использовать для связи с агентами. Во время установки этот порт будет разрешен через локальный брандмауэр, будет создан URL-адрес ACL и к этому порту будет привязан сертификат SSL. По умолчанию — 8443.
    
   - **Отпечатки сертификатов:** Это отпечатки сертификатов, которые прослушиватель будет использовать для шифрования протокола HTTPS. Служба сети должна иметь доступ к частному ключу для чтения.
    
     Нажмите **кнопку Выберите ...**
    
     Отпечатки пальцев сертификата можно найти с помощью диспетчера сертификатов или с помощью следующей команды PowerShell:
    
       ```PowerShell
       Get-ChildItem -path cert:\LocalMachine\My
       ```

   - **Установка Dir:** Это каталог, в котором будут установлены биналоги. Вы можете изменить его по умолчанию с помощью кнопки **Просмотр...**
    
   - **Dir AppData:** Это каталог, в котором будут храниться папка журналов и другие данные. Вы можете изменить его по умолчанию. Он не будет удален на удалении.
    
3. Нажмите **Установить**.
    
Чтобы проверить установку, выполните следующие действия:
  
1. Откройте браузер и перейдите в https://localhost: \<service-port\> /healthcheck/
    
    По умолчанию порт службы составляет 8443 (если только вы не указали другой порт).
    
2. Чтобы обеспечить правильное установку прослушиватель, необходимо найти следующее:
    
   - Если страница healthcheck появляется, установка listener была успешной.
    
   - Если в knownServerCount 1 или выше установлено подключение к Redis.
    
   - После ожидания нескольких минут и после установки хотя бы одного агента убедитесь, что счетчик ValuesWritten приращен.
    
### <a name="install-the-website"></a>Установка веб-сайта

Установите веб-сайт на хост-машину, StatsManWebSite.msi (включив Skype для бизнеса Server, Real-Time Диспетчер статистики [(64-битный)](https://www.microsoft.com/en-in/download/details.aspx?id=57518)и укажите следующее:
  
1. Просмотрите лицензионный договор, и если вы согласны, выберите я **принимаю** условия лицензионного соглашения, а затем нажмите **кнопку Далее**. 
    
2. На следующей странице укажите следующие сведения:
    
   - **Порт службы:** Это номер порта, на который будет прослушиваться веб-сайт. Вы можете изменить его позже с помощью привязки диспетчера IIS. Во время установки этот порт будет разрешен через локальный брандмауэр.
    
   - **Установка Dir:** Это каталог, в котором будут установлены binaries. Вы можете изменить его по умолчанию с помощью кнопки **Просмотр...**
    
   - **Dir AppData:** Это каталог, в котором будут храниться папка журналов и другие данные. Вы можете изменить его по умолчанию. Он не будет удален на удалении.
    
3. Нажмите **Установить**.
    
Чтобы просмотреть веб-сайт, откройте браузер и перейдите по: http://localhost ,webport \> /.
  
Чтобы просмотреть только сведения о состоянии здоровья, откройте браузер и перейдите по: http://localhost: \<webport\> /healthcheck/.
  
По умолчанию номер веб-порта — 8080. Вы можете изменить привязку порта веб-сайта с помощью диспетчера IIS.
  
Веб-установщик добавляет локализованную группу безопасности под названием StatsManWebSiteUsers. Вы можете добавить учетные записи в эту группу безопасности, чтобы предоставить доступ к веб-сайту. 
  
### <a name="install-the-agents"></a>Установка агентов

Установите агент на каждый Skype для бизнеса Server, который вы хотите отслеживать, запуская StatsManPerfAgent.msi и указав следующее:
  
1. Просмотрите лицензионный договор, и если вы согласны, выберите я **принимаю** условия лицензионного соглашения, а затем нажмите **кнопку Далее**. 
    
2. На следующей странице укажите следующие сведения:
    
   - **Пароль службы:** Это пароль, который будет использовать удаленный агент для проверки подлинности службы прослушиватель.
    
   - **Служба URI:** Это URI, в котором находится слушатель. Он должен использовать https://name:port формат.
    
     Можно использовать имя NETBIOS или FQDN. Вы можете использовать имя, которое также  указывается как тема или альтернативные имена субъекта сертификата в службе прослушиватель, но это не является требованием. 
    
   - **Thumbprint службы:** Это отпечатки пальцев сертификата SSL, который используется слушателем. Агент будет использовать этот отпечатки пальцев для проверки подлинности для слушателя. (Он не будет делать полную проверку сертификата, так как можно использовать самозаверяемые сертификаты.)
    
   - **Установка Dir:** Это каталог, в котором будут установлены биналоги. Вы можете изменить его по умолчанию с помощью кнопки **Просмотр...**
    
   - **Dir AppData:** Это каталог, в котором будут храниться папка Журналы и зашифрованный password.txt файл. Вы можете изменить его по умолчанию. Он не будет удален на удалении.
    
3. Нажмите **Установить**.
    
Если вы устанавливаете агент на многочисленных машинах, вы, вероятно, захотите сделать это в без присмотра режиме. Например, 
  
```console
msiexec /l install.log /i StatsManPerfAgent.msi SERVICE_THUMBPRINT=<thumbprint> SERVICE_PASSWORD=<password> SERVICE_URI=https://<hostname>:<servicePort>/[INSTALLDIR=<directory>][DIR_  STATSMANAPPDATA=<directory>]
```

### <a name="import-the-topology"></a>Импорт топологии
<a name="BKMK_ImportTopology"> </a>

После установки и запуска диспетчера статистики необходимо импортировать топологию Skype для бизнеса Server, чтобы диспетчер статистики знал сайт, пул и роль каждого сервера. Чтобы импортировать топологию Skype для бизнеса Server, для получения сведений о каждом пуле, используемом в организации, вы будете использовать команды [Get-CsPool,](/powershell/module/skype/get-cspool?view=skype-ps) а затем импортировать эти сведения в Диспетчер статистики.
  
Чтобы импортировать топологию Skype для бизнеса Server, выполните следующие действия:
  
1. На хосте с Skype для бизнеса Server PowerShell:
    
    а. Выполните следующую команду: 
    
   ```PowerShell
   Get-CsPool | Export-Clixml -Path mypoolinfo.xml
   ```
    б. Скопируйте файл "mypoolinfo.xml" на сервер, на который выполняется прослушиватель.
    
2. На хосте, который запускает прослушиватель:
    
   а. Запустите PowerShell.
    
   б. Перейдите к каталогу, в котором установлен прослушиватель. По умолчанию: 
    
   ```console
   cd C:\Program Files\Skype for Business Server StatsMan Listener
   ```

3. Чтобы подтвердить, какие серверы добавляются и обновляются, запустите следующую команду:
    
   ```console
    .\Update-StatsManServerInfo.ps1 -CsPoolFile  <path to mypoolinfo.xml>
   ```

Следующая команда позволяет просматривать все параметры:
  
```powershell
Get-Help .\Update-StatsManServerInfo.ps1 -Detailed 
```

Чтобы увидеть импортируемые данные сервера, запустите следующий сценарий: 
  
```powershell
.\Get-StatsManServerInfo.ps1
```

Если вы хотите отслеживать серверы, которые не находятся в топологии Skype для бизнеса Server, например Exchange Server, можно импортировать один сервер на хосте, который запускает прослушиватель. Чтобы импортировать один сервер, выполните следующие действия:
  
1. Перейдите к каталогу, в котором установлен прослушиватель. По умолчанию: 
    
   ```console
   cd C:\Program Files\Skype for Business Server StatsMan Listener
   ```

2. Выполните следующую команду:
    
   ```powershell
    .\Update-StatsManServerInfo.ps1 -HostName <hostname> -SiteName <name of site> -PoolName <poolName> -Roles <role1>[,<role2>,<roleN>]
   ```

## <a name="troubleshoot-your-deployment"></a>Устранение неполадок при развертывании
<a name="BKMK_Troubleshoot"> </a>

Если агент не запустится, проверьте следующее: 
  
- Зарегистрирован ли агент в диспетчере статистики?
    
    1. Убедитесь, что вы следовали инструкциям по импорту топологии. См. [в этой ленте](deploy.md#BKMK_ImportTopology)Импорт топологии .
        
    2. Если агент находится на сервере, который не указан в топологии (например, узлы в кластере SQL AlwaysOn), необходимо добавить агента вручную, следуя инструкциям в [Импорт](deploy.md#BKMK_ImportTopology)топологии .
    
- Может ли агент связаться с слушателем?
    
    1. Убедитесь, что служба прослушиватель запущена. 
        
        Если он не запущен, убедитесь, что Redis запущен, а затем попробуйте перезапустить прослушиватель.
        
    2. Убедитесь, что порт открыт для службы прослушивания и что компьютер Agent может взаимодействовать с портом.
    
- Чтобы убедиться, что диспетчер статистики собирает данные, вы можете проверить файл CSV следующим образом. 
    
    Следующая команда извлекает имена счетчика хранения: 
    
  ```console
  .\PerfAgentStorageManager.exe -redis=localhost -a=listcounterstoragenames -mode=verbose | findstr /i processor
  ```

    Следующая команда извлекает значения для указанных счетчиков: 
    
  ```console
  .\PerfAgentStorageManager.exe -redis=localhost -a=getcountervalues  -counter="\\*\Processor Information\% Processor Time_Mean_Mean\_Total" -file:all-processor.csv
  ```

Сведения обо всех событиях, которые можно увидеть в журнале событий приложения, см. в журнале [Troubleshoot Statistics Manager for Skype для бизнеса Server.](troubleshoot.md)
  
## <a name="create-a-self-signed-certificate"></a>Создание самозаверяемого сертификата
<a name="BKMK_SelfCert"> </a>

Корпорация Майкрософт настоятельно рекомендует использовать сертификат, подписанный доверенным органом сертификата. Однако, если вы хотите использовать самозаверяется сертификат для тестирования, сделайте следующее: 
  
1. На консоли PowerShell во время входа в качестве администратора введите следующее:
    
   ```powershell
   New-SelfSignedCertificate -DnsName StatsManListener -CertStoreLocation Cert:\LocalMachine\My
   ```

2. Введите  `certlm.msc` . Это откроет диспетчер сертификатов для локальной машины.
    
3. Перейдите к **Персональным,** а затем откройте **сертификаты.**
    
4. Правой кнопкой мыши **на statsManListener- \> Все задачи- Управление \> закрытыми ключами ...**
    
5. Нажмите **Добавить**.
    
6. В **введите имена объектов, чтобы выбрать поле,** введите следующее: Network Service
    
7. Нажмите кнопку **ОК**.
    
8. Под **полным контролем** отойте проверку **допустимого** чека. (Необходим только доступ к считыву.)
    
9. Нажмите кнопку **ОК**.
    
## <a name="for-more-information"></a>Дополнительные сведения
<a name="BKMK_SelfCert"> </a>

Дополнительные сведения см. в указанных ниже статьях.
  
- [Планирование диспетчера статистики в Skype для бизнеса Server](plan.md)
    
- [Обновление диспетчера статистики в Skype для бизнеса Server](upgrade.md)
    
- [Диспетчер статистики устранения неполадок для Skype для бизнеса Server](troubleshoot.md) ß