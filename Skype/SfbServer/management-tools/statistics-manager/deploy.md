---
title: Развертывание диспетчера статистики в Skype для бизнеса Server 2015
ms.author: kenwith
author: kenwith
manager: serdars
ms.date: 2/9/2017
ms.audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 37b2bb9c-c5d4-4fb0-a976-670b7594b82f
description: 'Сводка: Сведения о сведения о развертывании диспетчера статистики для Скайп для Business Server 2015.'
ms.openlocfilehash: 75a8af0794431a0f74233ad0c6a422b3827c7656
ms.sourcegitcommit: dd37c12a0312270955755ab2826adcfbae813790
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/04/2018
ms.locfileid: "25371143"
---
# <a name="deploy-statistics-manager-for-skype-for-business-server-2015"></a>Развертывание диспетчера статистики в Skype для бизнеса Server 2015
 
**Сводка:** В данном разделе приведены описан процесс развертывания диспетчера статистики для Скайп для Business Server 2015.
  
 Диспетчер статистики для Скайп для Business Server представляет собой мощное средство, которое позволяет просматривать Скайп для данные о работоспособности и производительности Business Server в режиме реального времени. Опрос данные о производительности на серверах сотни раз в несколько секунд и просмотреть результаты мгновенно на веб-сайт диспетчера статистики.
  
Прежде чем пытаться установить диспетчер статистики, убедитесь, что вы знакомы с требования к программному обеспечению, сети и оборудования. Для получения дополнительных сведений см. [Планирование для диспетчера статистики для Скайп для Business Server 2015](plan.md).
  
> [!NOTE]
> При обновлении с предыдущей версии диспетчера статистики см.: [Обновление статистики диспетчер для Скайп для Business Server 2015](upgrade.md). 
  
> [!NOTE]
> Веб-сайт диспетчера статистики тестировался и корректно работает с браузерами Internet Explorer 11 и более поздних версий, Edge 20.10240 и более поздних версий и Chrome 46 и более поздних версий (текущая актуальная версия). 
  
Можно найти диспетчер статистики загружаемые в [https://aka.ms/StatsManDownload](https://aka.ms/StatsManDownload). 
  
В этой статье содержатся следующие разделы:
  
- [Развертывание диспетчера статистики](deploy.md#BKMK_Deploy)
    
- [Поиск и устранение неполадок в развертывании](deploy.md#BKMK_Troubleshoot)
    
- [Создание самозаверяющего сертификата](deploy.md#BKMK_SelfCert)
    
## <a name="deploy-statistics-manager"></a>Развертывание диспетчера статистики
<a name="BKMK_Deploy"> </a>

Чтобы развернуть статистики Manager, выполните следующие действия:
  
1. Подготовьте хост-компьютер прослушивателя, установив систему кэширования в памяти Redis и убедившись, что установлены все необходимые сертификаты.
    
2. Установите службу прослушивателя на хост-компьютере.  
    
3. Установите веб-сайт на хост-компьютере.
    
4. Установите агент на каждом Скайп машины Business Server, которые вы хотите отслеживать.
    
5. Импортируйте топологию для отслеживаемых серверов.
    
> [!NOTE]
> Система Redis, служба прослушивателя и веб-сайт должны быть установлены на одном хост-компьютере. Убедитесь, что этот компьютер не Скайп Business Server установлена. 
  
### <a name="prepare-the-listener-host-machine"></a>Подготовка хост-компьютера прослушивателя

Подготовка компьютера узла, необходимо будет установить системы кэширования в памяти Redis и убедитесь, что действующего сертификата на компьютере. Корпорация Майкрософт рекомендует установить последние стабильным построения Redis 3.0. Статистика диспетчера версии 1.1 была протестирована Redis 3.0.501 и Redis 2.8.2400. 
  
1. Загрузить Redis со следующего сайта: [https://github.com/MSOpenTech/redis](https://github.com/MSOpenTech/redis). 
    
    Можно загрузить неподписанный программы установки[https://github.com/MSOpenTech/redis/releases](https://github.com/MSOpenTech/redis/releases)
    
    При необходимости, подписанные двоичные файлы можно загрузить популярные пакет руководители: [Nuget](https://www.nuget.org/packages/Redis-64/) и [Choclatey](https://chocolatey.org/packages/redis-64).
    
   - Запустите MSI-файл и следуйте указаниям.
    
   - Не устанавливайте флажок, добавляющий правило брандмауэра.
    
2. Службе прослушивателя требуется сертификат. Корпорация Майкрософт рекомендует, что у вас есть сертификат, подписанный с доверенным центром сертификации. 
    
    Если вы хотите использовать самозаверяющий сертификат (например, для тестирования в лаборатории), см. раздел [Создание самозаверяющего сертификата](deploy.md#BKMK_SelfCert).
    
    Обратите внимание, что агент использует проверку по отпечатку сертификата (вместо проверки цепочки сертификатов). Он не будет выполнять полную проверку сертификатов, так как возможно использование самозаверяющих сертификатов.
    
### <a name="install-the-listener-service"></a>Установка службы прослушивателя

Установите службы прослушивания на главном компьютере, запустив StatsManPerfAgentListener.msi и укажите следующее:
  
1. Изучите лицензионное соглашение. Если вы согласны, выберите пункт **Я принимаю условия лицензионного соглашения** и нажмите кнопку **Далее**.  
    
2. На следующей странице введите указанную ниже информацию.
    
   - **Пароль службы**. Этот пароль будет использоваться удаленными агентами для проверки подлинности в службе прослушивателя.
    
   - **Порта службы:** Это номер порта HTTPS, прослушиватель будет использоваться для связи с агентами. Во время установки этот порт будет разрешен в локальном брандмауэре, будет создан список ACL для URL-адреса и к этому порту будет привязан SSL-сертификат. Значение по умолчанию — 8443.
    
   - **Отпечаток сертификата:** Это отпечаток сертификата, который прослушиватель будет использоваться для шифрования протокол HTTPS. Сетевая служба должна иметь доступ на чтение к закрытому ключу.
    
     Для выбора отпечатка сертификата нажмите кнопку **Выбор...**.
    
     Отпечаток сертификата можно найти с помощью диспетчера сертификатов или с помощью следующей команды PowerShell:
    
   ```
   Get-ChildItem -path cert:\LocalMachine\My
   ```

   - **Папка установки:** Это каталог, на котором будет установлен двоичных файлов. Каталог по умолчанию можно изменить на другой с помощью кнопки **Обзор...**.
    
   - **AppData Dir:** Это каталог, в которой будут храниться папке Logs и другие данные. Каталог по умолчанию можно изменить на другой. Он не будет удален при удалении программы.
    
3. Нажмите **Установить**.
    
Чтобы проверить установку, сделайте следующее.
  
1. Откройте браузер и перейдите кhttps://localhost:\<service-port\>/healthcheck/
    
    По умолчанию порт службы — 8443 (если вы не задали другой порт).
    
2. Чтобы убедиться, что прослушиватель установлен правильно, проверьте следующие вещи.
    
   - Если страница проверки работоспособности отображается, прослушиватель установлен успешно.
    
   - Если значение KnownServersCount не меньше 1, то подключение к системе Redis установлено.
    
   - Подождав несколько минут и дождавшись установки по меньшей мере одного агента, посмотрите, увеличивается ли значение счетчика ValuesWritten.
    
### <a name="install-the-website"></a>Установка веб-сайта

Установите веб-сайт, на главном компьютере, запустив StatsManWebSite.msi и укажите следующее:
  
1. Изучите лицензионное соглашение. Если вы согласны, выберите пункт **Я принимаю условия лицензионного соглашения** и нажмите кнопку **Далее**.  
    
2. На следующей странице введите указанную ниже информацию.
    
   - **Порта службы:** Это номер порта, который выполняется прослушивание для веб-сайта. Его можно изменить позже, используя привязку порта в диспетчере служб IIS. Во время установки этот порт будет разрешен в локальном брандмауэре.
    
   - **Папка установки:** Это каталог, где будут установлены двоичные файлы. Каталог по умолчанию можно изменить на другой с помощью кнопки **Обзор...**.
    
   - **AppData Dir:** Это каталог, в которой будут храниться папке Logs и другие данные. Каталог по умолчанию можно изменить на другой. Он не будет удален при удалении программы.
    
3. Нажмите **Установить**.
    
Чтобы просмотреть веб-сайта, откройте браузер и перейдите к: http://localhost, webport\>/.
  
Чтобы просмотреть сведения только о работоспособности, откройте браузер и перейдите к: http://localhost:\<webport\>/healthcheck/.
  
По умолчанию номер веб-порта — 8080. Привязку порта веб-сайта можно изменить с помощью диспетчера служб IIS.
  
Веб-установщик добавляет локальную группу безопасности с именем StatsManWebSiteUsers. В эту группу безопасности можно добавить учетные записи, которым нужно дать доступ к веб-сайту. 
  
### <a name="install-the-agents"></a>Установка агентов

Установите агент на каждом Скайп для Business Server, который вы хотите отслеживать, запустив StatsManPerfAgent.msi и укажите следующее:
  
1. Изучите лицензионное соглашение. Если вы согласны, выберите пункт **Я принимаю условия лицензионного соглашения** и нажмите кнопку **Далее**.  
    
2. На следующей странице введите указанную ниже информацию.
    
   - **Пароль службы**. Этот пароль будет использоваться удаленными агентами для проверки подлинности в службе прослушивателя.
    
   - **Службы URI:** Это URI, где находится прослушиватель. Следует использовать https://name:port формат.
    
     Можно использовать NetBIOS-имя или полное доменное имя. Можно использовать имя, которое также указан как **Тема** или **Альтернативные имена субъекта** сертификата на службу прослушивателя, но это не является обязательным требованием.
    
   - **Службы отпечаток:** Это отпечаток SSL-сертификата, используемого прослушиватель. Этот отпечаток будет использоваться агентом для проверки подлинности в службе прослушивателя. (Он не будет выполнять полную проверку сертификатов, так как возможно использование самозаверяющих сертификатов.)
    
   - **Папка установки:** Это каталог, на котором будет установлен двоичных файлов. Каталог по умолчанию можно изменить на другой с помощью кнопки **Обзор...**.
    
   - **AppData Dir:** Это каталог, в папке Logs и файл зашифрованные password.txt будет храниться. Каталог по умолчанию можно изменить на другой. Он не будет удален при удалении программы.
    
3. Нажмите **Установить**.
    
Если вы устанавливаете агент на несколько компьютеров, возможно, стоит сделать это в автоматическом режиме. Пример:   
  
```
msiexec /l install.log /i StatsManPerfAgent.msi SERVICE_THUMBPRINT=<thumbprint> SERVICE_PASSWORD=<password> SERVICE_URI=https://<hostname>:<servicePort>/[INSTALLDIR=<directory>][DIR_  STATSMANAPPDATA=<directory>]
```

### <a name="import-the-topology"></a>импорт топологии
<a name="BKMK_ImportTopology"> </a>

После установки диспетчера статистики и запущен, необходимо импортировать Скайп для топологии Business Server таким образом, Менеджер Статистика знает сайта, пула и роли каждого сервера. Чтобы импортировать вашей Скайп для топологии Business Server, командлет [Get-CsPool](https://docs.microsoft.com/powershell/module/skype/get-cspool?view=skype-ps) используется для получения сведений о каждом пуле, используемых в вашей организации, затем импортировать эти сведения в диспетчер статистики.
  
Чтобы импортировать Скайп для топологии Business Server, выполните следующие действия:
  
1. На узле, который содержит Скайп по командлетам Business Server PowerShell:
    
    а. Выполните следующую команду. 
    
   ```
   Get-CsPool | Export-Clixml -Path mypoolinfo.xml
   ```
    б. Скопируйте файл «mypoolinfo.xml» на сервер, на котором выполняется прослушиватель.
    
2. На хосте, на котором запущен прослушиватель:
    
   а. Запустите PowerShell.
    
   б. Перейдите в каталог, куда установлен прослушиватель. По умолчанию это: 
    
   ```
   cd C:\Program Files\Skype for Business Server StatsMan Listener
   ```

3. Чтобы проверить, какие серверы добавляются и обновляются, выполните следующую команду:
    
   ```
    .\Update-StatsManServerInfo.ps1 -CsPoolFile  <path to mypoolinfo.xml>
   ```

Следующая команда позволяет увидеть все параметры:
  
```
Get-Help .\Update-StatsManServerInfo.ps1 -Detailed 
```

Для просмотра всей импортированной информации о сервере выполните следующий сценарий:  
  
```
.\Get-StatsManServerInfo.ps1
```

Если вы хотите отслеживать серверах, не входящих в вашей Скайп для топологии Business Server — сервер Exchange Server, например можно сделать импорта одного сервера на главном компьютере, на котором выполняется прослушиватель. Чтобы выполнить импорт для одного сервера, сделайте следующее.
  
1. Перейдите в каталог, куда установлен прослушиватель. По умолчанию это: 
    
   ```
   cd C:\Program Files\Skype for Business Server StatsMan Listener
   ```

2. Выполните следующую команду.
    
   ```
    .\Update-StatsManServerInfo.ps1 -HostName <hostname> -SiteName <name of site> -PoolName <poolName> -Roles <role1>[,<role2>,<roleN>]
   ```

## <a name="troubleshoot-your-deployment"></a>Поиск и устранение неполадок в развертывании
<a name="BKMK_Troubleshoot"> </a>

Если агент не запускается, проверьте следующее.  
  
- Агент, зарегистрированный в диспетчере статистики?
    
1. 	Убедитесь, что вы выполнили инструкции по импорту топологии. См. статью [Импорт топологии](deploy.md#BKMK_ImportTopology).  
    
2. Если агент находится на сервере, который не указан в топологии (например, узлы в кластере SQL AlwaysOn), необходимо добавить агент вручную, следуя инструкциям в статье [Импорт топологии](deploy.md#BKMK_ImportTopology).
    
- Может ли агент установить контакт с прослушивателем?
    
1. Убедитесь, что служба прослушивателя запущена.   
    
    Если служба не запущена, убедитесь, что система Redis запущена, а затем попробуйте перезапустить прослушиватель.
    
2. Убедитесь, что порт открыт в службу прослушивателя, и, что компьютер агента обмениваться данными с номер порта.
    
- Чтобы убедиться, что статистика диспетчер сбор данных, можно проверить CSV-файла следующим образом. 
    
    Следующая команда получает имена хранилищ счетчика:   
    
  ```
  .\PerfAgentStorageManager.exe -redis=localhost -a=listcounterstoragenames -mode=verbose | findstr /i processor
  ```

    Следующая команда получает значения указанных счетчиков:  
    
  ```
  .\PerfAgentStorageManager.exe -redis=localhost -a=getcountervalues  -counter="\\*\Processor Information\% Processor Time_Mean_Mean\_Total" -file:all-processor.csv
  ```

Сведения о всех событий, которые могут отображаться в журнале событий приложений см.: [Устранение неполадок диспетчер статистики для Скайп для Business Server 2015](troubleshoot.md).
  
## <a name="create-a-self-signed-certificate"></a>Создание самозаверяющего сертификата
<a name="BKMK_SelfCert"> </a>

Майкрософт настоятельно рекомендует использовать сертификат, подписанный надежным центром сертификации. Если же вы хотите использовать самозаверяющий сертификат в целях тестирования, сделайте следующее. 
  
1. Выполнив вход от имени администратора, введите в консоли PowerShell следующую команду:
    
   ```
   New-SelfSignedCertificate -DnsName StatsManListener -CertStoreLocation Cert:\LocalMachine\My
   ```

2. Тип `certlm.msc`. Откроется диспетчер сертификатов для локального компьютера.
    
3. Перейдите на **Личные**, а затем откройте **сертификаты**.
    
4. Щелкните правой кнопкой мыши на **StatsManListener -\>все задачи -\>управление закрытых ключей...**
    
5. Нажмите кнопку **Добавить **.
    
6. В поле **Введите имена выбираемых объектов** введите "Сетевая служба"
    
7. Нажмите **ОК**.
    
8. В разделе **Полный доступ** снимите флажок **Разрешить**. (Необходим только доступ на чтение.)
    
9. Нажмите **ОК**.
    
## <a name="for-more-information"></a>Дополнительные сведения
<a name="BKMK_SelfCert"> </a>

Дополнительные сведения приведены далее.
  
- [Планирование для диспетчера статистики для Скайп Business Server 2015](plan.md)
    
- [Обновление диспетчера статистики в Skype для бизнеса Server 2015](upgrade.md)
    
- [Устранение проблем диспетчера статистики в Skype для бизнеса Server 2015](troubleshoot.md)
    
- [Скайп для диспетчером сервера Статистика блога](https://blogs.technet.microsoft.com/skypestatsman/)
    

