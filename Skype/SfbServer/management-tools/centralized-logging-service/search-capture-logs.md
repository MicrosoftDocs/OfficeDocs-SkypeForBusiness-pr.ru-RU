---
title: Поиск записей в журналах, созданных службой централизованного ведения журналов в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 12/20/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 1b75b218-d84f-47a7-8a0a-b7e016b1cc79
description: 'Сводка: Узнайте, как искать и читать централизованные журналы захвата службы ведения журналов в Skype для бизнеса Server 2015.'
ms.openlocfilehash: 563f2c5e08da0830c3bd03e562d0d94052fa359b
ms.sourcegitcommit: 2cc98fcecd753e6e8374fc1b5a78b8e3d61e0cf7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2020
ms.locfileid: "40991454"
---
# <a name="search-capture-logs-created-by-the-centralized-logging-service-in-skype-for-business-server-2015"></a>Поиск записей в журналах, созданных службой централизованного ведения журналов в Skype для бизнеса Server 2015
 
**Сводка:** Узнайте, как искать и читать централизованные журналы захвата службы ведения журналов в Skype для бизнеса Server 2015.
  
Функции поиска в централизованной службе ведения журналов полезны и мощно по следующим причинам: 
  
- Процесс и результаты поиска выполняются на одном компьютере, в пуле, на сайте или в глобальной области в зависимости от заданных критериев.
    
- Поиск может изначально выполняться в широком диапазоне с последующим уточнением до более узких критериев (время, компонент или компьютер). Вы можете выполнить поиск по одному и тому же журналу и больше не нужно запускать сеанс ведения журнала при изменении условий поиска.
    
- Выполняется сбор результатов поиска со всех компьютеров и из пулов в области, создание коллекции и объединение результатов поисков в единый файл вывода, представляющий результаты использования условий поиска (с ограничением до выполняемых сценариев и данных, получаемых сценариями). При этом для чтения файла вывода и сообщений трассировки во всей среде используется хорошо знакомый инструмент (например, **Snooper** или **Блокнот**).
    
CLSAgent на каждом отдельном компьютере создает журналы в соответствии со сценарием или сценариями (в любое время на компьютере можно выполнять одновременно два сценария). Управление журналами и связанными с ними файлы индекса и кэша осуществляется посредством CLSAgent. При определении критериев и выполнении поиска команда поиска сообщает CLSAgent, какие данные требуется получить. CLSAgent направляет запрос в файлы журнала, кэша и индекса и возвращает результаты поиска в CLSContoller. CLSController получает результаты поиска от всех компьютеров и объединяет их в пул в области поиска. Затем CLSController объединяет журналы и помещает их в порядке изменения времени (первыми идут самые старые записи, последними - самые новые).
  
После каждой операции поиска запускается командлет **Sync-CsClsLogging**, который выполняет очистку кэша, используемого операциями поиска (не следует путать с файлами кэша, обслуживаемыми CLSAgent). Очистка кэша позволяет убедиться в том, что журнал и буфер записи файлов трассировки в CLSController свободны для следующей операции поиска.
  
Чтобы получить наибольшую пользу от централизованной службы ведения журналов, вам нужно хорошо понять, как настроить поиск, чтобы возвращать только сообщения трассировки из журналов компьютера и пула, которые связаны с проблемой, которую вы ищете. issues
  
Чтобы запустить функцию централизованного поиска службы ведения журналов с помощью командной консоли Skype для бизнеса Server, вы должны быть членом группы безопасности Ксадминистратор или Кссерверадминистратор (или настраиваемой роли RBAC) для управления доступом на основе ролей. содержащая одну из этих двух групп. Чтобы возвратить список всех ролей RBAC, которым был назначен этот командлет (включая любые пользовательские роли RBAC, созданные пользователем), выполните следующую команду в командной консоли управления Skype для бизнеса Server или Windows PowerShell.
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Skype for Business Server 2015 cmdlet"}
```

Например:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}
```

Остальная часть данного раздела посвящена способам определения критериев поиска в целях оптимизации диагностики.
  
### <a name="to-run-a-basic-search-by-using-the-centralized-logging-service"></a>Выполнение простого поиска с помощью централизованной службы ведения журналов

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Убедитесь в том, что в глобальной области среды выполняется сценарий AlwaysOn, после чего введите в командной строке следующее:
    
   ```PowerShell
   Search-CsClsLogging -OutputFilePath <string value of path and file to write the output file>
   ```

> [!NOTE]
> По умолчанию Search-CsClsLogging отправляет результаты поиска на консоль. Если вы хотите сохранить результаты поиска в файле, используйте полный _ \<путь\>к файлу в строке_аутпутфилепас. Чтобы определить параметр-Аутпутфилепас, укажите путь и имя файла в виде части параметра в строковом формате, заключенном в кавычки (например, К:\логфилес\сеарчаутпут.ткст). В этом примере необходимо убедиться в том, что каталог C:\LogFiles существует, и у вас есть разрешения для чтения и записи файлов в этот каталог (разрешение NTFS Modify). Выполняется добавление выходных данных, но не их перезапись. Чтобы создать отдельные файлы, определите уникально идентифицируемое имя файлы для каждой операции поиска. 
  
Например:
    
  ```PowerShell
  Search-CsClsLogging -OutputFilePath "C:\LogFiles\logfile.txt"
  ```

### <a name="to-run-a-basic-search-on-a-pool-or-computer-by-using-the-centralized-logging-service"></a>Выполнение простого поиска в пуле или на компьютере с помощью централизованной службы ведения журналов

1. Чтобы ограничить поиск определенным пулом или компьютером, используйте параметр-Computers на компьютере, определенном полным именем компьютера, заключенным в кавычки и разделив их запятыми, как описано ниже.
    
   ```PowerShell
   Search-CsClsLogging -Computers <string value of computer names> -OutputFilePath <string value of path and file to write the output file>
   ```

Например:
    
  ```PowerShell
  Search-CsClsLogging -Computers "fe01.contoso.net" -OutputFilePath "C:\LogFiles\logfile.txt"
  ```

2. Чтобы выполнить поиск по нескольким компьютерам, введите несколько имен компьютеров в кавычках с разделением запятыми. Например:
    
   ```PowerShell
   Search-CsClsLogging -Computers "fe01.contoso.net", "fe02.contoso.net", "fe03.contoso.net" -OutputFilePath "C:\LogFiles\logfile.txt"
   ```

3. Если вы хотите выполнить поиск всего пула, а не отдельного компьютера, измените параметр-Computers на-Pools, удалите имя компьютера и замените его пулом или пулами в кавычках, разделенных запятыми.
    
    Например:
    
   ```PowerShell
   Search-CsClsLogging -Pools "pool01.contoso.net" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

4. При использовании команд поиска пулы могут быть любым пулом в развертывании, например в пулах интерфейсов, пулах EDGE, пулах серверов сохраняемого чата или других, которые определяются как пул в развертывании.
    
    Например:
    
   ```PowerShell
   Search-CsClsLogging -Pools "pool01.contoso.net", "pchatpool01.contoso.net", "intedgepool01.contoso.net" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

### <a name="to-run-a-search-by-using-time-parameters"></a>Выполнение поиска с использованием параметров времени

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. По умолчанию время начала для параметров времени поиска — 25 минут до и пять минут после инициации поиска. Иными словами, если поиск выполняется в 16:00, время начала поиска отображается с 15:35:00 до 16:05:00. Если вам нужно найти 60 минут или 3 часа до текущего времени, используйте параметр-StartTime и задайте строку даты и времени, указывающую время начала поиска. 
    
    Например, с помощью функции-StartTime и-EndTime для определения диапазона времени и даты можно задать поиск в диапазоне от 8 до 9 AM 11/20/2012 в пуле. Также можно задать путь для записи результатов в файл с именем :\logfile.txt:
    
   ```PowerShell
   Search-CsClsLogging -Pools "pool01.contoso.net" -StartTime "11/20/2012 08:00:00 AM" -EndTime "11/20/2012 09:00:00 AM" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

> [!NOTE]
> Заданная строка времени и даты может быть указана в формате "дата-время" или "время-дата". "Команда проанализирует строку и применяет соответствующие значения даты и времени, а также региональных стандартов и региональных параметров на компьютере, с которого вы запускаете командлет. 
  
3. Если вы хотите получить журналы, начиная с 11:00:00 на 11/20/2012, вы определяете параметр-StartTime. Диапазон времени по умолчанию для поиска составляет 30 минут, пока не будет определено конкретное значение. В результате поиск возвращает журналы с определенного компьютера или пула за период с 11:00 до 11:30.
    
Например:
    
  ```PowerShell
  Search-CsClsLogging -Pools "pool01.contoso.net" -StartTime "11/20/2012 11:00:00 AM" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

4. Чтобы выполнить поиск журналов в течение определенного периода времени, определите a-StartTime и a-EndTime. Потребуются журналы за период с 13:00 до 14:45 для компьютера edge01.contoso.net. 
    
Например:
    
  ```
  Search-CsClsLogging -Computers "edge01.contoso.net" -StartTime "11/20/2012 1:00:00 PM" -EndTime "11/20/2012 2:45:00 PM" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

### <a name="to-run-an-advanced-search-by-using-other-criteria-and-matching-options"></a>Выполнение расширенного поиска с использованием других критериев и параметров сопоставления

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Чтобы выполнить команду сбора трассировок для заданных компонентов, введите следующий текст:
    
   ```PowerShell
   Search-CsClsLogging -Components <components to search on> -OutputFilePath <fully qualified path to output logs>
   ```

Например:
    
  ```PowerShell
  Search-CsClsLogging -Components "SIPStack","S4","UserServices" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

В результате поиск возвращает все записи в журнале, которые содержат компоненты трассировки для SIPStack, S4 и UserServices, для всех компьютеров и пулов в среде за последние 30 минут.
    
3. Чтобы ограничить поиск одними и теми же компонентами в пуле переднего плана с именем pool01.contoso.net, введите:
    
   ```PowerShell
   Search-CsClsLogging -Components "SIPStack","S4","UserServices" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

4. По умолчанию для команд, содержащих несколько параметров, используется следующая логика поиска: логический оператор OR с каждым из определенных параметров. Это поведение можно изменить, указав параметр **-матчалл** . Для этого введите следующий текст:
    
   ```PowerShell
   Search-CsClsLogging -CallId "d0af828e49fa4dcb99f5f80223a634bc" -Components "SIPStack","S4","UserServices" -MatchAll -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

5. Если для сценариев задано постоянное выполнение (например, AlwaysOn), или определены сценарии длительного выполнения, журналы могут быть перемещены с локального компьютера в сетевую общую папку. Общая папка определяется параметром CacheFileNetworkFolder с использованием командлета New-CsClsConfiguration для создания новой или изменения текущей конфигурации с помощью Set-CsClsConfiguration. Если включать общую папку в коллекцию журналов для поиска не требуется, используйте параметр SkipNetworkLogs, как показано далее:
    
   ```PowerShell
   Search-CsClsLogging -Components "SIPStack","S4","UserServices" -StartTime "11/1/2012 00:00:01 AM" -EndTime "11/20/2012 2:45:00 PM" -SkipNetworkLogs -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

## <a name="read-capture-logs-from-the-centralized-logging-service"></a>Чтение записей журналов службы централизованного ведения журналов

Вы осознаете реальное преимущество централизованной службы ведения журналов после выполнения поиска и наличии файла, который можно использовать для отслеживания обнаруженной проблемы. There are a number of ways that you can read the file. The output file is in a standard text format and you can use Notepad.exe or any other programs that will allow you to open and read a text file. Для больших файлов и более сложных проблем можно использовать средство, например Снупер. exe, которое предназначено для чтения и анализа результатов ведения журнала из централизованной службы ведения журнала. Snooper is included with the Debug Tools that are available as a separate download. Вы можете скачать инструменты отладки здесь: [https://go.microsoft.com/fwlink/?LinkId=285257](https://go.microsoft.com/fwlink/?LinkId=285257). При установке средств отладки не создаются короткие команды и элементы меню. После установки средств отладки откройте проводник Windows, окно командной строки или консоль управления в Skype для бизнеса Server и перейдите в каталог (расположение по умолчанию) C:\Program Филес\скипе для Business Server 2015 \ инструменты отладки. Дважды щелкните Снупер. exe или введите Снупер. exe, а затем нажмите клавишу ВВОД, если вы используете командную строку или консоль управления Skype для бизнеса Server.
  
> [!IMPORTANT]
> В цели этого раздела не входит подробное обсуждение методов диагностики. Диагностика и сопутствующие процессы являются сложной темой. Подробные сведения об устранении неполадок и устранении неполадок при определенных нагрузках можно найти в книге набор ресурсов Microsoft [https://go.microsoft.com/fwlink/p/?linkId=211003](https://go.microsoft.com/fwlink/p/?linkId=211003)Lync Server 2010 по адресу. Процессы и процедуры по-прежнему применяются к Skype для бизнеса Server 2015. 
  
### <a name="to-open-a-log-file-in-snooper"></a>Открытие файла журнала в Snooper

1. Для использования Snooper и открытия файлов журналов требуется доступ на чтение файлов журналов. Чтобы использовать Snooper и получить доступ к файлам журналов, необходимо быть членом группы безопасности управления доступом на основе ролей (RBAC) CsAdministrator или CsServerAdministrator либо членом настраиваемой роли RBAC, содержащей эти две группы. 
    
2. После установки средств отладки (LyncDebugTools.msi) перейдите в каталог расположения Snooper.exe с помощью проводника или из командной строки. По умолчанию инструменты отладки находятся в папке C:\Program Филес\скипе для Business Server 2015 \. Дважды щелкните файл Snooper.exe или запустите его.
    
3. После открытия Snooper щелкните правой кнопкой мыши пункт **File** (Файл), выберите пункт **Open File** (Открыть файл), найдите файлы журнала, выберите нужный файл в диалоговом окне **открытия файла** и нажмите кнопку **Open** (Открыть).
    
4. Сообщения **трассировки** файла журнала отображаются на вкладке **Трассировка** . чтобы просмотреть содержимое сообщений собранных трассировок, откройте вкладку **сообщения** .
    
### <a name="to-display-a-call-flow-diagram"></a>Отображение схемы потока вызовов

1. Для использования Snooper и открытия файлов журналов требуется доступ на чтение файлов журналов. Чтобы использовать Snooper и получить доступ к файлам журналов, вы должны быть членом группы безопасности управления доступом на основе ролей (RBAC) CsAdministrator или CsServerAdministrator либо членом настраиваемой роли RBAC, содержащей эти две группы.
    
2. Откройте файл журнала и перейдите на вкладку **Messages** (Сообщения); выберите беседу в представлении сообщений или выберите компонент трассировки на вкладке **Trace** (Трассировка).
    
3. Нажмите **Call Flow** (Поток вызовов).
    
> [!NOTE]
> Если щелкнуть сообщение или трассировку, которая не является частью потока, схема не появится, и в нижней части Снупер появляется сообщение о состоянии "это сообщение не подходит для каллфов". Выберите другое сообщение или трассировку, и если это сообщение или трассировка является частью потока вызовов, то появится поток вызовов. 
  
4. Пройдите по строкам сообщений или трассировки и обратите внимание, отображают ли обновления или изменения схемы потока вызовов новую схему.
    
5. Помещайте указатель мыши поверх элементов, чтобы получить сведения о сообщениях, конечных точках и других компонентах вызовов.
