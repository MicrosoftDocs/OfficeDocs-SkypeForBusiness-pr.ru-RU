---
title: Поиск записей в журналах, созданных службой централизованного ведения журналов в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: jambirk
author: jambirk
manager: serdars
ms.date: 12/20/2018
ms.audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 1b75b218-d84f-47a7-8a0a-b7e016b1cc79
description: 'Сводка: Узнайте, как поиск и просмотр записей журналов службы централизованного ведения журналов в Скайп для Business Server 2015.'
ms.openlocfilehash: b1f049260eff7524e5a728852b3dcd99526d8742
ms.sourcegitcommit: da8c037bb30abf5d5cf3b60d4b71e3a10e553402
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2019
ms.locfileid: "30895889"
---
# <a name="search-capture-logs-created-by-the-centralized-logging-service-in-skype-for-business-server-2015"></a>Поиск записей в журналах, созданных службой централизованного ведения журналов в Skype для бизнеса Server 2015
 
**Сводка:** Узнайте, как поиск и просмотр записей журналов службы централизованного ведения журналов в Скайп для Business Server 2015.
  
Функции поиска в службы централизованного ведения журналов являются очень полезных по следующим причинам: 
  
- Процесс и результаты поиска выполняются на одном компьютере, в пуле, на сайте или в глобальной области в зависимости от заданных критериев.
    
- Поиск может изначально выполняться в широком диапазоне с последующим уточнением до более узких критериев (время, компонент или компьютер). Поиск для одной журналов и не требуется для запуска сеанса ведения журнала еще раз при изменении условий поиска.
    
- Выполняется сбор результатов поиска со всех компьютеров и из пулов в области, создание коллекции и объединение результатов поисков в единый файл вывода, представляющий результаты использования условий поиска (с ограничением до выполняемых сценариев и данных, получаемых сценариями). При этом для чтения файла вывода и сообщений трассировки во всей среде используется хорошо знакомый инструмент (например, **Snooper** или **Блокнот**).
    
CLSAgent на каждом отдельном компьютере создает журналы в соответствии со сценарием или сценариями (в любое время на компьютере можно выполнять одновременно два сценария). Управление журналами и связанными с ними файлы индекса и кэша осуществляется посредством CLSAgent. При определении критериев и выполнении поиска команда поиска сообщает CLSAgent, какие данные требуется получить. CLSAgent направляет запрос в файлы журнала, кэша и индекса и возвращает результаты поиска в CLSContoller. CLSController получает результаты поиска от всех компьютеров и объединяет их в пул в области поиска. Затем CLSController объединяет журналы и помещает их в порядке изменения времени (первыми идут самые старые записи, последними - самые новые).
  
После каждой операции поиска запускается командлет **Sync-CsClsLogging**, который выполняет очистку кэша, используемого операциями поиска (не следует путать с файлами кэша, обслуживаемыми CLSAgent). Очистка кэша позволяет убедиться в том, что журнал и буфер записи файлов трассировки в CLSController свободны для следующей операции поиска.
  
Для извлечения максимальной выгоды из службы централизованного ведения журналов, необходимо понять способы настройки поиска для возвращения только сообщения трассировки из журналов компьютера и пула, относящиеся к проблемы, исследование. issues
  
Для запуска функции поиска службы централизованного ведения журналов с помощью Скайп для консоли Business Server, должна быть членом CsAdministrator или групп безопасности CsServerAdministrator доступом на основе ролей (RBAC) элемента управления или настраиваемые роли RBAC который содержит любой из этих двух групп. Чтобы получить список всех ролей RBAC, этот командлет был назначен (включая любые пользовательские роли RBAC, созданные самостоятельно), выполните следующую команду из Скайп для консоли Business Server или в командной строке Windows PowerShell:
  
```
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Skype for Business Server 2015 cmdlet"}
```

Например:
  
```
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}
```

Остальная часть данного раздела посвящена способам определения критериев поиска в целях оптимизации диагностики.
  
### <a name="to-run-a-basic-search-by-using-the-centralized-logging-service"></a>Выполнение базового поиска с использованием службы централизованного ведения журналов

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Убедитесь в том, что в глобальной области среды выполняется сценарий AlwaysOn, после чего введите в командной строке следующее:
    
   ```
   Search-CsClsLogging -OutputFilePath <string value of path and file to write the output file>
   ```

> [!NOTE]
> По умолчанию Search-CsClsLogging отправляет результаты поиска на консоль. Если вы хотите сохранить результаты поиска в файл, используйте - OutputFilePath _ \<строку полный путь\>_. Чтобы определить параметр - OutputFilePath, укажите путь и имя файла как часть параметра в строковом формате, заключенной в кавычки (например, C:\LogFiles\SearchOutput.txt). В этом примере необходимо убедиться в том, что каталог C:\LogFiles существует, и у вас есть разрешения для чтения и записи файлов в этот каталог (разрешение NTFS Modify). Выполняется добавление выходных данных, но не их перезапись. Чтобы создать отдельные файлы, определите уникально идентифицируемое имя файлы для каждой операции поиска. 
  
Например:
    
  ```
  Search-CsClsLogging -OutputFilePath "C:\LogFiles\logfile.txt"
  ```

### <a name="to-run-a-basic-search-on-a-pool-or-computer-by-using-the-centralized-logging-service"></a>Выполнение базового поиска в пуле или компьютер с использованием службы централизованного ведения журналов

1. Чтобы ограничить поиск для конкретного пула или компьютера, используйте параметр - компьютеров с компьютера определяется полное имя компьютера, заключенной в кавычки и разделенных точкой с запятой, как показано ниже:
    
   ```
   Search-CsClsLogging -Computers <string value of computer names> -OutputFilePath <string value of path and file to write the output file>
   ```

Например:
    
  ```
  Search-CsClsLogging -Computers "fe01.contoso.net" -OutputFilePath "C:\LogFiles\logfile.txt"
  ```

2. Чтобы выполнить поиск по нескольким компьютерам, введите несколько имен компьютеров в кавычках с разделением запятыми. Например:
    
   ```
   Search-CsClsLogging -Computers "fe01.contoso.net", "fe02.contoso.net", "fe03.contoso.net" -OutputFilePath "C:\LogFiles\logfile.txt"
   ```

3. Если вам нужно найти весь пул, а не отдельный компьютер, измените параметр - компьютеров для - пулов, remove имя компьютера и заменить ее с помощью пула или пулов в кавычки, разделив их запятыми.
    
    Например:
    
   ```
   Search-CsClsLogging -Pools "pool01.contoso.net" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

4. При использовании команд поиска, пулов можно указать любые в среде, например пулов переднего плана, пограничные пулы, пулы серверов сохраняемого чата или любые другие, определенные как пул в вашем развертывании.
    
    Например:
    
   ```
   Search-CsClsLogging -Pools "pool01.contoso.net", "pchatpool01.contoso.net", "intedgepool01.contoso.net" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

### <a name="to-run-a-search-by-using-time-parameters"></a>Выполнение поиска с использованием параметров времени

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. По умолчанию время начала для параметров времени поиска — 25 минут до и пять минут после инициации поиска. Иными словами, если поиск выполняется в 16:00, время начала поиска отображается с 15:35:00 до 16:05:00. Если вам требуется выполнять поиск 60 минут или 3 часа до текущего времени, используйте параметр - StartTime и параметры строки даты и времени для указания времени, поиск, чтобы запустить. 
    
    К примеру с помощью - StartTime и - EndTime определение диапазон даты и времени, можно определить поиска между 8 AM и 9: 00 на 11/20/2012 на пул. Также можно задать путь для записи результатов в файл с именем :\logfile.txt:
    
   ```
   Search-CsClsLogging -Pools "pool01.contoso.net" -StartTime "11/20/2012 08:00:00 AM" -EndTime "11/20/2012 09:00:00 AM" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

> [!NOTE]
> Заданная строка времени и даты может быть указана в формате "дата-время" или "время-дата". «Команда будет анализа строки и используйте соответствующие значения для даты и времени и параметры языка и региональных параметров на компьютере, на котором выполняется командлет. 
  
3. Если вы хотите загрузить журналы, начиная с 11:00:00: 00 на 11/20/2012 г., можно определить время начала. Диапазон времени по умолчанию для поиска можно 30 минут, если определение конкретного - EndTime. В результате поиск возвращает журналы с определенного компьютера или пула за период с 11:00 до 11:30.
    
Например:
    
  ```
  Search-CsClsLogging -Pools "pool01.contoso.net" -StartTime "11/20/2012 11:00:00 AM" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

4. Чтобы выполнять поиск журналов в течение определенного периода времени, определите - StartTime и - EndTime. Потребуются журналы за период с 13:00 до 14:45 для компьютера edge01.contoso.net. 
    
Например:
    
  ```
  Search-CsClsLogging -Computers "edge01.contoso.net" -StartTime "11/20/2012 1:00:00 PM" -EndTime "11/20/2012 2:45:00 PM" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

### <a name="to-run-an-advanced-search-by-using-other-criteria-and-matching-options"></a>Выполнение расширенного поиска с использованием других критериев и параметров сопоставления

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Чтобы выполнить команду сбора трассировок для заданных компонентов, введите следующий текст:
    
   ```
   Search-CsClsLogging -Components <components to search on> -OutputFilePath <fully qualified path to output logs>
   ```

Например:
    
  ```
  Search-CsClsLogging -Components "SIPStack","S4","UserServices" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

В результате поиск возвращает все записи в журнале, которые содержат компоненты трассировки для SIPStack, S4 и UserServices, для всех компьютеров и пулов в среде за последние 30 минут.
    
3. Чтобы ограничить поиск теми же компонентами, просто пул переднего плана с именем pool01.contoso.net, введите:
    
   ```
   Search-CsClsLogging -Components "SIPStack","S4","UserServices" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

4. По умолчанию для команд, содержащих несколько параметров, используется следующая логика поиска: логический оператор OR с каждым из определенных параметров. Можно изменить это поведение, значение параметра **- MatchAll** . Для этого введите следующий текст:
    
   ```
   Search-CsClsLogging -CallId "d0af828e49fa4dcb99f5f80223a634bc" -Components "SIPStack","S4","UserServices" -MatchAll -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

5. Если для сценариев задано постоянное выполнение (например, AlwaysOn), или определены сценарии длительного выполнения, журналы могут быть перемещены с локального компьютера в сетевую общую папку. Общая папка определяется параметром CacheFileNetworkFolder с использованием командлета New-CsClsConfiguration для создания новой или изменения текущей конфигурации с помощью Set-CsClsConfiguration. Если включать общую папку в коллекцию журналов для поиска не требуется, используйте параметр SkipNetworkLogs, как показано далее:
    
   ```
   Search-CsClsLogging -Components "SIPStack","S4","UserServices" -StartTime "11/1/2012 00:00:01 AM" -EndTime "11/20/2012 2:45:00 PM" -SkipNetworkLogs -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

## <a name="read-capture-logs-from-the-centralized-logging-service"></a>Чтение записей журналов службы централизованного ведения журналов

Реальное преимущество службы централизованного ведения журналов реализовать после запуска поиска и у вас есть файлов, которые можно использовать для отслеживания обнаруженной проблемы. There are a number of ways that you can read the file. The output file is in a standard text format and you can use Notepad.exe or any other programs that will allow you to open and read a text file. Файлы большего размера и более сложные проблемы можно использовать средство вроде Snooper.exe, предназначенный для чтения и синтаксического анализа журналов выходные данные службы централизованного ведения журналов. Snooper is included with the Debug Tools that are available as a separate download. Вы можете скачать здесь средств отладки: [https://go.microsoft.com/fwlink/?LinkId=285257](https://go.microsoft.com/fwlink/?LinkId=285257). При установке средства отладки, ярлыки и пункты меню не создаются. После установки средства отладки, откройте проводник Windows, окно командной строки или Скайп для консоли Business Server и перейдите к каталог (расположение по умолчанию) Files\Skype C:\Program 2015\Debugging средства Business Server. Дважды щелкните Snooper.exe или введите Snooper.exe и нажмите клавишу ВВОД, если вы используете командной строки или Скайп для консоли Business Server.
  
> [!IMPORTANT]
> В цели этого раздела не входит подробное обсуждение методов диагностики. Диагностика и сопутствующие процессы являются сложной темой. Подробные сведения о основы Устранение неполадок и устранение неполадок конкретных нагрузок книги пакет ресурсов Microsoft Lync Server 2010 в [https://go.microsoft.com/fwlink/p/?linkId=211003](https://go.microsoft.com/fwlink/p/?linkId=211003). Процессы и процедуры по-прежнему применяется к Скайп для Business Server 2015. 
  
### <a name="to-open-a-log-file-in-snooper"></a>Открытие файла журнала в Snooper

1. Для использования Snooper и открытия файлов журналов требуется доступ на чтение файлов журналов. Чтобы использовать Snooper и получить доступ к файлам журналов, необходимо быть членом группы безопасности управления доступом на основе ролей (RBAC) CsAdministrator или CsServerAdministrator либо членом настраиваемой роли RBAC, содержащей эти две группы. 
    
2. После установки средств отладки (LyncDebugTools.msi) перейдите в каталог расположения Snooper.exe с помощью проводника или из командной строки. По умолчанию средства отладки, находятся в C:\Program Files\Skype средства 2015\Debugging Business Server. Дважды щелкните файл Snooper.exe или запустите его.
    
3. После открытия Snooper щелкните правой кнопкой мыши пункт **File** (Файл), выберите пункт **Open File** (Открыть файл), найдите файлы журнала, выберите нужный файл в диалоговом окне **открытия файла** и нажмите кнопку **Open** (Открыть).
    
4. Файл журнала **трассировки** сообщения на **трассировки** вкладку перейдите на вкладку **сообщений** , чтобы просмотреть содержимое сообщения трассировки, собранные.
    
### <a name="to-display-a-call-flow-diagram"></a>Отображение схемы потока вызовов

1. Для использования Snooper и открытия файлов журналов требуется доступ на чтение файлов журналов. Чтобы использовать Snooper и получить доступ к файлам журналов, вы должны быть членом группы безопасности управления доступом на основе ролей (RBAC) CsAdministrator или CsServerAdministrator либо членом настраиваемой роли RBAC, содержащей эти две группы.
    
2. Откройте файл журнала и перейдите на вкладку **Messages** (Сообщения); выберите беседу в представлении сообщений или выберите компонент трассировки на вкладке **Trace** (Трассировка).
    
3. Нажмите **Call Flow** (Поток вызовов).
    
> [!NOTE]
> Если щелкнуть сообщение или трассировки, который не является частью поток вызовов, диаграмма не будет выглядеть и появится сообщение о состоянии в нижней части Snooper о том, «это сообщение не подходит для callfow». Выберите другое сообщение или трассировку, и если это сообщение или трассировка является частью потока вызовов, то появится поток вызовов. 
  
4. Пройдите по строкам сообщений или трассировки и обратите внимание, отображают ли обновления или изменения схемы потока вызовов новую схему.
    
5. Помещайте указатель мыши поверх элементов, чтобы получить сведения о сообщениях, конечных точках и других компонентах вызовов.
