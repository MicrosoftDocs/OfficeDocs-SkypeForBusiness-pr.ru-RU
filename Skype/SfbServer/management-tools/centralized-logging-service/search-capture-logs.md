---
title: Журналы захвата поиска, созданные службой централизованного ведения журналов в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 12/20/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 1b75b218-d84f-47a7-8a0a-b7e016b1cc79
description: Сводка. Узнайте, как искать и читать журналы записи централизованной службы ведения журналов в Skype для бизнеса Server 2015.
ms.openlocfilehash: 1a030e18f9e59fa26c4bd51aa8c6e69dd96004ba
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49835129"
---
# <a name="search-capture-logs-created-by-the-centralized-logging-service-in-skype-for-business-server-2015"></a>Журналы захвата поиска, созданные службой централизованного ведения журналов в Skype для бизнеса Server 2015
 
**Сводка:** Learn how to search and read Centralized Logging Service capture logs in Skype for Business Server 2015.
  
Функции поиска в централизованной службе ведения журналов полезны и полезны по следующим причинам: 
  
- Процесс и результаты поиска выполняются на одном компьютере, в пуле, на сайте или в глобальной области в зависимости от заданных критериев.
    
- Поиск может изначально выполняться в широком диапазоне с последующим уточнением до более узких критериев (время, компонент или компьютер). При поиске по тем же журналам не требуется повторно запускать сеанс ведения журнала при смене критериев поиска.
    
- Выполняется сбор результатов поиска со всех компьютеров и из пулов в области, создание коллекции и объединение результатов поисков в единый файл вывода, представляющий результаты использования условий поиска (с ограничением до выполняемых сценариев и данных, получаемых сценариями). При этом для чтения файла вывода и сообщений трассировки во всей среде используется хорошо знакомый инструмент (например, **Snooper** или **Блокнот**).
    
CLSAgent на каждом отдельном компьютере создает журналы в соответствии со сценарием или сценариями (в любое время на компьютере можно выполнять одновременно два сценария). Управление журналами и связанными с ними файлы индекса и кэша осуществляется посредством CLSAgent. При определении критериев и выполнении поиска команда поиска сообщает CLSAgent, какие данные требуется получить. CLSAgent направляет запрос в файлы журнала, кэша и индекса и возвращает результаты поиска в CLSContoller. CLSController получает результаты поиска от всех компьютеров и объединяет их в пул в области поиска. Затем CLSController объединяет журналы и помещает их в порядке изменения времени (первыми идут самые старые записи, последними - самые новые).
  
После каждой операции поиска запускается командлет **Sync-CsClsLogging**, который выполняет очистку кэша, используемого операциями поиска (не следует путать с файлами кэша, обслуживаемыми CLSAgent). Очистка кэша позволяет убедиться в том, что журнал и буфер записи файлов трассировки в CLSController свободны для следующей операции поиска.
  
Чтобы воспользоваться преимуществами службы централизованного ведения журналов, необходимо хорошо понимать, как настроить поиск для возврата только сообщений трассировки из журналов компьютера и пула, которые имеют отношение к исследуемой проблеме. issues
  
Чтобы запустить функции поиска службы централизованного ведения журналов с помощью оболочки управления Skype для бизнеса Server, необходимо быть участником групп безопасности управления доступом на основе ролей (RBAC) CsAdministrator или CsServerAdministrator или настраиваемой роли RBAC, которая содержит какую-либо из этих двух групп. Чтобы получить список всех ролей RBAC, которые были назначены этому командлету (включая все самостоятельно созданные роли RBAC), запустите следующую команду в командной Windows PowerShell Skype для бизнеса Server или командной Windows PowerShell командной Windows PowerShell:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Skype for Business Server 2015 cmdlet"}
```

Пример:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}
```

Остальная часть данного раздела посвящена способам определения критериев поиска в целях оптимизации диагностики.
  
### <a name="to-run-a-basic-search-by-using-the-centralized-logging-service"></a>Запуск базового поиска с помощью службы централизованного ведения журналов

1. Запустите оболочку управления Skype для бизнеса Server: нажмите кнопку "Начните", выберите "Все программы", "Skype для бизнеса **2015",** а затем щелкните "Skype для бизнеса Server Management **Shell".**
    
2. Убедитесь в том, что в глобальной области среды выполняется сценарий AlwaysOn, после чего введите в командной строке следующее:
    
   ```PowerShell
   Search-CsClsLogging -OutputFilePath <string value of path and file to write the output file>
   ```

> [!NOTE]
> По умолчанию Search-CsClsLogging отправляет результаты поиска на консоль. Если вы хотите сохранить результаты поиска в файл, используйте -OutputFilePath. _\<string fully qualified file path\>_ Чтобы определить параметр -OutputFilePath, включаем путь и имя файла в виде части параметра в строковом формате, заключенном в кавычках (например, C:\LogFiles\SearchOutput.txt). В этом примере необходимо убедиться в том, что каталог C:\LogFiles существует, и у вас есть разрешения для чтения и записи файлов в этот каталог (разрешение NTFS Modify). Выполняется добавление выходных данных, но не их перезапись. Чтобы создать отдельные файлы, определите уникально идентифицируемое имя файлы для каждой операции поиска. 
  
Пример:
    
  ```PowerShell
  Search-CsClsLogging -OutputFilePath "C:\LogFiles\logfile.txt"
  ```

### <a name="to-run-a-basic-search-on-a-pool-or-computer-by-using-the-centralized-logging-service"></a>Запуск базового поиска в пуле или на компьютере с помощью службы централизованного ведения журналов

1. Чтобы ограничить поиск определенным пулом или компьютером, используйте параметр -Computers с компьютером, определенным с использованием полного имени компьютера, заключенного в кавычках и разделенного запятой следующим образом:
    
   ```PowerShell
   Search-CsClsLogging -Computers <string value of computer names> -OutputFilePath <string value of path and file to write the output file>
   ```

Пример:
    
  ```PowerShell
  Search-CsClsLogging -Computers "fe01.contoso.net" -OutputFilePath "C:\LogFiles\logfile.txt"
  ```

2. Чтобы выполнить поиск по нескольким компьютерам, введите несколько имен компьютеров в кавычках с разделением запятыми. Например:
    
   ```PowerShell
   Search-CsClsLogging -Computers "fe01.contoso.net", "fe02.contoso.net", "fe03.contoso.net" -OutputFilePath "C:\LogFiles\logfile.txt"
   ```

3. Если требуется искать весь пул, а не один компьютер, измените параметр -Computers на -Pools, удалите имя компьютера и замените его пулом или пулами в кавычках, разделенных запятой.
    
    Пример:
    
   ```PowerShell
   Search-CsClsLogging -Pools "pool01.contoso.net" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

4. При использовании команд поиска пулами может быть любой пул в развертывании, например пулы переднего сервера, пулы edge, пулы серверов сохраняемой беседы или другие пулы, определенные в качестве пула в развертывании.
    
    Пример:
    
   ```PowerShell
   Search-CsClsLogging -Pools "pool01.contoso.net", "pchatpool01.contoso.net", "intedgepool01.contoso.net" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

### <a name="to-run-a-search-by-using-time-parameters"></a>Выполнение поиска с использованием параметров времени

1. Запустите оболочку управления Skype для бизнеса Server: нажмите кнопку "Начните", выберите "Все программы", "Skype для бизнеса **2015",** а затем щелкните "Skype для бизнеса Server Management **Shell".**
    
2. По умолчанию время начала для параметров поиска составляет 25 минут до пяти минут после начала поиска. Другими словами, при поиске в 16:00 время начала поиска будет 15:35:00 до 16:05:00. Если требуется поиск за 60 минут или 3 часа до текущего времени, используйте параметр -StartTime и заданную строку даты и времени, чтобы указать время начала поиска. 
    
    Например, с помощью -StartTime и -EndTime для определения времени и диапазона дат можно определить поиск в пуле с 08:00 до 9:00 20.11.2012. Также можно задать путь для записи результатов в файл с именем :\logfile.txt:
    
   ```PowerShell
   Search-CsClsLogging -Pools "pool01.contoso.net" -StartTime "11/20/2012 08:00:00 AM" -EndTime "11/20/2012 09:00:00 AM" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

> [!NOTE]
> Указанная строка времени и даты может быть "date time" или "time date". Команда разберет строку и будет использовать соответствующие значения для даты и времени, а также региональные параметры и региональные параметры на компьютере, на который вы используете командлет. 
  
3. Если вы хотите получить журналы, начиная с 11:00:00 20.11.2012, определите -StartTime. Диапазон времени по умолчанию для поиска составляет 30 минут, если не определено конкретное значение -EndTime. В результате поиск возвращает журналы с определенного компьютера или пула за период с 11:00 до 11:30.
    
Пример:
    
  ```PowerShell
  Search-CsClsLogging -Pools "pool01.contoso.net" -StartTime "11/20/2012 11:00:00 AM" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

4. Чтобы провести поиск журналов в течение определенного периода времени, определите -StartTime и -EndTime. Потребуются журналы за период с 13:00 до 14:45 для компьютера edge01.contoso.net. 
    
Пример:
    
  ```
  Search-CsClsLogging -Computers "edge01.contoso.net" -StartTime "11/20/2012 1:00:00 PM" -EndTime "11/20/2012 2:45:00 PM" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

### <a name="to-run-an-advanced-search-by-using-other-criteria-and-matching-options"></a>Выполнение расширенного поиска с использованием других критериев и параметров сопоставления

1. Запустите оболочку управления Skype для бизнеса Server: нажмите кнопку "Начните", выберите "Все программы", "Skype для бизнеса **2015",** а затем щелкните "Skype для бизнеса Server Management **Shell".**
    
2. Чтобы выполнить команду сбора трассировок для заданных компонентов, введите следующий текст:
    
   ```PowerShell
   Search-CsClsLogging -Components <components to search on> -OutputFilePath <fully qualified path to output logs>
   ```

Пример:
    
  ```PowerShell
  Search-CsClsLogging -Components "SIPStack","S4","UserServices" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

В результате поиск возвращает все записи в журнале, которые содержат компоненты трассировки для SIPStack, S4 и UserServices, для всех компьютеров и пулов в среде за последние 30 минут.
    
3. Чтобы ограничить поиск с помощью тех же компонентов только пулом переднего pool01.contoso.net, введите:
    
   ```PowerShell
   Search-CsClsLogging -Components "SIPStack","S4","UserServices" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

4. По умолчанию для команд, содержащих несколько параметров, используется следующая логика поиска: логический оператор OR с каждым из определенных параметров. Это поведение можно изменить, указав параметр **-MatchAll.** Для этого введите следующий текст:
    
   ```PowerShell
   Search-CsClsLogging -CallId "d0af828e49fa4dcb99f5f80223a634bc" -Components "SIPStack","S4","UserServices" -MatchAll -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

5. Если для сценариев задано постоянное выполнение (например, AlwaysOn), или определены сценарии длительного выполнения, журналы могут быть перемещены с локального компьютера в сетевую общую папку. Общая папка определяется параметром CacheFileNetworkFolder с использованием командлета New-CsClsConfiguration для создания новой или изменения текущей конфигурации с помощью Set-CsClsConfiguration. Если включать общую папку в коллекцию журналов для поиска не требуется, используйте параметр SkipNetworkLogs, как показано далее:
    
   ```PowerShell
   Search-CsClsLogging -Components "SIPStack","S4","UserServices" -StartTime "11/1/2012 00:00:01 AM" -EndTime "11/20/2012 2:45:00 PM" -SkipNetworkLogs -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

## <a name="read-capture-logs-from-the-centralized-logging-service"></a>Чтение журналов захвата из службы централизованного ведения журналов

Вы поймете настоящее преимущество службы централизованного ведения журналов после запуска поиска и у вас есть файл, который можно использовать для отслеживания проблемы, о чем сообщается. Существует несколько способов чтения файла. Выходной файл имеет стандартный текстовый формат, и вы можете использовать Notepad.exe другие программы, которые позволят открыть и прочитать текстовый файл. Для больших файлов и более сложных проблем можно использовать такое средство, как Snooper.exe, предназначенное для чтения и анализа выходных данных журналов из службы централизованного ведения журналов. Snooper входит в состав средств отлаки, доступных для отдельной загрузки. Вы можете скачать средства отлаки [https://go.microsoft.com/fwlink/?LinkId=285257](https://go.microsoft.com/fwlink/?LinkId=285257) здесь: При установке средств отлаживки короткие резки и пункты меню не создаются. After you install the Debug Tools, open Windows Explorer, a command-line window, or Skype for Business Server Management Shell and go to the directory (default location) C:\Program Files\Skype for Business Server 2015\Debugging Tools. Дважды щелкните Snooper.exe или введите Snooper.exe, а затем нажмите ввод, если вы используете командную строку или командную командную строку Skype для бизнеса Server.
  
> [!IMPORTANT]
> Цель этого раздела — не подробно и не обсуждение методов устранения неполадок. Устранение неполадок и процессы вокруг него — сложная тема. Подробные сведения об устранении неполадок, а также об устранении определенных рабочих нагрузок см. в книге microsoft Lync Server 2010 Resource Kit по этой [https://go.microsoft.com/fwlink/p/?linkId=211003](https://go.microsoft.com/fwlink/p/?linkId=211003) теме. Процессы и процедуры по-прежнему применимы к Skype для бизнеса Server 2015. 
  
### <a name="to-open-a-log-file-in-snooper"></a>Открытие файла журнала в Snooper

1. Чтобы использовать Snooper и открывать файлы журналов, необходим доступ на чтение к файлам журнала. Чтобы использовать Snooper и получить доступ к файлам журнала, необходимо быть членом группы безопасности управления доступом на основе ролей (RBAC) CsAdministrator или CsServerAdministrator или настраиваемой роли RBAC, которая содержит какую-либо из этих двух групп. 
    
2. После установки средств отладки (LyncDebugTools.msi) измените каталог на расположение Snooper.exe с помощью проводника Windows или из командной строки. По умолчанию средства отладки находятся в папке C:\Program Files\Skype для бизнеса Server 2015\Debugging Tools. Дважды щелкните или запустите Snooper.exe.
    
3. После открытия Snooper щелкните правой кнопкой мыши **файл,** выберите **OpenFile,** найдите файлы журнала, выберите файл в диалоговом окне "Открыть" и нажмите кнопку **"Открыть".** 
    
4. Сообщения трассировки  файла журнала отображаются на вкладке **"Трассировка".** Щелкните **вкладку** "Сообщения", чтобы просмотреть содержимое собранных трассировок.
    
### <a name="to-display-a-call-flow-diagram"></a>Отображение схемы потока вызовов

1. Чтобы использовать Snooper и открывать файлы журналов, необходим доступ на чтение к файлам журнала. Чтобы использовать Snooper и получить доступ к файлам журнала, необходимо быть членом группы безопасности управления доступом на основе ролей (RBAC) CsAdministrator или CsServerAdministrator или настраиваемой роли RBAC, которая содержит какую-либо из этих двух групп.
    
2. Откройте файл журнала и  щелкните вкладку "Сообщения", выберите беседу в представлении сообщений или выберите компонент трассировки на вкладке **"Трассировка".**
    
3. Щелкните **"Поток вызовов"**.
    
> [!NOTE]
> Если щелкнуть сообщение или трассировку, которые не являются частью потока вызовов, схема не будет отображаться, а в нижней части Snooper появится сообщение о состоянии "Это сообщение не имеет права на вызов". Выберите другое сообщение или трассировку, и поток вызовов будет отображаться, если сообщение или трассировка являются частью потока вызовов. 
  
4. Переходить по строкам "Сообщения" или "Трассировка" и учтите, обновляется ли схема потока вызовов для отображения новой схемы.
    
5. Наведите курсор на элементы, чтобы получить сведения о сообщениях вызова, конечных точках и других компонентах.
