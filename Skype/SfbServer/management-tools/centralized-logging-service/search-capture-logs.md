---
title: Журналы захвата поиска, созданные централизованной службой ведения журнала в Skype для бизнеса Server 2015 г.
ms.reviewer: ''
ms.author: v-mahoffman
author: HowlinWolf-92
manager: serdars
ms.date: 12/20/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.collection: IT_Skype16
ms.assetid: 1b75b218-d84f-47a7-8a0a-b7e016b1cc79
description: Сводка. Узнайте, как искать и читать журналы захвата централизованной службы ведения журнала в Skype для бизнеса Server 2015 г.
ms.openlocfilehash: a65fac6ffc96088cd1e544ed17914128d040e2b6
ms.sourcegitcommit: 67324fe43f50c8414bb65c52f5b561ac30b52748
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2021
ms.locfileid: "60831923"
---
# <a name="search-capture-logs-created-by-the-centralized-logging-service-in-skype-for-business-server-2015"></a>Журналы захвата поиска, созданные централизованной службой ведения журнала в Skype для бизнеса Server 2015 г.
 
**Сводка:** Узнайте, как искать и читать журналы захвата службы централизованного ведения журнала в Skype для бизнеса Server 2015 г.
  
Функции поиска в централизованной службе ведения журнала полезны и мощны по следующим причинам: 
  
- Процесс и результаты поиска выполняются на одном компьютере, в пуле, на сайте или в глобальной области в зависимости от заданных критериев.
    
- Поиск может изначально выполняться в широком диапазоне с последующим уточнением до более узких критериев (время, компонент или компьютер). При смене критериев поиска вам не нужно повторно запускать сеанс ведения журнала в одном журнале.
    
- Выполняется сбор результатов поиска со всех компьютеров и из пулов в области, создание коллекции и объединение результатов поисков в единый файл вывода, представляющий результаты использования условий поиска (с ограничением до выполняемых сценариев и данных, получаемых сценариями). При этом для чтения файла вывода и сообщений трассировки во всей среде используется хорошо знакомый инструмент (например, **Snooper** или **Блокнот**).
    
CLSAgent на каждом отдельном компьютере создает журналы в соответствии со сценарием или сценариями (в любое время на компьютере можно выполнять одновременно два сценария). Управление журналами и связанными с ними файлы индекса и кэша осуществляется посредством CLSAgent. При определении критериев и выполнении поиска команда поиска сообщает CLSAgent, какие данные требуется получить. CLSAgent направляет запрос в файлы журнала, кэша и индекса и возвращает результаты поиска в CLSContoller. CLSController получает результаты поиска от всех компьютеров и объединяет их в пул в области поиска. Затем CLSController объединяет журналы и помещает их в порядке изменения времени (первыми идут самые старые записи, последними - самые новые).
  
После каждой операции поиска запускается командлет **Sync-CsClsLogging**, который выполняет очистку кэша, используемого операциями поиска (не следует путать с файлами кэша, обслуживаемыми CLSAgent). Очистка кэша позволяет убедиться в том, что журнал и буфер записи файлов трассировки в CLSController свободны для следующей операции поиска.
  
Чтобы получить наибольшее преимущество от централизированной службы ведения журнала, необходимо хорошо понять, как настроить поиск, чтобы возвращать только следовые сообщения из журналов компьютера и пула, которые имеют отношение к проблеме, которую вы исследуете. проблемы
  
Чтобы запустить функции поиска службы централизованного ведения журнала с помощью Skype для бизнеса Server Management Shell, необходимо быть членом группы безопасности CsSAdministrator или группы управления ролями CsServerAdministrator (RBAC) или настраиваемой роли RBAC, которая содержит обе эти группы. Чтобы вернуть список всех ролей RBAC, которые были назначены этому командлету (включая настраиваемые роли RBAC, созданные вами самостоятельно), запустите следующую команду из командной Skype для бизнеса Server или Windows PowerShell запроса:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Skype for Business Server 2015 cmdlet"}
```

Пример:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}
```

Остальная часть данного раздела посвящена способам определения критериев поиска в целях оптимизации диагностики.
  
### <a name="to-run-a-basic-search-by-using-the-centralized-logging-service"></a>Для запуска базового поиска с помощью централизированной службы ведения журнала

1. Запустите Skype для бизнеса Server: нажмите кнопку Начните, щелкните Все **программы,** нажмите кнопку Skype для бизнеса **2015,** а затем нажмите кнопку **Skype для бизнеса Server.**
    
2. Убедитесь в том, что в глобальной области среды выполняется сценарий AlwaysOn, после чего введите в командной строке следующее:
    
   ```PowerShell
   Search-CsClsLogging -OutputFilePath <string value of path and file to write the output file>
   ```

> [!NOTE]
> По умолчанию Search-CsClsLogging отправляет результаты поиска на консоль. Если вы хотите сохранить результаты поиска в файле, используйте -OutputFilePath  _\<string fully qualified file path\>_ . Чтобы определить параметр -OutputFilePath, поставляем путь и имя файла в рамках параметра в формате строки, заключенной в кавычках (например, C:\LogFiles\SearchOutput.txt). В этом примере необходимо убедиться в том, что каталог C:\LogFiles существует, и у вас есть разрешения для чтения и записи файлов в этот каталог (разрешение NTFS Modify). Выполняется добавление выходных данных, но не их перезапись. Чтобы создать отдельные файлы, определите уникально идентифицируемое имя файлы для каждой операции поиска. 
  
Пример:
    
  ```PowerShell
  Search-CsClsLogging -OutputFilePath "C:\LogFiles\logfile.txt"
  ```

### <a name="to-run-a-basic-search-on-a-pool-or-computer-by-using-the-centralized-logging-service"></a>Для запуска базового поиска на пуле или компьютере с помощью централизированной службы ведения журнала

1. Чтобы ограничить поиск определенным пулом или компьютером, используйте параметр -Computers с компьютером, определенным компьютером с полностью квалифицированным именем, заключенным в кавычках и разделенным запятой следующим образом:
    
   ```PowerShell
   Search-CsClsLogging -Computers <string value of computer names> -OutputFilePath <string value of path and file to write the output file>
   ```

Пример:
    
  ```PowerShell
  Search-CsClsLogging -Computers "fe01.contoso.net" -OutputFilePath "C:\LogFiles\logfile.txt"
  ```

2. Чтобы выполнить поиск по нескольким компьютерам, введите несколько имен компьютеров в кавычках с разделением запятыми. Например:
    
   ```PowerShell
   Search-CsClsLogging -Computers "fe01.contoso.net", "fe02.contoso.net", "fe03.contoso.net" -OutputFilePath "C:\LogFiles\logfile.txt"
   ```

3. Если требуется искать весь пул вместо одного компьютера, измените параметр -Computers на -Pools, удалите имя компьютера и замените его пулом или пулами в кавычках, разделенных запятой.
    
    Например:
    
   ```PowerShell
   Search-CsClsLogging -Pools "pool01.contoso.net" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

4. При использовании команд поиска пулы могут быть любым пулом в развертывании, например пулами переднего конца, пулами edge, пулами сохраняемой системы чат-сервера или другими пулами, которые определяются как пул в развертывании.
    
    Пример:
    
   ```PowerShell
   Search-CsClsLogging -Pools "pool01.contoso.net", "pchatpool01.contoso.net", "intedgepool01.contoso.net" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

### <a name="to-run-a-search-by-using-time-parameters"></a>Выполнение поиска с использованием параметров времени

1. Запустите Skype для бизнеса Server: нажмите кнопку Начните, щелкните Все **программы,** нажмите кнопку Skype для бизнеса **2015,** а затем нажмите кнопку **Skype для бизнеса Server.**
    
2. По умолчанию время начала для параметров, определенных времени поиска, составляет 25 минут до пяти минут после начала поиска. Другими словами, если мы будем искать в 16:00, время начала поиска будет демонстрироваться с 3:35:00 до 16:05. Если требуется искать за 60 минут или 3 часа до текущего времени, используйте параметр -StartTime и установите строку даты и времени, чтобы указать время начала поиска. 
    
    Например, с помощью -StartTime и -EndTime для определения диапазона времени и даты можно определить поиск между 8:00 и 9:00 11.20.2012 в пуле. Также можно задать путь для записи результатов в файл с именем :\logfile.txt:
    
   ```PowerShell
   Search-CsClsLogging -Pools "pool01.contoso.net" -StartTime "11/20/2012 08:00:00 AM" -EndTime "11/20/2012 09:00:00 AM" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

> [!NOTE]
> Указанная строка времени и даты может быть "дата" или "дата". Команда разберет строку и будет использовать соответствующие значения для даты и времени, а также параметры локального и культурного параметров на компьютере, на который запущен командлет. 
  
3. Если вы хотите получить журналы, начиная с 11:00:00 11.20.2012, вы определяете -StartTime. Диапазон времени поиска по умолчанию составляет 30 минут, если только не будет определено определенное значение -EndTime. В результате поиск возвращает журналы с определенного компьютера или пула за период с 11:00 до 11:30.
    
Пример:
    
  ```PowerShell
  Search-CsClsLogging -Pools "pool01.contoso.net" -StartTime "11/20/2012 11:00:00 AM" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

4. Чтобы провести поиск журналов в течение определенного периода времени, определите -StartTime и -EndTime. Потребуются журналы за период с 13:00 до 14:45 для компьютера edge01.contoso.net. 
    
Пример:
    
  ```
  Search-CsClsLogging -Computers "edge01.contoso.net" -StartTime "11/20/2012 1:00:00 PM" -EndTime "11/20/2012 2:45:00 PM" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

### <a name="to-run-an-advanced-search-by-using-other-criteria-and-matching-options"></a>Выполнение расширенного поиска с использованием других критериев и параметров сопоставления

1. Запустите Skype для бизнеса Server: нажмите кнопку Начните, щелкните Все **программы,** нажмите кнопку Skype для бизнеса **2015,** а затем нажмите кнопку **Skype для бизнеса Server.**
    
2. Чтобы выполнить команду сбора трассировок для заданных компонентов, введите следующий текст:
    
   ```PowerShell
   Search-CsClsLogging -Components <components to search on> -OutputFilePath <fully qualified path to output logs>
   ```

Пример:
    
  ```PowerShell
  Search-CsClsLogging -Components "SIPStack","S4","UserServices" -OutputFilePath "C:\Logfiles\logfile.txt"
  ```

В результате поиск возвращает все записи в журнале, которые содержат компоненты трассировки для SIPStack, S4 и UserServices, для всех компьютеров и пулов в среде за последние 30 минут.
    
3. Чтобы ограничить поиск с одинаковыми компонентами только для вашего пула переднего pool01.contoso.net, введите:
    
   ```PowerShell
   Search-CsClsLogging -Components "SIPStack","S4","UserServices" -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

4. По умолчанию для команд, содержащих несколько параметров, используется следующая логика поиска: логический оператор OR с каждым из определенных параметров. Это поведение можно изменить, указав параметр **-MatchAll.** Для этого введите следующий текст:
    
   ```PowerShell
   Search-CsClsLogging -CallId "d0af828e49fa4dcb99f5f80223a634bc" -Components "SIPStack","S4","UserServices" -MatchAll -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

5. Если для сценариев задано постоянное выполнение (например, AlwaysOn), или определены сценарии длительного выполнения, журналы могут быть перемещены с локального компьютера в сетевую общую папку. Общая папка определяется параметром CacheFileNetworkFolder с использованием командлета New-CsClsConfiguration для создания новой или изменения текущей конфигурации с помощью Set-CsClsConfiguration. Если включать общую папку в коллекцию журналов для поиска не требуется, используйте параметр SkipNetworkLogs, как показано далее:
    
   ```PowerShell
   Search-CsClsLogging -Components "SIPStack","S4","UserServices" -StartTime "11/1/2012 00:00:01 AM" -EndTime "11/20/2012 2:45:00 PM" -SkipNetworkLogs -OutputFilePath "C:\Logfiles\logfile.txt"
   ```

## <a name="read-capture-logs-from-the-centralized-logging-service"></a>Чтение журналов захвата из централизированной службы ведения журнала

Вы понимаете реальную пользу централизированной службы ведения журнала после запуска поиска, и у вас есть файл, который можно использовать для отслеживания сообщаемой проблемы. Существует несколько способов чтения файла. Файл вывода находится в стандартном текстовом формате, и вы можете использовать Notepad.exe другие программы, которые позволят открывать и читать текстовый файл. Для больших файлов и более сложных проблем можно использовать средство типа Snooper.exe, предназначенное для чтения и анализа выходных данных журналов из централизированной службы ведения журнала. Snooper включен с помощью средств отлаговки, доступных в качестве отдельной загрузки. Вы можете скачать средства отлаговки здесь: [https://go.microsoft.com/fwlink/?LinkId=285257](https://go.microsoft.com/fwlink/?LinkId=285257) . При установке средств отлаживки короткие сокращения и элементы меню не создаются. После установки средств отладки откройте Windows Explorer, окно командной строки или командную командную оболочку Skype для бизнеса Server и перейдите в каталог (расположение по умолчанию) C:\Program Files\Skype для бизнеса Server 2015\Debugging Tools. Дважды щелкните Snooper.exe или введите Snooper.exe, а затем нажмите кнопку ENTER, если вы используете командную строку или Skype для бизнеса Server командную оболочку.
  
> [!IMPORTANT]
> Цель этой темы не в том, чтобы подробно и не обсуждать методы устранения неполадок. Устранение неполадок и процессы вокруг него — сложный вопрос. Подробные сведения об устранении неполадок и устранении определенных рабочих нагрузок см. в книге Набор ресурсов Microsoft Lync Server 2010. [https://go.microsoft.com/fwlink/p/?linkId=211003](https://go.microsoft.com/fwlink/p/?linkId=211003) Процессы и процедуры по-прежнему применяются к Skype для бизнеса Server 2015 г. 
  
### <a name="to-open-a-log-file-in-snooper"></a>Открытие файла журнала в Snooper

1. Чтобы использовать Snooper и открывать файлы журналов, необходимо прочитать доступ к файлам журнала. Чтобы использовать Snooper и получить доступ к файлам журнала, необходимо быть членом групп безопасности CsAdministrator или CsServerAdministrator для управления доступом на основе ролей (RBAC) или настраиваемой роли RBAC, которая содержит обе эти две группы. 
    
2. После установки средств отладки (LyncDebugTools.msi) измените каталог на расположение Snooper.exe с помощью Windows Explorer или из командной строки. По умолчанию средства отладки расположены в C:\Program Files\Skype для бизнеса Server 2015\Debugging Tools. Дважды щелкните или запустите Snooper.exe.
    
3. После открытия Snooper щелкните правой кнопкой мыши **Файл,** щелкните **OpenFile,** найдите файлы журнала, выберите файл в диалоговом окне Открыть и нажмите кнопку **Открыть**. 
    
4. Сообщения трассировки файла **журнала** отображаются на вкладке **Trace.** Щелкните **вкладку Сообщения,** чтобы просмотреть содержимое сообщений собранных следов.
    
### <a name="to-display-a-call-flow-diagram"></a>Отображение схемы потока вызовов

1. Чтобы использовать Snooper и открывать файлы журналов, необходимо прочитать доступ к файлам журнала. Чтобы использовать Snooper и получить доступ к файлам журналов, необходимо быть членом групп безопасности CsAdministrator или CsServerAdministrator для управления доступом на основе ролей (RBAC) или настраиваемой роли RBAC, которая содержит обе эти две группы.
    
2. Откройте файл журнала и нажмите вкладку **Сообщения,** выберите беседу в представлении сообщений или выберите компонент трассировки на вкладке **Trace.**
    
3. Нажмите **кнопку Вызов Flow**.
    
> [!NOTE]
> Если щелкнуть сообщение или трассировку, не входящую в поток вызовов, схема не появится, а в нижней части Snooper появится сообщение о состоянии с указанием "Это сообщение не имеет права на вызов". Выберите другое сообщение или трассировку, и поток вызовов появится, если сообщение или трассировка являются частью потока вызовов. 
  
4. Перемещение по линиям Сообщения или трассировка и обратите внимание, обновляется или изменяется схема потока вызовов для отображения новой схемы.
    
5. Наведите курсор на элементы, чтобы получить сведения о сообщениях вызовов, конечных точках и других компонентах.
