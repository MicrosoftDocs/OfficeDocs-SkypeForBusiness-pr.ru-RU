---
title: Настройка поставщиков для централизованной службы ведения журнала в Skype для бизнеса Server 2015 г.
ms.reviewer: null
ms.author: serdars
author: SerdarSoysal
manager: serdars
ms.date: 2/1/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
  - NOCSH
ms.localizationpriority: medium
ms.collection: IT_Skype16
ms.assetid: 6a197ecf-b56b-45e0-8e7c-f532ec5164ff
description: Сводка. Сведения о настройке поставщиков сценариев для централизированной службы ведения журнала в Skype для бизнеса Server 2015 г.
---

# <a name="configure-providers-for-centralized-logging-service-in-skype-for-business-server-2015"></a>Настройка поставщиков для централизованной службы ведения журнала в Skype для бизнеса Server 2015 г.
 
**Сводка:** Узнайте, как настроить поставщиков сценариев для централизованной службы ведения журнала в Skype для бизнеса Server 2015 г.
  
Концепции и конфигурация поставщиков в централизованной службе ведения журнала — одна из наиболее важных для понимания. Theproviders map directly to Skype для бизнеса Server server role components in the Skype для бизнеса Server tracing model. Поставщик определяет компоненты Skype для бизнеса Server 2015 г., тип сообщений (например, фатальные, ошибки или предупреждения) для сбора, а также флаги (например, TF_Connection или TF_Diag). Поставщики являются отслеживаемыми компонентами в каждой Skype для бизнеса Server роли сервера. С помощью поставщиков определяется уровень и тип отслеживания компонентов (например, S4, SIPStack, IM и Presence). Определенный поставщик используется в сценарии для группы всех поставщиков для определенной логической коллекции, которая решает определенное условие проблемы.
  
Чтобы запустить функции службы централизованного ведения журнала с помощью Skype для бизнеса Server Management Shell, необходимо быть членом групп безопасности CsAdministrator или CsServerAdministrator, или настраиваемой роли RBAC, которая содержит обе эти группы. Чтобы вернуть список всех ролей управления доступом на основе ролей (RBAC), этим командлетам было назначено (включая любые настраиваемые роли RBAC, созданные самостоятельно), запустите следующую команду из командной Skype для бизнеса Server или Windows PowerShell запроса:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Skype for Business Server 2015 cmdlet"}
```

Пример:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}
```

В остальной части этого раздела основное внимание уделяется определению поставщиков, изменению поставщика и определению поставщика для оптимизации устранения неполадок. Существует два способа выдачи команд централизованной службы ведения журнала. Вы можете использовать CLSController.exe по умолчанию в каталоге C:\Program Files\Common Files\Skype для бизнеса Server 2015\CLSAgent. Или можно использовать командную Skype для бизнеса Server для выпуска Windows PowerShell команд. С помощью Windows PowerShell вы можете определить новых поставщиков для использования в сеансах ведения журнала, а также получить полный контроль над их созданием, тем, что они собирают и на каком уровне собирают данные.
  
> [!IMPORTANT]
> Как уже упоминалось, поставщики являются очень мощным средством. Однако сценарии имеют большее значение, так как объединяют в себе все данные, необходимые для определения и выполнения трассировок компонентов, представленных поставщиками. Сценарии, которые являются коллекциями поставщиков, можно сравнить с выполнением пакетного файла, содержащего сотни команд, для сбора большого объема данных, что отличается от выполнения сотен команд по одной в командной строке. 
  
Вместо того, чтобы подробно копать сведения о поставщиках, централизованная служба ведения журнала предоставляет ряд сценариев, которые уже определены для вас. Предоставленные сценарии покрывают большое количество различных проблем и неполадок, которые могут возникнуть. В редких случаях может понадобиться создать и определить поставщиков и назначить их в сценарии. Настоятельно рекомендуется ознакомиться с каждым предоставленным сценарием, прежде чем создавать новых поставщиков и сценарии. Хотя здесь предоставляются сведения о создании поставщиков, чтобы вы могли ознакомиться с тем, как сценарии используют элементы поставщиков для сбора данных трассировок, сведения о самих поставщиках в настоящее время не предоставлены. 
  
В [службе централизованного ведения журнала в Skype для бизнеса 2015](centralized-logging-service.md) г. основными элементами определения поставщика для использования в сценарии являются:
  
- **Поставщики** Если вы знакомы с OCSLogger, поставщики — это компоненты, которые необходимо сообщить OCSLogger, из чего должен собирать журналы двигатель отслеживания. Поставщики — это те же компоненты, а во многих случаях их имя совпадает с компонентами в OCSLogger. Если вы не знакомы с OCSLogger, поставщики являются серверными компонентами, из них централизованная служба ведения журнала может собирать журналы. В случае службы централизованного ведения журнала CLSAgent является архитектурной частью службы централизованного ведения журнала, которая отслеживает компоненты, которые определяются в конфигурации поставщиков.
    
- **Уровни ведения журнала** OCSLogger предоставил возможность выбора нескольких уровней детализации для собранных данных. Эта функция является неотъемлемой частью централизированной службы ведения журнала и сценариев и определяется **параметром Type** . Вы можете выбрать следующие параметры.
    
  - **Все** Собирает в журнал сведения о типе фатальных, ошибок, предупреждений, многословных и отлаговок в журнал для определенного поставщика.
    
  - **Fatal** Собирает только сообщения трассировки, определенные как "Fatal".
    
  - **Ошибка** Собирает только сообщения трассировки, определенные как "Ошибка" или "Fatal".
    
  - **Предупреждение** Собирает только следовые сообщения типа "Warning", "Error" и "Fatal".
    
  - **Info** Собирает только сообщения трассировки, которые указывают информационное сообщение для определенного поставщика, а также сообщения со смертельным исходом, ошибки и предупреждения.
    
  - **Verbose** Собирает все сообщения трассировки типа со смертельным исходом, ошибками, предупреждениями и подробными для определенного поставщика.
    
  - **Отламывка** , по сути, эквивалентна "All" - собирает следы типа Fatal, Error, Warning, Info, Verbose и Debug для определенного поставщика.
    
- **Флаги** OCSLogger предоставил возможность выбора флажков для каждого поставщика, определяя тип данных, которые можно получить из файлов трассировки. В зависимости от поставщика можно задать следующие флаги:
    
  - **TF_Connection** Предоставляет записи журналов, связанных с подключением. Эти журналы включают сведения о подключениях к определенному компоненту. Кроме того, может быть включен большой объем сведений сетевого уровня (то есть для компонентов без концепции подключения).
    
  - **TF_Security** Предоставляет все события и записи журнала, связанные с безопасностью. Например, для SipStack, это события безопасности, такие как ошибки проверки домена и ошибки проверки подлинности и авторизации клиентов.
    
  - **TF_Diag** Предоставляет события диагностики, которые можно использовать для диагностики или устранения неполадок компонента. Например, для SipStack это ошибки сертификатов или ошибки/предупреждения, связанные с DNS.
    
  - **TF_Protocol** Предоставляет протокольные сообщения, такие как SIP и Community codec Pack.
    
  - **TF_Component** Включает ведение журнала на компонентах, указанных в составе поставщиков.
    
  - **Все** Задает все доступные флаги, доступные для поставщика.
    
### <a name="to-review-information-about-existing-centralized-logging-service-scenario-providers"></a>Просмотр сведений о существующих поставщиках сценариев централизованной службы ведения журнала.

1. Запустите Skype для бизнеса Server: нажмите кнопку **Начните, нажмите** кнопку Все **программы, нажмите** кнопку Skype для бизнеса **2015**, а затем нажмите кнопку **Skype для бизнеса Server управленческой оболочки**.
    
2. Чтобы просмотреть конфигурацию существующих поставщиков, введите следующую команду:
    
   ```PowerShell
   Get-CsClsScenario -Identity <scope and scenario name>
   ```

    Например, чтобы просмотреть сведения о глобальном помощнике конференц-связи, введите следующее:
    
   ```PowerShell
   Get-CsClsScenario -Identity "global/CAA"
   ```

    Команда отображает список поставщиков со связанными флагами, параметрами и компонентами. Если отображаемой информации недостаточно или список слишком длинный для формата Windows PowerShell списка, можно отобразить дополнительные сведения, определив другой метод вывода. Для этого выполните следующую команду:
    
   ```PowerShell
   Get-CsClsScenario -Identity "global/CAA" | Select-Object -ExpandProperty Provider
   ```

    В выходе этой команды отображается каждый поставщик. Каждая запись состоит из пяти строк: имя поставщика, тип ведения журнала, уровень ведения журнала, флаги, GUID и роль. 
    
### <a name="to-define-a-new-centralized-logging-service-scenario-provider"></a>Определение нового поставщика сценариев централизованной службы ведения журнала.

1. Запустите Skype для бизнеса Server: нажмите кнопку **Начните, нажмите** кнопку Все **программы, нажмите** кнопку Skype для бизнеса **2015**, а затем нажмите кнопку **Skype для бизнеса Server управленческой оболочки**.
    
2. Поставщик сценария состоит из отслеживаемого компонента, используемых флагов и уровня детализации собираемых данных. Это определяется следующей командой:
    
   ```PowerShell
   $<variableName> = New-CsClsProvider -Name <provider component> -Type <log type> -Level <log level detail type> -Flags <provider trace log flags>
   ```

    Например, определение поставщика трассировки, которое указывает, что нужно собирать с поставщика Lyss и при каком уровне детализации, выглядит следующим образом.
    
   ```PowerShell
   $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Info" -Flags "All"
   ```

Уровень собирает сообщения со смертельным исходом, ошибки, предупреждения и сведения. Флаги, используемые для поставщика Lyss, включают TF_Connection, TF_Diag и TF_Protocol. После определения переменной $LyssProvider можно использовать ее с помощью **cmdlet New-CsClsScenario** для сбора следов от поставщика Lyss. Чтобы завершить создание и назначение поставщика новому сценарию, введите следующую команду:

```PowerShell
New-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider
```

где $LyssProvider — это переменная, содержащая определенный сценарий, созданный с помощью командлета **New-CsClsProvider**.
### <a name="to-change-an-existing-centralized-logging-service-scenario-provider"></a>Изменение существующего поставщика сценариев централизованной службы ведения журнала

1. Запустите Skype для бизнеса Server: нажмите кнопку **Начните, нажмите** кнопку Все **программы, нажмите** кнопку Skype для бизнеса **2015**, а затем нажмите кнопку **Skype для бизнеса Server управленческой оболочки**.
    
2. Чтобы обновить или изменить конфигурацию существующего поставщика, введите следующую команду:
    
   ```PowerShell
   $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "TF_Connection, TF_Diag"
   ```

    Затем обновите сценарий, чтобы назначить поставщика. Введите следующее:
    
   ```PowerShell
   Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider
   ```

Конечный результат выполнения команды — обновление флагов и уровня поставщика назначенного для сайта сценария: Redmond/RedmondLyssInfo. Новый сценарий можно просмотреть с помощью командлета Get-CsClsScenario. Дополнительные сведения см. в разделе [Get-CsClsScenario](/powershell/module/skype/get-csclsscenario?view=skype-ps).
> [!CAUTION]
> **New-ClsCsProvider** не определяет допустимость флагов. Убедитесь, что названия флагов указаны верно (например, TF_DIAG или TF_CONNECTION). Если названия флагов указаны неверно, поставщик не вернет ожидаемые сведения журналов.
  
Если необходимо добавить в этот сценарий дополнительных поставщиков, введите следующую команду:

```PowerShell
Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Add=$ABSProvider, $CASProvider, S4Provider}
```

где каждый поставщик, определенный с помощью директивы Add, уже был определен с помощью процесса **New-CsClsProvider**.
### <a name="to-remove-a-scenario-provider"></a>Чтобы удалить поставщика сценария

1. Запустите Skype для бизнеса Server: нажмите кнопку **Начните, нажмите** кнопку Все **программы, нажмите** кнопку Skype для бизнеса **2015**, а затем нажмите кнопку **Skype для бизнеса Server управленческой оболочки**.
    
2. Приведенные командлеты позволяют обновить существующих поставщиков и создать новых. Чтобы удалить поставщика, необходимо использовать директиву Replace для параметра Provider в командлете **Set-CsClsScenario**. Единственным способом полностью удалить поставщика является замена его на переопределенного поставщика того же типа с тем же именем, что выполняется с помощью директивы Update. Например, наш поставщик LyssProvider определен с типом журнала WPP, уровнем "Отладка" и флагами TF_CONNECTION и TF_DIAG. Необходимо изменить флаги на "Все". Чтобы изменить поставщика, выполните следующую команду:
    
   ```PowerShell
   $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "All"
   ```

   ```PowerShell
   Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Replace=$LyssProvider}
   ```

3. Если необходимо полностью удалить сценарий и связанных с ним поставщиков, выполните следующую команду:
    
   ```PowerShell
   Remove-CsClsScenario -Identity <scope and name of scenario>
   ```

    Пример:
    
   ```PowerShell
   Remove-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo"
   ```

    > [!CAUTION]
    > Командлет **Remove-CsClsScenario** не запрашивает подтверждения. Сценарий удаляется вместе со всеми назначенными ему поставщиками. Можно повторно создать сценарий, повторно выполнив команды, которые использовались для его исходного создания. Процедуры восстановления удаленных сценариев или поставщиков не существует.
  
При удалении сценария с помощью командлета **Remove-CsClsScenario** вы полностью удаляете сценарий из области применения. Чтобы использовать созданные сценарии и поставщиков, которые являются частью сценария, необходимо создать новых поставщиков и назначить их новому сценарию.
## <a name="see-also"></a>См. также

[Get-CsClsScenario](/powershell/module/skype/get-csclsscenario?view=skype-ps)
  
[New-CsClsScenario](/powershell/module/skype/new-csclsscenario?view=skype-ps)
  
[Remove-CsClsScenario](/powershell/module/skype/remove-csclsscenario?view=skype-ps)
  
[Set-CsClsScenario](/powershell/module/skype/set-csclsscenario?view=skype-ps)
  
[New-CsClsProvider](/powershell/module/skype/new-csclsprovider?view=skype-ps)