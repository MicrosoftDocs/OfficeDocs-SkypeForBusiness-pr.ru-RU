---
title: Настройка поставщиков для централизованной службы ведения журналов в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 2/1/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 6a197ecf-b56b-45e0-8e7c-f532ec5164ff
description: 'Сводка: сведения о том, как настроить поставщиков сценариев для централизованной службы ведения журналов в Skype для бизнеса Server 2015.'
ms.openlocfilehash: dcfa16ffa00e81153172570e67020cf287350cd9
ms.sourcegitcommit: 2cc98fcecd753e6e8374fc1b5a78b8e3d61e0cf7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2020
ms.locfileid: "40991474"
---
# <a name="configure-providers-for-centralized-logging-service-in-skype-for-business-server-2015"></a>Настройка поставщиков для централизованной службы ведения журналов в Skype для бизнеса Server 2015
 
**Сводка:** Сведения о том, как настроить поставщиков сценариев для централизованной службы ведения журналов в Skype для бизнеса Server 2015.
  
Концепция и настройка поставщиков в централизованной службе ведения журналов – это один из самых важных для вас моментов. Сепровидерс прямо на серверные компоненты сервера Skype для бизнеса Server в модели трассировки Skype для бизнеса Server. Поставщик определяет компоненты Skype для бизнеса Server 2015, которые будут отслеживаться, типы сообщений (например, неустранимые, ошибки или предупреждения), которые нужно собрать, и флаги (например, TF_Connection или TF_Diag). Поставщики — это отслеживаемые компоненты, которые входят в каждую роль сервера Skype для бизнеса Server. С их помощью можно определить уровень и тип трассировки компонентов (например, S4, SIPStack, IM и Presence). Определенный поставщик используется в сценарии для группировки всех поставщиков в логическую коллекцию, описывающую состояние определенной проблемы.
  
Для запуска функций централизованной службы ведения журналов с помощью командной консоли Skype для бизнеса Server вы должны быть членами либо группами безопасности Ксадминистратор, либо Кссерверадминистратор на основе ролей, а также настраиваемой ролью RBAC, которая один из этих двух групп. Чтобы возвратить список всех ролей управления доступом на основе ролей (RBAC), которым был назначен этот командлет (включая любые пользовательские роли RBAC, созданные пользователем), выполните следующую команду в командной консоли управления Skype для бизнеса Server или Windows PowerShell. дачу
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Skype for Business Server 2015 cmdlet"}
```

Например:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}
```

Остальная часть данной темы посвящена определению поставщиков, изменению поставщика и компонентов поставщика, упрощающих поиск и устранение неисправностей. Существует два способа вывести централизованные команды службы ведения журнала. Вы можете использовать файл CLSController.exe, который по умолчанию расположен в каталоге C:\Program Files\Common Files\Skype for Business Server 2015\CLSAgent. Кроме того, вы можете использовать командную консоль сервера Skype для бизнеса, чтобы выпустить команды Windows PowerShell. С помощью Windows PowerShell вы можете определять новых поставщиков в сеансах ведения журнала и получать полный контроль над их созданием, их сбором и уровнем собираемых данных.
  
> [!IMPORTANT]
> Как уже упоминалось, поставщики являются очень мощным средством. Однако сценарии имеют большее значение, так как объединяют в себе все данные, необходимые для определения и выполнения трассировок компонентов, представленных поставщиками. Сценарии, которые являются коллекциями поставщиков, можно сравнить с выполнением пакетного файла, содержащего сотни команд, для сбора большого объема данных, что отличается от выполнения сотен команд по одной в командной строке. 
  
Вместо того, чтобы потребовать подробной информации о поставщиках, Служба централизованного ведения журналов предоставляет ряд сценариев, которые уже определены для вас. Предоставленные сценарии покрывают большое количество различных проблем и неполадок, которые могут возникнуть. В редких случаях может понадобиться создать и определить поставщиков и назначить их в сценарии. Настоятельно рекомендуется ознакомиться с каждым предоставленным сценарием, прежде чем создавать новых поставщиков и сценарии. Хотя здесь предоставляются сведения о создании поставщиков, чтобы вы могли ознакомиться с тем, как сценарии используют элементы поставщиков для сбора данных трассировок, сведения о самих поставщиках в настоящее время не предоставлены. 
  
Функция [централизованного ведения журналов в Skype для бизнеса 2015](centralized-logging-service.md)— ключевые элементы определения поставщика для использования в сценарии.
  
- **Поставщики услуг** Если вы знакомы с Окслогжер, поставщики — это компоненты, которые вы указываете, чтобы сообщить Окслогжер о том, что ядро трассировки должно собирать журналы. Поставщики — это те же компоненты, а во многих случаях их имя совпадает с компонентами в OCSLogger. Если вы не знакомы с Окслогжер, поставщики — это компоненты, специфичные для серверной роли, из которой Служба централизованного ведения журналов может собирать журналы. В случае централизованной службы ведения журналов Клсажент — это архитектура централизованной службы ведения журналов, которая выполняет трассировку компонентов, которые вы определили в конфигурации провайдеров.
    
- **Уровни ведения журнала** Окслогжер предоставил возможность выбрать количество уровней детализации для собираемых данных. Эта функция является неотъемлемой частью централизованной службы ведения журналов и сценариев и определяется параметром **Type** . Можно выбрать следующие значения:
    
  - **Все** Собирает сообщения трассировки для типа "неустранимые", "ошибка", "предупреждение", "подробный" и "сведения об отладке" в журнал для определенного поставщика.
    
  - **Критическая** ошибка Собирает только сообщения трассировки, определенные как неустранимые.
    
  - **Ошибка** Собирает только сообщения трассировки, определенные как "ошибка" или "критическая".
    
  - **Предупреждение** Собираются только сообщения трассировки типа "предупреждение", "ошибка" и "Неустранимая".
    
  - **Сведения** Собирает только сообщения трассировки, указывающие информационное сообщение для определенного поставщика, а также неустранимые, ошибки и предупреждающие сообщения.
    
  - **Подробный** Собирает все сообщения трассировки типа "Неустранимая", "ошибка", "предупреждение" и "подробный" для определенного поставщика.
    
  - **Отладка** , по сути, является эквивалентом ALL — собирает данные о фатальных ошибках, ошибки, предупреждениях, данных, подробных и отладочных значениях для определенного поставщика.
    
- **Flags (флаги** ) Окслогжер предоставил вариант выбора флагов для каждого поставщика, который определил тип данных, которые можно извлечь из файлов трассировки. В зависимости от поставщика можно задать следующие флаги:
    
  - **TF_Connection** Предоставляет записи журнала, связанные с подключением. Эти журналы включают сведения о подключениях к определенному компоненту. Кроме того, может быть включен большой объем сведений сетевого уровня (то есть для компонентов без концепции подключения).
    
  - **TF_Security** Предоставляет все события и записи журнала, связанные с безопасностью. Например, для SipStack, это события безопасности, такие как ошибки проверки домена и ошибки проверки подлинности и авторизации клиентов.
    
  - **TF_Diag** Предоставляет события диагностики, которые можно использовать для диагностики и устранения неполадок в компоненте. Например, для SipStack это ошибки сертификатов или ошибки/предупреждения, связанные с DNS.
    
  - **TF_Protocol** Предоставляет сообщения протоколов, такие как SIP и Объединенные кодеки кодеков для сообщества.
    
  - **TF_Component** Включает ведение журнала для компонентов, указанных в составе поставщиков.
    
  - **Все** Задает все доступные флаги, доступные для поставщика.
    
### <a name="to-review-information-about-existing-centralized-logging-service-scenario-providers"></a>Просмотр сведений о существующих поставщиках сценариев централизованной службы ведения журнала

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Чтобы просмотреть конфигурацию существующих поставщиков, введите следующую команду:
    
   ```PowerShell
   Get-CsClsScenario -Identity <scope and scenario name>
   ```

    Например, чтобы просмотреть сведения о глобальном помощнике конференц-связи, введите следующее:
    
   ```PowerShell
   Get-CsClsScenario -Identity "global/CAA"
   ```

    Команда отображает список поставщиков со связанными флагами, параметрами и компонентами. Если отображаемая информация не является достаточной или список слишком велик для стандартного формата списка Windows PowerShell, вы можете отобразить дополнительные сведения, определив другой метод вывода. Для этого выполните следующую команду:
    
   ```PowerShell
   Get-CsClsScenario -Identity "global/CAA" | Select-Object -ExpandProperty Provider
   ```

    В выходе этой команды отображается каждый поставщик. Каждая запись состоит из пяти строк: имя поставщика, тип ведения журнала, уровень ведения журнала, флаги, GUID и роль. 
    
### <a name="to-define-a-new-centralized-logging-service-scenario-provider"></a>Определение нового поставщика сценария для централизованной службы ведения журнала

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Поставщик сценария состоит из отслеживаемого компонента, используемых флагов и уровня детализации собираемых данных. Это определяется следующей командой:
    
   ```PowerShell
   $<variableName> = New-CsClsProvider -Name <provider component> -Type <log type> -Level <log level detail type> -Flags <provider trace log flags>
   ```

    Например, определение поставщика трассировки, которое указывает, что нужно собирать с поставщика Lyss и при каком уровне детализации, выглядит следующим образом.
    
   ```PowerShell
   $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Info" -Flags "All"
   ```

На уровне собраны неустранимые, ошибки, предупреждения и информационные сообщения. Все используемые флаги определены для поставщика Лисс и включают TF_Connection, TF_Diag и TF_Protocol. После определения переменной $LyssProvider ее можно использовать с командлетом **New-ксклссценарио** для сбора трассировок из поставщика Лисс. Чтобы завершить создание и назначение поставщика новому сценарию, введите следующую команду:

```PowerShell
New-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider
```

где $LyssProvider — это переменная, содержащая определенный сценарий, созданный с помощью командлета **New-CsClsProvider**.
### <a name="to-change-an-existing-centralized-logging-service-scenario-provider"></a>Изменение существующего поставщика сценариев для централизованной службы ведения журнала

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Чтобы обновить или изменить конфигурацию существующего поставщика, введите следующую команду:
    
   ```PowerShell
   $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "TF_Connection, TF_Diag"
   ```

    Затем обновите сценарий, чтобы назначить поставщика. Введите следующее:
    
   ```PowerShell
   Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider
   ```

Конечный результат выполнения команды — обновление флагов и уровня поставщика назначенного для сайта сценария: Redmond/RedmondLyssInfo. Новый сценарий можно просмотреть с помощью командлета Get-CsClsScenario. Дополнительные сведения см. в разделе [Get-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/get-csclsscenario?view=skype-ps).
> [!CAUTION]
> **New-ClsCsProvider** не определяет допустимость флагов. Убедитесь, что названия флагов указаны верно (например, TF_DIAG или TF_CONNECTION). Если названия флагов указаны неверно, поставщик не вернет ожидаемые сведения журналов.
  
Если необходимо добавить в этот сценарий дополнительных поставщиков, введите следующую команду:

```PowerShell
Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Add=$ABSProvider, $CASProvider, S4Provider}
```

где каждый поставщик, определенный с помощью директивы Add, уже был определен с помощью процесса **New-CsClsProvider**.
### <a name="to-remove-a-scenario-provider"></a>Удаление поставщика сценария

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Приведенные командлеты позволяют обновить существующих поставщиков и создать новых. Чтобы удалить поставщика, необходимо использовать директиву Replace для параметра Provider в командлете **Set-CsClsScenario**. Единственным способом полностью удалить поставщика является замена его на переопределенного поставщика того же типа с тем же именем, что выполняется с помощью директивы Update. Например, наш поставщик LyssProvider определен с типом журнала WPP, уровнем "Отладка" и флагами TF_CONNECTION и TF_DIAG. Вы должны изменить флаги на "все". Чтобы изменить поставщика, выполните следующую команду:
    
   ```PowerShell
   $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "All"
   ```

   ```PowerShell
   Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Replace=$LyssProvider}
   ```

3. Если необходимо полностью удалить сценарий и связанных с ним поставщиков, выполните следующую команду:
    
   ```PowerShell
   Remove-CsClsScenario -Identity <scope and name of scenario>
   ```

    Например:
    
   ```PowerShell
   Remove-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo"
   ```

    > [!CAUTION]
    > Командлет **Remove-CsClsScenario** не запрашивает подтверждения. Сценарий удаляется вместе со всеми назначенными ему поставщиками. Можно повторно создать сценарий, повторно выполнив команды, которые использовались для его исходного создания. Процедуры восстановления удаленных сценариев или поставщиков не существует.
  
При удалении сценария с помощью командлета **Remove-CsClsScenario** вы полностью удаляете сценарий из области применения. Чтобы использовать созданные сценарии и поставщиков, которые являются частью сценария, необходимо создать новых поставщиков и назначить их новому сценарию.
## <a name="see-also"></a>См. также

[Get-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/get-csclsscenario?view=skype-ps)
  
[New-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/new-csclsscenario?view=skype-ps)
  
[Remove-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/remove-csclsscenario?view=skype-ps)
  
[Set-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/set-csclsscenario?view=skype-ps)
  
[New-CsClsProvider](https://docs.microsoft.com/powershell/module/skype/new-csclsprovider?view=skype-ps)
