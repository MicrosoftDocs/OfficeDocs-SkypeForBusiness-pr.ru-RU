---
title: Настройка поставщиков службы централизованного ведения журналов в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/1/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 6a197ecf-b56b-45e0-8e7c-f532ec5164ff
description: Сводка. Сведения о настройке поставщиков сценариев для службы централизованного ведения журналов в Skype для бизнеса Server 2015.
ms.openlocfilehash: c96a87ea76930dbd99341667852a9731e56b88b5
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49835169"
---
# <a name="configure-providers-for-centralized-logging-service-in-skype-for-business-server-2015"></a>Настройка поставщиков службы централизованного ведения журналов в Skype для бизнеса Server 2015
 
**Сводка:** Узнайте, как настроить поставщиков сценариев для службы централизованного ведения журналов в Skype для бизнеса Server 2015.
  
Концепции и конфигурация поставщиков в службе централизованного ведения журналов — одно из наиболее важных из понятий. В модели трассиации Skype для бизнеса Server серверы напрямую сопобираются с компонентами роли сервера Skype для бизнеса Server. Поставщик определяет компоненты Skype для бизнеса Server 2015, которые будут отслеживаться, тип сообщений (например, неудалось, ошибка или предупреждение) и флаги (например, TF_Connection или TF_Diag). Поставщики — это отслеживаемые компоненты в каждой роли сервера Skype для бизнеса Server. С помощью поставщиков вы определяете уровень и тип трассии для компонентов (например, S4, SIPStack, IM и Presence). Определенный поставщик используется в сценарии для группировки всех поставщиков для заданной логической коллекции, которая решает определенное условие проблемы.
  
Для запуска функций службы централизованного ведения журналов с помощью оболочки управления Skype для бизнеса Server необходимо быть членом группы безопасности управления доступом на основе ролей (RBAC) CsAdministrator или CsServerAdministrator или настраиваемой роли RBAC, которая содержит какую-либо из этих двух групп. Чтобы получить список всех ролей управления доступом на основе ролей (RBAC), которые назначены этому командлету (включая все самостоятельно созданные роли RBAC), в командной командной Windows PowerShell Skype для бизнеса Server или командной Windows PowerShell командной Windows PowerShell:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Skype for Business Server 2015 cmdlet"}
```

Пример:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}
```

Остальная часть этого раздела посвящена определению поставщиков, изменению поставщика и определению поставщика для оптимизации устранения неполадок. Существует два способа выдачи команд службы централизованного ведения журналов. You can use the CLSController.exe that is located, by default, in the directory C:\Program Files\Common Files\Skype for Business Server 2015\CLSAgent. Для выдачи Windows PowerShell можно использовать командную Windows PowerShell Skype для бизнеса Server. С помощью Windows PowerShell вы можете определить новых поставщиков для использования в сеансах ведения журнала и получить полный контроль над их созданием, тем, что они собирают и на каком уровне собирают данные.
  
> [!IMPORTANT]
> Как уже упоминалось, поставщики являются очень мощным средством. Однако сценарии имеют большее значение, так как объединяют в себе все данные, необходимые для определения и выполнения трассировок компонентов, представленных поставщиками. Сценарии, которые являются коллекциями поставщиков, можно сравнить с выполнением пакетного файла, содержащего сотни команд, для сбора большого объема данных, что отличается от выполнения сотен команд по одной в командной строке. 
  
Вместо того чтобы подробно рыться в подробных сведениях о поставщиках, централизованная служба ведения журналов предоставляет ряд сценариев, уже определенных для вас. Предоставленные сценарии покрывают большое количество различных проблем и неполадок, которые могут возникнуть. В редких случаях может понадобиться создать и определить поставщиков и назначить их в сценарии. Настоятельно рекомендуется ознакомиться с каждым предоставленным сценарием, прежде чем создавать новых поставщиков и сценарии. Хотя здесь предоставляются сведения о создании поставщиков, чтобы вы могли ознакомиться с тем, как сценарии используют элементы поставщиков для сбора данных трассировок, сведения о самих поставщиках в настоящее время не предоставлены. 
  
Впервые представленная в службе централизованного ведения журналов в Skype для бизнеса [2015](centralized-logging-service.md)ключевые элементы определения поставщика для использования в сценарии:
  
- **Поставщики** Если вы знакомы с OCSLogger, поставщики — это компоненты, из каких компонентов OCSLogger должен собирать журналы. Поставщики — это те же компоненты, а во многих случаях их имя совпадает с компонентами в OCSLogger. Если вы не знакомы с OCSLogger, поставщики — это компоненты роли сервера, из которые централизованная служба ведения журналов может собирать журналы. В случае службы централизованного ведения журналов CLSAgent является частью архитектуры службы централизованного ведения журналов, которая отслеживает компоненты, определенные в конфигурации поставщиков.
    
- **Уровни ведения журнала** OCSLogger предоставляет возможность выбора нескольких уровней детализации для собранных данных. Эта функция является неотъемлемой частью централизованной службы ведения журналов и сценариев и определяется с помощью параметра **Type.** Вы можете выбрать следующие параметры.
    
  - **Все** Собирает сообщения трассировки о неуявных ошибках, ошибках, предупреждениях, подробных и отлагежных сообщениях в журнал для определенного поставщика.
    
  - **Неуявный** Собирает только сообщения трассировки, определенные как "Неудалось".
    
  - **Ошибка** Собирает только сообщения трассировки, определенные как "Ошибка" или "Неудательная ошибка".
    
  - **Предупреждение** Собирает только сообщения трассировки типа "Предупреждение", "Ошибка" и "Неумеримая ошибка".
    
  - **Сведения** Собирает только сообщения трассировки, которые указывают на информационное сообщение для определенного поставщика, а также сообщения о неувядательных ошибках, ошибках и предупреждениях.
    
  - **Подробное** Собирает все сообщения трассировки для определенного поставщика с ошибками, ошибками, предупреждениями и подробными сообщениями.
    
  - **Отлажка** по сути является эквивалентом "All" — собирает трассировки типа Fatal, Error, Warning, Info, Verbose и Debug для определенного поставщика.
    
- **Флаги** OCSLogger предоставляет возможность выбирать флаги для каждого поставщика, определяя тип информации, которую можно получить из файлов трассировки. В зависимости от поставщика можно задать следующие флаги:
    
  - **TF_Connection** Предоставляет записи журнала, связанные с подключением. Эти журналы включают сведения о подключениях к определенному компоненту. Кроме того, может быть включен большой объем сведений сетевого уровня (то есть для компонентов без концепции подключения).
    
  - **TF_Security** Предоставляет все события и записи журнала, связанные с безопасностью. Например, для SipStack, это события безопасности, такие как ошибки проверки домена и ошибки проверки подлинности и авторизации клиентов.
    
  - **TF_Diag** Предоставляет события диагностики, которые можно использовать для диагностики или устранения неполадок компонента. Например, для SipStack это ошибки сертификатов или ошибки/предупреждения, связанные с DNS.
    
  - **TF_Protocol** Предоставляет сообщения протокола, такие как сообщения SIP и объединенный кодек сообщества.
    
  - **TF_Component** Включает ведение журнала для компонентов, указанных в составе поставщиков.
    
  - **Все** Устанавливает все доступные флаги, доступные для поставщика.
    
### <a name="to-review-information-about-existing-centralized-logging-service-scenario-providers"></a>Просмотр сведений о существующих поставщиках сценариев службы централизованного ведения журналов

1. Запустите оболочку управления Skype для бизнеса Server: нажмите кнопку "Начните", выберите "Все программы", "Skype для бизнеса **2015",** а затем щелкните "Skype для бизнеса Server Management **Shell".**
    
2. Чтобы просмотреть конфигурацию существующих поставщиков, введите следующую команду:
    
   ```PowerShell
   Get-CsClsScenario -Identity <scope and scenario name>
   ```

    Например, чтобы просмотреть сведения о глобальном помощнике конференц-связи, введите следующее:
    
   ```PowerShell
   Get-CsClsScenario -Identity "global/CAA"
   ```

    Команда отображает список поставщиков со связанными флагами, параметрами и компонентами. Если отображаемой информации недостаточно или список слишком длинный для формата Windows PowerShell списка по умолчанию, можно отобразить дополнительные сведения, определив другой метод вывода. Для этого выполните следующую команду:
    
   ```PowerShell
   Get-CsClsScenario -Identity "global/CAA" | Select-Object -ExpandProperty Provider
   ```

    В выходе этой команды отображается каждый поставщик. Каждая запись состоит из пяти строк: имя поставщика, тип ведения журнала, уровень ведения журнала, флаги, GUID и роль. 
    
### <a name="to-define-a-new-centralized-logging-service-scenario-provider"></a>Определение нового поставщика сценария службы централизованного ведения журналов

1. Запустите оболочку управления Skype для бизнеса Server: нажмите кнопку "Начните", выберите "Все программы", "Skype для бизнеса **2015",** а затем щелкните "Skype для бизнеса Server Management **Shell".**
    
2. Поставщик сценария состоит из отслеживаемого компонента, используемых флагов и уровня детализации собираемых данных. Это определяется следующей командой:
    
   ```PowerShell
   $<variableName> = New-CsClsProvider -Name <provider component> -Type <log type> -Level <log level detail type> -Flags <provider trace log flags>
   ```

    Например, определение поставщика трассировки, которое указывает, что нужно собирать с поставщика Lyss и при каком уровне детализации, выглядит следующим образом.
    
   ```PowerShell
   $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Info" -Flags "All"
   ```

Уровень -Level собирает сообщения о неуявных ошибках, ошибках, предупреждениях и сведениях. Все используемые флаги определены для поставщика Lyss и включают TF_Connection, TF_Diag и TF_Protocol.После определения переменной $LyssProvider ее можно использовать с помощью cmdlet **New-CsClsScenario** для сбора трассировок от поставщика Lyss. Чтобы завершить создание и назначение поставщика новому сценарию, введите следующую команду:

```PowerShell
New-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider
```

где $LyssProvider — это переменная, содержащая определенный сценарий, созданный с помощью командлета **New-CsClsProvider**.
### <a name="to-change-an-existing-centralized-logging-service-scenario-provider"></a>Изменение существующего поставщика сценария службы централизованного ведения журналов

1. Запустите оболочку управления Skype для бизнеса Server: нажмите кнопку "Начните", выберите "Все программы", "Skype для бизнеса **2015",** а затем щелкните "Skype для бизнеса Server Management **Shell".**
    
2. Чтобы обновить или изменить конфигурацию существующего поставщика, введите следующую команду:
    
   ```PowerShell
   $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "TF_Connection, TF_Diag"
   ```

    Затем обновите сценарий, чтобы назначить поставщика. Введите следующее:
    
   ```PowerShell
   Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider
   ```

Конечный результат выполнения команды — обновление флагов и уровня поставщика назначенного для сайта сценария: Redmond/RedmondLyssInfo. Новый сценарий можно просмотреть с помощью командлета Get-CsClsScenario. Дополнительные сведения см. в разделе [Get-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/get-csclsscenario?view=skype-ps).
> [!CAUTION]
> **New-ClsCsProvider** не определяет допустимость флагов. Убедитесь, что названия флагов указаны верно (например, TF_DIAG или TF_CONNECTION). Если названия флагов указаны неверно, поставщик не вернет ожидаемые сведения журналов.
  
Если необходимо добавить в этот сценарий дополнительных поставщиков, введите следующую команду:

```PowerShell
Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Add=$ABSProvider, $CASProvider, S4Provider}
```

где каждый поставщик, определенный с помощью директивы Add, уже был определен с помощью процесса **New-CsClsProvider**.
### <a name="to-remove-a-scenario-provider"></a>Чтобы удалить поставщика сценария

1. Запустите оболочку управления Skype для бизнеса Server: нажмите кнопку "Начните", выберите "Все программы", "Skype для бизнеса **2015",** а затем щелкните "Skype для бизнеса Server Management **Shell".**
    
2. Приведенные командлеты позволяют обновить существующих поставщиков и создать новых. Чтобы удалить поставщика, необходимо использовать директиву Replace для параметра Provider в командлете **Set-CsClsScenario**. Единственным способом полностью удалить поставщика является замена его на переопределенного поставщика того же типа с тем же именем, что выполняется с помощью директивы Update. Например, наш поставщик LyssProvider определен с типом журнала WPP, уровнем "Отладка" и флагами TF_CONNECTION и TF_DIAG. Необходимо изменить флаги на "Все". Чтобы изменить поставщика, выполните следующую команду:
    
   ```PowerShell
   $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "All"
   ```

   ```PowerShell
   Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Replace=$LyssProvider}
   ```

3. Если необходимо полностью удалить сценарий и связанных с ним поставщиков, выполните следующую команду:
    
   ```PowerShell
   Remove-CsClsScenario -Identity <scope and name of scenario>
   ```

    Пример:
    
   ```PowerShell
   Remove-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo"
   ```

    > [!CAUTION]
    > Командлет **Remove-CsClsScenario** не запрашивает подтверждения. Сценарий удаляется вместе со всеми назначенными ему поставщиками. Можно повторно создать сценарий, повторно выполнив команды, которые использовались для его исходного создания. Процедуры восстановления удаленных сценариев или поставщиков не существует.
  
При удалении сценария с помощью командлета **Remove-CsClsScenario** вы полностью удаляете сценарий из области применения. Чтобы использовать созданные сценарии и поставщиков, которые являются частью сценария, необходимо создать новых поставщиков и назначить их новому сценарию.
## <a name="see-also"></a>См. также

[Get-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/get-csclsscenario?view=skype-ps)
  
[New-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/new-csclsscenario?view=skype-ps)
  
[Remove-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/remove-csclsscenario?view=skype-ps)
  
[Set-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/set-csclsscenario?view=skype-ps)
  
[New-CsClsProvider](https://docs.microsoft.com/powershell/module/skype/new-csclsprovider?view=skype-ps)
