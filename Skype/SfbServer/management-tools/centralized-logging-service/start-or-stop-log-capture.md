---
title: Запуск или остановка записи журналов CLS в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: jambirk
author: jambirk
manager: serdars
ms.date: 2/1/2018
ms.audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 0512b9ce-7f5b-48eb-a79e-f3498bacf2de
description: 'Сводка: Узнайте, как запустить или остановить сеанс записи журналов службы централизованного ведения журналов в Скайп для Business Server 2015.'
ms.openlocfilehash: 982aecf9da4e8ca08d734a4adb35d8a34a3bb816
ms.sourcegitcommit: da8c037bb30abf5d5cf3b60d4b71e3a10e553402
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2019
ms.locfileid: "30887332"
---
# <a name="start-or-stop-cls-log-capture-in-skype-for-business-server-2015"></a>Запуск или остановка записи журналов CLS в Skype для бизнеса Server 2015
 
**Сводка:** Узнайте, как запуск или остановка сеанса записи журналов службы централизованного ведения журналов в Скайп для Business Server 2015.
  
Для записи журналов трассировки с помощью службы централизованного ведения журналов, выполните команду Начать ведения журнала на один или несколько компьютеров и пулов. Также выдавать параметров, определяющих, какие компьютеры или пулов, какие сценарии для запуска (например, AlwaysOn, другой сценарий предварительно заданных или сценарий создания), какие Скайп для компонентов Business Server (например, S4, SipStack) для трассировки.
  
To capture the right information, you need to make sure you use the right scenario to collect information that is relevant to the problem. В Centralized Logging Service сценарий — концепцию Включение ведения журнала зависимости от набора компонентов сервера, уровни ведения журнала и флаги, которая является намного более эффективным и удобным, чем того, чтобы определить эти элементы на одном сервере. You define and specify a scenario to run and the scenario is run consistently across all servers and pools in the scope of the infrastructure.
  
Сценарий по умолчанию называется **AlwaysOn**. Сценарий AlwaysOn, в соответствии со своим названием, предназначен для постоянного выполнения. Сценарий AlwaysOn собирает данные на уровне Info (обратите внимание, что помимо информационных сообщений при ведении журнала на уровне Info также регистрируются сообщения Fatal (неустранимо), Error (ошибка) и Warning (предупреждение)) для многих из наиболее типичных серверных компонентов. AlwaysOn собирает сведения до, во время и после возникновения проблемы. Это резко отличается от поведения предыдущих средств ведения журнала, таких как OCSLogger. OCSLogger запускается уже после появления проблемы, что затрудняет поиск и устранение неисправностей, так как данные собираются как реакция на событие, а не упреждающе. Если AlwaysOn не содержит данных, нужных для определения проблемного компонента, и не указывает направление действий для исправления проблемы (что, скорее всего, связано с недостаточной шириной и глубиной поставщиков в AlwaysOn), будет указан разумный уровень данных для определения дальнейших действий, таких как создание нового сценария, сбор других данных, выполнение другого поиска для сбора более подробных сведений и т. д.
  
Службы централизованного ведения журналов предоставляет два способа для передачи команд. Число разделов были предназначенным непосредственно с помощью Windows PowerShell через Скайп для консоли Business Server. Возможность использования количество сложных конфигураций и команд Windows PowerShell подходит для использования службой централизованного ведения журналов. Поскольку Windows PowerShell через Скайп для консоли Business Server практически повсеместно применяемых для всех функций в Скайп для Business Server, рассматриваются только команд Windows PowerShell. 
  
### <a name="to-run-start-csclslogging-with-windows-powershell-using-basic-commands"></a>Запуск Start-CsClsLogging с помощью Windows PowerShell с помощью базовых команд

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Запустите сценарий ведения журнала со службой централизованного ведения журналов, введя следующую команду:
    
   ```
   Start-CsClsLogging -Scenario <name of scenario>
   ```

    Например для запуска сценария **AlwaysOn** введите:
    
   ```
   Start-CsClsLogging -Scenario AlwaysOn
   ```

    > [!NOTE]
    > У сценария AlwaysOn нет длительности по умолчанию. Этот сценарий будет выполняться, пока он не будет явно остановлен с помощью командлета **Stop-CsClsLogging**. Подробные сведения см. в статье [Stop-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/stop-csclslogging?view=skype-ps). Для всех остальных сценариев длительность по умолчанию составляет 4 часа. 
  
3. Для выполнения команды нажмите клавишу ВВОД. 
    
    > [!NOTE]
    > Для выполнения команд и возвращения состояния от компьютеров среды может потребоваться некоторое небольшое время (от 30 до 60 секунд). 
  
     ![Запуск Start-CsClsLogging.](../../media/Ops_CLS_Show_and_Start_ClsLogging.jpg)
  
4. Чтобы выполнить другой сценарий, используйте командлет **Start-CsClsLogging** с именем выполняемого дополнительного сценария (например, сценария **Authentication**):
    
   ```
   Start-CsClsLogging -Scenario Authentication
   ```

    > [!IMPORTANT]
    > В любой момент времени на любом конкретном компьютере может работать не более двух сценариев. Если область применения команды является глобальной, этот сценарий или сценарии будут выполняться на всех компьютерах среды. Для запуска третьего сценария необходимо остановить ведение журнала для области применения (компьютер, пул, сайт, глобальная), в которой нужно запустить новый сценарий. Если сценарии запущены в глобальной области применения, можно остановить ведение журнала в одном или обоих сценариях для одного или нескольких компьютеров и пулов. 
  
### <a name="to-run-start-csclslogging-with-windows-powershell-using-advanced-commands"></a>Запуск Start-CsClsLogging с помощью Windows PowerShell с помощью расширенных команд

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Для управления командами ведения журнала доступны дополнительные параметры. Вы можете использовать - длительность, чтобы настроить интервал времени для запуска сценария. Также можно определить - компьютеров, список имен доменов полное компьютера (FQDN), разделенные точкой с запятой, или - список полных доменных имен для пулов, которые необходимо выполнить вход в систему, разделенных пулов, их запятыми.
    
    Пусть нужно запустить сеанс ведения журнала с помощью сценария UserReplicator для пула "pool01.contoso.net". При этом длительность сеанса ведения журнала определяется равной 8 часам. Для этого введите следующую команду:
    
   ```
   Start-CsClsLogging -Scenario UserReplicator -Duration 8:00 -Pools "pool01.contoso.net"
   ```

    При успешном выполнении этого сценария возвращается результат, подобный следующему:
    
     ![Запуск Start-CsClsLogging.](../../media/Ops_CsClsLogging_UserReplicator_Exp.jpg)
  
Обратите внимание, что в этом примере выполняются сценарий AlwaysOn и сценарий UserReplicator. 
    
## <a name="stop-the-centralized-logging-service-log-capture"></a>Остановка записи службы централизованного ведения журнала
<a name="stop"> </a>

Остановить текущий работающий сеанс ведения журнала можно с помощью командлета Stop-CsClsLogging. Как правило не существует множество ситуаций, в которых может потребоваться остановить сеанс ведения журнала. Например, поиск в журналах и изменение конфигураций можно выполнять без обязательной предварительной остановки ведения журнала. Если выполняются два сценария, например AlwaysOn и UserReplicator, и нужно собирать сведения, связанные с проверкой подлинности (сценарий Authentication), понадобится остановить один из других сценариев (на глобальном уровне, уровне сайта, пула или компьютера), прежде чем можно будет запустить сценарий Authentication. Подробные сведения см. в статье [Stop-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/stop-csclslogging?view=skype-ps).
  
> [!NOTE]
> When determining what scenarios you can run on a given deployment, pool or computer, you need to remember that you are limited to running two scenarios **per computer**: AlwaysOn and one custom scenario. If you are logging activity on a pool, you should treat a pool as a single entity. In most cases, it would not make sense to run different scenarios on each computer in a pool. It does make sense to look at the problem that you are collecting data about and think about what scenario makes the most sense on a given computer in the overall deployment. Например если рассмотрим сценарий UserReplicator, то должно быть очень маленьким значение в под управлением UserReplicator на пограничный сервер или пограничный пул. 
  
Разобравшись в проблеме и оценив масштаб влияния, следует аккуратно выбрать, какие сценарии будут выполняться и на каких компьютерах и пулах. Хотя сценарий AlwaysOn имеет смысл для широкой области применения, так как он собирает данные для широкого множества поставщиков, определенные сценарии целесообразно применять только на конкретных компьютерах и пулах. Кроме того, следует соблюдать осторожность и не запускать сеанс ведения журнала случайным образом, не разобравшись сначала в эффективности данного сценария в конкретном случае. Использование неправильного сценария или сценария, не соответствующего задаче, либо запуск сценария в неправильной области применения (будь это глобальный уровень, уровень площадки, пула или компьютера), может привести к получению сомнительных и не слишком полезных данных — как если бы никакой сценарий вообще не запускался.
  
Для управления функциями централизованной службы ведения журналов с помощью Скайп для консоли Business Server, должна быть членом CsAdministrator или групп безопасности CsServerAdministrator доступом на основе ролей (RBAC) элемента управления или настраиваемые роли RBAC который содержит любой из этих двух групп. Чтобы получить список всех ролей RBAC, назначенных этот командлет (включая любые пользовательские роли RBAC, созданные самостоятельно), выполните следующую команду из Скайп для консоли Business Server или в командной строке Windows PowerShell:
  
```
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Skype for Business Server 2015 cmdlet"}
```

Например:
  
```
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}
```

> [!NOTE]
> Поэтому может возникнуть вопрос: теперь, когда было включено ведение журнала, журналы хранения? С момента будет доступ к информацию, содержащуюся в журналах с помощью запросов командной консоли управления, отправляемых на агенты CLS, а можно вывода результатов в несколько форматов формата файла, где на каждом сервере агента CLS отслеживает его записей не является крайне важно знать.  Файлы журнала сохраняются в расположение укажите и читать и анализ с помощью различных средств, в том числе **Snooper.exe** и любое средство, которое можно читать текстового файла, например **Notepad.exe**. Snooper.exe является частью Скайп для средств отладки 2015 Business Server и доступен в качестве [Web загрузить](https://go.microsoft.com/fwlink/p/?LinkId=285257).

### <a name="to-stop-a-currently-running-centralized-logging-service-session"></a>Остановка текущего выполняемого сеанса централизованной службы ведения журналов

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Запрос централизованной службы ведения журналов, чтобы узнать, какие сценарии в настоящее время работает, введя следующее:
    
   ```
   Show-CsClsLogging
   ```

   ![Консоль Windows PowerShell после вызова Show-CsCl](../../media/Ops_Show_Stop_CsClsLogging.jpg)
  
   Результатом выполнения Show-CsClsLogging являются сводные данные обо всех выполняемых сценариях и областях их выполнения. Подробные сведения см. в статье [Show-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/show-csclslogging?view=skype-ps).
    
3. Чтобы остановить выполняемый в данный момент сеанс ведения журнала, введите:
    
   ```
   Stop-CsClsLogging -Scenario <scenario name> -Computers <comma separated list of fully qualified computer names> -Pools <comma separated list of fully qualified pool names>
   ```
   Например:
    
   ```
   Stop-CsClsLogging -Scenario UserReplicator -Pools pool01.contoso.net
   ```

   Эта команда остановит ведение журнала с помощью сценария UserReplicatior для pool01.contoso.net.
    
    > [!NOTE]
    > Журналы, созданные в течение останавливаемого сеанса ведения журнала с помощью сценария UserReplicator, не удаляются. Журналы остаются доступными для выполнения поиска с помощью команды Search-CsClsLogging. Подробные сведения см. в статье [Search-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/search-csclslogging?view=skype-ps). 
  
Действуя в качестве команды-спутника для Start-CsClsLogging, командлет Stop-CsClsLogging завершает сеанс ведения журнала и сохраняет журналы, созданные в течение этого сеанса. Одновременно на данном компьютере может выполняться не более двух сценариев. Способ остановки одного сценария для сбора данных с помощью другого сценария является типовой задачей, часто выполняемой при устранении неполадок рабочих нагрузок.
## <a name="see-also"></a>См. также
<a name="stop"> </a>

[Centralized Logging Service in Skype for Business 2015](centralized-logging-service.md)
