---
title: Запуск или остановка записи журналов CLS в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 2/1/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 0512b9ce-7f5b-48eb-a79e-f3498bacf2de
description: 'Сводка: сведения о том, как запустить или остановить сеанс записи журнала службы ведения журналов в Skype для бизнеса Server 2015.'
ms.openlocfilehash: 4d8c40c2fdb648497997fbd4a69dc49af4685b43
ms.sourcegitcommit: e64c50818cac37f3d6f0f96d0d4ff0f4bba24aef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2020
ms.locfileid: "41816568"
---
# <a name="start-or-stop-cls-log-capture-in-skype-for-business-server-2015"></a>Запуск или остановка записи журналов CLS в Skype для бизнеса Server 2015
 
**Сводка:** Сведения о том, как приступить к сбору и остановке сеанса централизованного ведения журнала служб в Skype для бизнеса Server 2015.
  
Для сбора журналов трассировки с помощью централизованной службы ведения журналов вы можете выполнить команду для начала ведения журнала на одном или нескольких компьютерах и пулах. Вы также можете использовать параметры, определяющие, какие компьютеры или пулы, какие сценарии необходимо выполнить (например, AlwaysOn, другой предопределенный сценарий или созданный вами сценарий), какие компоненты сервера Skype для бизнеса (например, S4, Сипстакк) нужно отслеживать.
  
To capture the right information, you need to make sure you use the right scenario to collect information that is relevant to the problem. В централизованной службе ведения журналов сценарий — это концепция, с помощью которой можно выполнять ведение журнала на основе коллекции серверных компонентов, уровней ведения журнала и флагов, что значительно сложнее, чем определять эти элементы отдельно для каждого сервера. You define and specify a scenario to run and the scenario is run consistently across all servers and pools in the scope of the infrastructure.
  
Сценарий по умолчанию называется **AlwaysOn**. Сценарий AlwaysOn, в соответствии со своим названием, предназначен для постоянного выполнения. Сценарий AlwaysOn собирает данные на уровне Info (обратите внимание, что помимо информационных сообщений при ведении журнала на уровне Info также регистрируются сообщения Fatal (неустранимо), Error (ошибка) и Warning (предупреждение)) для многих из наиболее типичных серверных компонентов. AlwaysOn собирает сведения до, во время и после возникновения проблемы. Это резко отличается от поведения предыдущих средств ведения журнала, таких как OCSLogger. OCSLogger запускается уже после появления проблемы, что затрудняет поиск и устранение неисправностей, так как данные собираются как реакция на событие, а не упреждающе. Если AlwaysOn не содержит данных, нужных для определения проблемного компонента, и не указывает направление действий для исправления проблемы (что, скорее всего, связано с недостаточной шириной и глубиной поставщиков в AlwaysOn), будет указан разумный уровень данных для определения дальнейших действий, таких как создание нового сценария, сбор других данных, выполнение другого поиска для сбора более подробных сведений и т. д.
  
Служба централизованного ведения журналов предлагает два способа выполнения команд. На использование Windows PowerShell с помощью командной консоли Skype для бизнеса Server вы выбрали несколько тем. Возможность использовать множество сложных конфигураций и команд — это использование Windows PowerShell для централизованного ведения журнала. Так как Windows PowerShell через командную консоль управления Skype для бизнеса Server является практически повсеместной для всех функций в Skype для бизнеса Server, обсуждаются только команды Windows PowerShell. 
  
### <a name="to-run-start-csclslogging-with-windows-powershell-using-basic-commands"></a>Запуск команды Start-Ксклслоггинг с Windows PowerShell с помощью основных команд

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Начните ведение журнала с помощью централизованной службы ведения журналов, введя следующее:
    
   ```PowerShell
   Start-CsClsLogging -Scenario <name of scenario>
   ```

    Например для запуска сценария **AlwaysOn** введите:
    
   ```PowerShell
   Start-CsClsLogging -Scenario AlwaysOn
   ```

    > [!NOTE]
    > У сценария AlwaysOn нет длительности по умолчанию. Этот сценарий будет выполняться, пока он не будет явно остановлен с помощью командлета **Stop-CsClsLogging**. Подробные сведения см. в статье [Stop-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/stop-csclslogging?view=skype-ps). Для всех остальных сценариев длительность по умолчанию составляет 4 часа. 
  
3. Для выполнения команды нажмите клавишу ВВОД. 
    
    > [!NOTE]
    > Для выполнения команд и возвращения состояния от компьютеров среды может потребоваться некоторое небольшое время (от 30 до 60 секунд). 
  
     ![Запуск Start-CsClsLogging.](../../media/Ops_CLS_Show_and_Start_ClsLogging.jpg)
  
4. Чтобы выполнить другой сценарий, используйте командлет **Start-CsClsLogging** с именем выполняемого дополнительного сценария (например, сценария **Authentication**):
    
   ```PowerShell
   Start-CsClsLogging -Scenario Authentication
   ```

    > [!IMPORTANT]
    > В любой момент времени на любом конкретном компьютере может работать не более двух сценариев. Если область применения команды является глобальной, этот сценарий или сценарии будут выполняться на всех компьютерах среды. Для запуска третьего сценария необходимо остановить ведение журнала для области применения (компьютер, пул, сайт, глобальная), в которой нужно запустить новый сценарий. Если сценарии запущены в глобальной области применения, можно остановить ведение журнала в одном или обоих сценариях для одного или нескольких компьютеров и пулов. 
  
### <a name="to-run-start-csclslogging-with-windows-powershell-using-advanced-commands"></a>Запуск команды Start-Ксклслоггинг с Windows PowerShell с помощью расширенных команд

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Для управления командами ведения журнала доступны дополнительные параметры. Чтобы настроить продолжительность выполнения сценария, можно использовать параметр-Duration. Вы также можете определять компьютеры, список полных доменных имен компьютера, разделенных запятыми или пулами, разделенными запятыми FQDN для пулов, для которых требуется выполнить вход.
    
    Пусть нужно запустить сеанс ведения журнала с помощью сценария UserReplicator для пула "pool01.contoso.net". При этом длительность сеанса ведения журнала определяется равной 8 часам. Для этого введите следующую команду:
    
   ```PowerShell
   Start-CsClsLogging -Scenario UserReplicator -Duration 8:00 -Pools "pool01.contoso.net"
   ```

    При успешном выполнении этого сценария возвращается результат, подобный следующему:
    
     ![Запуск Start-CsClsLogging.](../../media/Ops_CsClsLogging_UserReplicator_Exp.jpg)
  
Обратите внимание, что в этом примере выполняются сценарий AlwaysOn и сценарий UserReplicator. 
    
## <a name="stop-the-centralized-logging-service-log-capture"></a>Остановка записи службы централизованного ведения журнала
<a name="stop"> </a>

Остановить текущий работающий сеанс ведения журнала можно с помощью командлета Stop-CsClsLogging. Обычно не существует множество ситуаций, в которых необходимо остановить сеанс ведения журнала. Например, поиск в журналах и изменение конфигураций можно выполнять без обязательной предварительной остановки ведения журнала. Если выполняются два сценария, например AlwaysOn и UserReplicator, и нужно собирать сведения, связанные с проверкой подлинности (сценарий Authentication), понадобится остановить один из других сценариев (на глобальном уровне, уровне сайта, пула или компьютера), прежде чем можно будет запустить сценарий Authentication. Подробные сведения см. в статье [Stop-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/stop-csclslogging?view=skype-ps).
  
> [!NOTE]
> When determining what scenarios you can run on a given deployment, pool or computer, you need to remember that you are limited to running two scenarios **per computer**: AlwaysOn and one custom scenario. If you are logging activity on a pool, you should treat a pool as a single entity. In most cases, it would not make sense to run different scenarios on each computer in a pool. It does make sense to look at the problem that you are collecting data about and think about what scenario makes the most sense on a given computer in the overall deployment. Например, если вы просматриваете сценарий Усеррепликатор, то в процессе выполнения Усеррепликатор на пограничном сервере или пуле Edgeов было бы очень мало значений. 
  
Разобравшись в проблеме и оценив масштаб влияния, следует аккуратно выбрать, какие сценарии будут выполняться и на каких компьютерах и пулах. Хотя сценарий AlwaysOn имеет смысл для широкой области применения, так как он собирает данные для широкого множества поставщиков, определенные сценарии целесообразно применять только на конкретных компьютерах и пулах. Кроме того, следует соблюдать осторожность и не запускать сеанс ведения журнала случайным образом, не разобравшись сначала в эффективности данного сценария в конкретном случае. Использование неправильного сценария или сценария, не соответствующего задаче, либо запуск сценария в неправильной области применения (будь это глобальный уровень, уровень площадки, пула или компьютера), может привести к получению сомнительных и не слишком полезных данных — как если бы никакой сценарий вообще не запускался.
  
Для управления централизованными функциями ведения журналов с помощью командной консоли Skype для бизнеса Server вы должны быть членами либо группами безопасности Ксадминистратор или Кссерверадминистратор, либо настраиваемой роли RBAC. содержащая одну из этих двух групп. Чтобы возвратить список всех ролей RBAC, которым был назначен этот командлет (включая любые пользовательские роли RBAC, созданные пользователем), выполните следующую команду в командной консоли управления Skype для бизнеса Server или Windows PowerShell.
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Skype for Business Server 2015 cmdlet"}
```

Например:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}
```

> [!NOTE]
> Может возникнуть вопрос: Теперь вы включили ведение журнала, где хранятся журналы? Так как вы будете получать доступ к информации, хранящейся в журналах, с помощью запросов управляющей оболочки, отправленных в агенты CLS, вы можете вывести результаты в несколько возможных форматов файлов, где на каждом сервере, где хранятся данные, не очень важно знать.  Файлы журнала можно сохранить в указанном расположении, прочитать и проанализировать с помощью различных средств, включая **снупер. exe** и любые средства, которые могут читать текстовый файл, например **Notepad. exe**. Снупер. exe входит в состав средств отладки Skype для бизнеса Server 2015, и его можно загрузить в виде [веб-сайта](https://go.microsoft.com/fwlink/p/?LinkId=285257).

### <a name="to-stop-a-currently-running-centralized-logging-service-session"></a>Чтобы остановить запущенный в данный момент централизованный сеанс службы ведения журнала

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Запросите службу централизованного ведения журналов, чтобы узнать, какие сценарии в настоящее время выполняются, введя следующее:
    
   ```PowerShell
   Show-CsClsLogging
   ```

   ![Консоль Windows PowerShell после вызова Show-CsCl](../../media/Ops_Show_Stop_CsClsLogging.jpg)
  
   Результатом выполнения Show-CsClsLogging являются сводные данные обо всех выполняемых сценариях и областях их выполнения. Подробные сведения см. в статье [Show-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/show-csclslogging?view=skype-ps).
    
3. Чтобы остановить выполняемый в данный момент сеанс ведения журнала, введите:
    
   ```PowerShell
   Stop-CsClsLogging -Scenario <scenario name> -Computers <comma separated list of fully qualified computer names> -Pools <comma separated list of fully qualified pool names>
   ```
   Например:
    
   ```PowerShell
   Stop-CsClsLogging -Scenario UserReplicator -Pools pool01.contoso.net
   ```

   Эта команда остановит ведение журнала с помощью сценария UserReplicatior для pool01.contoso.net.
    
    > [!NOTE]
    > Журналы, созданные в течение останавливаемого сеанса ведения журнала с помощью сценария UserReplicator, не удаляются. Журналы остаются доступными для выполнения поиска с помощью команды Search-CsClsLogging. Подробные сведения см. в статье [Search-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/search-csclslogging?view=skype-ps). 
  
Действуя в качестве команды-спутника для Start-CsClsLogging, командлет Stop-CsClsLogging завершает сеанс ведения журнала и сохраняет журналы, созданные в течение этого сеанса. Одновременно на данном компьютере может выполняться не более двух сценариев. Способ остановки одного сценария для сбора данных с помощью другого сценария является типовой задачей, часто выполняемой при устранении неполадок рабочих нагрузок.
## <a name="see-also"></a>См. также
<a name="stop"> </a>

[Centralized Logging Service in Skype for Business 2015](centralized-logging-service.md)
