---
title: Запуск или остановка записи журнала CLS в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/1/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 0512b9ce-7f5b-48eb-a79e-f3498bacf2de
description: Сводка. Узнайте, как запустить или остановить сеанс записи журнала службы централизованного ведения журналов в Skype для бизнеса Server 2015.
ms.openlocfilehash: cd6864b0d4d16e952f93fe321b49522028d76e5b
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49835139"
---
# <a name="start-or-stop-cls-log-capture-in-skype-for-business-server-2015"></a>Запуск или остановка записи журнала CLS в Skype для бизнеса Server 2015
 
**Сводка:** Learn how to start or stop a Centralized Logging Service log capture session in Skype for Business Server 2015.
  
Для записи журналов трассировки с помощью службы централизованного ведения журналов необходимо на основе команды начать ведение журнала на одном или более компьютерах и пулах. Вы также создаете параметры, определяющие, какие компьютеры или пулы, какие сценарии запускать (например, AlwaysOn, другой предварительно определенный сценарий или созданный сценарий), какие компоненты Skype для бизнеса Server (например, S4, SipStack) должны отслеживаться.
  
Для получения правильных сведений нужно гарантировать использование правильного сценария сбора данных, связанного с проблемой. В службе централизованного ведения журналов сценарий включает ведение журнала на основе коллекции серверных компонентов, уровней ведения журнала и флагов, что намного эффективнее и полезнее, чем определение этих элементов для каждого сервера. Нужный сценарий определяется для всех серверов и пулов используемой области инфраструктуры и согласованно выполняется на них.
  
Сценарий по умолчанию называется **AlwaysOn**. Сценарий AlwaysOn, в соответствии со своим названием, предназначен для постоянного выполнения. Сценарий AlwaysOn собирает данные на уровне Info (обратите внимание, что помимо информационных сообщений при ведении журнала на уровне Info также регистрируются сообщения Fatal (неустранимо), Error (ошибка) и Warning (предупреждение)) для многих из наиболее типичных серверных компонентов. AlwaysOn собирает сведения до, во время и после возникновения проблемы. Это резко отличается от поведения предыдущих средств ведения журнала, таких как OCSLogger. OCSLogger запускается уже после появления проблемы, что затрудняет поиск и устранение неисправностей, так как данные собираются как реакция на событие, а не упреждающе. Если AlwaysOn не содержит данных, нужных для определения проблемного компонента, и не указывает направление действий для исправления проблемы (что, скорее всего, связано с недостаточной шириной и глубиной поставщиков в AlwaysOn), будет указан разумный уровень данных для определения дальнейших действий, таких как создание нового сценария, сбор других данных, выполнение другого поиска для сбора более подробных сведений и т. д.
  
Централизованная служба ведения журналов предоставляет два способа выдачи команд. A number of topics have been focused squarely on using Windows PowerShell through the Skype for Business Server Management Shell. Возможность использовать ряд сложных конфигураций и команд имеет Windows PowerShell для централизованного ведения журналов. Поскольку Windows PowerShell с помощью командной оболочки Skype для бизнеса Server почти повсеместно распространено для всех функций в Skype для бизнеса Server, обсуждаются только Windows PowerShell команды. 
  
### <a name="to-run-start-csclslogging-with-windows-powershell-using-basic-commands"></a>Запуск Start-CsClsLogging с Windows PowerShell с помощью базовых команд

1. Запустите оболочку управления Skype для бизнеса Server: нажмите кнопку "Начните", выберите "Все программы", "Skype для бизнеса **2015",** а затем щелкните "Skype для бизнеса Server Management **Shell".**
    
2. Запустите сценарий ведения журнала с помощью службы централизованного ведения журналов, введя следующую текстовую ссылку:
    
   ```PowerShell
   Start-CsClsLogging -Scenario <name of scenario>
   ```

    Например, для запуска сценария **AlwaysOn** введите:
    
   ```PowerShell
   Start-CsClsLogging -Scenario AlwaysOn
   ```

    > [!NOTE]
    > У сценария AlwaysOn нет длительности по умолчанию. Этот сценарий будет выполняться, пока он не будет явно остановлен с помощью командлета **Stop-CsClsLogging**. Подробные сведения см. в статье [Stop-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/stop-csclslogging?view=skype-ps). Для всех остальных сценариев длительность по умолчанию составляет 4 часа. 
  
3. Для выполнения команды нажмите клавишу ВВОД. 
    
    > [!NOTE]
    > Для выполнения команд и возвращения состояния от компьютеров среды может потребоваться некоторое небольшое время (от 30 до 60 секунд). 
  
     ![Запуск Start-CsClsLogging.](../../media/Ops_CLS_Show_and_Start_ClsLogging.jpg)
  
4. Чтобы выполнить другой сценарий, используйте командлет **Start-CsClsLogging** с именем выполняемого дополнительного сценария (например, сценария **Authentication**):
    
   ```PowerShell
   Start-CsClsLogging -Scenario Authentication
   ```

    > [!IMPORTANT]
    > В любой момент времени на любом конкретном компьютере может работать не более двух сценариев. Если область применения команды является глобальной, этот сценарий или сценарии будут выполняться на всех компьютерах среды. Для запуска третьего сценария необходимо остановить ведение журнала для области применения (компьютер, пул, сайт, глобальная), в которой нужно запустить новый сценарий. Если сценарии запущены в глобальной области применения, можно остановить ведение журнала в одном или обоих сценариях для одного или нескольких компьютеров и пулов. 
  
### <a name="to-run-start-csclslogging-with-windows-powershell-using-advanced-commands"></a>Запуск Start-CsClsLogging с Windows PowerShell с помощью расширенных команд

1. Запустите оболочку управления Skype для бизнеса Server: нажмите кнопку "Начните", выберите "Все программы", "Skype для бизнеса **2015",** а затем щелкните "Skype для бизнеса Server Management **Shell".**
    
2. Для управления командами ведения журнала доступны дополнительные параметры. Вы можете использовать -Duration, чтобы настроить продолжительность времени для запуска сценария. Вы также можете определить -Computers, список полного доменного имени компьютера (FQDNs), разделенный запятой, или -Pools, разделенный запятой список FQDNs для пулов, в которых необходимо выполнить ведение журнала.
    
    Сеанс ведения журнала для сценария UserReplicator начинается в пуле "pool01.contoso.net". При этом длительность сеанса ведения журнала определяется равной 8 часам. Для этого введите следующую команду:
    
   ```PowerShell
   Start-CsClsLogging -Scenario UserReplicator -Duration 8:00 -Pools "pool01.contoso.net"
   ```

    При успешном выполнении этого сценария возвращается результат, подобный следующему:
    
     ![Запуск Start-CsClsLogging.](../../media/Ops_CsClsLogging_UserReplicator_Exp.jpg)
  
Обратите внимание, что в этом примере выполняются сценарий AlwaysOn и сценарий UserReplicator. 
    
## <a name="stop-the-centralized-logging-service-log-capture"></a>Остановка записи журнала службы централизованного ведения журналов
<a name="stop"> </a>

Остановить текущий работающий сеанс ведения журнала можно с помощью командлета Stop-CsClsLogging. Как правило, не так много ситуаций, в которых необходимо остановить сеанс ведения журнала. Например, поиск в журналах и изменение конфигураций можно выполнять без обязательной предварительной остановки ведения журнала. Если выполняются два сценария, например AlwaysOn и UserReplicator, и нужно собирать сведения, связанные с проверкой подлинности (сценарий Authentication), понадобится остановить один из других сценариев (на глобальном уровне, уровне сайта, пула или компьютера), прежде чем можно будет запустить сценарий Authentication. Подробные сведения см. в статье [Stop-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/stop-csclslogging?view=skype-ps).
  
> [!NOTE]
> При определении сценариев, которые можно запускать в заданных развертываниях, пулах или компьютерах, следует помнить, что на компьютере можно запускать только два **сценария:** AlwaysOn и один пользовательский сценарий. При ведении журнала действий для пула следует считать пул единым объектом. В большинстве случаев бессмысленно выполнять разные сценарии на каждом компьютере пула. Стоит взглянуть на проблему, для которой собираются данные, и поискать сценарий, который даст максимальный эффект для данного компьютера в общей среде. Например, если рассмотреть сценарий UserReplicator, запуск UserReplicator на сервере или в пуле будет иметь очень мало значения. 
  
Разобравшись в проблеме и оценив масштаб влияния, следует аккуратно выбрать, какие сценарии будут выполняться и на каких компьютерах и пулах. Хотя сценарий AlwaysOn имеет смысл для широкой области применения, так как он собирает данные для широкого множества поставщиков, определенные сценарии целесообразно применять только на конкретных компьютерах и пулах. Кроме того, следует соблюдать осторожность и не запускать сеанс ведения журнала случайным образом, не разобравшись сначала в эффективности данного сценария в конкретном случае. Использование неправильного сценария или сценария, не соответствующего задаче, либо запуск сценария в неправильной области применения (будь это глобальный уровень, уровень площадки, пула или компьютера), может привести к получению сомнительных и не слишком полезных данных — как если бы никакой сценарий вообще не запускался.
  
Для управления функциями службы централизованного ведения журналов с помощью оболочки управления Skype для бизнеса Server необходимо быть участником групп безопасности управления доступом на основе ролей (RBAC) CsAdministrator или CsServerAdministrator, а также настраиваемой роли RBAC, которая содержит какую-либо из этих двух групп. Чтобы получить список всех ролей RBAC, которые были назначены этому командлету (включая все самостоятельно созданные роли RBAC), запустите следующую команду в командной Windows PowerShell Командная Windows PowerShell Skype для бизнеса Server:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Skype for Business Server 2015 cmdlet"}
```

Например:
  
```PowerShell
Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}
```

> [!NOTE]
> Поэтому вам может быть интересно: теперь, когда вы включили ведение журнала, где хранятся журналы? Так как вы будете получать доступ к сведениям, хранимым в журналах, с помощью запросов оболочки управления, отправленных агентам CLS, и вы можете выводить результаты в несколько возможных форматов файлов, где на каждом сервере агент CLS сохраняет свои записи, на самом деле не важно знать.  Файлы журнала можно сохранить в заявленном расположении, а также  прочитать и проанализировать с помощью различных средств, в том числеSnooper.exeи любого средства, которое может читать текстовый файл, например **Notepad.exe.** Snooper.exe входит в состав средств отлаки Skype для бизнеса Server 2015 и доступна в качестве [веб-загрузки.](https://go.microsoft.com/fwlink/p/?LinkId=285257)

### <a name="to-stop-a-currently-running-centralized-logging-service-session"></a>Остановка сеанса централизованной службы ведения журналов

1. Запустите оболочку управления Skype для бизнеса Server: нажмите кнопку "Начните", выберите "Все программы", "Skype для бизнеса **2015",** а затем щелкните "Skype для бизнеса Server Management **Shell".**
    
2. Запросив централизованную службу ведения журналов, чтобы узнать, какие сценарии в настоящее время запущены, введите следующую:
    
   ```PowerShell
   Show-CsClsLogging
   ```

   ![Windows PowerShell консоли после вызова Show-CsCl](../../media/Ops_Show_Stop_CsClsLogging.jpg)
  
   Результатом выполнения Show-CsClsLogging являются сводные данные обо всех выполняемых сценариях и областях их выполнения. Подробные сведения см. в статье [Show-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/show-csclslogging?view=skype-ps).
    
3. Чтобы остановить выполняемый в данный момент сеанс ведения журнала, введите:
    
   ```PowerShell
   Stop-CsClsLogging -Scenario <scenario name> -Computers <comma separated list of fully qualified computer names> -Pools <comma separated list of fully qualified pool names>
   ```
   Пример:
    
   ```PowerShell
   Stop-CsClsLogging -Scenario UserReplicator -Pools pool01.contoso.net
   ```

   Эта команда остановит ведение журнала с помощью сценария UserReplicatior для pool01.contoso.net.
    
    > [!NOTE]
    > Журналы, созданные в течение останавливаемого сеанса ведения журнала с помощью сценария UserReplicator, не удаляются. Журналы остаются доступными для выполнения поиска с помощью команды Search-CsClsLogging. Подробные сведения см. в статье [Search-CsClsLogging](https://docs.microsoft.com/powershell/module/skype/search-csclslogging?view=skype-ps). 
  
Действуя в качестве команды-спутника для Start-CsClsLogging, командлет Stop-CsClsLogging завершает сеанс ведения журнала и сохраняет журналы, созданные в течение этого сеанса. Одновременно на данном компьютере может выполняться не более двух сценариев. Способ остановки одного сценария для сбора данных с помощью другого сценария является типовой задачей, часто выполняемой при устранении неполадок рабочих нагрузок.
## <a name="see-also"></a>См. также
<a name="stop"> </a>

[Служба централизованного ведения журналов в Skype для бизнеса 2015](centralized-logging-service.md)
