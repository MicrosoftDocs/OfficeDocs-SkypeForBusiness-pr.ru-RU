---
title: Централизованная служба ведения журнала в Skype для бизнеса 2015
ms.reviewer: ''
ms.author: jambirk
author: jambirk
manager: serdars
ms.date: 2/1/2018
ms.audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 975718a0-f3e3-404d-9453-6224e73bfdd0
description: 'Сводка: Сведения о компонентах службы и параметры конфигурации для централизованной службы ведения журналов в Скайп для Business Server 2015.'
ms.openlocfilehash: 6f1766e97c318a11095aa2f064cd09a0785c1562
ms.sourcegitcommit: 111bf6255fa877b3fce70fa8166e8ec5a6643434
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32217594"
---
# <a name="centralized-logging-service-in-skype-for-business-2015"></a>Централизованная служба ведения журнала в Skype для бизнеса 2015
 
**Сводка:** Сведения о компонентах службы и параметры конфигурации для централизованной службы ведения журналов в Скайп для Business Server 2015.
  
Службы централизованного ведения журналов выполнить следующие действия. 
  
- Запуск или остановка ведения журнала на один или несколько компьютеров и пулов с помощью одной команды из центрального расположения.
    
- поиск в журналах на одном или нескольких компьютерах и в пулах. Настройка поиска для возвращения всех журналов на всех компьютерах или более кратким результатов.
    
- Настройте сеансы ведения журналов следующим образом:
    
  - Define a **Scenario**, or use a default scenario. Сценарий в централизованной службы ведения журналов состоит из области действия (глобальные или сайт), имя сценария для определения назначения сценария и одного или нескольких поставщиков. Сценарий по умолчанию и один определенный сценарий можно запустить в любой момент времени на компьютере.
    
  - Используйте существующего поставщика или создайте нового. Aprovider определяет собирает сеанс ведения журнала, какой уровень детализации, какие компоненты для трассировки и какие флаги, применяются.
    
    > [!TIP]
    >  Если вы знакомы с OCSLogger, termproviders ссылается на коллекцию **компонентов** (например, S4, SIPStack), **тип ведения журнала** (например, WPP, EventLog или IIS файла журнала), **уровня трассировки** (например, все, подробные сообщения, отладка) и **флаги** (например, TF_COMPONENT, TF_DIAG). Эти элементы определяются в поставщике (переменной Windows PowerShell) и передается в команду централизованной службы ведения журналов.
  
  - Настройка журналов для определенных компьютеров и пулов.
    
  - Определите узел сеанса ведения журналов в параметрах **Узел** (для сбора данных только с компьютеров в этом узле) или **Глобальный** (для сбора данных со всех компьютеров в развертывании).
    
Службы централизованного ведения журналов — это мощное средство устранения неполадок для решения проблем больших или у анализ основных причин снижения производительности. Во всех примерах показаны с помощью Скайп для консоли Business Server. Help is provided for the command-line tool through the tool itself, but there is a limited set of functions that you can execute from the command line. С помощью Скайп для консоли Business Server, имеется доступ к намного более и более настраиваемая набор функциональных возможностей, поэтому всегда должно быть в первую очередь. 
  
## <a name="logging-service-components"></a>Компоненты службы ведения журналов

 Службы централизованного ведения журналов выполняется на всех серверах в развертывании и включает в себя следующие агенты и служб:
  
- Централизованный ClsAgent агента службы ведения журналов выполняется на каждом компьютере с Скайп для развертывания Business Server. Он прослушивает (порты **TCP 50001 50003**) для команды из ClsController через WCF и отправляет ответы на контроллер. Управляет журнала сеансов (start, stop или изменение) и выполняет поиск журналы. Он также выполняет такие служебные операции, как архивирование и очистка журналов. 
    
- Централизованного ведения журналов службы контроллера командлеты Скайп для консоли Business Server отправляет команды Start, Stop, очистка и поиска ClsAgent. When search commands are sent, the resulting logs are returned to the ClsControllerLib.dll and aggregated. The controller sends commands to the agent, receives the status of those commands and manages the search log file data as it is returned from all agents on any computer in the search scope, and aggregates the log data into a meaningful and ordered output set. Сведения, приведенные в следующих разделах, ориентированный на использование Скайп для консоли Business Server.
    
**Взаимодействие ClsController и ClsAgent**

![Связь между CLSController и CLSAgent.](../../media/Ops_CLS_Architecture.jpg)
  
Выполнение команд, с помощью интерфейса командной строки Windows Server или Скайп для консоли Business Server. The commands are executed on the computer you are logged in to and sent to the ClsAgent locally or to the other computers and pools in your deployment.
  
ClsAgent поддерживает файл индекса всех файлов .CACHE, которые имеются на локальном компьютере. ClsAgent размещает их так, чтобы они равномерно распределялись по томам, определенным параметром CacheFileLocalFolders, и не занимали более 80% места на каждом томе (расположение и процент локального кэша можно настроить с помощью командлета **Set-CsClsConfiguration**). ClsAgent также отвечает за удаление с локального компьютера устаревших кэшированных файлов журнала трассировки событий (файлов ETL). По истечении двухнедельного срока (этот временной интервал настраивается с помощью командлета **Set-CsClsConfiguration**) эти файлы копируются в общую папку и удаляются с локального компьютера. Дополнительные сведения см. в описании командлета [Set-CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/set-csclsconfiguration?view=skype-ps). При получении запроса поиска условия поиска используются для выбора набора кэшированных ETL-файлов для выполнения поиска на основании значений из индекса, поддерживаемого агентом.
  
> [!NOTE]
> ClsAgent может выполнять поиск файлов, перемещенных в общую папку с локального компьютера. После перемещения файлов в общую папку ClsAgent не контролирует их устаревание и удаление. Необходимо определить административную задачу для отслеживания размера файлов в общей папке и их удаления или архивации. 
  
Результирующие файлы журналов можно считывать и анализировать с помощью различных средств, в том числе с помощью **Snooper.exe ** и других средств, способных считывать текстовые файлы, таких как **Notepad.exe**. Snooper.exe является частью Скайп для средств отладки 2015 Business Server и доступен в качестве [Web загрузить](https://go.microsoft.com/fwlink/p/?LinkId=285257).
  
Как OCSLogger Centralized Logging Service имеет несколько компонентов для трассировки от и позволяет выбрать флаги, такие как TF_COMPONENT и TF_DIAG. Служба централизованного ведения журналов также сохраняет параметры уровня ведения журнала из OCSLogger.
  
Наиболее важное преимущество использования Скайп для консоли Business Server через командной строки ClsController — можно настраивать и определить новые сценарии, с помощью выбранного поставщиков, относящихся к области, настраиваемые флаги и уровни ведения журнала. The scenarios available to ClsController are limited to those that are defined for the executable.
  
В предыдущих версиях средство OCSLogger.exe позволяло администраторам и сотрудникам технической поддержки собирать файлы трассировки с компьютеров в развертывании. Наряду с преимуществами средство OCSLogger обладало одним существенным недостатком. В заданный момент времени журналы можно было собирать только на одном компьютере. Можно было вести журналы на нескольких компьютерах с помощью отдельных копий OCSLogger, но при этом создавалось несколько журналов, а простого способа объединения результатов не существовало.
  
Когда пользователь запрашивает поиск журналов, ClsController определяет, на какие компьютеры отправить этот запрос (на основании выбранных сценариев). Контроллер также определяет, нужно ли выполнять поиск в общей папке, в которой находятся сохраненные ETL-файлы. При получении результатов поиска ClsController объединяет их в один упорядоченный по времени набор, который предоставляется пользователю. Пользователи могут сохранять результаты поиска на локальном компьютере для дальнейшего анализа.
  
При запуске сеанса ведения журнала пользователь указывает сценарии, имеющие отношение к решаемой задаче. В любой момент времени могут выполняться два сценария. Одним из этих сценариев должен быть сценарий AlwaysOn. Как можно понять из названия, этот сценарий должен всегда выполняться в развертывании, собирая сведения о всех компьютерах, пулах и компонентах.
  
> [!IMPORTANT]
> Сценарий AlwaysOn не выполняется в развертывании по умолчанию. Этот сценарий необходимо явно запустить. После запуска он будет выполняться, пока не будет явно остановлен, а состояние выполнения будет сохраняться между перезагрузками компьютеров. Подробные сведения о запуске и остановке сценарии, в разделе [Запуск или остановка CLS запись в журнал в Скайп для Business Server 2015](start-or-stop-log-capture.md). 
  
При возникновении неполадок запустите второй сценарий, связанный с обнаруженной проблемой. Воспроизведите условия возникновения проблемы и остановите ведение журнала для второго сценария. Выполните в журнале поиск данных, связанных с обнаруженной проблемой. При объединении журналов создается файл, содержащий сообщения трассировки со всех компьютеров в области сайта или в глобальной области развертывания. Если поиск возвращает слишком много данных, которые физически невозможно проанализировать (такую ситуацию часто называют отношением "сигнал-шум", в котором значение "шума" слишком велико), выполните другой поиск с более точными параметрами. На этом этапе можно заметить наборы данных, которые позволяют выявить признаки проблемы и сузить круг поиска. В конечном счете, после выполнения нескольких уточненных поисков можно обнаружить данные, имеющие отношение к проблеме, и определить ее причину.
  
> [!TIP]
> Когда появится проблемный сценарий в Скайп для Business Server, в первую очередь спросите себя «Что уже узнать о проблеме?» Если измерить границы проблему, можно исключить большая часть действующие сущностей в Скайп для Business Server. 
  
Рассмотрим пример сценария, в котором пользователи не получают актуальные результаты при поиске контактов. Нет смысла в поиск проблем в компонентов мультимедиа, корпоративной голосовой связи, конференц-связи и ряд других компонентов. Неизвестно только то, где фактически возникла проблема: в клиенте или на стороне сервера? Контакты собранные Репликатор пользователей из Active Directory и доставки клиенту через сервер адресной книги (этой). Этой получает обновления из базы данных RTC (где репликатора пользовательских данных был создан их) и собирает их в файлы адресной книги по умолчанию - 1:30 по. Скайп для клиентов, Business Server получить новый адресной книги в произвольной время по расписанию. Так как вы знаете, как работает процесс, можно уменьшить поиск возможных причин проблемы, связанные с данными, записываются из Active Directory с репликатора пользовательских данных этой не извлечение и создание файлов адресной книги или клиенты не Загрузка файла адресной книги.
  
## <a name="current-configuration"></a>Текущая конфигурация

Службы централизованного ведения журналов настроен для определения возможности службы ведения журналов предназначен для collect, как оно собирает, где он будет собирать из и какие существуют параметры журнала. You define these settings globally (that is, for the entire deployment) or for a site (that is, a named site in your deployment). Any logging that you define will use the settings that are appropriate for the identity that you use for commands to start, stop, flush, and search logs.
  
### <a name="to-display-the-current-centralized-logging-service-configuration"></a>Чтобы отобразить текущую конфигурацию централизованной службы ведения журналов

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Введите следующую команду в командной строке:
    
   ```
   Get-CsClsConfiguration
   ```

    > [!TIP]
    > Вы можете сузить или расширить область параметров конфигурации, которые возвращаются, определив `-Identity` и области, например «Site: Redmond», чтобы возвратить только CsClsConfiguration для сайта Redmond. Просмотра сведений о данная часть конфигурации можно передать выходные данные в другой командлета Windows PowerShell. Например чтобы получить подробные сведения о сценариев, описанных в разделе Конфигурация сайта «Redmond», введите:`Get-CsClsConfiguration -Identity "site:Redmond" | Select-Object -ExpandProperty Scenarios`
  
     ![Выход выборки из Get-CsClsConfiguration.](../../media/Ops_Get-CsClsConfiguration_Basic.jpg)
  
    Результат выполнения командлета демонстрирует текущую конфигурацию службы централизованного ведения журналов.
    
|**Параметр конфигурации**|**Описание**|
|:-----|:-----|
|**Identity** <br/> |Определяет область действия и имя данной конфигурации.  Существует одна глобальная конфигурация и по одной конфигурации для каждого сайта.  <br/> |
|**Scenarios** <br/> |Список всех сценариев, определенных для данной конфигурации.  <br/> |
|**SearchTerms** <br/> |Определенные поисковые запросы для этой конфигурации. Office 365, не в локальных развертываниях.  <br/> |
|**SecurityGroups** <br/> |Определенные группы безопасности, которые управляют кто (т. е. участники групп безопасности) могут просматривать компьютеры на основе сайта их размещения. В данном контексте-сайт, определенный в построителе топологий.  <br/> |
|**Regions** <br/> |Определенные регионы используются для сбора групп безопасности по регионам, например EMEA (страны Европы, Ближнего Востока и Африки).  <br/> |
|**EtlFileRolloverSizeMB** <br/> |Данный параметры указывает максимальный размер файла журнала до создания нового файла трассировки журнала (.etl). Новый файл журнала создается при достижении определенного размера, даже если не было достигнуто значение, заданное в параметре EtlFileRolloverMinutes.  <br/> |
|**EtlFileRolloverMinutes** <br/> |Определенное максимальное время существования журнала (в минутах) до создания нового ETL-файла. Новый файл журнала создается по завершении таймера, даже если еще не было достигнуто значение максимального размера, заданное в параметре EtlFileRolloverSizeMB.  <br/> |
|**TmfFileSearchPath** <br/> |Местоположение для поиска файлов формата трассировки сообщений.  <br/> |
|**CacheFileLocalFolders** <br/> |Определенный путь к месту сохранения файлов кэша на компьютерах. CLSAgent записывает файлы кэша и работает в контексте сетевой службы. В этом случае значением переменной %TEMP% является %WINDIR%\ServiceProfiles\NetworkService\AppData\Local. По умолчанию файлы кэша и файлы журнала записываются в один каталог.  <br/> |
|**CacheFileNetworkFolder** <br/> |Можно определить UNC-путь для получения файлов кэша во время операций ведения журналов.  <br/> |
|**CacheFileLocalRetentionPeriod** <br/> |Определяется как максимальное время в днях для сохранения файлов кэша.  <br/> |
|**CacheFileMaxDiskUsage** <br/> |Определяется как часть дискового пространства (выраженное в процентах), которое может использоваться под файлы кэша.  <br/> |
|**ComponentThrottleLimit** <br/> |Определяется как максимальное количество трассировок в секунду, которое может создавать компонент до активации автоматического ограничителя.  <br/> |
|**ComponentThrottleSample** <br/> |Количество превышений значения ComponentThrottleLimit в течение 60 секунд.  <br/> |
|**MinimumClsAgentServiceVersion** <br/> |Минимальная версия CLSAgent, допустимая для запуска. Этот элемент предназначен для Office 365.  <br/> |
   

