---
title: Централизованная служба ведения журналов в Skype для бизнеса 2015
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 2/1/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 975718a0-f3e3-404d-9453-6224e73bfdd0
description: Сводка. сведения о компонентах службы и параметрах конфигурации для централизованной службы ведения журналов в Skype для бизнеса Server 2015.
ms.openlocfilehash: e65ea3a0a5ed4d86591b630df6d84e436a7efd66
ms.sourcegitcommit: d69bad69ba9a9bca4614d72d8f34fb2a0a9e4dc4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/13/2020
ms.locfileid: "44221893"
---
# <a name="centralized-logging-service-in-skype-for-business-2015"></a>Централизованная служба ведения журналов в Skype для бизнеса 2015
 
**Сводка:** Узнайте о компонентах службы и параметрах конфигурации для централизованной службы ведения журналов в Skype для бизнеса Server 2015.
  
Централизованная служба ведения журналов может выполнять следующие действия: 
  
- Запуск или остановка ведения журнала на одном или нескольких компьютерах и в пулах с помощью одной команды из центрального расположения.
    
- Журналы поиска на одном или нескольких компьютерах и в пулах. Вы можете настроить поиск, чтобы получить все журналы на всех компьютерах, или вернуть более краткие результаты.
    
- Настройте сеансы ведения журналов следующим образом:
    
  - Определите **сценарий** или используйте сценарий по умолчанию. Сценарий в службе централизованного ведения журналов состоит из области (Глобальная или site), имени сценария для определения назначения сценария и одного или нескольких поставщиков. Вы можете запустить сценарий по умолчанию и один определенный сценарий в любое время на компьютере.
    
  - Используйте существующий поставщик или создайте новый. Апровидер определяет, что собирает сеанс ведения журнала, какой уровень детализации, какие компоненты следует отслеживать и какие флаги применяются.
    
    > [!TIP]
    >  Если вы знакомы с OCSLogger, термпровидерс относится к набору **компонентов** (например, S4, SIPStack), **типу ведения журнала** (например, WPP, EventLog, EventLog или IIS), **уровню трассировки** (например, ALL, Verbose, Debug) и **флагам** (например, TF_COMPONENT, TF_DIAG). Эти элементы определены в поставщике (переменная Windows PowerShell) и передаются в команду централизованной службы ведения журналов.
  
  - Настройка журналов для определенных компьютеров и пулов.
    
  - Определите область для сеанса ведения журнала на **сайте** параметры (для запуска записи в журнал только на компьютерах этого сайта) или **глобально** (для запуска записи журнала на всех компьютерах в развертывании).
    
Централизованная служба ведения журналов — это мощное средство устранения неполадок для проблем, связанных с анализом основных причин, на проблемы с производительностью. Все примеры показаны в консоли управления Skype для бизнеса Server. Справка предоставляется в средстве командной строки с помощью самого средства, но существует ограниченный набор функций, которые можно выполнить из командной строки. С помощью командной консоли Skype для бизнеса Server вы можете получить доступ к гораздо большей и более настраиваемому набору функций, чтобы всегда быть первым вариантом. 
  
## <a name="logging-service-components"></a>Компоненты службы ведения журналов

 Служба централизованного ведения журналов выполняется на всех серверах в развертывании и состоит из следующих агентов и служб:
  
- ClsAgent агент службы централизованного ведения журналов работает на каждом компьютере с развернутым Skype для бизнеса Server. Он прослушивает (on Ports **TCP 50001-50003**) команды из CLSCONTROLLER over WCF и отправляет ответы обратно на контроллер. Он управляет сеансами журнала (запуск/остановка/обновление) и выполняет поиск в журналах. Она также выполняет операции по обслуживанию, такие как архивация журналов и очистка. 
    
- Командлеты контроллера службы централизованного ведения журналов Командная консоль Skype для бизнеса Server Management Shell отправляет команды Start, Stop, Flush и Search в ClsAgent. При отправке команд поиска полученные журналы возвращаются в Клсконтроллерлиб. dll и объединяются в файл. dll. Контроллер отправляет команды агенту, получает состояние этих команд и управляет данными файла журнала поиска, как они возвращаются из всех агентов на любом компьютере в области поиска, и объединяет данные журнала в осмысленный и упорядоченный набор выходных данных. Сведения в следующих разделах посвящены использованию командной консоли Skype для бизнеса Server.
    
**Взаимодействие ClsController и ClsAgent**

![Отношение между CLSController и CLSAgent.](../../media/Ops_CLS_Architecture.jpg)
  
Команды выдаются с помощью интерфейса командной строки Windows Server или консоли управления Skype для бизнеса Server. Команды выполняются на компьютере, на котором выполнен вход в систему, и отправляются локальному агенту ClsAgent или на другие компьютеры и пулы в развертывании.
  
ClsAgent поддерживает файл индекса всех файлов .CACHE, которые имеются на локальном компьютере. ClsAgent размещает их так, чтобы они равномерно распределялись по томам, определенным параметром CacheFileLocalFolders, и не занимали более 80% места на каждом томе (расположение и процент локального кэша можно настроить с помощью командлета **Set-CsClsConfiguration**). ClsAgent также отвечает за удаление с локального компьютера устаревших кэшированных файлов журнала трассировки событий (файлов ETL). По истечении двухнедельного срока (этот временной интервал настраивается с помощью командлета **Set-CsClsConfiguration**) эти файлы копируются в общую папку и удаляются с локального компьютера. Дополнительные сведения см. в описании командлета [Set-CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/set-csclsconfiguration?view=skype-ps). При получении запроса поиска условия поиска используются для выбора набора кэшированных ETL-файлов для выполнения поиска на основании значений из индекса, поддерживаемого агентом.
  
> [!NOTE]
> ClsAgent может выполнять поиск файлов, перемещенных в общую папку с локального компьютера. После перемещения файлов в общую папку ClsAgent не контролирует их устаревание и удаление. Необходимо определить административную задачу для отслеживания размера файлов в общей папке и их удаления или архивации. 
  
Результирующие файлы журналов можно считывать и анализировать с помощью различных средств, в том числе с помощью **Snooper.exe** и других средств, способных считывать текстовые файлы, таких как **Notepad.exe**. Snooper. exe является частью средств отладки Skype для бизнеса Server 2015 и доступна для [загрузки в Интернете](https://go.microsoft.com/fwlink/p/?LinkId=285257).
  
Как и в OCSLogger, централизованная служба ведения журналов имеет несколько компонентов для трассировки и предоставляет параметры для выбора флагов, таких как TF_COMPONENT и TF_DIAG. Служба централизованного ведения журналов также сохраняет параметры уровня ведения журнала OCSLogger.
  
Наиболее важное преимущество использования командной консоли Skype для бизнеса Server в командной строке ClsController состоит в том, что вы можете настроить и определить новые сценарии с использованием выбранных поставщиков, которые предназначены для проблемного пространства, настраиваемых флагов и уровней ведения журнала. Средство ClsController ограничено сценариями, определенными для исполняемого процесса.
  
В предыдущих версиях средство OCSLogger.exe позволяло администраторам и сотрудникам технической поддержки собирать файлы трассировки с компьютеров в развертывании. Наряду с преимуществами, средство OCSLogger обладало одним существенным недостатком. В заданный момент времени журналы можно было собирать только на одном компьютере. Можно было вести журналы на нескольких компьютерах с помощью отдельных копий OCSLogger, но при этом создавалось несколько журналов, а простого способа объединения результатов не существовало.
  
Когда пользователь запрашивает поиск журналов, ClsController определяет, на какие компьютеры отправить этот запрос (на основании выбранных сценариев). Контроллер также определяет, нужно ли выполнять поиск в общей папке, в которой находятся сохраненные ETL-файлы. При получении результатов поиска ClsController объединяет их в один упорядоченный по времени набор, который предоставляется пользователю. Пользователи могут сохранять результаты поиска на локальном компьютере для дальнейшего анализа.
  
При запуске сеанса ведения журнала пользователь указывает сценарии, имеющие отношение к решаемой задаче. В любой момент времени могут выполняться два сценария. Одним из этих сценариев должен быть сценарий AlwaysOn. Как можно понять из названия, этот сценарий должен всегда выполняться в развертывании, собирая сведения о всех компьютерах, пулах и компонентах.
  
> [!IMPORTANT]
> Сценарий AlwaysOn не выполняется в развертывании по умолчанию. Этот сценарий необходимо явно запустить. После запуска он будет выполняться, пока не будет явно остановлен, а состояние выполнения будет сохраняться между перезагрузками компьютеров. Более подробную информацию о запуске и остановке сценариев можно узнать [в статье запуск и остановка записи журнала CLS в Skype для бизнеса Server 2015](start-or-stop-log-capture.md). 
  
При возникновении неполадок запустите второй сценарий, связанный с обнаруженной проблемой. Воспроизведите условия возникновения проблемы и остановите ведение журнала для второго сценария. Выполните в журнале поиск данных, связанных с обнаруженной проблемой. При объединении журналов создается файл, содержащий сообщения трассировки со всех компьютеров в области сайта или в глобальной области развертывания. Если поиск возвращает слишком много данных, которые физически невозможно проанализировать (такую ситуацию часто называют отношением "сигнал-шум", в котором значение "шума" слишком велико), выполните другой поиск с более точными параметрами. На этом этапе можно заметить наборы данных, которые позволяют выявить признаки проблемы и сузить круг поиска. В конечном счете, после выполнения нескольких уточненных поисков можно обнаружить данные, имеющие отношение к проблеме, и определить ее причину.
  
> [!TIP]
> Если в Skype для бизнеса Server возникла проблема с ситуацией, начните с запроса "что уже знаете об этой проблеме?". Если вы количественно изчислить границы проблемы, вы можете исключить большую часть рабочих сущностей в Skype для бизнеса Server. 
  
Рассмотрим пример сценария, в котором пользователи не получают актуальные результаты при поиске контактов. Нет смысла искать проблемы в компонентах мультимедиа, корпоративной голосовой связи, конференц-связи и некоторых других компонентах. Неизвестно только то, где фактически возникла проблема: в клиенте или на стороне сервера? Контакты собираются из Active Directory репликатором пользователей и доставляются клиенту с помощью сервера адресной книги (ABServer). ABServer получает обновления из базы данных RTC (то есть репликатор пользователей написал их) и собирает их в файлы адресной книги по умолчанию — 1:30 AM. Клиенты Skype для бизнеса Server получают новую адресную книгу по случайному расписанию. Так как вы знаете, как работает процесс, вы можете уменьшить область поиска, чтобы получить потенциальную причину проблемы, связанной с сбором данных из Active Directory репликатором пользователей, ABServer не извлекать и не создавать файлы адресной книги, а клиенты не загружали файл адресной книги.
  
## <a name="current-configuration"></a>Текущая конфигурация

Служба централизованного ведения журналов настраивается на определение того, что должна собирать служба ведения журнала, как она собирает данные, откуда она будет собирать данные и какие параметры журнала. Эти параметры определяются глобально (то есть для всего развертывания) или для сайта (то есть именованный сайт в вашем развертывании). Любое определенное ведение журнала приведет к использованию параметров, подходящих для удостоверения, используемого для команд запуска, остановки, очистки журналов и выполнения поиска.
  
### <a name="to-display-the-current-centralized-logging-service-configuration"></a>Отображение текущей конфигурации централизованной службы ведения журналов

1. Запустите консоль управления Skype для бизнеса Server: нажмите кнопку **Пуск**, последовательно выберите **все программы**, **Skype для бизнеса 2015**и щелкните **Командная консоль Skype для бизнеса Server**.
    
2. Введите следующую команду в командной строке:
    
   ```PowerShell
   Get-CsClsConfiguration
   ```

    > [!TIP]
    > Вы можете сузить или расширить область параметров конфигурации, возвращаемых определением `-Identity` и областью, например "site: Redmond", чтобы возвратить только CsClsConfiguration для сайта Redmond. Если вы хотите получить подробные сведения об определенной части конфигурации, вы можете передать выходные данные в другой командлет Windows PowerShell. Например, чтобы получить сведения о сценариях, определенных в конфигурации для сайта Redmond, введите:`Get-CsClsConfiguration -Identity "site:Redmond" | Select-Object -ExpandProperty Scenarios`
  
     ![Пример выходных данных Get – CsClsConfiguration.](../../media/Ops_Get-CsClsConfiguration_Basic.jpg)
  
    В результате выполнения командлета отображается текущая конфигурация централизованной службы ведения журналов.
    
|**Параметр конфигурации**|**Описание**|
|:-----|:-----|
|**Identity** <br/> |Определяет область действия и имя данной конфигурации.  Существует одна глобальная конфигурация и по одной конфигурации для каждого сайта.  <br/> |
|**Scenarios** <br/> |Список всех сценариев, определенных для данной конфигурации.  <br/> |
|**SearchTerms** <br/> |Определенные поисковые запросы для этой конфигурации. Microsoft 365 или Office 365, а не локальные развертывания.  <br/> |
|**Групп безопасности** <br/> |Определенные группы безопасности, которые управляют кто (т. е. участники групп безопасности) могут просматривать компьютеры на основе сайта их размещения. Сайт в данном контексте — это сайт, определенный в построителе топологий.  <br/> |
|**Регионы** <br/> |Определенные регионы используются для сбора групп безопасности по регионам, например EMEA (страны Европы, Ближнего Востока и Африки).  <br/> |
|**етлфилеролловерсиземб** <br/> |Данный параметры указывает максимальный размер файла журнала до создания нового файла трассировки журнала (.etl). Новый файл журнала создается при достижении определенного размера, даже если не было достигнуто значение, заданное в параметре EtlFileRolloverMinutes.  <br/> |
|**етлфилеролловерминутес** <br/> |Определенное максимальное время существования журнала (в минутах) до создания нового ETL-файла. Новый файл журнала создается по завершении таймера, даже если еще не было достигнуто значение максимального размера, заданное в параметре EtlFileRolloverSizeMB.  <br/> |
|**тмффилесеарчпас** <br/> |Местоположение для поиска файлов формата трассировки сообщений.  <br/> |
|**CacheFileLocalFolders** <br/> |Определенный путь к месту сохранения файлов кэша на компьютерах. CLSAgent записывает файлы кэша и работает в контексте сетевой службы. В этом случае значением переменной %TEMP% является %WINDIR%\ServiceProfiles\NetworkService\AppData\Local. По умолчанию файлы кэша и файлы журнала записываются в один каталог.  <br/> |
|**качефиленетворкфолдер** <br/> |Можно определить UNC-путь для получения файлов кэша во время операций ведения журналов.  <br/> |
|**качефилелокалретентионпериод** <br/> |Определяется как максимальное время в днях для сохранения файлов кэша.  <br/> |
|**качефилемаксдискусаже** <br/> |Определяется как часть дискового пространства (выраженное в процентах), которое может использоваться под файлы кэша.  <br/> |
|**Превышений значения componentthrottlelimit** <br/> |Определяется как максимальное количество трассировок в секунду, которое может создавать компонент до активации автоматического ограничителя.  <br/> |
|**компонентсроттлесампле** <br/> |Количество превышений значения ComponentThrottleLimit в течение 60 секунд.  <br/> |
|**минимумклсажентсервицеверсион** <br/> |Минимальная версия CLSAgent, допустимая для запуска. Этот элемент предназначен для Microsoft 365 или Office 365.  <br/> |
   

