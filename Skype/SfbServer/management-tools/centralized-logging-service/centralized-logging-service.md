---
title: Централизованная служба ведения журнала в Skype для бизнеса 2015
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 2/1/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 975718a0-f3e3-404d-9453-6224e73bfdd0
description: 'Сводка: сведения о компонентах служб и параметрах конфигурации для централизованной службы ведения журналов в Skype для бизнеса Server 2015.'
ms.openlocfilehash: a02d2a283716dd01572e0cbd8cccf075b29fd9b8
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2019
ms.locfileid: "34274515"
---
# <a name="centralized-logging-service-in-skype-for-business-2015"></a>Централизованная служба ведения журнала в Skype для бизнеса 2015
 
**Сводка:** Узнайте о компонентах служб и параметрах конфигурации для централизованной службы ведения журналов в Skype для бизнеса Server 2015.
  
Служба централизованного ведения журналов может выполнять указанные ниже действия. 
  
- Запускать и останавливать ведение журнала на одном или нескольких компьютерах и пулах с помощью одной команды из центрального места.
    
- поиск в журналах на одном или нескольких компьютерах и в пулах. Вы можете настроить поиск так, чтобы возвращались все журналы на всех компьютерах, или вернуть более четкие результаты.
    
- Настройте сеансы ведения журналов следующим образом:
    
  - Define a **Scenario**, or use a default scenario. Сценарий централизованной службы ведения журнала состоит из области охвата (Global или site), имени сценария для идентификации назначения сценария и одного или нескольких поставщиков. Вы можете запустить сценарий по умолчанию и один определенный сценарий в любой момент на компьютере.
    
  - Используйте существующего поставщика или создайте нового. Апровидер определяет, что собирает сеанс ведения журнала, какой уровень детализации, какие компоненты должны отслеживаться и какие флаги применяются.
    
    > [!TIP]
    >  Если вы знакомы с Окслогжер, термпровидерс ссылается на коллекцию **компонентов** (например, S4, сипстакк), **тип ведения журнала** (например, WPP, EventLog или logfile-журнала IIS), **уровень трассировки** (например, "все", "журнал событий" и "Отладка"). и **Флаги** (например, ТФ_КОМПОНЕНТ, тф_диаг). Эти элементы определяются в поставщике (переменной Windows PowerShell) и передаются команде централизованной службы ведения журнала.
  
  - Настройка журналов для конкретных компьютеров и пулов.
    
  - Определите узел сеанса ведения журналов в параметрах **Узел** (для сбора данных только с компьютеров в этом узле) или **Глобальный** (для сбора данных со всех компьютеров в развертывании).
    
Централизованная служба ведения журналов — это мощное средство устранения неполадок для проблем большого или маленького размера от анализа корневой причины до проблем с производительностью. Все примеры отображаются в командной консоли управления Skype для бизнеса Server. Help is provided for the command-line tool through the tool itself, but there is a limited set of functions that you can execute from the command line. С помощью командной консоли Skype для бизнеса Server вы можете получить доступ к гораздо более крупным и более настраиваемым наборам функций, чтобы всегда быть первым вариантом. 
  
## <a name="logging-service-components"></a>Компоненты службы ведения журналов

 Служба централизованного ведения журналов работает на всех серверах в развертывании и состоит из следующих агентов и служб:
  
- Служба централизованного ведения журналов Клсажент работает на всех компьютерах с развернутым приложением Skype для бизнеса Server. Она ожидает (на портах **TCP 50001-50003**) команды от КЛСКОНТРОЛЛЕР через WCF и отправляет ответы обратно на контроллер. Он управляет сеансами журнала (запуск/остановка/обновление) и выполняет поиск в журналах. Он также выполняет такие служебные операции, как архивирование и очистка журналов. 
    
- Централизованное ведение журнала. командлеты для управления службами в Skype для бизнеса Server Командная консоль Клсажент отправляет команды Пуск, остановить, сброс и поиск When search commands are sent, the resulting logs are returned to the ClsControllerLib.dll and aggregated. The controller sends commands to the agent, receives the status of those commands and manages the search log file data as it is returned from all agents on any computer in the search scope, and aggregates the log data into a meaningful and ordered output set. Информация, приведенная в следующих разделах, сосредоточена на использовании командной консоли Skype для бизнеса Server.
    
**Взаимодействие ClsController и ClsAgent**

![Связь между CLSController и CLSAgent.](../../media/Ops_CLS_Architecture.jpg)
  
Команды выдаются с помощью интерфейса командной строки Windows Server или консоли управления Skype для бизнеса Server. The commands are executed on the computer you are logged in to and sent to the ClsAgent locally or to the other computers and pools in your deployment.
  
ClsAgent поддерживает файл индекса всех файлов .CACHE, которые имеются на локальном компьютере. ClsAgent размещает их так, чтобы они равномерно распределялись по томам, определенным параметром CacheFileLocalFolders, и не занимали более 80% места на каждом томе (расположение и процент локального кэша можно настроить с помощью командлета **Set-CsClsConfiguration**). ClsAgent также отвечает за удаление с локального компьютера устаревших кэшированных файлов журнала трассировки событий (файлов ETL). По истечении двухнедельного срока (этот временной интервал настраивается с помощью командлета **Set-CsClsConfiguration**) эти файлы копируются в общую папку и удаляются с локального компьютера. Дополнительные сведения см. в описании командлета [Set-CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/set-csclsconfiguration?view=skype-ps). При получении запроса поиска условия поиска используются для выбора набора кэшированных ETL-файлов для выполнения поиска на основании значений из индекса, поддерживаемого агентом.
  
> [!NOTE]
> ClsAgent может выполнять поиск файлов, перемещенных в общую папку с локального компьютера. После перемещения файлов в общую папку ClsAgent не контролирует их устаревание и удаление. Необходимо определить административную задачу для отслеживания размера файлов в общей папке и их удаления или архивации. 
  
Результирующие файлы журналов можно считывать и анализировать с помощью различных средств, в том числе с помощью **Snooper.exe ** и других средств, способных считывать текстовые файлы, таких как **Notepad.exe**. Снупер. exe входит в состав средств отладки Skype для бизнеса Server 2015, и его можно загрузить в виде [веб-сайта](https://go.microsoft.com/fwlink/p/?LinkId=285257).
  
Как и в Окслогжер, централизованная служба ведения журналов имеет несколько компонентов для трассировки и предоставляет параметры для выбора флагов, например ТФ_КОМПОНЕНТ и ТФ_ДИАГ. Служба централизованного ведения журналов также сохраняет параметры уровня ведения журнала для Окслогжер.
  
Самое важное преимущество использования командной консоли Skype для бизнеса Server для управления с помощью команды Клсконтроллер заключается в том, что вы можете настраивать и определять новые сценарии с помощью выбранных поставщиков, которые предназначены для проблемного пространства, настраиваемых флагов и уровней ведения журнала. The scenarios available to ClsController are limited to those that are defined for the executable.
  
В предыдущих версиях средство OCSLogger.exe позволяло администраторам и сотрудникам технической поддержки собирать файлы трассировки с компьютеров в развертывании. Наряду с преимуществами средство OCSLogger обладало одним существенным недостатком. В заданный момент времени журналы можно было собирать только на одном компьютере. Можно было вести журналы на нескольких компьютерах с помощью отдельных копий OCSLogger, но при этом создавалось несколько журналов, а простого способа объединения результатов не существовало.
  
Когда пользователь запрашивает поиск журналов, ClsController определяет, на какие компьютеры отправить этот запрос (на основании выбранных сценариев). Контроллер также определяет, нужно ли выполнять поиск в общей папке, в которой находятся сохраненные ETL-файлы. При получении результатов поиска ClsController объединяет их в один упорядоченный по времени набор, который предоставляется пользователю. Пользователи могут сохранять результаты поиска на локальном компьютере для дальнейшего анализа.
  
При запуске сеанса ведения журнала пользователь указывает сценарии, имеющие отношение к решаемой задаче. В любой момент времени могут выполняться два сценария. Одним из этих сценариев должен быть сценарий AlwaysOn. Как можно понять из названия, этот сценарий должен всегда выполняться в развертывании, собирая сведения о всех компьютерах, пулах и компонентах.
  
> [!IMPORTANT]
> Сценарий AlwaysOn не выполняется в развертывании по умолчанию. Этот сценарий необходимо явно запустить. После запуска он будет выполняться, пока не будет явно остановлен, а состояние выполнения будет сохраняться между перезагрузками компьютеров. Подробнее о запуске и остановке сценариев можно найти [в разделе Запуск и остановка записи журнала CLS в Skype для бизнеса Server 2015](start-or-stop-log-capture.md). 
  
При возникновении неполадок запустите второй сценарий, связанный с обнаруженной проблемой. Воспроизведите условия возникновения проблемы и остановите ведение журнала для второго сценария. Выполните в журнале поиск данных, связанных с обнаруженной проблемой. При объединении журналов создается файл, содержащий сообщения трассировки со всех компьютеров в области сайта или в глобальной области развертывания. Если поиск возвращает слишком много данных, которые физически невозможно проанализировать (такую ситуацию часто называют отношением "сигнал-шум", в котором значение "шума" слишком велико), выполните другой поиск с более точными параметрами. На этом этапе можно заметить наборы данных, которые позволяют выявить признаки проблемы и сузить круг поиска. В конечном счете, после выполнения нескольких уточненных поисков можно обнаружить данные, имеющие отношение к проблеме, и определить ее причину.
  
> [!TIP]
> При возникновении проблемной ситуации в Skype для бизнеса Server Начните с запроса "что вам уже известно о проблеме?" Если вы количественно оценить количество проблем, вы можете исключить значительную часть рабочих сущностей в Skype для бизнеса Server. 
  
Рассмотрим пример сценария, в котором пользователи не получают актуальные результаты при поиске контактов. Нет ничего в поиске проблем в мультимедийных компонентах, корпоративных голосах, конференц-связи и некоторых других компонентах. Неизвестно только то, где фактически возникла проблема: в клиенте или на стороне сервера? Контакты собираются из Active Directory репликатором пользователей и доставляются клиенту с помощью сервера адресной книги (Абсервер). Абсервер получает обновления из базы данных RTC (там, где служба тиражирования пользователей написала их) и собирает их в файлы адресной книги по умолчанию — 1:30 AM. Клиент Skype для бизнеса Server извлекает новую адресную книгу в случайном расписании. Поскольку вы знаете, как работает процесс, вы можете уменьшить Поиск потенциальных причин на проблемы, связанные с данными, собранными из Active Directory репликатором пользователей, Абсервер не удается получить и создать файлы адресной книги или клиенты, не Загрузи файл адресной книги.
  
## <a name="current-configuration"></a>Текущая конфигурация

Служба централизованного ведения журналов настраивается для определения того, как должна собираться служба ведения журнала, как она будет собирать данные, откуда она собирается и какие параметры журнала. You define these settings globally (that is, for the entire deployment) or for a site (that is, a named site in your deployment). Any logging that you define will use the settings that are appropriate for the identity that you use for commands to start, stop, flush, and search logs.
  
### <a name="to-display-the-current-centralized-logging-service-configuration"></a>Чтобы отобразить текущую конфигурацию централизованной службы ведения журнала

1. Запустите командную консоль Skype для бизнеса: нажмите кнопку **Пуск**, последовательно выберите пункты **Все программы** и **Skype для бизнеса 2015** и щелкните элемент **Командная консоль Skype для бизнеса**.
    
2. Введите следующую команду в командной строке:
    
   ```
   Get-CsClsConfiguration
   ```

    > [!TIP]
    > Вы можете сузить или расширить область параметров конфигурации, возвращаемых определением `-Identity` и областью, например "site: Redmond", чтобы возвращать только Ксклсконфигуратион для Redmond сайта. Если вы хотите получить подробные сведения о конкретной части конфигурации, вы можете передать эти данные в другой командлет Windows PowerShell. Например, чтобы получить подробные сведения о сценариях, определенных в конфигурации для сайта Redmond, введите:`Get-CsClsConfiguration -Identity "site:Redmond" | Select-Object -ExpandProperty Scenarios`
  
     ![Выход выборки из Get-CsClsConfiguration.](../../media/Ops_Get-CsClsConfiguration_Basic.jpg)
  
    Результат командлета выводит текущую конфигурацию централизованной службы ведения журнала.
    
|**Параметр конфигурации**|**Описание**|
|:-----|:-----|
|**Identity** <br/> |Определяет область действия и имя данной конфигурации.  Существует одна глобальная конфигурация и по одной конфигурации для каждого сайта.  <br/> |
|**Scenarios** <br/> |Список всех сценариев, определенных для данной конфигурации.  <br/> |
|**SearchTerms** <br/> |Определенные поисковые запросы для этой конфигурации. Office 365, а не локальные развертывания.  <br/> |
|**SecurityGroups** <br/> |Определенные группы безопасности, которые управляют кто (т. е. участники групп безопасности) могут просматривать компьютеры на основе сайта их размещения. Сайт в данном контексте — сайт, определенный в построителе топологии.  <br/> |
|**Regions** <br/> |Определенные регионы используются для сбора групп безопасности по регионам, например EMEA (страны Европы, Ближнего Востока и Африки).  <br/> |
|**EtlFileRolloverSizeMB** <br/> |Данный параметры указывает максимальный размер файла журнала до создания нового файла трассировки журнала (.etl). Новый файл журнала создается при достижении определенного размера, даже если не было достигнуто значение, заданное в параметре EtlFileRolloverMinutes.  <br/> |
|**EtlFileRolloverMinutes** <br/> |Определенное максимальное время существования журнала (в минутах) до создания нового ETL-файла. Новый файл журнала создается по завершении таймера, даже если еще не было достигнуто значение максимального размера, заданное в параметре EtlFileRolloverSizeMB.  <br/> |
|**TmfFileSearchPath** <br/> |Местоположение для поиска файлов формата трассировки сообщений.  <br/> |
|**CacheFileLocalFolders** <br/> |Определенный путь к месту сохранения файлов кэша на компьютерах. CLSAgent записывает файлы кэша и работает в контексте сетевой службы. В этом случае значением переменной %TEMP% является %WINDIR%\ServiceProfiles\NetworkService\AppData\Local. По умолчанию файлы кэша и файлы журнала записываются в один каталог.  <br/> |
|**CacheFileNetworkFolder** <br/> |Можно определить UNC-путь для получения файлов кэша во время операций ведения журналов.  <br/> |
|**CacheFileLocalRetentionPeriod** <br/> |Определяется как максимальное время в днях для сохранения файлов кэша.  <br/> |
|**CacheFileMaxDiskUsage** <br/> |Определяется как часть дискового пространства (выраженное в процентах), которое может использоваться под файлы кэша.  <br/> |
|**ComponentThrottleLimit** <br/> |Определяется как максимальное количество трассировок в секунду, которое может создавать компонент до активации автоматического ограничителя.  <br/> |
|**ComponentThrottleSample** <br/> |Количество превышений значения ComponentThrottleLimit в течение 60 секунд.  <br/> |
|**MinimumClsAgentServiceVersion** <br/> |Минимальная версия CLSAgent, допустимая для запуска. Этот элемент предназначен для Office 365.  <br/> |
   

