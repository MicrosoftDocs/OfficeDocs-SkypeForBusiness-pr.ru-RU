---
title: Использование средства Modern Authentication (ADAL) со Skype для бизнеса
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 5ca71746-ead6-4e8c-90b1-461e846d1f4a
description: В этой статье объясняется, как использовать современные средства проверки подлинности (в соответствии с библиотекой проверки подлинности Active Directory (ADAL) и OAuth 2,0), которые можно найти в накопительном обновлении за март 2016 для Skype для бизнеса Server 2015.
ms.openlocfilehash: 9fe4470e1f8f6e2cd345cd176250fb1ffb16448f
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2019
ms.locfileid: "34286125"
---
# <a name="how-to-use-modern-authentication-adal-with-skype-for-business"></a>How to use Modern Authentication (ADAL) with Skype for Business
 
В этой статье объясняется, как использовать современные средства проверки подлинности (в соответствии с библиотекой проверки подлинности Active Directory (ADAL) и OAuth 2,0), которые можно найти в накопительном обновлении за март 2016 для Skype для бизнеса Server 2015 или из начального отпустите версию для Skype для бизнеса Server 2019.
  
## <a name="whats-in-this-article"></a>В этой статье

[Настройка ADAL в пуле и установка AD FS в качестве сервера маркеров безопасности](use-adal.md#BKMK_Config)
  
[Другие варианты включения входа ADAL (например, в клиентских приложениях Office)](use-adal.md#BKMK_Options)
  
[Клиенты, на которых служба Modern Authentication или ADAL не поддерживается](use-adal.md#BKMK_Support)
  
### <a name="configure-adal-in-your-pool-and-set-ad-fs-as-security-token-server"></a>Настройка ADAL в пуле и установка AD FS в качестве сервера маркеров безопасности
<a name="BKMK_Config"> </a>

В этом процессе вы подключаетесь к установке служб федерации Active Directory в пул серверов Skype для бизнеса, настроенный для ADAL.
  
1. Установите накопительное обновление за март 2016 (или более новую версию) для Skype для бизнеса Server 2015 на сервер пула Skype для бизнеса или Standard Edition. (При необходимости запланируйте периоды обслуживания, чтобы запустить Центр обновления Windows для автоматической установки.)
    
2. На локальных серверах AD FS [Скачайте](https://aka.ms/sfbadalscripts) сценарий Setup-адфсоауструстфорсфб. (Это необходимо сделать для каждой фермы AD FS или независимых серверов доменных служб Active Directory (ов). Это не нужно делать на прокси-серверы AD FS или прокси.)
    
3. Обратите внимание на внутренние и внешние доменные имена веб-службы для пула сервера Skype для бизнеса или Standard Edition. Это необходимо выполнить для всех пулов Skype для бизнеса.
    
4. Из PowerShell на серверах AD FS (-ов), запустите `Setup-AdfsOAuthTrustForSfB.ps1` (для windows Server 2012 R2) или `Setup-Adfs2016OAuthTrustForSfB.ps1` (для Windows Server 2016 или более поздней версии). Необходимо ввести правильные URL-адреса для внутренних и внешних доменных имен в полном виде (FQDN). Ниже приводится пример.
    
     `Setup-AdfsOAuthTrustForSfB.ps1 -poolIDs https://contosoSkype.contoso.com,https://contoso01Skype.contosoIn.com`
    
    Для любых дополнительных пулов вам потребуется вручную добавить URL-адреса для использования в качестве доверенной стороны в Skype для бизнеса Server в AD FS.
    
    > [!IMPORTANT]
    > Невозможно использовать пассивную проверку подлинности для пула одновременно с ADAL. Чтобы использовать ADAL, сначала отключите пассивную проверку подлинности. Инструкции для командлетов PowerShell, посвященные настройке проверки подлинности для пула, описаны в [этой](https://technet.microsoft.com/en-us/library/gg398396.aspx) статье.
  
    > [!TIP]
    > Если у вас есть дополнительные пулы, вам нужно добавить их [](https://technet.microsoft.com/en-us/library/gg557759%28v=ws.10%29.aspx) в качестве идентификаторов в отношение доверия проверяющей стороны в AD FS. _гт_ перейдите на свой сервер AD FS и откройте оснастку управления AD FS. Разверните элемент доверия \> проверяющей стороны отношений доверия. Щелкните правой кнопкой мыши отношение доверия проверяющей стороны, которое вы видите, и щелкните правой \> кнопкой мыши \> , чтобы добавить в список идентификаторы свойств \> дополнительные URL-адреса пула. 
  
5. Вернитесь на сервер переднего плана Skype для бизнеса Server или сервер Standard Edition. Отсюда вы должны выполнить командлеты, которые создают сервер OAuth и изменяют конфигурацию OAuth для работы в Skype для бизнеса. Этот шаг требуется выполнить только один раз для развертывания Skype для бизнеса Server. Ниже приводится пример:
    
     `New-CsOAuthServer -Identity sts.contosoIn.com -Type ADFS -MetadataURL https://sts.contosoIn.com/FederationMetadata/2007-06/FederationMetadata.xml`
    
    > [!TIP]
    > URL-адрес, который вы видите в этой команде, — это имя службы федерации AD FS, которое можно просмотреть в разделе "Управление AD FS", если \> щелкнуть правой кнопкой мыши свойства службы. "Тип" всегда является "ADFS", а "Метадатаурл" всегда \<является именем\> службы AD FS + "/FederationMetadata/2007-06/FederationMetadata.XML". 
  
     `Set-CsOAuthConfiguration -ClientAuthorizationOAuthServerIdentity sts.contosoIn.com`
    
6. Протестируйте новую конфигурацию с помощью адреса SIP и полного доменного имени пула в Skype для бизнеса Server, наступающем на клиенте и на стандарте Standard Edition. Этот шаг требуется выполнить только один раз для развертывания Skype для бизнеса Server. Этот шаг необходимо выполнить только один раз для каждого развертывания skype16_server Ниже приводится пример:
    
     `Test-CsRegistration -UserSipAddress AyakaY@contosoIns.com -TargetFqdn Pool1.contoso.com -Authentication OAuthInteractive`
    
7. При появлении запроса введите учетные данные тестового пользователя. Убедитесь, что тест завершен успешно.
    
    > [!NOTE]
    > Если URL-адрес службы STS разрешается в AD FS *внутренним образом* , выводится сообщение о том, что будет отображаться запрос **системы безопасности Windows** . Если он разрешается внешне, будет отображаться подсказка **Вход**. Обычно рекомендуется выполнить действия, которые приведут к отображению подсказки **Безопасность Windows**. Обратите внимание, что это поведение изменяется, особенно при реализации проверки подлинности по формам форм (FBA).
  
Также имейте в виду, что когда URL-адрес службы STS разрешается во внутренний сервер AD FS и встроенная проверка подлинности Windows включена в браузерах, на компьютерах с большим количеством пользователей, которые могут войти в клиентские приложения, может возникнуть сбой проверки подлинности, если браузер явно не указан настроено, чтобы запрашивать учетные данные пользователей в определенной зоне безопасности браузера. В качестве примера можно представить киоск. Учетная запись, под которой выполнен вход в операционную систему, может отличаться от учетной записи пользователя, под которой выполнен вход в клиент Skype для бизнеса. В этом случае могут возникнуть описанные здесь ошибки.
    
Вы можете просматривать и изменять этот параметр браузера в Internet \> Explorer, выбирая инструменты (или компоненты) \> на вкладке \> \> безопасность параметров Интернета и зоны безопасности (например, Местная интрасеть). В этом диалоговом окне нажмите кнопку "Другой" и прокрутите до конца списка в диалоговом окне "Параметры". В разделе Вход \> в \> систему проверки подлинности пользователя вы увидите параметр "запрашивать имя пользователя и пароль". Если у вас есть киоски, где пользователь, запускающий клиент Skype для бизнеса, отличается (имеет другую учетную запись) от пользователя, вошедшего в компьютер, можно для таких компьютеров в целях тестирования установить для этого параметра значение "ВКЛ." в групповой политике.
    
Наконец, может отображаться несколько подсказок, так как система безопасности собирает данные, необходимые для проверки подлинности или авторизации вашей учетной записи.
    
### <a name="other-options-for-enabling-adal-sign-in-like-office-client-apps"></a>Другие варианты включения входа ADAL (например, в клиентских приложениях Office)
<a name="BKMK_Options"> </a>

Теперь, когда ADAL настроено для Skype для бизнеса и (автоматически) для клиентских приложений Office 2016 на разных платформах, вы можете использовать его для Exchange Online (там, где он не включен по умолчанию) или в клиентах Office 2013.
  
> [!IMPORTANT]
> Нужно знать, что следует ожидать от современной проверки подлинности при входе из клиентских приложений? Ознакомьтесь с принципами [работы современной проверки подлинности для клиентских приложений office 2013 и office 2016](https://support.office.com/en-us/article/How-modern-authentication-works-for-Office-2013-and-Office-2016-client-apps-e4c45989-4b1a-462e-a81b-2a13191cf517?ui=en-US&amp;rs=en-US&amp;ad=US). 
  
Чтобы включить функцию современной проверки подлинности для Exchange Online, необходимо запустить некоторые командлеты PowerShell. В случае с клиентскими приложениями Office 2013 некоторые разделы реестра на клиентских компьютерах необходимо будет изменить.
  
- Подключитесь к Exchange Online и выполните следующие командлеты:
    
     `Set-OrganizationConfig -OAuth2ClientProfileEnabled:$true`
    
     `Get-OrganizationConfig | ft name, *OAuth*`
    
- Настройте эти разделы реестра для каждого устройства и компьютера, на котором необходимо включить современную проверку подлинности. В крупных организациях необходимо использовать объекты групповой политики. Сведения о том, как сделать GPO, можно найти в статье Создание объекта групповой политики для изменения реестра на компьютере, подключенном к домену. [ ](https://support.office.com/en-us/article/Switching-between-the-Skype-for-Business-and-the-Lync-client-user-interfaces-a2394a4c-7522-484c-a047-7b3289742be0)
    
|Параметр реестра  <br/> |Тип  <br/> |Значение  <br/> |
|:-----|:-----|:-----|
|HKCU\SOFTWARE\Microsoft\Office\15.0\Common\Identity\EnableADAL  <br/> |REG_DWORD  <br/> |1  <br/> |
|HKCU\SOFTWARE\Microsoft\Office\15.0\Common\Identity\Version  <br/> |REG_DWORD  <br/> |1  <br/> |
   
После того как эти ключи будут заданы, настройте приложения Office для [использования многофакторной проверки подлинности (MFA) с Office 365](https://support.office.com/en-us/article/Set-up-multi-factor-authentication-for-Office-365-8f0454b2-f51a-4d9c-bcde-2c48e41621c6?ui=en-US&amp;rs=en-US&amp;ad=US).
  
> [!TIP]
> Чтобы отключить функцию современной проверки подлинности на устройствах для Office 2013, установите для раздела реестра HKCU\SOFTWARE\Microsoft\Office\15.0\Common\Identity\EnableADAL нулевое значение. Имейте в виду, что аналогичный раздел реестра (Хкку\софтваре\микрософт\оффице\ **16,0** \коммон\идентити\енаблеадал) можно также использовать для отключения современной проверки подлинности на устройствах для Office 2016.
  
### <a name="clients-where-modern-authentication--adal-isnt-supported"></a>Клиенты, на которых служба Modern Authentication или ADAL не поддерживается
<a name="BKMK_Support"> </a>

Некоторые версии клиентов не поддерживают протокол OAuth. Проверьте вашу версию клиента Office в разделе "Установка и удаление программ" панели управления и сравните с приведенными ниже номерами (и диапазоном) версий:
  
- Клиент Office 15,0. [0000-4766].\*
    
- Клиент Office 16,0. [0000-4293].\*
    
- Клиент Office 16.0.6001.[0000–1032]
    
- Клиент Office 16,0. [6000-6224].\*
    
> [!NOTE]
> Гибридная современная проверка подлинности также доступна в локальной среде Skype для бизнеса, если вы хотите получить дополнительные сведения [о том, как настроить локальное использование гибридной современной проверки подлинности в Skype для бизнеса](https://docs.microsoft.com/en-us/office365/enterprise/configure-skype-for-business-for-hybrid-modern-authentication) .
