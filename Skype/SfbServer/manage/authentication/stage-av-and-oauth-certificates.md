---
title: Подготовка сертификатов AV и OAuth в Skype для бизнеса Server с помощью -Roll в Set-CsCertificate
ms.reviewer: ''
ms.author: serdars
author: SerdarSoysal
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.collection: IT_Skype16
ms.assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
description: Сводка. Подготовка сертификатов AV и OAuth для Skype для бизнеса Server.
ms.openlocfilehash: fda09cb53b664419d9652a0b663c83adc770c5cf
ms.sourcegitcommit: 296862e02b548f0212c9c70504e65b467d459cc3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/25/2022
ms.locfileid: "65674611"
---
# <a name="stage-av-and-oauth-certificates-in-skype-for-business-server-using--roll-in-set-cscertificate"></a>Подготовка сертификатов AV и OAuth в Skype для бизнеса Server с помощью -Roll в Set-CsCertificate

**Сводка:** Подготовка сертификатов AV и OAuth для Skype для бизнеса Server.

Аудио- и видеосвязь (A/V) является ключевым компонентом Skype для бизнеса Server. Такие функции, как общий доступ к приложениям и аудио- и видеоконференции, зависят от сертификатов, назначенных пограничной службе A/V, в частности службе проверки подлинности A/V.

> [!IMPORTANT]
> Эта новая функция предназначена для работы со службой A/V Edge и сертификатом OAuthTokenIssuer. Другие типы сертификатов могут быть подготовлены вместе со службой A/V Edge и типом сертификата OAuth, но не будут пользоваться преимуществами совместного использования сертификата пограничной службы A/V.

Командлеты PowerShell командлетов командной консоли Skype для бизнеса Server, используемые для управления сертификатами Skype для бизнеса Server, называют сертификат службы A/V Edge типом сертификата AudioVideoAuthentication, а сертификат OAuthServer — как typeOAuthTokenIssuer. В оставшейся части этого раздела и для уникальной идентификации сертификатов на них будет ссылаться тот же тип идентификатора: AudioVideoAuthentication иOAuthTokenIssuer.

Служба проверки подлинности аудио- и видеоконференций отвечает за выдачу маркеров, используемых клиентами и другими пользователями аудио- и видеоконференций. Маркеры создаются на основе атрибутов сертификата, и по истечении срока действия сертификата, происходит разрыв соединения или отображается запрос на повторное подключение с использованием нового маркера, созданного новым сертификатом. Новая функция в Skype для бизнеса Server устраняет эту проблему — возможность подготовки нового сертификата до истечения срока действия старого сертификата и позволяет обоим сертификатам продолжать работать в течение определенного периода времени. Эта функция использует обновленные функции в командлете Set-CsCertificate Skype для бизнеса Server Management Shell. Новый параметр -Roll с существующим параметром -EffectiveDate будет размещать новый сертификат AudioVideoAuthentication в хранилище сертификатов. Предыдущий сертификат AudioVideoAuthentication по-прежнему действует для проверки выданных маркеров. С момента размещения нового сертификата AudioVideoAuthentication возникают следующие наборы событий:

> [!TIP]
> С помощью Skype для бизнеса Server командлетов командной консоли для управления сертификатами можно запросить отдельные и отдельные сертификаты для каждой цели на пограничном сервере. Использование мастера сертификатов в мастере Skype для бизнеса Server позволяет создавать сертификаты, но обычно это тип по умолчанию, который связывает все сертификаты,  которые используются для пограничного сервера, на один сертификат. Если планируется применение компонента последовательных сертификатов, рекомендуется отделить сертификат AudioVideoAuthentication от других назначений сертификата. Можно предоставить и разместить сертификат типа Default для промежуточного хранения, однако, только часть AudioVideoAuthentication объединенного сертификата сможет максимально эффективно использовать преимущества промежуточного хранения. Пользователю, участвующего в (например) обмене мгновенными сообщениями по истечении срока действия сертификата, потребуется выполнить выход и войти обратно, чтобы использовать новый сертификат, связанный со службой Access Edge. Аналогичное поведение будет происходить для пользователя, который участвует в веб-конференции с помощью пограничной службы веб-конференций. Сертификат OAuthTokenIssuer представляет собой отдельный тип, общий доступ к которому предоставляется для всех серверов. Сертификат создается и управляется в одном месте, а сертификат хранится в центральном хранилище управления для всех остальных серверов.

Для полного понимания возможностей и условий использования командлета Set-CsCertificate и использования его для промежуточного хранения сертификатов до истечения срока действия текущего сертификата требуются дополнительные данные. Параметр -Roll важен, но, по сути, имеет одно назначение. Если вы определяете его как параметр, вы сообщаете Set-CsCertificate, что вы будете предоставлять сведения о сертификате, который будет определен с помощью -Type (например, AudioVideoAuthentication и OAuthTokenIssuer), когда сертификат станет эффективным, определенным с помощью -EffectiveDate.

 **-Roll**: параметр -Roll является обязательным и имеет зависимости, которые должны быть предоставлены вместе с ним. Обязательные параметры, чтобы полностью определить, какие сертификаты будут затронуты и как они будут применяться:

 **-EffectiveDate**: параметр -EffectiveDate определяет, когда новый сертификат станет активным с текущим сертификатом. Значение -EffectiveDate может быть близко к истечении срока действия текущего сертификата или может быть более длительный период времени. Рекомендуемое минимальное значение -EffectiveDate для сертификата AudioVideoAuthentication — 8 часов. Это время существования маркера по умолчанию для маркеров службы AV Edge, выданных с помощью сертификата AudioVideoAuthentication.

При размещении сертификатов OAuthTokenIssuer для промежуточного хранения действуют различные требования в отношении времени упреждения, прежде чем действие сертификата вступит в силу. Минимальное время упреждения для сертификата OAuthTokenIssuer составляет 24 часа до истечения срока действия текущего сертификата. Увеличение времени упреждения для совместной работы применяется в связи с тем, что другие роли сервера, зависимые от сертификата OAuthTokenIssuer (например, Exchange Server), для которых предусматривается более продолжительный срок хранения сертификатов, создают данные проверки подлинности и ключа шифрования.

 **-Thumbprint**: отпечаток является атрибутом сертификата, уникальным для этого сертификата. Параметр -Thumbprint используется для идентификации сертификата, на который будут  повлиять действия Set-CsCertificate командлета.

 **-Type**: параметр -Type может принимать один тип использования сертификата или разделенный запятыми список типов использования сертификата. Типы сертификатов определяют назначение сертификата для командлета и сервера. Например, тип AudioVideoAuthentication используется службой A/V Edge и службой аутентификации AV. Если вы решили одновременно подготовить и подготовить сертификаты другого типа, необходимо учитывать максимально необходимое минимальное время выполнения сертификатов. Например, необходимо разместить сертификаты типа AudioVideoAuthentication и OAuthTokenIssuer. Минимальное значение -EffectiveDate должно быть больше двух сертификатов, в данном случае OAuthTokenIssuer, для которого минимальное время выполнения — 24 часа. Если вы не хотите размыкать сертификат AudioVideoAuthentication с временем выполнения 24 часа, разведите его отдельно с effectiveDate, что больше соответствует вашим требованиям.

## <a name="to-update-or-renew-an-av-edge-service-certificate-with-a--roll-and--effectivedate-parameters"></a>Обновление или продление сертификата пограничной службы A/V с параметрами -Roll и -EffectiveDate

1. Войдите на локальный компьютер в качестве члена группы "Администраторы".

2. Запросите продление или новый сертификат AudioVideoAuthentication с экспортируемым закрытым ключом для существующего сертификата в службе A/V Edge.

3. Импортируйте новый сертификат AudioVideoAuthentication на пограничный сервер и все остальные пограничные серверы в пуле (если у вас развернут пул).

4. Настройте импортированный сертификат с помощью Set-CsCertificate командлета и используйте параметр -Roll с параметром -EffectiveDate. Дата вступления в силу определяется как время истечения срока действия текущего сертификата (14:00:00 или 14:00:00) за вычетом срока действия маркера (по умолчанию — восемь часов). Это дает нам время, когда сертификат должен быть установлен в активный, и имеет значение -EffectiveDate \<string\>: "7/22/2015 6:00:00 AM".

   > [!IMPORTANT]
   > Для пограничного пула необходимо, чтобы все сертификаты AudioVideoAuthentication были развернуты и подготовлены в зависимости от даты и времени, определенных параметром -EffectiveDate первого развернутого сертификата, чтобы избежать возможного прерывания связи A/V из-за истечения срока действия старого сертификата до обновления всех клиентских и потребительских маркеров с помощью нового сертификата.

   Команда Set-CsCertificate с параметром -Roll и -EffectiveTime:

   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint <thumb print of new certificate> -Roll -EffectiveDate <date and time for certificate to become active>
   ```

   Пример команды Set-CsCertificate:

   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2015 6:00:00 AM"
   ```

    > [!IMPORTANT]
    > Значение EffectiveDate должно быть отформатировано в соответствии с региональными и языковыми параметрами сервера. В этом примере используются параметры региона и языка для английского языка в США.

Чтобы лучше понять, как Set-CsCertificate, -Roll и -EffectiveDate используют для подготовки нового сертификата для выдачи новых токенов AudioVideoAuthentication, при этом используя существующий сертификат для проверки AudioVideoAuthentication, которые используются потребителями, визуальная временная шкала является эффективным средством понимания процесса. В следующем примере администратор определяет, что срок действия сертификата пограничной службы A/V истекает в 14:00 22.07.2015. Он запрашивает и получает новый сертификат и импортирует его на каждый пограничный сервер в своем пуле. В 02:00 22.07.2015 он начинает выполнение Get-CsCertificate с параметром -Roll, -Thumbprint, равным строке отпечатка нового сертификата, и параметру -EffectiveTime задано значение 07.22.2015 6:00:00 AM. Он выполняет эту команду на каждом пограничном сервере.

![Использование параметров Roll и EffectiveDate.](../../media/Ops_Certificate_Set_Roll_EffectiveTime_Timeline.jpg)

|Выноска|Этап|
|:-----|:-----|
|1|Начало: 22.07.2015 12:00:00  <br/> Срок действия текущего сертификата AudioVideoAuthentication истекает в 14:00 22.2015. Это определяется меткой времени окончания срока действия сертификата. Запланируйте замену и смену сертификата, чтобы 8-часовой интервал (время существования маркера по умолчанию) истек срок действия существующего сертификата. В этом примере используется время выполнения в 02:00: 00, чтобы администратору было достаточно времени для размещения и подготовки новых сертификатов до 6:00:00.|
|2|22.07.2015 02:00–22.07.2015 5:59:59  <br/> Настройка сертификатов на пограничных серверах с фактическим временем 6:00:00 (для этого примера используется 4-часовой срок выполнения, но может быть длиннее) с помощью параметра Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll -EffectiveDate \<datetime string of the effective time for new certificate\>|
|3|22.07.2015 18:00–22.07.2015, 14:00  <br/> Чтобы проверить маркеры, сначала выполняется попытка нового сертификата, и если новый сертификат не может проверить маркер, выполняется попытка старого сертификата. Этот процесс используется для всех маркеров в течение 8 часов (время существования маркера по умолчанию).|
|4|Окончание: 22.07.2015 14:00:01  <br/> Срок действия старого сертификата истек, и новый сертификат перезаписал его. Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate -Type \<certificate usage type\> -Previous|

Когда будет достигнуто фактическое время (22.07.2015 6:00:00), все новые маркеры выданы новым сертификатом. Сначала выполняется проверка маркеров новым сертификатом. Если проверка не пройдена, маркеры проверяются старым сертификатом. Процедура проверки новым сертификатом и возврат к старому продолжается до тех пор, пока не истечет срок действия старого сертификата. По истечении срока действия старого сертификата (22.07.2015 14:00) маркеры будут проверяться только новым сертификатом. Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate с параметром -Previous.

```PowerShell
Remove-CsCertificate -Type AudioVideoAuthentication -Previous
```

## <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a--roll-and--effectivedate-parameters"></a>Обновление или продление сертификата OAuthTokenIssuer с параметрами -Roll и -EffectiveDate

1. Войдите на локальный компьютер в качестве члена группы "Администраторы".

2. Запросите продление или новый сертификат OAuthTokenIssuer с экспортируемым закрытым ключом для существующего сертификата на сервере переднего плана.

3. Импортируйте новый сертификат OAuthTokenIssuer на сервер переднего плана в пуле (если у вас развернут пул). Сертификат OAuthTokenIssuer реплицируется глобально, после чего требуется только его обновление и продление на всех серверах в текущей среде. В качестве примера используется сервер переднего плана.

4. Настройте импортированный сертификат с помощью Set-CsCertificate командлета и используйте параметр -Roll с параметром -EffectiveDate. Дата вступления в силу определяется как время истечения срока действия текущего сертификата (14:00:00 или 2:00:00 дня) за вычетом не менее 24 часов.

    Команда Set-CsCertificate с параметром -Roll и -EffectiveTime:

   ```PowerShell
   Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumbprint of new certificate> -Roll -EffectiveDate <date and time for certificate to become active> -identity Global
   ```

Пример команды Set-CsCertificate:

  ```PowerShell
  Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2015 1:00:00 PM"
  ```

> [!IMPORTANT]
> Значение EffectiveDate должно быть отформатировано в соответствии с региональными и языковыми параметрами сервера. В этом примере используются параметры региона и языка для английского языка в США.

Когда будет достигнуто фактическое время (21.07.2015 1:00:00), все новые маркеры выданы новым сертификатом. Сначала выполняется проверка маркеров новым сертификатом. Если проверка не пройдена, маркеры проверяются старым сертификатом. Процедура проверки новым сертификатом и возврат к старому продолжается до тех пор, пока не истечет срок действия старого сертификата. По истечении срока действия старого сертификата (22.07.2015 14:00) маркеры будут проверяться только новым сертификатом. Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate с параметром -Previous.

```PowerShell
Remove-CsCertificate -Type OAuthTokenIssuer -Previous
```

## <a name="see-also"></a>См. также

[Управление проверкой подлинности между серверами (OAuth) и партнерскими приложениями в Skype для бизнеса Server](server-to-server-and-partner-applications.md)

[Set-CsCertificate](/powershell/module/skype/set-cscertificate)

[Remove-CsCertificate](/powershell/module/skype/remove-cscertificate)
