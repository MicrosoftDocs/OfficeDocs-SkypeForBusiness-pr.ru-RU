---
title: Этап av и OAuth сертификаты в Skype для бизнеса Server с помощью -Roll в Set-CsCertificate
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.collection: IT_Skype16
ms.assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
description: Сводка. Сертификаты stage AV и OAuth для Skype для бизнеса Server.
ms.openlocfilehash: 335b1a3db8044329fd8055cf2a97f6e4e2bffc02
ms.sourcegitcommit: 556fffc96729150efcc04cd5d6069c402012421e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "58591223"
---
# <a name="stage-av-and-oauth-certificates-in-skype-for-business-server-using--roll-in-set-cscertificate"></a>Этап av и OAuth сертификаты в Skype для бизнеса Server с помощью -Roll в Set-CsCertificate
 
**Сводка:** Этап av и OAuth сертификаты для Skype для бизнеса Server.
  
Аудио- и видеосвязи являются ключевым компонентом Skype для бизнеса Server. Такие функции, как совместное использование приложений и аудио- и видеоконференций, зависят от сертификатов, присвоенных службе A/V Edge, в частности службе проверки подлинности A/V.
  
> [!IMPORTANT]
> Эта новая функция предназначена для работы службы A/V Edge и сертификата OAuthTokenIssuer. Другие типы сертификатов могут быть предусмотрены вместе со службой A/V Edge и типом сертификата OAuth, но не будут пользоваться поведением сосуществования, которое будет иметь сертификат A/V Edge.
  
Команды Skype для бизнеса Server PowerShell, используемые для управления сертификатами Skype для бизнеса Server, относятся к сертификату службы A/V Edge как тип сертификата AudioVideoAuthentication и сертификату OAuthServer как typeOAuthTokenIssuer. Для остальной части этой темы и для уникальной идентификации сертификатов они будут ссылаться на тот же тип идентификатора, AudioVideoAuthentication иOAuthTokenIssuer.
  
Служба проверки подлинности аудио- и видеоконференций отвечает за выдачу маркеров, используемых клиентами и другими пользователями аудио- и видеоконференций. Маркеры создаются на основе атрибутов сертификата, и по истечении срока действия сертификата, происходит разрыв соединения или отображается запрос на повторное подключение с использованием нового маркера, созданного новым сертификатом. Новая функция Skype для бизнеса Server облегчит эту проблему — возможность предварительного истечение срока действия старого сертификата и разрешение обоим сертификатам работать в течение определенного периода времени. Эта функция использует обновленные функции в Set-CsCertificate Skype для бизнеса Server команды Management Shell. Новый параметр -Roll с существующим параметром -EffectiveDate разоберет новый сертификат AudioVideoAuthentication в хранилище сертификатов. Предыдущий сертификат AudioVideoAuthentication по-прежнему действует для проверки выданных маркеров. С момента размещения нового сертификата AudioVideoAuthentication возникают следующие наборы событий:
  
> [!TIP]
> С помощью Skype для бизнеса Server для управления сертификатами можно запросить отдельные и отдельные сертификаты для каждой цели на edge Server. Использование мастера сертификатов в Skype для бизнеса Server мастер развертывания помогает вам в создании сертификатов,  но обычно это тип по умолчанию, который парами всех сертификатов использует для edge Server на одном сертификате. Если планируется применение компонента последовательных сертификатов, рекомендуется отделить сертификат AudioVideoAuthentication от других назначений сертификата. Можно предоставить и разместить сертификат типа Default для промежуточного хранения, однако, только часть AudioVideoAuthentication объединенного сертификата сможет максимально эффективно использовать преимущества промежуточного хранения. Для использования нового сертификата, связанного со службой Access Edge, пользователю, который участвует (например, в беседе с мгновенными сообщениями по истечении срока действия сертификата), потребуется выйти и войти в систему. Аналогичное поведение будет происходить для пользователя, вовлеченного в веб-конференцию с помощью службы Edge Web Conferencing. Сертификат OAuthTokenIssuer представляет собой отдельный тип, общий доступ к которому предоставляется для всех серверов. Вы создаете и управляете сертификатом в одном месте, а сертификат хранится в хранилище Central Management для всех остальных серверов.
  
Для полного понимания возможностей и условий использования командлета Set-CsCertificate и использования его для промежуточного хранения сертификатов до истечения срока действия текущего сертификата требуются дополнительные данные. Параметр -Roll имеет важное значение, но по сути является одной целью. Если вы определяете его как параметр, вы сообщаете Set-CsCertificate, что вы будете предоставлять сведения о сертификате, который будет затронут, определенный типом (например AudioVideoAuthentication и OAuthTokenIssuer), когда сертификат станет эффективным, определенным по -EffectiveDate.
  
 **-Roll.** Параметр -Roll является обязательным и имеет зависимостей, которые должны быть предоставлены вместе с ним. Необходимые параметры, чтобы полностью определить, какие сертификаты будут затронуты и как они будут применяться:
  
 **-EffectiveDate.** Параметр -EffectiveDate определяет, когда новый сертификат станет содействовать текущему сертификату. Срок действия сертификата -EffectiveDate может быть близок к истечении срока действия текущего сертификата или может быть более длительным. Рекомендуемый минимум -EffectiveDate для сертификата AudioVideoAuthentication будет 8 часов, что является сроком действия маркера по умолчанию для маркеров службы AV Edge, выдаваемого с помощью сертификата AudioVideoAuthentication.
  
При размещении сертификатов OAuthTokenIssuer для промежуточного хранения действуют различные требования в отношении времени упреждения, прежде чем действие сертификата вступит в силу. Минимальное время упреждения для сертификата OAuthTokenIssuer составляет 24 часа до истечения срока действия текущего сертификата. Увеличение времени упреждения для совместной работы применяется в связи с тем, что другие роли сервера, зависимые от сертификата OAuthTokenIssuer (например, Exchange Server), для которых предусматривается более продолжительный срок хранения сертификатов, создают данные проверки подлинности и ключа шифрования.
  
 **-Thumbprint.** Отпечатки пальцев — это атрибут сертификата, уникальный для этого сертификата. Параметр -Thumbprint используется для определения сертификата, на который влияют действия Set-CsCertificate.
  
 **-Type.** Параметр -Type может принимать один тип использования сертификата или раздельный список типов использования сертификата. Типы сертификатов — это те типы, которые определяют для комлета и сервера, какова цель сертификата. Например, тип AudioVideoAuthentication используется службой A/V Edge и службой аутентификации AV. Если вы решите одновременно этапировать и раздать сертификаты другого типа, необходимо учитывать самое длительное минимальное время действия сертификатов. Например, необходимо этапирование сертификатов типа AudioVideoAuthentication и OAuthTokenIssuer. Минимальный размер -EffectiveDate должен быть больше двух сертификатов, в данном случае OAuthTokenIssuer, который имеет минимальное время работы в течение 24 часов. Если вы не хотите, чтобы сертификат AudioVideoAuthentication находился в течение 24 часов, раздайте его отдельно с помощью EffectiveDate, который больше соответствует вашим требованиям.
  
### <a name="to-update-or-renew-an-av-edge-service-certificate-with-a--roll-and--effectivedate-parameters"></a>Обновление или обновление сертификата службы A/V Edge с параметрами -Roll и -EffectiveDate

1. Войдите на локальный компьютер в качестве члена группы администраторов.
    
2. Запрос обновления или нового сертификата AudioVideoAuthentication с экспортируемым закрытым ключом для существующего сертификата в службе A/V Edge.
    
3. Импортировать новый сертификат AudioVideoAuthentication на edge Server и все остальные edge Server в пуле (если у вас развернут пул).
    
4. Настройте импортируемый сертификат с помощью Set-CsCertificate и используйте параметр -Roll с параметром -EffectiveDate. Дата вступления в силу определяется как время истечения срока действия текущего сертификата (14:00:00 или 14:00:00) за вычетом срока действия маркера (по умолчанию — восемь часов). Это дает нам время, когда сертификат должен быть активен, и является -EffectiveDate: \<string\> "7/22/2015 6:00:00 AM". 
    
    > [!IMPORTANT]
    > Для пула Edge необходимо иметь все сертификаты AudioVideoAuthentication, развернутые и заданные в зависимости от даты и времени, определенных параметром -EffectiveDate первого развернутого сертификата, чтобы избежать возможного нарушения связи между A/V из-за истечения срока действия более старого сертификата до возобновления всех клиентских и потребительских маркеров с помощью нового сертификата. 
  
    Команда Set-CsCertificate с параметром -Roll и -EffectiveTime:
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          <thumb print of new certificate> -Roll -EffectiveDate <date and time
          for certificate to become active>
   ```

    Пример команды Set-CsCertificate:
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2015
          6:00:00 AM"
   ```

    > [!IMPORTANT]
    > EffectiveDate должен быть отформатирован в соответствие с регионами и языковыми настройками сервера. В примере используются параметры "Регион английского языка и языка США" 
  
Чтобы далее понять процесс, который Set-CsCertificate, -Roll и -EffectiveDate используют для инсцениции нового сертификата для выпуска новых маркеров AudioVideoAuthentication при использовании существующего сертификата для проверки audioVideoAuthentication, которые используются потребителями, визуальная временная шкала является эффективным средством понимания процесса. В следующем примере администратор определяет, что срок действия сертификата службы A/V Edge истекает в 14:00 07.22.2015. Он запрашивает и получает новый сертификат и импортирует его на каждый edge Server в своем пуле. В 02:00 07.22.2015 он начинает работать Get-CsCertificate с помощью -Roll, -Thumbprint, равного строке отпечатка пальца нового сертификата, и в наборе -EffectiveTime от 07.22.2015 06.00:00. Он выполняет эту команду на каждом краевом сервере.
  
![Использование параметров Roll и EffectiveDate.](../../media/Ops_Certificate_Set_Roll_EffectiveTime_Timeline.jpg)
  
|**Callout**|**Stage**|
|:-----|:-----|
|1   <br/> |Начало: 7/22/2015 12:00:00  <br/> Срок действия текущего сертификата AudioVideoAuthentication истекает в 14:00 7.22.2015. Это определяется штампом времени истечения срока действия сертификата. Планирование замены и опрокидывания сертификата с учетом 8-часового перекрытия (срок службы маркера по умолчанию) до истечения срока действия существующего сертификата. В этом примере используется время работы в 2:00:00, чтобы администратору было достаточно времени для того, чтобы разместить и обеспечить новые сертификаты до 6:00:00.  <br/> |
|2   <br/> |07.22.2015 14.00 - 07.22.2015 5:59:59  <br/> Установите сертификаты на edge Servers с эффективным временем 6:00:00 (для этого примера используется 4 часа, но может быть больше) с помощью Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll-EffectiveDate \<datetime string of the effective time for new certificate\>  <br/> |
|3   <br/> |07.22.2015 18.00 - 07.22.2015 14.00  <br/> Чтобы проверить маркеры, сначала проверяется новый сертификат, и если новый сертификат не может проверить маркер, старый сертификат будет опробовано. Этот процесс используется для всех маркеров в течение 8-часового периода перекрытия маркера по умолчанию.  <br/> |
|4   <br/> |Конец: 7/22/2015 14:00:01  <br/> Срок действия старого сертификата истек, и новый сертификат был переохачен. Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate \<certificate usage type\> -Type-Previous  <br/> |
   
Когда будет достигнуто эффективное время (7/22/2015 6:00:00 утра), все новые маркеры будут выданы новым сертификатом. Сначала выполняется проверка маркеров новым сертификатом. Если проверка не пройдена, маркеры проверяются старым сертификатом. Процедура проверки новым сертификатом и возврат к старому продолжается до тех пор, пока не истечет срок действия старого сертификата. По истечении срока действия старого сертификата (7/22/2015 2:00:00 pm) маркеры будут проверяться только новым сертификатом. Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate с параметром -Previous.

```PowerShell
Remove-CsCertificate -Type AudioVideoAuthentication -Previous
```

### <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a--roll-and--effectivedate-parameters"></a>Обновление или обновление сертификата OAuthTokenIssuer с параметрами -Roll и -EffectiveDate

1. Войдите на локальный компьютер в качестве члена группы администраторов.
    
2. Запрос обновления или нового сертификата OAuthTokenIssuer с экспортируемым закрытым ключом для существующего сертификата на переднем сервере.
    
3. Импортировать новый сертификат OAuthTokenIssuer на сервер переднего конца в пуле (если у вас развернут пул). Сертификат OAuthTokenIssuer реплицируется глобально, после чего требуется только его обновление и продление на всех серверах в текущей среде. В качестве примера используется сервер переднего конца.
    
4. Настройте импортируемый сертификат с помощью Set-CsCertificate и используйте параметр -Roll с параметром -EffectiveDate. Дата вступления в силу определяется как время истечения срока действия текущего сертификата (14:00:00 или 2:00:00 дня) за вычетом не менее 24 часов. 
    
    Команда Set-CsCertificate с параметром -Roll и -EffectiveTime:
    
   ```PowerShell
   Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb
          print of new certificate> -Roll -EffectiveDate <date and time for
          certificate to become active> -identity Global 
   ```

Пример команды Set-CsCertificate:
    
  ```PowerShell
  Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2015
          1:00:00 PM" 
  ```

> [!IMPORTANT]
> EffectiveDate должен быть отформатирован в соответствие с регионами и языковыми настройками сервера. В примере используются параметры "Регион английского языка и языка США" 
  
Когда будет достигнуто эффективное время (7/21/2015 1:00:00 утра), все новые маркеры будут выдаваться новым сертификатом. Сначала выполняется проверка маркеров новым сертификатом. Если проверка не пройдена, маркеры проверяются старым сертификатом. Процедура проверки новым сертификатом и возврат к старому продолжается до тех пор, пока не истечет срок действия старого сертификата. По истечении срока действия старого сертификата (7/22/2015 2:00:00 pm) маркеры будут проверяться только новым сертификатом. Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate с параметром -Previous.
```PowerShell
Remove-CsCertificate -Type OAuthTokenIssuer -Previous 
```

## <a name="see-also"></a>Дополнительные материалы

[Управление проверкой подлинности от сервера к серверу (OAuth) и партнерскими приложениями в Skype для бизнеса Server](server-to-server-and-partner-applications.md)

[Set-CsCertificate](/powershell/module/skype/set-cscertificate?view=skype-ps)
  
[Remove-CsCertificate](/powershell/module/skype/remove-cscertificate?view=skype-ps)