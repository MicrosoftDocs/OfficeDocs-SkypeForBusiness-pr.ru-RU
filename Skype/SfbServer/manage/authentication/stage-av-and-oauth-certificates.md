---
title: Этап av и OAuth сертификаты в Skype для бизнеса Server с помощью -Roll в Set-CsCertificate
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
description: Сводка. Этап av и OAuth сертификаты для Skype для бизнеса Server.
ms.openlocfilehash: 87527d4bb51a5c38e0f85f72b299b67f235f2cf8
ms.sourcegitcommit: 01087be29daa3abce7d3b03a55ba5ef8db4ca161
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2021
ms.locfileid: "51119568"
---
# <a name="stage-av-and-oauth-certificates-in-skype-for-business-server-using--roll-in-set-cscertificate"></a><span data-ttu-id="8953c-103">Этап av и OAuth сертификаты в Skype для бизнеса Server с помощью -Roll в Set-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="8953c-103">Stage AV and OAuth certificates in Skype for Business Server using -Roll in Set-CsCertificate</span></span>
 
<span data-ttu-id="8953c-104">**Сводка:** Этап av и OAuth сертификаты для Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="8953c-104">**Summary:** Stage AV and OAuth certificates for Skype for Business Server.</span></span>
  
<span data-ttu-id="8953c-105">Аудио- и видеосвязь является ключевым компонентом Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="8953c-105">Audio/Video (A/V) communications is a key component of Skype for Business Server.</span></span> <span data-ttu-id="8953c-106">Такие функции, как совместное использование приложений и аудио- и видеоконференций, зависят от сертификатов, присвоенных службе A/V Edge, в частности службе проверки подлинности A/V.</span><span class="sxs-lookup"><span data-stu-id="8953c-106">Features such as application sharing and audio and video conferencing rely on the certificates assigned to the A/V Edge service, specifically the A/V Authentication service.</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="8953c-107">Эта новая функция предназначена для работы службы A/V Edge и сертификата OAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="8953c-107">This new feature is designed to work for the A/V Edge service and the OAuthTokenIssuer certificate.</span></span> <span data-ttu-id="8953c-108">Другие типы сертификатов могут быть предусмотрены вместе со службой A/V Edge и типом сертификата OAuth, но не будут пользоваться поведением сосуществования, которое будет иметь сертификат A/V Edge.</span><span class="sxs-lookup"><span data-stu-id="8953c-108">Other certificate types can be provisioned along with the A/V Edge service and OAuth certificate type, but will not benefit from the coexistence behavior that the A/V Edge service certificate will.</span></span>
  
<span data-ttu-id="8953c-109">Команды Skype для управления бизнес-серверами PowerShell, используемые для управления сертификатами Skype для бизнеса Server, относятся к сертификату A/V Edge в качестве типа сертификата AudioVideoAuthentication и сертификату OAuthServer как typeOAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="8953c-109">The Skype for Business Server Management Shell PowerShell cmdlets used to manage Skype for Business Server certificates refers to the A/V Edge service certificate as the AudioVideoAuthentication certificate type and the OAuthServer certificate as typeOAuthTokenIssuer.</span></span> <span data-ttu-id="8953c-110">Для остальной части этой темы и для уникальной идентификации сертификатов они будут ссылаться на тот же тип идентификатора, AudioVideoAuthentication иOAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="8953c-110">For the rest of this topic and to uniquely identify the certificates, they will be referred to by the same identifier type, AudioVideoAuthentication andOAuthTokenIssuer.</span></span>
  
<span data-ttu-id="8953c-111">Служба проверки подлинности аудио- и видеоконференций отвечает за выдачу маркеров, используемых клиентами и другими пользователями аудио- и видеоконференций.</span><span class="sxs-lookup"><span data-stu-id="8953c-111">The A/V Authentication service is responsible for issuing tokens that are used by clients and other A/V consumers.</span></span> <span data-ttu-id="8953c-112">Маркеры создаются на основе атрибутов сертификата, и по истечении срока действия сертификата, происходит разрыв соединения или отображается запрос на повторное подключение с использованием нового маркера, созданного новым сертификатом.</span><span class="sxs-lookup"><span data-stu-id="8953c-112">The tokens are generated from attributes on the certificate, and when the certificate expires, loss of connection and requirement to rejoin with a new token generated by the new certificate will result.</span></span> <span data-ttu-id="8953c-113">Новая функция в Skype для бизнеса Server облегчит эту проблему — возможность инсценировать новый сертификат до истечения срока действия старого и разрешить обоим сертификатам работать в течение определенного периода времени.</span><span class="sxs-lookup"><span data-stu-id="8953c-113">A new feature in Skype for Business Server will alleviate this problem - the ability to stage a new certificate in advance of the old one expiring and allowing both certificates to continue to function for a period of time.</span></span> <span data-ttu-id="8953c-114">Эта функция использует обновленные функции в Set-CsCertificate Skype для управления бизнес-серверами.</span><span class="sxs-lookup"><span data-stu-id="8953c-114">This feature uses updated functionality in the Set-CsCertificate Skype for Business Server Management Shell cmdlet.</span></span> <span data-ttu-id="8953c-115">Новый параметр -Roll с существующим параметром -EffectiveDate разоберет новый сертификат AudioVideoAuthentication в хранилище сертификатов.</span><span class="sxs-lookup"><span data-stu-id="8953c-115">The new parameter -Roll, with the existing parameter -EffectiveDate, will place the new AudioVideoAuthentication certificate in the certificate store.</span></span> <span data-ttu-id="8953c-116">Предыдущий сертификат AudioVideoAuthentication по-прежнему действует для проверки выданных маркеров.</span><span class="sxs-lookup"><span data-stu-id="8953c-116">The older AudioVideoAuthentication certificate will still remain for issued tokens to be validated against.</span></span> <span data-ttu-id="8953c-117">С момента размещения нового сертификата AudioVideoAuthentication возникают следующие наборы событий:</span><span class="sxs-lookup"><span data-stu-id="8953c-117">Beginning with putting the new AudioVideoAuthentication certificate in place, the following series of events will occur:</span></span>
  
> [!TIP]
> <span data-ttu-id="8953c-118">С помощью команды Skype для управления бизнес-серверами для управления сертификатами можно запрашивать отдельные и отдельные сертификаты для каждой цели на edge Server.</span><span class="sxs-lookup"><span data-stu-id="8953c-118">Using the Skype for Business Server Management Shell cmdlets for managing certificates, you can request separate and distinct certificates for each purpose on the Edge Server.</span></span> <span data-ttu-id="8953c-119">Использование мастера по сертификации в мастере развертывания Skype для бизнес-серверов помогает  вам в создании сертификатов, но обычно это тип по умолчанию, который совмессы всех сертификатов, использующихся для Edge Server, на один сертификат.</span><span class="sxs-lookup"><span data-stu-id="8953c-119">Using the Certificate Wizard in the Skype for Business Server Deployment Wizard assists you in creating certificates, but is typically of the **default** type which couples all certificate uses for the Edge Server onto a single certificate.</span></span> <span data-ttu-id="8953c-120">Если планируется применение компонента последовательных сертификатов, рекомендуется отделить сертификат AudioVideoAuthentication от других назначений сертификата.</span><span class="sxs-lookup"><span data-stu-id="8953c-120">The recommended practice if you are going to use the rolling certificate feature is to decouple the AudioVideoAuthentication certificate from the other certificate purposes.</span></span> <span data-ttu-id="8953c-121">Можно предоставить и разместить сертификат типа Default для промежуточного хранения, однако, только часть AudioVideoAuthentication объединенного сертификата сможет максимально эффективно использовать преимущества промежуточного хранения.</span><span class="sxs-lookup"><span data-stu-id="8953c-121">You can provision and stage a certificate of the Default type, but only the AudioVideoAuthentication portion of the combined certificate will benefit from the staging.</span></span> <span data-ttu-id="8953c-122">Для использования нового сертификата, связанного со службой Access Edge, пользователю, который участвует (например, в беседе с мгновенными сообщениями по истечении срока действия сертификата), потребуется выйти и войти в систему.</span><span class="sxs-lookup"><span data-stu-id="8953c-122">A user involved in (for example) an instant messaging conversation when the certificate expires will need to log out and log back in to make use of the new certificate associated with the Access Edge service.</span></span> <span data-ttu-id="8953c-123">Аналогичное поведение будет происходить для пользователя, вовлеченного в веб-конференцию с помощью службы Edge Web Conferencing.</span><span class="sxs-lookup"><span data-stu-id="8953c-123">Similar behavior will occur for a user involved in a Web conference using the Web Conferencing Edge service.</span></span> <span data-ttu-id="8953c-124">Сертификат OAuthTokenIssuer представляет собой отдельный тип, общий доступ к которому предоставляется для всех серверов.</span><span class="sxs-lookup"><span data-stu-id="8953c-124">The OAuthTokenIssuer certificate is a specific type that is shared across all servers.</span></span> <span data-ttu-id="8953c-125">Вы создаете и управляете сертификатом в одном месте, а сертификат хранится в хранилище Central Management для всех остальных серверов.</span><span class="sxs-lookup"><span data-stu-id="8953c-125">You create and manage the certificate in one place and the certificate is stored in the Central Management store for all other servers.</span></span>
  
<span data-ttu-id="8953c-126">Для полного понимания возможностей и условий использования командлета Set-CsCertificate и использования его для промежуточного хранения сертификатов до истечения срока действия текущего сертификата требуются дополнительные данные.</span><span class="sxs-lookup"><span data-stu-id="8953c-126">Additional detail is needed to fully understand your options and requirements when using the Set-CsCertificate cmdlet and using it to stage certificates prior to the current certificate expiring.</span></span> <span data-ttu-id="8953c-127">Параметр -Roll имеет важное значение, но по сути является одной целью.</span><span class="sxs-lookup"><span data-stu-id="8953c-127">The -Roll parameter is important, but essentially single purpose.</span></span> <span data-ttu-id="8953c-128">Если вы определяете его как параметр, вы сообщаете Set-CsCertificate, что вы будете предоставлять сведения о сертификате, который будет затронут, определенный типом (например AudioVideoAuthentication и OAuthTokenIssuer), когда сертификат станет эффективным, определенным по -EffectiveDate.</span><span class="sxs-lookup"><span data-stu-id="8953c-128">If you define it as a parameter, you are telling Set-CsCertificate that you will be providing information about the certificate that will be affected defined by -Type (for example AudioVideoAuthentication and OAuthTokenIssuer), when the certificate will become effective defined by -EffectiveDate.</span></span>
  
 <span data-ttu-id="8953c-129">**-Roll.** Параметр -Roll является обязательным и имеет зависимостей, которые должны быть предоставлены вместе с ним.</span><span class="sxs-lookup"><span data-stu-id="8953c-129">**-Roll**: The -Roll parameter is required and has dependencies that must be supplied along with it.</span></span> <span data-ttu-id="8953c-130">Необходимые параметры, чтобы полностью определить, какие сертификаты будут затронуты и как они будут применяться:</span><span class="sxs-lookup"><span data-stu-id="8953c-130">Required parameters to fully define which certificates will be affected and how they will be applied:</span></span>
  
 <span data-ttu-id="8953c-131">**-EffectiveDate.** Параметр -EffectiveDate определяет, когда новый сертификат станет содействовать текущему сертификату.</span><span class="sxs-lookup"><span data-stu-id="8953c-131">**-EffectiveDate**: The parameter -EffectiveDate defines when the new certificate will become co-active with the current certificate.</span></span> <span data-ttu-id="8953c-132">Срок действия сертификата -EffectiveDate может быть близок к истечении срока действия текущего сертификата или может быть более длительным.</span><span class="sxs-lookup"><span data-stu-id="8953c-132">The -EffectiveDate can be close to the expiry time of the current certificate, or it can be a longer period of time.</span></span> <span data-ttu-id="8953c-133">Рекомендуемый минимум -EffectiveDate для сертификата AudioVideoAuthentication будет 8 часов, что является сроком действия маркера по умолчанию для маркеров службы AV Edge, выдаваемого с помощью сертификата AudioVideoAuthentication.</span><span class="sxs-lookup"><span data-stu-id="8953c-133">A recommended minimum -EffectiveDate for the AudioVideoAuthentication certificate would be 8 hours, which is the default token lifetime for AV Edge service tokens issued using the AudioVideoAuthentication certificate.</span></span>
  
<span data-ttu-id="8953c-p109">При размещении сертификатов OAuthTokenIssuer для промежуточного хранения действуют различные требования в отношении времени упреждения, прежде чем действие сертификата вступит в силу. Минимальное время упреждения для сертификата OAuthTokenIssuer составляет 24 часа до истечения срока действия текущего сертификата. Увеличение времени упреждения для совместной работы применяется в связи с тем, что другие роли сервера, зависимые от сертификата OAuthTokenIssuer (например, Exchange Server), для которых предусматривается более продолжительный срок хранения сертификатов, создают данные проверки подлинности и ключа шифрования.</span><span class="sxs-lookup"><span data-stu-id="8953c-p109">When staging OAuthTokenIssuer certificates, there are different requirements for the lead time before the certificate can become effective. The minimum time that the OAuthTokenIssuer certificate should have for its lead time is 24 hours before the expiration time of the current certificate. The extended lead time for the coexistence is because of other server roles that are dependent on the OAuthTokenIssuer certificate (Exchange Server, for example) which has a longer retention time for certificate created authentication and encryption key materials.</span></span>
  
 <span data-ttu-id="8953c-137">**-Thumbprint.** Отпечатки пальцев — это атрибут сертификата, уникальный для этого сертификата.</span><span class="sxs-lookup"><span data-stu-id="8953c-137">**-Thumbprint**: The thumbprint is an attribute on the certificate that is unique to that certificate.</span></span> <span data-ttu-id="8953c-138">Параметр -Thumbprint используется для определения сертификата, на который влияют действия Set-CsCertificate.</span><span class="sxs-lookup"><span data-stu-id="8953c-138">The -Thumbprint parameter is used to identify the certificate that will be affected by the actions of the Set-CsCertificate cmdlet.</span></span>
  
 <span data-ttu-id="8953c-139">**-Type.** Параметр -Type может принимать один тип использования сертификата или раздельный список типов использования сертификата.</span><span class="sxs-lookup"><span data-stu-id="8953c-139">**-Type**: The -Type parameter can accept a single certificate usage type or a comma separated list of certificate usage types.</span></span> <span data-ttu-id="8953c-140">Типы сертификатов — это те типы, которые определяют для комлета и сервера, какова цель сертификата.</span><span class="sxs-lookup"><span data-stu-id="8953c-140">The certificate types are those that identify to the cmdlet and to the server what the purpose of the certificate is.</span></span> <span data-ttu-id="8953c-141">Например, тип AudioVideoAuthentication используется службой A/V Edge и службой аутентификации AV.</span><span class="sxs-lookup"><span data-stu-id="8953c-141">For example, type AudioVideoAuthentication is for use by the A/V Edge service and the AV Authentication service.</span></span> <span data-ttu-id="8953c-142">Если вы решите одновременно этапировать и раздать сертификаты другого типа, необходимо учитывать самое длительное минимальное время действия сертификатов.</span><span class="sxs-lookup"><span data-stu-id="8953c-142">If you decide to stage and provision certificates of a different type at the same time, you must consider the longest required minimum effective lead time for the certificates.</span></span> <span data-ttu-id="8953c-143">Например, необходимо этапирование сертификатов типа AudioVideoAuthentication и OAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="8953c-143">For example, you need to stage certificates of type AudioVideoAuthentication and OAuthTokenIssuer.</span></span> <span data-ttu-id="8953c-144">Минимальный размер -EffectiveDate должен быть больше двух сертификатов, в данном случае OAuthTokenIssuer, который имеет минимальное время работы в течение 24 часов.</span><span class="sxs-lookup"><span data-stu-id="8953c-144">Your minimum -EffectiveDate must be the greater of the two certificates, in this case the OAuthTokenIssuer, which has a minimum lead time of 24 hours.</span></span> <span data-ttu-id="8953c-145">Если вы не хотите, чтобы сертификат AudioVideoAuthentication находился в течение 24 часов, раздайте его отдельно с помощью EffectiveDate, который больше соответствует вашим требованиям.</span><span class="sxs-lookup"><span data-stu-id="8953c-145">If you do not want to stage the AudioVideoAuthentication certificate with a lead time of 24 hours, stage it separately with an EffectiveDate that is more to your requirements.</span></span>
  
### <a name="to-update-or-renew-an-av-edge-service-certificate-with-a--roll-and--effectivedate-parameters"></a><span data-ttu-id="8953c-146">Обновление или обновление сертификата службы A/V Edge с параметрами -Roll и -EffectiveDate</span><span class="sxs-lookup"><span data-stu-id="8953c-146">To update or renew an A/V Edge service certificate with a -Roll and -EffectiveDate parameters</span></span>

1. <span data-ttu-id="8953c-147">Войдите на локальный компьютер в качестве члена группы администраторов.</span><span class="sxs-lookup"><span data-stu-id="8953c-147">Log on to the local computer as a member of the Administrators group.</span></span>
    
2. <span data-ttu-id="8953c-148">Запрос обновления или нового сертификата AudioVideoAuthentication с экспортируемым закрытым ключом для существующего сертификата в службе A/V Edge.</span><span class="sxs-lookup"><span data-stu-id="8953c-148">Request a renewal or new AudioVideoAuthentication certificate with exportable private key for the existing certificate on the A/V Edge service.</span></span>
    
3. <span data-ttu-id="8953c-149">Импортировать новый сертификат AudioVideoAuthentication на edge Server и все остальные edge Server в пуле (если у вас развернут пул).</span><span class="sxs-lookup"><span data-stu-id="8953c-149">Import the new AudioVideoAuthentication certificate to the Edge Server and all other Edge Server in your pool (if you have a pool deployed).</span></span>
    
4. <span data-ttu-id="8953c-150">Настройте импортируемый сертификат с помощью Set-CsCertificate и используйте параметр -Roll с параметром -EffectiveDate.</span><span class="sxs-lookup"><span data-stu-id="8953c-150">Configure the imported certificate with the Set-CsCertificate cmdlet and use the -Roll parameter with the -EffectiveDate parameter.</span></span> <span data-ttu-id="8953c-151">Дата вступления в силу определяется как время истечения срока действия текущего сертификата (14:00:00 или 14:00:00) за вычетом срока действия маркера (по умолчанию — восемь часов).</span><span class="sxs-lookup"><span data-stu-id="8953c-151">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus token lifetime (by default eight hours).</span></span> <span data-ttu-id="8953c-152">Это дает нам время, когда сертификат должен быть активен, и является -EffectiveDate: \<string\> "7/22/2015 6:00:00 AM".</span><span class="sxs-lookup"><span data-stu-id="8953c-152">This gives us a time that the certificate must be set to active, and is the -EffectiveDate \<string\>: "7/22/2015 6:00:00 AM".</span></span> 
    
    > [!IMPORTANT]
    > <span data-ttu-id="8953c-153">Для пула Edge необходимо иметь все сертификаты AudioVideoAuthentication, развернутые и заданные в зависимости от даты и времени, определенных параметром -EffectiveDate первого развернутого сертификата, чтобы избежать возможного нарушения связи между A/V из-за истечения срока действия более старого сертификата до возобновления всех клиентских и потребительских маркеров с помощью нового сертификата.</span><span class="sxs-lookup"><span data-stu-id="8953c-153">For an Edge pool, you must have all AudioVideoAuthentication certificates deployed and provisioned by the date and time defined by the -EffectiveDate parameter of the first certificate deployed to avoid possible A/V communications disruption due to the older certificate expiring before all client and consumer tokens have been renewed using the new certificate.</span></span> 
  
    <span data-ttu-id="8953c-154">Команда Set-CsCertificate с параметром -Roll и -EffectiveTime:</span><span class="sxs-lookup"><span data-stu-id="8953c-154">The Set-CsCertificate command with the -Roll and -EffectiveTime parameter:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          <thumb print of new certificate> -Roll -EffectiveDate <date and time
          for certificate to become active>
   ```

    <span data-ttu-id="8953c-155">Пример команды Set-CsCertificate:</span><span class="sxs-lookup"><span data-stu-id="8953c-155">An example Set-CsCertificate command:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2015
          6:00:00 AM"
   ```

    > [!IMPORTANT]
    > <span data-ttu-id="8953c-156">EffectiveDate должен быть отформатирован в соответствие с регионами и языковыми настройками сервера.</span><span class="sxs-lookup"><span data-stu-id="8953c-156">The EffectiveDate must be formatted to match your server's region and language settings.</span></span> <span data-ttu-id="8953c-157">В примере используются параметры "Регион английского языка и языка США"</span><span class="sxs-lookup"><span data-stu-id="8953c-157">The example uses the US English Region and Language settings</span></span> 
  
<span data-ttu-id="8953c-158">Чтобы далее понять процесс, который Set-CsCertificate, -Roll и -EffectiveDate используют для инсцениции нового сертификата для выпуска новых маркеров AudioVideoAuthentication при использовании существующего сертификата для проверки audioVideoAuthentication, которые используются потребителями, визуальная временная шкала является эффективным средством понимания процесса.</span><span class="sxs-lookup"><span data-stu-id="8953c-158">To further understand the process that Set-CsCertificate, -Roll, and -EffectiveDate use to stage a new certificate for issuing new AudioVideoAuthentication tokens while still using an existing certificate to validate AudioVideoAuthentication that are in use by consumers, a visual timeline is an effective means of understanding the process.</span></span> <span data-ttu-id="8953c-159">В следующем примере администратор определяет, что срок действия сертификата службы A/V Edge истекает в 14:00 07.22.2015.</span><span class="sxs-lookup"><span data-stu-id="8953c-159">In the following example, the administrator determines that the A/V Edge service certificate is due to expire at 2:00:00 PM on 07/22/2015.</span></span> <span data-ttu-id="8953c-160">Он запрашивает и получает новый сертификат и импортирует его на каждый edge Server в своем пуле.</span><span class="sxs-lookup"><span data-stu-id="8953c-160">He requests and receives a new certificate and imports it to each Edge Server in his pool.</span></span> <span data-ttu-id="8953c-161">В 02:00 07.22.2015 он начинает работать Get-CsCertificate с помощью -Roll, -Thumbprint, равного строке отпечатка пальца нового сертификата, и в наборе -EffectiveTime от 07.22.2015 06.00:00.</span><span class="sxs-lookup"><span data-stu-id="8953c-161">At 2 AM on 07/22/2015, he begins running Get-CsCertificate with -Roll, -Thumbprint equal to the thumbprint string of the new certificate, and -EffectiveTime set to 07/22/2015 6:00:00 AM.</span></span> <span data-ttu-id="8953c-162">Он выполняет эту команду на каждом краевом сервере.</span><span class="sxs-lookup"><span data-stu-id="8953c-162">He runs this command on each Edge Server.</span></span>
  
![Использование параметров Roll и EffectiveDate.](../../media/Ops_Certificate_Set_Roll_EffectiveTime_Timeline.jpg)
  
|<span data-ttu-id="8953c-164">**Callout**</span><span class="sxs-lookup"><span data-stu-id="8953c-164">**Callout**</span></span>|<span data-ttu-id="8953c-165">**Этап**</span><span class="sxs-lookup"><span data-stu-id="8953c-165">**Stage**</span></span>|
|:-----|:-----|
|<span data-ttu-id="8953c-166">1</span><span class="sxs-lookup"><span data-stu-id="8953c-166">1</span></span>  <br/> |<span data-ttu-id="8953c-167">Начало: 7/22/2015 12:00:00</span><span class="sxs-lookup"><span data-stu-id="8953c-167">Start: 7/22/2015 12:00:00 AM</span></span>  <br/> <span data-ttu-id="8953c-168">Срок действия текущего сертификата AudioVideoAuthentication истекает в 14:00 7.22.2015.</span><span class="sxs-lookup"><span data-stu-id="8953c-168">The current AudioVideoAuthentication certificate is due to expire at 2:00:00 PM on 7/22/2015.</span></span> <span data-ttu-id="8953c-169">Это определяется штампом времени истечения срока действия сертификата.</span><span class="sxs-lookup"><span data-stu-id="8953c-169">This is determined by the expires time stamp on the certificate.</span></span> <span data-ttu-id="8953c-170">Планирование замены и опрокидывания сертификата с учетом 8-часового перекрытия (срок службы маркера по умолчанию) до истечения срока действия существующего сертификата.</span><span class="sxs-lookup"><span data-stu-id="8953c-170">Plan your certificate replacement and rollover to account for an 8 hour overlap (default token lifetime) before the existing certificate reaches the expire time.</span></span> <span data-ttu-id="8953c-171">В этом примере используется время работы в 2:00:00, чтобы администратору было достаточно времени для того, чтобы разместить и обеспечить новые сертификаты до 6:00:00.</span><span class="sxs-lookup"><span data-stu-id="8953c-171">The 2:00:00 AM lead time is used in this example to allow the administrator adequate time to place and provision the new certificates in advance of the 6:00:00 AM effective time.</span></span>  <br/> |
|<span data-ttu-id="8953c-172">2</span><span class="sxs-lookup"><span data-stu-id="8953c-172">2</span></span>  <br/> |<span data-ttu-id="8953c-173">07.22.2015 14.00 - 07.22.2015 5:59:59</span><span class="sxs-lookup"><span data-stu-id="8953c-173">7/22/2015 2:00:00 AM - 7/22/2015 5:59:59 AM</span></span>  <br/> <span data-ttu-id="8953c-174">Установите сертификаты на edge Servers с эффективным временем 6:00:00 (для этого примера используется 4 часа, но может быть больше) с помощью Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll-EffectiveDate \<datetime string of the effective time for new certificate\></span><span class="sxs-lookup"><span data-stu-id="8953c-174">Set Certificates on Edge Servers with effective time of 6:00:00 AM (4 hour lead time is for this example, but can be longer) using Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll -EffectiveDate \<datetime string of the effective time for new certificate\></span></span>  <br/> |
|<span data-ttu-id="8953c-175">3</span><span class="sxs-lookup"><span data-stu-id="8953c-175">3</span></span>  <br/> |<span data-ttu-id="8953c-176">07.22.2015 18.00 - 07.22.2015 14.00</span><span class="sxs-lookup"><span data-stu-id="8953c-176">7/22/2015 6:00 AM - 7/22/2015 2:00 PM</span></span>  <br/> <span data-ttu-id="8953c-177">Чтобы проверить маркеры, сначала проверяется новый сертификат, и если новый сертификат не может проверить маркер, старый сертификат будет опробовано.</span><span class="sxs-lookup"><span data-stu-id="8953c-177">To validate tokens, the new certificate is tried first, and if the new certificate fails to validate the token, the old certificate is tried.</span></span> <span data-ttu-id="8953c-178">Этот процесс используется для всех маркеров в течение 8-часового периода перекрытия маркера по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="8953c-178">This process is used for all tokens during the 8 hour (default token lifetime) overlap period.</span></span>  <br/> |
|<span data-ttu-id="8953c-179">4 </span><span class="sxs-lookup"><span data-stu-id="8953c-179">4</span></span>  <br/> |<span data-ttu-id="8953c-180">Конец: 7/22/2015 14:00:01</span><span class="sxs-lookup"><span data-stu-id="8953c-180">End: 7/22/2015 2:00:01 PM</span></span>  <br/> <span data-ttu-id="8953c-181">Срок действия старого сертификата истек, и новый сертификат был переохачен.</span><span class="sxs-lookup"><span data-stu-id="8953c-181">Old certificate has expired and the new certificate has taken over.</span></span> <span data-ttu-id="8953c-182">Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate \<certificate usage type\> -Type-Previous</span><span class="sxs-lookup"><span data-stu-id="8953c-182">Old certificate can be safely removed with Remove-CsCertificate -Type \<certificate usage type\> -Previous</span></span>  <br/> |
   
<span data-ttu-id="8953c-183">Когда будет достигнуто эффективное время (7/22/2015 6:00:00 утра), все новые маркеры будут выданы новым сертификатом.</span><span class="sxs-lookup"><span data-stu-id="8953c-183">When the effective time is reached (7/22/2015 6:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="8953c-184">Сначала выполняется проверка маркеров новым сертификатом.</span><span class="sxs-lookup"><span data-stu-id="8953c-184">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="8953c-185">Если проверка не пройдена, маркеры проверяются старым сертификатом.</span><span class="sxs-lookup"><span data-stu-id="8953c-185">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="8953c-186">Процедура проверки новым сертификатом и возврат к старому продолжается до тех пор, пока не истечет срок действия старого сертификата.</span><span class="sxs-lookup"><span data-stu-id="8953c-186">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="8953c-187">По истечении срока действия старого сертификата (7/22/2015 2:00:00 pm) маркеры будут проверяться только новым сертификатом.</span><span class="sxs-lookup"><span data-stu-id="8953c-187">Once the old certificate has expired (7/22/2015 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="8953c-188">Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate с параметром -Previous.</span><span class="sxs-lookup"><span data-stu-id="8953c-188">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the -Previous parameter.</span></span>

```PowerShell
Remove-CsCertificate -Type AudioVideoAuthentication -Previous
```

### <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a--roll-and--effectivedate-parameters"></a><span data-ttu-id="8953c-189">Обновление или обновление сертификата OAuthTokenIssuer с параметрами -Roll и -EffectiveDate</span><span class="sxs-lookup"><span data-stu-id="8953c-189">To update or renew an OAuthTokenIssuer certificate with a -Roll and -EffectiveDate parameters</span></span>

1. <span data-ttu-id="8953c-190">Войдите на локальный компьютер в качестве члена группы администраторов.</span><span class="sxs-lookup"><span data-stu-id="8953c-190">Log on to the local computer as a member of the Administrators group.</span></span>
    
2. <span data-ttu-id="8953c-191">Запрос обновления или нового сертификата OAuthTokenIssuer с экспортируемым закрытым ключом для существующего сертификата на переднем сервере.</span><span class="sxs-lookup"><span data-stu-id="8953c-191">Request a renewal or new OAuthTokenIssuer certificate with exportable private key for the existing certificate on the Front End Server.</span></span>
    
3. <span data-ttu-id="8953c-192">Импортировать новый сертификат OAuthTokenIssuer на сервер переднего конца в пуле (если у вас развернут пул).</span><span class="sxs-lookup"><span data-stu-id="8953c-192">Import the new OAuthTokenIssuer certificate to a Front End Server in your pool (if you have a pool deployed).</span></span> <span data-ttu-id="8953c-193">Сертификат OAuthTokenIssuer реплицируется глобально, после чего требуется только его обновление и продление на всех серверах в текущей среде.</span><span class="sxs-lookup"><span data-stu-id="8953c-193">The OAuthTokenIssuer certificate is replicated globally and only needs to be updated and renewed at any server in your deployment.</span></span> <span data-ttu-id="8953c-194">В качестве примера используется сервер переднего конца.</span><span class="sxs-lookup"><span data-stu-id="8953c-194">The Front End Server is used as an example.</span></span>
    
4. <span data-ttu-id="8953c-195">Настройте импортируемый сертификат с помощью Set-CsCertificate и используйте параметр -Roll с параметром -EffectiveDate.</span><span class="sxs-lookup"><span data-stu-id="8953c-195">Configure the imported certificate with the Set-CsCertificate cmdlet and use the -Roll parameter with the -EffectiveDate parameter.</span></span> <span data-ttu-id="8953c-196">Дата вступления в силу определяется как время истечения срока действия текущего сертификата (14:00:00 или 2:00:00 дня) за вычетом не менее 24 часов.</span><span class="sxs-lookup"><span data-stu-id="8953c-196">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus a minimum of 24 hours.</span></span> 
    
    <span data-ttu-id="8953c-197">Команда Set-CsCertificate с параметром -Roll и -EffectiveTime:</span><span class="sxs-lookup"><span data-stu-id="8953c-197">The Set-CsCertificate command with the -Roll and -EffectiveTime parameter:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb
          print of new certificate> -Roll -EffectiveDate <date and time for
          certificate to become active> -identity Global 
   ```

<span data-ttu-id="8953c-198">Пример команды Set-CsCertificate:</span><span class="sxs-lookup"><span data-stu-id="8953c-198">An example Set-CsCertificate command:</span></span>
    
  ```PowerShell
  Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2015
          1:00:00 PM" 
  ```

> [!IMPORTANT]
> <span data-ttu-id="8953c-199">EffectiveDate должен быть отформатирован в соответствие с регионами и языковыми настройками сервера.</span><span class="sxs-lookup"><span data-stu-id="8953c-199">The EffectiveDate must be formatted to match your server's region and language settings.</span></span> <span data-ttu-id="8953c-200">В примере используются параметры "Регион английского языка и языка США"</span><span class="sxs-lookup"><span data-stu-id="8953c-200">The example uses the US English Region and Language settings</span></span> 
  
<span data-ttu-id="8953c-201">Когда будет достигнуто эффективное время (7/21/2015 1:00:00 утра), все новые маркеры будут выдаваться новым сертификатом.</span><span class="sxs-lookup"><span data-stu-id="8953c-201">When the effective time is reached (7/21/2015 1:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="8953c-202">Сначала выполняется проверка маркеров новым сертификатом.</span><span class="sxs-lookup"><span data-stu-id="8953c-202">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="8953c-203">Если проверка не пройдена, маркеры проверяются старым сертификатом.</span><span class="sxs-lookup"><span data-stu-id="8953c-203">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="8953c-204">Процедура проверки новым сертификатом и возврат к старому продолжается до тех пор, пока не истечет срок действия старого сертификата.</span><span class="sxs-lookup"><span data-stu-id="8953c-204">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="8953c-205">По истечении срока действия старого сертификата (7/22/2015 2:00:00 pm) маркеры будут проверяться только новым сертификатом.</span><span class="sxs-lookup"><span data-stu-id="8953c-205">Once the old certificate has expired (7/22/2015 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="8953c-206">Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate с параметром -Previous.</span><span class="sxs-lookup"><span data-stu-id="8953c-206">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the -Previous parameter.</span></span>
```PowerShell
Remove-CsCertificate -Type OAuthTokenIssuer -Previous 
```

## <a name="see-also"></a><span data-ttu-id="8953c-207">См. также</span><span class="sxs-lookup"><span data-stu-id="8953c-207">See also</span></span>

[<span data-ttu-id="8953c-208">Управление проверкой подлинности от сервера к серверу (OAuth) и партнерскими приложениями в Skype для бизнеса Server</span><span class="sxs-lookup"><span data-stu-id="8953c-208">Manage server-to-server authentication (OAuth) and partner applications in Skype for Business Server</span></span>](server-to-server-and-partner-applications.md)

[<span data-ttu-id="8953c-209">Set-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="8953c-209">Set-CsCertificate</span></span>](/powershell/module/skype/set-cscertificate?view=skype-ps)
  
[<span data-ttu-id="8953c-210">Remove-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="8953c-210">Remove-CsCertificate</span></span>](/powershell/module/skype/remove-cscertificate?view=skype-ps)