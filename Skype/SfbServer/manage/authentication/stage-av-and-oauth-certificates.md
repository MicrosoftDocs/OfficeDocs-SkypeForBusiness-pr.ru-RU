---
title: Stage AV and OAuth certificates in Skype for Business Server using -Roll in Set-CsCertificate
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
description: Сводка. Этапы сертификатов AV и OAuth для Skype для бизнеса Server.
ms.openlocfilehash: a2586e9ebda1bae1605fd6033681b469e6731b8c
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49806559"
---
# <a name="stage-av-and-oauth-certificates-in-skype-for-business-server-using--roll-in-set-cscertificate"></a>Stage AV and OAuth certificates in Skype for Business Server using -Roll in Set-CsCertificate
 
**Сводка:** Stage AV and OAuth certificates for Skype for Business Server.
  
Аудио- и видеосвязь является ключевым компонентом Skype для бизнеса Server. Такие функции, как общий доступ к приложениям и аудио- и видеоконференциям, зависят от сертификатов, присвоенных службе аудио- и видеоконференций, в частности службе проверки подлинности аудио- и видеоконференций.
  
> [!IMPORTANT]
> Эта новая функция предназначена для работы службы A/V Edge и сертификата OAuthTokenIssuer. Другие типы сертификатов могут быть предусмотрены вместе со службой A/V Edge и типом сертификата OAuth, но не будут пользоваться поведением сосуществования, которое будет использовать сертификат службы A/V Edge.
  
The Skype for Business Server Management Shell PowerShell cmdlets used to manage Skype for Business Server certificates refers to the A/V Edge service certificate as the AudioVideoAuthentication certificate type and the OAuthServer certificate as typeOAuthTokenIssuer. В остальной части этого раздела и для уникальной идентификации сертификатов на них будет ссылается тот же тип идентификатора, AudioVideoAuthentication иOAuthTokenIssuer.
  
Служба проверки подлинности аудио- и видеоконференций отвечает за выдачу маркеров, используемых клиентами и другими пользователями аудио- и видеоконференций. Маркеры создаются на основе атрибутов сертификата, и по истечении срока действия сертификата, происходит разрыв соединения или отображается запрос на повторное подключение с использованием нового маркера, созданного новым сертификатом. Новая функция в Skype для бизнеса Server облегчит эту проблему — возможность поэтапного истечение срока действия старого сертификата и разрешение обоим сертификатам работать в течение некоторого времени. Эта функция использует обновленные функции в Set-CsCertificate Skype для бизнеса Server Management Shell. Новый параметр -Roll с существующим параметром -EffectiveDate поместите новый сертификат AudioVideoAuthentication в хранилище сертификатов. Предыдущий сертификат AudioVideoAuthentication по-прежнему действует для проверки выданных маркеров. С момента размещения нового сертификата AudioVideoAuthentication возникают следующие наборы событий:
  
> [!TIP]
> С помощью cmdlets skype for Business Server Management Shell для управления сертификатами можно запросить отдельные и отдельные сертификаты для каждой цели на edge Server. С помощью мастера сертификатов в мастере развертывания Skype для бизнеса Server можно  создавать сертификаты, но обычно это тип по умолчанию, в котором все сертификаты, использующиеся для сервера, будут сданы в один сертификат. Если планируется применение компонента последовательных сертификатов, рекомендуется отделить сертификат AudioVideoAuthentication от других назначений сертификата. Можно предоставить и разместить сертификат типа Default для промежуточного хранения, однако, только часть AudioVideoAuthentication объединенного сертификата сможет максимально эффективно использовать преимущества промежуточного хранения. Пользователь, участвующий (например, в сеансе обмена мгновенными сообщениями по истечении срока действия сертификата), должен выйти из системы и войти в систему, чтобы использовать новый сертификат, связанный со службой доступа. Аналогичное поведение будет происходить для пользователя, который участвует в веб-конференции с помощью службы по краям веб-конференций. Сертификат OAuthTokenIssuer представляет собой отдельный тип, общий доступ к которому предоставляется для всех серверов. Сертификат создается и управляется в одном месте, а сертификат хранится в центральном хранилище управления для всех остальных серверов.
  
Для полного понимания возможностей и условий использования командлета Set-CsCertificate и использования его для промежуточного хранения сертификатов до истечения срока действия текущего сертификата требуются дополнительные данные. Параметр -Roll имеет важное значение, но, по сути, одно назначение. Если вы определяете его как параметр, вы сообщаете Set-CsCertificate, что вы будете предоставлять сведения о сертификате, который будет затронут, определенный с помощью -Type (например, AudioVideoAuthentication и OAuthTokenIssuer), когда сертификат станет эффективным, определенным с помощью -EffectiveDate.
  
 **-Roll**: параметр -Roll является обязательным и имеет зависимости, которые должны быть предоставлены вместе с ним. Необходимые параметры, чтобы полностью определить, какие сертификаты будут затронуты и как они будут применяться:
  
 **-EffectiveDate**: параметр -EffectiveDate определяет, когда новый сертификат станет совместно активным с текущим сертификатом. The -EffectiveDate can be close to the expiry time of the current certificate, or it can be a longer period of time. Рекомендуемое минимальное значение -EffectiveDate для сертификата AudioVideoAuthentication составляет 8 часов, что является сроком действия маркера по умолчанию для маркеров службы по краям av, выдаваемого с помощью сертификата AudioVideoAuthentication.
  
При размещении сертификатов OAuthTokenIssuer для промежуточного хранения действуют различные требования в отношении времени упреждения, прежде чем действие сертификата вступит в силу. Минимальное время упреждения для сертификата OAuthTokenIssuer составляет 24 часа до истечения срока действия текущего сертификата. Увеличение времени упреждения для совместной работы применяется в связи с тем, что другие роли сервера, зависимые от сертификата OAuthTokenIssuer (например, Exchange Server), для которых предусматривается более продолжительный срок хранения сертификатов, создают данные проверки подлинности и ключа шифрования.
  
 **-Thumbprint**: отпечаток является атрибутом сертификата, уникальным для этого сертификата. Параметр -Thumbprint используется для идентификации сертификата, на который влияют действия Set-CsCertificate-
  
 **-Type**: параметр -Type может принимать один тип использования сертификата или разделенный запятой список типов использования сертификатов. Типы сертификатов — это те, которые определяют для этого и сервера назначение сертификата. Например, тип AudioVideoAuthentication используется службой аудио- и видеоконференций и службой проверки подлинности av. Если вы решите одновременно разустановить и подавить сертификаты другого типа, необходимо учесть самый длительный минимальный срок действия сертификатов. Например, необходимо разустановить сертификаты типа AudioVideoAuthentication и OAuthTokenIssuer. Минимальное количество сертификатов -EffectiveDate должно быть больше двух сертификатов, в данном случае — OAuthTokenIssuer с минимальным временем действия в 24 часа. Если вы не хотите, чтобы сертификат AudioVideoAuthentication находился в течение 24 часов, разберите его отдельно с effectiveDate, что больше соответствует вашим требованиям.
  
### <a name="to-update-or-renew-an-av-edge-service-certificate-with-a--roll-and--effectivedate-parameters"></a>Обновление или продление сертификата службы A/V Edge с помощью параметров -Roll и -EffectiveDate

1. Войдите на локальный компьютер в качестве члена группы администраторов.
    
2. Запрос продления или нового сертификата AudioVideoAuthentication с экспортируемым закрытым ключом для существующего сертификата в службе аудио- и видеоконференций.
    
3. Импортировать новый сертификат AudioVideoAuthentication на edge server и все остальные серверы в пуле (если у вас развернут пул).
    
4. Настройте импортируемый сертификат с помощью Set-CsCertificate и используйте параметр -Roll с параметром -EffectiveDate. Дата вступления в силу определяется как время истечения срока действия текущего сертификата (14:00:00 или 14:00:00) за вычетом срока действия маркера (по умолчанию — восемь часов). Это дает нам время, когда сертификат должен быть активен, и является -EffectiveDate \<string\> : "7/22/2015 6:00:00 AM". 
    
    > [!IMPORTANT]
    > Для пула edge необходимо развернуть и подготовка всех сертификатов AudioVideoAuthentication к дате и времени, определенным параметром -EffectiveDate первого развернутого сертификата, чтобы избежать возможного нарушения аудио- и видеосвязи из-за истечения срока действия старого сертификата до того, как все клиентские и потребительские маркеры будут обновлены с помощью нового сертификата. 
  
    Команда Set-CsCertificate с параметрами -Roll и -EffectiveTime:
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          <thumb print of new certificate> -Roll -EffectiveDate <date and time
          for certificate to become active>
   ```

    Пример команды Set-CsCertificate:
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2015
          6:00:00 AM"
   ```

    > [!IMPORTANT]
    > Параметр EffectiveDate должен быть отформатирован в соответствие с регионом и языковыми настройками сервера. В примере используются параметры региона и языка для английского языка (США) 
  
Чтобы лучше понять процесс, который set-CsCertificate, -Roll и -EffectiveDate используют для поэтапного создания нового сертификата для выдачи новых маркеров AudioVideoAuthentication, при этом используя существующий сертификат для проверки AudioVideoAuthentication, которые используются потребителями, визуальная временная шкала является эффективным средством понимания процесса. В следующем примере администратор определяет, что срок действия сертификата службы A/V Edge истекает в 14:00 22.07.2015. Он запрашивает и получает новый сертификат и импортирует его на каждый сервер в своем пуле. В 2 am on 07/22/2015, he begins running Get-CsCertificate with -Roll, -Thumbprint equal to the thumbprint string of the new certificate, and -EffectiveTime set to 07/22/2015 6:00:00 AM. Он выполняет эту команду на каждом сервере.
  
![Использование параметров Roll и EffectiveDate.](../../media/Ops_Certificate_Set_Roll_EffectiveTime_Timeline.jpg)
  
|**Callout**|**Этап**|
|:-----|:-----|
|1   <br/> |Начало: 22.07.2015 12:00:00  <br/> Срок действия текущего сертификата AudioVideoAuthentication истекает в 14:00 22.07.2015. Это определяется отметкой времени истечения срока действия сертификата. Запланируйте замену и откат сертификата, чтобы учесть 8-часовой период перекрытия (срок действия маркера по умолчанию) до истечения срока действия существующего сертификата. В этом примере используется время подготовки к 2:00:00, чтобы администратору было достаточно времени на место и подготовку новых сертификатов до 6:00:00.  <br/> |
|2   <br/> |22.07.2015 14:00–22.07.2015 5:59:59  <br/> Настройка сертификатов на серверах с фактическим временем 6:00:00 (для этого примера используется 4-часовой срок, но может быть больше) с помощью Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll -EffectiveDate \<datetime string of the effective time for new certificate\>  <br/> |
|3   <br/> |22.07.2015 6:00 –07.22.2015 14:00  <br/> Для проверки маркеров сначала проверяется новый сертификат, и если новый сертификат не может проверить маркер, проверяется старый сертификат. Этот процесс используется для всех маркеров в течение 8-часового (по умолчанию) периода перекрытия.  <br/> |
|4   <br/> |Окончание: 22.07.2015 14:00:01  <br/> Срок действия старого сертификата истек, и новый сертификат перео собственности. Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate -Type \<certificate usage type\> -Previous  <br/> |
   
По окончании действия (07.22.2015 6:00:00) новый сертификат выдает все новые маркеры. Сначала выполняется проверка маркеров новым сертификатом. Если проверка не пройдена, маркеры проверяются старым сертификатом. Процедура проверки новым сертификатом и возврат к старому продолжается до тех пор, пока не истечет срок действия старого сертификата. По истечении срока действия старого сертификата (22.07.2015 14:00) маркеры будут проверяться только новым сертификатом. Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate с параметром -Previous.

```PowerShell
Remove-CsCertificate -Type AudioVideoAuthentication -Previous
```

### <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a--roll-and--effectivedate-parameters"></a>Обновление или продление сертификата OAuthTokenIssuer с помощью параметров -Roll и -EffectiveDate

1. Войдите на локальный компьютер в качестве члена группы администраторов.
    
2. Запрос продления или нового сертификата OAuthTokenIssuer с экспортируемым закрытым ключом для существующего сертификата на сервере переднего сервера.
    
3. Импортировать новый сертификат OAuthTokenIssuer на сервер переднего сервера в пуле (если у вас развернут пул). Сертификат OAuthTokenIssuer реплицируется глобально, после чего требуется только его обновление и продление на всех серверах в текущей среде. В качестве примера используется сервер переднего сервера.
    
4. Настройте импортируемый сертификат с помощью Set-CsCertificate и используйте параметр -Roll с параметром -EffectiveDate. Дата вступления в силу определяется как время истечения срока действия текущего сертификата (14:00:00 или 2:00:00 дня) за вычетом не менее 24 часов. 
    
    Команда Set-CsCertificate с параметрами -Roll и -EffectiveTime:
    
   ```PowerShell
   Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb
          print of new certificate> -Roll -EffectiveDate <date and time for
          certificate to become active> -identity Global 
   ```

Пример команды Set-CsCertificate:
    
  ```PowerShell
  Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2015
          1:00:00 PM" 
  ```

> [!IMPORTANT]
> Параметр EffectiveDate должен быть отформатирован в соответствие с регионом и языковыми настройками сервера. В примере используются параметры региона и языка для английского языка (США) 
  
По окончании действия (07.21.2015 1:00:00) новый сертификат выдает все новые маркеры. Сначала выполняется проверка маркеров новым сертификатом. Если проверка не пройдена, маркеры проверяются старым сертификатом. Процедура проверки новым сертификатом и возврат к старому продолжается до тех пор, пока не истечет срок действия старого сертификата. По истечении срока действия старого сертификата (22.07.2015 14:00) маркеры будут проверяться только новым сертификатом. Старый сертификат можно безопасно удалить с помощью Remove-CsCertificate с параметром -Previous.
```PowerShell
Remove-CsCertificate -Type OAuthTokenIssuer -Previous 
```

## <a name="see-also"></a>См. также

[Управление проверкой подлинности между серверами (OAuth) и партнерскими приложениями в Skype для бизнеса Server](server-to-server-and-partner-applications.md)

[Set-CsCertificate](https://docs.microsoft.com/powershell/module/skype/set-cscertificate?view=skype-ps)
  
[Remove-CsCertificate](https://docs.microsoft.com/powershell/module/skype/remove-cscertificate?view=skype-ps)
