---
title: Stage и сертификаты OAuth в Skype для бизнеса Server с помощью Set-Ксцертификате
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
description: 'Сводка: стадия действия (AV) и сертификаты OAuth для сервера Skype для бизнеса Server.'
ms.openlocfilehash: 530e8f603d2c5be368df37354c3974e2b5abeb5a
ms.sourcegitcommit: e64c50818cac37f3d6f0f96d0d4ff0f4bba24aef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2020
ms.locfileid: "41818731"
---
# <a name="stage-av-and-oauth-certificates-in-skype-for-business-server-using--roll-in-set-cscertificate"></a>Stage и сертификаты OAuth в Skype для бизнеса Server с помощью Set-Ксцертификате
 
**Сводка:** Stage (AV) и сертификаты OAuth для сервера Skype для бизнеса Server.
  
Голосовая связь/видеосвязь (A/V) — это ключевой компонент Skype для бизнеса Server. Такие функции, как общий доступ к приложениям, а также аудио-и видеоконференции, основываются на сертификатах, назначенных службе EDGE (a/V), а именно службе проверки подлинности.
  
> [!IMPORTANT]
> Эта новая функция разработана для работы со службой EDGE (A/V) и сертификатом Оаустокениссуер. Другие типы сертификатов могут быть предоставлены вместе со службой EDGE (A/V) и типом сертификата OAuth, но это не выгодно из-за сосуществования сертификата службы Edge.
  
Командлеты PowerShell для Windows для бизнеса Server Management Shell, используемые для управления сертификатами Skype для бизнеса Server, относятся к сертификату службы EDGE в качестве типа сертификата Аудиовидеоаусентикатион и сертификата Оауссервер в качестве Типеоаустокениссуер. Для оставшейся части этого раздела и уникальной идентификации сертификатов они будут обращаться к одному и тому же типу идентификатора Аудиовидеоаусентикатион Андоаустокениссуер.
  
Служба проверки подлинности A/V отвечает за выдачу маркеров, используемых клиентами и другими пользователями/V. Маркеры генерируются из атрибутов сертификата, и при истечении срока действия сертификата теряется соединение и требование для повторного присоединения с новым маркером, созданным новым сертификатом. Новая функция в Skype для бизнеса Server поможет решить эту проблему — возможность размещения нового сертификата в начале срока действия старого и предоставление обоих сертификатов для продолжения работы в течение определенного периода времени. Эта функция использует обновленные функции командлета Set-Ксцертификате Skype для Business Server Shell. Новая параметр-рулон с существующим параметром-Еффективедате будет размещать новый сертификат Аудиовидеоаусентикатион в хранилище сертификатов. Старый сертификат Аудиовидеоаусентикатион останется для проверки выпущенных маркеров. Начиная с размещения нового сертификата Аудиовидеоаусентикатион, произойдет следующая серия событий:
  
> [!TIP]
> С помощью командлетов командной консоли Skype для бизнеса Server для управления сертификатами вы можете запросить отдельные и разные сертификаты для каждой цели на пограничном сервере. Использование мастера сертификатов в мастере развертывания Skype для бизнеса Server помогает создавать сертификаты, но обычно используется тип **по умолчанию** , который прикрепляет все сертификаты для пограничного сервера к одному сертификату. Если вы собираетесь использовать функцию межсертификатного сертификата, рекомендуется отключать сертификат Аудиовидеоаусентикатион из других целей сертификата. Вы можете подготавливать сертификат по умолчанию и пополнить его, но только часть Аудиовидеоаусентикатион комбинированного сертификата будет полезна при выуровне. Если при истечении срока действия сертификата пользователь приходил к разговору (например), вам потребуется выйти из системы и снова войти в систему, чтобы использовать новый сертификат, связанный с службой Edge Access. Аналогичное поведение может возникнуть для пользователя, участвующего в веб-конференции с помощью службы Edge для веб-конференций. Сертификат Оаустокениссуер — это конкретный тип, который является общим для всех серверов. Вы создаете сертификат и управляете им в одном расположении, и сертификат хранится в хранилище Центрального управления для всех остальных серверов.
  
Дополнительные сведения необходимы для полного понимания параметров и требований при использовании командлета Set-Ксцертификате и его использования для размещения сертификатов до истечения срока действия текущего сертификата. Параметр-рулон важен, но, по сути, единая цель. Если вы определите его как параметр, вы указываете Set-Ксцертификате, что вы будете предоставлять сведения о сертификате, который будет зависеть от типа (например, Аудиовидеоаусентикатион и Оаустокениссуер), когда сертификат станет эффективная работа, определенная функцией-Еффективедате.
  
 **-Рулон**: параметр-рулон является обязательным и имеет зависимости, которые должны быть предоставлены вместе с ним. Обязательные параметры, позволяющие полностью определить, какие сертификаты будут затронуты и как они будут применены.
  
 **-Еффективедате**: параметр-еффективедате определяет, когда новый сертификат будет работать совместно с текущим сертификатом. Еффективедате может быть близким к сроку действия текущего сертификата или может быть более длительного периода времени. Рекомендуемый минимум для Еффективедате сертификата Аудиовидеоаусентикатион — это 8 часов, который является временем жизни токенов для маркеров обслуживания, выпущенных с использованием сертификата Аудиовидеоаусентикатион по умолчанию.
  
При использовании промежуточных сертификатов Оаустокениссуер для времени опережения могут быть разные требования, прежде чем сертификат станет эффективнее. Минимальное время, в течение которого должен быть сертификат Оаустокениссуер для своего периода ожидания, составляет 24 часа до окончания срока действия текущего сертификата. Расширенное время упреждения для сосуществования связано с тем, что другие роли сервера, зависящие от сертификата Оаустокениссуер (например, Exchange Server), которые имеют более длительное время хранения для проверки подлинности сертификата и ключа шифрования. занимал.
  
 **-Отпечаток**: отпечаток — это атрибут сертификата, уникальный для этого сертификата. Параметр-Thumbprint используется для идентификации сертификата, на который будут повлиять действия командлета Set-Ксцертификате.
  
 **-Type**: параметр-Type может иметь один тип использования сертификата или список типов использования сертификатов с разделителями-запятыми. Типы сертификатов — это те, которые определяют для командлета и сервера назначение сертификата. Например, введите Аудиовидеоаусентикатион для использования службой Edge/V и службой проверки подлинности AV. Если вы решите поэтапное резервное рабочее время и выложить сертификаты другого типа, вы должны оценить максимально необходимое минимальное количество времени упреждения для сертификатов. Например, необходимо выполнить поэтапную настройку сертификатов типа Аудиовидеоаусентикатион и Оаустокениссуер. Ваш минимум Еффективедате должен быть большим из двух сертификатов, в этом случае Оаустокениссуер, в котором минимальное время упреждения — 24 часа. Если вы не хотите пополнить сертификат Аудиовидеоаусентикатион с временем опережения в 24 часа, поэтапировать его отдельно с помощью Еффективедате, который больше ваших требований.
  
### <a name="to-update-or-renew-an-av-edge-service-certificate-with-a--roll-and--effectivedate-parameters"></a>Обновление и возобновление сертификата службы EDGE (A/V) с помощью параметров-рулонов и Еффективедате

1. Войдите на локальный компьютер как член группы "Администраторы".
    
2. Запрос возобновления или нового сертификата Аудиовидеоаусентикатион с экспортируемым закрытым ключом для существующего сертификата в службе EDGE (A/V).
    
3. Импортируйте новый сертификат Аудиовидеоаусентикатион на пограничный сервер и весь другой пограничный сервер в пуле (если у вас есть пул).
    
4. Настройте импортированный сертификат с помощью командлета Set-Ксцертификате и используйте параметр-рулон с параметром-Еффективедате. Дата вступления в силу должна быть задана в качестве срока действия текущего сертификата (14:00:00 или 2:00:00) минус время жизни токена (по умолчанию восемь часов). Это дает нам время, в течение которого сертификат должен быть активным, а Еффективедате \<строка\>: "7/22/2015 6:00:00 AM". 
    
    > [!IMPORTANT]
    > Для пула пограничного сервера необходимо, чтобы все сертификаты Аудиовидеоаусентикатион развернутые и выводились с помощью даты и времени первого развернутого сертификата, чтобы избежать возможного нарушения обмена данными из-за того, что истек срок действия более ранней версии сертификата, после того как все маркеры клиента и потребителя будут обновлены с помощью нового сертификата. 
  
    Команда Set-Ксцертификате с параметром-рулон и-Еффективетиме:
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          <thumb print of new certificate> -Roll -EffectiveDate <date and time
          for certificate to become active>
   ```

    Пример команды Set-Ксцертификате:
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2015
          6:00:00 AM"
   ```

    > [!IMPORTANT]
    > Еффективедате должен быть отформатирован в соответствии с регионом сервера и языковыми параметрами. В примере используются языковые параметры США и Language. 
  
Более подробное описание процесса, который задается с помощью Set-Ксцертификате,-рулонов и-Еффективедате, используется для создания нового сертификата для выпуска новых маркеров Аудиовидеоаусентикатион, но по-прежнему используется существующий сертификат для проверки используемых Аудиовидеоаусентикатион. по потребителям визуальная временная шкала является эффективным средством понимания процесса. В приведенном ниже примере администратор определяет, что срок действия сертификата службы EDGE (A/V) истек в 2:00:00 PM на 07/22/2015. Он запрашивает и получает новый сертификат и импортирует его на каждый пограничный сервер в его пуле. В 07/22/2015 начинается выполнение Get-Ксцертификате с параметром-Thumbprint, отпечаток, равным строке отпечатка нового сертификата, и-Еффективетиме, установленным на 07/22/2015 6:00:00 AM. Он запускает эту команду на каждом пограничном сервере.
  
![Использование параметров Roll и EffectiveDate.](../../media/Ops_Certificate_Set_Roll_EffectiveTime_Timeline.jpg)
  
|**Выноска**|**Стадии**|
|:-----|:-----|
|1  <br/> |Начало: 7/22/2015 12:00:00 AM  <br/> Срок действия текущего сертификата Аудиовидеоаусентикатион истекает в 2:00:00 на 7/22/2015. Это зависит от отметки времени, истекшей с момента истечения срока действия сертификата. Запланируйте замену и смену сертификата для учетной записи в течение 8 часов (срок действия маркера по умолчанию) до того момента, когда существующий сертификат дойдет к концу. В этом примере в 2:00:00 используется время упреждения, чтобы предоставить администратору достаточное время для размещения и подготовки новых сертификатов в течение 6:00:00 на момент вступления в силу.  <br/> |
|2  <br/> |7/22/2015 2:00:00 – 7/22/2015 5:59:59 AM  <br/> Настройка сертификатов на пограничных серверах с датой вступления в силу 6:00:00 AM (время упреждения в 4 часа — для этого примера, но может быть длиннее) с \<помощью функции Set\> -ксцертификате \<Type Usage Certificate —\> отпечаток для \<новой еффективедатеной строки Дата и время для нового сертификата.\>  <br/> |
|3  <br/> |7/22/2015 6:00 – 7/22/2015 2:00 PM  <br/> Для проверки маркеров сначала выполняется попытка создать сертификат, а если новый сертификат не может проверить маркер, будет выполнена попытка использования старого сертификата. Этот процесс используется для всех маркеров в течение 8 часов (срок жизни токена по умолчанию) перекрывает период.  <br/> |
|4  <br/> |Окончание: 7/22/2015 2:00:01 PM  <br/> Срок действия старого сертификата истек, и новый сертификат перейдет. Старый сертификат можно безопасно удалить с помощью Remove-Ксцертификате- \<Type Usage\> Certificate (предыдущий).  <br/> |
   
По истечении срока действия (7/22/2015 6:00:00 AM) все новые маркеры выдаются новым сертификатом. При проверке маркеров сначала проверяются маркеры для нового сертификата. Если проверка завершится ошибкой, будет произведена попытка использования старого сертификата. Процесс попытки нового и прекращения работы старого сертификата будет продолжаться до тех пор, пока не истечет срок действия старого сертификата. После истечения срока действия старого сертификата (7/22/2015 2:00:00 PM) маркеры будут проверяться только новым сертификатом. Старый сертификат можно безопасно удалить с помощью командлета Remove-Ксцертификате с параметром-Previous.

```PowerShell
Remove-CsCertificate -Type AudioVideoAuthentication -Previous
```

### <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a--roll-and--effectivedate-parameters"></a>Обновление и возобновление сертификата Оаустокениссуер с помощью параметров-рулонов и Еффективедате

1. Войдите на локальный компьютер как член группы "Администраторы".
    
2. Запрос возобновления или нового сертификата Оаустокениссуер с экспортируемым закрытым ключом для существующего сертификата на сервере переднего плана.
    
3. Импортируйте новый сертификат Оаустокениссуер на сервер переднего плана в пуле (если у вас развернут пул). Сертификат Оаустокениссуер реплицируется глобально и нуждается в обновлении и обновлении на любом сервере в развертывании. В качестве примера используется сервер переднего плана.
    
4. Настройте импортированный сертификат с помощью командлета Set-Ксцертификате и используйте параметр-рулон с параметром-Еффективедате. Дата вступления в силу должна быть указана как срок действия текущего сертификата (14:00:00 или 2:00:00), но не менее 24 часов. 
    
    Команда Set-Ксцертификате с параметром-рулон и-Еффективетиме:
    
   ```PowerShell
   Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb
          print of new certificate> -Roll -EffectiveDate <date and time for
          certificate to become active> -identity Global 
   ```

Пример команды Set-Ксцертификате:
    
  ```PowerShell
  Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2015
          1:00:00 PM" 
  ```

> [!IMPORTANT]
> Еффективедате должен быть отформатирован в соответствии с регионом сервера и языковыми параметрами. В примере используются языковые параметры США и Language. 
  
По истечении срока действия (7/21/2015 1:00:00 AM) все новые маркеры выдаются новым сертификатом. При проверке маркеров сначала проверяются маркеры для нового сертификата. Если проверка завершится ошибкой, будет произведена попытка использования старого сертификата. Процесс попытки нового и прекращения работы старого сертификата будет продолжаться до тех пор, пока не истечет срок действия старого сертификата. После истечения срока действия старого сертификата (7/22/2015 2:00:00 PM) маркеры будут проверяться только новым сертификатом. Старый сертификат можно безопасно удалить с помощью командлета Remove-Ксцертификате с параметром-Previous.
```PowerShell
Remove-CsCertificate -Type OAuthTokenIssuer -Previous 
```

## <a name="see-also"></a>См. также

[Управление проверкой подлинности серверов (OAuth) и партнерских приложений в Skype для бизнеса Server](server-to-server-and-partner-applications.md)

[Set-CsCertificate](https://docs.microsoft.com/powershell/module/skype/set-cscertificate?view=skype-ps)
  
[Remove-CsCertificate](https://docs.microsoft.com/powershell/module/skype/remove-cscertificate?view=skype-ps)
