---
title: Определение правил трансляции в Skype для бизнеса Server
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
description: Голосовая связь в Skype для бизнеса Server осуществляет звонки на основе номеров телефонов, нормализованных в формат E. 164. Это означает, что все строки с набором номера должны быть нормализованы в формате E. 164 для целей обратного просмотра номера (РНЛ), чтобы их можно было преобразовать в соответствующий URI SIP. Skype для бизнеса Server обеспечивает возможность управления вызываемым ИДЕНТИФИКАТОРом и презентацией идентификации вызывающего абонента.
ms.openlocfilehash: 633b0c16fefb66d1ea44f96b5f32c2ca91f357f2
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2019
ms.locfileid: "34274978"
---
# <a name="defining-translation-rules-in-skype-for-business-server"></a>Определение правил трансляции в Skype для бизнеса Server

Голосовая связь в Skype для бизнеса Server осуществляет звонки на основе номеров телефонов, нормализованных в формат E. 164. Это означает, что все строки с набором номера должны быть нормализованы в формате E. 164 для целей обратного просмотра номера (РНЛ), чтобы их можно было преобразовать в соответствующий URI SIP. Skype для бизнеса Server обеспечивает возможность управления вызываемым ИДЕНТИФИКАТОРом и презентацией идентификации вызывающего абонента.

В Skype для бизнеса Server телефонный номер вызываемого абонента (т. е. номер телефона) можно перевести из формата E. 164 в локальный формат набора номера, который требуется магистральным одноранговым узлом (то есть шлюзом, частным обменом филиалов (УАТС) или SIP Магистральная линия). Для этого необходимо определить одно или несколько правил преобразования для преобразования URI запроса перед переадресованием на магистральный узел.

## <a name="caller-id-presentation"></a>Презентация идентификации вызывающего абонента

Skype для бизнеса Server позволяет также переводить телефонный номер вызывающего абонента (номер телефона, с которого осуществляется звонок) с формата E. 164 на локальный формат набора, необходимый для однорангового канала. Например, можно создать правило преобразования для замены +44 в начале строки набора на 0144.

**Настройка идентификации вызывающего абонента с помощью панели управления "Skype для бизнеса" на сервере**

1. Войдите на компьютер как член группы RTCUniversalServerAdmins или роли CsVoiceAdministrator, CsServerAdministrator или CsAdministrator. Дополнительные сведения можно найти в разделе [Делегирование разрешений на настройку](https://technet.microsoft.com/en-us/library/gg412735(v=ocs.15).aspx).
2. Откройте окно браузера и введите URL-адрес администратора, чтобы открыть панель управления. Дополнительные сведения о различных способах использования панели управления "Skype для бизнеса" можно найти в разделе [Установка и открытие меню Администрирование](../../management-tools/install-and-open-administrative-tools.md).
3. На левой панели навигации щелкните **Маршрутизация голосовой связи** и **Настройка магистрали**.
4. На странице Конфигурация магистрали дважды щелкните существующую магистраль (например, **глобальную**), чтобы открыть диалоговое окно **Изменение конфигурации магистрали**.
5. Настройка представления идентификатора звонящего
    - Для выбора одного или нескольких правил из списка всех правил перевода, доступных в вашем развертывании Enterprise Voice, нажмите кнопку **выбрать**. В окне **Правила трансляции вызывающего номера** выберите правила, которые требуется сопоставить с магистральной линией связи, а затем нажмите кнопку **ОК**.
    - Чтобы определить новое правило преобразования и сопоставить его с магистральной линией связи, щелкните **Создать**. 
    - Чтобы изменить правило преобразования, уже сопоставленное с магистральной линией связи, щелкните имя правила, а затем выберите **Подробнее**.
    - Чтобы скопировать существующее правило перевода, которое будет использоваться в качестве отправной точки для определения нового правила, щелкните имя правила, нажмите кнопку **Копировать**, а затем выберите команду **Вставить**.
    - Чтобы удалить правило преобразования из магистральной линии связи, выделите имя этого правила, а затем щелкните **Удалить**.

> [!Warning] 
> Не сопоставляйте правила преобразования с магистральной линией связи, если вы уже настроили их для связанной одноранговой магистральной линии связи, поскольку эти два правила могут конфликтовать друг с другом. 

## <a name="called-id-presentation"></a>Презентация с именем ID

> [!Important]
> Возможность связывать одно или несколько правил трансляции с конфигурацией магистрали корпоративной голосовой связи предназначена для использования в качестве альтернативы настройке ** правил перевода на магистральном одноранговом узле. Не применяйте правила перевода с конфигурацией корпоративной магистрали, если вы настроили правила трансляции для однорангового канала, так как эти правила могут конфликтовать. 

Чтобы создать или изменить правило трансляции, можно использовать один из следующих способов:

- С [помощью инструмента "Создание правил перевода](#create-or-modify-a-translation-rule-by-using-the-build-a-translation-rule-tool) " укажите значения для начальных цифр, длину, цифр, которые нужно добавить, а затем разрешите на панели управления "Skype для бизнеса Server" соответствующий шаблон и правило перевода.
- [Напишите регулярные выражения вручную](#create-or-modify-a-translation-rule-manually) , чтобы задать шаблон сопоставления и правило трансляции.

> [!Note]
> Сведения о том, как создавать регулярные выражения, приведены в разделе [регулярные выражения .NET Framework](http://go.microsoft.com/fwlink/p/?linkId=140927). 

### <a name="create-or-modify-a-translation-rule-by-using-the-build-a-translation-rule-tool"></a>Создание или изменение правила трансляции с помощью инструмента "Создание правил перевода"

Следуйте этим инструкциям, если вы хотите определить правило перевода, введя набор значений в инструменте создание правил перевода и включив на панели управления "Skype для бизнеса" сервер для создания соответствующего шаблона сопоставления и правила трансляции. 

**Создание правила с помощью средства Build a Translation Rule (Создание правила преобразования)**

1. Войдите на компьютер как член группы RTCUniversalServerAdmins или роли CsVoiceAdministrator, CsServerAdministrator или CsAdministrator. Дополнительные сведения можно найти в разделе [Делегирование разрешений на настройку](https://technet.microsoft.com/en-us/library/gg412735(v=ocs.15).aspx).
2. Откройте окно браузера и введите URL-адрес администратора, чтобы открыть панель управления. Дополнительные сведения о различных способах использования панели управления "Skype для бизнеса" можно найти в разделе [Установка и открытие меню Администрирование](../../management-tools/install-and-open-administrative-tools.md).
3. Чтобы приступить к определению правила трансляции, выполните действия, описанные в статье [Настройка канала с помощью мультимедиа](GET LINK AFTER MIGRATION)на этапе 10, или [Настройте магистраль без обхода](GET LINK AFTER MIGRATION) с помощью мультимедиа на этапе 9.
4. На странице **Создание правила трансляции** или **Изменение правила трансляции** в поле **Имя** введите описательное имя правила преобразования.
5. Необязательно В поле **Описание**введите описание правила трансляции (например, **Международный набор**для междугородних звонков в США).
6. В разделе **Построение правила трансляции** введите следующие значения:
    - **Начальные цифры**: (необязательно) укажите начальные цифры чисел, которые должны соответствовать шаблону. Например, введите в этом поле знак "+", чтобы сопоставить числа в формате E. 164 (начиная с +).
    - **Длина**. Укажите число цифр шаблона и укажите, должны ли цифры номера соответствовать всему шаблону, минимальному числу цифр шаблона или любому числу цифр шаблона. Например, введите **11** и в раскрывающемся списке выберите **At least** (Минимум) для поиска номеров, состоящих как минимум из 11 цифр.
    - **Цифры для удаления**: (необязательно) укажите, сколько цифр начинается для удаления. Например, чтобы удалить знак + с начала номера, введите **1** .
    - **Цифры для добавления**. Укажите цифры, добавляемые в начало преобразуемых номеров (необязательно). Например, если вы хотите, чтобы при применении правила преобразования в начало номеров добавлялись цифры 011, введите значение **011**.
    
    Значения, введенные в этих полях, отражаются в полях " **соответствие шаблону** " и "правило **перевода** ". Например, если указать предшествующие значения примера, получившееся в результате регулярное выражение в поле " **шаблон для МАТК**h" будет следующим:
    
    **^\+(\d{9}\d +) $** 

    Поле **Правило трансляции** задает шаблон для формата преобразованных номеров. Этот шаблон состоит из 2 частей:
    - Значение (например, **$1**), которое представляет число цифр в шаблоне соответствия
    - Значение, добавляемое перед номером, которое вводится в поле **Цифры для добавления** (необязательно)

    Для значений предыдущего примера в поле **Правило трансляции** будет отображаться **011$1**.
    
    После применения этого правила преобразования номер +441235551010 будет изменен на 011441235551010.
7. Чтобы сохранить правило трансляции, нажмите кнопку **ОК**.
8. Чтобы сохранить конфигурацию магистрали, нажмите кнопку **ОК**.
9. На странице " **магистраль конфигуратио**n" нажмите **** кнопку "зафиксировать" и выберите команду " **зафиксировать все**". 

> [!Note]
> Всякий раз при создании или изменении правила преобразования необходимо выполнять команду **Сохранить все**, чтобы опубликовать изменение конфигурации. Дополнительные сведения можно найти в разделе [Публикация ожидающих изменений в конфигурации голосовой маршрутизации](https://technet.microsoft.com/en-us/library/gg413088(v=ocs.15).aspx). 

### <a name="create-or-modify-a-translation-rule-manually"></a>Создание или изменение правила трансляции вручную

Если вы хотите определить правило перевода с помощью регулярного выражения для соответствующего шаблона и правила трансляции, выполните указанные ниже действия. 

**Определение правила преобразования вручную**

1. Войдите на компьютер как член группы RTCUniversalServerAdmins или роли CsVoiceAdministrator, CsServerAdministrator или CsAdministrator. Дополнительные сведения можно найти в разделе [Делегирование разрешений на настройку](https://technet.microsoft.com/en-us/library/gg412735(v=ocs.15).aspx).
2. Откройте окно браузера и введите URL-адрес администратора, чтобы открыть панель управления. Дополнительные сведения о различных способах использования панели управления "Skype для бизнеса" можно найти в разделе [Установка и открытие меню Администрирование](../../management-tools/install-and-open-administrative-tools.md).
3. Чтобы приступить к определению правила трансляции, выполните действия, описанные в статье [Настройка канала с помощью мультимедиа](GET LINK AFTER MIGRATION)на этапе 10, или [Настройте магистраль без обхода](GET LINK AFTER MIGRATION) с помощью мультимедиа на этапе 9.
4. В поле **Имя** на странице **Создание правила трансляции** или **Изменение правила трансляции** введите имя, описывающее шаблон номера для преобразования.
5. Необязательно В поле **Описание**введите описание правила трансляции. Например, **Международный набор**для междугородних звонков в США.
6. Внизу раздела **Построение правила трансляции** нажмите кнопку **Правка**.
7. Введите следующее выражение в поле введите текст **регулярного выражения**.
    - В поле **Сопоставить этот шаблон** укажите шаблон, который будет использоваться для сопоставления номеров для преобразования.
    - В поле **Правило трансляции** укажите шаблон для формата преобразованных номеров.

    Например, если ввести ** ^ \+({9}\d \d +) $** в соответствии с **этим шаблоном** и **011 $1** в **правиле перевода**, правило будет переведено + 441235551010 в 011441235551010.
8. Чтобы сохранить правило трансляции, нажмите кнопку **ОК**.
9. Чтобы сохранить конфигурацию магистрали, нажмите кнопку **ОК**.
10. На странице **Конфигурация линии связи** нажмите **Сохранить**, затем **Сохранить все**. 

> [!Note] 
> Всякий раз при создании или изменении правила преобразования необходимо выполнять команду **Сохранить все**, чтобы опубликовать изменение конфигурации. Дополнительные сведения можно найти в разделе [Публикация ожидающих изменений в конфигурации голосовой маршрутизации](https://technet.microsoft.com/en-us/library/gg413088(v=ocs.15).aspx). 
