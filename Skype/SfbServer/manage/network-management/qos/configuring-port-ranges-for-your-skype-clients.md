---
title: Настройка диапазонов портов и политики качества обслуживания для клиентов
ms.reviewer: ''
ms:assetid: 287d5cea-7ada-461c-9b4a-9da2af315e71
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ204760(v=OCS.15)
ms:contentKeyID: 48183694
mtps_version: v=OCS.15
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
description: В этой статье описано, как настраивать диапазоны портов для клиентов и настраивать политики качества обслуживания в Skype для бизнеса Server для клиентов, работающих под управлением Windows 10.
ms.openlocfilehash: 9a82a254ab5a01982e9f1d4bd3a994fd67c03615
ms.sourcegitcommit: e64c50818cac37f3d6f0f96d0d4ff0f4bba24aef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2020
ms.locfileid: "41817428"
---
# <a name="configuring-port-ranges-and-a-quality-of-service-policy-for-your-clients-in-skype-for-business-server"></a>Настройка диапазонов портов и политики качества обслуживания для клиентов в Skype для бизнеса Server

В этой статье описано, как настраивать диапазоны портов для клиентов и настраивать политики качества обслуживания в Skype для бизнеса Server для клиентов, работающих под управлением Windows 10.

## <a name="configure-port-ranges"></a>Настройка диапазонов портов

По умолчанию клиентские приложения Skype для бизнеса могут использовать любой порт между портами 1024 и 65535 при включении в сеанс связи. Это происходит из-за того, что определенные диапазоны портов не включены автоматически для клиентов. Тем не менее, чтобы использовать качество обслуживания, вам потребуется переназначить различные типы трафика (звук, видео, мультимедиа, общий доступ к приложениям и передачу файлов) на ряд уникальных диапазонов портов. Это можно сделать с помощью командлета Set-КсконференЦингконфигуратион.

> [!NOTE]  
> Конечные пользователи не могут вносить эти изменения. Изменение портов может выполняться только администраторами с помощью командлета Set-КсконференЦингконфигуратион.


Вы можете определить, какие диапазоны портов используются в сеансах связи, выполнив следующую команду в командной консоли управления Skype для бизнеса Server:

    Get-CsConferencingConfiguration

Если вы не внесли никаких изменений в параметры конференц-связи после установки Skype для бизнеса Server, вы должны получить информацию, которая включает следующие значения свойств:

    ClientMediaPortRangeEnabled : False
    ClientAudioPort             : 5350
    ClientAudioPortRange        : 40
    ClientVideoPort             : 5350
    ClientVideoPortRange        : 40
    ClientAppSharingPort        : 5350
    ClientAppSharingPortRange   : 40
    ClientFileTransferPort      : 5350
    ClientTransferPortRange     : 40

Если вы ближе просмотрит предыдущий результат, вы увидите два важных элемента. Сначала свойство Клиентмедиапортранжеенаблед имеет значение false.

    ClientMediaPortRangeEnabled : False

Это важно, так как в случае, если для этого свойства задано значение false, клиенты Skype для бизнеса будут использовать любой доступный порт между портами 1024 и 65535 при использовании в сеансе связи. Это справедливо независимо от других параметров порта (например, Клиентмедиапорт или Клиентвидеопорт). Если вы хотите ограничить использование заданным набором портов (и это нужно сделать, если вы планируете реализовать качество обслуживания), необходимо сначала включить диапазоны портов для клиента мультимедиа. Это можно сделать с помощью следующей команды Windows PowerShell:

    Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True

Предыдущая команда включает диапазоны порта клиента мультимедиа для глобальной коллекции параметров конфигурации конференций. Однако эти параметры также можно применять к области действия сайта и (или) области службы (только для службы сервера конференц-связи). Чтобы включить диапазон портов клиента мультимедиа для определенного сайта или сервера, укажите удостоверение этого сайта или сервера при вызове Set-КсконференЦингконфигуратион:

    Set-CsConferencingConfiguration -Identity "site:Redmond" -ClientMediaPortRangeEnabled $True

Кроме того, вы можете использовать эту команду для одновременного включения диапазонов портов для всех параметров настройки конференц-связи.

    Get-CsConferencingConfiguration | Set-CsConferencingConfiguration  -ClientMediaPortRangeEnabled $True

Во втором случае важно заметить, что в примере вывода показано, что по умолчанию диапазоны портов мультимедиа, заданные для каждого типа сетевого трафика, идентичны:

    ClientAudioPort             : 5350
    ClientVideoPort             : 5350
    ClientAppSharingPort        : 5350
    ClientFileTransferPort      : 5350

Для реализации QoS каждый из этих диапазонов должен быть уникальным. Например, вы можете настроить диапазоны портов следующим образом:


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип трафика клиента</th>
<th>Начало порта</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Голосовая связь</p></td>
<td><p>50020</p></td>
<td><p>средняя</p></td>
</tr>
<tr class="even">
<td><p>Видеосвязь</p></td>
<td><p>58000</p></td>
<td><p>средняя</p></td>
</tr>
<tr class="odd">
<td><p>Общий доступ к приложениям</p></td>
<td><p>42000</p></td>
<td><p>средняя</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>средняя</p></td>
</tr>
</tbody>
</table>


В приведенной выше таблице диапазоны портов клиента представляют собой подмножество диапазонов портов, настроенных для серверов. Например, на серверах общий доступ к приложениям настроен на использование портов 40803 – 49151; на клиентских компьютерах общий доступ к приложениям настроен на использование портов 42000 – 42019. Это тоже делается для того, чтобы упростить администрирование QoS: клиентские порты не должны представлять подмножество портов, используемых на сервере. (Например, на клиентских компьютерах вы можете настроить общий доступ к приложениям, например, с помощью портов 10000 – 10019.) Тем не менее рекомендуется сделать порт клиента подмножеством диапазонов портов сервера.

Кроме того, вы могли заметить, что порты 8348 были настроены для совместного использования приложений на серверах, но для совместного использования приложений на клиентских компьютерах задано только 20 портов. Это также рекомендовано, но не является жесткой и быстрым правилом. Как правило, вы можете использовать каждый доступный порт для представления одного сеанса связи: Если в диапазоне портов есть доступные порты 100, это означает, что ваш компьютер может принимать участие в сеансах связи 100 в любой момент времени. Поскольку серверы, скорее чем, будут работать в большинстве сеансов, чем клиенты, имеет смысл открыть на серверах больше портов, чем на клиентах. Настройка 20 портов для совместного использования приложений на клиенте означает, что пользователь может принимать участие в 20 сеансах общего разделения приложений на указанном устройстве и одновременно. Это должно быть достаточно для самых разнообразных пользователей.

Для назначения предыдущих диапазонов портов глобальному семейству параметров настройки конференц-связи можно использовать следующую команду командной консоли Skype для бизнеса Server:

    Set-CsConferencingConfiguration -Identity global -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20

Кроме того, можно использовать эту команду для назначения одинаковых диапазонов портов для всех параметров настройки конференц-связи.

    Get-CsConferencingConfiguration | Set-CsConferencingConfiguration -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20

Отдельные пользователи должны выйти из Skype для бизнеса, а затем снова войти в систему, чтобы изменения вступили в силу.

> [!NOTE]  
> Вы также можете включить диапазоны портов клиента мультимедиа, а затем назначить эти диапазоны портов с помощью одной команды. Например:<BR><CODE>Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20</CODE>

## <a name="configure-quality-of-service-policies-for-clients-running-on-windows-10"></a>Настройка политик качества обслуживания для клиентов, работающих в Windows 10

Помимо задания диапазонов портов для клиентов Skype для бизнеса, необходимо также создать отдельные политики качества обслуживания, которые будут применяться на клиентских компьютерах. (Политики качества обслуживания, созданные для конференций, приложений и серверов-исправлений, не следует применять на клиентских компьютерах.) Эти сведения относятся только к компьютерам, на которых установлен клиент Skype для бизнеса и Windows 10.

В следующем примере используется набор диапазонов портов для создания политики голосовой и видеополитики.


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип трафика клиента</th>
<th>Начало порта</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Голосовая связь</p></td>
<td><p>50020</p></td>
<td><p>средняя</p></td>
</tr>
<tr class="even">
<td><p>Видеосвязь</p></td>
<td><p>58000</p></td>
<td><p>средняя</p></td>
</tr>
<tr class="odd">
<td><p>Общий доступ к приложениям</p></td>
<td><p>42000</p></td>
<td><p>средняя</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>средняя</p></td>
</tr>
</tbody>
</table>

Чтобы создать политику звука качества обслуживания для компьютеров с Windows 10, сначала войдите на компьютер, на котором установлен компонент управления групповыми политиками. Откройте средство управления групповыми политиками (нажмите кнопку **Пуск**, выберите пункт **Администрирование**, а затем — **Управление групповыми политиками**), а затем выполните указанные ниже действия.

1.  В разделе Управление групповой политикой найдите контейнер, в котором нужно создать новую политику. Например, если все клиентские компьютеры находятся в подразделении с именем "клиенты", в подразделении клиента следует создать новую политику.

2.  Щелкните правой кнопкой мыши соответствующий контейнер, а затем выберите команду **создать объект групповой политики в этом домене и свяжите его**.

3.  В диалоговом окне **создание GPO** введите имя нового объекта групповой политики в поле **имя** и нажмите кнопку **ОК**.

4.  Щелкните созданную политику правой кнопкой мыши и выберите команду **изменить**.

5.  В редакторе управления групповыми политиками разверните узел **Конфигурация компьютера**, разверните раздел **Параметры Windows**, щелкните правой кнопкой мыши службу **QoS на основе политики**, а затем выберите команду **создать новую политику**.

6.  В диалоговом окне **QoS на основе политики** на первой странице в поле **имя** введите имя новой политики. Выберите **задать значение DSCP** и задайте значение **46**. Оставьте параметр **задать частоту исходящих подключений** невыбранным и нажмите кнопку **Далее**.

7.  На следующей странице выберите **только приложения с именем исполняемого файла**, введите в качестве имени **Lync. exe** и нажмите кнопку **Далее**. Этот параметр дает политике приоритет только для трафика, совпадающего с клиентом Skype для бизнеса.

8.  На третьей странице убедитесь, что выбраны оба **IP-адреса источника** и **конечный IP-адрес** , а затем нажмите кнопку **Далее**. Эти два параметра гарантируют, что пакеты будут управляться независимо от того, на каком компьютере (IP-адрес) отправили эти пакеты, и какой компьютер (IP-адрес) будет получать эти пакеты.

9.  На четвертой странице в раскрывающемся списке выберите протокол **TCP и UDP** , который будет **применяться этой политикой QoS** . Протокол TCP и протокол UDP (User Datagram Protocol) — это два сетевых протокола, которые чаще всего используются в Skype для бизнеса Server и его клиентских приложениях.

10. Под заголовком **укажите номер исходного порта**, выберите **из этого исходного порта или диапазона**. В сопроводительном текстовом поле введите диапазон портов, зарезервированный для передачи звука. Например, если вы зарезервированы порты 50020 через порты 50039 для звукового трафика, введите диапазон портов в следующем формате: **50020:50039**. Нажмите **Готово**.

После создания политики качества обслуживания для звука вы должны создать вторую политику для видео. Чтобы создать политику для видео, выполните те же действия, что и при создании политики звука, заменив указанные ниже.

  - Используйте другое (и уникальное) имя политики.

  - Задайте для параметра DSCP значение **34** вместо 46. (Как отмечалось ранее, вам не нужно использовать значение DSCP 34; вы просто должны назначить другое значение DSCP, отличное от используемого для звука.)

  - Используйте ранее настроенный диапазон портов для видеоканала. Например, если вы зарезервированы порты 58000 – 58019 для видео, задайте диапазон портов следующим образом: **58000:58019**.

Если вы решили создать политику для управления трафиком общего использования приложений, сделайте следующее:

  - Используйте другое (и уникальное) имя политики (например, **общий доступ к приложениям в Skype для бизнеса Server**).

  - Задайте для параметра DSCP значение **24** , а не 46. (Опять же, это значение не обязательно должно быть 24; оно будет отличаться от значений DSCP, используемых для аудио-и видеофайлов.)

  - Используйте ранее настроенный диапазон портов для видеоканала. Например, если у вас есть резервированные порты 42000 – 42019 для совместного использования приложений, задайте диапазон портов следующим образом: **42000:42019**.

Для политики передачи файлов выполните указанные ниже действия.

  - Используйте другое (и уникальное) имя политики (например, **Серверная передача файлов в Skype для бизнеса**).

  - Задайте для параметра DSCP значение **14**. (Опять же, это значение не обязательно должно быть 14; оно просто должен быть уникальным кодом DSCP.)

  - Используйте ранее настроенный диапазон портов для приложения. Например, если у вас есть резервированные порты 42020 – 42039 для совместного использования приложений, задайте диапазон портов следующим образом: **42020:42039**.

Новые политики, созданные вами, вступят в силу только после обновления групповой политики на клиентских компьютерах. Хотя групповая политика периодически обновляется сама, вы можете обновить ее принудительно, запустив на каждом нужном компьютере следующую команду.

    Gpupdate.exe /force

Команду можно выполнить в любом командном окне, запущенном от имени администратора. Чтобы открыть такое окно с правами администратора, в меню **Пуск** правой кнопкой мыши щелкните **Командная строка** и выберите пункт **Запуск от имени администратора**.

Имейте в виду, что эти политики должны быть нацелены на клиентские компьютеры. Они не должны применяться к серверам, на которых установлен Skype для бизнеса Server.

Чтобы убедиться в том, что сетевые пакеты помечены с использованием соответствующего значения DSCP, необходимо также создать новый параметр реестра на каждом компьютере, выполнив описанные ниже действия.

1.  В меню **Пуск** выберите пункт **Выполнить**.

2.  В диалоговом окне **выполнить** введите **regedit**и нажмите клавишу ВВОД.

3.  В редакторе реестра разверните раздел **\_hKey локальный\_компьютер**, разверните раздел **система**, разверните **куррентконтролсет**, затем — **службы**, а затем — значок **tcpip**.

4.  Щелкните правой кнопкой мыши **tcpip**, наведите указатель на пункт **создать**и выберите **клавишу**. После создания нового раздела реестра введите **QoS**и нажмите КЛАВИШу ввод, чтобы переименовать раздел.

5.  Щелкните правой кнопкой мыши **QoS**, наведите указатель на пункт **создать**и выберите **строковое значение**. После создания нового значения реестра введите команду не **использовать NLA**и нажмите клавишу ВВОД, чтобы переименовать значение.

6.  Дважды щелкните **не использовать NLA**. В диалоговом окне **изменение строки** введите **1** в поле **значение** , а затем нажмите кнопку **ОК**.

7.  Закройте редактор реестра и ебут компьютер.

### <a name="configure-quality-of-service-on-computers-with-multiple-network-adapters"></a>Настройка качества обслуживания на компьютерах с несколькими сетевыми адаптерами

Если у вас есть компьютер с несколькими сетевыми адаптерами, может возникнуть ситуация, когда значения DSCP отображаются как 0x00, а не настроенное значение. Обычно это происходит на компьютерах, на которых один или несколько сетевых адаптеров не могут получить доступ к домену Active Directory (например, если эти адаптеры используются для частной сети). В таких случаях значения DSCP будут помечены для адаптеров, которые могут получить доступ к домену, но не будут помечены для адаптеров, которые не могут получить доступ к домену.

Если вы хотите пометить значения DSCP для всех сетевых адаптеров на компьютере, в том числе для тех, у которых нет доступа к вашему домену, вам потребуется добавить в реестр значение и настроить его. Это можно сделать, выполнив описанные ниже действия.

1.  В меню **Пуск** выберите пункт **Выполнить**.

2.  В диалоговом окне **выполнить** введите **regedit**и нажмите клавишу ВВОД.

3.  В редакторе реестра разверните раздел **\_hKey локальный\_компьютер**, разверните раздел **система**, разверните **куррентконтролсет**, затем — **службы**, а затем — значок **tcpip**.

4.  Если вы не видите раздел реестра с меткой **QoS** , щелкните правой кнопкой мыши **tcpip**и выберите пункт **создать**, а затем — **раздел**. После создания нового ключа введите **QoS**и нажмите клавишу ВВОД, чтобы переименовать раздел.

5.  Щелкните правой кнопкой мыши **QoS**, наведите указатель на пункт **создать**и выберите **строковое значение**. После создания нового значения реестра введите команду не **использовать NLA**и нажмите клавишу ВВОД, чтобы переименовать значение.

6.  Дважды щелкните **не использовать NLA**. В диалоговом окне **изменение строки** введите **1** в поле **значение** , а затем нажмите кнопку **ОК**.

После создания и настройки нового значения реестра вам потребуется перезагрузить компьютер, чтобы изменения вступили в силу.

## <a name="see-also"></a>См. также

[Создание объекта групповой политики в Windows 10](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-firewall/create-a-group-policy-object)
