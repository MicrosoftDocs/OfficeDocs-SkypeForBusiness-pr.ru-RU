---
title: Настройка диапазонов портов и политики качества обслуживания для клиентов
ms.reviewer: ''
ms:assetid: 287d5cea-7ada-461c-9b4a-9da2af315e71
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ204760(v=OCS.15)
ms:contentKeyID: 48183694
mtps_version: v=OCS.15
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
description: В этой статье описывается настройка диапазонов портов для клиентов и настройка политик качества обслуживания в Skype для бизнеса Server для клиентов под управлением Windows 10.
ms.openlocfilehash: b2961193bef799742ac3b79a4f421a7aa50c5a03
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49814209"
---
# <a name="configuring-port-ranges-and-a-quality-of-service-policy-for-your-clients-in-skype-for-business-server"></a>Настройка диапазонов портов и политики качества обслуживания для клиентов в Skype для бизнеса Server

В этой статье описывается настройка диапазонов портов для клиентов и настройка политик качества обслуживания в Skype для бизнеса Server для клиентов под управлением Windows 10.

## <a name="configure-port-ranges"></a>Настройка диапазонов портов

По умолчанию клиентские приложения Skype для бизнеса могут использовать любой порт между портами 1024 и 65535 при использовании сеанса связи; Это происходит потому, что определенные диапазоны портов не включены автоматически для клиентов. Однако для использования качества обслуживания необходимо перенаказать различные типы трафика (звук, видео, мультимедиа, общий доступ к приложениям и передачу файлов) на ряд уникальных диапазонов портов. Это можно сделать с помощью Set-CsConferencingConfiguration управления.

> [!NOTE]  
> Конечные пользователи не могут вносить эти изменения самостоятельно. Изменения портов могут внести только администраторы с помощью Set-CsConferencingConfiguration управления.


Вы можете определить, какие диапазоны портов в настоящее время используются для сеансов связи, вы можете использовать следующую команду в командной оболочке Skype для бизнеса Server:

    Get-CsConferencingConfiguration

Предположим, что с момента установки Skype для бизнеса Server вы не внесе никаких изменений в параметры conferencing, вы должны получить сведения, включающие следующие значения свойств:

    ClientMediaPortRangeEnabled : False
    ClientAudioPort             : 5350
    ClientAudioPortRange        : 40
    ClientVideoPort             : 5350
    ClientVideoPortRange        : 40
    ClientAppSharingPort        : 5350
    ClientAppSharingPortRange   : 40
    ClientFileTransferPort      : 5350
    ClientTransferPortRange     : 40

Если внимательно посмотреть на предыдущие данные, можно увидеть две важных вещи. Во-первых, для свойства ClientMediaPortRangeEnabled задано значение False:

    ClientMediaPortRangeEnabled : False

Это важно, так как, если для этого свойства установлено значение False, клиенты Skype для бизнеса будут использовать любой доступный порт между портами 1024 и 65535 при использовании сеанса связи; Это справедливо независимо от других параметров порта (например, ClientMediaPort или ClientVideoPort). Если вы хотите ограничить использование указанным набором портов (и это необходимо сделать, если вы планируете реализовать качество обслуживания), необходимо сначала включить диапазоны портов мультимедиа клиента. Это можно сделать с помощью следующей Windows PowerShell команды:

    Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True

Приведенная выше команда активирует диапазоны портов мультимедиа клиентов для глобальной коллекции параметров конфигурации конференций. Однако данные настройки также могут применяться к области сайта или службы (только для службы сервера конференций). Чтобы включить диапазоны портов мультимедиа клиентов для определенного сайта или сервера, укажите идентификатор этого сайта или сервера при вызове команды Set-CsConferencingConfiguration:

    Set-CsConferencingConfiguration -Identity "site:Redmond" -ClientMediaPortRangeEnabled $True

Или же вы можете использовать следующую команду, чтобы одновременно включить диапазоны порты для всех параметров конфигурации конференций:

    Get-CsConferencingConfiguration | Set-CsConferencingConfiguration  -ClientMediaPortRangeEnabled $True

Второй важный момент — в примере выходных данных показано, что по умолчанию набор диапазонов портов мультимедиа для каждого типа сетевого трафика идентичны:

    ClientAudioPort             : 5350
    ClientVideoPort             : 5350
    ClientAppSharingPort        : 5350
    ClientFileTransferPort      : 5350

Чтобы реализовать QoS, каждый из этих диапазонов портов должен быть уникальным. Например, вы можете настроить следующие диапазоны портов:


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип клиентского трафика</th>
<th>Начальный порт</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>"Audio" (Аудио);</p></td>
<td><p>50020</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Видео</p></td>
<td><p>58000</p></td>
<td><p>20</p></td>
</tr>
<tr class="odd">
<td><p>Общий доступ к приложениям</p></td>
<td><p>42000</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>


В приведенной выше таблице диапазоны портов клиента представляют подмножество диапазонов портов, настроенных для ваших серверов. Например, на серверах для совместного использования приложений были настроены порты с 40803 по 49151. Это также сделано главным образом для упростить администрирование QoS: клиентские порты не должны представлять подмножество портов, используемых на сервере. (Например, на клиентских компьютерах можно настроить общий доступ к приложениям для использования, например, портов от 10000 до 10019.) Однако рекомендуется сделать диапазоны портов клиента подмножество диапазонов портов сервера.

Кроме того, вы могли заметить, что 8348 портов было выделено для совместного использования приложений на серверах, но всего 20 портов было выделено для совместного использования приложений на клиентах. Это также рекомендуется, но не является жестко и быстрое правило. Как правило, каждый доступный порт может представлять один сеанс связи: если в диапазоне портов доступно 100 портов, это означает, что компьютер может участвовать не более чем в 100 сеансах связи в любой момент времени. Поскольку серверы, вероятно, будут участвовать в большем числе сеансов, чем клиенты, имеет смысл открыть намного больше портов на серверах, чем на клиентах. Выделение 20 портов для совместного использования приложений на клиентах означает, что пользователь одновременно может участвовать в 20 сеансах совместного применения приложений на указанном устройстве. Если должно быть достаточно для подавляющего большинства пользователей.

Чтобы назначить предыдущие диапазоны портов глобальной коллекции параметров конфигурации, можно использовать следующую команду командной оболочки Skype для бизнеса Server:

    Set-CsConferencingConfiguration -Identity global -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20

Или с помощью этой команды можно назначить эти же диапазоны портов всем параметрам конфигурации конференций:

    Get-CsConferencingConfiguration | Set-CsConferencingConfiguration -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20

Отдельные пользователи должны выйти из Skype для бизнеса, а затем снова войти в систему, чтобы эти изменения вступили в силу.

> [!NOTE]  
> Вы также можете включить диапазоны портов мультимедиа клиентов, а затем назначить эти диапазоны портов с помощью одной команды. Например:<BR><CODE>Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20</CODE>

## <a name="configure-quality-of-service-policies-for-clients-running-on-windows-10"></a>Настройка политик качества обслуживания для клиентов, работающих в Windows 10

Помимо указания диапазонов портов для использования клиентами Skype для бизнеса, необходимо также создать отдельные политики качества обслуживания, которые будут применяться к клиентских компьютерам. (Политики качества обслуживания, созданные для серверов-служб, приложений и серверов-посредников, не должны применяться к клиентских компьютерам.) Эти сведения применимы только к компьютерам с клиентом Skype для бизнеса и Windows 10.

В следующем примере этот набор диапазонов портов используется для создания политики звука и политики видео:


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип клиентского трафика</th>
<th>Начальный порт</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>"Audio" (Аудио);</p></td>
<td><p>50020</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Видео</p></td>
<td><p>58000</p></td>
<td><p>20</p></td>
</tr>
<tr class="odd">
<td><p>Общий доступ к приложениям</p></td>
<td><p>42000</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>

Чтобы создать политику качества обслуживания для компьютеров с Windows 10, сначала войдите на компьютер, на котором установлено управление групповыми политиками. Откройте управление групповыми политиками (нажмите кнопку **"Начните",** выберите пункт "Администрирование" и выберите пункт **"Управление** групповой политикой"), а затем выполните следующую процедуру: 

1.  В консоли управления групповыми политиками найдите контейнер, в котором следует создать новую политику. Например, если все клиентские компьютеры находятся в под названием "Клиенты", новую политику следует создать в клиенте.

2.  Щелкните правой кнопкой мыши соответствующий контейнер и выберите "Создать **GPO в этом** домене" и связать его здесь.

3.  В **диалоговом** окне "Новый объект групповой политики"  введите имя нового объекта групповой политики в поле "Имя" и нажмите кнопку **"ОК".**

4.  Щелкните правой кнопкой мыши созданную политику и выберите **"Изменить".**

5.  В редакторе управления групповыми политиками разйдите "Конфигурация **компьютера",**"Параметры **Windows",** щелкните правой кнопкой мыши **"QoS на** основе политики" и выберите **"Создать новую политику".**

6.  В **диалоговом окне "QoS** на основе политики" на открываемой странице введите имя новой политики в поле **"Имя".** Выберите поле **Укажите значение DSCP** и установите значение **46**. Оставьте поле **Укажите частоту передачи** пустым и нажмите кнопку **Далее**.

7.  На следующей странице выберите только приложения с этим исполняемым именем, **Lync.exe** в качестве имени, а затем нажмите кнопку **"Далее".** Этот параметр предписывает политике только устанавливать приоритеты для совпадающих трафика из клиента Skype для бизнеса.

8.  На третьей странице убедитесь, что выбраны  как любой исходный **IP-адрес,** так и любой адрес назначения, а затем нажмите кнопку **"Далее".** Эти два параметра гарантируют, что пакеты будут управляться независимо от того, с какого компьютера (IP-адреса) отправляются эти пакеты, и какой компьютер (IP-адрес) будет получать эти пакеты.

9.  На четвертой странице выберите **TCP и UDP** в раскрывающемся списке **Выберите протокол, к которому применяется политика QoS**. TCP (Transmission Control Protocol) и UDP (User Datagram Protocol) — это два сетевых протокола, которые чаще всего используются в Skype для бизнеса Server и его клиентских приложениях.

10. В разделе **Укажите номер исходного порта** выберите **От этого исходного порта или диапазона**. В сопутствующем текстовом поле введите диапазон портов, зарезервированный для передачи звука. Например, если вы зарезервировали для звукового трафика порты от 50020 до 50039, укажите этот диапазон портов в следующем формате: **50020:50039**. Нажмите кнопку **Готово**.

После создания политики QoS для звука следует создать вторую политику для видео. Для этого выполните ту же основную процедуру, которой вы следовали при создании политики для аудио, внеся следующие изменения.

  - Используйте другое (и уникальное) имя политики.

  - Для значения DSCP вместо 46 укажите **34**. (Как было отмечено ранее, вы не обязаны использовать значение DSCP 34; просто назначьте для видео значение DSCP, отличное от значения для аудио.)

  - Используйте ранее настроенный диапазон портов для видео-трафика. Например, если для видео зарезервированы порты от 58000 до 58019, установите диапазон портов: **58000:58019.**

Если вы решили создать политику для управления трафиком общего доступа к приложениям, сделайте эти подстановки:

  - Используйте другое (и уникальное) имя политики (например, Общий доступ к приложениям Skype для бизнеса **Server).**

  - Для значения DSCP вместо 46 укажите **24**. (Опять же, это значение не должно быть равно 24, оно просто должно отличаться от значений DSCP, используемых для аудио и видео.)

  - Используйте ранее настроенный диапазон портов для видео-трафика. Например, если вы зарезервировали порты с 42000 по 42019 для общего доступа к приложениям, установите этот диапазон портов: **42000:42019.**

Для политики передачи файлов

  - Используйте другое (и уникальное) имя политики (например, Передача файлов Skype для бизнеса **Server).**

  - Установите значение DSCP, равное **14**. (Опять же, это значение не должно быть равно именно 14, оно просто должно быть уникальным кодом DSCP.)

  - Используйте ранее настроенный диапазон портов для приложения. Например, если вы зарезервировали порты с 42020 по 42039 для общего доступа к приложениям, установите этот диапазон портов: **42020:42039**.

Новые политики не будут действовать, пока не обновится групповая политика на клиентских компьютерах. Хотя групповая политика периодически обновляется сама по себе, можно принудительно вызвать немедленное обновление, выполнив на каждом компьютере, на котором требуется обновление групповой политики, следующую команду:

    Gpupdate.exe /force

Эту команду можно выполнить из любого окна командной строки, запущенного с учетными данными администратора. Чтобы запустить командное окно с учетными данными администратора, нажмите кнопку **Пуск**, щелкните правой кнопкой мыши пункт **Командная строка** и выберите команду **Запуск от имени администратора**.

Помните, что эти политики должны быть направлены на ваши клиентские компьютеры. Они не должны применяться к серверам Skype для бизнеса Server.

Чтобы обеспечить отметку сетевых пакетов соответствующим значением DSCP, необходимо также создать новый раздел реестра, выполнив следующую процедуру:

1.  Нажмите кнопку **Пуск** и выберите пункт **Выполнить**.

2.  В **диалоговом** окне "Выполнить" введите **regedit** и нажмите ввод.

3.  В редакторе реестра развертка **HKEY \_ LOCAL \_ MACHINE,** развернуть **SYSTEM,** **развернуть CurrentControlSet,** развернуть службы, а затем развернуть **Tcpip**.

4.  Щелкните правой кнопкой пункт **Tcpip**, выберите **Создать**, затем щелкните **Раздел**. После создания нового ключа реестра введите **QoS** и нажмите клавишу ВВОД, чтобы переименовать ключ.

5.  Щелкните правой кнопкой мыши **QoS**, выберите пункт **Создать**, затем щелкните **Строковый параметр**. После создания нового значения реестра введите "Не использовать **NLA"** и нажмите ввод, чтобы переименовать значение.

6.  Дважды щелкните элемент **Do no use NLA**. В **диалоговом окне** "Изменение  строки" введите **1** в поле данных "Значение" и нажмите кнопку **"ОК".**

7.  Закройте редактор реестра и перезагрузите компьютер.

### <a name="configure-quality-of-service-on-computers-with-multiple-network-adapters"></a>Настройка качества обслуживания на компьютерах с несколькими сетевыми адаптерами

Если у вас есть компьютер с несколькими сетевыми адаптерами, иногда могут возникнуть проблемы, в которых значения DSCP показываются как 0x00, а не заданные значения. Обычно это происходит на компьютерах, где одному или нескольким сетевым адаптерам не удается получить доступ к вашему домену Active Directory (например, если эти адаптеры используются в частной сети). В таких случаях значения DSCP помечаются для адаптеров, которые могут осуществить доступ к домену, и не помечаются для адаптеров, которым такой доступ получить не удается.

Если вы хотите пометить значения DSCP для всех сетевых адаптеров на компьютере, включая адаптеры, которые не имеют доступа к вашему домену, необходимо добавить и настроить значение в реестре. Это можно сделать посредством следующей процедуры:

1.  Нажмите кнопку **Пуск** и выберите пункт **Выполнить**.

2.  В **диалоговом** окне "Выполнить" введите **regedit** и нажмите ввод.

3.  В редакторе реестра развертка **HKEY \_ LOCAL \_ MACHINE,** развернуть **SYSTEM,** **развернуть CurrentControlSet,** развернуть службы, а затем развернуть **Tcpip**.

4.  Если вы не видите раздел реестра **QoS**, щелкните элемент **Tcpip** правой кнопкой мыши, выберите пункт **Создать** и пункт **Раздел**. После создания нового ключа введите **QoS** и нажмите клавишу ВВОД, чтобы переименовать ключ.

5.  Щелкните правой кнопкой мыши **QoS**, выберите пункт **Создать**, затем щелкните **Строковый параметр**. После создания нового значения реестра введите "Не использовать **NLA"** и нажмите ввод, чтобы переименовать значение.

6.  Дважды щелкните элемент **Do no use NLA**. В **диалоговом окне** "Изменение  строки" введите **1** в поле данных "Значение" и нажмите кнопку **"ОК".**

После создания и настройки нового значения реестра необходимо перезагрудить компьютер, чтобы изменения вступили в силу.

## <a name="see-also"></a>См. также

[Создание объекта групповой политики в Windows 10](https://docs.microsoft.com/windows/security/threat-protection/windows-firewall/create-a-group-policy-object)
