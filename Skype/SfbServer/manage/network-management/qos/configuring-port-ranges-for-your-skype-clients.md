---
title: Настройка диапазонов портов и политика качества обслуживания для клиентов
ms.reviewer: ''
ms:assetid: 287d5cea-7ada-461c-9b4a-9da2af315e71
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ204760(v=OCS.15)
ms:contentKeyID: 48183694
mtps_version: v=OCS.15
ms.author: v-mahoffman
author: HowlinWolf-92
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
description: В этой статье описывается настройка диапазонов портов для клиентов и настройка политик качества обслуживания в Skype для бизнеса Server для клиентов, работающих Windows 10.
ms.openlocfilehash: 5fa7a425bbb734307b487f63aa7fdf809f627661
ms.sourcegitcommit: 67324fe43f50c8414bb65c52f5b561ac30b52748
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2021
ms.locfileid: "60860076"
---
# <a name="configuring-port-ranges-and-a-quality-of-service-policy-for-your-clients-in-skype-for-business-server"></a>Настройка диапазонов портов и политика качества обслуживания для клиентов в Skype для бизнеса Server

В этой статье описывается настройка диапазонов портов для клиентов и настройка политик качества обслуживания в Skype для бизнеса Server для клиентов, работающих Windows 10.

## <a name="configure-port-ranges"></a>Настройка диапазонов портов

По умолчанию Skype для бизнеса клиентские приложения могут использовать любой порт между портами 1024 и 65535 при вовлечении в сеанс связи; это происходит из-за того, что определенные диапазоны портов автоматически не включены для клиентов. Однако для использования качества службы необходимо перенаделить различные типы трафика (аудио, видео, мультимедиа, общий доступ к приложениям и передача файлов) в ряд уникальных диапазонов портов. Это можно сделать с помощью Set-CsConferencingConfiguration.

> [!NOTE]  
> Конечные пользователи не могут самостоятельно вносить эти изменения. Изменения порта могут вноситься только администраторами с помощью Set-CsConferencingConfiguration.


Вы можете определить, какие диапазоны портов в настоящее время используются для сеансов связи, запуская следующую команду из Skype для бизнеса Server командной оболочки:

**Get-CsConferencingConfiguration**

Предполагая, что с момента установки Skype для бизнеса Server параметров конференций вы не включите никаких изменений, необходимо получить сведения, включающие следующие значения свойств:

ClientMediaPortRangeEnabled : False<br/>
ClientAudioPort : 5350<br/>
ClientAudioPortRange : 40<br/>
ClientVideoPort : 5350<br/>
ClientVideoPortRange : 40<br/>
ClientAppSharingPort : 5350<br/>
ClientAppSharingPortRange : 40<br/>
ClientFileTransferPort : 5350<br/>
ClientTransferPortRange : 40<br/>

Если внимательно посмотреть на предыдущие данные, можно увидеть две важных вещи. Во-первых, для свойства ClientMediaPortRangeEnabled задано значение False:

**ClientMediaPortRangeEnabled : False**

Это важно, поскольку, когда это свойство заданной для False, Skype для бизнеса клиенты будут использовать любой доступный порт между портами 1024 и 65535 при вовлечении в сеанс связи; это верно независимо от других параметров порта (например, ClientMediaPort или ClientVideoPort). Если вы хотите ограничить использование определенного набора портов (и это то, что вы хотите сделать, если вы планируете реализовать качество службы), то сначала необходимо включить диапазоны клиентских медиа-портов. Это можно сделать с помощью следующей Windows PowerShell:

**Set-CsConferencingConfiguration-ClientMediaPortRangeEnabled $True**

Приведенная выше команда активирует диапазоны портов мультимедиа клиентов для глобальной коллекции параметров конфигурации конференций. Однако данные настройки также могут применяться к области сайта или службы (только для службы сервера конференций). Чтобы включить диапазоны портов мультимедиа клиентов для определенного сайта или сервера, укажите идентификатор этого сайта или сервера при вызове команды Set-CsConferencingConfiguration:

**Set-CsConferencingConfiguration -Identity "site:Redmond" -ClientMediaPortRangeEnabled $True**

Или же вы можете использовать следующую команду, чтобы одновременно включить диапазоны порты для всех параметров конфигурации конференций:

**Get-CsConferencingConfiguration | Set-CsConferencingConfiguration-ClientMediaPortRangeEnabled $True**

Второй важный момент — в примере выходных данных показано, что по умолчанию набор диапазонов портов мультимедиа для каждого типа сетевого трафика идентичны:

ClientAudioPort : 5350<br/>
ClientVideoPort : 5350<br/>
ClientAppSharingPort : 5350<br/>
ClientFileTransferPort : 5350<br/>

Чтобы реализовать QoS, каждый из этих диапазонов портов должен быть уникальным. Например, вы можете настроить следующие диапазоны портов:


<table>
<colgroup>
</colgroup>
<thead>
<tr class="header">
<th>Тип клиентского трафика</th>
<th>Начальный порт</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>"Audio" (Аудио);</p></td>
<td><p>50020</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Видео</p></td>
<td><p>58000</p></td>
<td><p>20</p></td>
</tr>
<tr class="odd">
<td><p>Общий доступ к приложениям</p></td>
<td><p>42000</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>


В приведенной выше таблице диапазоны портов клиента представляют подмножество диапазонов портов, настроенных для ваших серверов. Например, на серверах для совместного использования приложений были настроены порты с 40803 по 49151. Это также делается в первую очередь для упростить администрирование QoS: клиентские порты не должны представлять подмножество портов, используемых на сервере. (Например, на клиентских компьютерах можно настроить общий доступ к приложениям для использования, скажем, портов от 10000 до 10019.) Однако рекомендуется сделать клиентский порт диапазоном подмножество диапазонов портов сервера.

Кроме того, вы могли заметить, что 8348 портов было выделено для совместного использования приложений на серверах, но всего 20 портов было выделено для совместного использования приложений на клиентах. Это также рекомендуется, но не является правилом жесткой и быстрой. Как правило, каждый доступный порт может представлять один сеанс связи: если в диапазоне портов доступно 100 портов, это означает, что компьютер, о которых идет речь, может участвовать в не более чем 100 сеансах связи в любой момент времени. Поскольку серверы, вероятно, будут участвовать в большем числе сеансов, чем клиенты, имеет смысл открыть намного больше портов на серверах, чем на клиентах. Выделение 20 портов для совместного использования приложений на клиентах означает, что пользователь одновременно может участвовать в 20 сеансах совместного применения приложений на указанном устройстве. Если должно быть достаточно для подавляющего большинства пользователей.

Чтобы назначить предыдущие диапазоны портов глобальной коллекции параметров конфигурации конференций, можно использовать следующую команду Skype для бизнеса Server Management Shell:

**Set-CsConferencingConfiguration -Identity global -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20**

Или с помощью этой команды можно назначить эти же диапазоны портов всем параметрам конфигурации конференций:

**Get-CsConferencingConfiguration | Set-CsConferencingConfiguration-ClientAudioPort 50020 -ClientAudioPortRange 20-ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20**

Отдельные пользователи должны выйти из Skype для бизнеса и войти обратно, прежде чем эти изменения действительно в силу.

> [!NOTE]  
> Вы также можете включить диапазоны портов мультимедиа клиентов, а затем назначить эти диапазоны портов с помощью одной команды. Например:<BR><CODE>Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20</CODE>

## <a name="configure-quality-of-service-policies-for-clients-running-on-windows-10"></a>Настройка политик качества обслуживания для клиентов, работающих на Windows 10

Помимо указания диапазонов портов для использования клиентами Skype для бизнеса, необходимо также создать отдельные политики качества обслуживания, которые будут применяться к клиентным компьютерам. (Политики качества служб, созданные для серверов conferencing, Application и Mediation, не должны применяться к клиентских компьютерам.) Эта информация применяется только к компьютерам, на Skype для бизнеса клиентом и Windows 10.

В следующем примере этот набор диапазонов портов используется для создания политики звука и политики видео:


<table>
<colgroup>
</colgroup>
<thead>
<tr class="header">
<th>Тип клиентского трафика</th>
<th>Начальный порт</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>"Audio" (Аудио);</p></td>
<td><p>50020</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Видео</p></td>
<td><p>58000</p></td>
<td><p>20</p></td>
</tr>
<tr class="odd">
<td><p>Общий доступ к приложениям</p></td>
<td><p>42000</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>

Чтобы создать политику качества звука службы для Windows 10 компьютеров, сначала войдите на компьютер, на котором установлено управление групповой политикой. Откройте управление групповой политикой (нажмите **кнопку Начните,** указать на **административные** средства, а затем нажмите кнопку **Управление** групповой политикой), а затем выполните следующую процедуру:

1.  В консоли управления групповыми политиками найдите контейнер, в котором следует создать новую политику. Например, если все клиентские компьютеры находятся в OU с именем Customers, новая политика должна быть создана в клиентской OU.

2.  Щелкните правой кнопкой мыши соответствующий контейнер, а затем **нажмите кнопку Создать GPO в** этом домене, и ссылка его здесь .

3.  В **диалоговом** окне New GPO введите имя нового объекта групповой политики в поле **Имя** и нажмите **кнопку ОК.**

4.  Щелкните правой кнопкой мыши вновь созданную политику и нажмите кнопку **Изменить**.

5.  В редакторе управления групповой политикой **расширйте** конфигурацию **компьютера,** Windows Параметры, щелкните правой кнопкой мыши **QoS** на основе политики, а затем нажмите **кнопку Создать новую политику**.

6.  В **диалоговом окне QoS** на основе политики на странице открытия введите имя новой политики в поле **Имя.** Выберите поле **Укажите значение DSCP** и установите значение **46**. Оставьте поле **Укажите частоту передачи** пустым и нажмите кнопку **Далее**.

7.  На следующей странице выберите только приложения с этим исполняемым именем, **введите** Lync.exeимя, а затем нажмите **кнопку Далее**. Этот параметр предписывает политике только приоритизировать соответствие трафику Skype для бизнеса клиента.

8.  На третьей странице убедитесь, что выбраны  любой исходный **IP-адрес** и любой IP-адрес назначения, а затем нажмите **кнопку Далее**. Эти два параметра гарантируют, что пакеты будут управляться независимо от того, с какого компьютера (IP-адреса) отправляются эти пакеты, и какой компьютер (IP-адрес) будет получать эти пакеты.

9.  На четвертой странице выберите **TCP и UDP** в раскрывающемся списке **Выберите протокол, к которому применяется политика QoS**. TCP (Протокол управления передачей) и UDP (User Datagram Protocol) — это два сетевых протокола, наиболее часто используемых Skype для бизнеса Server и его клиентских приложений.

10. В разделе **Укажите номер исходного порта** выберите **От этого исходного порта или диапазона**. В сопутствующем текстовом поле введите диапазон портов, зарезервированный для передачи звука. Например, если вы зарезервировали для звукового трафика порты от 50020 до 50039, укажите этот диапазон портов в следующем формате: **50020:50039**. Нажмите кнопку **Готово**.

После создания политики QoS для звука следует создать вторую политику для видео. Для этого выполните ту же основную процедуру, которой вы следовали при создании политики для аудио, внеся следующие изменения.

  - Используйте другое (и уникальное) имя политики.

  - Для значения DSCP вместо 46 укажите **34**. (Как было отмечено ранее, вы не обязаны использовать значение DSCP 34; просто назначьте для видео значение DSCP, отличное от значения для аудио.)

  - Используйте ранее настроенный диапазон портов для видео-трафика. Например, если для видео зарезервированы порты от 58000 до 58019, установите диапазон порта: **58000:58019**.

Если вы решили создать политику управления трафиком общего доступа к приложениям, сделайте эти замены:

  - Используйте другое (и уникальное) имя политики (например, **Skype для бизнеса Server совместное использование приложений).**

  - Для значения DSCP вместо 46 укажите **24**. (Опять же, это значение не должно быть равно 24, оно просто должно отличаться от значений DSCP, используемых для аудио и видео.)

  - Используйте ранее настроенный диапазон портов для видео-трафика. Например, если вы зарезервировали порты с 42000 по 42019 для общего доступа к приложениям, установите диапазон портов таким образом: **42000:42019**.

Для политики передачи файлов

  - Используйте другое (и уникальное) имя политики (например, **Skype для бизнеса Server передачи файлов).**

  - Установите значение DSCP, равное **14**. (Опять же, это значение не должно быть равно именно 14, оно просто должно быть уникальным кодом DSCP.)

  - Используйте ранее настроенный диапазон портов для приложения. Например, если вы зарезервировали порты 42020 до 42039 для общего доступа к приложениям, установите диапазон портов таким образом: **42020:42039**.

Новые политики не будут действовать, пока не обновится групповая политика на клиентских компьютерах. Хотя групповая политика периодически обновляется сама по себе, можно принудительно вызвать немедленное обновление, выполнив на каждом компьютере, на котором требуется обновление групповой политики, следующую команду:

**Gpupdate.exe /force**

Эту команду можно выполнить из любого окна командной строки, запущенного с учетными данными администратора. Чтобы запустить командное окно с учетными данными администратора, нажмите кнопку **Пуск**, щелкните правой кнопкой мыши пункт **Командная строка** и выберите команду **Запуск от имени администратора**.

Помните, что эти политики должны быть направлены на ваши клиентские компьютеры. Они не должны применяться к серверам, работающим Skype для бизнеса Server.

Чтобы обеспечить отметку сетевых пакетов соответствующим значением DSCP, необходимо также создать новый раздел реестра, выполнив следующую процедуру:

1.  Нажмите кнопку **Пуск** и выберите пункт **Выполнить**.

2.  В **диалоговом** окне Run введите **regedit** и нажмите кнопку ENTER.

3.  В редакторе реестра раздвяйте локализатор **HKEY, \_ \_** расширйте **SYSTEM,** расширйте **CurrentControlSet,** расширяйте службы, а затем **расширяйте Tcpip**.

4.  Щелкните правой кнопкой пункт **Tcpip**, выберите **Создать**, затем щелкните **Раздел**. После создания нового ключа реестра введите **QoS** и нажмите кнопку ENTER, чтобы переименовать ключ.

5.  Щелкните правой кнопкой мыши **QoS**, выберите пункт **Создать**, затем щелкните **Строковый параметр**. После создания нового значения реестра введите Не **используйте NLA,** а затем нажмите кнопку ENTER, чтобы переименовать значение.

6.  Дважды щелкните элемент **Do no use NLA**. В **диалоговом окне Изменить строку** введите **1** в поле **данных Значение,** а затем нажмите **кнопку ОК**.

7.  Закройте редактор реестра и перезагрузите компьютер.

### <a name="configure-quality-of-service-on-computers-with-multiple-network-adapters"></a>Настройка качества обслуживания на компьютерах с помощью нескольких сетевых адаптеров

Если у вас есть компьютер с несколькими сетевыми адаптерами, иногда можно запускать проблемы, в которых значения DSCP показаны как 0x00, а не настроено. Обычно это происходит на компьютерах, где одному или нескольким сетевым адаптерам не удается получить доступ к вашему домену Active Directory (например, если эти адаптеры используются в частной сети). В таких случаях значения DSCP помечаются для адаптеров, которые могут осуществить доступ к домену, и не помечаются для адаптеров, которым такой доступ получить не удается.

Если вы хотите отметить значения DSCP для всех сетевых адаптеров на компьютере, включая адаптеры, которые не имеют доступа к вашему домену, необходимо добавить и настроить значение в реестр. Это можно сделать посредством следующей процедуры:

1.  Нажмите кнопку **Пуск** и выберите пункт **Выполнить**.

2.  В **диалоговом** окне Run введите **regedit** и нажмите кнопку ENTER.

3.  В редакторе реестра раздвяйте локализатор **HKEY, \_ \_** расширйте **SYSTEM,** расширйте **CurrentControlSet,** расширяйте службы, а затем **расширяйте Tcpip**.

4.  Если вы не видите раздел реестра **QoS**, щелкните элемент **Tcpip** правой кнопкой мыши, выберите пункт **Создать** и пункт **Раздел**. После создания нового ключа введите **QoS** и нажмите кнопку ENTER, чтобы переименовать ключ.

5.  Щелкните правой кнопкой мыши **QoS**, выберите пункт **Создать**, затем щелкните **Строковый параметр**. После создания нового значения реестра введите Не **используйте NLA,** а затем нажмите кнопку ENTER, чтобы переименовать значение.

6.  Дважды щелкните элемент **Do no use NLA**. В **диалоговом окне Изменить строку** введите **1** в поле **данных Значение,** а затем нажмите **кнопку ОК**.

После создания и настройки нового значения реестра необходимо будет перезагрудить компьютер, чтобы изменения вступили в силу.

## <a name="see-also"></a>См. также

[Создание объекта групповой политики в Windows 10](/windows/security/threat-protection/windows-firewall/create-a-group-policy-object)
