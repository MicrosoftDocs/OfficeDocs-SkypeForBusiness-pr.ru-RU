---
title: Настройка диапазонов портов и политики качества обслуживания для клиентов
ms.reviewer: ''
ms:assetid: 287d5cea-7ada-461c-9b4a-9da2af315e71
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ204760(v=OCS.15)
ms:contentKeyID: 48183694
mtps_version: v=OCS.15
ms.author: jambirk
author: jambirk
manager: serdars
ms.audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
description: В этой статье описывается настройка диапазонов портов для клиентов и настройка политики качества обслуживания в Скайп для Business Server для клиентов, работающих на Windows 10.
ms.openlocfilehash: 2e5328406634302a1b076eec8466e7f7b9245150
ms.sourcegitcommit: 111bf6255fa877b3fce70fa8166e8ec5a6643434
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32219725"
---
# <a name="configuring-port-ranges-and-a-quality-of-service-policy-for-your-clients-in-skype-for-business-server"></a>Настройка диапазонов портов и политики качества обслуживания для клиентов в Скайп для Business Server

В этой статье описывается настройка диапазонов портов для клиентов и настройка политики качества обслуживания в Скайп для Business Server для клиентов, работающих на Windows 10.

## <a name="configure-port-ranges"></a>Настройка диапазонов портов

По умолчанию, Скайп для бизнес-клиентского приложения можно использовать любой порт между порты 1024 до 65535 при участвующих в сеансах связи; Это, так как диапазоны портов автоматически не включены для клиентов. Чтобы использовать качества обслуживания, тем не менее, необходимо будет переназначать различные типы трафика (аудио, видео, мультимедиа, общий доступ к приложениям и передачи файлов) в набор диапазонов портов уникальный. Это можно сделать с помощью командлета Set-CsConferencingConfiguration.

> [!NOTE]  
> Конечные пользователи не могут выполнить эти изменения сами. Порт изменения можно выполнить только администраторами с помощью командлета Set-CsConferencingConfiguration.


Можно определить, какие диапазоны портов используются в текущий момент для сеансов связи, выполнив следующую команду в Скайп для консоли Business Server:

    Get-CsConferencingConfiguration

Если предполагается, что вы не вносили изменений в параметры конференц-связи с момента установки Скайп для Business Server, вы должны получить данные со следующими значениями свойств:

    ClientMediaPortRangeEnabled : False
    ClientAudioPort             : 5350
    ClientAudioPortRange        : 40
    ClientVideoPort             : 5350
    ClientVideoPortRange        : 40
    ClientAppSharingPort        : 5350
    ClientAppSharingPortRange   : 40
    ClientFileTransferPort      : 5350
    ClientTransferPortRange     : 40

Если внимательно изучите выше выходные данные, вы увидите два следующих аспекта важности. Во-первых параметры ClientMediaPortRangeEnabled свойству значение False:

    ClientMediaPortRangeEnabled : False

Важно, так как при задано значение False, Скайп для бизнеса клиенты будут использовать любой доступный порт между порты 1024 до 65535 при участвующих в сеансах связи; Это значение true, независимо от того, любые другие параметры порта (например, ClientMediaPort или ClientVideoPort). Если требуется ограничить использование указанного набора портов (и это то, что вы собираетесь выполнить при планировании реализации качества обслуживания), необходимо сначала включить диапазонов портов мультимедиа клиента. Который можно выполнить с помощью следующей команды Windows PowerShell:

    Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True

Приведенная выше команда включает клиента диапазонов портов мультимедиа для глобальной коллекции параметров конфигурации конференц-связи; Тем не менее эти параметры можно также применяются на уровне сайта и/или области службы (сервер конференций только для службы). Для включения клиентских портов, диапазонов для определенного сайта или сервера, укажите идентификатор этого сайта или сервера при вызове Set-CsConferencingConfiguration:

    Set-CsConferencingConfiguration -Identity "site:Redmond" -ClientMediaPortRangeEnabled $True

Кроме того чтобы одновременно включить диапазоны порты для всех параметров конфигурации конференц-связи можно использовать эту команду:

    Get-CsConferencingConfiguration | Set-CsConferencingConfiguration  -ClientMediaPortRangeEnabled $True

Второй важный момент — это что примере выходных данных показано, что по умолчанию для каждого типа сетевого трафика набор диапазонов портов мультимедиа идентичны:

    ClientAudioPort             : 5350
    ClientVideoPort             : 5350
    ClientAppSharingPort        : 5350
    ClientFileTransferPort      : 5350

Для реализации QoS, каждый из этих диапазонов портов необходимо быть уникальным. Например можно настроить диапазоны портов следующим образом:


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип клиентского трафика</th>
<th>Начальный порт</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Голосовая связь</p></td>
<td><p>50020</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Видеосвязь</p></td>
<td><p>58000</p></td>
<td><p>20</p></td>
</tr>
<tr class="odd">
<td><p>Общий доступ к приложениям</p></td>
<td><p>42000</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>


В приведенной выше таблице диапазоны портов клиента представляют набор диапазонов портов, настроенных для серверов. Например на серверах, совместное использование приложений был настроен для использования портов 40803 до 49151; на клиентских компьютерах совместное использование приложений настроен для использования портов 42000 через 42019. Слишком, это делается в первую очередь для упрощения администрирования QoS: порты на клиенте нет необходимости представляют поднабор портов, используемых на сервере. (Например, на клиентских компьютерах можно настроить общий доступ к приложениям для использования, например, порты 10000 через 10019.) Тем не менее, рекомендуется сделать клиент порт для диапазона подмножество диапазонов портов на сервере.

Кроме того вы могли заметить, что 8348 портов были выделяемых для совместного использования на серверах приложений, но только 20 портов были выделяемых для совместного использования на клиентских компьютерах. Это, слишком, рекомендуется, но не является hard-and-fast правила. Как правило, необходимо учитывать каждый доступный порт для представления сеанс связи одним: при наличии 100 портов в диапазоне портов, это означает, что этот компьютер может участвовать в, не более 100 сеансов связи в любой момент времени. Так как серверы вероятно будет принять участие в несколькими беседами более чем клиенты, имеет смысл откройте несколько других портов на серверах, чем на клиентах. Параметр сторону 20 портов для совместного использования на клиенте означает, что пользователи могут принимать участие в сеансах общего доступа к 20 приложения на указанном устройстве и все в то же время. Который должен быть достаточно для подавляющего большинства пользователей.

Чтобы назначить предыдущие диапазоны портов глобальной коллекции параметров конфигурации конференций, можно использовать следующие Скайп для командной консоли Business Server:

    Set-CsConferencingConfiguration -Identity global -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20

Или использовать эту команду, чтобы назначить эти же диапазоны портов для всех конференций параметров конфигурации:

    Get-CsConferencingConfiguration | Set-CsConferencingConfiguration -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20

Отдельные пользователи должны выйти Скайп для бизнеса и снова войдите в систему перед эти изменения вступили в силу.

> [!NOTE]  
> Можно также включить диапазонов портов мультимедиа клиента и назначьте этих диапазонов портов с помощью одной команды. Например:<BR><CODE>Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20</CODE>

## <a name="configure-quality-of-service-policies-for-clients-running-on-windows-10"></a>Настройка политики качества обслуживания для клиентов, работающих на Windows 10

Кроме возможности задания диапазонов портов для использования с вашей Скайп пользователей, необходимо также создать отдельные политики качества обслуживания, которые будут применяться к клиентским компьютерам. (Не следует применять политики качества обслуживания, созданные для серверов конференц-связи, приложений и посредника на клиентских компьютерах). Эта информация относится только на компьютерах под управлением Скайп для клиента Business и Windows 10.

В следующем примере этот набор диапазонов портов используется для создания политики звука и политики видео:


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип клиентского трафика</th>
<th>Начальный порт</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Голосовая связь</p></td>
<td><p>50020</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Видеосвязь</p></td>
<td><p>58000</p></td>
<td><p>20</p></td>
</tr>
<tr class="odd">
<td><p>Общий доступ к приложениям</p></td>
<td><p>42000</p></td>
<td><p>20</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>

Для создания политики звука качества обслуживания для компьютеров Windows 10, сначала Войдите на компьютер, где была установлена консоль Управление групповой политикой. Откройте консоль Управление групповой политикой (нажмите кнопку **Пуск**, выберите пункт **Администрирование**и выберите **Управление групповой политикой**), а затем выполните следующие действия:

1.  В консоли Управление групповой политикой Найдите контейнер, где должен быть создан новой политики. Например если на клиентских компьютерах, находятся в Подразделении с именем клиенты, новой политики должны быть созданы в Подразделения клиента.

2.  Щелкните правой кнопкой мыши соответствующий контейнер и нажмите кнопку **создать объект GPO в этом домене и связать его**.

3.  В диалоговом окне **Новый объект групповой Политики** в поле **имя** введите имя для нового объекта групповой политики и нажмите кнопку **ОК**.

4.  Щелкните правой кнопкой мыши созданную политику и нажмите кнопку **Изменить**.

5.  В редакторе управления групповой политики разверните узлы **Конфигурация компьютера**, параметры **Windows**, щелкните правой кнопкой мыши **QoS на основе политики**и выберите команду **Создать новую политику**.

6.  В диалоговом окне **QoS на основе политики** на первой странице введите имя новой политики в поле **имя** . Выберите **Укажите значение DSCP** и задайте значение **46**. Оставьте в поле **Укажите исходящих частоту передачи** не выбран и нажмите кнопку **Далее**.

7.  На следующей странице убедитесь в том, что выбран пункт **все приложения** и нажмите кнопку **Далее**. Этот параметр указывает сети для поиска всех пакетов с помощью разметки DSCP 46, не только пакетов, созданный с конкретного приложения.

8.  На странице третий убедитесь, что выбраны **все исходный IP-адрес** и **любой конечный IP-адрес** и нажмите кнопку **Далее**. Эти два параметра убедитесь, что пакеты будут управляться независимо от того, какой компьютер пакеты отправляемых (IP-адрес) и (IP-адрес) компьютер, который будет получать эти пакеты.

9.  На странице четырех выберите в раскрывающемся списке **выберите протокол, к которому применяется данная политика качества обслуживания для** **TCP и UDP-ПОРТ** . TCP (Transmission Control Protocol) и UDP-ПОРТ (протокол) — это два сетевых протоколов, чаще всего используемые Скайп Business Server и его клиентских приложений.

10. В разделе **Укажите номер порта источника**выберите выберите **этот исходный порт или диапазон**. В соответствующем текстовом поле введите диапазон портов зарезервированы для передачи звука. Например, если зарезервированные порты 50020 через порты 50039 для трафика аудио введите диапазон портов, используя следующий формат: **50020:50039**. Нажмите **Готово**.

После создания политики качества обслуживания для аудио следует затем создайте второй политики для видео. Создание политики для видео, выполните ту же основную процедуру, были выполнены при создании политики звука, что следующие изменения:

  - Используйте разные (и уникальное) имя политики.

  - Установите значение DSCP **34** вместо 46. (Как указывалось ранее, нет необходимости использовать значение DSCP 34, просто необходимо назначить разные значения DSCP от того, используемых для совершения).

  - Используйте диапазон портов ранее настроенные для видео-трафика. Например, если зарезервированные порты 58000 через 58019 для видео, необходимо задать диапазон портов на этот: **58000:58019**.

Если вы решите создать политику для управления трафика совместного использования приложений, внесите следующие изменения.

  - Используйте другое (и уникальное) политики имя (например, **Скайп для Business Server общий доступ к приложениям**).

  - Задайте значение DSCP **24** вместо 46. (Еще раз, это значение не должен быть 24; он просто должно отличаться от значения DSCP, используемые для аудио и видео).

  - Используйте диапазон портов ранее настроенные для видео-трафика. Например, если зарезервированные порты 42000 через 42019 для общего доступа к приложениям, необходимо задать диапазон портов на этот: **42000:42019**.

Для политики передачи файлов:

  - Используйте другое (и уникальное) политики имя (например, **Скайп для передачи файлов Business Server**).

  - Установите значение DSCP **14**. (Еще раз, это значение не должен быть 14; он просто должен быть уникальный код DSCP).

  - Используйте диапазон портов ранее настроенные для приложения. Например, если зарезервированные порты 42020 через 42039 для общего доступа к приложениям, необходимо задать диапазон портов на этот: **42020:42039**.

Новые политики, созданные вами, не вступят в силу только после обновления групповой политики на клиентских компьютерах. Хотя групповая политика периодически обновляется сама, вы можете обновить ее принудительно, запустив на каждом нужном компьютере следующую команду.

    Gpudate.exe /force

Команду можно выполнить в любом командном окне, запущенном от имени администратора. Чтобы открыть такое окно с правами администратора, в меню **Пуск** правой кнопкой мыши щелкните **Командная строка** и выберите пункт **Запуск от имени администратора**.

Имейте в виду, что эти политики нацелить нужно достигло предельного на клиентских компьютерах. Они не применимы к серверам с Скайп для Business Server.

Чтобы обеспечить, что сетевых пакетов соответствующим значением DSCP, следует также создать новый раздел реестра на каждом компьютере, выполнив следующую процедуру:

1.  В меню **Пуск** выберите пункт **Выполнить**.

2.  В диалоговом окне **выполнить** введите **regedit**и нажмите клавишу ВВОД.

3.  В редакторе реестра разверните **HKEY\_ЛОКАЛЬНОГО\_МАШИНЫ**, разверните узлы **системы**, разверните **CurrentControlSet**, разверните узел **службы**и затем **Tcpip**.

4.  Щелкните правой кнопкой мыши **Tcpip**, выберите команду **Создать**и затем щелкните **раздел**. После создания нового раздела реестра введите **качества обслуживания**и нажмите клавишу ВВОД, чтобы переименовать раздел.

5.  Щелкните правой кнопкой мыши **QoS**, выберите команду **Создать**и затем **Строковый параметр**. После создания нового значения реестра введите **не используйте NLA**и нажмите клавишу ВВОД, чтобы переименовать значение.

6.  Дважды щелкните **не использовать NLA**. В диалоговом окне **Изменение строкового параметра** в поле **значение** введите **1** и нажмите кнопку **ОК**.

7.  Закройте редактор реестра и eboot компьютер.

### <a name="configure-quality-of-service-on-computers-with-multiple-network-adapters"></a>Настройка качества обслуживания на компьютерах с несколькими сетевыми адаптерами

Если у вас есть компьютер с несколькими сетевыми адаптерами, могут иногда выполняются в проблемы, где отображаются значения DSCP следующим 0x00 вместо значения, настроенные. Обычно это происходит на компьютерах, где один или несколько сетевых адаптеров, не могут получить доступ к вашего домена Active Directory (например, если эти адаптеры используются для частной сети). В тех случаях, как будет помечен значения DSCP для сетевых адаптеров, которые могут получить доступ к домену, но не будет помечен для сетевых адаптеров, которые не могут получить доступ к домену.

Если вы хотите значения DSCP тегов для всех сетевых адаптеров на компьютер, включая адаптеры, у которых нет доступа к домену, необходимо добавить и настроить значение в реестр. Который может выполняться, выполнив следующую процедуру:

1.  В меню **Пуск** выберите пункт **Выполнить**.

2.  В диалоговом окне **выполнить** введите **regedit**и нажмите клавишу ВВОД.

3.  В редакторе реестра разверните **HKEY\_ЛОКАЛЬНОГО\_МАШИНЫ**, разверните узлы **системы**, разверните **CurrentControlSet**, разверните узел **службы**и затем **Tcpip**.

4.  Если раздел реестра меткой **QoS** , затем щелкните правой кнопкой мыши **Tcpip**не отображаются, выберите команду **Создать**и щелкните **раздел**. После создания нового ключа введите **качества обслуживания**и нажмите клавишу ВВОД, чтобы переименовать раздел.

5.  Щелкните правой кнопкой мыши **QoS**, выберите команду **Создать**и затем **Строковый параметр**. После создания нового значения реестра введите **не используйте NLA**и нажмите клавишу ВВОД, чтобы переименовать значение.

6.  Дважды щелкните **не использовать NLA**. В диалоговом окне **Изменение строкового параметра** в поле **значение** введите **1** и нажмите кнопку **ОК**.

После создания и настройки нового значения реестра, необходимо перезагрузить компьютер, чтобы изменения вступили в силу.

## <a name="see-also"></a>См. также

[Создание объекта групповой политики в Windows 10](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-firewall/create-a-group-policy-object)
