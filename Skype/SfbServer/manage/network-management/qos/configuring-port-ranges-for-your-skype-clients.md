---
title: Настройка диапазонов портов и политики качества обслуживания для клиентов
ms.reviewer: ''
ms:assetid: 287d5cea-7ada-461c-9b4a-9da2af315e71
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ204760(v=OCS.15)
ms:contentKeyID: 48183694
mtps_version: v=OCS.15
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
description: В этой статье описывается настройка диапазонов портов для клиентов и Настройка политик качества обслуживания в Skype для бизнеса Server для клиентов, работающих под управлением Windows 10.
ms.openlocfilehash: 95fe768333a01aff165e74eec334f14bf23d69dc
ms.sourcegitcommit: 88a16c09dd91229e1a8c156445eb3c360c942978
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2020
ms.locfileid: "42045892"
---
# <a name="configuring-port-ranges-and-a-quality-of-service-policy-for-your-clients-in-skype-for-business-server"></a>Настройка диапазонов портов и политики качества обслуживания для клиентов в Skype для бизнеса Server

В этой статье описывается настройка диапазонов портов для клиентов и Настройка политик качества обслуживания в Skype для бизнеса Server для клиентов, работающих под управлением Windows 10.

## <a name="configure-port-ranges"></a>Настройка диапазонов портов

По умолчанию клиентские приложения Skype для бизнеса могут использовать любой порт между портами 1024 и 65535 при включении в сеанс связи; Это связано с тем, что для определенных диапазонов портов не включены автоматически клиенты. Однако для использования качества обслуживания необходимо переназначить различные типы трафика (аудио, видео, мультимедиа, общий доступ к приложениям и передачу файлов) для ряда уникальных диапазонов портов. Это можно сделать с помощью командлета Set – CsConferencingConfiguration.

> [!NOTE]  
> Конечные пользователи не могут вносить эти изменения самостоятельно. Изменения портов могут выполняться только администраторами с помощью командлета Set – CsConferencingConfiguration.


Вы можете определить, какие диапазоны портов используются в данный момент для сеансов связи, выполнив следующую команду в командной консоли Skype для бизнеса Server:

    Get-CsConferencingConfiguration

Если вы не внесли какие-либо изменения в параметры конференц-связи после того, как вы установили Skype для бизнеса Server, вам следует получить сведения, содержащие следующие значения свойств:

    ClientMediaPortRangeEnabled : False
    ClientAudioPort             : 5350
    ClientAudioPortRange        : 40
    ClientVideoPort             : 5350
    ClientVideoPortRange        : 40
    ClientAppSharingPort        : 5350
    ClientAppSharingPortRange   : 40
    ClientFileTransferPort      : 5350
    ClientTransferPortRange     : 40

Если внимательно посмотреть на предыдущие данные, можно увидеть две важных вещи. Во-первых, для свойства ClientMediaPortRangeEnabled задано значение False:

    ClientMediaPortRangeEnabled : False

Это важно, так как если для этого свойства задано значение false, клиенты Skype для бизнеса будут использовать любой доступный порт между портами 1024 и 65535 при включении в сеанс связи; Это справедливо независимо от других параметров порта (например, ClientMediaPort или Клиентвидеопорт). Если вы хотите ограничить использование указанного набора портов (и это нужно сделать при планировании реализации качества обслуживания), необходимо сначала включить диапазоны портов клиента для передачи данных. Это можно сделать с помощью следующей команды Windows PowerShell:

    Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True

Приведенная выше команда активирует диапазоны портов мультимедиа клиентов для глобальной коллекции параметров конфигурации конференций. Однако данные настройки также могут применяться к области сайта или службы (только для службы сервера конференций). Чтобы включить диапазоны портов мультимедиа клиентов для определенного сайта или сервера, укажите идентификатор этого сайта или сервера при вызове команды Set-CsConferencingConfiguration:

    Set-CsConferencingConfiguration -Identity "site:Redmond" -ClientMediaPortRangeEnabled $True

Или же вы можете использовать следующую команду, чтобы одновременно включить диапазоны порты для всех параметров конфигурации конференций:

    Get-CsConferencingConfiguration | Set-CsConferencingConfiguration  -ClientMediaPortRangeEnabled $True

Второй важный момент — в примере выходных данных показано, что по умолчанию набор диапазонов портов мультимедиа для каждого типа сетевого трафика идентичны:

    ClientAudioPort             : 5350
    ClientVideoPort             : 5350
    ClientAppSharingPort        : 5350
    ClientFileTransferPort      : 5350

Чтобы реализовать QoS, каждый из этих диапазонов портов должен быть уникальным. Например, вы можете настроить следующие диапазоны портов:


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип клиентского трафика</th>
<th>Начальный порт</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>"Audio" (Аудио);</p></td>
<td><p>50020</p></td>
<td><p>двадцать</p></td>
</tr>
<tr class="even">
<td><p>Видео</p></td>
<td><p>58000</p></td>
<td><p>двадцать</p></td>
</tr>
<tr class="odd">
<td><p>Общий доступ к приложениям</p></td>
<td><p>42000</p></td>
<td><p>двадцать</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>двадцать</p></td>
</tr>
</tbody>
</table>


В приведенной выше таблице диапазоны портов клиента представляют подмножество диапазонов портов, настроенных для ваших серверов. Например, на серверах для совместного использования приложений были настроены порты с 40803 по 49151. Это также делается в первую очередь для упрощения администрирования QoS: портам клиентов не требуется предоставлять подмножество портов, используемых на сервере. (Например, на клиентских компьютерах вы можете настроить совместное использование приложений, например, порты 10000 – 10019.) Тем не менее, рекомендуется сделать диапазон портов клиента подмножеством диапазонов портов сервера.

Кроме того, вы могли заметить, что 8348 портов было выделено для совместного использования приложений на серверах, но всего 20 портов было выделено для совместного использования приложений на клиентах. Это также рекомендуется, но не является жестким и быстрым правилом. Как правило, вы можете считать каждый доступный порт для представления одного сеанса связи: Если в диапазоне портов имеется 100 портов, это означает, что компьютер, на котором приходится на вопрос, может участвовать в связи с 100 сеансов связи в любой конкретный момент времени. Поскольку серверы, вероятно, будут участвовать в большем числе сеансов, чем клиенты, имеет смысл открыть намного больше портов на серверах, чем на клиентах. Выделение 20 портов для совместного использования приложений на клиентах означает, что пользователь одновременно может участвовать в 20 сеансах совместного применения приложений на указанном устройстве. Если должно быть достаточно для подавляющего большинства пользователей.

Чтобы назначить предыдущие диапазоны портов глобальной коллекции параметров конфигурации конференц-связи, можно использовать следующую команду командной консоли Skype для бизнеса Server:

    Set-CsConferencingConfiguration -Identity global -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20

Или с помощью этой команды можно назначить эти же диапазоны портов всем параметрам конфигурации конференций:

    Get-CsConferencingConfiguration | Set-CsConferencingConfiguration -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20

Отдельные пользователи должны выйти из Skype для бизнеса, а затем снова войти в систему, чтобы эти изменения вступили в силу.

> [!NOTE]  
> Вы также можете включить диапазоны портов мультимедиа клиентов, а затем назначить эти диапазоны портов с помощью одной команды. Например:<BR><CODE>Set-CsConferencingConfiguration -ClientMediaPortRangeEnabled $True -ClientAudioPort 50020 -ClientAudioPortRange 20 -ClientVideoPort 58000 -ClientVideoPortRange 20 -ClientAppSharingPort 42000 -ClientAppSharingPortRange 20 -ClientFileTransferPort 42020 -ClientFileTransferPortRange 20</CODE>

## <a name="configure-quality-of-service-policies-for-clients-running-on-windows-10"></a>Настройка политик качества обслуживания для клиентов, работающих в Windows 10

Кроме указания диапазонов портов для использования клиентами Skype для бизнеса, необходимо также создать отдельные политики качества обслуживания, которые будут применяться к клиентским компьютерам. (Политики качества обслуживания, созданные для конференц-связи, приложений и серверов-посредников, не должны применяться к клиентским компьютерам.) Эти сведения относятся только к компьютерам, на которых работает клиент Skype для бизнеса и Windows 10.

В следующем примере этот набор диапазонов портов используется для создания политики звука и политики видео:


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип клиентского трафика</th>
<th>Начальный порт</th>
<th>Диапазон портов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>"Audio" (Аудио);</p></td>
<td><p>50020</p></td>
<td><p>двадцать</p></td>
</tr>
<tr class="even">
<td><p>Видео</p></td>
<td><p>58000</p></td>
<td><p>двадцать</p></td>
</tr>
<tr class="odd">
<td><p>Общий доступ к приложениям</p></td>
<td><p>42000</p></td>
<td><p>двадцать</p></td>
</tr>
<tr class="even">
<td><p>Передача файлов</p></td>
<td><p>42020</p></td>
<td><p>двадцать</p></td>
</tr>
</tbody>
</table>

Чтобы создать политику звука качества обслуживания для компьютеров с Windows 10, сначала выполните вход на компьютер, на котором установлена консоль управления групповыми политиками. Откройте компонент "Управление групповыми политиками" (нажмите кнопку **Пуск**, выберите пункт **Администрирование**, а затем выберите **Управление групповой политикой**), а затем выполните следующую процедуру.

1.  В консоли управления групповыми политиками найдите контейнер, в котором следует создать новую политику. Например, если все клиентские компьютеры находятся в подразделении с именем "клиенты", Новая политика должна быть создана в подразделении клиента.

2.  Щелкните правой кнопкой мыши соответствующий контейнер и выберите команду **создать объект групповой политики в этом домене и связать его**.

3.  В диалоговом окне **Создание объекта групповой** политики введите имя нового объекта групповой политики в поле **имя** , а затем нажмите кнопку **ОК**.

4.  Щелкните правой кнопкой мыши только что созданную политику и выберите команду **изменить**.

5.  В редакторе управления групповыми политиками последовательно разверните узлы **Конфигурация компьютера**, **Параметры Windows**, щелкните правой кнопкой мыши **QoS на основе политики**, а затем выберите команду **создать новую политику**.

6.  В диалоговом окне **QoS на основе политики** на открывающей странице введите имя новой политики в поле **имя** . Выберите поле **Укажите значение DSCP** и установите значение **46**. Оставьте поле **Укажите частоту передачи** пустым и нажмите кнопку **Далее**.

7.  На следующей странице выберите **только приложения с именем исполняемого файла**, введите **Lync. exe** в качестве имени, а затем нажмите кнопку **Далее**. Этот параметр предписывает политике определять только приоритет трафика в клиенте Skype для бизнеса.

8.  На третьей странице убедитесь, что выбраны **все исходные IP-адрес** и **конечный IP-адрес** , а затем нажмите кнопку **Далее**. Эти два параметра гарантируют, что пакеты будут управляться независимо от того, с какого компьютера (IP-адреса) отправляются эти пакеты, и какой компьютер (IP-адрес) будет получать эти пакеты.

9.  На четвертой странице выберите **TCP и UDP** в раскрывающемся списке **Выберите протокол, к которому применяется политика QoS**. TCP (протокол управления передачей) и протокол UDP (User Datagram Protocol) — это два сетевых протокола, которые чаще всего используются в Skype для бизнеса Server и его клиентских приложениях.

10. В разделе **Укажите номер исходного порта** выберите **От этого исходного порта или диапазона**. В сопутствующем текстовом поле введите диапазон портов, зарезервированный для передачи звука. Например, если вы зарезервировали для звукового трафика порты от 50020 до 50039, укажите этот диапазон портов в следующем формате: **50020:50039**. Нажмите кнопку **Готово**.

После создания политики QoS для звука следует создать вторую политику для видео. Для этого выполните ту же основную процедуру, которой вы следовали при создании политики для аудио, внеся следующие изменения.

  - Используйте другое (и уникальное) имя политики.

  - Для значения DSCP вместо 46 укажите **34**. (Как было отмечено ранее, вы не обязаны использовать значение DSCP 34; просто назначьте для видео значение DSCP, отличное от значения для аудио.)

  - Используйте ранее настроенный диапазон портов для видеотрафика. Например, если для видео зарезервированы порты 58000 и 58019, задайте диапазон портов следующим образом: **58000:58019**.

Если вы решили создать политику для управления трафиком общего доступа к приложениям, выполните следующие подстановки:

  - Используйте другое (и уникальное) имя политики (например, **общий доступ к приложениям Skype для бизнеса Server**).

  - Для значения DSCP вместо 46 укажите **24**. (Опять же, это значение не должно быть равно 24, оно просто должно отличаться от значений DSCP, используемых для аудио и видео.)

  - Используйте ранее настроенный диапазон портов для видеотрафика. Например, если у вас есть зарезервированные порты 42000 – 42019 для общего доступа к приложениям, задайте диапазон портов следующим образом: **42000:42019**.

Для политики передачи файлов

  - Используйте другое (и уникальное) имя политики (например, **Перенос файлов в Skype для бизнеса Server**).

  - Установите значение DSCP, равное **14**. (Опять же, это значение не должно быть равно именно 14, оно просто должно быть уникальным кодом DSCP.)

  - Используйте ранее настроенный диапазон портов для приложения. Например, если у вас есть зарезервированные порты 42020 – 42039 для общего доступа к приложениям, задайте диапазон портов следующим образом: **42020:42039**.

Новые политики не будут действовать, пока не обновится групповая политика на клиентских компьютерах. Хотя групповая политика периодически обновляется сама по себе, можно принудительно вызвать немедленное обновление, выполнив на каждом компьютере, на котором требуется обновление групповой политики, следующую команду:

    Gpupdate.exe /force

Эту команду можно выполнить из любого окна командной строки, запущенного с учетными данными администратора. Чтобы запустить командное окно с учетными данными администратора, нажмите кнопку **Пуск**, щелкните правой кнопкой мыши пункт **Командная строка** и выберите команду **Запуск от имени администратора**.

Помните, что эти политики должны быть направлены на ваши клиентские компьютеры. Их не следует применять к серверам, на которых работает Skype для бизнеса Server.

Чтобы обеспечить отметку сетевых пакетов соответствующим значением DSCP, необходимо также создать новый раздел реестра, выполнив следующую процедуру:

1.  Нажмите кнопку **Пуск** и выберите пункт **Выполнить**.

2.  В диалоговом окне **выполнить** введите **regedit**и нажмите клавишу ВВОД.

3.  В редакторе реестра разверните узел **hKey\_Local\_Machine**, **система**, разверните **CurrentControlSet**, разверните узел **службы**, а затем разверните **TCP/IP**.

4.  Щелкните правой кнопкой пункт **Tcpip**, выберите **Создать**, затем щелкните **Раздел**. После создания нового раздела реестра введите **QoS**и нажмите клавишу ВВОД, чтобы переименовать ключ.

5.  Щелкните правой кнопкой мыши **QoS**, выберите пункт **Создать**, затем щелкните **Строковый параметр**. После создания нового значения реестра введите **не использовать NLA**и нажмите клавишу ВВОД, чтобы переименовать значение.

6.  Дважды щелкните элемент **Do no use NLA**. В диалоговом окне **изменение строки** введите **1** в поле **значение** , а затем нажмите кнопку **ОК**.

7.  Закройте редактор реестра и ебут компьютер.

### <a name="configure-quality-of-service-on-computers-with-multiple-network-adapters"></a>Настройка качества обслуживания на компьютерах с несколькими сетевыми адаптерами

Если у вас есть компьютер с несколькими сетевыми адаптерами, может возникнуть проблема, когда значения DSCP отображаются как 0x00, а не заданное значение. Обычно это происходит на компьютерах, где одному или нескольким сетевым адаптерам не удается получить доступ к вашему домену Active Directory (например, если эти адаптеры используются в частной сети). В таких случаях значения DSCP помечаются для адаптеров, которые могут осуществить доступ к домену, и не помечаются для адаптеров, которым такой доступ получить не удается.

Если вы хотите пометить значения DSCP для всех сетевых адаптеров на компьютере, включая адаптеры, у которых нет доступа к вашему домену, необходимо добавить в реестр значение и настроить его. Это можно сделать посредством следующей процедуры:

1.  Нажмите кнопку **Пуск** и выберите пункт **Выполнить**.

2.  В диалоговом окне **выполнить** введите **regedit**и нажмите клавишу ВВОД.

3.  В редакторе реестра разверните узел **hKey\_Local\_Machine**, **система**, разверните **CurrentControlSet**, разверните узел **службы**, а затем разверните **TCP/IP**.

4.  Если вы не видите раздел реестра **QoS**, щелкните элемент **Tcpip** правой кнопкой мыши, выберите пункт **Создать** и пункт **Раздел**. После создания нового ключа введите **QoS**, а затем нажмите клавишу ВВОД, чтобы переименовать ключ.

5.  Щелкните правой кнопкой мыши **QoS**, выберите пункт **Создать**, затем щелкните **Строковый параметр**. После создания нового значения реестра введите **не использовать NLA**и нажмите клавишу ВВОД, чтобы переименовать значение.

6.  Дважды щелкните элемент **Do no use NLA**. В диалоговом окне **изменение строки** введите **1** в поле **значение** , а затем нажмите кнопку **ОК**.

После создания и настройки нового значения реестра необходимо перезагрузить компьютер, чтобы изменения вступили в силу.

## <a name="see-also"></a>См. также

[Создание объекта групповой политики в Windows 10](https://docs.microsoft.com/windows/security/threat-protection/windows-firewall/create-a-group-policy-object)
