---
title: Отработка отказа для пула
ms.reviewer: ''
author: heidip
manager: serdars
ms.audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
description: .
ms.openlocfilehash: 809d0305eaa4c8e2197c5137a647ff9354cbf9bd
ms.sourcegitcommit: 111bf6255fa877b3fce70fa8166e8ec5a6643434
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32197802"
---
# <a name="failing-over-and-failing-back-a-pool-in-skype-for-business-server"></a>Сбоя свыше и после неудачной пула в Скайп для Business Server 

Используйте следующую процедуру, если не удалось выполнить один пул переднего плана и потребностей неисправный или пула, в котором возникла аварийная оперативный и требуется для восстановления обычного рабочего состояния развертывания. Также узнайте, как выполнить отработку отказа отказа и восстановления размещения пула пограничного сервера, используемого для Скайп для бизнеса федерации или федерации XMPP, или измените пограничного пула, связанного с пулом переднего плана.

- [Отработки отказа пула переднего плана](#fail-over-a-front-end-pool)
- [Восстановление после сбоя пула](#fail-back-a-pool)
- [Отработки отказа пограничного пула, используемого для Скайп для сервера федерации](#fail-over-the-edge-pool-used-for-skype-for-business-server-federation)
- [Отработки отказа пограничного пула, используемого для федерации XMPP в Скайп для Business Server](#fail-over-the-edge-pool-used-for-xmpp-federation-in-skype-for-business-server)
- [Восстановление после сбоя пограничного пула, используемого для Скайп для федерации Business Server или федерации XMPP](#fail-back-the-edge-pool-used-for-skype-for-business-server-federation-or-xmpp-federation)
- [Изменение пограничного пула, связанного с пулом переднего плана](#change-the-edge-pool-associated-with-a-front-end-pool)

## <a name="fail-over-a-front-end-pool"></a>Отработки отказа пула переднего плана

В этой процедуре Datacenter1 содержит пула Pool1 и пула Pool1 завершен с ошибкой. Необходимо переключиться в пул Pool2, расположенный в Datacenter2.

Большая часть работы для отработки отказа пула включает в себя отработки центрального хранилища управления, если это необходимо. Это важно, так как центральное хранилище управления должно функционировать при сбое пользователей пула.

Кроме того Если происходит сбой пула переднего плана, но по-прежнему работает пограничный пул на этом сайте, необходимо знать, используется ли пул пограничного пула, сбой которого как пул следующих прыжков. В этом случае необходимо изменить пограничный пул для использования в другой пул переднего плана до сбоя через сбоя пула переднего плана. Как изменить параметр следующего прыжка зависит от ли использование пограничного пула на том же сайте пограничный пул или другой сайт.

**Чтобы установить пограничный пул на использование пула следующего перехода на том же сайте**

1.  Откройте построитель топологий, щелкните правой кнопкой мыши пограничный пул, который необходимо изменить и выберите команду **Изменить свойства**.

2.  Нажмите кнопку **следующего прыжка**. Из **следующего прыжка пула:** выберите пул, в котором теперь будет использован как пул следующих прыжков.

3.  Нажмите **кнопку ОК**, а затем опубликуйте изменения.

**Чтобы установить пограничный пул на использование пула следующего перехода на другой сайт**

1.  Откройте Скайп для окна консоли Business Server и введите следующий командлет:
    
        Set-CsEdgeServer -Identity EdgeServer:<Edge Server pool FQDN> -Registrar Registrar:<NextHopPoolFQDN>

**Чтобы обойти пул, в случае аварии**

1.  Узнать, какой пул узла для сервера централизованного управления, введя на сервере переднего плана в пуле Pool2 следующий командлет:
    
        Invoke-CsManagementServerFailover -Whatif
    
    Результаты Показать этот командлет, какой пул в настоящее время размещается центральный сервер управления. В оставшейся части этой процедуры этот пул называется CMS\_пула.

2.  Используйте построитель топологий для поиска версии Скайп Business Server, запущенные на CMS\_пула. Если он выполняется Скайп для сервера, используйте следующий командлет для поиска в резервный пул пула 1.
    
        Get-CsPoolBackupRelationship -PoolFQDN <CMS_Pool FQDN>
    
    Программа резервного копирования\_пула будет пул.

3.  Проверьте состояние центрального хранилища управления с помощью следующего командлета:
    
        Get-CsManagementStoreReplicationStatus -CentralManagementStoreStatus 
    
    Этот командлет необходимо показать, что указывает указывают ли ActiveMasterFQDN и ActiveFileTransferAgents на полное доменное имя CMS\_пула. Если они являются пустыми, центральный сервер управления недоступен и его необходимо отработки отказа.

4.  Если центральное хранилище управления недоступен или если центральное хранилище управления работала в пуле Pool1 (то есть пула, в котором не удалось выполнить), необходимо отработки отказа центральный сервер управления перед отработка отказа для пула. Если вам потребуется выполнить отработку отказа сервера централизованного управления, который размещен в пуле, выполнив Скайп для Business Server, командлет на шаге 5 данной процедуры. Если не требуется выполнить отработку отказа сервера централизованного управления, перейдите к действию 7 этой процедуры.

5.  Отработки отказа хранилища в пуле, выполнив Скайп для Business Server, выполните следующие действия.
    
      - Для начала проверьте какие Тыловой сервер в резервной копии\_пул работает экземпляр-субъект из центрального хранилища управления, введя следующее:
        
            Get-CsDatabaseMirrorState -DatabaseType Centralmgmt -PoolFqdn <Backup_Pool Fqdn>
    
      - Если Тыловой сервер в резервной копии\_пула — это тип субъекта,:
        
            Invoke-CSManagementServerFailover -BackupSQLServerFqdn <Backup_Pool Primary BackEnd Server FQDN> -BackupSQLInstanceName <Backup_Pool Primary SQL Instance Name>
        
        Если зеркальный Тыловой сервер в резервной копии\_пула — это тип субъекта,:
        
            Invoke-CSManagementServerFailover -MirrorSQLServerFqdn <Backup_Pool Mirror BackEnd Server FQDN> -MirrorSQLInstanceName <Backup_Pool Mirror SQL Instance Name>
    
      - Проверьте, что отработки отказа сервера централизованного управления завершен. Введите следующую команду:
        
            Get-CsManagementStoreReplicationStatus -CentralManagementStoreStatus 
        
        Проверьте, что указывает указывают ли ActiveMasterFQDN и ActiveFileTransferAgents на полное доменное имя резервного копирования\_пула.
    
      - И, наконец Проверьте состояние реплики для всех серверов переднего плана, введя следующую команду:
        
            Get-CsManagementStoreReplicationStatus 
        
        Проверьте, что все реплики имеют значение True.
        
        Перейдите к действию 7 этой процедуры.

6.  Установите центральное хранилище управления на обратно End Server из резервной копии\_пула.
    
      - Во-первых выполните следующую команду:
        
        ``` 
        Install-CsDatabase -CentralManagementDatabase -Clean -SqlServerFqdn <Backup_Pool Back End Server FQDN> -SqlInstanceName rtc  
        ```
    
      - Выполните следующую команду на одном из сервера переднего плана серверы из резервной копии\_пула, чтобы переместить центральное хранилище управления:
        
            Move-CsManagementServer -ConfigurationFileName c:\CsConfigurationFile.zip -LisConfigurationFileName c:\CsLisConfigurationFile.zip -Force 
    
      - Проверка ли перемещение:
        
            Get-CsManagementStoreReplicationStatus -CentralManagementStoreStatus 
        
        Проверьте, что указывает указывают ли ActiveMasterFQDN и ActiveFileTransferAgents на полное доменное имя резервного копирования\_пула.
    
      - Проверьте состояние реплики для всех серверов переднего плана, введя следующую команду:
        
            Get-CsManagementStoreReplicationStatus 
        
        Проверьте, что все реплики имеют значение True.
    
      - Установите службу сервера централизованного управления на остальных серверов переднего плана в резервной копии\_пула. Для этого выполните следующую команду на всех серверах переднего плана, за исключением того, под которыми принудительным централизованного управления хранилища перемещение ранее в этой процедуре:
        
            Bootstrapper /Setup 

7.  Переведите пользователей из пула Pool1 в пул Pool2, выполнив следующий командлет в Скайп для окна консоли Business Server:
    
        Invoke-CsPoolFailover -PoolFQDN <Pool1 FQDN> -DisasterMode -Verbose
    
    Поскольку действия, предпринимаемые в предыдущей части этой процедуры, чтобы проверить состояние хранилища централизованного управления не универсальные, по-прежнему возможность этот командлет не так, как центральное хранилище управления — это не еще при сбое полностью. В этом случае необходимо исправить центральное хранилище управления сообщения об ошибках, отображаемые на основании и затем снова запустите этот командлет.
    
    Если появится следующее сообщение об ошибке, необходимо изменить пограничный пул на этом сайте для использования в другой пул в качестве его следующего прыжка до сбоя отказа пула. Дополнительные сведения см процедуры, описанные в начале этого раздела.
    
        Invoke-CsPoolFailOver : This Front-end pool "pool1.contoso.com" is specified in
        topology as the next hop for the Edge server. Failing over this pool may cause External
        access/Federation/Split-domain/XMPP features to stop working. Please use Topology Builder to
        change the Edge internal next hop setting to point to a different Front-end pool,  before you
        proceed.


## <a name="fail-back-a-pool"></a>Восстановление после сбоя пула

После пула, в котором возникла аварийная оперативный (то есть пула Pool1 в этом примере), выполните следующие действия для восстановления обычного рабочего состояния развертывания.

Обратите внимание, что процесс восстановления размещения занимает несколько минут для выполнения.Следует исходить из длительности 60 минут для пула, в котором работает 20 000 пользователей.

Восстановите размещение пользователей, которые изначально размещались в пуле Pool1 и были переключены на пул Pool2, выполнив следующий командлет:
    
    Invoke-CsPoolFailback -PoolFQDN <Pool1 FQDN> -Verbose

Никакие другие действия не требуется. При сбое центральный сервер управления можно оставить его в пул Pool2.

## <a name="fail-over-the-edge-pool-used-for-skype-for-business-server-federation"></a>Отработки отказа пограничного пула, используемого для Скайп для сервера федерации 

Если пограничный пул, где у вас есть Скайп для настройки федерации Business Server отключается, необходимо изменить федерацию для использования в другой пул пограничного сервера для федерации для работы.

1.  На сервере переднего плана откройте построитель топологий. Разверните узел **пограничные пулы**и щелкните правой кнопкой мыши пограничного сервера или пула пограничных серверов, которые в настоящее время настроены для федерации. Выберите команду **Изменить свойства**.

2.  В окне **Изменение свойств** на вкладке **Общие**снимите флажок **Включение федерации для этого пограничного пула (порт 5061)**. Нажмите кнопку **ОК**.

3.  Разверните узел **пограничные пулы**и щелкните правой кнопкой мыши пограничного сервера или пула пограничных серверов, теперь необходимо использовать для федерации. Выберите команду **Изменить свойства**.

4.  В окне **Изменение свойств** на вкладке **Общие**выберите **Включение федерации для этого пограничного пула (порт 5061)**. Нажмите кнопку **ОК**.

5.  Выберите в меню **Действие**выберите **топологии**, выберите **Опубликовать**. При появлении запроса на **опубликовать топологию**, нажмите кнопку **Далее**. После публикации нажмите кнопку **Готово**.

6.  На пограничном сервере откройте Скайп для мастера развертывания Business Server. Выберите **установить или обновление Скайп для бизнес-системы сервера**и нажмите кнопку **программы установки или удаления Скайп для бизнеса серверных компонентов**. Нажмите кнопку **выполнить еще раз**.

7.  Нажмите кнопку **Далее**. Сводный экран будет отображаться действия, как они выполняются. После завершения развертывания нажмите кнопку **Просмотреть журнал** , чтобы просмотреть доступные файлы журналов. Нажмите кнопку **Готово** для завершения развертывания.
    
    Если сайт, содержащий пограничный пул содержит серверов переднего плана, по-прежнему работает, необходимо обновить служба веб-конференций и A / V конференц-связи на этих пулов переднего плана для использования службой пограничный пул в удаленной сайтов, по-прежнему выполнения. 

 ## <a name="fail-over-the-edge-pool-used-for-xmpp-federation-in-skype-for-business-server"></a>Отработки отказа пограничного пула, используемого для федерации XMPP в Скайп для Business Server 

В вашей организации есть один пограничного пула, определенного как пул для федерации XMPP. Если этот пул отключается, необходимо отработки отказа федерации XMPP для использования другого пограничного пула, перед федерации XMPP может работать еще раз.

При первой установке пограничные пулы и включить федерацию XMPP, можно упростить процесс аварийного восстановления, Настройка внешнего DNS SRV-записи для всех пулов пограничного сервера для федерации XMPP, а не только один. Каждый из этих SRV-записи необходимо задать другой приоритет. Весь трафик федерации XMPP проходит через пул с SRV-записи с наивысшим приоритетом. 

В следующей процедуре EdgePool1 — это пул, в котором изначально размещена федерация XMPP, а EdgePool2 — пул, в котором теперь будет размещаться федерация XMPP.


### <a name="to-fail-over-the-edge-pool-used-for-xmpp-federation"></a>Чтобы выполнить отработку отказа пограничного пула, используемого для федерации XMPP

1.  Если у вас еще нет другого пограничного пула, развернут (Кроме того, который в данный момент не работает), развертывание этого пула. 

2.  На каждом пограничном сервере в новый пул пограничного сервера, в котором теперь будет размещаться федерация XMPP (EdgePool2) запустите следующий командлет:
    
        Stop-CsWindowsService

3.  Выполните следующий командлет, чтобы повторно указать маршрут федерации XMPP на сервер EdgePool2:
    
        Set-CsSite Site2 -XmppExternalFederationRoute EdgeServer2.contoso.com
    
    В этом примере Site2 — это сайт, содержащий пограничного пула, в котором теперь будет размещаться маршрут федерации XMPP и EdgeServer2.contoso.com — это полное доменное имя пограничного сервера в этом пуле.

4.  На внешнем DNS-сервере измените запись DNS A для федерации XMPP, чтобы она указывала на EdgeServer2.contoso.com.

5.  Если вы уже нет DNS-записи SRV для федерации XMPP, которая разрешается в пограничный пул, в котором теперь будет размещаться федерация XMPP, необходимо добавить его, как показано в следующем примере. Эта запись SRV должен иметь значение порт 5269.
    
        _xmpp-server._tcp.contoso.com

6.  Убедитесь, что для пограничного пула, в котором теперь будет размещаться федерация XMPP открыт порт 5269 извне.

7.  Запустите службы на всех пограничных серверов в пограничном пуле, в котором теперь будет размещаться федерация XMPP.
    
        Start-CsWindowsService


## <a name="fail-back-the-edge-pool-used-for-skype-for-business-server-federation-or-xmpp-federation"></a>Восстановление после сбоя пограничного пула, используемого для Скайп для федерации Business Server или федерации XMPP 

После неудачной пограничного пула, который используется для размещения федерации оперативный обратно в оперативный режим, используйте эту процедуру для сбоя Скайп для маршрута федерации Business Server и/или маршрут федерации XMPP снова использовать этот восстановленного пограничного пула.

1.  На пограничном пуле, который снова доступен запустите службы пограничного сервера.

2.  Если вы хотите восстановить Скайп для маршрута федерации Business Server для использования восстановленного пограничного сервера, выполните следующие действия.
    
      - На сервере переднего плана откройте построитель топологий. Разверните узел **пограничные пулы**, а затем щелкните правой кнопкой мыши пограничного сервера или пула пограничных серверов, которые в настоящее время настроены для федерации. Выберите команду **Изменить свойства**.
    
      - В окне **Изменение свойств** на вкладке **Общие**снимите флажок **Включение федерации для этого пограничного пула (порт 5061)**. Нажмите кнопку **ОК**.
    
      - Разверните узел **пограничные пулы**, а затем щелкните правой кнопкой мыши исходный пограничного сервера или пула пограничных серверов, необходимо повторно использовать для федерации. Выберите команду **Изменить свойства**.
    
      - В окне **Изменение свойств** на вкладке **Общие**выберите **Включение федерации для этого пограничного пула (порт 5061)**. Нажмите кнопку **ОК**.
    
      - Выберите в меню **Действие**выберите **топологии**, выберите **Опубликовать**. При появлении запроса на **опубликовать топологию**, нажмите кнопку **Далее**. После публикации нажмите кнопку **Готово**.
    
      - На пограничном сервере откройте Скайп для мастера развертывания Business Server. Выберите **установить или обновление Скайп для бизнес-системе сервера**, а затем нажмите кнопку **программы установки или удаления Скайп для бизнеса серверных компонентов**. Нажмите кнопку **выполнить еще раз**.
    
      - Нажмите кнопку **Далее**. Сводный экран будет отображаться действия, как они выполняются. После завершения развертывания нажмите кнопку **Просмотреть журнал** , чтобы просмотреть доступные файлы журналов. Нажмите кнопку **Готово** для завершения развертывания.

3.  Если вы хотите восстановить маршрутизацию федерации XMPP для использования восстановленного пограничного сервера, выполните следующие действия.
    
      - Выполните следующий командлет, чтобы повторно указать маршрут федерации XMPP для пограничного пула, в котором теперь будет размещаться федерация XMPP (в данном примере — EdgeServer1):
        
            Set-CsSite Site1 -XmppExternalFederationRoute EdgeServer1.contoso.com
        
        В этом примере Site1 — это сайт, содержащий пограничного пула, в котором теперь будет размещаться маршрут федерации XMPP и EdgeServer1.contoso.com — это полное доменное имя пограничного сервера в этом пуле.
    
      - Если вы уже нет DNS-записи SRV для федерации XMPP, которая разрешается в пограничный пул, в котором теперь будет размещаться федерация XMPP, необходимо добавить его, как показано в следующем примере. Эта запись SRV должен иметь значение порт 5269.
        
            _xmpp-server._tcp.contoso.com
    
      - На внешнем DNS-сервере измените запись DNS A для федерации XMPP, чтобы она указывала на EdgeServer2.contoso.com.
    
      - Убедитесь, что для пограничного пула, в котором теперь будет размещаться федерация XMPP открыт порт 5269 извне.

4.  Если пулов переднего плана оставались работает в сайт, содержащий пограничного пула, который не удалось и восстановления, необходимо обновить служба веб-конференций и A / V служба конференц-связи на эти переднего плана пулы повторно использовать пограничного сервера в его локальном сайте.

5.  Если также сбой пула переднего плана на том же сайте пограничный пул, теперь можно использовать Invoke – CsPoolFailback сбоя пула переднего плана.


## <a name="change-the-edge-pool-associated-with-a-front-end-pool"></a>Изменение пограничного пула, связанного с пулом переднего плана

Если пограничный пул происходит сбой, но при сохранении работоспособности пула переднего плана на том же сайте, необходимо установить пул переднего плана для использования пограничного пула на другом сайте до восстановления пограничный пул.

1.  В построителе топологий перейдите к имени пула переднего плана, которые необходимо изменить.

2.  Щелкните пул правой кнопкой мыши и выберите команду **Изменить свойства**.

3.  В разделе **связи** **Связать пограничный пул (для компонентов мультимедиа)** используйте раскрывающееся поле для выбора пограничного пула, который нужно сопоставить интерфейсный пул с.

4.  Нажмите **ОК**.
