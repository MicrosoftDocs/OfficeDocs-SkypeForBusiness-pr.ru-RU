---
title: Улучшенное планирование DNS для Microsoft Edge Server для сервера Skype для бизнеса
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
audience: ITPro
manager: serdars
ms.topic: conceptual
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection:
- IT_Skype16
- Strat_SB_Hybrid
ms.custom: ''
ms.assetid: f3a5895f-f64f-44eb-9a5e-8d606ac1fc38
description: 'Сводка: сценарии проверки для параметров развертывания в Skype для бизнеса Server. Этот раздел будет полезен при использовании как одного сервера, так и пула серверов с DNS и средствами балансировки нагрузки (HLB).'
ms.openlocfilehash: 6ef0fc7a19703d6eba0ec3bfa66c0b37fcece53f
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2019
ms.locfileid: "34297073"
---
# <a name="advanced-edge-server-dns-planning-for-skype-for-business-server"></a>Улучшенное планирование DNS для Microsoft Edge Server для сервера Skype для бизнеса
 
**Сводка:** Ознакомьтесь со сценариями для параметров развертывания в Skype для бизнеса Server. Этот раздел будет полезен при использовании как одного сервера, так и пула серверов с DNS и средствами балансировки нагрузки (HLB).
  
Когда речь идет о планировании DNS для сервера Skype для бизнеса, у вас может быть множество факторов, которые могут поэкспериментировать с вашим решением. Если структура доменов организации уже используется, это может повлиять на ваши дальнейшие шаги. Начнем со следующих тем:
  
- [Walkthrough of Skype for Business clients locating services](../../plan-your-deployment/edge-server-deployments/advanced-edge-server-dns.md#WalkthroughOfSkype)
    
- [Split-brain DNS](../../plan-your-deployment/edge-server-deployments/advanced-edge-server-dns.md#SplitBrainDNS)
    
- [Automatic configuration without split-brain DNS](../../plan-your-deployment/edge-server-deployments/advanced-edge-server-dns.md#NoSplitBrainDNS)
    
- [DNS disaster recovery](../../plan-your-deployment/edge-server-deployments/advanced-edge-server-dns.md#DNSDR)
    
- [DNS load balancing](../../plan-your-deployment/edge-server-deployments/advanced-edge-server-dns.md#DNSLB)
    
## <a name="walkthrough-of-skype-for-business-clients-locating-services"></a>Walkthrough of Skype for Business clients locating services
<a name="WalkthroughOfSkype"> </a>

Клиенты Skype для бизнеса похожи на более ранние версии клиентов Lync в том, как они могут находить и получать доступ к службам в Skype для бизнеса Server. В этом разделе подробно описан процесс определения местоположения сервера.
  
1. линкдисковеринтернал. \<Domain (домен)\>
    
     *Запись хоста A для службы автоматического обнаружения на внутренних веб-службах.* 
    
2. lyncdiscover. \<Domain (домен)\>
    
     *Запись хоста A для службы автоматического обнаружения на внешних веб-службах.* 
    
3. _сипинтерналтлс. _tcp. \<Domain (домен)\>
    
     *Запись SRV для внутренних подключений TLS.* 
    
4. _сип. _тлс. \<Domain (домен)\>
    
     *Запись SRV для внешних подключений TLS.* 
    
5. сипинтернал. \<Domain (домен)\>
    
     *Это запись узла для пула или режиссера переднего плана, разрешаемая только во внутренней сети.* 
    
6. Установка. \<Domain (домен)\>
    
     *Это запись узла для пула или режиссера переднего плана, разрешаемая только во внутренней сети.* 
    
7. сипекстернал. \<Domain (домен)\>
    
     *Это запись узла для службы Edge Access, когда клиент является внешним.* 
    
Служба автоматического обнаружения всегда считается предпочтительным методом поиска расположения службы, другие службы используются в качестве резервных методов.
  
> [!NOTE]
> При создании записей SRV важно помнить, что они должны указывать на DNS-запись A (и AAAA при использовании IPv6-адресов) в том же домене, в котором создается DNS-запись SRV. Например, если запись SRV относится к домену contoso.com, запись A (и AAAA), на которую она указывает, не может относиться к домену fabrikam.com. 
  
Для выполнения этого действия можно настроить мобильное устройство для обнаружения служб вручную. В этом случае каждому пользователю потребуется настроить параметры своего мобильного устройства с полным внутренним и внешним универсальными кодами ресурса (URI) службы автообнаружения, включая протокол и путь, следующим образом:
  
- Для внешнего доступа: https://\<екстпулфкдн\>/аутодисковер/аутодисковерсервице.СВК/Рут
    
- Для внутреннего доступа: https://\<интпулфкдн\>/аутодисковер/аутодисковер.СВК/Рут
    
Вместо обнаружения вручную мы рекомендуем использовать автоматическое обнаружение. Однако обнаружение вручную помогает устранять неполадки и выполнять тестирование.
  
## <a name="split-brain-dns"></a>Разделенная DNS
<a name="SplitBrainDNS"> </a>

Разделенная DNS — конфигурация DNS, в которой две зоны DNS имеют одно пространство имен. При этом первая зона DNS обслуживает только внутренние запросы, а вторая зона DNS – только внешние запросы.
  
Когда использовать такую конфигурацию? В случаях, когда компания должна исполнять требование об использовании одного и того же пространства имен на внутреннем и на внешнем уровнях. Разумеется, это приводит к появлению большого количества DNS-записей SRV и A, которые будут уникальными только в одной из зон. Там, где записи будут повторятся, связанные с записями IP-адреса будут уникальными.
  
This presents some challenges. Самое важное — DNS с разделением **не поддерживается** для мобильных устройств. This is because of the LyncDiscover and LyncDiscoverInternal DNS records (LyncDiscover has to be defined on you external DNS server, while LyncDiscoverInternal has to be defined on your internal DNS server).
  
В этой статье мы добавим записи DNS для внутренних и внешних зон, но в разделе Требования к окружающей среде пограничного сервера можно найти подробные примеры.
  
### <a name="internal-dns"></a>Внутренняя DNS

- Содержит доверенную зону DNS, например contoso.com.
    
- Внутренняя зона contoso.com содержит:
    
  - DNS A и AAAA (если вы используете записи IPv6-адресации) для пула переднего плана, пула режиссеров или режиссера, а также всех внутренних серверов, работающих под управлением Skype для бизнеса Server в сети Организации.
    
  - DNS A и AAAA (если вы используете записи IPv6-адресации) для внутреннего интерфейса Edge для каждого пограничного сервера Skype для бизнеса Server в сети периметра.
    
  - DNS A и AAAA (если вы используете записи IPv6-адресации) для внутреннего интерфейса каждого обратного прокси-сервера в демилитаризованной зоне (это **необязательно** для управления обратной учетной записью-посредником).
    
  - DNS A и AAAA (если вы используете IPv6-адресацию) и записи SRV для внутренней автоконфигурации клиента Skype для бизнеса Server (это **необязательно** ).
    
  - DNS A и AAAA (если вы используете адресацию IPv6) или записи CNAME для автоматического обнаружения веб-служб Skype для бизнеса Server (это **необязательно** ).
    
- Все интерфейсы внутренней стороны Skype для бизнеса Server в демилитаризованной зоне используют эту внутреннюю зону DNS для разрешения запросов в contoso.com.
    
- Все серверы, на которых работает Skype для бизнеса, и клиенты, использующие Skype для бизнеса Server в корпоративной сети, наведите на внутренние DNS-серверы разрешение запросов в contoso.com или используют файл host на каждом пограничном сервере, а также список A и AAAA (если вы используете IPv6-адресация) — записи для сервера следующего прыжка (специально для директоров, а также для пула пула внешних интерфейсов или сервера Standard Edition).
    
### <a name="external-dns"></a>Внешняя DNS

- Содержит доверенную зону DNS, например contoso.com.
    
- Внешняя зона contoso.com содержит:
    
  - DNS A и AAAA (если вы используете адресацию IPv6) или записи CNAME для автоматического обнаружения веб-служб Skype для бизнеса Server. Это предназначено для использования с мобильными приложениями.
    
  - DNS A и AAAA (если вы используете IPv6-адресацию) и записи SRV для внешнего интерфейса EDGE на внешнем сервере пограничного сервера или в балансировке нагрузки оборудования (ХЛБ) для Skype для Business Server в сети периметра.
    
  - DNS A и AAAA (если вы используете IPv6-адресацию) и записи SRV для внешнего интерфейса обратного прокси-сервера или (VIP для пула обратных прокси-серверов) в сети периметра.
    
  - DNS A и AAAA (если вы используете IPv6-адресацию) и записи SRV для автонастройки клиента Skype для бизнеса Server****(необязательно).
    
## <a name="automatic-configuration-without-split-brain-dns"></a>Автоматическая настройка без разделенной DNS
<a name="NoSplitBrainDNS"> </a>

Если вы не используете DNS с разделением и мозгами, внутренняя автоматическая настройка клиентов, использующих Skype для бизнеса, будет работать только в том случае, если вы используете одно из описанных ниже решений. Why not? Так как в Skype для бизнеса Server требуется URI SIP пользователя, чтобы он соответствовал домену пула переднего плана, предназначенного для автоматической настройки. Это не изменилось в более ранних версиях Lync Server.
  
Например, при использовании двух доменов SIP потребуются следующие записи службы DNS SRV:
  
- _sipinternaltls._tcp.contoso.com. 86400 IN SRV 0 0 5061 pool01.contoso.com
    
     *Если пользователь входит в качестве bob@contoso.com, эта запись будет работать в автоматическом конфигурировании, так как домен SIP пользователя соответствует домену пула переднего плана (contoso.com).* 
    
- _sipinternaltls._tcp.fabrikam.com. 86400 IN SRV 0 0 5061 pool01.fabrikam.com
    
     *Если пользователь входит в систему как alice@fabrikam.com, эта запись будет работать в автоматической настройке второго домена, опять же, так как домен SIP соответствует пулу переднего плана для этого домена.* 
    
Например, такая запись не будет работать:
  
- _sipinternaltls._tcp.litwareinc.com. 86400 IN SRV 0 0 5061 pool01.fabrikam.com
    
     *Если пользователь выполняет вход с учетной записью tim@litwareinc.com, автоматическая настройка не может быть выполнена, поскольку домен SIP (litwareinc.com) не совпадает с доменом в пуле (fabrikam.com).* 
    
Итак, теперь, когда вам нужны автоматические требования для клиентов Skype для бизнеса без разделения DNS-мозг, вы можете использовать следующие параметры:
  
- **Объекты групповой политики**
    
    Используйте объекты групповой политики (GPO) для добавления правильных серверных значений.
    
    > [!NOTE]
    > Этот вариант не включает автоматическую настройку, однако он автоматизирует процесс ручной настройки. При использовании этого варианта записи SRV, связанные с автоматической настройкой, не требуются. 
  
- **Совпадающая внутренняя зона**
    
    Вам потребуется создать в внутреннем DNS-зоне зону, соответствующую внешней зоне DNS (например, contoso.com), а затем создать DNS A (и AAAA, если вы используете адреса IPv6), которые соответствуют пулу сервера Skype для бизнеса, который используется для автоматического Настройка.
    
    Например, если пользователь размещается на pool01.contoso.net, но входит в Skype для бизнеса как bob@contoso.com, создайте внутреннюю зону DNS с именем contoso.com и внутри нее нужно создать запись DNS A (и AAAA, если используется адресация IPv6) для pool01.contoso.com.
    
- **Точное определение внутренней зоны**
    
    Если по каким-либо причинам нельзя создать всю зону во внутренней DNS, вы можете создать точно заданные (выделенные) зоны, которые соответствуют записям SRV, требуемым для автоматической настройки, и затем заполнить их с помощью средства dnscmd.exe. Средство dnscmd.exe является обязательным, поскольку пользовательский интерфейс DNS не поддерживает создание точно заданных зон.
    
    Например, если ваш домен SIP — contoso.com, и у вас есть пул переднего плана под названием pool01, который содержит два сервера переднего плана, вам понадобятся следующие зоны с контактными точками и записи внутренних DNS-серверов.
    
  ```
  dnscmd . /zoneadd _sipinternaltls._tcp.contoso.com. /dsprimary
  dnscmd . /recordadd _sipinternaltls._tcp.contoso.com. @ SRV 0 0 5061 pool01.contoso.com.
  dnscmd . /zoneadd pool01.contoso.com. /dsprimary
  dnscmd . /recordadd pool01.contoso.com. @ A 192.168.10.90
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  dnscmd . /recordadd pool01.contoso.com. @ A 192.168.10.91 
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  ```

    В среде может быть второй домен SIP. В этом случае вам потребуются следующие точно определенные зоны и записи A во внутренней DNS:
    
  ```
  dnscmd . /zoneadd _sipinternaltls._tcp.fabrikam.com. /dsprimary
  dnscmd . /recordadd _sipinternaltls._tcp.fabrikam.com. @ SRV 0 0 5061 pool01.fabrikam.com.
  dnscmd . /zoneadd pool01.fabrikam.com. /dsprimary
  dnscmd . /recordadd pool01.fabrikam.com. @ A 192.168.10.90
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  dnscmd . /recordadd pool01.fabrikam.com. @ A 192.168.10.91
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  ```

> [!NOTE]
> Полное доменное имя пула переднего плана отображается дважды, но с двумя различными IP-адресами. Это связано с использованием балансировки нагрузки на DNS. Если используется ХЛБ, может быть только одна запись в пуле переднего плана. 
  
> [!NOTE]
> Кроме того, значения полного доменного имени пула переднего плана меняются между contoso.com и fabrikam.com, но IP-адреса остаются прежними. Это связано с тем, что пользователи, которые вошли из любого домена SIP, будут использовать один пул переднего плана для автоматической настройки. 
  
## <a name="dns-disaster-recovery"></a>Аварийное восстановление DNS
<a name="DNSDR"> </a>

Чтобы настроить DNS для перенаправления веб-трафика Skype для бизнеса Server на узлы аварийного восстановления (DR) и на отказоустойчивые сайты, необходимо использовать поставщик DNS, который поддерживает Жеоднс. Вы можете настроить записи DNS для поддержки аварийного восстановления, чтобы функции, использующие веб-службы, продолжались, даже если весь пул переднего плана выйдет из нее. Эта функция аварийного восстановления поддерживает простые URL-адреса автообнаружения, собрания и телефонного подключения.
  
Определите и настройте дополнительные записи узлов DNS A (AAAA, если используется IPv6) для внутреннего и внешнего разрешения веб-служб у поставщика GeoDNS. В приведенном ниже примере предполагается, что существуют географически разнесенные спаренные пулы и поставщик **либо** поддерживает GeoDNS с помощью циклического перебора DNS, **либо** настроен на использование пула Pool1 в качестве основного и пула Pool2 – для отработки отказа в случае потери связи или сбоя электропитания.
  
Все DNS-записи в этой таблице являются примерами.
  
|**Запись GeoDNS**|**Записи пула**|**Записи CNAME**|**Параметры DNS (выберите один вариант)**|
|:-----|:-----|:-----|:-----|
|Meet-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Meet.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Meet.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Meet-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Meet.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Meet.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Dialin-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Dialin.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Dialin.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Dialin-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Dialin.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Dialin.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Lyncdiscoverint-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Lyncdiscoverinternal.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Lyncdiscoverinternal.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Lyncdiscover-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Lyncdiscover.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Lyncdiscover.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Scheduler-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Scheduler.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Scheduler.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Scheduler-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Scheduler.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Scheduler.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
   
## <a name="dns-load-balancing"></a>Балансировка нагрузки DNS
<a name="DNSLB"> </a>

Балансировка нагрузки на DNS обычно реализуется на уровне приложений. Приложение (например, клиент, использующий Skype для бизнеса) пытается подключиться к серверу в пуле, подключив один из IP-адресов, возвращенных из DNS A и AAAA (если используется IPv6-адресация), чтобы выполнить запрос на запись полного доменного имени пула.
  
Например, если у вас есть три внешних сервера в пуле с именем pool01.contoso.com, произойдет следующее:
  
- Клиенты, использующие Skype для бизнеса, запрашивают DNS для pool01.contoso.com. Запрос возвращает 3 IP-адреса и кэширует их следующим образом (в некотором порядке):
    
   |||
   |:-----|:-----|
   |pool01.contoso.com  <br/> |192.168.10.90  <br/> |
   |pool01.contoso.com  <br/> |192.168.10.91  <br/> |
   |pool01.contoso.com  <br/> |192.168.10.92  <br/> |
   
- Клиент пытается установить подключение TCP к одному из IP-адресов. Если не удается установить подключение, клиент берет следующий кэшированный IP-адрес из списка.
    
- Если подключение TCP успешно установлено, клиент согласует TLS для подключения к основному регистратору на pool01.contoso.com.
    
- Если клиент попытается получить все кэшированные записи без успешного соединения, пользователь получит уведомление о том, что в данный момент ни один из серверов Skype для бизнеса Server не работает.
    
> [!NOTE]
> Балансировка нагрузки на DNS отличается от циклического перебора DNS (DNS RR), который обычно относится к балансировке нагрузки с помощью DNS для обеспечения другого порядка IP-адресов для серверов в пуле. Как правило, циклический перебор DNS обеспечивает распределение нагрузки, но не поддерживает отработку отказа. Например, если подключение к одному IP-адресу, возвращаемому запросом DNS-записи A (или AAAA в сценарии IPv6), завершается с ошибкой, подключение разрывается. В результате циклический перебор DNS является менее надежным, чем балансировка нагрузки на DNS. Вы по-прежнему можете использовать циклический перебор DNS вместе с балансировкой нагрузки на DNS, если это необходимо. 
  
Балансировка нагрузки по DNS используется для выполнения следующих задач:
  
- Балансировка нагрузки — сервер SIP на пограничные серверы.
    
- Балансировка нагрузки для приложений Unified Communications Application Services (UCAS), например автосекретаря, группы ответа и парковки вызовов.
    
- Запрет новых подключений к приложениям UCAS (также называемое "сток").
    
- Балансировка нагрузки весь трафик между клиентами и серверами пограничного сервера между клиентом и сервером.
    
Балансировка нагрузки по DNS не используется для выполнения следующих задач:
  
- Веб-трафик между серверами и на сервер переднего плана или в режиссер.
    
Чтобы подробнее узнать о том, как будет выделяться DNS SRV-запись, когда запрос возвращает мутипле DNS-записи, служба Edge Access всегда выбирает запись с минимальным числовым приоритетом, а при необходимости — с наибольшим числовым весом. Это противопоставлено [документации по разработке Интернет-задач](https://www.ietf.org/rfc/rfc2782.txt).
  
Например, если первая DNS-запись SRV имеет вес 20 и приоритет 40, а вторая DNS-запись SRV имеет вес 10 и приоритет 50, будет выбрана первая запись с меньшим приоритетом 40. Приоритет всегда учитывается в первую очередь, и клиент в первую очередь направляется именно на хост. Что делать, если есть две разные цели имеют одинаковый приоритет? 
  
В этом случае учитывается вес. Более крупный вес должен присваиваться при наличии пропорционально высокой вероятности выбора в этой ситуации. Администраторы DNS должны использовать вес 0 при отсутствии каких-либо серверных операций выбора, которые подлежат выполнению. При наличии записей, вес которых больше 0, крайне маловероятно, что будут выбраны записи, имеющие вес 0.
  
Что происходит при получении нескольких DNS-записей SRV с равным приоритетом и весом? В этой ситуации служба Edge Access выберет запись SRV, которая была получена с DNS-сервера.
  

