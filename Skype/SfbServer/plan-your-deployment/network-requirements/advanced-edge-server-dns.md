---
title: Advanced Edge Server DNS planning for Skype for Business Server
ms.reviewer: ''
ms.author: v-cichur
author: cichur
audience: ITPro
manager: serdars
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection:
- IT_Skype16
- Strat_SB_Hybrid
ms.custom: ''
ms.assetid: f3a5895f-f64f-44eb-9a5e-8d606ac1fc38
description: Сводка. Обзор сценариев развертывания Skype для бизнеса Server. Этот раздел поможет вам использовать один сервер или пул серверов с DNS или HLB.
ms.openlocfilehash: 5a41baac30f3bf6a1e20ae34db009dae0cec40af
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49825329"
---
# <a name="advanced-edge-server-dns-planning-for-skype-for-business-server"></a>Advanced Edge Server DNS planning for Skype for Business Server
 
**Сводка:** Обзор сценариев развертывания Skype для бизнеса Server. Этот раздел поможет вам использовать один сервер или пул серверов с DNS или HLB.
  
При планировании системы доменных имен (DNS) для Skype для бизнеса Server существует множество факторов, которые могут оказаться важными при принятии решения. Если структура домена вашей организации уже есть, это может быть вопросом проверки того, как вы собираетесь продолжить. Начнем с разделов, которые приведены ниже.
  
- [Walkthrough of Skype for Business clients locating services](../../plan-your-deployment/edge-server-deployments/advanced-edge-server-dns.md#WalkthroughOfSkype)
    
- [Разделенная DNS](../../plan-your-deployment/edge-server-deployments/advanced-edge-server-dns.md#SplitBrainDNS)
    
- [Автоматическая настройка без разделенной DNS](../../plan-your-deployment/edge-server-deployments/advanced-edge-server-dns.md#NoSplitBrainDNS)
    
- [Аварийное восстановление DNS](../../plan-your-deployment/edge-server-deployments/advanced-edge-server-dns.md#DNSDR)
    
- [Балансировка нагрузки на DNS](../../plan-your-deployment/edge-server-deployments/advanced-edge-server-dns.md#DNSLB)
    
## <a name="walkthrough-of-skype-for-business-clients-locating-services"></a>Walkthrough of Skype for Business clients locating services
<a name="WalkthroughOfSkype"> </a>

Клиенты Skype для бизнеса похожи на предыдущие версии клиентов Lync в поиске служб в Skype для бизнеса Server и доступе к ним. В этом разделе подробно процесс определения местоположения сервера.
  
1. lyncdiscoverinternal.\<domain\>
    
     *Это запись хоста A для службы автонаружия во внутренних веб-службах.* 
    
2. lyncdiscover.\<domain\>
    
     *Это запись хоста A для службы автонаружия во внешних веб-службах.* 
    
3. _sipinternaltls._tcp.\<domain\>
    
     *Это запись SRV для внутренних подключений TLS.* 
    
4. _sip._tls.\<domain\>
    
     *Это запись SRV для внешних подключений TLS.* 
    
5. sipinternal.\<domain\>
    
     *Это запись хоста A для пула переднего входа или директора, разрешаемая только во внутренней сети.* 
    
6. sip.\<domain\>
    
     *Это запись хоста A для пула переднего входа или директора, разрешаемая только во внутренней сети.* 
    
7. sipexternal.\<domain\>
    
     *Это запись хоста A для службы доступа, когда клиент является внешним.* 
    
Служба автоотнаружение всегда предпочтительнее, так как это предпочтительный метод для расположения службы, а остальные — это методы отката.
  
> [!NOTE]
> При создании записей SRV важно помнить, что они должны указать на DNS-записи A (и AAAA, если вы используете IPv6-адреса) в том же домене, где создается запись SRV DNS. Например, если запись SRV в contoso.com, запись A (и AAAA), на которая она указывает, не может быть в fabrikam.com. 
  
Если вы готовы сделать это, вы можете настроить мобильное устройство для обнаружения служб вручную. Если это именно то, что вы хотите сделать, каждому пользователю необходимо настроить параметры мобильного устройства с полными внутренними и внешними URIS службы автооружия, включая протокол и путь, следующим образом:
  
- Для внешнего доступа: https:// \<ExtPoolFQDN\> /Autodiscover/autodiscoverservice.svc/Root
    
- Для внутреннего доступа: https:// \<IntPoolFQDN\> /AutoDiscover/AutoDiscover.svc/Root
    
Мы рекомендуем использовать автоматическое обнаружение, а не обнаружение вручную. Но если вы устраняете неполадки или тестируете их, параметры вручную могут оказаться очень полезными.
  
## <a name="split-brain-dns"></a>Разделенная DNS
<a name="SplitBrainDNS"> </a>

Это конфигурация DNS, в которой имеется две зоны DNS с одинаковым пространством имен. Первая зона DNS обрабатывает внутренние запросы, а вторая зона DNS обрабатывает внешние запросы.
  
Зачем компании это делать? Для них может потребоваться использовать одно и то же пространство имен как внутри, так и извне, но, конечно, это приведет к уникальному использованию многих записей DNS SRV и A в той или иной зоне, а при дублировании IP-адреса, связанные с этими записями, будут уникальными.
  
Это представляет некоторые проблемы. Самое важное, что разделенная DNS не **поддерживается для** мобильной работы. Это происходит из-за записей DNS LyncDiscover и LyncDiscoverInternal (LyncDiscover необходимо определить на внешнем DNS-сервере, а LyncDiscoverInternal — на внутреннем DNS-сервере).
  
Здесь мы перечислим записи DNS для внутренней и внешней зон, но подробные примеры можно найти в разделе "Требования к среде edge Server".
  
### <a name="internal-dns"></a>Внутренняя DNS

- Содержит зону DNS, называемую (например contoso.com), для которой она является достоверной.
    
- Этот внутренний contoso.com содержит:
    
  - Записи DNS A и AAAA (при использовании IPv6-адресов) для пула переднего сервера, пула директоров или имени пула директоров, а также всех внутренних серверов со Skype для бизнеса Server в сети организации.
    
  - Записи DNS A и AAAA (при использовании IPv6-адресов) для внутреннего интерфейса периметра для каждого сервера Skype для бизнеса Server в сети периметра.
    
  - Записи DNS A и AAAA (при использовании IPv6-адресов) для внутреннего интерфейса каждого обратного прокси-сервера в сети периметра (это необязательно для управления обратным прокси-сервером). 
    
  - DNS-записи A и AAAA (при использовании IPv6-адресов) и записи SRV для внутренней  автонастройки клиента Skype для бизнеса Server (необязательно).
    
  - Записи DNS A и AAAA (при использовании IPv6-адресов) или ЗАПИСИ CNAME для автоматического  обнаружения веб-служб Skype для бизнеса Server (необязательно).
    
- Все внутренние интерфейсы Skype для бизнеса Server в сети периметра используют эту внутреннюю зону DNS для разрешения запросов contoso.com.
    
- Все серверы, на которых работает Skype для бизнеса Server, и клиенты Skype для бизнеса Server в корпоративной сети, указывают на внутренние DNS-серверы для разрешения запросов в contoso.com или используют файл host на каждом сервере и перечисляют записи A и AAAA (при использовании IPv6-адресов) для сервера следующего прыжка (специально для VIP директора или пула директоров) , VIP-сервер пула переднего сервера или сервер Standard Edition).
    
### <a name="external-dns"></a>Внешняя DNS

- Содержит зону DNS, называемую (например contoso.com), для которой она является достоверной.
    
- Этот внешний contoso.com содержит:
    
  - DNS-записи A и AAAA (при использовании IPv6-адресов) или записи CNAME для автоматического обнаружения веб-служб Skype для бизнеса Server. Это для использования с мобильностью.
    
  - DNS-записи A и AAAA (при использовании IPv6-адресов) и записи SRV для внешнего интерфейса каждого сервера Skype для бизнеса Server или IP-адреса аппаратной балансиры нагрузки (HLB) в сети периметра.
    
  - DNS-записи A и AAAA (при использовании IPv6-адресов) и записи SRV для внешнего интерфейса обратного прокси-сервера или (VIP для пула обратных прокси-серверов) в сети периметра.
    
  - DNS-записи A и AAAA (при использовании IPv6-адресов) и записи SRV для автоматической перенастройки клиента Skype для бизнеса Server **(необязательно).**
    
## <a name="automatic-configuration-without-split-brain-dns"></a>Автоматическая настройка без разделенной DNS
<a name="NoSplitBrainDNS"> </a>

Если вы не используете разделенную DNS, внутренняя автоматическая настройка клиентов со Skype для бизнеса не будет работать, если вы не используете одно из обходных пути, которые у нас есть. Почему нет? Поскольку Skype для бизнеса Server требует, чтобы SIP URI пользователя совпадал с доменом интерфейсного пула, предназначенным для автоматической настройки. Это не изменилось по версии предыдущих версий Lync Server.
  
Таким образом, если у вас есть два SIP-домена, вам потребуется использовать эти записи DNS SRV:
  
- _sipinternaltls._tcp.contoso.com. 86400 IN SRV 0 0 5061 pool01.contoso.com
    
     *Если пользователь в bob@contoso.com, эта запись будет работать для автоматической настройки, так как домен SIP пользователя совпадает с доменом интерфейсного пула (contoso.com).* 
    
- _sipinternaltls._tcp.fabrikam.com. 86400 IN SRV 0 0 5061 pool01.fabrikam.com
    
     *Если пользователь в alice@fabrikam.com, эта запись будет работать для автоматической настройки второго домена, так как домен SIP совпадает с интерфейсным пулом для этого домена.* 
    
Если взять пример далее, это не сработает:
  
- _sipinternaltls._tcp.litwareinc.com. 86400 IN SRV 0 0 5061 pool01.fabrikam.com
    
     *Пользователь, который в tim@litwareinc.com не работает для автоматической настройки, так как его домен SIP (litwareinc.com) не совпадает с доменом в пуле (fabrikam.com).* 
    
Теперь, когда мы знаем все это, если вам требуется автоматическое требование для клиентов Skype для бизнеса без разделенной DNS, у вас есть указанные далее варианты.
  
- **Объекты групповой политики.**
    
    Для заполнения правильных значений сервера можно использовать объекты групповой политики.
    
    > [!NOTE]
    > Этот параметр не включает автоматическую настройку, но автоматизирует ручную настройку. При таком подходе записи SRV, связанные с автоматической настройкой, не требуются. 
  
- **Совпадающая внутренняя зона.**
    
    Вам потребуется создать зону во внутренней DNS, которая соответствует внешней зоне DNS (например, contoso.com), а затем создать записи DNS A (и AAAA, если вы используете IPv6-адреса), соответствующие пулу Skype для бизнеса Server, используемой для автоматической настройки.
    
    Например, если у вас есть пользователь, который находится в pool01.contoso.net, но в Skype для бизнеса в качестве bob@contoso.com, создайте внутреннюю зону DNS с иконой contoso.com, а внутри нее необходимо создать запись DNS A (и AAAA, если используется IPv6-адрес) для pool01.contoso.com.
    
- **Точное определение внутренней зоны.**
    
    Если создание всей зоны во внутренней DNS не является вариантом, вы можете создать зоны контактной точки (выделенные), соответствующие записям SRV, требуемой для автоматической настройки, и заполнить эти зоны с помощью dnscmd.exe. Dnscmd.exe требуется, так как пользовательский интерфейс DNS не поддерживает создание зон контактов.
    
    Например, если ваш домен SIP contoso.com, а у вас есть пул переднего сервера pool01, содержащий два сервера переднего сервера, во внутренней DNS вам потребуется следующая зона контактной точки и записи A:
    
  ```console
  dnscmd . /zoneadd _sipinternaltls._tcp.contoso.com. /dsprimary
  dnscmd . /recordadd _sipinternaltls._tcp.contoso.com. @ SRV 0 0 5061 pool01.contoso.com.
  dnscmd . /zoneadd pool01.contoso.com. /dsprimary
  dnscmd . /recordadd pool01.contoso.com. @ A 192.168.10.90
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  dnscmd . /recordadd pool01.contoso.com. @ A 192.168.10.91 
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  ```

    В вашей среде может быть второй домен SIP. В этом случае во внутренней DNS вам потребуется следующая зона контактных точек и записи A:
    
  ```console
  dnscmd . /zoneadd _sipinternaltls._tcp.fabrikam.com. /dsprimary
  dnscmd . /recordadd _sipinternaltls._tcp.fabrikam.com. @ SRV 0 0 5061 pool01.fabrikam.com.
  dnscmd . /zoneadd pool01.fabrikam.com. /dsprimary
  dnscmd . /recordadd pool01.fabrikam.com. @ A 192.168.10.90
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  dnscmd . /recordadd pool01.fabrikam.com. @ A 192.168.10.91
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  ```

> [!NOTE]
> You'll see the Front End pool FQDN appears twice, but with two different IP addresses. Это потому, что используется балансировка нагрузки на DNS. Если используется HLB, существует только одна запись пула переднего уровня. 
  
> [!NOTE]
> Кроме того, значения FQDN пула переднего contoso.com и fabrikam.com, но IP-адреса остаются без изменений. Это потому, что пользователи, выполвшие вход из любого домена SIP, будут использовать один и тот же пул переднего уровня для автоматической настройки. 
  
## <a name="dns-disaster-recovery"></a>Аварийное восстановление DNS
<a name="DNSDR"> </a>

Чтобы настроить DNS для перенаправления веб-трафика Skype для бизнеса Server на сайты аварийного восстановления и отработки сбойов, необходимо использовать поставщика DNS, который поддерживает GeoDNS. Вы можете настроить записи DNS для поддержки аварийного восстановления, чтобы функции, которые используют веб-службы, продолжались даже в случае свиса одного пула переднего входа. Эта функция dr поддерживает простые URL-адреса автоdiscover, Meet и Dial-in.
  
Вы определяете и настраивает дополнительные записи A (AAAA) для DNS-сайта (AAAA, если используется IPv6) для внутреннего и внешнего разрешения веб-служб у поставщика GeoDNS. В следующих сведениях предполагается, что сопряженные пулы географически распределены  и что geoDNS, поддерживаемый вашим поставщиком, либо имеет круговой перенастройки **DNS,** либо настроен для использования Pool1 в качестве основного и перенаправл на пул Pool2 в случае потери связи или сбоя питания.
  
Все записи DNS в этой таблице являются примерами.
  
|**Запись GeoDNS**|**Записи пула**|**Записи CNAME**|**Параметры DNS (выберите один вариант)**|
|:-----|:-----|:-----|:-----|
|Meet-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Meet.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Meet.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Использование основного, подключение к дополнительному при сбое  <br/> |
|Meet-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Meet.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Meet.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Использование основного, подключение к дополнительному при сбое  <br/> |
|Dialin-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Dialin.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Dialin.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Использование основного, подключение к дополнительному при сбое  <br/> |
|Dialin-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Dialin.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Dialin.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Использование основного, подключение к дополнительному при сбое  <br/> |
|Lyncdiscoverint-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Lyncdiscoverinternal.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Lyncdiscoverinternal.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Использование основного, подключение к дополнительному при сбое  <br/> |
|Lyncdiscover-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Lyncdiscover.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Lyncdiscover.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Использование основного, подключение к дополнительному при сбое  <br/> |
|Scheduler-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Scheduler.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Scheduler.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Использование основного, подключение к дополнительному при сбое  <br/> |
|Scheduler-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Scheduler.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Scheduler.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Использование основного, подключение к дополнительному при сбое  <br/> |
   
## <a name="dns-load-balancing"></a>балансировка нагрузки DNS;
<a name="DNSLB"> </a>

Балансировка нагрузки на DNS обычно реализуется на уровне приложения. Приложение (например, клиент Skype для бизнеса) пытается подключиться к серверу в пуле, подключаясь к одному из IP-адресов, возвращенных запросом записи DNS A и AAAA (если используется IPv6-адрес) для FQDN пула.
  
Например, если в пуле с именем pool01.contoso.com три сервера переднего pool01.contoso.com, произойдет следующее:
  
- Клиенты, работающие под управлением Skype для бизнеса, запрашивают DNS для pool01.contoso.com. Запрос возвращает три IP-адреса и кэширует их следующим образом (в определенном порядке):
    
   |||
   |:-----|:-----|
   |pool01.contoso.com  <br/> |192.168.10.90  <br/> |
   |pool01.contoso.com  <br/> |192.168.10.91  <br/> |
   |pool01.contoso.com  <br/> |192.168.10.92  <br/> |
   
- Клиент пытается установить подключение TCP к одному из IP-адресов. В случае сбойного решения он будет пытаться найти следующий IP-адрес, который кэшется из этого списка.
    
- Если подключение TCP успешно установлено, клиент согласует TLS для подключения к основному регистратору на pool01.contoso.com.
    
- Если клиент пытается использовать все кэшные записи без успешного подключения, пользователь получает уведомление о том, что на данный момент серверы Skype для бизнеса Server недоступны.
    
> [!NOTE]
> Балансировка нагрузки на основе DNS отличается от перезагрузки DNS (DNS RR), который обычно относится к балансировкой нагрузки, ссылаясь на DNS, чтобы указать другой порядок IP-адресов для серверов в пуле. Как правило, DNS RR обеспечивает распределение нагрузки, но не позволяет включить отбой. Например, если подключение к одному IP-адресу, возвращенное запросом DNS A (или AAAA в сценарии IPv6), не будет, это подключение не будет работать. Это делает DNS-RR менее надежным, чем балансировка нагрузки на основе DNS. Вы по-прежнему можете использовать DNS RR в сочетании с балансировка нагрузки на основе DNS, если это необходимо. 
  
Балансировка нагрузки на DNS используется для:
  
- Балансировать нагрузку SIP между серверами и на edge-серверы.
    
- Балансировать нагрузку приложений служб объединенных коммуникаций (UCAS), например службы автосекретарь, группы ответа и парковки вызовов.
    
- Предотвращение новых подключений к приложениям UCAS (также известной как "сток").
    
- Балансировать нагрузку на весь трафик между клиентом и сервером между клиентами и серверами.
    
Балансировку нагрузки на DNS нельзя использовать для:
  
- Веб-трафик "клиент-сервер" на серверы переднего сервера или директора.
    
Чтобы более подробно и подробно узнать, как запись DNS SRV выбирается при возвращении записей DNS-мутипля, когда запрос возвращает записи DNS, по краям доступа всегда выбирается запись с наименьшим числом приоритета и, если требуется разбика на связь, самый высокий числовой вес. Это согласуется с [документацией по internet Engineering Task Force.](https://www.ietf.org/rfc/rfc2782.txt)
  
Например, если первая запись DNS SRV имеет вес 20 и приоритет 40, а вторая DNS-запись SRV имеет вес 10 и приоритет 50, первая запись будет выбрана, так как она имеет более низкий приоритет 40. Приоритет всегда должен быть первым, и клиент будет в первую очередь нацелить его на этот хост. Что делать, если существует два целевых объектов с одинаковым приоритетом? 
  
В этом случае учитывается вес. При выборе более высоких весов следует иметь высокую вероятность выбора. Администраторам DNS следует использовать вес 0, если выбор сервера не существует. При наличии записей, содержащих вес больше 0, вероятность выбора записей с весом 0 очень мала.
  
Что произойдет, если возвращается несколько записей DNS SRV с одинаковым приоритетом и весом? В этой ситуации по краям доступа сначала выбирается запись SRV, которую она получила с DNS-сервера.
  

