---
title: Требования к балансировке нагрузки для Skype для бизнеса
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection:
- IT_Skype16
- Strat_SB_Admin
ms.custom: ''
ms.assetid: 84489328-64a4-486c-9384-a3e5c8ed9c8b
description: 'Сводка: Проверка балансировки нагрузки перед реализацией Skype для бизнеса Server.'
ms.openlocfilehash: 199c93528d89786573bdac16077f1e32feb1fe6f
ms.sourcegitcommit: e64c50818cac37f3d6f0f96d0d4ff0f4bba24aef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2020
ms.locfileid: "41802049"
---
# <a name="load-balancing-requirements-for-skype-for-business"></a><span data-ttu-id="ab331-103">Требования к балансировке нагрузки для Skype для бизнеса</span><span class="sxs-lookup"><span data-stu-id="ab331-103">Load balancing requirements for Skype for Business</span></span>
 
<span data-ttu-id="ab331-104">**Сводка:** Прежде чем приступить к внедрению Skype для бизнеса Server, ознакомьтесь с этими замечаниями.</span><span class="sxs-lookup"><span data-stu-id="ab331-104">**Summary:** Review the load balancing considerations before implementing Skype for Business Server.</span></span>
  
<span data-ttu-id="ab331-105">Балансировка нагрузки распределяет трафик между серверами в пуле.</span><span class="sxs-lookup"><span data-stu-id="ab331-105">Load balancing distributes traffic among the servers in a pool.</span></span> <span data-ttu-id="ab331-106">Если у вас есть пулы интерфейсов, пулы серверов обновлений или пулы пограничных серверов, вам нужно развернуть балансировку нагрузки для этих пулов.</span><span class="sxs-lookup"><span data-stu-id="ab331-106">If you have Front End pools, Mediation Server pools, or Edge Server pools, you need to deploy load balancing for these pools.</span></span>
  
<span data-ttu-id="ab331-107">Skype для бизнеса Server поддерживает два типа решений для балансировки нагрузки при обмене данными между клиентами: Балансировка нагрузки службы доменных имен (DNS) и балансировка нагрузки оборудования (часто сокращается как ХЛБ).</span><span class="sxs-lookup"><span data-stu-id="ab331-107">Skype for Business Server supports two types of load balancing solutions for client-to-server traffic: Domain Name System (DNS) load balancing and hardware load balancing (often abbreviated as HLB).</span></span> <span data-ttu-id="ab331-108">Балансировка нагрузки DNS обеспечивает ряд преимуществ, включая упрощенное администрирование, более эффективное устранение неполадок и возможность изолировать весь трафик Skype для бизнеса Server из потенциальных проблем системы балансировки нагрузки оборудования.</span><span class="sxs-lookup"><span data-stu-id="ab331-108">DNS load balancing offers several advantages including simpler administration, more efficient troubleshooting, and the ability to isolate much of your Skype for Business Server traffic from any potential hardware load balancer problems.</span></span>
  
<span data-ttu-id="ab331-109">Решите, какое решение подходящее для балансировки нагрузки для каждого пула в вашем развертывании, но помните о перечисленных ниже ограничениях.</span><span class="sxs-lookup"><span data-stu-id="ab331-109">Decide for yourself which load balancing solution is appropriate for each pool in your deployment, but keep in mind the following restrictions:</span></span> 
  
- <span data-ttu-id="ab331-p103">Внутренний и внешний пограничные интерфейсы должны использовать одинаковые типы решений балансировки нагрузки. Вы не можете использовать балансировку нагрузки на DNS на одном интерфейсе и аппаратную балансировку на другом.</span><span class="sxs-lookup"><span data-stu-id="ab331-p103">The internal Edge interface and external Edge interface must use the same type of load balancing. You cannot use DNS load balancing on one interface and hardware load balancing on the other.</span></span>
    
- <span data-ttu-id="ab331-p104">Для некоторых типов трафика требуется аппаратный балансировщик нагрузки. Например для трафика HTTP вместо балансировки нагрузки на DNS требуется аппаратный балансировщик нагрузки. Балансировка нагрузки на DNS не работает с веб-трафиком "клиент-сервер".</span><span class="sxs-lookup"><span data-stu-id="ab331-p104">Some types of traffic require a hardware load balancer. For example, HTTP traffic requires a hardware load balancer instead of DNS load balancing. DNS load balancing does not work with client-to-server web traffic.</span></span>
    
<span data-ttu-id="ab331-p105">Если в качестве решения для пула вы выбрали балансировку нагрузки на DNS, но вам по-прежнему требуются аппаратные балансировщики нагрузки для определенных видов трафика, например HTTP, то администрирование аппаратных балансировщиков нагрузки существенно упрощается. Например настройка аппаратного балансировщика нагрузки будет упрощена, поскольку потребуется управлять только трафиком HTTP и HTTPS, а для управления остальными протоколами будет использоваться балансировка нагрузки на DNS. Дополнительные сведения см. в разделе [DNS Load Balancing](load-balancing.md#BKMK_DNSLoadBalancing).</span><span class="sxs-lookup"><span data-stu-id="ab331-p105">If you choose to use DNS load balancing for a pool but still need to implement hardware load balancers for traffic such as HTTP traffic, the administration of the hardware load balancers is greatly simplified. For example, configuring the hardware load balancer will be simpler as it will only manage the HTTP and HTTPS traffic, while all other protocols will be managed by DNS load balancing. For details, see [DNS Load Balancing](load-balancing.md#BKMK_DNSLoadBalancing).</span></span> 
  
<span data-ttu-id="ab331-118">Для трафика "сервер-сервер" в Skype для бизнеса Server используется балансировка нагрузки, учитывающая топологию.</span><span class="sxs-lookup"><span data-stu-id="ab331-118">For server-to-server traffic, Skype for Business Server uses topology-aware load balancing.</span></span> <span data-ttu-id="ab331-119">Серверы считывают опубликованную топологию в хранилище Центрального управления для получения полных доменных имен серверов в топологии и автоматически распространяют трафик между серверами.</span><span class="sxs-lookup"><span data-stu-id="ab331-119">Servers read the published topology in the Central Management store to obtain the FQDNs of servers in the topology, and automatically distribute the traffic among the servers.</span></span> <span data-ttu-id="ab331-120">Administrators do not need to set up or manage this type of load balancing.</span><span class="sxs-lookup"><span data-stu-id="ab331-120">Administrators do not need to set up or manage this type of load balancing.</span></span> 
  
<span data-ttu-id="ab331-p107">Если используется балансировка DNS-нагрузки и требуется блокировать трафик на конкретный компьютер, недостаточно просто удалить записи IP-адреса из полного имени домена пула. Необходимо также удалить DNS-запись для этого компьютера.</span><span class="sxs-lookup"><span data-stu-id="ab331-p107">If you use DNS load balancing and you need to block traffic to a specific computer, it is not sufficient to just remove the IP address entries from the Pool FQDN. You must remove the DNS entry for the computer as well.</span></span> 
  
## <a name="hardware-load-balancer-requirements"></a><span data-ttu-id="ab331-123">Требования к подсистеме балансировки нагрузки оборудования</span><span class="sxs-lookup"><span data-stu-id="ab331-123">Hardware load balancer requirements</span></span>

<span data-ttu-id="ab331-124">Масштабируемая высокоэффективная топология в Skype для бизнеса Server оптимизирована для балансировки нагрузки DNS для новых развертываний, которые главным образом используются в других организациях, использующих Skype для бизнеса Server или Lync Server.</span><span class="sxs-lookup"><span data-stu-id="ab331-124">The Skype for Business Server scaled consolidated Edge topology is optimized for DNS load balancing for new deployments federating primarily with other organizations using Skype for Business Server or Lync Server.</span></span> <span data-ttu-id="ab331-125">Если для любого из перечисленных ниже сценариев требуется высокая доступность, аппаратная подсистема балансировки нагрузки должна использоваться в пулах пограничного сервера для указанных ниже элементов.</span><span class="sxs-lookup"><span data-stu-id="ab331-125">If high availability is required for any of the following scenarios, a hardware load balancer must be used on Edge Server pools for the following:</span></span> 
  
- <span data-ttu-id="ab331-126">Интеграция с организациями с помощью Office Communications Server 2007 R2 или Office Communications Server 2007</span><span class="sxs-lookup"><span data-stu-id="ab331-126">Federation with organizations using Office Communications Server 2007 R2 or Office Communications Server 2007</span></span>
    
- <span data-ttu-id="ab331-127">UM Exchange для удаленных пользователей, использующих UM до Exchange 2010 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="ab331-127">Exchange UM for remote users using Exchange UM prior to Exchange 2010 with SP1</span></span>
    
- <span data-ttu-id="ab331-128">Связь с пользователями общедоступных систем обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="ab331-128">Connectivity to public IM users</span></span>
    
> [!IMPORTANT]
> <span data-ttu-id="ab331-p109">Использование в одном интерфейсе балансировки нагрузки через DNS, а в другом аппаратной балансировки нагрузки не поддерживается. Необходимо использовать либо ту, либо другую систему балансировки нагрузки для обоих интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="ab331-p109">Using DNS load balancing on one interface and hardware load balancing on the other is not supported. You must use hardware load balancing for both interfaces or DNS load balancing for both.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="ab331-p110">При использовании аппаратной балансировки нагрузки балансировщик, развертываемый для соединений с внутренней сетью, необходимо настроить на балансировку нагрузки только трафика, идущего к серверам, на которых выполняются пограничная служба доступа и пограничная служба аудио- и видеоданных. Он не может балансировать нагрузку трафика, идущего ко внутренней пограничной службе веб-конференций или внутренней прокси-службе XMPP.</span><span class="sxs-lookup"><span data-stu-id="ab331-p110">If you are using a hardware load balancer, the load balancer deployed for connections with the internal network must be configured to load balance only the traffic to servers running the Access Edge service and the A/V Edge service. It cannot load balance the traffic to the internal Web Conferencing Edge service or the internal XMPP Proxy service.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="ab331-133">NAT-сервер обратной передачи (DSR) не поддерживается в Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="ab331-133">The direct server return (DSR) NAT is not supported with Skype for Business Server.</span></span> 
  
<span data-ttu-id="ab331-134">Чтобы определить, поддерживает ли ваш аппаратный балансировщик нагрузки необходимые функции, необходимые в Skype для бизнеса Server, ознакомьтесь со сведениями [об инфраструктуре Skype для бизнеса](https://docs.microsoft.com/SkypeForBusiness/certification/infra-gateways).</span><span class="sxs-lookup"><span data-stu-id="ab331-134">To determine whether your hardware load balancer supports the necessary features required by Skype for Business Server, see [Infrastructure for Skype for Business](https://docs.microsoft.com/SkypeForBusiness/certification/infra-gateways).</span></span> 
  
### <a name="hardware-load-balancer-requirements-for-edge-servers-running-the-av-edge-service"></a><span data-ttu-id="ab331-135">Требования к аппаратному балансировщику нагрузки для пограничных серверов, использующих пограничную службу аудио- и видеоданных</span><span class="sxs-lookup"><span data-stu-id="ab331-135">Hardware Load Balancer Requirements for Edge Servers Running the A/V Edge Service</span></span>

<span data-ttu-id="ab331-136">Ниже приведены требования к оборудованию для подсистемы балансировки нагрузки для пограничного сервера, на котором работает служба Edge-V:</span><span class="sxs-lookup"><span data-stu-id="ab331-136">Following are the hardware load balancer requirements for Edge Servers running the A/V Edge service:</span></span>
  
- <span data-ttu-id="ab331-p111">Отключите Nagle-оптимизацию TCP для внутреннего и внешнего портов 443. Оптимизация по алгоритму Nagle — это процесс объединения мелких пакетов сервера в один пакет большего размера для более эффективной передачи.</span><span class="sxs-lookup"><span data-stu-id="ab331-p111">Turn off TCP nagling for both internal and external ports 443. Nagling is the process of combining several small packets into a single, larger packet for more efficient transmission.</span></span>
    
- <span data-ttu-id="ab331-139">Отключите протокол TCP наглинг для внешних диапазонов портов 50 000-59 999.</span><span class="sxs-lookup"><span data-stu-id="ab331-139">Turn off TCP nagling for external port range 50,000 - 59,999.</span></span> 
    
- <span data-ttu-id="ab331-140">Не применяйте преобразование сетевых адресов на внутреннем или внешнем брандмауэре.</span><span class="sxs-lookup"><span data-stu-id="ab331-140">Do not use NAT on the internal or external firewall.</span></span> 
    
- <span data-ttu-id="ab331-141">Внутренний интерфейс EDGE должен находиться в другой сети, чем внешний интерфейс пограничного сервера, и маршрутизация между ними должна быть отключена.</span><span class="sxs-lookup"><span data-stu-id="ab331-141">The edge internal interface must be on a different network than the Edge Server external interface and routing between them must be disabled.</span></span> 
    
- <span data-ttu-id="ab331-142">Внешний интерфейс пограничного сервера, на котором работает служба EDGE, должен использовать общедоступные IP-адреса и не преобразованием NAT или порта на любые внешние IP-адреса Edge.</span><span class="sxs-lookup"><span data-stu-id="ab331-142">The external interface of the Edge Server running the A/V Edge Service must use publicly routable IP addresses and no NAT or port translation on any of the edge external IP addresses.</span></span> 
    
- <span data-ttu-id="ab331-143">Балансировщик нагрузки не должен изменять адрес клиента.</span><span class="sxs-lookup"><span data-stu-id="ab331-143">The load balancer must not change the source address of the client.</span></span>
    
### <a name="other-hardware-load-balancer-requirements"></a><span data-ttu-id="ab331-144">Другие требования для подсистемы балансировки нагрузки для оборудования</span><span class="sxs-lookup"><span data-stu-id="ab331-144">Other Hardware Load Balancer requirements</span></span>

<span data-ttu-id="ab331-145">Требования к схожести на основе файлов cookie значительно снижены в Skype для бизнеса Server для веб-служб.</span><span class="sxs-lookup"><span data-stu-id="ab331-145">Cookie-based affinity requirements are greatly reduced in Skype for Business Server for Web services.</span></span> <span data-ttu-id="ab331-146">Если вы развертываете Skype для бизнеса Server и не сохраняете ни один из серверов переднего плана Lync Server 2010 или серверных пулов, для них не требуется постоянство на основе cookie-файлов.</span><span class="sxs-lookup"><span data-stu-id="ab331-146">If you are deploying Skype for Business Server and will not retain any Lync Server 2010 Front End Servers or Front End pools, you do not need cookie-based persistence.</span></span> <span data-ttu-id="ab331-147">Тем не менее, если вы временно или постоянно сохраняете все серверы переднего плана Lync Server 2010 или внешние пулы, вы по-прежнему используете сохраняемость на основе файлов cookie, так как она развернута и настроена для Lync Server 2010.</span><span class="sxs-lookup"><span data-stu-id="ab331-147">However, if you will temporarily or permanently retain any Lync Server 2010 Front End Servers or Front End pools, you still use cookie-based persistence as it is deployed and configured for Lync Server 2010.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="ab331-148">**Если вы все же решите использовать сходство на основе файлов cookie, хотя вашему развертыванию оно и не требуется**, это не будет иметь никаких отрицательных последствий.</span><span class="sxs-lookup"><span data-stu-id="ab331-148">**If you decide to use cookie-based affinity even though your deployment does not require it**, there is no negative impact to doing so.</span></span> 
  
<span data-ttu-id="ab331-149">Для развертываний, в которых **не будет использоваться** сходство на основе файлов cookie:</span><span class="sxs-lookup"><span data-stu-id="ab331-149">For deployments that **will not use** cookie-based affinity:</span></span>
  
- <span data-ttu-id="ab331-150">В правиле публикации обратного прокси-сервера через порт 4443, установите значение True для параметра **Перенаправлять заголовок узла**.</span><span class="sxs-lookup"><span data-stu-id="ab331-150">On the reverse proxy publishing rule for port 4443, set **Forward host header** to True.</span></span> <span data-ttu-id="ab331-151">Это обеспечит перенаправление исходного URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="ab331-151">This will ensure that the original URL is forwarded.</span></span>
    
<span data-ttu-id="ab331-152">Для развертываний, в которых **будет использоваться** сходство на основе файлов cookie:</span><span class="sxs-lookup"><span data-stu-id="ab331-152">For deployments that **will use** cookie-based affinity:</span></span>
  
- <span data-ttu-id="ab331-p114">В правиле публикации обратного прокси-сервера через порт 4443, установите значение True для параметра **Перенаправлять заголовок узла**. Это обеспечит перенаправление исходного URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="ab331-p114">On the reverse proxy publishing rule for port 4443, set **Forward host header** to True. This will ensure that the original URL is forwarded.</span></span>
    
- <span data-ttu-id="ab331-155">Файл cookie для аппаратного балансировщика нагрузки НЕ ДОЛЖЕН помечаться как httpOnly</span><span class="sxs-lookup"><span data-stu-id="ab331-155">Hardware load balancer cookie MUST NOT be marked httpOnly</span></span>
    
- <span data-ttu-id="ab331-156">Файл cookie для аппаратного балансировщика нагрузки НЕ ДОЛЖЕН быть ограничен сроком действия</span><span class="sxs-lookup"><span data-stu-id="ab331-156">Hardware load balancer cookie MUST NOT have an expiration time</span></span>
    
- <span data-ttu-id="ab331-157">Файл cookie для аппаратного балансировщика нагрузки ДОЛЖЕН иметь имя **MS-WSMAN** (веб-службы ожидают это значение, его нельзя менять)</span><span class="sxs-lookup"><span data-stu-id="ab331-157">Hardware load balancer cookie MUST be named **MS-WSMAN** (This is the value that the Web services expect, and cannot be changed)</span></span>
    
- <span data-ttu-id="ab331-p115">Режим использования файлов cookie ДОЛЖЕН задаваться в каждом ответе HTTP, для которого входящий запрос HTTP не имел файла cookie, даже если файл cookie был уже получен предыдущим ответом HTTP в том же соединении TCP. Если балансировщик нагрузки при оптимизации допускает только одну вставку файла cookie для каждого соединения TCP, такая оптимизация НЕ ДОЛЖНА применяться.</span><span class="sxs-lookup"><span data-stu-id="ab331-p115">Hardware load balancer cookie MUST be set in every HTTP response for which the incoming HTTP request did not have a cookie, regardless of whether a previous HTTP response on that same TCP connection had already obtained a cookie. If the load balancer optimizes cookie insert to only occur once per TCP connection, that optimization MUST NOT be used</span></span>
    
> [!NOTE]
> <span data-ttu-id="ab331-160">Типичные конфигурации подсистемы балансировки нагрузки аппаратных средств используют сходство с исходным адресом и время жизни сеанса TCP мин., что подходит для клиентов Lync Server и Lync 2013, поскольку состояние сеанса поддерживается с помощью клиента и (или) взаимодействия с приложением.</span><span class="sxs-lookup"><span data-stu-id="ab331-160">Typical hardware load balancer configurations use source-address affinity and a 20 min. TCP session lifetime, which is fine for Lync Server and Lync 2013 clients because session state is maintained through client usage and/or and application interaction.</span></span> 
  
<span data-ttu-id="ab331-161">При развертывании мобильных устройств ваш аппаратный балансировщик нагрузки должен поддерживать возможность балансировки нагрузки для индивидуальных запросов в рамках сеанса TCP (фактически необходима возможность балансировки нагрузки индивидуальных запросов на основе целевого IP-адреса).</span><span class="sxs-lookup"><span data-stu-id="ab331-161">If you are deploying mobile devices, your hardware load balancer must be able to load balance individual request within a TCP session (in effect, you must be able to load balance an individual request based on the target IP address).</span></span>
  
> [!CAUTION]
> <span data-ttu-id="ab331-162">Если вы развертываете мобильные устройства, аппаратная подсистема балансировки нагрузки должна поддерживать балансировку нагрузки каждого запроса в TCP-соединении по отдельности.</span><span class="sxs-lookup"><span data-stu-id="ab331-162">If you are deploying mobile devices, your hardware load balancer must be able to individually load balance each request within a TCP connection.</span></span> <span data-ttu-id="ab331-163">Последним приложениям Apple iOS для мобильных устройств требуется протокол TLS версии 1.2.</span><span class="sxs-lookup"><span data-stu-id="ab331-163">The latest Apple iOS mobile apps require Transport Layer Security (TLS) version 1.2.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="ab331-164">Подробные сведения о подсистемах балансировки нагрузки оборудования для сторонних производителей можно найти в разделе [инфраструктура Skype для бизнеса](https://docs.microsoft.com/SkypeForBusiness/certification/infra-gateways).</span><span class="sxs-lookup"><span data-stu-id="ab331-164">For details on third party hardware load balancers, see [Infrastructure for Skype for Business](https://docs.microsoft.com/SkypeForBusiness/certification/infra-gateways).</span></span>  
  
<span data-ttu-id="ab331-165">Ниже приводятся требования к аппаратному балансировщику нагрузки для веб-служб директора и интерфейсного пула.</span><span class="sxs-lookup"><span data-stu-id="ab331-165">Following are the hardware load balancer requirements for Director and Front End pool Web Services:</span></span>
  
- <span data-ttu-id="ab331-166">Для внутренних виртуальных IP-адресов веб-служб задайте сохраняемость Source_addr (внутренний порт 80, 443) на аппаратном балансировщике нагрузки.</span><span class="sxs-lookup"><span data-stu-id="ab331-166">For internal Web Services VIPs, set Source_addr persistence (internal port 80, 443) on the hardware load balancer.</span></span> <span data-ttu-id="ab331-167">В Skype для бизнеса Server Source_addr сохраняемость означает, что несколько подключений, поступающих с одного IP-адреса, всегда отправляются на один сервер для сохранения состояния сеанса.</span><span class="sxs-lookup"><span data-stu-id="ab331-167">For Skype for Business Server, Source_addr persistence means that multiple connections coming from a single IP address are always sent to one server to maintain session state.</span></span>
    
- <span data-ttu-id="ab331-168">В качестве таймаута простоя TCP используйте значение 1800 секунд.</span><span class="sxs-lookup"><span data-stu-id="ab331-168">Use TCP idle timeout of 1800 seconds.</span></span>
    
- <span data-ttu-id="ab331-169">На брандмауэре между обратным прокси-сервером и подсистемой балансировки нагрузки пула следующего прыжка создайте правило, разрешающее HTTPS: трафик для порта 4443, от обратного прокси-сервера до подсистемы балансировки нагрузки оборудования.</span><span class="sxs-lookup"><span data-stu-id="ab331-169">On the firewall between the reverse proxy and the next hop pool's hardware load balancer, create a rule to allow https: traffic on port 4443, from the reverse proxy to the hardware load balancer.</span></span> <span data-ttu-id="ab331-170">В аппаратном балансировщике нагрузки необходимо настроить прослушивание портов 80, 443 и 4443.</span><span class="sxs-lookup"><span data-stu-id="ab331-170">The hardware load balancer must be configured to listen on ports 80, 443, and 4443.</span></span>
    
### <a name="summary-of-hardware-load-balancer-affinity-requirements"></a><span data-ttu-id="ab331-171">Сводка требований к сходству для аппаратного балансировщика нагрузки</span><span class="sxs-lookup"><span data-stu-id="ab331-171">Summary of Hardware Load Balancer Affinity Requirements</span></span>

|<span data-ttu-id="ab331-172">**Расположение клиента или пользователя**</span><span class="sxs-lookup"><span data-stu-id="ab331-172">**Client/user location**</span></span>|<span data-ttu-id="ab331-173">**Требования к сходству внешних доменных имен веб-служб**</span><span class="sxs-lookup"><span data-stu-id="ab331-173">**External web services FQDN affinity requirements**</span></span>|<span data-ttu-id="ab331-174">**Требования к сходству внутренних доменных имен веб-служб**</span><span class="sxs-lookup"><span data-stu-id="ab331-174">**Internal web services FQDN affinity requirements**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="ab331-175">Lync Web App (внутренние и внешние пользователи)</span><span class="sxs-lookup"><span data-stu-id="ab331-175">Lync Web App (internal and external users)</span></span>  <br/> <span data-ttu-id="ab331-176">Мобильное устройство (внутренние и внешние пользователи)</span><span class="sxs-lookup"><span data-stu-id="ab331-176">Mobile device (internal and external users)</span></span>  <br/> |<span data-ttu-id="ab331-177">Без сходства</span><span class="sxs-lookup"><span data-stu-id="ab331-177">No affinity</span></span>  <br/> |<span data-ttu-id="ab331-178">Сходство исходных адресов</span><span class="sxs-lookup"><span data-stu-id="ab331-178">Source address affinity</span></span>  <br/> |
|<span data-ttu-id="ab331-179">Lync Web App (только для внешних пользователей)</span><span class="sxs-lookup"><span data-stu-id="ab331-179">Lync Web App (external users only)</span></span>  <br/> <span data-ttu-id="ab331-180">Мобильное устройство (внутренние и внешние пользователи)</span><span class="sxs-lookup"><span data-stu-id="ab331-180">Mobile device (internal and external users)</span></span>  <br/> |<span data-ttu-id="ab331-181">Без сходства</span><span class="sxs-lookup"><span data-stu-id="ab331-181">No affinity</span></span>  <br/> |<span data-ttu-id="ab331-182">Сходство исходных адресов</span><span class="sxs-lookup"><span data-stu-id="ab331-182">Source address affinity</span></span>  <br/> |
|<span data-ttu-id="ab331-183">Lync Web App (только для внутренних пользователей)</span><span class="sxs-lookup"><span data-stu-id="ab331-183">Lync Web App (internal users only)</span></span>  <br/> <span data-ttu-id="ab331-184">Мобильное устройство (без развертывания)</span><span class="sxs-lookup"><span data-stu-id="ab331-184">Mobile device (not deployed)</span></span>  <br/> |<span data-ttu-id="ab331-185">Без сходства</span><span class="sxs-lookup"><span data-stu-id="ab331-185">No affinity</span></span>  <br/> |<span data-ttu-id="ab331-186">Сходство исходных адресов</span><span class="sxs-lookup"><span data-stu-id="ab331-186">Source address affinity</span></span>  <br/> |
   
### <a name="port-monitoring-for-hardware-load-balancers"></a><span data-ttu-id="ab331-187">Мониторинг порта для аппаратных балансировщиков нагрузки</span><span class="sxs-lookup"><span data-stu-id="ab331-187">Port Monitoring for Hardware Load Balancers</span></span>

<span data-ttu-id="ab331-188">You define port monitoring on the hardware load balancers to determine when specific services are no longer available due to hardware or communications failure.</span><span class="sxs-lookup"><span data-stu-id="ab331-188">You define port monitoring on the hardware load balancers to determine when specific services are no longer available due to hardware or communications failure.</span></span> <span data-ttu-id="ab331-189">Например, если служба сервера переднего плана (РТКСРВ) останавливается из-за того, что сервер переднего плана или пул переднего плана завершает работу с ошибкой, то в этом случае монитор ХЛБ должен прекратить получать трафик на веб – службах.</span><span class="sxs-lookup"><span data-stu-id="ab331-189">For example, if the Front End Server service (RTCSRV) stops because the Front End Server or Front End pool fails, the HLB monitoring should also stop receiving traffic on the Web Services.</span></span> <span data-ttu-id="ab331-190">You implement port monitoring on the HLB to monitor the following:</span><span class="sxs-lookup"><span data-stu-id="ab331-190">You implement port monitoring on the HLB to monitor the following:</span></span>
  
<span data-ttu-id="ab331-191">**Пул пользователей сервера переднего плана — внутренний интерфейс ХЛБ**</span><span class="sxs-lookup"><span data-stu-id="ab331-191">**Front End Server User Pool - HLB Internal Interface**</span></span>

|<span data-ttu-id="ab331-192">**Виртуальный IP-адрес/порт**</span><span class="sxs-lookup"><span data-stu-id="ab331-192">**Virtual IP/Port**</span></span>|<span data-ttu-id="ab331-193">**Порт узла**</span><span class="sxs-lookup"><span data-stu-id="ab331-193">**Node Port**</span></span>|<span data-ttu-id="ab331-194">**Компьютер/монитор узла**</span><span class="sxs-lookup"><span data-stu-id="ab331-194">**Node Machine/Monitor**</span></span>|<span data-ttu-id="ab331-195">**Профиль сохраняемости**</span><span class="sxs-lookup"><span data-stu-id="ab331-195">**Persistence Profile**</span></span>|<span data-ttu-id="ab331-196">**Примечания**</span><span class="sxs-lookup"><span data-stu-id="ab331-196">**Notes**</span></span>|
|:-----|:-----|:-----|:-----|:-----|
|<span data-ttu-id="ab331-197">\<веб\>-сайт пула — int_mco_443_vs</span><span class="sxs-lookup"><span data-stu-id="ab331-197">\<pool\>web-int_mco_443_vs</span></span>  <br/> <span data-ttu-id="ab331-198">443</span><span class="sxs-lookup"><span data-stu-id="ab331-198">443</span></span>  <br/> |<span data-ttu-id="ab331-199">443</span><span class="sxs-lookup"><span data-stu-id="ab331-199">443</span></span>  <br/> |<span data-ttu-id="ab331-200">Сервер переднего плана</span><span class="sxs-lookup"><span data-stu-id="ab331-200">Front End</span></span>  <br/> <span data-ttu-id="ab331-201">5061</span><span class="sxs-lookup"><span data-stu-id="ab331-201">5061</span></span>  <br/> |<span data-ttu-id="ab331-202">Источник</span><span class="sxs-lookup"><span data-stu-id="ab331-202">Source</span></span>  <br/> |<span data-ttu-id="ab331-203">HTTPS</span><span class="sxs-lookup"><span data-stu-id="ab331-203">HTTPS</span></span>  <br/> |
|<span data-ttu-id="ab331-204">\<веб\>-сайт пула — int_mco_80_vs</span><span class="sxs-lookup"><span data-stu-id="ab331-204">\<pool\>web-int_mco_80_vs</span></span>  <br/> <span data-ttu-id="ab331-205">80</span><span class="sxs-lookup"><span data-stu-id="ab331-205">80</span></span>  <br/> |<span data-ttu-id="ab331-206">80</span><span class="sxs-lookup"><span data-stu-id="ab331-206">80</span></span>  <br/> |<span data-ttu-id="ab331-207">Сервер переднего плана</span><span class="sxs-lookup"><span data-stu-id="ab331-207">Front End</span></span>  <br/> <span data-ttu-id="ab331-208">5061</span><span class="sxs-lookup"><span data-stu-id="ab331-208">5061</span></span>  <br/> |<span data-ttu-id="ab331-209">Источник</span><span class="sxs-lookup"><span data-stu-id="ab331-209">Source</span></span>  <br/> |<span data-ttu-id="ab331-210">HTTP</span><span class="sxs-lookup"><span data-stu-id="ab331-210">HTTP</span></span>  <br/> |
   
<span data-ttu-id="ab331-211">**Пул пользователей сервера переднего плана — внешний интерфейс ХЛБ**</span><span class="sxs-lookup"><span data-stu-id="ab331-211">**Front End Server User Pool - HLB External Interface**</span></span>

|<span data-ttu-id="ab331-212">**Виртуальный IP-адрес/порт**</span><span class="sxs-lookup"><span data-stu-id="ab331-212">**Virtual IP/Port**</span></span>|<span data-ttu-id="ab331-213">**Порт узла**</span><span class="sxs-lookup"><span data-stu-id="ab331-213">**Node Port**</span></span>|<span data-ttu-id="ab331-214">**Компьютер/монитор узла**</span><span class="sxs-lookup"><span data-stu-id="ab331-214">**Node Machine/Monitor**</span></span>|<span data-ttu-id="ab331-215">**Профиль сохраняемости**</span><span class="sxs-lookup"><span data-stu-id="ab331-215">**Persistence Profile**</span></span>|<span data-ttu-id="ab331-216">**Примечания**</span><span class="sxs-lookup"><span data-stu-id="ab331-216">**Notes**</span></span>|
|:-----|:-----|:-----|:-----|:-----|
|<span data-ttu-id="ab331-217">\<web_mco_443_vs\>пула</span><span class="sxs-lookup"><span data-stu-id="ab331-217">\<pool\>web_mco_443_vs</span></span>  <br/> <span data-ttu-id="ab331-218">443</span><span class="sxs-lookup"><span data-stu-id="ab331-218">443</span></span>  <br/> |<span data-ttu-id="ab331-219">4443</span><span class="sxs-lookup"><span data-stu-id="ab331-219">4443</span></span>  <br/> |<span data-ttu-id="ab331-220">Сервер переднего плана</span><span class="sxs-lookup"><span data-stu-id="ab331-220">Front End</span></span>  <br/> <span data-ttu-id="ab331-221">5061</span><span class="sxs-lookup"><span data-stu-id="ab331-221">5061</span></span>  <br/> |<span data-ttu-id="ab331-222">Отсутствуют</span><span class="sxs-lookup"><span data-stu-id="ab331-222">None</span></span>  <br/> |<span data-ttu-id="ab331-223">HTTPS</span><span class="sxs-lookup"><span data-stu-id="ab331-223">HTTPS</span></span>  <br/> |
|<span data-ttu-id="ab331-224">\<web_mco_80_vs\>пула</span><span class="sxs-lookup"><span data-stu-id="ab331-224">\<pool\>web_mco_80_vs</span></span>  <br/> <span data-ttu-id="ab331-225">80</span><span class="sxs-lookup"><span data-stu-id="ab331-225">80</span></span>  <br/> |<span data-ttu-id="ab331-226">8080</span><span class="sxs-lookup"><span data-stu-id="ab331-226">8080</span></span>  <br/> |<span data-ttu-id="ab331-227">Сервер переднего плана</span><span class="sxs-lookup"><span data-stu-id="ab331-227">Front End</span></span>  <br/> <span data-ttu-id="ab331-228">5061</span><span class="sxs-lookup"><span data-stu-id="ab331-228">5061</span></span>  <br/> |<span data-ttu-id="ab331-229">Отсутствуют</span><span class="sxs-lookup"><span data-stu-id="ab331-229">None</span></span>  <br/> |<span data-ttu-id="ab331-230">HTTP</span><span class="sxs-lookup"><span data-stu-id="ab331-230">HTTP</span></span>  <br/> |
   
## <a name="dns-load-balancing"></a><span data-ttu-id="ab331-231">DNS Load Balancing</span><span class="sxs-lookup"><span data-stu-id="ab331-231">DNS Load Balancing</span></span>
<span data-ttu-id="ab331-232"><a name="BKMK_DNSLoadBalancing"> </a></span><span class="sxs-lookup"><span data-stu-id="ab331-232"><a name="BKMK_DNSLoadBalancing"> </a></span></span>

<span data-ttu-id="ab331-233">В Skype для бизнеса Server включена балансировка нагрузки DNS, программное решение, которое может значительно сократить расходы на администрирование для балансировки нагрузки в сети.</span><span class="sxs-lookup"><span data-stu-id="ab331-233">Skype for Business Server enables DNS load balancing, a software solution that can greatly reduce the administration overhead for load balancing on your network.</span></span> <span data-ttu-id="ab331-234">Балансировка нагрузки DNS обеспечивает баланс сетевого трафика, уникального для Skype для бизнеса Server, например трафик SIP и трафик мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="ab331-234">DNS load balancing balances the network traffic that is unique to Skype for Business Server, such as SIP traffic and media traffic.</span></span>
  
<span data-ttu-id="ab331-235">При развертывании балансировки нагрузки DNS для аппаратной подсистем балансировки нагрузки будет минимизирована нагрузка на администрирование.</span><span class="sxs-lookup"><span data-stu-id="ab331-235">If you deploy DNS load balancing, your organization's administration overhead for hardware load balancers will be minimized.</span></span> <span data-ttu-id="ab331-236">Кроме того, устранение неполадок, связанных с невозможностью устранения проблем с настройкой подсистем балансировки нагрузки для трафика SIP, будет исключено.</span><span class="sxs-lookup"><span data-stu-id="ab331-236">Additionally, complex troubleshooting of problems related to misconfiguration of load balancers for SIP traffic will be eliminated.</span></span> <span data-ttu-id="ab331-237">Кроме того, вы можете запретить соединение с сервером, чтобы вы могли перевести серверы в автономный режим.</span><span class="sxs-lookup"><span data-stu-id="ab331-237">You can also prevent server connections so that you can take servers offline.</span></span> <span data-ttu-id="ab331-238">Балансировка нагрузки DNS также гарантирует, что проблемы с подсистемой балансировки нагрузки не повлияют на элементы трафика SIP, такие как простой маршрут вызова.</span><span class="sxs-lookup"><span data-stu-id="ab331-238">DNS load balancing also ensures that hardware load balancer problems do not affect elements of SIP traffic such as basic call routing.</span></span>

<span data-ttu-id="ab331-239">На приведенной ниже схеме показан пример, включающий как внутренние, так и внешние компоненты балансировки нагрузки DNS.</span><span class="sxs-lookup"><span data-stu-id="ab331-239">The following diagram shows an example that includes both internal and external DNS load balancing:</span></span> 
  
<span data-ttu-id="ab331-240">**Схема сети периметра с общедоступными IPv4-адресами**</span><span class="sxs-lookup"><span data-stu-id="ab331-240">**Edge network diagram using Public IPv4 addresses**</span></span>

![Пример схемы сети DNS](../../media/2cc9546e-5560-4d95-8fe4-65a792a0e9c3.png)
  
<span data-ttu-id="ab331-242">При использовании балансировки нагрузки DNS вы также можете приобрести более низкие затраты на подсистемы балансировки нагрузки для оборудования, чем при использовании аппаратных подсистем балансировки нагрузки для всех типов трафика.</span><span class="sxs-lookup"><span data-stu-id="ab331-242">If you use DNS load balancing, you may also be able to purchase lower-cost hardware load balancers than if you used the hardware load balancers for all types of traffic.</span></span> <span data-ttu-id="ab331-243">Вы должны использовать балансировщик нагрузки, который прошел проверочное тестирование взаимодействия с приложением Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="ab331-243">You should use load balancers that have passed interoperability qualification testing with Skype for Business Server.</span></span> <span data-ttu-id="ab331-244">Подробнее об испытаниях о взаимодействии подсистемы балансировки нагрузки можно найти в статьях [партнеров по подсистемам загрузки для Lync Server 2010](https://go.microsoft.com/fwlink/p/?linkId=202452).</span><span class="sxs-lookup"><span data-stu-id="ab331-244">For details about load balancer interoperability testing, see [Lync Server 2010 Load Balancer Partners](https://go.microsoft.com/fwlink/p/?linkId=202452).</span></span> <span data-ttu-id="ab331-245">Содержимое, относящееся к Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="ab331-245">The content there applies to Skype for Business Server.</span></span>
  
<span data-ttu-id="ab331-246">Балансировка нагрузки DNS поддерживается для пулов интерфейсов, пулов пограничного сервера, пулов и изолированных серверных пулов.</span><span class="sxs-lookup"><span data-stu-id="ab331-246">DNS load balancing is supported for Front End pools, Edge Server pools, Director pools, and stand-alone Mediation Server pools.</span></span>
  
<span data-ttu-id="ab331-247">Балансировка нагрузки DNS обычно реализуется на уровне приложения.</span><span class="sxs-lookup"><span data-stu-id="ab331-247">DNS load balancing is typically implemented at the application level.</span></span> <span data-ttu-id="ab331-248">Приложение (например, клиент, использующий Skype для бизнеса) пытается подключиться к серверу в пуле, подключив один из IP-адресов, возвращенных из DNS A и AAAA (если используется адресация IPv6), для запроса на запись полного доменного имени пула (FQDN).</span><span class="sxs-lookup"><span data-stu-id="ab331-248">The application (for example, a client running Skype for Business), tries to connect to a server in a pool by connecting to one of the IP addresses returned from the DNS A and AAAA (if IPv6 addressing is used) record query for the pool fully qualified domain name (FQDN).</span></span> 
  
<span data-ttu-id="ab331-249">Например, если у вас есть три внешних сервера в пуле с именем pool01.contoso.com, произойдет следующее:</span><span class="sxs-lookup"><span data-stu-id="ab331-249">For example, if there are three front end servers in a pool named pool01.contoso.com, the following will happen:</span></span>
  
- <span data-ttu-id="ab331-250">Клиенты, использующие Skype для бизнеса, запрашивают DNS для pool01.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="ab331-250">Clients running Skype for Business query DNS for pool01.contoso.com.</span></span> <span data-ttu-id="ab331-251">Запрос возвращает три IP-адреса и кэширует их следующим образом (необязательно в указанном порядке):</span><span class="sxs-lookup"><span data-stu-id="ab331-251">The query returns three IP addresses and caches them as follows (not necessarily in this order):</span></span>
    
    <span data-ttu-id="ab331-252">pool01.contoso.com 192.168.10.90</span><span class="sxs-lookup"><span data-stu-id="ab331-252">pool01.contoso.com 192.168.10.90</span></span>
    
    <span data-ttu-id="ab331-253">pool01.contoso.com 192.168.10.91</span><span class="sxs-lookup"><span data-stu-id="ab331-253">pool01.contoso.com 192.168.10.91</span></span>
    
    <span data-ttu-id="ab331-254">pool01.contoso.com 192.168.10.92</span><span class="sxs-lookup"><span data-stu-id="ab331-254">pool01.contoso.com 192.168.10.92</span></span>
    
- <span data-ttu-id="ab331-255">Клиент пытается установить подключение по протоколу TCP к одному из IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="ab331-255">The client attempts to establish a Transmission Control Protocol (TCP) connection to one of the IP addresses.</span></span> <span data-ttu-id="ab331-256">Если это не удается, клиент попытается выполнить следующий IP-адрес в кэше.</span><span class="sxs-lookup"><span data-stu-id="ab331-256">If that fails, the client tries the next IP address in the cache.</span></span>
    
- <span data-ttu-id="ab331-257">Если подключение TCP успешно установлено, клиент согласует TLS для подключения к основному регистратору на pool01.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="ab331-257">If the TCP connection succeeds, the client negotiates TLS to connect to the primary registrar on pool01.contoso.com.</span></span>
    
- <span data-ttu-id="ab331-258">Если клиент попытается получить все кэшированные записи без успешного соединения, пользователь получит уведомление о том, что в данный момент серверы, на которых работает Skype для бизнеса Server, не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="ab331-258">If the client tries all cached entries without a successful connection, the user is notified that no servers running Skype for Business Server are available at the moment.</span></span>
    
> [!NOTE]
> <span data-ttu-id="ab331-259">Балансировка нагрузки на основе DNS отличается от циклического перегрузки DNS (DNS RR), который, как правило, указывает на балансировку нагрузки, используя DNS для предоставления другого порядка IP-адресов, соответствующих серверам в пуле.</span><span class="sxs-lookup"><span data-stu-id="ab331-259">DNS-based load balancing is different from DNS round robin (DNS RR) which typically refers to load balancing by relying on DNS to provide a different order of IP addresses corresponding to the servers in a pool.</span></span> <span data-ttu-id="ab331-260">Обычно DNS RR включает распределение нагрузки, но не включает отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="ab331-260">Typically DNS RR only enables load distribution, but does not enable failover.</span></span> <span data-ttu-id="ab331-261">Например, если при попытке подключения к одному IP-адресу, возвращенному DNS A и AAAA (при использовании адресации IPv6) происходит сбой, происходит сбой подключения.</span><span class="sxs-lookup"><span data-stu-id="ab331-261">For example, if the connection to the one IP address returned by the DNS A and AAAA (if you are using IPv6 addressing) query fails, the connection fails.</span></span> <span data-ttu-id="ab331-262">Таким образом, служба DNS-цикл по отдельности является менее надежной, чем балансировка нагрузки на основе DNS.</span><span class="sxs-lookup"><span data-stu-id="ab331-262">Therefore, DNS round robin by itself is less reliable than DNS-based load balancing.</span></span> <span data-ttu-id="ab331-263">С помощью средства балансировки нагрузки DNS вы можете использовать DNS-циклы в сочетании.</span><span class="sxs-lookup"><span data-stu-id="ab331-263">You can use DNS round robin in conjunction with DNS load balancing.</span></span> 
  
<span data-ttu-id="ab331-264">Балансировка нагрузки DNS используется для указанных ниже действий.</span><span class="sxs-lookup"><span data-stu-id="ab331-264">DNS load balancing is used for the following:</span></span>
  
- <span data-ttu-id="ab331-265">Балансировка нагрузки Серверная SIP на сервер пограничного сервера</span><span class="sxs-lookup"><span data-stu-id="ab331-265">Load balancing server-to-server SIP to the Edge Servers</span></span>
    
- <span data-ttu-id="ab331-266">Приложения для балансировки нагрузки служб приложений (укас), такие как автосекретарь конференц-связи, группа ответа и метод приостановки</span><span class="sxs-lookup"><span data-stu-id="ab331-266">Load balancing Unified Communications Application Services (UCAS) applications such as Conferencing Auto Attendant, Response Group, and Call Park</span></span>
    
- <span data-ttu-id="ab331-267">Предотвращение новых подключений к укас приложениям (также называемым "стоком")</span><span class="sxs-lookup"><span data-stu-id="ab331-267">Preventing new connections to UCAS applications (also known as "draining")</span></span>
    
- <span data-ttu-id="ab331-268">Балансировка нагрузки весь трафик между клиентами и серверами пограничного сервера между клиентом и сервером</span><span class="sxs-lookup"><span data-stu-id="ab331-268">Load balancing all client-to-server traffic between clients and Edge Servers</span></span>
    
<span data-ttu-id="ab331-269">Балансировка нагрузки DNS не может использоваться для указанных ниже действий.</span><span class="sxs-lookup"><span data-stu-id="ab331-269">DNS load balancing cannot be used for the following:</span></span>
  
- <span data-ttu-id="ab331-270">Веб-трафик между клиентом и сервером в директории или на серверах переднего плана</span><span class="sxs-lookup"><span data-stu-id="ab331-270">Client-to-server web traffic to Director or Front End Servers</span></span>
    
<span data-ttu-id="ab331-271">Балансировка нагрузки DNS и федеративный трафик:</span><span class="sxs-lookup"><span data-stu-id="ab331-271">DNS load balancing and federated traffic:</span></span>
  
<span data-ttu-id="ab331-272">Если DNS SRV-запрос возвращает несколько DNS-записей, служба Edge Access всегда выберет DNS SRV-запись с наименьшим порядковым номером и наивысшим числовым весом.</span><span class="sxs-lookup"><span data-stu-id="ab331-272">If multiple DNS records are returned by a DNS SRV query, the Access Edge service always picks the DNS SRV record with the lowest numeric priority and highest numeric weight.</span></span> <span data-ttu-id="ab331-273">Задача "Проектирование интернет-ресурсов" принудительно определяет расположение служб (DNS SRV) " [RFC 2782, DNS SRV RR](https://www.ietf.org/rfc/rfc2782.txt) ", если определено несколько записей SRV DNS, приоритет используется первым, а затем — толщина.</span><span class="sxs-lookup"><span data-stu-id="ab331-273">The Internet Engineering Task Force document "A DNS RR for specifying the location of services (DNS SRV)" [RFC 2782, DNS SRV RR](https://www.ietf.org/rfc/rfc2782.txt) specifies that if there are multiple DNS SRV records defined, priority is first used, then weight.</span></span> <span data-ttu-id="ab331-274">Например, запись DNS SRV A имеет вес 20 и приоритет 40, а запись DNS SRV B имеет вес 10 и приоритет 50.</span><span class="sxs-lookup"><span data-stu-id="ab331-274">For example DNS SRV record A has a weight of 20 and a priority of 40 and DNS SRV record B has a weight of 10 and priority of 50.</span></span> <span data-ttu-id="ab331-275">Будет выбрана запись DNS SRV с приоритетом 40.</span><span class="sxs-lookup"><span data-stu-id="ab331-275">DNS SRV record A with priority 40 will be selected.</span></span> <span data-ttu-id="ab331-276">Следующие правила применяются к выбору DNS SRV-записей.</span><span class="sxs-lookup"><span data-stu-id="ab331-276">The following rules apply to DNS SRV record selection:</span></span>
  
- <span data-ttu-id="ab331-277">Приоритет считается первым.</span><span class="sxs-lookup"><span data-stu-id="ab331-277">Priority is considered first.</span></span> <span data-ttu-id="ab331-278">Клиент должен попытаться связаться с конечным узлом, определенным DNS SRV-записью с минимальным номером приоритета, к которому он может получить доступ.</span><span class="sxs-lookup"><span data-stu-id="ab331-278">A client MUST attempt to contact the target host defined by the DNS SRV record with the lowest numbered priority it can reach.</span></span> <span data-ttu-id="ab331-279">Целевые объекты с одинаковым приоритетом должны быть предприняты в порядке, определенном полем веса.</span><span class="sxs-lookup"><span data-stu-id="ab331-279">Targets with the same priority SHOULD be tried in an order defined by the weight field.</span></span>
    
- <span data-ttu-id="ab331-280">Поле «Толщина» задает относительный вес для операций с одинаковым приоритетом.</span><span class="sxs-lookup"><span data-stu-id="ab331-280">The weight field specifies a relative weight for entries with the same priority.</span></span> <span data-ttu-id="ab331-281">Более крупные весовые значения должны быть заданы пропорционально более высокой вероятностью выбора.</span><span class="sxs-lookup"><span data-stu-id="ab331-281">Larger weights SHOULD be given a proportionately higher probability of being selected.</span></span> <span data-ttu-id="ab331-282">Администраторам DNS следует использовать толщину 0, если не выбран ни один сервер.</span><span class="sxs-lookup"><span data-stu-id="ab331-282">DNS administrators SHOULD use Weight 0 when there isn't any server selection to do.</span></span> <span data-ttu-id="ab331-283">При наличии записей, содержащих значения веса больше 0, записи с весом 0 должны иметь очень малую вероятность выбора.</span><span class="sxs-lookup"><span data-stu-id="ab331-283">In the presence of records containing weights greater than 0, records with weight 0 should have a very small chance of being selected.</span></span>
    
<span data-ttu-id="ab331-284">Если возвращено несколько записей DNS SRV с одинаковыми приоритетами и весовыми коэффициентами, служба Edge Access выберет запись SRV, полученную первой на DNS-сервере.</span><span class="sxs-lookup"><span data-stu-id="ab331-284">If multiple DNS SRV records with equal priority and weight are returned, the Access Edge service will select the SRV record that was received first from the DNS server.</span></span>
  
### <a name="dns-load-balancing-on-front-end-pools-and-director-pools"></a><span data-ttu-id="ab331-285">Балансировка нагрузки DNS для пулов и пулов переднего плана</span><span class="sxs-lookup"><span data-stu-id="ab331-285">DNS Load Balancing on Front End Pools and Director Pools</span></span>

<span data-ttu-id="ab331-286">Балансировку нагрузки DNS можно использовать для трафика SIP на пулах и пулах интерфейсов переднего плана.</span><span class="sxs-lookup"><span data-stu-id="ab331-286">You can use DNS load balancing for the SIP traffic on Front End pools and Director pools.</span></span> <span data-ttu-id="ab331-287">После развертывания балансировки нагрузки DNS для этих пулов также необходимо использовать балансировку нагрузки оборудования, но только для трафика HTTPS между клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="ab331-287">With DNS load balancing deployed, you still need to also use hardware load balancers for these pools, but only for client-to-server HTTPS traffic.</span></span> <span data-ttu-id="ab331-288">Подсистема балансировки нагрузки аппаратных средств используется для трафика HTTPS от клиентов через порты 443 и 80.</span><span class="sxs-lookup"><span data-stu-id="ab331-288">The hardware load balancer is used for HTTPS traffic from clients over ports 443 and 80.</span></span> 
  
<span data-ttu-id="ab331-289">Несмотря на то, что для этих пулов по-прежнему нужны подсистемы балансировки нагрузки, их настройка и администрирование будут главным образом для трафика HTTPS, с которыми связаны администраторы подсистемы балансировки нагрузки оборудования.</span><span class="sxs-lookup"><span data-stu-id="ab331-289">Although you still need hardware load balancers for these pools, their setup and administration will be primarily for HTTPS traffic, which the administrators of hardware load balancers are accustomed to.</span></span>
  
#### <a name="dns-load-balancing-and-supporting-older-clients-and-servers"></a><span data-ttu-id="ab331-290">Балансировка нагрузки DNS и поддержка более ранних версий клиентов и серверов</span><span class="sxs-lookup"><span data-stu-id="ab331-290">DNS Load Balancing and Supporting Older Clients and Servers</span></span>

<span data-ttu-id="ab331-291">Балансировка нагрузки DNS поддерживает автоматический переход на другой ресурс только для серверов, использующих Skype для бизнеса Server или Lync Server 2010, а также для клиентов Lync 2013 и Skype для бизнеса.</span><span class="sxs-lookup"><span data-stu-id="ab331-291">DNS load balancing supports automatic failover only for servers running Skype for Business Server or Lync Server 2010, and for Lync 2013 and Skype for Business clients.</span></span> <span data-ttu-id="ab331-292">Более ранние версии клиентов и Office Communications Server по-прежнему могут подключаться к пулам с помощью балансировки нагрузки DNS, но если им не удается подключиться к первому серверу, на котором они ссылаются, они не смогут переключиться на другой сервер в пуле. .</span><span class="sxs-lookup"><span data-stu-id="ab331-292">Earlier versions of clients and Office Communications Server can still connect to pools running DNS load balancing, but if they cannot make a connection to the first server that DNS load balancing refers them to, they are unable to fail over to another server in the pool.</span></span> 
  
<span data-ttu-id="ab331-293">Кроме того, если вы используете единую систему обмена сообщениями Exchange, для получения поддержки балансировки нагрузки DNS в Skype для бизнеса Server необходимо использовать минимум Exchange 2010 с пакетом обновления 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="ab331-293">Additionally, if you are using Exchange UM, you must use a minimum of Exchange 2010 SP1 to get support for Skype for Business Server DNS load balancing.</span></span> <span data-ttu-id="ab331-294">Если вы используете более раннюю версию Exchange, для этих сценариев Exchange UM ваши пользователи не будут иметь возможности отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="ab331-294">If you use an earlier version of Exchange, your users will not have failover capabilities for these Exchange UM scenarios:</span></span>
  
- <span data-ttu-id="ab331-295">Воспроизведение корпоративной голосовой почты на телефоне</span><span class="sxs-lookup"><span data-stu-id="ab331-295">Playing their Enterprise voicemail on their phone</span></span>
    
- <span data-ttu-id="ab331-296">Передача звонков из автосекретаря UM Exchange</span><span class="sxs-lookup"><span data-stu-id="ab331-296">Transferring calls from an Exchange UM Auto Attendant</span></span>
    
<span data-ttu-id="ab331-297">Все остальные сценарии UM Exchange будут работать правильно.</span><span class="sxs-lookup"><span data-stu-id="ab331-297">All other Exchange UM scenarios will work properly.</span></span>
  
#### <a name="deploying-dns-load-balancing-on-front-end-pools-and-director-pools"></a><span data-ttu-id="ab331-298">Развертывание балансировки нагрузки DNS для пулов и пулов с интерфейсом на стороне сервера</span><span class="sxs-lookup"><span data-stu-id="ab331-298">Deploying DNS Load Balancing on Front End Pools and Director Pools</span></span>
<span data-ttu-id="ab331-299"><a name="BK_FE_Dir"> </a></span><span class="sxs-lookup"><span data-stu-id="ab331-299"><a name="BK_FE_Dir"> </a></span></span>

<span data-ttu-id="ab331-300">Для развертывания балансировки нагрузки DNS на интерфейсах пулов и пулов с внешним интерфейсом необходимо выполнить несколько дополнительных действий с полными доменными данными и DNS-записями.</span><span class="sxs-lookup"><span data-stu-id="ab331-300">Deploying DNS load balancing on Front End pools and Director pools requires you to perform a couple of extra steps with FQDNs and DNS records.</span></span>
  
- <span data-ttu-id="ab331-301">Пул, использующий балансировку нагрузки DNS, должен иметь два полных доменных имен: обычное полное доменное имя пула, используемое службой балансировки нагрузки DNS (например, pool01.contoso.com), и разрешение на физические IP-адреса серверов в пуле, а также другое полное доменное имя (например, web01.contoso.com), который разрешается в виртуальный IP-адрес пула.</span><span class="sxs-lookup"><span data-stu-id="ab331-301">A pool that uses DNS load balancing must have two FQDNs: the regular pool FQDN that is used by DNS load balancing (such as pool01.contoso.com), and resolves to the physical IPs of the servers in the pool, and another FQDN for the pool's Web services (such as web01.contoso.com), which resolves to virtual IP address of the pool.</span></span> 
    
    <span data-ttu-id="ab331-302">В построителе топологии, если вы хотите развернуть балансировку нагрузки DNS для пула, чтобы создать это дополнительное полное доменное имя для веб-служб пула, необходимо установить флажок **переопределить полное доменное имя пула веб-служб** и ввести полное доменное имя в поле **указать URL-адреса для этой страницы пула** .</span><span class="sxs-lookup"><span data-stu-id="ab331-302">In Topology Builder, if you want to deploy DNS load balancing for a pool, to create this extra FQDN for the pool's Web services you must select the **Override internal Web Services pool FQDN** check box and type the FQDN, in the **Specify the Web Services URLs for this Pool** page.</span></span>
    
- <span data-ttu-id="ab331-303">Для поддержки полного доменного имени, используемого службой балансировки нагрузки DNS, необходимо подготовить DNS для разрешения полного доменного имени пула (например, pool01.contoso.com) в IP-адреса всех серверов в пуле (например, 192.168.1.1, 192.168.1.2 и т. д.).</span><span class="sxs-lookup"><span data-stu-id="ab331-303">To support the FQDN used by DNS load balancing, you must provision DNS to resolve the pool FQDN (such as pool01.contoso.com) to the IP addresses of all the servers in the pool (for example, 192.168.1.1, 192.168.1.2, and so on).</span></span> <span data-ttu-id="ab331-304">Вы должны включать только IP-адреса серверов, которые развернут в данный момент.</span><span class="sxs-lookup"><span data-stu-id="ab331-304">You should include only the IP addresses of servers that are currently deployed.</span></span>
    
    > [!CAUTION]
    > <span data-ttu-id="ab331-305">Если у вас более одного пула переднего плана или сервера переднего плана, полное доменное имя внешней веб-службы должно быть уникальным.</span><span class="sxs-lookup"><span data-stu-id="ab331-305">If you have more than one Front End pool or Front End Server the external Web services FQDN must be unique.</span></span> <span data-ttu-id="ab331-306">Например, если вы определяете полное доменное имя внешней веб-службы на сервере переднего плана как **pool01.contoso.com**, вы не сможете использовать **pool01.contoso.com** для другого пула переднего плана или сервера переднего плана.</span><span class="sxs-lookup"><span data-stu-id="ab331-306">For example, if you define the external Web services FQDN of a Front End Server as **pool01.contoso.com**, you cannot use **pool01.contoso.com** for another Front End pool or Front End Server.</span></span> <span data-ttu-id="ab331-307">Если вы также разворачиваете директоров, то полные доменные имена внешних веб-служб, определенные для любого режиссера или режиссера, должны быть уникальными из любого другого директора или пула и внешнего сервера.</span><span class="sxs-lookup"><span data-stu-id="ab331-307">If you are also deploying Directors, the external Web services FQDN defined for any Director or Director pool must be unique from any other Director or Director pool as well as any Front End pool or Front End Server.</span></span> <span data-ttu-id="ab331-308">Если вы решите переопределить внутренние веб-службы с помощью самоопределенного полного доменного имени, каждое полное доменное имя должно быть уникальным из любого другого пула переднего плана, режиссера или директора пула.</span><span class="sxs-lookup"><span data-stu-id="ab331-308">If decide to override the Internal web services with a self-defined FQDN, each FQDN must be unique from any other Front End pool, Director or a Director pool.</span></span>
  
### <a name="dns-load-balancing-on-edge-server-pools"></a><span data-ttu-id="ab331-309">Балансировка нагрузки DNS для пулов пограничного сервера</span><span class="sxs-lookup"><span data-stu-id="ab331-309">DNS Load Balancing on Edge Server Pools</span></span>
<span data-ttu-id="ab331-310"><a name="BK_Edge"> </a></span><span class="sxs-lookup"><span data-stu-id="ab331-310"><a name="BK_Edge"> </a></span></span>

<span data-ttu-id="ab331-311">Вы можете развернуть балансировку нагрузки DNS для пулов пограничного сервера.</span><span class="sxs-lookup"><span data-stu-id="ab331-311">You can deploy DNS load balancing on Edge Server pools.</span></span> <span data-ttu-id="ab331-312">В противном случае необходимо учитывать некоторые моменты.</span><span class="sxs-lookup"><span data-stu-id="ab331-312">If you do, you must be aware of some considerations.</span></span>
  
<span data-ttu-id="ab331-313">Использование балансировки нагрузки DNS на пограничных серверах приводит к потере возможности отработки отказа в следующих сценариях.</span><span class="sxs-lookup"><span data-stu-id="ab331-313">Using DNS load balancing on your Edge Servers causes a loss of failover ability in the following scenarios:</span></span>
  
- <span data-ttu-id="ab331-314">Интеграция с организациями, на которых запущены версии Skype для бизнеса Server, выпущенные до Lync Server 2010.</span><span class="sxs-lookup"><span data-stu-id="ab331-314">Federation with organizations that are running versions of Skype for Business Server released prior to Lync Server 2010.</span></span>
    
- <span data-ttu-id="ab331-315">Обмен мгновенными сообщениями с пользователями общедоступных служб обмена мгновенными сообщениями (AOL) и Yahoo!, в дополнение к КСМПП поставщикам и серверам, например Google чата, в настоящее время единственным поддерживаемым партнером КСМПП.</span><span class="sxs-lookup"><span data-stu-id="ab331-315">Instant message exchange with users of public instant messaging (IM) services AOL and Yahoo!, in addition to XMPP-based providers and servers, such as Google Talk, currently the only supported XMPP partner.</span></span>
    
<span data-ttu-id="ab331-316">Эти сценарии будут работать до тех пор, пока все пограничные серверы пула работают и выполняются, но если один пограничный сервер недоступен, любые запросы к этим сценариям, которые отправляются на него, будут завершаться сбоем вместо маршрутизации на другой пограничный сервер.</span><span class="sxs-lookup"><span data-stu-id="ab331-316">These scenarios will work as long as all Edge Servers in the pool are up and running, but if one Edge Server is unavailable, any requests for these scenarios that are sent to it will fail, instead of routing to another Edge Server.</span></span>
  
 <span data-ttu-id="ab331-317">Если вы используете систему обмена СООБЩЕНИЯми Exchange, для получения поддержки балансировки нагрузки DNS для Microsoft Skype для бизнеса Server в Edge необходимо использовать минимум Exchange 2013.</span><span class="sxs-lookup"><span data-stu-id="ab331-317">If you are using Exchange UM, you must use a minimum of Exchange 2013 to get support for Skype for Business Server DNS load balancing on Edge.</span></span> <span data-ttu-id="ab331-318">Если вы используете более раннюю версию Exchange, удаленные пользователи не будут иметь возможности отработки отказа для этих сценариев Exchange UM.</span><span class="sxs-lookup"><span data-stu-id="ab331-318">If you use an earlier version of Exchange, your remote users will not have failover capabilities for these Exchange UM scenarios:</span></span>
  
- <span data-ttu-id="ab331-319">Воспроизведение корпоративной голосовой почты на телефоне</span><span class="sxs-lookup"><span data-stu-id="ab331-319">Playing their Enterprise voicemail on their phone</span></span>
    
- <span data-ttu-id="ab331-320">Передача звонков из автосекретаря UM Exchange</span><span class="sxs-lookup"><span data-stu-id="ab331-320">Transferring calls from an Exchange UM Auto Attendant</span></span>
    
<span data-ttu-id="ab331-321">Все остальные сценарии UM Exchange будут работать правильно.</span><span class="sxs-lookup"><span data-stu-id="ab331-321">All other Exchange UM scenarios will work properly.</span></span>
  
<span data-ttu-id="ab331-322">Балансировка нагрузки на внутреннем и внешнем пограничным интерфейсах должна относиться к одному и тому же типу.</span><span class="sxs-lookup"><span data-stu-id="ab331-322">The internal Edge interface and external Edge interface must use the same type of load balancing.</span></span> <span data-ttu-id="ab331-323">Невозможно осуществлять балансировку нагрузки на одном пограничном интерфейсе средствами DNS, а на другом — аппаратными средствами.</span><span class="sxs-lookup"><span data-stu-id="ab331-323">You cannot use DNS load balancing on one Edge interface and hardware load balancing on the other Edge interface.</span></span>
  
#### <a name="deploying-dns-load-balancing-on-edge-server-pools"></a><span data-ttu-id="ab331-324">Развертывание балансировки нагрузки DNS для пулов пограничного сервера</span><span class="sxs-lookup"><span data-stu-id="ab331-324">Deploying DNS Load Balancing on Edge Server Pools</span></span>

<span data-ttu-id="ab331-325">Для развертывания балансировки нагрузки DNS на внешнем интерфейсе пула пограничного сервера вам понадобятся указанные ниже DNS-записи.</span><span class="sxs-lookup"><span data-stu-id="ab331-325">To deploy DNS load balancing on the external interface of your Edge Server pool, you need the following DNS entries:</span></span>
  
- <span data-ttu-id="ab331-326">Для службы Edge Access требуется одна запись для каждого сервера в пуле.</span><span class="sxs-lookup"><span data-stu-id="ab331-326">For the Access Edge service, you need one entry for each server in the pool.</span></span> <span data-ttu-id="ab331-327">Каждая запись должна разрешать полное доменное имя службы пограничного доступа (например, sip.contoso.com) в IP-адрес службы пограничного доступа на одном из пограничных серверов в пуле.</span><span class="sxs-lookup"><span data-stu-id="ab331-327">Each entry must resolve the FQDN of the Access Edge service (for example, sip.contoso.com) to the IP address of the Access Edge service on one of the Edge Servers in the pool.</span></span>
    
- <span data-ttu-id="ab331-328">Для службы Edge для веб-конференций требуется одна запись для каждого сервера в пуле.</span><span class="sxs-lookup"><span data-stu-id="ab331-328">For the Web Conferencing Edge service, you need one entry for each server in the pool.</span></span> <span data-ttu-id="ab331-329">Каждая запись должна разрешать полное доменное имя службы пограничного веб-конференции (например, webconf.contoso.com) в IP-адрес службы пограничного веб-конференции на одном из пограничных серверов в пуле.</span><span class="sxs-lookup"><span data-stu-id="ab331-329">Each entry must resolve the FQDN of the Web Conferencing Edge service (for example, webconf.contoso.com) to the IP address of the Web Conferencing Edge service on one of the Edge Servers in the pool.</span></span>
    
- <span data-ttu-id="ab331-330">Для службы аудио/видеоedge вам потребуется одна запись для каждого сервера в пуле.</span><span class="sxs-lookup"><span data-stu-id="ab331-330">For the Audio/Video Edge service, you need one entry for each server in the pool.</span></span> <span data-ttu-id="ab331-331">Каждая запись должна разрешать полное доменное имя (например, av.contoso.com) в IP-адресе службы EDGE на одном из пограничных серверов в пуле.</span><span class="sxs-lookup"><span data-stu-id="ab331-331">Each entry must resolve the FQDN of the Audio/Video Edge service (for example, av.contoso.com) to the IP address of the A/V Edge service on one of the Edge Servers in the pool.</span></span>
    
<span data-ttu-id="ab331-332">Для развертывания балансировки нагрузки DNS на внутреннем интерфейсе пула пограничного сервера необходимо добавить одну запись DNS A, которая разрешает внутреннее полное доменное имя пула пограничного сервера в IP-адрес каждого сервера в пуле.</span><span class="sxs-lookup"><span data-stu-id="ab331-332">To deploy DNS load balancing on the internal interface of your Edge Server pool, you must add one DNS A record, which resolves the internal FQDN of the Edge Server pool to the IP address of each server in the pool.</span></span>
  
### <a name="using-dns-load-balancing-on-mediation-server-pools"></a><span data-ttu-id="ab331-333">Использование балансировки нагрузки DNS для пулов серверов исправлений</span><span class="sxs-lookup"><span data-stu-id="ab331-333">Using DNS Load Balancing on Mediation Server Pools</span></span>
<span data-ttu-id="ab331-334"><a name="BK_Mediation"> </a></span><span class="sxs-lookup"><span data-stu-id="ab331-334"><a name="BK_Mediation"> </a></span></span>

<span data-ttu-id="ab331-335">Вы можете использовать балансировку нагрузки DNS для пулов серверов с изолированными исправлениями.</span><span class="sxs-lookup"><span data-stu-id="ab331-335">You can use DNS load balancing on stand-alone Mediation Server pools.</span></span> <span data-ttu-id="ab331-336">Весь трафик SIP и мультимедиа сбалансирован с помощью балансировки нагрузки DNS.</span><span class="sxs-lookup"><span data-stu-id="ab331-336">All SIP and media traffic is balanced by DNS load balancing.</span></span>
  
<span data-ttu-id="ab331-337">Для развертывания балансировки нагрузки DNS в пуле серверов-исправлений необходимо подготовить DNS для разрешения полного доменного имени пула (например, mediationpool1.contoso.com) в IP-адреса всех серверов в пуле (например, 192.168.1.1, 192.168.1.2 и т. д.).</span><span class="sxs-lookup"><span data-stu-id="ab331-337">To deploy DNS load balancing on a Mediation Server pool, you must provision DNS to resolve the pool FQDN (for example, mediationpool1.contoso.com) to the IP addresses of all the servers in the pool (for example, 192.168.1.1, 192.168.1.2, and so on).</span></span>
  
### <a name="blocking-traffic-to-a-server-with-dns-load-balancing"></a><span data-ttu-id="ab331-338">Блокировка трафика на сервер с помощью балансировки нагрузки DNS</span><span class="sxs-lookup"><span data-stu-id="ab331-338">Blocking Traffic to a Server With DNS Load Balancing</span></span>
<span data-ttu-id="ab331-339"><a name="BK_Mediation"> </a></span><span class="sxs-lookup"><span data-stu-id="ab331-339"><a name="BK_Mediation"> </a></span></span>

<span data-ttu-id="ab331-p142">Если используется балансировка DNS-нагрузки и требуется блокировать трафик на конкретный компьютер, недостаточно просто удалить записи IP-адреса из полного имени домена пула. Необходимо также удалить DNS-запись для этого компьютера.</span><span class="sxs-lookup"><span data-stu-id="ab331-p142">If you use DNS load balancing and you need to block traffic to a specific computer, it is not sufficient to just remove the IP address entries from the Pool FQDN. You must remove the DNS entry for the computer as well.</span></span> 
  
<span data-ttu-id="ab331-342">Обратите внимание на то, что для трафика серверов и сервера в Skype для бизнеса Server используется балансировка нагрузки, учитывающая топологию.</span><span class="sxs-lookup"><span data-stu-id="ab331-342">Note that for server-to-server traffic, Skype for Business Server uses topology-aware load balancing.</span></span> <span data-ttu-id="ab331-343">Серверы считывают опубликованную топологию в хранилище Центрального управления для получения полных доменных имен серверов в топологии и автоматически распространяют трафик между серверами.</span><span class="sxs-lookup"><span data-stu-id="ab331-343">Servers read the published topology in the Central Management store to obtain the FQDNs of servers in the topology, and automatically distribute the traffic among the servers.</span></span> <span data-ttu-id="ab331-344">Чтобы запретить серверу принимать трафик "сервер-сервер", необходимо удалить сервер из топологии.</span><span class="sxs-lookup"><span data-stu-id="ab331-344">To block a server from receiving server-to-server traffic, you must remove the server from the topology.</span></span> 
  

