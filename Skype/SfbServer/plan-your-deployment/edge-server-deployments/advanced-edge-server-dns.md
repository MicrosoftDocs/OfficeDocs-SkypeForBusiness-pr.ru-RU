---
title: Расширенные пограничного сервера DNS планирование для Скайп Business Server
ms.author: heidip
author: microsoftheidi
ms.audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
localization_priority: Priority
ms.collection:
- IT_Skype16
- Strat_SB_Hybrid
ms.custom: ''
ms.assetid: f3a5895f-f64f-44eb-9a5e-8d606ac1fc38
description: 'Сводка: Обзор сценариев для Скайп для параметров развертывания Business Server. Этот раздел будет полезен при использовании как одного сервера, так и пула серверов с DNS и средствами балансировки нагрузки (HLB).'
ms.openlocfilehash: 89850bd7fdcc025b014dc1e1e38b77c4e6ddac9d
ms.sourcegitcommit: e9f277dc96265a193c6298c3556ef16ff640071d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2018
ms.locfileid: "21002293"
---
# <a name="advanced-edge-server-dns-planning-for-skype-for-business-server"></a>Расширенные пограничного сервера DNS планирование для Скайп Business Server
 
**Сводка:** Обзор сценариев для Скайп для параметров развертывания Business Server. Этот раздел будет полезен при использовании как одного сервера, так и пула серверов с DNS и средствами балансировки нагрузки (HLB).
  
Когда речь идет о доменных имен (DNS) планирование Скайп для Business Server, существует множество факторов, которые может воспроизводиться в свое решение. Если структура доменов организации уже используется, это может повлиять на ваши дальнейшие шаги. Начнем со следующих тем:
  
- [Walkthrough of Skype for Business clients locating services](../../plan-your-deployment/network-requirements/advanced-edge-server-dns.md#WalkthroughOfSkype)
    
- [Split-brain DNS](../../plan-your-deployment/network-requirements/advanced-edge-server-dns.md#SplitBrainDNS)
    
- [Automatic configuration without split-brain DNS](../../plan-your-deployment/network-requirements/advanced-edge-server-dns.md#NoSplitBrainDNS)
    
- [DNS disaster recovery](../../plan-your-deployment/network-requirements/advanced-edge-server-dns.md#DNSDR)
    
- [DNS load balancing](../../plan-your-deployment/network-requirements/advanced-edge-server-dns.md#DNSLB)
    
## <a name="walkthrough-of-skype-for-business-clients-locating-services"></a>Walkthrough of Skype for Business clients locating services
<a name="WalkthroughOfSkype"> </a>

Скайп пользователей похожи на предыдущих версий клиентов Lync в их поиска и доступа к службам в Скайп для Business Server. В этом разделе подробно описан процесс определения местоположения сервера.
  
1. lyncdiscoverinternal. \<домена\>
    
     *Запись хоста A для службы автоматического обнаружения на внутренних веб-службах.* 
    
2. lyncdiscover. \<домена\>
    
     *Запись хоста A для службы автоматического обнаружения на внешних веб-службах.* 
    
3. _sipinternaltls._tcp. \<домена\>
    
     *Запись SRV для внутренних подключений TLS.* 
    
4. _sip._tls. \<домена\>
    
     *Запись SRV для внешних подключений TLS.* 
    
5. sipinternal. \<домена\>
    
     *Это запись узла A для пула переднего плана или директор, разрешается только в пределах внутренней сети.* 
    
6. SIP. \<домена\>
    
     *Это запись узла A для пула переднего плана или директор, разрешается только в пределах внутренней сети.* 
    
7. sipexternal. \<домена\>
    
     *Это запись узла A для пограничной службы доступа, если клиентом является внешним.* 
    
Служба автоматического обнаружения всегда считается предпочтительным методом поиска расположения службы, другие службы используются в качестве резервных методов.
  
> [!NOTE]
> При создании записей SRV важно помнить, что они должны указывать на DNS-запись A (и AAAA при использовании IPv6-адресов) в том же домене, в котором создается DNS-запись SRV. Например, если запись SRV относится к домену contoso.com, запись A (и AAAA), на которую она указывает, не может относиться к домену fabrikam.com. 
  
Для выполнения этого действия можно настроить мобильное устройство для обнаружения служб вручную. В этом случае каждому пользователю потребуется настроить параметры своего мобильного устройства с полным внутренним и внешним универсальными кодами ресурса (URI) службы автообнаружения, включая протокол и путь, следующим образом:
  
- Для внешнего доступа: https://\<полные\>/Autodiscover/autodiscoverservice.svc/Root
    
- Для внутреннего доступа: https://\<имена\>/AutoDiscover/AutoDiscover.svc/Root
    
Вместо обнаружения вручную мы рекомендуем использовать автоматическое обнаружение. Однако обнаружение вручную помогает устранять неполадки и выполнять тестирование.
  
## <a name="split-brain-dns"></a>Разделенная DNS
<a name="SplitBrainDNS"> </a>

Разделенная DNS — конфигурация DNS, в которой две зоны DNS имеют одно пространство имен. При этом первая зона DNS обслуживает только внутренние запросы, а вторая зона DNS – только внешние запросы.
  
Когда использовать такую конфигурацию? В случаях, когда компания должна исполнять требование об использовании одного и того же пространства имен на внутреннем и на внешнем уровнях. Разумеется, это приводит к появлению большого количества DNS-записей SRV и A, которые будут уникальными только в одной из зон. Там, где записи будут повторятся, связанные с записями IP-адреса будут уникальными.
  
Это представляет некоторые проблемы, связанные с. Наиболее важные является разделенной DNS **не поддерживается** для мобильных устройств. Это из-за LyncDiscover и LyncDiscoverInternal записями DNS (LyncDiscover должен быть определен на вы внешних DNS-сервера при LyncDiscoverInternal должен быть определен на внутренний DNS-сервера).
  
Мы будем список записей DNS для внутренних и внешних зон, здесь, но можно найти подробные примеры в разделе Требования к рабочей среде пограничного сервера.
  
### <a name="internal-dns"></a>Внутренняя DNS

- Содержит доверенную зону DNS, например contoso.com.
    
- Внутренняя зона contoso.com содержит:
    
  - Записи DNS A и AAAA (при использовании IPv6-адресов) для интерфейсного пула, пул директоров или имени пула директоров и всех внутренних серверов с Скайп для сервера в сети организации.
    
  - A и AAAA (при использовании IPv6-адресов) записи DNS для внутреннего интерфейса пограничного сервера для каждого Скайп Business Server пограничного сервера в сети периметра.
    
  - Записи DNS A и AAAA (при использовании IPv6-адресов) для внутреннего интерфейса каждого обратного прокси-сервера в сети периметра (который **необязательно** для управления обратного прокси-сервера).
    
  - DNS-записи A и AAAA (при использовании IPv6-адресов) и записи SRV для внутреннего Скайп для автоматической настройки клиента Business Server (который является **необязательным** ).
    
  - DNS-записи A и AAAA (при использовании IPv6-адресов) или CNAME-записи для автоматического обнаружения Скайп для веб-службы сервера Business (который является **необязательным** ).
    
- Все Скайп для Business Server внутренними интерфейсами пограничного сервера в сети периметра используйте этот внутреннюю зону DNS для разрешения запросов к contoso.com.
    
- Все серверы Скайп Business Server и для клиентов под управлением Скайп Business Server в корпоративной сети, наведите указатель на внутренний DNS-серверов для разрешения запросов к contoso.com или использовать файл узла на каждом пограничном сервере и в списке A и AAAA (при использовании Записи IPv6-адресов) для сервера следующего прыжка (специально для директора или виртуальный IP-адрес пула директора, передний план виртуальный IP-адрес пула плана или сервера Standard Edition).
    
### <a name="external-dns"></a>Внешняя DNS

- Содержит доверенную зону DNS, например contoso.com.
    
- Внешняя зона contoso.com содержит:
    
  - DNS-записи A и AAAA (при использовании IPv6-адресов) или CNAME-записи, для автоматического обнаружения Скайп для веб-служб Business Server. Это для использования с мобильных устройств.
    
  - DNS-записи A и AAAA (при использовании IPv6-адресов) и записи SRV для пограничного внешнего интерфейса каждого Скайп для пограничного сервера Business Server или аппаратную балансировку сбалансированной Балансировкой нагрузки (HLB) в сети периметра.
    
  - DNS A и AAAA (при использовании IPv6-адресов) и записи SRV-записи для внешнего интерфейса обратного прокси-сервера или (виртуальный IP-адрес обратного прокси-серверов в пуле), в сети периметра.
    
  - DNS-записи A и AAAA (при использовании IPv6-адресов) и записи SRV для Скайп для автоматической настройки клиента Business Server ( **необязательно** ).
    
## <a name="automatic-configuration-without-split-brain-dns"></a>Автоматическая настройка без разделенной DNS
<a name="NoSplitBrainDNS"> </a>

Если вы не используете разделенной DNS, внутренний автоматической настройки клиентов, использующих Скайп для бизнеса не будут работать, если вы используете один из методов обхода, у нас есть здесь. Однако среди суммарных значений нет общего числа уникальных организаторов. Так как Скайп для Business Server требуется URI SIP пользователя в соответствии с домена пула переднего плана, предназначенный для автоматической настройки. Это не изменилось из более ранних версий Lync Server.
  
Например, при использовании двух доменов SIP потребуются следующие записи службы DNS SRV:
  
- _sipinternaltls._tcp.contoso.com. 86400 IN SRV 0 0 5061 pool01.contoso.com
    
     *При входе пользователя в виде bob@contoso.com, эта запись будет работать для автоматической настройки домена SIP пользователя совпадает с именем домена пула переднего плана (contoso.com).* 
    
- _sipinternaltls._tcp.fabrikam.com. 86400 IN SRV 0 0 5061 pool01.fabrikam.com
    
     *При входе пользователя в виде alice@fabrikam.com, эту запись будет работать для автоматической настройки второго домена еще раз, поскольку домен SIP совпадает пула переднего плана для этого домена.* 
    
Например, такая запись не будет работать:
  
- _sipinternaltls._tcp.litwareinc.com. 86400 IN SRV 0 0 5061 pool01.fabrikam.com
    
     *Если пользователь выполняет вход с учетной записью tim@litwareinc.com, автоматическая настройка не может быть выполнена, поскольку домен SIP (litwareinc.com) не совпадает с доменом в пуле (fabrikam.com).* 
    
Поэтому теперь, когда мы знаем, если вам нужно автоматического требования для вашей Скайп пользователей без разделенной DNS, возможны следующие варианты:
  
- **Объекты групповой политики**
    
    Используйте объекты групповой политики (GPO) для добавления правильных серверных значений.
    
    > [!NOTE]
    > Этот вариант не включает автоматическую настройку, однако он автоматизирует процесс ручной настройки. При использовании этого варианта записи SRV, связанные с автоматической настройкой, не требуются. 
  
- **Совпадающая внутренняя зона**
    
    Вам потребуется создать зону во внутренней DNS, которая соответствует внешним зоне DNS (например, contoso.com), а затем создайте DNS-записи A (и AAAA при использовании IPv6-адресов) записей, которые соответствуют Скайп для пула Business Server, используемого для автоматической Конфигурация.
    
    Например, если у вас есть пользователь, размещенный в pool01.contoso.net, но знаки в Скайп для бизнеса, как bob@contoso.com, создание внутренней зону DNS contoso.com, а внутри него, необходимые для создания DNS-записи A (и AAAA при использовании IPv6-адресов пользователя) для записи pool01.contoso.com.
    
- **Точное определение внутренней зоны**
    
    Если по каким-либо причинам нельзя создать всю зону во внутренней DNS, вы можете создать точно заданные (выделенные) зоны, которые соответствуют записям SRV, требуемым для автоматической настройки, и затем заполнить их с помощью средства dnscmd.exe. Средство dnscmd.exe является обязательным, поскольку пользовательский интерфейс DNS не поддерживает создание точно заданных зон.
    
    Например если SIP-домена contoso.com, и у вас есть пул переднего плана, называется pool01, содержащий два сервера переднего плана, вам понадобятся следующие точно определенные зоны и записи во внутренней DNS:
    
  ```
  dnscmd . /zoneadd _sipinternaltls._tcp.contoso.com. /dsprimary
  dnscmd . /recordadd _sipinternaltls._tcp.contoso.com. @ SRV 0 0 5061 pool01.contoso.com.
  dnscmd . /zoneadd pool01.contoso.com. /dsprimary
  dnscmd . /recordadd pool01.contoso.com. @ A 192.168.10.90
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  dnscmd . /recordadd pool01.contoso.com. @ A 192.168.10.91 
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  ```

    В среде может быть второй домен SIP. В этом случае вам потребуются следующие точно определенные зоны и записи A во внутренней DNS:
    
  ```
  dnscmd . /zoneadd _sipinternaltls._tcp.fabrikam.com. /dsprimary
  dnscmd . /recordadd _sipinternaltls._tcp.fabrikam.com. @ SRV 0 0 5061 pool01.fabrikam.com.
  dnscmd . /zoneadd pool01.fabrikam.com. /dsprimary
  dnscmd . /recordadd pool01.fabrikam.com. @ A 192.168.10.90
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  dnscmd . /recordadd pool01.fabrikam.com. @ A 192.168.10.91
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  ```

> [!NOTE]
> Вы увидите пула переднего плана, полное доменное имя будет отображаться дважды, но с разными IP-адресами. Это связано с использованием балансировки нагрузки на DNS. При использовании аппаратного балансировщика Нагрузки может существовать только с одной записью пула переднего плана. 
  
> [!NOTE]
> Кроме того измените значения полное доменное имя пула переднего плана между примерах contoso.com и fabrikam.com, но IP-адресов, не изменяются. Вот так как пользователи, у которых вход в любой домен SIP будут использовать тот же самый пул переднего плана для автоматической настройки. 
  
## <a name="dns-disaster-recovery"></a>Аварийное восстановление DNS
<a name="DNSDR"> </a>

Чтобы настроить DNS для перенаправления Скайп для веб-трафика Business Server для аварийного восстановления (аварийное Восстановление) и сайты отработки отказа, необходимо использовать поставщику DNS, который поддерживает GeoDNS. Можно настроить записи DNS для поддержки аварийного восстановления, чтобы продолжить функции, которые используют веб-службы, даже в том случае, если отключается один весь пул переднего плана. Эта функция аварийного восстановления поддерживает простые URL-адреса автообнаружения, собрания и телефонного подключения.
  
Определите и настройте дополнительные записи узлов DNS A (AAAA, если используется IPv6) для внутреннего и внешнего разрешения веб-служб у поставщика GeoDNS. В приведенном ниже примере предполагается, что существуют географически разнесенные спаренные пулы и поставщик **либо** поддерживает GeoDNS с помощью циклического перебора DNS, **либо** настроен на использование пула Pool1 в качестве основного и пула Pool2 – для отработки отказа в случае потери связи или сбоя электропитания.
  
Все DNS-записи в этой таблице являются примерами.
  
|**Запись GeoDNS**|**Записи пула**|**Записи CNAME**|**Параметры DNS (выберите один вариант)**|
|:-----|:-----|:-----|:-----|
|Удовлетворение int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Meet.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Meet.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Удовлетворение ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Meet.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Meet.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Dialin int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Dialin.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Dialin.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Dialin ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Dialin.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Dialin.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Lyncdiscoverint int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Lyncdiscoverinternal.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Lyncdiscoverinternal.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Lyncdiscover ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Lyncdiscover.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Lyncdiscover.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Планировщик int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Псевдоним Scheduler.contoso.com для Pool1InternalWebFQDN.contoso.com  <br/> Псевдоним Scheduler.contoso.com для Pool2InternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
|Планировщик ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Псевдоним Scheduler.contoso.com для Pool1ExternalWebFQDN.contoso.com  <br/> Псевдоним Scheduler.contoso.com для Pool2ExternalWebFQDN.contoso.com  <br/> |Циклический перебор между пулами  <br/> **ИЛИ** <br/> Используйте основной, в случае сбоя подключитесь к дополнительному  <br/> |
   
## <a name="dns-load-balancing"></a>Балансировка нагрузки DNS
<a name="DNSLB"> </a>

Балансировка нагрузки на DNS обычно реализуется на уровне приложений. Приложения (например, клиент под управлением Скайп для бизнеса), пытается подключиться к серверу в пуле подключившись к одному из IP-адреса, возвращенные DNS-записи A и AAAA (при использовании IPv6-адресов) запишите запросов для полного доменного ИМЕНИ пула.
  
Например при наличии трех серверов переднего плана в пуле pool01.contoso.com, следующие произойдет:
  
- Клиенты с Скайп для бизнеса запроса DNS для pool01.contoso.com. Запрос возвращает 3 IP-адреса и кэширует их следующим образом (в некотором порядке):
    
   |||
   |:-----|:-----|
   |pool01.contoso.com  <br/> |192.168.10.90  <br/> |
   |pool01.contoso.com  <br/> |192.168.10.91  <br/> |
   |pool01.contoso.com  <br/> |192.168.10.92  <br/> |
   
- Клиент пытается установить подключение TCP к одному из IP-адресов. Если не удается установить подключение, клиент берет следующий кэшированный IP-адрес из списка.
    
- Если подключение TCP успешно установлено, клиент согласует TLS для подключения к основному регистратору на pool01.contoso.com.
    
- Если клиент пытается все кэшированные записи без успешное подключение, пользователь получает уведомление, что нет серверов под управлением Скайп для Business Server, доступных в данный момент.
    
> [!NOTE]
> Балансировка нагрузки на DNS отличается от циклического перебора DNS (DNS RR), который обычно относится к балансировке нагрузки с помощью DNS для обеспечения другого порядка IP-адресов для серверов в пуле. Как правило, циклический перебор DNS обеспечивает распределение нагрузки, но не поддерживает отработку отказа. Например, если подключение к одному IP-адресу, возвращаемому запросом DNS-записи A (или AAAA в сценарии IPv6), завершается с ошибкой, подключение разрывается. В результате циклический перебор DNS является менее надежным, чем балансировка нагрузки на DNS. Вы по-прежнему можете использовать циклический перебор DNS вместе с балансировкой нагрузки на DNS, если это необходимо. 
  
Балансировка нагрузки по DNS используется для выполнения следующих задач:
  
- Сервер сервер SIP для пограничных серверов, балансировка нагрузки.
    
- Балансировка нагрузки для приложений Unified Communications Application Services (UCAS), например автосекретаря, группы ответа и парковки вызовов.
    
- Запрет новых подключений к приложениям UCAS (также называемое "сток").
    
- Весь трафик клиент сервер между клиентами и серверами пограничного сервера, балансировка нагрузки.
    
Балансировка нагрузки по DNS не используется для выполнения следующих задач:
  
- Трафик веб-клиент сервер на серверах переднего плана или Директор.
    
Переход немного более подробные на способ выбора записи DNS SRV при множественных, DNS-записей возвращаемых запросом, служба пограничного сервера доступа всегда выбирает запись с более низким приоритетом числовое, и если разрешения конфликтов необходимости, максимальный вес числовое. Это согласуется с [документации по Интернету инженерной рабочей группы](https://www.ietf.org/rfc/rfc2782.txt).
  
Например, если первая DNS-запись SRV имеет вес 20 и приоритет 40, а вторая DNS-запись SRV имеет вес 10 и приоритет 50, будет выбрана первая запись с меньшим приоритетом 40. Приоритет всегда учитывается в первую очередь, и клиент в первую очередь направляется именно на хост. Что делать, если есть две разные цели имеют одинаковый приоритет? 
  
В этом случае учитывается вес. Более крупный вес должен присваиваться при наличии пропорционально высокой вероятности выбора в этой ситуации. Администраторы DNS должны использовать вес 0 при отсутствии каких-либо серверных операций выбора, которые подлежат выполнению. При наличии записей, вес которых больше 0, крайне маловероятно, что будут выбраны записи, имеющие вес 0.
  
Что происходит при получении нескольких DNS-записей SRV с равным приоритетом и весом? В этом случае пограничного сервера доступа службы выберет SRV-записи, полученный из DNS-сервера первого.
  

