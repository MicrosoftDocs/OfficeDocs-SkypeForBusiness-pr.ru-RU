---
title: Планирование развертывания advanced Edge Server для Skype для бизнеса Server
ms.reviewer: ''
ms.author: serdars
author: SerdarSoysal
audience: ITPro
ms.topic: conceptual
manager: serdars
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.collection:
- IT_Skype16
- Strat_SB_Hybrid
ms.custom: ''
ms.assetid: f3a5895f-f64f-44eb-9a5e-8d606ac1fc38
description: Просмотрите сценарии Skype для бизнеса Server вариантов развертывания, хотите ли вы один сервер или предпочитаете пул серверов с DNS или HLB.
ms.openlocfilehash: 6d2b0e53e3b0b94f19cdac70399a0bb512822cb8
ms.sourcegitcommit: 59d209ed669c13807e38196dd2a2c0a4127d3621
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2022
ms.locfileid: "62387987"
---
# <a name="plan-advanced-edge-server-deployment-for-skype-for-business-server"></a>Планирование развертывания advanced Edge Server для Skype для бизнеса Server
 
**Сводка:** Просмотрите сценарии Skype для бизнеса Server развертывания. Если вы хотите один сервер или предпочитаете пул серверов с DNS или HLB, этот раздел должен помочь.
  
Когда речь заходит о планировании системы доменных имен (DNS) для Skype для бизнеса Server, в ваше решение может сыграть множество факторов. Если структура домена вашей организации уже на месте, это может быть вопросом проверки того, как вы собираетесь действовать. Начнем с разделов, которые приведены ниже.
  
- [Руководство по поиску Skype для бизнеса клиентов](../../plan-your-deployment/network-requirements/advanced-edge-server-dns.md#WalkthroughOfSkype)
    
- [DNS с разделенным мозгом](../../plan-your-deployment/network-requirements/advanced-edge-server-dns.md#SplitBrainDNS)
    
- [Автоматическая конфигурация без DNS с разделенным мозгом](../../plan-your-deployment/network-requirements/advanced-edge-server-dns.md#NoSplitBrainDNS)
    
- [Аварийное восстановление DNS](../../plan-your-deployment/network-requirements/advanced-edge-server-dns.md#DNSDR)
    
- [Балансировка нагрузки DNS](../../plan-your-deployment/network-requirements/advanced-edge-server-dns.md#DNSLB)
    
## <a name="walkthrough-of-skype-for-business-clients-locating-services"></a>Руководство по поиску Skype для бизнеса клиентов
<a name="WalkthroughOfSkype"> </a>

Skype для бизнеса похожи на предыдущие версии клиентов Lync в поиске и доступе к службам в Skype для бизнеса Server. В этом разделе подробно об этом процессе расположения сервера.
  
1. lyncdiscoverinternal.\<domain\>
    
     *Это хост-запись для службы автооткрытия во внутренних веб-службах.* 
    
2. lyncdiscover.\<domain\>
    
     *Это хост-запись для службы автооткрытия внешних веб-служб.* 
    
3. _sipinternaltls._tcp.\<domain\>
    
     *Это запись SRV для внутренних подключений TLS.* 
    
4. _sip._tls.\<domain\>
    
     *Это запись SRV для внешних подключений TLS.* 
    
5. sipinternal.\<domain\>
    
     *Это хост-запись для пула или директора переднего конца, разрешаемая только во внутренней сети.* 
    
6. sIP.\<domain\>
    
     *Это хост-запись для пула или директора переднего конца, разрешаемая только во внутренней сети.* 
    
7. sipexternal.\<domain\>
    
     *Это хост-запись для службы Access Edge, когда клиент является внешним.* 
    
Служба автооткрытия всегда предпочтительна, так как это предпочтительный метод расположения службы, а остальные — методы отката.
  
> [!NOTE]
> При создании записей SRV важно помнить, что они должны указать на DNS A (и AAAA, если вы используете адрес IPv6) в том же домене, в котором создается запись SRV DNS. Например, если запись SRV в contoso.com, запись A (и AAAA) указывает на то, что она не может быть в fabrikam.com. 
  
Если вы склонны это делать, вы можете настроить мобильное устройство для ручного обнаружения служб. Если это именно то, что вы хотите сделать, каждому пользователю необходимо настроить параметры мобильных устройств с полными внутренними и внешними URL-адресами службы автооткрытия, включая протокол и путь, следующим образом:
  
- Внешний доступ: https://\<ExtPoolFQDN\>/Autodiscover/autodiscoverservice.svc/Root
    
- Для внутреннего доступа: https://\<IntPoolFQDN\>/AutoDiscover/AutoDiscover.svc/Root
    
Мы рекомендуем использовать автоматическое обнаружение, а не ручное обнаружение. Но если вы занимаетесь устранением неполадок или тестированием, параметры вручную могут быть очень полезны.
  
## <a name="split-brain-dns"></a>DNS с разделенным мозгом
<a name="SplitBrainDNS"> </a>

Это конфигурация DNS, в которой есть две зоны DNS с одинаковым пространством имен. Первая зона DNS обрабатывает внутренние запросы, а вторая зона DNS обрабатывает внешние запросы.
  
Зачем компании это делать? Возможно, для них может потребоваться использовать одно и то же пространство имен внутри и извне, но, конечно, это приведет к уникальному использованию многих записей DNS SRV и A в той или иной зоне, и если существует дублирование, IP-адреса, связанные с этими записями, будут уникальными.
  
Это представляет некоторые проблемы. Самое важное, что DNS с разделенным мозгом не **поддерживается для** Mobility. Это происходит из-за записей DNS LyncDiscover и LyncDiscoverInternal (LyncDiscover необходимо определить на внешнем DNS-сервере, а LyncDiscoverInternal — на внутреннем DNS-сервере).
  
Здесь мы перечислим записи DNS для внутренних и внешних зон, но подробные примеры можно найти в разделе Требования к окружающей среде Edge Server.
  
### <a name="internal-dns"></a>Внутренняя DNS

- Содержит зону DNS, называемую (например) contoso.com, для которой она является авторитетной.
    
- Этот внутренний contoso.com содержит:
    
  - Записи DNS A и AAAA (при использовании адресов IPv6) для вашего пула переднего конца, имени пула директоров или пула директоров, а также всех внутренних серверов, работающих Skype для бизнеса Server в сети организации.
    
  - Записи DNS A и AAAA (если используется адресная служба IPv6) для внутреннего интерфейса Edge для каждого Skype для бизнеса Server Edge Server в сети периметра.
    
  - Записи DNS A и AAAA (если используется адресная служба IPv6) для внутреннего интерфейса каждого обратного прокси-сервера в сети периметра (который необязателен для управления обратным прокси-сервером).
    
  - DNS A и AAAA (если вы используете адреса IPv6) и записи SRV для внутренней Skype для бизнеса Server клиентской автоконфигурации (которая **необязательна**).
    
  - Записи DNS A и AAAA (если вы используете адрес IPv6) или записи CNAME для автоматического обнаружения Skype для бизнеса Server веб-служб (что **необязательно).**
    
- Все интерфейсы Skype для бизнеса Server edge в сети периметра используют эту внутреннюю зону DNS для решения запросов contoso.com.
    
- Все серверы, работающие Skype для бизнеса Server, и клиенты, работающие Skype для бизнеса Server в корпоративной сети, указывают на внутренние DNS-серверы для разрешения запросов на contoso.com или используют хост-файл на каждом краевом сервере и перечисляют записи A и AAAA (если вы используете адреса IPv6) для следующего сервера хмеля (специально для пула директоров или директоров).  VIP-сервер, VIP-сервер выпуск Standard пула).
    
### <a name="external-dns"></a>Внешний DNS

- Содержит зону DNS, называемую (например) contoso.com, для которой она является авторитетной.
    
- Этот внешний contoso.com содержит:
    
  - DNS A и AAAA (если используется адрес IPv6) или записи CNAME для автоматического обнаружения Skype для бизнеса Server веб-служб. Это для использования с мобильностью.
    
  - Записи DNS A и AAAA (если используется адресная запись IPv6) и SRV для внешнего интерфейса Edge для каждого внешнего интерфейса Skype для бизнеса Server Edge Server или аппаратной нагрузки, сбалансированной (HLB) VIP в сети периметра.
    
  - Записи DNS A и AAAA (если вы используете адреса IPv6) и SRV для внешнего интерфейса обратного прокси-сервера или (VIP для пула обратных прокси-серверов) в сети периметра.
    
  - DNS A и AAAA (если вы используете адреса IPv6) и записи SRV для автоконфигурации **Skype для бизнеса Server клиента (** необязательно).
    
## <a name="automatic-configuration-without-split-brain-dns"></a>Автоматическая конфигурация без DNS с разделенным мозгом
<a name="NoSplitBrainDNS"> </a>

Если вы не используете DNS с разделенным мозгом, внутренняя автоматическая конфигурация клиентов, работающих Skype для бизнеса, не будет работать, если вы не используете одно из обходных методов, которые мы здесь имеем. Почему нет? Так Skype для бизнеса Server, чтобы SIP URI пользователя совпадал с доменом пула интерфейса, назначенным для автоматической конфигурации. Это не изменилось из более ранних версий Lync Server.
  
Таким образом, если у вас есть два SIP-домена, вам нужны эти записи SRV DNS:
  
- _sipinternaltls._tcp.contoso.com. 86400 IN SRV 0 0 5061 pool01.contoso.com
    
     *Если пользователь включит bob@contoso.com, эта запись будет работать для автоматической конфигурации, так как домен SIP пользователя совпадает с доменом пула интерфейса (contoso.com).* 
    
- _sipinternaltls._tcp.fabrikam.com. 86400 IN SRV 0 0 5061 pool01.fabrikam.com
    
     *Если пользователь включит alice@fabrikam.com, эта запись будет работать для автоматической конфигурации второго домена, так как домен SIP соответствует пулу интерфейса для этого домена.* 
    
Чтобы взять пример далее, это не будет работать:
  
- _sipinternaltls._tcp.litwareinc.com. 86400 IN SRV 0 0 5061 pool01.fabrikam.com
    
     *Вход пользователя в tim@litwareinc.com не будет работать для автоматической конфигурации, так как его домен SIP (litwareinc.com) не соответствует домену в пуле (fabrikam.com).* 
    
Итак, теперь, когда мы знаем все это, если вам требуется автоматическое требование для Skype для бизнеса клиентов без сплит-мозг DNS, у вас есть эти параметры:
  
- **Объекты групповой политики**
    
    Для заполнения правильных значений сервера можно использовать объекты групповой политики (GPOs).
    
    > [!NOTE]
    > Этот параметр не включает автоматическую конфигурацию, но автоматизирует ручную конфигурацию. Если используется этот подход, записи SRV, связанные с автоматической конфигурацией, не требуются. 
  
- **Совпадающая внутренняя зона.**
    
    Вам потребуется создать зону во внутренней DNS, соответствующую вашей внешней DNS-зоне (например, contoso.com), а затем создать записи DNS A (и AAAA, если вы используете адреса IPv6), соответствующие пулу Skype для бизнеса Server, используемой для автоматической настройки.
    
    Например, если пользователь находится в pool01.contoso.net, но в Skype для бизнеса как bob@contoso.com, создайте внутреннюю зону DNS contoso.com, а внутри нее необходимо создать запись DNS A (и AAAA, если используется адрес IPv6) для pool01.contoso.com.
    
- **Точное определение внутренней зоны.**
    
    Если создание всей зоны во внутренней DNS не является для вас вариантом, можно создать зоны pin-point (выделенные), соответствующие записям SRV, необходимым для автоматической конфигурации, и заполнить эти зоны с помощью dnscmd.exe. Dnscmd.exe, так как пользовательский интерфейс DNS не поддерживает создание зон пин-точки.
    
    Например, если ваш домен SIP contoso.com и у вас есть пул front end pool01 с двумя серверами переднего входа, вам потребуется следующие зоны пин-точки и записи во внутренней DNS:
    
  ```console
  dnscmd . /zoneadd _sipinternaltls._tcp.contoso.com. /dsprimary
  dnscmd . /recordadd _sipinternaltls._tcp.contoso.com. @ SRV 0 0 5061 pool01.contoso.com.
  dnscmd . /zoneadd pool01.contoso.com. /dsprimary
  dnscmd . /recordadd pool01.contoso.com. @ A 192.168.10.90
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  dnscmd . /recordadd pool01.contoso.com. @ A 192.168.10.91 
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  ```

    В вашей среде может появиться второй домен SIP. В этом случае вам понадобится следующие зоны пин-точки и записи A во внутренней DNS:
    
  ```console
  dnscmd . /zoneadd _sipinternaltls._tcp.fabrikam.com. /dsprimary
  dnscmd . /recordadd _sipinternaltls._tcp.fabrikam.com. @ SRV 0 0 5061 pool01.fabrikam.com.
  dnscmd . /zoneadd pool01.fabrikam.com. /dsprimary
  dnscmd . /recordadd pool01.fabrikam.com. @ A 192.168.10.90
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  dnscmd . /recordadd pool01.fabrikam.com. @ A 192.168.10.91
  dnscmd . /recordadd pool01.contoso.com. @ AAAA <IPv6 address>
  ```

> [!NOTE]
> Передняя часть пула FQDN отображается дважды, но с двумя разными IP-адресами. Это потому, что используется балансировка нагрузки DNS. Если используется HLB, будет использоваться только одна запись пула переднего конца. 
  
> [!NOTE]
> Кроме того, значения FQDN пула переднего contoso.com и fabrikam.com, но IP-адреса остаются одинаковыми. Это потому, что пользователи, которые включались из любого домена SIP, будут использовать один и тот же пул переднего конца для автоматической настройки. 
  
## <a name="dns-disaster-recovery"></a>Аварийное восстановление DNS
<a name="DNSDR"> </a>

Чтобы настроить DNS для перенаправления Skype для бизнеса Server веб-трафика на сайты аварийного восстановления (DR) и аварийного сбойного восстановления, необходимо использовать поставщика DNS, который поддерживает GeoDNS. Вы можете настроить записи DNS для поддержки аварийного восстановления, чтобы функции, которые используют веб-службы, продолжались даже в том случае, если один пул передней части не будет работать. Эта функция DR поддерживает простые URL-адреса автонаруже, meet и Dial-in.
  
Вы определяете и настраивает дополнительные записи DNS host A (AAAA при использовании IPv6) для внутреннего и внешнего разрешения веб-служб у поставщика GeoDNS. В следующих подробностях предполагается, что пары пулов географически распределены, а geoDNS, поддерживаемый  вашим поставщиком, либо имеет круглую **DNS,** либо настроен на использование Пул1 в качестве основного и не удается в Pool2, если есть какие-либо потери связи или отключения питания.
  
Все записи DNS в этой таблице являются примерами.
  
|**Запись GeoDNS**|**Записи пула**|**Записи CNAME**|**Параметры DNS (выберите один вариант)**|
|:-----|:-----|:-----|:-----|
|Meet-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Meet.contoso.com to Meet-int.geolb.contoso.com  <br/>   <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Используйте первичную, подключите к вторичной, если есть сбой  <br/> |
|Meet-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Meet.contoso.com to Meet-ext.geolb.contoso.com  <br/>   <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Используйте первичную, подключите к вторичной, если есть сбой  <br/> |
|Dialin-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Meet.contoso.com to Meet-int.geolb.contoso.com   <br/>  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Используйте первичную, подключите к вторичной, если есть сбой  <br/> |
|Dialin-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Meet.contoso.com to Meet-ext.geolb.contoso.com  <br/>  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Используйте первичную, подключите к вторичной, если есть сбой  <br/> |
|Lyncdiscoverint-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Meet.contoso.com to Meet-int.geolb.contoso.com   <br/>   <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Используйте первичную, подключите к вторичной, если есть сбой  <br/> |
|Lyncdiscover-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Meet.contoso.com to Meet-ext.geolb.contoso.com  <br/>  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Используйте первичную, подключите к вторичной, если есть сбой  <br/> |
|Scheduler-int.geolb.contoso.com  <br/> |Pool1InternalWebFQDN.contoso.com  <br/> Pool2InternalWebFQDN.contoso.com  <br/> |Meet.contoso.com to Meet-int.geolb.contoso.com   <br/>  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Используйте первичную, подключите к вторичной, если есть сбой  <br/> |
|Scheduler-ext.geolb.contoso.com  <br/> |Pool1ExternalWebFQDN.contoso.com  <br/> Pool2ExternalWebFQDN.contoso.com  <br/> |Meet.contoso.com to Meet-ext.geolb.contoso.com   <br/>  <br/> |Циклический перебор между пулами  <br/> **OR** <br/> Используйте первичную, подключите к вторичной, если есть сбой  <br/> |
   
## <a name="dns-load-balancing"></a>балансировка нагрузки DNS;
<a name="DNSLB"> </a>

Балансировка нагрузки DNS обычно реализуется на уровне приложения. Приложение (например, клиент с Skype для бизнеса) пытается подключиться к серверу в пуле, подключившись к одному из IP-адресов, возвращенных из DNS A и AAAA (если используется адрес IPv6) для FQDN пула.
  
Например, если в пуле с именем pool01.contoso.com три сервера переднего pool01.contoso.com, произойдет следующее:
  
- Клиенты, Skype для бизнеса запрос DNS для pool01.contoso.com. Запрос возвращает три IP-адреса и кэширует их следующим образом (в определенном порядке):
    
   |&nbsp;|&nbsp;|
   |:-----|:-----|
   |pool01.contoso.com  <br/> |192.168.10.90  <br/> |
   |pool01.contoso.com  <br/> |192.168.10.91  <br/> |
   |pool01.contoso.com  <br/> |192.168.10.92  <br/> |
   
- Клиент пытается установить подключение TCP к одному из IP-адресов. Если это не удастся, он будет пытаться следующий IP-адрес кэшировали из этого списка.
    
- Если подключение TCP успешно установлено, клиент согласует TLS для подключения к основному регистратору на pool01.contoso.com.
    
- Если клиент пытается использовать все кэшные записи без успешного подключения, пользователь получает уведомление о том, что на данный момент Skype для бизнеса Server серверов, работающих в Skype для бизнеса Server.
    
> [!NOTE]
> Балансировка нагрузки на основе DNS отличается от кругового робина DNS (DNS RR), который обычно ссылается на балансировку нагрузки, полагаясь на DNS, чтобы указать другой порядок IP-адресов для серверов в пуле. Как правило, DNS RR включает распределение нагрузки, но не позволяет включить сбой. Например, если подключение к одному IP-адресу, возвращенное вашим запросом DNS A (или AAAA в сценарии IPv6), сбой. Это делает DNS RR менее надежным, чем балансировка нагрузки на основе DNS. Вы можете использовать DNS RR в сочетании с балансировка нагрузки на основе DNS, если это необходимо. 
  
Балансировка нагрузки DNS используется для:
  
- Загрузка SIP баланса между серверами и серверами на edge Servers.
    
- Приложения для балансизагрузки единой службы связи (UCAS), такие как conferencing автосекретарь, Response Group и Call Park.
    
- Предотвращение новых подключений к приложениям UCAS (также известному как осушение).
    
- Баланс нагрузки на весь трафик между клиентом и сервером между клиентами и edge Servers.
    
Балансировка нагрузки DNS не используется для:
  
- Веб-трафик от клиента к серверу на серверы переднего входа или к директору.
    
Чтобы подробнее узнать, как выбрана запись DNS SRV при возвращении нескольких записей DNS с помощью запроса, служба Access Edge всегда выбирает запись с наименьшим численным приоритетом и, если требуется тай-брейк, имеет самый высокий числовой вес. Это согласуется с [документацией целевой группы по инженерии Интернета](https://www.ietf.org/rfc/rfc2782.txt).
  
Например, если ваша первая запись SRV DNS имеет вес 20 и приоритет 40, а вторая запись SRV DNS имеет вес 10, а приоритет — 50, первая запись будет выбрана, так как имеет более низкий приоритет 40. Приоритет всегда идет первым, и это хост, который клиент будет нацелить в первую очередь. Что делать, если существуют две цели с одинаковым приоритетом? 
  
В этом случае учитывается вес. В этом случае с высокой вероятностью следует получить более крупные весы. Администраторы DNS должны использовать вес 0, если не существует выбора сервера. При наличии записей, содержащих вес более 0, записи с весом 0 имеют небольшой шанс принести выбранный.
  
Итак, что произойдет, если несколько записей SRV DNS с равным приоритетом и весом при возврате? В этой ситуации служба Access Edge сначала выбирает запись SRV, которую она получила с DNS-сервера.
  

