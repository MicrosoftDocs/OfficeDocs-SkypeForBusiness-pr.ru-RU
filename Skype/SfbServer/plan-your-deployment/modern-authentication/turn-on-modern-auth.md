---
title: Планирование отключения внутренних и внешних методов проверки подлинности legacy в сети
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.collection: IT_Skype16
ms.custom: tracyp
ms.assetid: ''
description: В этой статье описаны cmdlets, которые дают администраторам больше контроля над методами проверки подлинности, используемыми внутри и снаружи бизнеса. Администраторы могут включить или отключить методы проверки подлинности во внутренней или внешней сети.
ms.openlocfilehash: 7bad18e79e1595c7dfe4518d73b6dd764e313e22
ms.sourcegitcommit: 556fffc96729150efcc04cd5d6069c402012421e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "58601364"
---
# <a name="planning-to-turn-off-legacy-authentication-methods-internally-and-externally-to-your-network"></a>Планирование отключения внутренних и внешних методов проверки подлинности в сети.

> [!NOTE]
> Если вы хотите прочитать эту статью, вы уже должны знать о поддерживаемых современных topologies проверки подлинности, ADAL и о config современной проверки подлинности, но в случае, если этого не сделать, вот статьи, которые необходимо начать: 
>  + [https://docs.microsoft.com/skypeforbusiness/plan-your-deployment/modern-authentication/topologies-supported](./topologies-supported.md)
>  + [https://docs.microsoft.com/skypeforbusiness/manage/authentication/use-adal](/skypeforbusiness/manage/authentication/use-adal)
  
Современная проверка подлинности не только включает более безопасные методы проверки подлинности, такие как Two-Factor Auth или Auth на основе сертификата, но и может выполнять авторизацию пользователя без необходимости имени пользователя или пароля. Это очень удобно.

В этой статье вы сможете подключить отверстия, которые были использованы для атак службы отказа в обслуживании (DOS) на серверах Skype для бизнеса, отключив старые методы, используемые для проверки подлинности, внешне, внутренне или обоих, в сеть. Например, одним из способов, которые помогут остановить doS-атаки, является отключение Windows комплексной проверки подлинности (включая NTLM и Kerberos). Отключение внешнего доступа к NTLM и проверка подлинности на основе сертификатов помогает защитить пароли от воздействия. Это потому, что NTLM использует учетные данные паролей для проверки подлинности пользователей, но проверка подлинности на основе сертификатов , включенная в Modern Auth, — нет. Это означает, что одним из идеальных вариантов сокращения атак DOS является блокировка внешнего NTLM и использование только проверки подлинности на основе сертификатов.

Хорошо, давайте начнем.

## <a name="what-would-you-be-changing"></a>Что бы вы меняли? 

Эти команды работают как для точек доступа SIP, так и для веб-служб. Хотя эти два канала используют различные методы доступа, запуская гамму от NTLM и Kerberos до анонимного доступа, все стандартные методы, используемые Skype для бизнеса, были приняты во внимание.

## <a name="how-to-get-the-get--and-set-csauthconfig-cmdlets"></a>Как получить комлеты Get и Set-CsAuthConfig

Эти cmdlets будут установлены только после июля 2018 накопительного обновления (6.0.9319.534) для Microsoft Skype для бизнеса Server 2015, а затем у вас есть различные topologies, которые можно выкатить для Skype для бизнеса сервера.

## <a name="topologies"></a>Topologies

Важно помнить, что это поддерживаемые topologies, участвующие в этом сценарии! Например, если вам необходимо перейти в Службу поддержки для блокировки метода, вам потребуется конфигурация среди типов ниже. 

> [!IMPORTANT]
> В таблице и описаниях  ниже современная проверка подлинности сокращена так, как ma и __Windows__ интегрированная проверка подлинности сокращена как __Win__.  В качестве напоминания Windows интегрированная проверка подлинности состоит из двух методов: проверки подлинности NTLM и Kerberos. Вам нужно знать это, чтобы правильно прочитать таблицу!


|       |Внешне  |Внутренне  |Параметр  |
|---------|:---------|:---------|---------|
|__Тип 1__   |  MA + Win       | MA + Win         |  AllowAllExternallyAndInternally       |
|__Тип 2__   |  Ma       | MA + Win         | BlockWindowsAuthExternally        |
|__Тип 3__   |  Ma       | Ma        | BlockWindowsAuthExternallyAndInternally        |
|__Тип 4__   |  Ma       | Win        | BlockWindowsAuthExternallyAndModernAuthInternally    |
|__Тип 5__   |  MA + Win       | Win        | BlockModernAuthInternally         |

__Описание типа 1:__ Это сценарий по умолчанию, когда ma включен __для__ Skype для бизнеса Server. Другими словами, это *отправная точка* при настройке ma.

__Описание типа 2:__ Эта топология блокирует *NTLM* внешне, но позволяет NTLM или Kerberos (для клиентов, которые не поддерживают ADAL) работать *внутренне.* Если ваши клиенты поддерживают ADAL, они будут использовать ma внутренне.

__Описание типа 3:__ Эта топология требует ma для всех пользователей. Все клиенты, способные использовать ADAL, будут работать в этой топологии, и пароли не будут использовать, если, например, вы отключите использование паролей с помощью Auth на основе сертификата.

__Описание типа 4:__ Эта топология блокирует NTLM внешне *и* внутренне. Это позволяет *всем клиентам использовать* устаревшие методы проверки подлинности внутри страны (даже клиенты, способные использовать ADAL). 

__Описание типа 5.__ *Внешне* современные клиенты ADAL будут использовать ma, а все клиенты, которые не поддерживают ADAL, будут использовать устаревшие методы проверки подлинности. Но внутренне *все* *клиенты* будут использовать устаревшую проверку подлинности (включая все клиенты, способные использовать ADAL).

Довольно легко уследить за целью защиты паролей в доступных вариантах. Помните, что идеальная ситуация — использовать ma внешне (например, путем настройки auth на основе сертификатов), чтобы избежать атак DOS. Если вы будете использовать его внутренне для современных клиентов, вы также сможете использовать свою сеть в будущем в отношении Skype для бизнеса Server dos.

## <a name="why-to-use-set-csauthconfig-at-the-global-level"></a>Зачем использовать Set-CsAuthConfig на глобальном уровне

Конфигурация `Set-CsAuthConfig` эффектов cmdlet влияет как на роли регистратора, так и на роли веб-служб.

Этот cmdlet предназначен для запуска на глобальном уровне вашего Skype для бизнеса сервера. Его *можно* запустить на уровне Пула, но это не рекомендуется, так как это добавит сложности вашей установке.  При запуске этих команд на уровне Пула, если в пуле не включены все роли (например, у него нет веб-служб), параметры будут задат только для роли Регистратора. В этом случае веб-службы будут продолжать работу с настройками глобального уровня, что может привести к путанице (особенно если это делается непреднамеренно).

Если клиент использует параметры Регистратора из одного пула, а параметры веб-служб из другого пула, а параметры проверки подлинности находятся в непоследовательном состоянии, клиенты могут не войти в систему.

Кроме того, если для пула присутствует только одна роль: 
* Set-будет устанавливать только параметры, соответствующие роли, которая существует. Никаких специальных предупреждений не будет, так как некоторые параметры *не были заданы.* 
* Get-will return the setting that corresponds to the role that exists, and global settings for the role that doesn't exist.
* Если ни одна из ролей для пула не присутствует, как Set, так и Get-возвращает сообщение об ошибке.
* Если обе роли присутствуют для пула, но политики не определены на уровне пула, Get- возвращает сообщение об ошибке.

Возможно, будет мудрее всего сделать Get-для этих значений и сделать снимок экрана или записать их начальное состояние перед внесением каких-либо изменений. Кроме того, можно сохранить журнал изменений в OneNote.

> [!NOTE]
> 
> Примечание. После настройки CsAuthConfig необходимо выполнить Enable-CsComputer на каждом компьютере, чтобы параметры вступили в силу.

> [!IMPORTANT]
> Если вы используете веб-доступ Lync (LWA) и должны использовать доступ на основе форм (FBA) для внешнего доступа, перенастройку LWA, чтобы клиенты могли получить доступ к нему с анонимным доступом для поддержки этих сценариев. Кроме того, если вы используете пин-код dial-in, FBA будет заблокирована только для внешних пользователей. Если им потребуется изменить пин-код, для этого им потребуется войти в корпорацию.

> [!NOTE]
> 
> Если для внешнего блокировки NTLM используется параметр BlockWindowsAuthExternally, следует помнить, что это также блокирует NTLM для канала SIP. Однако клиенты Skype для бизнеса и Lync, более новые, чем 2010 г., по-прежнему смогут войти в систему, так как они будут использовать NTLM над HTTP для входа внутри страны, а затем получить сертификат для входа в SIP. Однако в этом случае клиенты старше 2010 года не смогут войти в систему самостоятельно, и вам может потребоваться рассмотреть возможность обновления этих приложений, чтобы пользователи могли возобновить безопасные функции.

> [!IMPORTANT] 
> Некоторые веб-Skype для бизнеса не поддерживают ma. Таким образом, с помощью сценария BlockWindowsAuthExternallyAndInternally вы не сможете получить доступ к этим приложениям. Приложения без поддержки MA являются веб-планировщиком, страницей dial-in, панелью управления Skype для бизнеса (CSCP) и группой Параметры Page. 

## <a name="links"></a>Ссылки 
- Дополнительные сведения о PowerShell:
    -  [Get-CsAuthConfig](/powershell/module/skype/get-csauthconfig?view=skype-ps)
    -  [Set-CsAuthConfig](/powershell/module/skype/set-csauthconfig?view=skype-ps)

- Дополнительные инструкции по использованию команд или ТС, необходимых для их установки:
    - [Брифинг по cmdlets](https://support.microsoft.com/help/4346673/new-cmdlets-to-manage-skype-for-business-server-2015-authentication)
    - [Обновления для Skype для бизнеса Server 2015](https://support.microsoft.com/help/3061064/updates-for-skype-for-business-server-2015) (Общие)
    - Июль [2018 Skype для бизнеса Server 2015 г., cu](https://support.microsoft.com/help/4340903/july-2018-cumulative-update-6-0-9319-534-for-skype-for-business-server) основных компонентов (6.0.9319.534)


