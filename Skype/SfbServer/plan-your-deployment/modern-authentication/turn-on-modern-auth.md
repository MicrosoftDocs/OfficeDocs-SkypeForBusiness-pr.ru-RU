---
title: Планирование отключения устаревших методов проверки подлинности для внутренней и внешней сети
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.custom: tracyp
ms.assetid: ''
description: В этой статье описаны cmdlets, которые дают администраторам больше контроля над методами проверки подлинности, используемыми в компании и за ее пределами. Администраторы могут включить или отключить методы проверки подлинности внутри или извне своей сети.
ms.openlocfilehash: dca7dca332564442110c626a222f7ed5d138efaf
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49810033"
---
# <a name="planning-to-turn-off-legacy-authentication-methods-internally-and-externally-to-your-network"></a>Планирование отключения устаревших методов проверки подлинности внутри сети и за ее внешними границами.

> [!NOTE]
> Если вы будете читать эту статью, вы уже должны знать о поддерживаемых современных topologies проверки подлинности, ADAL и о config современной проверки подлинности, но в случае, если вы этого не сделать, ознакомьтесь со статьями, которые необходимо начать: 
>  + [https://docs.microsoft.com/skypeforbusiness/plan-your-deployment/modern-authentication/topologies-supported](https://docs.microsoft.com/skypeforbusiness/plan-your-deployment/modern-authentication/topologies-supported)
>  + [https://docs.microsoft.com/skypeforbusiness/manage/authentication/use-adal](https://docs.microsoft.com/skypeforbusiness/manage/authentication/use-adal)
  
Современная проверка подлинности не только обеспечивает более безопасные методы проверки подлинности, например проверку подлинности Two-Factor Auth или проверку подлинности на основе сертификатов, но и позволяет выполнять авторизацию пользователя без необходимости в имени пользователя или пароле. Это очень удобно.

Эта статья поможет вам подключить к сети отказ в обслуживании (DOS), которые использовались для атак типа "отказ в обслуживании" (DOS), путем отключения старых методов проверки подлинности, внешних, внутренних или обоих методов. Например, одним из способов остановить атаки DOS может быть отключение встроенной проверки подлинности Windows (в том числе NTLM и Kerberos). Внешнее отключение NTLM и проверка подлинности на основе сертификатов помогает защитить пароли от воздействия. Это необходимо, поскольку NTLM использует учетные данные пароля для проверки подлинности пользователей, а проверка подлинности на основе сертификатов (включенная современной проверкой подлинности) — нет. Это означает, что одним из идеальных способов сокращения атак DOS является блокировка NTLM извне и использование только проверки подлинности на основе сертификатов.

Все в порядке, давайте начнем.

## <a name="what-would-you-be-changing"></a>Что бы вы могли изменить? 

Эти команды работают как для точек доступа SIP, так и для веб-служб. Хотя эти два канала используют разные методы доступа, запуская гамму от NTLM и Kerberos до анонимного доступа, все стандартные методы, используемые Skype для бизнеса, были приняты во внимание.

## <a name="how-to-get-the-get--and-set-csauthconfig-cmdlets"></a>Как получить Set-CsAuthConfig Get- и Set-CsAuthConfig

These cmdlets will only be installed post July 2018 cumulative update (6.0.9319.534) for Microsoft Skype for Business Server 2015, and then you have a variety of topologies that can be rolled out for your Skype for Business server.

## <a name="topologies"></a>Topologies

Важно помнить, что это поддерживаемые в этом сценарии. Например, если вам нужно перейти в службу поддержки за помощью в блокировании метода, вам потребуется конфигурация среди типов ниже. 

> [!IMPORTANT]
> В таблице и описаниях  ниже современная проверка подлинности сокращена, так как встроенная проверка подлинности *Windows* сокращена как __Win.__  Напоминаем, что встроенная проверка подлинности Windows состоит из двух методов: NTLM и Kerberos. Это необходимо знать, чтобы правильно прочитать таблицу!


|       |Внешняя  |Внутренний  |Параметр  |
|---------|:---------|:---------|---------|
|__Тип 1__   |  MA + Win       | MA + Win         |  AllowAllExternallyAndInternally       |
|__Тип 2__   |  MA       | MA + Win         | BlockWindowsAuthExternally        |
|__Тип 3__   |  Ma       | Ma        | BlockWindowsAuthExternallyAndInternally        |
|__Тип 4__   |  Ma       | Win        | BlockWindowsAuthExternallyAndModernAuthInternally    |
|__Тип 5__   |  MA + Win       | Win        | BlockModernAuthInternally         |

__Тип 1. Описание:__ Это сценарий по умолчанию, когда включена ma __для__ Skype для бизнеса Server. Другими словами, это *отправная точка при* настройке ma.

__Описание типа 2:__ Эта топология блокирует *NTLM* извне, но позволяет NTLM или Kerberos (для клиентов, которые не поддерживают ADAL) работать *внутри организации.* Если ваши клиенты поддерживают ADAL, они будут использовать ma внутри организации.

__Описание типа 3:__ Для этой топологии требуется ma для всех пользователей. В этой топологии будут работать все клиенты с возможностью ADAL, и пароли не будут применяться, если, например, отключить использование паролей с использованием auth на основе сертификатов.

__Описание типа 4:__ Эта топология блокирует NTLM *извне и* внутреннее управление ma. Он позволяет всем *клиентам использовать* устаревшие методы внутренней *проверки* подлинности (даже клиенты с возможностью ADAL).

__Тип 5 Описание:__ внешние клиенты ADAL будут использовать ma, а все клиенты, которые не поддерживают ADAL, будут использовать устаревшие методы проверки подлинности. Но все *клиенты* *будут* использовать устаревшую проверку подлинности (включая все клиенты с возможностью ADAL).

Очень легко уследить за целью защиты паролей в доступных параметрах. Помните, что в идеальной ситуации следует использовать ma внешне (например, путем настройки подлинности на основе сертификатов), чтобы избежать атак DOS. If you leverage it internally for your modern clients, you'll also future-proof your network regarding Skype for Business Server DOS attacks.

## <a name="why-to-use-set-csauthconfig-at-the-global-level"></a>Причины использования Set-CsAuthConfig на глобальном уровне

Этот `Set-CsAuthConfig` cmdlet влияет на конфигурацию ролей регистратора и веб-служб.

Этот cmdlet предназначен для запуска на глобальном уровне сервера Skype для бизнеса. Его *можно* запускать на уровне  пула, но это не рекомендуется, так как это усложняет установку. При запуске этих команд на уровне пула, если в пул включены не все роли (например, у него нет веб-служб), параметры будут установлены только для роли регистратора. В этом случае веб-службы будут продолжать использовать параметры глобального уровня, что может привести к путанице (особенно если это происходит непреднамеренно).

Если клиент использует параметры Регистратора из одного пула, а параметры веб-служб из другого пула, а параметры проверки подлинности находятся в несогласованном состоянии, клиенты могут не войти в систему.

Кроме того, если для пула присутствует только одна роль: 
* Set-будет устанавливать только параметры, соответствующие роли, которая существует. Специальное предупреждение не выдается, так как некоторые параметры *не заданы.* 
* Get-возвращает параметр, соответствующий существовать роли, и глобальные параметры для не существует роли.
* Если ни одна из ролей не существует для пула, команды Set и Get-возвращают сообщение об ошибке.
* Если обе роли присутствуют для пула, но политики не определены на уровне пула, Get-возвращает сообщение об ошибке.

Для этих значений может оказаться мудрее сделать get-для этих значений и сделать снимок экрана или записать их начальное состояние перед внесением каких-либо изменений. Вы также можете сохранить журнал изменений в OneNote.

> [!NOTE]
> 
> Примечание. После настройки CsAuthConfig необходимо запустить Enable-CsComputer на каждом компьютере, чтобы параметры вступили в силу.

> [!IMPORTANT]
> Если вы используете Lync Web Access (LWA) и должны использовать доступ на основе форм (FBA) для внешнего доступа, перенастройку LWA, чтобы клиенты могли получать к нему доступ с анонимным доступом для поддержки этих сценариев. Аналогично, если вы используете пин-код для телефонного номера, FBA будет заблокировано только для внешних пользователей. Если им нужно изменить пин-код, им потребуется войти в свою корпорацию, чтобы сделать это внутри компании.

> [!NOTE]
> 
> Если вы используете параметр BlockWindowsAuthExternally для внешнего блокировки NTLM, следует помнить, что это также блокирует NTLM для канала SIP. Однако клиенты Skype для бизнеса и Lync более новых версий, чем 2010, по-прежнему смогут входить в систему, так как они будут использовать NTLM over HTTP для входа внутри компании, а затем получать сертификат для входа через SIP. Однако в этом случае клиенты старше 2010 не смогут войти в систему внутри организации, и вы можете рассмотреть возможность обновления этих приложений, чтобы пользователи могли возобновить безопасные функции.

> [!IMPORTANT] 
> Некоторые веб-приложения Skype для бизнеса не поддерживают ma. Поэтому с помощью сценария BlockWindowsAuthExternallyAndInternally вы не сможете получить доступ к этим приложениям. Applications without MA support are Web Scheduler, Dial-In Page, Skype for Business Control Panel (CSCP) and Response Group Settings Page. 

## <a name="links"></a>Ссылки 
- Дополнительные сведения о PowerShell:
    -  [Get-CsAuthConfig](https://docs.microsoft.com/powershell/module/skype/get-csauthconfig?view=skype-ps)
    -  [Set-CsAuthConfig](https://docs.microsoft.com/powershell/module/skype/set-csauthconfig?view=skype-ps)

- Чтобы получить дополнительные инструкции по использованию команд или в cu, необходимых для их установки:
    - [Сводка по cmdlets](https://support.microsoft.com/help/4346673/new-cmdlets-to-manage-skype-for-business-server-2015-authentication)
    - [Обновления для Skype для бизнеса Server 2015](https://support.microsoft.com/help/3061064/updates-for-skype-for-business-server-2015) (общие)
    - The [July 2018 Skype for Business Server 2015, Core Components CU](https://support.microsoft.com/help/4340903/july-2018-cumulative-update-6-0-9319-534-for-skype-for-business-server) (6.0.9319.534)


 
