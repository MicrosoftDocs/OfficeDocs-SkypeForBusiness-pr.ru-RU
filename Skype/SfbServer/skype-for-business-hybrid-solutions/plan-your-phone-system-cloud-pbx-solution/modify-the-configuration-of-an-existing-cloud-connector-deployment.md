---
title: Изменение конфигурации существующего развертывания Cloud Connector
ms.reviewer: ''
ms.author: crowe
author: CarolynRowe
manager: serdars
ms.date: 2/15/2018
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection:
- Strat_SB_Hybrid
ms.custom: ''
ms.assetid: 90490c65-0e40-4e85-96e1-751f27897e25
description: Выполните действия, описанные в этой статье, чтобы изменить конфигурацию существующего выпуска Skype для бизнеса Cloud Connector 1.4.1 или более поздней версии.
ms.openlocfilehash: 32a231ed85b94c09591adfcc6299cba704be267f
ms.sourcegitcommit: e64c50818cac37f3d6f0f96d0d4ff0f4bba24aef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2020
ms.locfileid: "41799439"
---
# <a name="modify-the-configuration-of-an-existing-cloud-connector-deployment"></a>Изменение конфигурации существующего развертывания Cloud Connector
 
Выполните действия, описанные в этой статье, чтобы изменить конфигурацию существующего выпуска Skype для бизнеса Cloud Connector 1.4.1 или более поздней версии. 
  
## <a name="modify-the-configuration-of-a-single-site"></a>Изменение конфигурации отдельного сайта
<a name="BKMK_SIngleSite"> </a>

Если сайт содержит только одно устройство, при необходимости изменить параметры конфигурации после его развертывания можно внести изменения в файл CloudConnector.ini и снова запустить развертывание.
  
1. Выполните следующий командлет, чтобы удалить все существующие виртуальные машины на сервере узла.  
    
   ```powershell
   Uninstall-CcAppliance
   ```

2. Выполните следующий командлет, чтобы отменить регистрацию устройства:
    
   ```powershell
   Unregister-CcAppliance
   ```

3. Измените файл CloudConnector.ini в каталоге устройств.
    
4. Чтобы обновить конфигурацию, запустите следующий командлет: (этот шаг применим только для версии 2, для предыдущих версий — переход к следующему шагу).
    
   ```powershell
   Import-CcConfiguration 
   ```

5. Выполните следующий командлет, чтобы зарегистрировать устройство снова:
    
   ```powershell
   Register-CcAppliance
   ```

6. Выполните следующий командлет, чтобы установить Skype для бизнеса Cloud Connector Edition:
    
   ```powershell
   Install-CcAppliance
   ```

При наличии нескольких устройств на сайте необходимо выполнить эти шаги, изменить файл CloudConnector.ini и последовательно развернуть все устройства снова.
  
1. Выполните следующий командлет, чтобы удалить все существующие виртуальные машины на текущем устройстве.  
    
   ```powershell
   Uninstall-CcAppliance
   ```

2. Выполните следующий командлет, чтобы отменить регистрацию устройства:
    
   ```powershell
   Unregister-CcAppliance
   ```

3. Измените файл CloudConnector.ini в каталоге устройств.
    
4. Чтобы обновить конфигурацию, запустите следующий командлет: (этот шаг применим только для версии 2, для предыдущих версий — переход к следующему шагу).
    
   ```powershell
   Import-CcConfiguration 
   ```

5. Выполните следующий командлет, чтобы зарегистрировать устройство снова:
    
   ```powershell
   Register-CcAppliance
   ```

6. Выполните следующий командлет на всех остальных устройствах сайта, чтобы получить последнюю конфигурацию:
    
   ```powershell
   Publish-CcAppliance
   ```

7. Запустите следующий командлет для повторного развертывания облачного соединителя на текущем устройстве:
    
   ```powershell
   Install-CcAppliance
   ```

## <a name="modify-the-configuration-of-multiple-sites"></a>Изменение конфигурации нескольких сайтов
<a name="BKMK_MultipleSites"> </a>

Чтобы изменить конфигурацию нескольких сайтов в развертывании, выполните указанные ниже действия для одного сайта, обновив один сайт по очереди.
  
## <a name="modify-the-configuration-of-your-office-365-tenant-to-enable-automatic-updates"></a>Включите автоматические обновления в конфигурации своего клиента Office 365.
<a name="BKMK_MultipleSites"> </a>

Чтобы включить автоматическое обновление операционной системы и автоматическое обновление службы BITS, вы должны использовать учетную запись администратора клиента Skype для бизнеса для управления Интернетом и использовать удаленную оболочку PowerShell для клиента, как описано ниже.
  
Если вы отключили автоматическое обновление операционной системы или автоматическое обновление службы BITS, узел и виртуальный компьютер могут пропустить важные обновления Windows, а облачный соединитель не будет обновляться до новой версии автоматически. Настоятельно рекомендуется включить автоматическое обновление.
  
1. Свойству Енаблеаутаупдате сайта должно быть задано значение true (значение по умолчанию). Выполните следующий командлет, чтобы убедиться, что свойство EnableAutoUpdate имеет значение true:
    
   ```powershell
   Get-CsHybridPSTNSite -Identity <SiteName>
   ```

2. Создайте период автоматического обновления для клиента.
    
    Автоматическое обновление может выполняться ежедневно, еженедельно и ежемесячно. Для каждого периода необходимо задать дату начала и продолжительность.
    
   - Для ежедневного обновления требуется указать только время начала и продолжительность.  
    
   - Для еженедельного обновления необходимо указать один или несколько дней недели.
    
   - Ежемесячное обновление может выполняться двумя разными способами. В первом случае указывается день месяца. Во втором задаются недели и дни недели (допускается выбор нескольких элементов).
    
   - Для каждого клиента можно определить 20 периодов времени. По умолчанию для нового клиента устанавливается период, соответствующий периоду обновления операционной системы и компонентов. Чтобы настроить ежедневное, еженедельное или ежемесячное обновление, выполните следующие командлеты:
    
   ```powershell
   New-CsTenantUpdateTimeWindow -Identity Night -Daily -StartTime 22:00 -Duration 6:00
   ```

   ```powershell
   New-CsTenantUpdateTimeWindow -Identity WeekdayNight -Weekly -DaysOfWeek Monday,Tuesday,Wednesday,Thursday,Friday -StartTime 22:00 -Duration 4:00
   ```

   ```powershell
   New-CsTenantUpdateTimeWindow -Identity FirstAndLastWeekend -Monthly -WeeksOfMonth First,Last -DaysOfWeek Sunday,Saturday -StartTime 0:00 -Duration 10:00
   ```

   ```powershell
   New-CsTenantUpdateTimeWindow -Identity MidDayOfMonth -Monthly -DayOfMonth 15 -StartTime 0:00 -Duration 1.00:00
   ```

   - Задайте интервал времени обновления для сайта.  
    
     Интервалы времени обновления BITS-файлов и операционной системы задаются отдельно. В обоих случаях можно настроить один или несколько интервалов времени. Каждый интервал времени может быть назначен разным сайтам для разных целей (обновление BITS-файлов или операционной системы). Выполните следующий командлет, чтобы установить интервал времени для сайта:  
    
   ```powershell
   Set-CsHybridPSTNSite -Identity <SiteName> -BitsUpdateTimeWindow @{add="MidDayOfMonth","WeekdayNight"} -OsUpdateTimeWindow @{replace="Night"}
   ```

## <a name="update-the-dedicated-tenant-admin-credentials"></a>Обновите выделенные учетные данные администратора клиента. 
<a name="BKMK_MultipleSites"> </a>

Административные изменения в клиенте Office 365 для облачного соединителя выполняются из учетной записи с необходимыми разрешениями. В версиях облачных соединителей, предшествующих 2,0, эта учетная запись является выделенной учетной записью администратора глобального клиента. В облачных соединителях версии 2,0 и более поздних эта учетная запись может быть учетной записью Office 365 с правами администратора Skype для бизнеса.
  
Если учетные данные учетной записи администратора изменяются в Office 365, вам также нужно обновить локально кэшированные учетные данные в облачном соединителе, выполнив следующую команду администратора PowerShell на каждом устройстве облачного соединителя, которое вы развернули:
  
```powershell
Set-CcCredential -AccountType TenantAdmin
```

## <a name="update-the-password-for-the-host-server"></a>Обновите пароль для сервера узла. 
<a name="BKMK_UpdatePassword"> </a>

> [!NOTE]
> Это раздел применяется только к Cloud Connector версии 2.0 и более поздних. 
  
Все учетные данные облачного соединителя хранятся в следующем файле: "%Системдриве%\програмдата\клаудконнектор\кредентиалс. \<CurrentUser\>. XML ". При изменении пароля на сервере узла необходимо обновить учетные данные, сохраненные локально.
  
Чтобы обновить локально хранящиеся учетные данные на устройстве облачного соединителя, используйте командлеты [Get-кккредентиал](get-cccredential.md) и [Set-кккредентиал](set-cccredential.md) , а затем выполните указанные ниже действия.
  
1. Выполните следующие команды, чтобы получить пароли, которые вам понадобятся в дальнейшем.  
    
   - Get-CcCredential -AccountType DomainAdmin -DisplayPassword
    
   - Get-CcCredential -AccountType VMAdmin -DisplayPassword
    
   - Get-CcCredential -AccountType CceService -DisplayPassword
    
2. Измените пароль учетной записи на сервере узла.
    
3. Перезапустите сервер узла.
    
4. Удалите следующий файл: "%Системдриве%\програмдата\клаудконнектор\кредентиалс. \<CurrentUser\>. XML ".
    
5. Запустите консоль PowerShell с правами администратора, а затем выполните команду "Register-Ккапплианце-Local", чтобы повторно ввести пароли после описания. Необходимо ввести тот же пароль, который был указан ранее для развертывания Cloud Connector.
    
По умолчанию для учетных записей VmAdmin и DomainAdmin используется тот же пароль, что и для CceService. Если пароли для учетных записей DomainAdmin, VMAdmin и CceService, возвращаемые на шаге 1, различаются между собой, необходимо выполнить следующие действия.
  
1. Запустите командлет Set-CcCredential -AccountType DomainAdmin, следуя инструкциям ниже.
    
1. При запросе учетных данных старой учетной записи введите учетные данные, которые использовались с паролем для учетной записи CceService.
    
2. При запросе учетных данных новой учетной записи введите пароль для учетной записи DomainAdmin, возвращенный на шаге 1.
    
2. Запустите командлет Set-CcCredential -AccountType VmAdmin, следуя инструкциям ниже.
    
1. При запросе учетных данных старой учетной записи введите учетные данные, которые использовались с паролем для учетной записи CceService.
    
2. При запросе учетных данных новой учетной записи введите пароль для учетной записи VmAdmin, возвращенный на шаге 1.  
    
## <a name="update-the-password-for-the-cceservice-account"></a>Обновление пароля для учетной записи Кцесервице
<a name="BKMK_UpdatePassword"> </a>

> [!NOTE]
> Этот раздел подходит для облачного соединителя версии 2.0.1 и более поздних версий. 
  
Служба облачного соединителя запускает службу управления облачным соединителем. Учетная запись Кцесервице создается при развертывании Cloud Connector Edition и хранится в следующих файлах: "%Системдриве%\програмдата\клаудконнектор\кредентиалс. \<CurrentUser\>. XML "и"%системдриве%\програмдата\клаудконнектор\кредентиалс.. Кцесервице. XML ".
  
Чтобы убедиться в том, что все устройства могут получать доступ к общему каталогу сайта, пароль учетной записи Кцесервице на всех устройствах, развернутых на сайте, должен быть одинаковым. Учитывайте следующее.
  
- По умолчанию для учетной записи Кцесервице задано значение "пароль не просрочен". Если вы обновите пароль, корпорация Майкрософт рекомендует сохранить эти настройки.
    
- Вы должны обновить пароль в течение непиковых периодов использования, а также за пределами периодов автоматического обновления в Windows для BITS или обновлений Windows. Когда вы обновляете пароль, устройство должно быть стоко и перезапускаться, что займет некоторое время. Перезапуск устройства приведет к прерыванию операций автоматического обновления. 
    
- Когда вы измените пароль учетной записи Кцесервице, вам нужно будет указать все учетные данные и обновить их в файле, сохраненном на локальном компьютере. 
    
Для каждого устройства, принадлежащего к одному и тому же сайту PSTN, необходимо указать следующее: 
  
1. Чтобы получить имена учетных записей и пароли, которые будут использоваться позже, выполните следующие команды:
    
   ```powershell
   Get-CcCredential -AccountType TenantAdmin -DisplayPassword
   Get-CcCredential -AccountType TenantAdmin
   Get-CcCredential -AccountType OMSWorkspace -DisplayPassword
   Get-CcCredential -AccountType OMSWorkspace 
   Get-CcCredential -AccountType ExternalCert -DisplayPassword
   Get-CcCredential -AccountType CABackupFile -DisplayPassword
   Get-CcCredential -AccountType CceService -DisplayPassword
   Get-CcCredential -AccountType VMAdmin -DisplayPassword
   Get-CcCredential -AccountType DomainAdmin -DisplayPassword
   ```

2. Запустите командлет Enter-Ккупдате, чтобы очистить устройство и переместить его в режим ручного обслуживания.
    
3. Обновите пароль учетной записи Кцесервице на сервере узла.
    
4. Перезапустите сервер узла.
    
5. Запустите командлет Restore-Кккредентиалс, чтобы повторно ввести пароль, следуя описанию. 
    
    Убедитесь, что вы ввели тот же пароль, который вы указали перед развертыванием облачного соединителя, кроме учетной записи Кцесервице. Введите новый пароль для учетной записи Кцесервице. Убедитесь, что новый пароль для учетной записи Кцесервице одинаков для всех устройств на сайте КТСОП.
    
6. По умолчанию для учетных записей VmAdmin и DomainAdmin используется тот же пароль, что и для CceService. Если пароли для учетных записей DomainAdmin, VMAdmin и CceService, возвращаемые на шаге 1, различаются между собой, необходимо выполнить следующие действия.
    
7. Запустите командлет Set-CcCredential -AccountType DomainAdmin, следуя инструкциям ниже.
    
   - При запросе учетных данных старой учетной записи введите учетные данные, которые использовались с паролем для учетной записи CceService.
    
   - При запросе учетных данных новой учетной записи введите пароль для учетной записи DomainAdmin, возвращенный на шаге 1.
    
8. Запустите командлет Set-CcCredential -AccountType VmAdmin, следуя инструкциям ниже.
    
   - При запросе учетных данных старой учетной записи введите учетные данные, которые использовались с паролем для учетной записи CceService.
    
   - При запросе учетных данных новой учетной записи введите пароль для учетной записи VmAdmin, возвращенный на шаге 1.  
    
9. Запустите командлет Exit-Ккупдате, чтобы переместить устройство из режима ручного обслуживания.
    
10. После выполнения этих действий на всех устройствах на одном сайте КТСОП удалите следующие файлы в корневом каталоге сайта.
    
    - кклоккфиле
    
    - Полное\<доменное имя пула внешних SIP Site_ Edge\>
    
    - Полное\<доменное имя пула внешних SIP Tenant_ Edge\>
    
    - Полное\<доменное имя пула внешних SIP TenantConfigLock_ Edge\>
    
## <a name="add-a-new-sip-domain"></a>Добавьте новый домен SIP. 
<a name="BKMK_UpdatePassword"> </a>

Чтобы добавить новый домен SIP (или несколько доменов SIP) в существующее развертывание облачного соединителя, выполните указанные ниже действия.
  
1. Вам потребуется выполнить процедуру по изменению домена в Office 365 и убедиться, что вы можете добавлять записи DNS. Дополнительные сведения о настройке домена в Office 365 можно найти в разделе [Добавление домена в office 365](https://support.office.com/en-us/article/Add-a-domain-to-Office-365-6383f56d-3d09-4dcb-9b41-b5f5a5efd611).
    
2. Обновите файл конфигурации облачного соединителя с помощью нового домена или доменов SIP.
    
3. Запрос нового внешнего сертификата пограничного сервера с дополнительными именами SAN для SIP. Domain для каждого домена SIP, определенного в конфигурации облачного соединителя. 
    
4. Задайте путь к новому внешнему сертификату пограничного компонента в следующем виде:
    
   ```powershell
   Set-CcExternalCertificateFilePath -Path <Full path to External certificate>
   ```

5. 
    
    Следуйте инструкциям, приведенным в статьях [Изменение конфигурации отдельного сайта](modify-the-configuration-of-an-existing-cloud-connector-deployment.md#BKMK_SIngleSite) или [Изменение конфигурации нескольких сайтов](modify-the-configuration-of-an-existing-cloud-connector-deployment.md#BKMK_MultipleSites).
    
## <a name="modify-the-primary-sip-domain"></a>Измените основной домен SIP.
<a name="BKMK_UpdatePassword"> </a>

Если вам нужно изменить основной домен SIP в развертывании облачного соединителя, выполните указанные ниже действия.
  
1. Вам потребуется выполнить процедуру по изменению домена в Office 365 и убедиться, что вы можете добавлять записи DNS. Дополнительные сведения о настройке домена в Office 365 можно найти в разделе [Добавление домена в office 365](https://support.office.com/en-us/article/Add-a-domain-to-Office-365-6383f56d-3d09-4dcb-9b41-b5f5a5efd611).
    
2. Обновите файл конфигурации облачного соединителя с новым доменом SIP.
    
3. Запрос нового внешнего сертификата пограничного сервера с дополнительными именами SAN для SIP. Domain для каждого домена SIP, определенного в конфигурации облачного соединителя. 
    
4. Задайте путь к новому внешнему сертификату пограничного компонента в следующем виде:
    
   ```powershell
   Set-CcExternalCertificateFilePath -Path <Full path to External certificate>
   ```

5. 
    
    Удалите регистрацию клиента для каждого устройства на сайте, выполнив следующий командлет из оболочки администратора PowerShell для облачного соединителя:
    
   ```powershell
   Unregister-CcAppliance
   ```

6. 
    
    Удалите регистрацию клиента для каждого устройства на сайте, выполнив следующий командлет в консоли PowerShell Skype для бизнеса Online.
    
   ```powershell
   Remove-CsHybridPSTNSite
   ```

7. 
    
    Удалите каждое устройство, выполнив следующий командлет в PowerShell администратора для облачного соединителя:
    
   ```powershell
   Uninstall-CcAppliance
   ```

8. 
    
     Зарегистрируйте каждое устройство, выполнив следующий командлет в PowerShell администратора в облачном соединителе:
    
   ```powershell
   Register-ccAppliance
   ```

9. 
    
     Установите каждое устройство по одному, выполнив следующий командлет в PowerShell администратора в облачном соединителе:
    
   ```powershell
   Install-CcAppliance
   ```

## <a name="replace-the-external-edge-certificate-with-a-new-certificate"></a>Замена внешнего сертификата пограничного сервера новым сертификатом
<a name="BKMK_UpdatePassword"> </a>

Если вам потребуется заменить внешний сертификат EDGE на устройствах облачного соединителя, вам потребуется получить новый пограничный сертификат, подготовить PFX-файл с закрытым ключом и цепочкой полного сертификата, а затем выполнить указанные ниже действия для каждого устройства.
  
1. Переведите устройство в режим обслуживания с помощью командлета Enter-Ккупдате.
    
2. Выполните следующую команду. 
    
   ```powershell
   Set-CcExternalCertificateFilePath -Target EdgeServer -Path <Full file path of new certificate including filename> -Import
   ```

3. 
    
    Если пароль нового сертификата совпадает со старым, импорт будет выполнен успешно. Если пароль не изменится, появится сообщение о том, что пароль неверен, и вам потребуется сбросить пароль, запустив командлет Register-Ккапплианце с параметром-Local, а затем повторив шаг 2. 
    
4. Извлеките устройство из режима обслуживания с помощью командлета Exit-Ккупдате.
    

