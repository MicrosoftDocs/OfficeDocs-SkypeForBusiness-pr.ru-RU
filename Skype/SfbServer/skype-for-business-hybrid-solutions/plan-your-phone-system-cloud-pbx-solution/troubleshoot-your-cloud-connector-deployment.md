---
title: Устранение неполадок с развертыванием Cloud Connector
ms.reviewer: ''
ms.author: crowe
author: CarolynRowe
manager: serdars
ms.date: 12/5/2017
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection:
- Strat_SB_Hybrid
ms.custom: ''
ms.assetid: e6cf58cc-dbd9-4f35-a51a-3e2fea71b5a5
description: Устранение неполадок в развертывании Cloud Connector Edition.
ms.openlocfilehash: 9da10f1b3e8dd800e57b46f6a56eb6a82c29e22c
ms.sourcegitcommit: 01087be29daa3abce7d3b03a55ba5ef8db4ca161
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2021
ms.locfileid: "51094827"
---
# <a name="troubleshoot-your-cloud-connector-deployment"></a>Устранение неполадок с развертыванием Cloud Connector

> [!Important]
> Cloud Connector Edition завершит карьеру 31 июля 2021 г. вместе со Skype для бизнеса Online. После обновления организации до Teams узнайте, как подключить сеть локальной телефонии к Teams с помощью прямой [маршрутизации.](/MicrosoftTeams/direct-routing-landing-page)
 
Устранение неполадок в развертывании Cloud Connector Edition.
  
В этом разделе описываются решения распространенных проблем с развертываниями Cloud Connector Edition. Если у вас возникли проблемы с вызовами в и из сети общедоступных телефонных звонков (PSTN), вы можете исследовать, следуя решениям, описанным в этой теме.
  
Cloud Connector предоставляет встроенные механизмы автоматического решения некоторых проблем. Автоматический процесс обнаружения ищет потенциальные проблемы с устройствами облачного соединителя и по возможности принимает меры по исправлению этих проблем без вмешательства администратора. Процесс обнаружения работает следующим образом:
  
- **Последовательность обнаружения:** Служба управления облачным соединитетелем выполняет процесс каждые 60 секунд для обнаружения того, не работает ли устройство. В версии Cloud Connector 2.0 и более поздней версии процесс обнаружения использует переключатель Skype для бизнеса Corpnet для подключения PowerShell к машинам облачного соединитела; для версий, предшествующих 2.0, в процессе обнаружения используется переключатель управления облачным соединитетелем.
    
    > [!NOTE]
    > Для успешного автоматического восстановления необходимо подключение к сети между хост-компьютерами и виртуальными машинами через переключатель хост-сети. Убедитесь, что проверьте подключение к сети, чтобы обеспечить успешное автоматическое обнаружение и восстановление. 
  
- **Мониторинг:** Следующие службы отслеживаются в версии Cloud Connector 2.0 и более поздней версии:
    
  - Виртуальные машины не подключены к корпоративным или виртуальным коммутаторам облачного соединитела
    
  - Виртуальные машины находятся в сохраненных или остановленных состояниях
    
  - Службы центрального сервера управления: REPLICA, MASTER
    
  - Службы-посредники: REPLICA, RTCSRV и MEDSVC
    
  - Службы edge Server: REPLICA, RTCSRV, RTCDATAPROXY, RTCMRAUTH, RTCMEDIARELAY
    
  - Правила входящий брандмауэр отключены для CS RTCSRV на краевом сервере, CS RTCMEDSRV на сервере-посреднике
    
    В версии Cloud Connector 1.4.2 отслеживаются только следующие службы:
    
  - Службы-посредники: RTCSRV и MEDSVC
    
  - Служба edge Server: RTCSRV
    
- **Процесс восстановления:** Если какие-либо отслеживаемые службы не будут работать, устройство будет помечено вниз, а службы будут остановлены и помечены вручную до тех пор, пока не будут устранены все проблемы. Это предотвратит маршрутику вызовов на устройство, которое может привести к сбоям вызовов.
    
    Служба управления облачными соединителями повторно выполнит автоматическое восстановление следующим образом.
    
  - Начальный интервал повторной работы — каждые 10 секунд с максимальным интервалом в один час.
    
  - Для первых трех попыток восстановления интервал составляет 10 секунд. Начиная с четвертой повторной работы, время интервала увеличивается в два раза по сравнению с предыдущим интервалом. Например, четвертая повторное повторить будет происходить через 20 секунд, пятая за 40 секунд и так далее. 
    
  - Когда будет достигнуто максимальное время интервала в один час, повторы будут продолжаться один раз в час.
    
  - При успешном восстановлении значения интервала и повторной оценки заданные для них начальные значения.
    
  - Если служба управления перезапущена, количество интервалов и повторов сбрасывается с первоначальных значений.
    
## <a name="troubleshooting"></a>Устранение неполадок

Ниже ниже поданы решения распространенных проблем:
  
- **Проблема. При запуске сценариев развертывания развертывание сбой или остановка ответа. После входа в каждый VM IP-адрес отсутствует или неправильная для службы управления/внутренней и внешней службы.**
    
    **Разрешение:** Эта проблема не может быть решена автоматически. Во время работы они не могут быть добавлены в VMs. Пожалуйста, отключите и удалите эти VMs в диспетчере hyper-v, а затем запустите следующие команды:
    
  ```powershell
  Uninstall-CcAppliance
  ```

  ```powershell
  Install-CcAppliance
  ```

- 
    
    **Проблема. После установки сервера Active Directory и леса сервер CMS Server и/или сервер-посредник не присоединились к домену правильно.**
    
    **Разрешение:** Чтобы устранить эту проблему, необходимо предпринять следующие действия:
    
  - Войдите на сервер Active Directory Server и убедитесь, что домен создан правильно.
    
  - Войдите на сервер CMS/Mediation Server и убедитесь, что на корневом NIC назначен допустимый IP-адрес, а допустимый статический IP-адрес и DNS настроены как IP-адрес сервера AD.
    
  - Войдите на сервер CMS/Mediation Server и откройте командную подсказку. Убедитесь, что вы можете получить доступ к FQDN и IP-адресу сервера Active Directory Server. Если это невозможно, может возникнуть конфликт IP-адресов. Попробуйте назначить новый IP для Active Directory и соответствующим образом обновить DNS на сервере CMS/Mediation.
    
- **Проблема. Вы получаете следующее сообщение об ошибке" Remove-VMSwitch: Failed при удалении виртуального переключателя Ethernet. Виртуальный переключатель "Переключатель управления облачным соединитетелем" не может быть удален, так как он используется с помощью виртуальных машин или для детских пулов".**
    
    **Разрешение:** После развертывания не был удален "Переключатель управления облачным соединитетелем". Если вы нажмёте эту ошибку, перейдите к менеджеру Hyper-v и убедитесь, что к ней по-прежнему не подключен виртуальный компьютер. Если виртуальные машины по-прежнему подключены, отключите их и удалите переключатель управления. Если переключатель управления по-прежнему не удается удалить, перезапустите хост-сервер и повторите попытку.
    
- **Проблема. Вы получаете следующее сообщение об ошибке: "Не удалось запустить службу RTCMRAUTH. Убедитесь, что служба не отключена".**
    
    > [!NOTE]
    > Эта проблема применяется только к версиям облачного соединитела раньше 1.4.2. 
  
    Сбой в запуске также может быть из-за того, что этот сервер переднего конца был ранее сбой (с помощью компьютера сбой более). Если это так, пожалуйста, вызывайте сбой обратно (с помощью компьютера сбой обратно).
    
    **Разрешение:** Эта проблема происходит на краевом сервере, когда корневой сертификат CA или промежуточный сертификат ЦС не доверяют edge Server. Даже если внешний сертификат можно импортировать, но цепочка сертификатов нарушена. При этом условии служба RTCMRAUTH и/или RTCSRV не может запускаться.
    
    Ввозимый корневой сертификат CA и все промежуточные сертификаты ЦС внешнего сертификата вручную в Edge Server, а затем перезапустите edge Server. После запуска служб RTCMRAUTH и RTCSRV на краевом сервере перейдите на хост-сервер, запустите консоль PowerShell в качестве администратора и запустите следующий комдлет, чтобы перейти на новое развертывание:
    
  ```powershell
  Switch-CcVersion
  ```

- 
    
    **Проблема. При применении обновлений Windows сервер хост-сервера был перезапущен, а вызовы, служив на сервере, сбои.**
    
    **Разрешение:** Если вы развернули среду с высокой доступностью, корпорация Майкрософт предоставляет комлет, который поможет переместить одну хост-машину (экземпляр развертывания) в текущую топологию или выйти из нее при проверке и установке обновления Windows вручную. Чтобы выполнить следующие действия, используйте следующие действия:
    
1. На сервере хост-сервера запустите консоль PowerShell в качестве администратора, а затем запустите:
    
   ```powershell
   Enter-CcUpdate
   ```

2. Проверьте обновления и установите все доступные обновления.
    
3. В консоли PowerShell запустите следующий cmdlet:
    
   ```powershell
   Exit-CcUpdate
   ```

- 
    
    **Проблема. При вызове клиента Skype для бизнеса с помощью номера PSTN вызов не может быть перенастроен на конференцию, приглашая другой номер PSTN.**
    
    **Разрешение:** Чтобы устранить эту проблему, см. [в руб. Настройка параметров гибридного сервера-посредника](configure-cloud-connector-integration-with-your-office-365-tenant.md#BKMK_ConfigureMediationServer)в Интернете.
    
- **Проблема. При установке сервера Active Directory отображается предупреждение об обновлении Windows. "Автоматическое обновление Windows не включено. Чтобы убедиться, что ваша недавно установленная роль или функция автоматически обновляется, включите обновление Windows".**
    
    **Разрешение:** Запустите сеанс удаленной powerShell для клиента с помощью учетных данных администратора Skype для бизнеса, а затем запустите следующий cmdlet, чтобы проверить конфигурацию _EnableAutoUpdate_ вашего сайта:
    
  ```powershell
  Get-CsHybridPSTNSite
  ```

    Если  _значение EnableAutoUpdate_ заданной для **True,** вы можете смело игнорировать это предупреждение, так как служба CCEManagement будет обрабатывать загрузку и установку обновлений Windows для виртуальных машин и хост-сервера. Если _EnableAutoUpdate_ задавалось **false,** запустите следующий кодлет, чтобы задать его **true.**
    
  ```powershell
  Set-CsHybridPSTNSite -EnableAutoUpdate $true
  ```

    Кроме того, вы можете вручную проверять и устанавливать обновления. (см. следующий раздел).
    
- **Проблема. Вы получаете сообщение об ошибке: не удается зарегистрировать устройство из-за текущего ввода/конфигурации или или конфликтов с существующим \<SiteName\> \<ApplianceName\> \<Mediation Server FQDN\> \<Mediation Server IP Address\> устройством(ы). Удалите устройство конфликтов или обновите сведения о входе или конфигурации, а затем снова зарегистрируйтесь. ' при запуске Register-CcAppliance для регистрации текущего устройства в Интернете.**
    
    **Разрешение:** Значения для \<ApplianceName\> и должны \<Mediation Server FQDN\> быть уникальными \<Mediation Server IP Address\> и использоваться только для одной регистрации устройства. По умолчанию происходит \<ApplianceName\> от имени хоста. \<Mediation Server FQDN\> и \<Mediation Server IP Address\> определяется в файле ini конфигурации.
    
    Например, использование (ApplianceName= MyserverNew, Сервер-посредник FQDN=ms.contoso.com, IP-адрес сервера-посредника=10.10.10.10) для регистрации в SiteName=MySite, но если имеется зарегистрированное устройство (ApplianceName= Myserver, Mediation Server FQDN=ms.contoso.com, IP-адрес сервера-посредника=10.10.10), у вас будет конфликт.
    
    Сначала проверьте файл CloudConnector.ini в разделе Каталог ApplianceRoot. Вы получите \<SiteName\> и значения в \<Mediation Server FQDN\> \<Mediation Server IP Address\> файле. \<ApplianceName\> это имя сервера хост-сервера.
    
    Во-вторых, запустите удаленную powerShell клиента с помощью учетных данных администратора клиента Skype для бизнеса, а затем запустите следующий cmdlet для проверки зарегистрированного устройства (s).
    
  ```powershell
  Get-CsHybridPSTNAppliance
  ```

    После выявления конфликтов можно обновить CloudConnector.ini с информацией, которая соответствует зарегистрированным устройствам, или отозарегистрировать существующий прибор для разрешения конфликтов.
    
  ```powershell
  Unregister-CsHybridPSTNAppliance -Force
  ```

    
- **Проблема. Get-CcRunningVersion возвращает пустое значение, если на хосте запущен развернутый прибор.**
    
  **Разрешение:** Это может произойти при обновлении с 1.3.4 или 1.3.8 до 1.4.1. После установки версии 1.4.1 с помощью .msi необходимо выполнить перед запуском любого `Register-CcAppliance` другого cmdlet. `Register-CcAppliance` будет перенесен файл module.ini с %UserProfile%\CloudConnector на %ProgramData%\CloudConnector. Если вы его пропустили, module.ini будет создан в папке %ProgramData%\CloudConnector и заменит сведения о запущенной или резервной версии для 1.3.4 или 1.3.8.
    
  Сравнение module.ini файлов в папке %UserProfile%\CloudConnector и %ProgramData%\CloudConnector. Если есть различия, удалите файл module.ini в %ProgramData%\CloudConnector и повторно. `Register-CcAppliance` Вы также можете вручную изменить файл в правильную версию запуска и резервного копирования.
    
- **Проблема. После запуска Switch-CcVersion для перехода на старую версию, которая отличается от текущей версии скрипта, поддержка высокой доступности для этой старой версии не поддерживается.**
    
    **Разрешение:** Например, вы обновили с 1.4.1 до 1.4.2. Текущая версия скрипта, которую можно определить с помощью запуска, и запущенная версия, которую можно определить при запуске, — `Get-CcVersion`  `Get-CcRunningVersion` 1.4.2. В это время при запуске для переключения запущенной версии на 1.4.1 поддержка высокой доступности для этой старой `Switch-CcVersion` версии не будет.
    
    Чтобы получить полную поддержку высокой доступности, переключение на 1.4.2, поэтому запущенная версия и версия скрипта одинаковы. Если у вас возникли проблемы с развертыванием 1.4.2, необходимо как можно скорее удалить его и переустановить.
    
- **Проблема. Сертификаты или внутренние сертификаты, выдавлимые в Центральный магазин управления, сервер-посредник и edge Server, находятся вблизи истечения срока действия или находятся под угрозой.**
    
    **Разрешение:** Сертификаты сертификации Skype для бизнеса действительны в течение пяти лет. Внутренние сертификаты, выдавлимые в Центральный магазин управления, сервер-посредник и edge Server, действительны в течение двух лет.
    
    > [!NOTE]
    > В версии Cloud Connector 2.0 и более поздней версии Renew-CcServerCertificate изменен на Update-CcServerCertificate, а Renew-CcCACertificate — на Update-CcCACertificate. 
  
    Если внутренние сертификаты, выдав центру управления, серверу-посреднику и edge Server, находятся вблизи истечения срока действия или компрометации, запустите Renew-CcServerCertificate или Update-CcServerCertificate для обновления сертификатов.
    
    Если срок действия сертификатов сертификации истек, запустите Renew-CcCACertificate или Update-CcCACertificate, чтобы обновить сертификаты.
    
    **Если сертификаты органа сертификации скомпрометированы** и на сайте имеется только один прибор, выполните следующие действия:
    
1. Запустите Enter-CcUpdate для слива служб и вставьте устройство в режим обслуживания.
   
   ```powershell
   Enter-CcUpdate
   ```
   
2. Запустите следующие cmdlets для сброса и создания новых сертификатов сертификации и всех внутренних сертификатов сервера:
    
    Для выпусков облачного соединитетеля до 2.0:
    
    ```powershell
    Reset-CcCACertificate 
    Renew-CcServerCertificate 
    Remove-CcLegacyServerCertificate 
    ```

    Или для облачного соединитетеля выпуска 2.0 и более поздней версии:
    
    ```powershell
    Reset-CcCACertificate 
    Update-CcServerCertificate 
    Remove-CcLegacyServerCertificate 
    ```
    
3. Если TLS используется между шлюзом и сервером-посредником, запустите Export-CcRootCertificate из устройства, а затем установите экспортируемую справку на шлюзы PSTN. Кроме того, может потребоваться повторное выпуск сертификата на шлюзе.

   ```powershell
   Export-CcRootCertificate
   ```

4. Запустите Exit-CcUpdate, чтобы запустить службы и выйти из режима обслуживания.

   ```powershell
   Exit-CcUpdate
   ```


    **Если сертификаты сертификационного** органа скомпрометированы и на сайте имеется несколько устройств, выполните следующие последовательно действия на каждом устройстве на сайте.
    
    Корпорация Майкрософт рекомендует выполнять эти действия в периоды не пикового использования.
    
1. На первом устройстве запустите Remove-CcCertificationAuthorityFile для очистки файлов резервного копирования ca \<SiteRoot\> в каталоге.

     ```powershell
     Remove-CcCertificationAuthorityFile
     ```
    
2. Запустите Enter-CcUpdate, чтобы осушить службы и поместить каждое устройство в режим обслуживания.

     ```powershell
     Enter-CcUpdate
     ```
    
3. На первом устройстве запустите следующие cmdlets для сброса и создания новых сертификатов сертификации и всех внутренних сертификатов сервера:
    
     Для выпусков облачного соединитетеля до 2.0:
    
     ```powershell
     Reset-CcCACertificate
     Renew-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```

     Или для облачного соединитетеля выпуска 2.0 и более поздней версии:
    
     ```powershell
     Reset-CcCACertificate
     Update-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```

4. На первом устройстве запустите следующий комдлет, чтобы архивовать файлы ЦС в \<SiteRoot\> папку.
    
     ```powershell
     Backup-CcCertificationAuthority
     ```
   
5. На всех остальных устройствах на том же сайте запустите следующие команды для использования файлов резервного копирования CA, чтобы все устройства использовали один и тот же корневой сертификат, а затем запросили новые сертификаты. 
   
     ```powershell
     Reset-CcCACertificate
     Update-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```
     
6. Если TLS используется между шлюзом и сервером-посредником, запустите Export-CcRootCertificate из любого устройства на сайте, а затем установите экспортируемую справку на шлюзы PSTN. Кроме того, может потребоваться повторное выпуск сертификата на шлюзе.
  
     ```powershell
     Export-CcRootCertificate
     ```
     
7. Запустите Exit-CcUpdate, чтобы запустить службы и выйти из режима обслуживания. 

     ```powershell
     Exit-CcUpdate
     ```
    
    
- **Проблема. В журнале службы управления облачными соединителями вы получаете следующее сообщение об ошибке: "C:\Program Files\Skype для бизнес-облачных соединителей Edition\ManagementService\CceManagementService.log": Ошибка CceService: 0: неожиданное исключение при сообщении о состоянии онлайн: System.Management.Automation.CmdletInvocationException: Logon не удалось для пользователя \<Global Tenant Admin\> . Создайте новый объект учетных данных, чтобы убедиться, что вы использовали правильное имя пользователя и пароль. ---\>**
    
    **Разрешение:** Учетные данные глобального клиента Microsoft 365 или Office 365 были изменены с момента регистрации устройства Cloud Connector. Чтобы обновить локально хранимые учетные данные в устройстве Cloud Connector, запустите следующее из администратора PowerShell на устройстве хост:
    
  ```powershell
  Set-CcCredential -AccountType TenantAdmin
  ```

- **Проблема. После изменения пароля учетной записи хост-сервера, используемой для развертывания, вы получаете следующее сообщение об ошибке: "ConvertTo-SecureString: key not valid for use in specified state." in %ProgramFiles%\Skype for Business Cloud Connector Edition\ManagementService\CceManagementService.log или при запуске Get-CcCredential cmdlet.**
    
    **Разрешение:** Все учетные данные cloud Connector хранятся в следующем файле: "%SystemDrive%\Programdata\Cloudconnector\credentials. \<CurrentUser\> . xml". Когда пароль на сервере хост-сервера изменится, вам потребуется обновить учетные данные, хранимые на локальном уровне.
    
    **Если вы работаете в версии Cloud Connector 1.4.2,** регенерируете все пароли облачного соединитетеля, следуя следующим шагам:
    
  1. Перезапустите хост-сервер.
    
  2. Удалите следующий файл: "%SystemDrive%\Programdata\Cloudconnector\credentials. \<CurrentUser\> . xml".
    
  3. Запустите консоль PowerShell в качестве администратора, а затем запустите "Register-CcAppliance-Local", чтобы повторно ввести пароли, следующие описанию. Введите те же пароли, которые были введены ранее для развертывания облачного соединиттеля.
    
     **Если вы работаете в версии Cloud Connector версии 2.0** или более поздней версии, регенерируете все пароли облачного соединиттеля, следуя следующим шагам:
    
  4. Перезапустите хост-сервер.
    
  5. Удалите следующий файл: "%SystemDrive%\Programdata\Cloudconnector\credentials. \<CurrentUser\> . xml" .
    
  6. Запустите консоль PowerShell в качестве администратора, а затем запустите "Register-CcAppliance-Local", чтобы повторно ввести пароли, следующие описанию. 
    
     Если кэшированная папка паролей была сгенерирована с помощью версии Cloud Connector 1.4.2, при запросе используйте пароль VMAdmin для пароля CceService. Введите тот же пароль, который был введен ранее для развертывания облачного соединиттеля для всех остальных учетных записей.
    
     Если кэшированная папка паролей была сгенерирована с помощью облачной соединители версии 1.4.2, а пароли DomainAdmin и VMAdmin отличаются, необходимо выполнить следующие действия:
    
  7. Выполните Set-CcCredential-AccountType DomainAdmin следующим образом:
    
  8. При запросе на старую учетную запись введите учетные данные, используемые для пароля CceService.
    
  9. При запросе новой учетной записи введите пароль для пароля DomainAdmin, который вы использовали ранее.
    
     Если кэшированная папка паролей была сгенерирована с помощью версии 2.0 или более поздней версии Cloud Connector, по умолчанию VmAdmin и DomainAdmin используют тот же пароль, что и CceService. Если вы изменили пароли DomainAdmin и VMAdmin, необходимо выполнить следующие действия:
    
  10. Выполните Set-CcCredential-AccountType DomainAdmin следующим образом:
    
       1. При запросе на старую учетную запись введите учетные данные, используемые для пароля CceService
    
       2. При запросе новой учетной записи введите пароль для пароля DomainAdmin, который вы использовали ранее.
    
  11. Выполните Set-CcCredential-AccountType VmAdmin следующим образом:
    
       1. При запросе на старую учетную запись введите учетные данные, используемые для пароля CceService
    
       2. При запросе новой учетной записи введите пароль для пароля VmAdmin, который вы использовали ранее. 
    
- **Проблема. С помощью облачного соединителя версии 2.1 и более поздней версии при запуске Register-CcAppliance или других комлетов на устройстве вы получаете сообщение об ошибке, например: "Для Each-Object: свойство "Common" не может быть найдено на этом объекте. Убедитесь, что свойство существует. В C:\Program Files\WindowsPowerShell\Modules\CloudConnector\Internal\MtHostCommon.ps1:681 char:14"**
    
    **Разрешение:** Cloud Connector 2.1 и более поздний платформа .NET Framework 4.6.1 или более поздней. Обновите платформа .NET Framework на устройстве до версии 4.6.1 или более поздней версии и запустите cmdlet(s) снова.

- **Проблема. С cloud Connector Edition 2.1 при запуске Install-CcAppliance вы получаете сообщение об ошибке, например: "Не удалось установить новый экземпляр с ошибкой: невозможно задать "состояние", так как только строки можно использовать в качестве значений для установки свойств XmlNode"**

   **Разрешение:** В Cloudconnector.ini разделе [Common] добавьте конфигурию "State" как ниже: CountryCode=US State=WA City=Redmond

   Для строки "Состояние" значение не обязательно, однако строка "Состояние" не может быть удалена из Cloudconnector.ini файла.

- **Проблема. Вы получаете следующее сообщение об ошибке "Dismount-WindowsImage: Dismount-WindowsImage не удалось. Код ошибки = 0xc1550115" при установке или обновлении Cloud Connector Edition.**
    
    **Разрешение:** Запустите консоль PowerShell в качестве администратора, запустите "DISM-Cleanup-Wim". Это позволит очистить все проблемные изображения. Запустите Install-CcAppliance или дождись автоматического обновления битов.
    
- **Проблема. Развертывание первого устройства облачного соединитела в среде HA не удается**
    
    **Разрешение:** Действия, которые вы принимаете, зависят от причины сбой развертывания:
    
  - Если первый аппарат облачного соединителя сбой и вы не можете определить причину сбоя, необходимо установить устройство снова, пока развертывание не будет успешным, а затем установить другие устройства.
    
  - Если первый аппарат облачного соединителя не справился с небольшой проблемой, например с внешним сертификатом, можно устранить проблему без повторной установки устройства. Затем можно использовать удаленную powerShell клиента, чтобы отметить развертывание как успешное следующим образом. (Вы также можете использовать следующие действия, если первое развертывание было успешным, но по некоторым причинам Cloud Connector не сообщает об успешном развертывании.)
    
  - Чтобы получить идентификатор (GUID) первого устройства облачного соединителя, запустите Get-CsHybridPSTNAppliance.
    
  - Чтобы пометить устройство как успешно развернутый, выполните Set-CsCceApplianceDeploymentStatus следующим образом:
    
  ```powershell
  Set-CsCceApplianceDeploymentStatus -Identity <Appliance Identity GUID> -Action Deploy -Status Finished
  ```

- **Проблема. Необходимо вручную проверять и устанавливать обновления Windows на хост-сервере или виртуальных машинах.**
    
   **Разрешение:** Рекомендуется использовать автоматические обновления ОС, предоставляемые Skype для бизнеса Cloud Connector Edition. После регистрации устройства для управления в Интернете и включения автоматического обновления ОС сервер хост и виртуальные машины будут проверять и устанавливать обновления Windows автоматически в соответствии с настройками окне времени обновления ОС.
    
   Если необходимо вручную проверять и устанавливать обновления Windows, выполните действия в этом разделе, применимые к типу развертывания. Чтобы свести к минимуму время простоя, необходимое для обновления, необходимо одновременно обновить сервер хост-сервера и виртуальные машины, работающие на нем.
    
   Если вы хотите, вы можете использовать cлужбы Windows Server Update Services (WSUS) для предоставления обновлений для серверов облачного соединителю. Просто не забудьте настроить обновление Windows, чтобы **не** устанавливаться автоматически.
    
   Сведения о том, как вручную обновить развертывание облачного соединителю, см. в следующем разделе.
    
- **Проблема. При обновлении облачного соединителя до новой сборки не обновляются кодлеты Cloud Connector.** Иногда это происходит, если окно PowerShell остается открытым при автоматическом обновлении.
    
  **Разрешение:** Чтобы загрузить обновленные cmdlets, вы можете сделать любой из следующих действий:
    
   - Закрой PowerShell на устройстве облачного соединитетеля и снова открой PowerShell.
    
     - Или можно запустить Import-Module CloudConnector-Force. 
 
-   **Проблема. "Термин "Stop-CsWindowsService" не распознается как имя cmdlet, function, script file или operable program." при попытке запуска Enter-CcUpdate cmdlet.**

    **Разрешение:** Удаление файла $HOME\AppData\Local\Microsoft\Windows\PowerShell\ModuleAnalysisCache.
PowerShell создает этот файл в качестве кэша командлетов из модулей, которые он находит, чтобы ему не нужно было каждый раз анализировать все модули, так как это сделает процесс действительно медленным. Скорее всего, при чтении из этого кэша в PowerShell была какая-то коррупция файлов, которая предоставляла ложные результаты.

-   **Проблема: "Import-Module CloudConnector" создает ошибку "Импорт-модуль: указанный модуль "CloudConnector" не был загружен, так как в каталоге модулей не обнаружен допустимый файл модуля"**

    **Решение:**
    - Проверка того, что модуль CloudConnector действительно существует в c:\Program Files\WindowsPowerShell\Modules
    
    - После проверки того, что модуль CloudConnector существует в этом расположении, переменная среды PSModulePath, храня путь к расположениям модулей, может быть изменена:
    
     а) Временное изменение: запустите Powershell в качестве администратора и запустите следующую команду: $env:PSModulePath = $env:PSModulePath + "; C:\Program Files\WindowsPowerShell\Modules\"
        
     б) Для настойчивых изменений запустите PowerShell в качестве администратора и запустите следующие команды по одному: $CurrentValue = [Окружающая среда]::GetEnvironmentVariable ("PSModulePath", "Machine") SetEnvironmentVariable ("PSModulePath", $CurrentValue + "; C:\Program Files\WindowsPowerShell\Modules", "Machine")

    
## <a name="install-windows-updates-manually"></a>Установка обновлений Windows вручную

Если вы не хотите использовать автоматические обновления в среде, выполните эти действия, чтобы вручную проверить и применить обновления Windows. Для проверки и установки обновлений Windows может потребоваться перезапуск сервера. При перезапуске хост-сервера пользователи не смогут использовать cloud Connector для места или получения вызовов. Вы можете вручную проверять и устанавливать обновления для управления при обновлении, а затем перезапустить машины по мере необходимости во время, когда вы решите избежать сбоев в работе служб.
  
Чтобы вручную проверить обновления, подключите к каждому серверу хост и откройте **панель управления.** Выберите **обновление Windows System и \> Security,** а затем управляйте обновлениями и перезапусками сервера в соответствующей среде.
  
- Если на сайте есть только один прибор, подключите к каждой виртуальной машине и откройте **панель управления.** Выберите **обновление Windows System и \> Security,** а затем настроите обновления и перезапуски сервера по мере необходимости.
    
- Если на сайте имеется несколько устройств, экземпляр, обновляемый и перезапущенный, не может быть доступны пользователям во время обновления. Пользователи будут подключаться к другим экземплярам развертывания до тех пор, пока все виртуальные машины и все службы Skype для бизнеса не начнут работать на виртуальных машинах после завершения обновлений. Чтобы избежать потенциальных сбоев в работе службы, вы можете удалить экземпляр из HA во время применения обновлений, а затем восстановить его по завершению. Для этого:
    
1. На каждом сервере хост-сервера откройте консоль PowerShell в качестве администратора.
    
2. Удалите экземпляр из HA с помощью следующего cmdlet:
    
   ```powershell
   Enter-CcUpdate
   ```

3. 
    
    Выполните действия для одного экземпляра, чтобы вручную применить обновления и перезапустить виртуальную машину.
    
4. Установите экземпляр обратно в HA с помощью следующего cmdlet:
    
   ```powershell
   Exit-CcUpdate
   ```

Для развертывания нескольких сайтов выполните действия по одному сайту для каждого сайта в развертывании, применяя обновления к одному сайту одновременно.
  
## <a name="tips-when-installing-anti-virus-software-on-the-cloud-connector-host-machine"></a>Советы при установке антивирусного программного обеспечения на хост-машину облачного соединителя

Если необходимо установить антивирусное программное обеспечение на компьютере-хост-платформе Cloud Connector, необходимо добавить следующие исключения:
  
- Локальный каталог приборов на каждой машине.
    
- Каталог удаленного сайта на каждой машине.
    
- В локальном каталоге сайтов на компьютере размещена общая корневая папка сайта.
    
- %ProgramFiles%\Skype для бизнеса Cloud Connector Edition
    
- %ALLUSERSPROFILE%\CloudConnector
    
- %ProgramFiles%\WindowsPowerShell\Modules\CloudConnector
    
- Процесс Microsoft.Rtc.CCE.ManagementService.exe.