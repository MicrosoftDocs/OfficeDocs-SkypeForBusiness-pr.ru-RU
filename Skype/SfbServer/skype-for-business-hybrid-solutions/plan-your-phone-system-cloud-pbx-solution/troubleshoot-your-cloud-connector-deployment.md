---
title: Устранение неполадок с развертыванием Cloud Connector
ms.reviewer: ''
ms.author: crowe
author: CarolynRowe
manager: serdars
ms.date: 12/5/2017
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection:
- Strat_SB_Hybrid
ms.custom: ''
ms.assetid: e6cf58cc-dbd9-4f35-a51a-3e2fea71b5a5
description: Устранение неполадок развертывания Cloud Connector Edition.
ms.openlocfilehash: 7a1caea67c5b5899c2dc0909ef771a57c7c50389
ms.sourcegitcommit: b424ab14683ab5080ebfd085adff7c0dbe1be84c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/03/2020
ms.locfileid: "47359335"
---
# <a name="troubleshoot-your-cloud-connector-deployment"></a>Устранение неполадок с развертыванием Cloud Connector

> [!Important]
> Cloud Connector Edition выйдет 31 июля 2021 вместе со Skype для бизнеса Online. После обновления вашей организации до Teams Узнайте, как подключить локальную телефонную сеть к Teams с помощью [прямой маршрутизации](https://docs.microsoft.com/MicrosoftTeams/direct-routing-landing-page).
 
Устранение неполадок развертывания Cloud Connector Edition.
  
В этом разделе описываются решения распространенных проблем, связанных с развертываниями Cloud Connector Edition. Если у вас возникли проблемы с вызовами и из телефонной сети общего пользования (PSTN), вы можете изучить следующие решения, описанные в этом разделе.
  
Cloud Connector предоставляет встроенные механизмы для автоматического устранения некоторых проблем. Процесс автоматического обнаружения выполняет поиск потенциальных проблем для устройств Cloud Connector и, если это возможно, предпринимает корректирующие меры по устранению этих проблем без необходимости вмешательства администратора. Процесс обнаружения работает следующим образом:
  
- **Последовательность обнаружения:** Служба управления Cloud Connector запускает процесс каждые 60 секунд, чтобы определить, не отключено ли устройство. В Cloud Connector версии 2,0 и более поздних в процессе обнаружения используется переключатель в корпоративной сети Skype для бизнеса для создания подключений PowerShell к машинам Cloud Connector; для версий, предшествующих 2,0, процесс обнаружения использует коммутатор управления Cloud Connector.
    
    > [!NOTE]
    > Для успешного выполнения автоматического восстановления между узлом и виртуальными машинами должно быть установлено сетевое подключение через коммутатор узла сети. Обязательно проверьте сетевое подключение, чтобы убедиться, что автоматическое обнаружение и восстановление может быть успешным. 
  
- **Мониторинг:** Следующие службы отслеживаются в Cloud Connector версии 2,0 и более поздних:
    
  - Виртуальные машины не подключены к виртуальным коммутаторам Cloud Connector или Интернет
    
  - Виртуальные машины находятся в состоянии "сохранено" или "остановлено"
    
  - Службы сервера централизованного управления: РЕПЛИКа, основной
    
  - Службы сервера-посредника: РЕПЛИКа, RTCSRV и МЕДСВК
    
  - Службы пограничных серверов: РЕПЛИКа, RTCSRV, РТКДАТАПРОКСИ, РТКМРАУС, РТКМЕДИАРЕЛАЙ
    
  - Правила брандмауэра для входящих подключений отключены для CS RTCSRV на пограничном сервере, CS РТКМЕДСРВ на сервере-посреднике
    
    В Cloud Connector версии 1.4.2 отслеживаются только следующие службы:
    
  - Службы сервера-посредника: RTCSRV и МЕДСВК
    
  - Служба пограничного сервера: RTCSRV
    
- **Процесс восстановления:** Если какие-либо отслеживаемые службы отключены, устройство помечается как отключенное, а службы останавливаются и помечаются вручную до тех пор, пока не будут устранены все проблемы. Это предотвратит маршрутизацию звонков на устройство, которое может привести к сбоям вызовов.
    
    Служба управления Cloud Connector повторит попытку автоматического восстановления, как показано ниже.
    
  - Первый интервал повтора составляет каждые десять секунд с максимальным интервалом в один час.
    
  - Для первых трех попыток восстановления время ожидания составляет 10 секунд. Начиная с четвертой попытки, время в интервале увеличивается на два раза больше предыдущего интервала времени. Например, четвертая повторная попытка будет выполнена в течение 20 секунд, пятый в 40 секунд и т. д. 
    
  - При достижении максимального интервала в один час количество повторных попыток будет продолжаться в час.
    
  - При успешном завершении восстановления в качестве интервала и числа повторных попыток задаются исходные значения.
    
  - Если служба управления перезапущена, счетчики интервалов и повторных попыток сбрасываются в исходные значения.
    
## <a name="troubleshooting"></a>Устранение неполадок

Ниже приведены решения часто встречающихся проблем.
  
- **Ошибка: при выполнении сценариев развертывания развертывание завершается с ошибкой или перестает отвечать. После входа на каждую виртуальную машину IP-адрес отсутствует или неверен для управления/внутреннего или внешнего сетевого адаптера.**
    
    **Решение:** Эту проблему невозможно устранить автоматически. Сетевые адаптеры Невозможно добавить к виртуальным машинам во время их выполнения. Завершите работу виртуальных машин и удалите их в диспетчере Hyper – v, а затем выполните следующие командлеты:
    
  ```powershell
  Uninstall-CcAppliance
  ```

  ```powershell
  Install-CcAppliance
  ```

- 
    
    **Вопрос: после установки сервера и/или сервера-посредника Active Directory сервер CMS и/или сервер-посредник не присоединяются к домену должным образом.**
    
    **Решение:** Чтобы устранить эту проблему, выполните указанные ниже действия.
    
  - Выполните вход на сервер Active Directory и убедитесь, что домен создан правильно.
    
  - Выполните вход на сервер CMS/-посредника и убедитесь, что в корпоративной NIC назначен допустимый IP-адрес, а действительный статический IP-адрес и DNS настроены как IP-адрес сервера AD.
    
  - Выполните вход на сервер CMS/-посредника и откройте командную строку. Убедитесь, что вы можете выполнить команду ping для полного доменного имени и IP-адреса сервера Active Directory. Если этого не сделать, может возникнуть конфликт IP-адресов. Попробуйте назначить новый IP-адрес для Active Directory и соответствующим образом обновить DNS на сервере CMS/-посреднике.
    
- **Причина: вы получите следующее сообщение об ошибке: "Remove – VMSwitch: сбой при удалении виртуального коммутатора Ethernet". Невозможно удалить виртуальный коммутатор с переключателем управления Cloud Connector, так как он используется работающими виртуальными машинами или назначен дочерним пулам. "**
    
    **Решение:** "Коммутатор управления Cloud Connector" не был удален после развертывания. Если вы столкнулись с этой ошибкой, перейдите в Диспетчер Hyper-v и убедитесь, что к ней еще не подключена виртуальная машина. Если виртуальные машины по-прежнему подключены, отключите их и удалите переключатель управления. Если параметр управления по-прежнему не может быть удален, перезапустите хост-сервер и повторите попытку.
    
- **Причина: появится следующее сообщение об ошибке: "сбой при запуске службы РТКМРАУС. Убедитесь, что служба не отключена. "**
    
    > [!NOTE]
    > Эта проблема относится только к версиям Cloud Connector, предшествующим 1.4.2. 
  
    Сбой при запуске может также быть вызван тем, что сервер переднего плана был ранее отработкой отказа (с использованием компьютера при сбое). Если это так, выйдите из строя и снова выйдите из системы.
    
    **Решение:** Эта проблема возникает на пограничном сервере, если сертификат корневого центра сертификации или сертификат промежуточного центра сертификации не является доверенным для пограничного сервера. Даже если внешний сертификат можно импортировать, но цепочка сертификатов разорвана. В этом случае служба РТКМРАУС и/или RTCSRV не может запуститься.
    
    Импортируйте сертификат корневого центра сертификации и все промежуточные сертификаты ЦС внешнего сертификата вручную в пограничный сервер, а затем перезапустите пограничный сервер. После того как вы увидите службы РТКМРАУС и RTCSRV, запущенные на пограничном сервере, вернитесь на сервер узла, запустите консоль PowerShell от имени администратора и выполните следующий командлет, чтобы переключиться на новое развертывание:
    
  ```powershell
  Switch-CcVersion
  ```

- 
    
    **Ошибка: сервер узла был перезапущен при применении обновлений Windows, а вызовы, обслуживаемые сервером, отправляются с ошибкой.**
    
    **Решение:** Если вы развернули среду с высокой доступностью, корпорация Майкрософт предоставляет командлет, позволяющий перемещать один хост-компьютер (экземпляр развертывания) в текущую топологию и из нее при проверке и установке центра обновления Windows вручную. Чтобы выполнить эту задачу, выполните указанные ниже действия.
    
1. На сервере узла запустите консоль PowerShell от имени администратора, а затем выполните команду:
    
   ```powershell
   Enter-CcUpdate
   ```

2. Проверьте наличие обновлений и установите доступные.
    
3. В консоли PowerShell выполните следующий командлет:
    
   ```powershell
   Exit-CcUpdate
   ```

- 
    
    **Вопрос: при совершении вызова из клиента Skype для бизнеса с помощью номера PSTN этот звонок нельзя эскалировать на конференцию, приглашая еще один номер PSTN.**
    
    **Решение:** Чтобы устранить эту проблему, ознакомьтесь со статьей [Настройка параметров сервера гибридного гибридного сервера-посредника](configure-cloud-connector-integration-with-your-office-365-tenant.md#BKMK_ConfigureMediationServer).
    
- **Вопрос: при установке сервера Active Directory ("автоматическое обновление Windows") отображается предупреждающее сообщение об обновлении Windows: "автоматическое обновление Windows не включено". Чтобы убедиться, что недавно установленная роль или функция автоматически обновляется, включите обновление Windows. "**
    
    **Решение:** Запустите удаленный сеанс PowerShell клиента с помощью учетных данных администратора клиента Skype для бизнеса, а затем выполните следующий командлет, чтобы проверить конфигурацию _EnableAutoUpdate_ для сайта:
    
  ```powershell
  Get-CsHybridPSTNSite
  ```

    Если для  _EnableAutoUpdate_ задано **значение true**, можно спокойно проигнорировать это предупреждение, так как служба кцеманажемент будет обрабатывать загрузку и установку обновлений Windows для виртуальных машин и хост-сервера. Если для  _EnableAutoUpdate_ задано значение **false**, выполните следующий командлет, чтобы задать для него значение **true**.
    
  ```powershell
  Set-CsHybridPSTNSite -EnableAutoUpdate $true
  ```

    Кроме того, вы можете вручную проверить наличие обновлений и установить их. (см. следующий раздел).
    
- **Вопрос: вы получаете сообщение об ошибке: "не удается зарегистрировать устройство", так как текущие входные данные (или или или или или \<SiteName\> \<ApplianceName\> \<Mediation Server FQDN\> \<Mediation Server IP Address\> ) конфликтуют с существующими устройствам. Удалите конфликтующее устройство или обновите сведения о входных и конфигурационных данных, а затем повторите регистрацию. ' при выполнении Register-CcAppliance для регистрации текущего устройства в оперативный режим.**
    
    **Решение:** Значения параметра \<ApplianceName\> \<Mediation Server FQDN\> и \<Mediation Server IP Address\> должны быть уникальными и использоваться только для регистрации одного устройства. По умолчанию \<ApplianceName\> берется из имени узла. \<Mediation Server FQDN\> и \<Mediation Server IP Address\> определен в ini-файле конфигурации.
    
    Например, при использовании (выступает имя устройства = Мисервернев, имя сервера-посредника FQDN = MS. contoso. com, IP-адрес сервера-посредника = 10.10.10.10) для регистрации на сайте SiteName = личного сайта, но при наличии зарегистрированного устройства (выступает имя устройства = MyServer, имя сервера-посредника = $. contoso. com, IP-адрес сервера-посредника — 10.10.10.10) возникает конфликт.
    
    Для начала проверьте файл CloudConnector.ini в разделе Апплианцерут Directory. \<SiteName\>В файле будут получены \<Mediation Server FQDN\> и \<Mediation Server IP Address\> значения. \<ApplianceName\> — Это имя сервера узла.
    
    Во-вторых, запустите удаленную консоль PowerShell клиента, используя учетные данные администратора клиента Skype для бизнеса, а затем выполните следующий командлет, чтобы проверить зарегистрированные устройства.
    
  ```powershell
  Get-CsHybridPSTNAppliance
  ```

    Определив конфликты, можно либо обновить файл CloudConnector.ini, указав сведения, соответствующие зарегистрированному устройству, либо отменить регистрацию существующего устройства для разрешения конфликтов.
    
  ```powershell
  Unregister-CsHybridPSTNAppliance -Force
  ```

    
- **Ошибка: командлет Get-CcRunningVersion возвращает пустое значение, если на узле выполняется развернутое устройство.**
    
  **Решение:** Это может происходить при обновлении с 1.3.4 или 1.3.8 до 1.4.1. После установки версии 1.4.1 с помощью MSI необходимо выполнить `Register-CcAppliance` перед запуском любого другого командлета. `Register-CcAppliance` будет переносить файл module.ini из%Усерпрофиле%\клаудконнектор в%Програмдата%\клаудконнектор. Если вы пропустили его, в папке%Програмдата%\клаудконнектор будет создан новый module.ini и заменяются сведения о версии, используемой для 1.3.4 или 1.3.8.
    
  Сравните module.ini файлы в папке%Усерпрофиле%\клаудконнектор и%Програмдата%\клаудконнектор. При наличии различий удалите файл module.ini в%Програмдата%\клаудконнектор и повторите операцию  `Register-CcAppliance` . Вы также можете изменить файл вручную, дополнив его на правильную версию и резервную копию.
    
- **Проблема: после выполнения командлета Switch-CcVersion для переключения на старую версию, которая отличается от текущей версии сценария, для этой старой версии нет поддержки высокого уровня доступности.**
    
    **Решение:** Например, вы выполнили обновление с 1.4.1 на 1.4.2. Текущая версия скрипта, которая может быть определена при запуске `Get-CcVersion` , и используемая версия, которую можно определить с помощью команды  `Get-CcRunningVersion` 1.4.2. В настоящее время, если вы перейдете на `Switch-CcVersion` 1.4.1, то для этой старой версии будет отсутствовать поддержка высокого уровня доступности.
    
    Чтобы получить поддержку высокого уровня доступности, переключитесь обратно в 1.4.2, поэтому действующая версия и версия сценария совпадают. Если у вас возникли проблемы с развертыванием 1.4.2, удалите и переустановите его как можно скорее.
    
- **Причина: сертификаты центра сертификации или внутренние сертификаты, выданные центральному хранилищу управления, серверу-посреднику и пограничному серверу, истекает из истечения срока действия или скомпрометированы.**
    
    **Решение:** Сертификаты центра сертификации Skype для бизнеса действительны в течение пяти лет. Внутренние сертификаты, выданные для центрального хранилища управления, сервера-посредника и пограничного сервера, действительны в течение двух лет.
    
    > [!NOTE]
    > В Cloud Connector версии 2,0 и более поздних командлеты Update – CcServerCertificate изменились на Update — CcServerCertificate, а командлет продления — CcCACertificate изменился на Update CcCACertificate. 
  
    Если срок действия внутренних сертификатов, выданных серверу центрального хранилища управления, серверу-посреднику и пограничному серверу, приближается к истечению срока действия или скомпрометирован, выполните командлет Update-CcServerCertificate или Update-CcServerCertificate для продления сертификатов.
    
    Если срок действия сертификатов центра сертификации истек, выполните командлет Update – CcCACertificate или Update – CcCACertificate, чтобы обновить сертификаты.
    
    **Если сертификаты центра сертификации скомпрометированы и на сайте имеется только одно устройство,** выполните следующие действия:
    
1. Выполните командлет Enter – CcUpdate, чтобы очистить службы и перевести устройство в режим обслуживания.
   
   ```powershell
   Enter-CcUpdate
   ```
   
2. Выполните следующие командлеты, чтобы сбросить и создать новые сертификаты центра сертификации и все внутренние сертификаты серверов:
    
    Для выпусков Cloud Connector до 2,0:
    
    ```powershell
    Reset-CcCACertificate 
    Renew-CcServerCertificate 
    Remove-CcLegacyServerCertificate 
    ```

    В случае выпуска Cloud Connector 2,0 и более поздних версий:
    
    ```powershell
    Reset-CcCACertificate 
    Update-CcServerCertificate 
    Remove-CcLegacyServerCertificate 
    ```
    
3. Если между шлюзом и сервером-посредником используется протокол TLS, выполните командлет Export-CcRootCertificate на устройстве, а затем установите экспортированный сертификат на шлюзы PSTN. Кроме того, может потребоваться повторная выдача сертификата на шлюзе.

   ```powershell
   Export-CcRootCertificate
   ```

4. Выполните командлет Exit – CcUpdate, чтобы запустить службы и выйти из режима обслуживания.

   ```powershell
   Exit-CcUpdate
   ```


    **Если сертификаты центра сертификации скомпрометированы и на сайте имеется несколько устройств,** выполните следующие действия на каждом устройстве на сайте.
    
    Корпорация Майкрософт рекомендует выполнять эти действия в непиковое время использования.
    
1. На первом устройстве запустите командлет Remove – CcCertificationAuthorityFile, чтобы очистить файлы резервных копий ЦС в \<SiteRoot\> каталоге.

     ```powershell
     Remove-CcCertificationAuthorityFile
     ```
    
2. Выполните командлет Enter – CcUpdate, чтобы сток служб и перевести каждое устройство в режим обслуживания.

     ```powershell
     Enter-CcUpdate
     ```
    
3. На первом устройстве выполните следующие командлеты, чтобы сбросить и создать новые сертификаты центра сертификации и все внутренние сертификаты серверов:
    
     Для выпусков Cloud Connector до 2,0:
    
     ```powershell
     Reset-CcCACertificate
     Renew-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```

     В случае выпуска Cloud Connector 2,0 и более поздних версий:
    
     ```powershell
     Reset-CcCACertificate
     Update-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```

4. На первом устройстве выполните следующий командлет, чтобы создать резервную копию файлов ЦС в \<SiteRoot\> папке.
    
     ```powershell
     Backup-CcCertificationAuthority
     ```
   
5. На любом другом устройстве на том же сайте выполните следующие команды для использования файлов резервных копий ЦС, чтобы все устройства использовали один корневой сертификат, а затем запрашивают новые сертификаты. 
   
     ```powershell
     Reset-CcCACertificate
     Update-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```
     
6. Если между шлюзом и сервером-посредником используется протокол TLS, выполните командлет Export-CcRootCertificate на любом устройстве на сайте, а затем установите экспортированный сертификат на шлюзы PSTN. Кроме того, может потребоваться повторная выдача сертификата на шлюзе.
  
     ```powershell
     Export-CcRootCertificate
     ```
     
7. Выполните командлет Exit – CcUpdate, чтобы запустить службы и выйти из режима обслуживания. 

     ```powershell
     Exit-CcUpdate
     ```
    
    
- **Причина: в журнале службы управления Cloud Connector отображается следующее сообщение об ошибке: "C:\Program Files\Skype for Business Cloud Connector Едитион\манажементсервице\кцеманажементсервице.лог": CceService Error: 0: непредвиденное исключение при отправке отчета о состоянии в Online: System. Management. Automation. Кмдлетинвокатионексцептион: не удалось войти в систему пользователя \<Global Tenant Admin\> . Создайте новый объект учетных данных, убедившись, что вы использовали правильные имя пользователя и пароль. ---\>**
    
    **Решение:** Учетные данные глобального администратора клиента Microsoft 365 или Office 365 были изменены с момента регистрации устройства Cloud Connector. Чтобы обновить локально хранимые учетные данные на устройстве Cloud Connector, выполните следующую команду в консоли PowerShell с правами администратора на хостном устройстве:
    
  ```powershell
  Set-CcCredential -AccountType TenantAdmin
  ```

- **Вопрос: после изменения пароля для учетной записи сервера узла, используемой для развертывания, отображается следующее сообщение об ошибке: "ConvertTo-SecureString: ключ не является допустимым для использования в указанном состоянии". "в%ProgramFiles%\Skype для Business Cloud Connector Едитион\манажементсервице\кцеманажементсервице.лог или при запуске командлета Get-CcCredential.**
    
    **Решение:** Все учетные данные Cloud Connector хранятся в следующем файле: "%SystemDrive%\Programdata\Cloudconnector\credentials. \<CurrentUser\> . XML ". При изменении пароля на сервере узла необходимо обновить локально хранимые учетные данные.
    
    **Если вы используете Cloud Connector версии 1.4.2,** повторно создайте все пароли Cloud Connector, выполнив следующие действия:
    
  1. Перезапустите сервер узла.
    
  2. Удалите следующий файл: "%SystemDrive%\Programdata\Cloudconnector\credentials. \<CurrentUser\> . XML ".
    
  3. Запустите консоль PowerShell от имени администратора, а затем выполните команду "Register – CcAppliance — Local", чтобы повторно ввести пароли, указанные в описании. Введите те же пароли, которые были введены ранее для развертывания Cloud Connector.
    
     **Если вы используете Cloud Connector версии 2,0 или более поздней,** повторно создайте все пароли Cloud Connector, выполнив следующие действия:
    
  4. Перезапустите сервер узла.
    
  5. Удалите следующий файл: "%SystemDrive%\Programdata\Cloudconnector\credentials. \<CurrentUser\> . XML ".
    
  6. Запустите консоль PowerShell от имени администратора, а затем выполните команду "Register – CcAppliance — Local", чтобы повторно ввести пароли, указанные в описании. 
    
     Если файл кэшированного пароля был создан с помощью 1.4.2 Cloud Connector версии, при появлении соответствующего запроса используйте пароль VMAdmin для пароля CceService. Введите тот же пароль, который вы ввели перед развертыванием Cloud Connector для всех остальных учетных записей.
    
     Если файл кэшированного пароля был создан с помощью Cloud Connector версии 1.4.2, а пароли DomainAdmin и VMAdmin отличаются, необходимо выполнить следующие действия:
    
  7. Выполните командлет Set – CcCredential – AccountType DomainAdmin, как показано ниже.
    
  8. При запросе учетных данных старой учетной записи введите учетные данные, которые использовались для пароля CceService.
    
  9. При запросе учетных данных новой учетной записи введите пароль для пароля DomainAdmin, который вы использовали ранее.
    
     Если файл кэшированного пароля был создан с помощью Cloud Connector версии 2,0 или более поздней версии, по умолчанию VmAdmin и DomainAdmin используют тот же пароль, что и в CceService. Если вы изменили пароли DomainAdmin и VMAdmin, необходимо выполнить следующие действия:
    
  10. Выполните командлет Set – CcCredential – AccountType DomainAdmin, как показано ниже.
    
       1. При запросе учетных данных старой учетной записи введите учетные данные, которые использовались для пароля CceService
    
       2. При запросе учетных данных новой учетной записи введите пароль для пароля DomainAdmin, который вы использовали ранее.
    
  11. Выполните командлет Set – CcCredential – AccountType VmAdmin, как показано ниже.
    
       1. При запросе учетных данных старой учетной записи введите учетные данные, которые использовались для пароля CceService
    
       2. При запросе учетных данных новой учетной записи введите пароль для пароля VmAdmin, который вы использовали ранее. 
    
- **Проблема: с помощью Cloud Connector версии 2,1 и более поздних версий при запуске командлета Register – CcAppliance или других командлетов на устройстве отображается сообщение об ошибке: "для каждого объекта: не удается найти свойство ' Common ' для этого объекта. Убедитесь, что свойство существует. В папке C:\Program Files\WindowsPowerShell\Modules\CloudConnector\Internal\MtHostCommon.ps1:681 char: 14 "**
    
    **Решение:** Для Cloud Connector 2,1 и более поздних версий требуется платформа .NET Framework 4.6.1 или более поздняя версия. Обновите .NET Framework на устройстве с помощью 4.6.1 или более поздней версии, а затем снова запустите командлеты.

- **Вопрос: с помощью Cloud Connector Edition 2,1 при запуске Install-CcAppliance появляется следующее сообщение об ошибке: "не удалось установить новый экземпляр, ошибка: невозможно задать" состояние ", так как только строки можно использовать в качестве значений для задания свойств XmlNode"**

   **Решение:** В разделе [Common] (Cloudconnector.ini) в разделе [Common] добавьте конфигурацию "State", как указано ниже: CountryCode = US штат = WA City = Redmond

   Строка State не является обязательной для значения, но строка "State" не может быть удалена из файла Cloudconnector.ini.

- **Ошибка: получено следующее сообщение об ошибке: "Dismount — Виндовсимаже: Dismount – Виндовсимаже Failed. Код ошибки = 0xc1550115 "при установке или обновлении Cloud Connector Edition.**
    
    **Решение:** Запустите консоль PowerShell от имени администратора, запустите "DISM-Cleanup-WIM". При этом будут очищены все невыполненные изображения. Повторно запустите командлет Install – CcAppliance или дождитесь автоматического обновления BITS.
    
- **Ошибка: не удается развернуть первое устройство Cloud Connector в среде высокой доступности**
    
    **Решение:** Действия, которые необходимо выполнить, зависят от причины сбоя развертывания:
    
  - Если первое устройство Cloud Connector завершается с ошибкой и вы не можете определить причину сбоя, необходимо установить устройство еще раз до успешного развертывания, а затем установить другие устройства.
    
  - Если первое устройство Cloud Connector потерпит незначительную проблему, например проблему с внешним сертификатом, вы можете устранить проблему без повторной установки устройства. Затем вы можете использовать удаленную оболочку PowerShell клиента, чтобы пометить развертывание как успешное, как показано ниже. (Вы также можете выполнить следующие действия, если первое развертывание прошло успешно, но по какой-либо причине облачному соединителю не удалось сообщить о развертывании как успешное.)
    
  - Чтобы получить идентификатор (GUID) первого устройства Cloud Connector, выполните командлет Get-Кшибридпстнапплианце.
    
  - Чтобы пометить устройство как успешно развернутое, выполните командлет Set – Кскцеапплианцедеплойментстатус следующим образом:
    
  ```powershell
  Set-CsCceApplianceDeploymentStatus -Identity <Appliance Identity GUID> -Action Deploy -Status Finished
  ```

- **Вопрос: необходимо проверить наличие и установить обновления Windows вручную на сервере узла или виртуальных машинах.**
    
   **Решение:** Мы рекомендуем использовать преимущества автоматических обновлений ОС, предоставляемых Skype для бизнеса Cloud Connector Edition. После регистрации устройства для управления через Интернет и включения автоматического обновления ОС сервер узла и виртуальные машины будут автоматически проверять и устанавливать обновления Windows в соответствии с параметрами окна "обновление операционной системы".
    
   Если вам нужно проверить и установить обновления Windows вручную, выполните действия, описанные в этом разделе, которые относятся к типу развертывания. Необходимо запланировать обновление как сервера узла, так и виртуальных машин, работающих на нем, чтобы минимизировать время, необходимое для обновления.
    
   При желании вы можете использовать сервер служб Windows Server Update Services (WSUS) для предоставления обновлений для серверов Cloud Connector. Необходимо убедиться, что обновление Windows **не** устанавливается автоматически.
    
   Сведения о том, как вручную обновить развертывание Cloud Connector, можно найти в следующем разделе.
    
- **Вопрос: при обновлении Cloud Connector до новой сборки командлеты Cloud Connector не обновляются.** Это может произойти, если окно PowerShell остается открытым при выполнении автоматического обновления.
    
  **Решение:** Для загрузки обновленных командлетов можно выполнить одно из следующих действий:
    
   - Закройте PowerShell на устройстве Cloud Connector, а затем снова откройте PowerShell.
    
     - Можно также выполнить командлет Import – Module CloudConnector — Force. 
 
-   **Ошибка: "термин Stop-CsWindowsService" не распознается как имя командлета, функции, файла скрипта или программной программы. "ошибка при попытке выполнить командлет Enter-CcUpdate.**

    **Решение:** Удалите файл $HOME \Аппдата\локал\микрософт\виндовс\повершелл\модулеаналисискаче.
PowerShell создает этот файл в виде кэша командлетов из найденных модулей, чтобы не пришлось повторно анализировать все модули каждый раз, так как это приведет к значительному снижению производительности. Скорее всего, было вызвано повреждение файлов, предоставилее недостоверные результаты в PowerShell при чтении из кэша.

-   **Ошибка: "Import-Module CloudConnector" генерирует ошибку "Import-Module: указанный модуль" CloudConnector "не был загружен, так как в каком-либо из каталогов модулей не был найден допустимый файл модуля"**

    **Решение.**
    - Проверка того, что в папке c:\Program Филес\виндовсповершелл\модулес существует модуль CloudConnector
    
    - После проверки того, что модуль CloudConnector существует в этом расположении, переменная среды PSModulePath, в которой хранится путь к расположениям модулей, может быть изменена:
    
     а) Временное изменение: запустите PowerShell от имени администратора и выполните следующую команду: $env:P Смодулепас = $env:P Смодулепас + "; C:\Program Филес\виндовсповершелл\модулес\"
        
     б) Для сохранения изменений запустите PowerShell от имени администратора и выполните следующие команды, по одному: $CurrentValue = [Environment]:: Жетенвиронментвариабле ("PSModulePath", "Machine") Сетенвиронментвариабле ("PSModulePath", "Machine") ("", $CurrentValue + "; C:\Program Филес\виндовсповершелл\модулес "," Machine ")

    
## <a name="install-windows-updates-manually"></a>Установка обновлений Windows вручную

Если вы не хотите использовать автоматические обновления в своей среде, выполните следующие действия, чтобы вручную проверить и применить обновления Windows. Для проверки и установки обновлений Windows может потребоваться перезагрузка сервера. При перезапуске сервера узла пользователи не смогут использовать Cloud Connector для размещения или приема звонков. Вы можете вручную проверять наличие обновлений и устанавливать их, чтобы контролировать, когда они происходят, а затем перезапускать компьютеры при необходимости, чтобы избежать перерывов в работе служб.
  
Чтобы проверить наличие обновлений вручную, подключитесь к каждому серверу узла и откройте **Панель управления**. Выберите **система и безопасность \> Windows Update**, а затем — Управление обновлениями и перезапусками сервера в соответствии с вашей средой.
  
- Если на сайте только одно устройство, подключитесь к каждой виртуальной машине и откройте **Панель управления**. Выберите **система и безопасность \> Windows Update**, а затем настройте обновления и перезапускать сервер соответствующим образом.
    
- Если на сайте несколько устройств, то во время обновлений пользователи не смогут получить доступ к обновляемому и перезапускаемому экземпляру. Пользователи будут подключаться к другим экземплярам в развертывании до тех пор, пока все виртуальные машины и все службы Skype для бизнеса не будут запущены на виртуальных машинах после завершения обновления. Чтобы избежать возможного перерыва в обслуживании, можно удалить экземпляр из HA при применении обновлений, а затем восстановить его по завершении. Для этого:
    
1. На каждом сервере узла откройте консоль PowerShell от имени администратора.
    
2. Удалите экземпляр из HA с помощью следующего командлета:
    
   ```powershell
   Enter-CcUpdate
   ```

3. 
    
    Выполните действия для одного экземпляра, чтобы вручную применить обновления и перезапустить виртуальную машину.
    
4. Установите для экземпляра значение HA с помощью следующего командлета:
    
   ```powershell
   Exit-CcUpdate
   ```

Для развертываний с несколькими сайтами выполните действия для отдельного сайта для каждого сайта в развертывании, применяя обновления к одному сайту за раз.
  
## <a name="tips-when-installing-anti-virus-software-on-the-cloud-connector-host-machine"></a>Советы по установке антивирусного программного обеспечения на хостном компьютере Cloud Connector

Если необходимо установить антивирусную программу на хост машины Cloud Connector, необходимо добавить следующие исключения:
  
- Локальный каталог устройств на каждом компьютере.
    
- Каталог удаленных сайтов на каждом компьютере.
    
- Каталог локального сайта на компьютере содержит корневую папку общего сайта.
    
- %ProgramFiles%\Skype для бизнеса Cloud Connector Edition
    
- %аллусерспрофиле%\клаудконнектор
    
- %програмфилес%\виндовсповершелл\модулес\клаудконнектор
    
- Microsoft.Rtc.CCE.ManagementService.exe процесса.
