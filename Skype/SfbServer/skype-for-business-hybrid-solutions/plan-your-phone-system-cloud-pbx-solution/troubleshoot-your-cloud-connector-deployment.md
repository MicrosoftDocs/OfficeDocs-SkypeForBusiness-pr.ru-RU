---
title: Устранение неполадок с развертыванием Cloud Connector
ms.reviewer: ''
ms.author: crowe
author: CarolynRowe
manager: serdars
ms.date: 12/5/2017
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection:
- Strat_SB_Hybrid
ms.custom: ''
ms.assetid: e6cf58cc-dbd9-4f35-a51a-3e2fea71b5a5
description: Устранение неполадок при развертывании облачного соединителя.
ms.openlocfilehash: 3a6fd80cc0c4125303021746cdb626d8c5b49a5a
ms.sourcegitcommit: e64c50818cac37f3d6f0f96d0d4ff0f4bba24aef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2020
ms.locfileid: "41814227"
---
# <a name="troubleshoot-your-cloud-connector-deployment"></a>Устранение неполадок с развертыванием Cloud Connector
 
Устранение неполадок при развертывании облачного соединителя.
  
В этом разделе описываются решения распространенных проблем, связанных с развертываниями Cloud Connector Edition. Если вы сталкиваетесь с проблемами при выполнении и приеме звонков через телефонную сеть общедоступного пользования (ТСОП), ознакомьтесь с возможными решениями, которые приводятся в этом разделе.
  
Облачный соединитель предоставляет встроенные механизмы для автоматического устранения некоторых проблем. Процесс автоматического обнаружения выявляет возможные проблемы с управляющими устройствами облачного соединителя, и, если это возможно, предпринимает меры для устранения этих проблем без необходимости вмешательства администратора. Процесс обнаружения выполняется следующим образом.
  
- **Последовательность обнаружения:** Служба управления облачным соединителем запускает процесс каждые 60 секунд, чтобы определить, не работает ли устройство. В облаке соединителя версии 2,0 и более поздних процесс обнаружения использует коммутатор в корпоративной сети Skype для бизнеса для создания подключений PowerShell к облачным соединительным машинам; для версий, предшествующих 2,0, процесс обнаружения использует ключ управления облачным соединителем.
    
    > [!NOTE]
    > Чтобы автоматическое восстановление прошло успешно, между узлом и виртуальными машинами должно быть доступно сетевое подключение на коммутаторе сети узла. Убедитесь в том, что проверка подключения к сети выполнена, чтобы убедиться, что автоматическое обнаружение и восстановление может выполняться успешно. 
  
- **Наблюдение за:** Следующие службы отслеживаются в облаке соединителя версии 2,0 и более поздних:
    
  - Виртуальные машины не подключены к облачному соединителю для корпоративных и виртуальных коммутаторов Интернета
    
  - Виртуальные машины находятся в состоянии "сохранено" или "остановлено"
    
  - Службы сервера централизованного управления: РЕПЛИКа, образец
    
  - Сервер служб исправлений: РЕПЛИКа, РТКСРВ и МЕДСВК
    
  - Службы пограничного сервера: РЕПЛИКа, РТКСРВ, РТКДАТАПРОКСИ, РТКМРАУС, РТКМЕДИАРЕЛАЙ
    
  - Правила брандмауэра для входящего трафика отключены для CS РТКСРВ на пограничном сервере, CS РТКМЕДСРВ на сервере обновлений
    
    В облачном соединителе версии 1.4.2 отслеживается только следующие службы:
    
  - Сервер служб исправлений: РТКСРВ и МЕДСВК
    
  - Служба пограничного сервера: РТКСРВ
    
- **Процесс восстановления:** Если какие – либо отслеживаемые службы отключены, устройство помечается как отключенное и помечается вручную, пока не будут устранены все возможные проблемы. Это предотвратит маршрутизацию звонков на устройство, которое может вызвать сбои при вызове.
    
    Служба управления облачным соединителем повторит попытку автоматического восстановления, как описано ниже.
    
  - Первоначальный интервал повтора составляет каждые десять секунд с максимальным временем в один час.
    
  - Для первых трех попыток восстановления интервал времени равен 10 секундам. Начиная с четвертого повтора, время интервала увеличивается на два раза подряд, чем предыдущий интервал. Например, четвертая попытка будет возникать в течение 20 секунд, пятого в 40 секунд и т. д. 
    
  - При достижении максимального интервала в один час повторные попытки будут продолжаться в течение часа.
    
  - Если восстановление прошло успешно, для интервала и счетчика повторов устанавливаются исходные значения.
    
  - Если служба управления перезапустится, значения интервала и повтора будут сброшены на начальные.
    
## <a name="troubleshooting"></a>Поиск и устранение неполадок

Ниже приведены решения часто встречающихся проблем.
  
- **Проблема. При выполнении сценариев развертывания происходит сбой или остановка развертывания. После выполнения входа на каждую виртуальную машину IP-адрес отсутствует или неверен для внешнего, внутреннего сетевого адаптера или сетевого адаптера управления.**
    
    **Решение:** Эту проблему невозможно устранить автоматически. Сетевые адаптеры нельзя добавить на работающие виртуальные машины. Завершите работу виртуальных машин и удалите их с помощью диспетчера Hyper-V, а затем выполните следующие командлеты:
    
  ```powershell
  Uninstall-CcAppliance
  ```

  ```powershell
  Install-CcAppliance
  ```

- 
    
    **Проблема. После установки сервера Active Directory Server и леса сервер CMS и (или) сервер-посредник некорректно присоединяются к домену.**
    
    **Решение**. Чтобы устранить эту проблему, выполните следующие действия.
    
  - Войдите на сервер Active Directory и убедитесь, что домен создан правильно.
    
  - Войдите на сервер CMS или сервер-посредник и убедитесь, что сетевому адаптеру корпоративной сети назначен допустимый IP-адрес, а серверу Active Directory назначены допустимый статический IP-адрес и DNS.
    
  - Войдите на сервер CMS/-исправлений и откройте командную запись. Выполните проверку связи с сервером Active Directory по полному доменному имени и IP-адресу. Если с сервером связаться не удается, это может указывать на конфликт IP-адресов. Попробуйте назначить серверу новый IP-адрес и изменить параметры DNS на сервере-посреднике или сервере CMS соответствующим образом.
    
- **Причина: появляется следующее сообщение об ошибке "Remove-VMSwitch: сбой при удалении виртуального коммутатора Ethernet. Невозможно удалить виртуальный коммутатор "переключатель управления с помощью облака-соединителя", так как он используется запущенными виртуальными машинами или назначен дочерним пулам. "**
    
    **Решение:** После развертывания не был удален "ключ управления облачным соединителем". Если возникает эта ошибка, перейдите в диспетчер Hyper-V и убедитесь в отсутствии виртуальных машин, подключенных к этому коммутатору. При необходимости отключите подключенные виртуальные машины и удалите коммутатор управления. Если удалить его по-прежнему не удается, перезапустите сервер узла и повторите попытку.
    
- **Причина: появляется следующее сообщение об ошибке "не удается запустить службу РТКМРАУС. Убедитесь, что служба не отключена.**
    
    > [!NOTE]
    > Эта проблема применима только к версиям соединителя облака, предшествующим 1.4.2. 
  
    Причиной сбоя запуска может быть предыдущая отработка отказа этого сервера переднего плана (путем отработки отказа компьютера). В этом случае выполните откат (откат компьютера).
    
    **Решение**. Эта проблема возникает на пограничном сервере, если пограничный сервер не доверяет сертификату корневого ЦС или промежуточного ЦС. Даже в том случае, если можно импортировать внешний сертификат, но цепочка сертификатов нарушена, службу RTCMRAUTH и (или) RTCSRV запустить невозможно.
    
    Вручную импортируйте сертификат корневого ЦС или все сертификаты промежуточных ЦС внешнего сертификата на пограничный сервер, а затем перезапустите его. После запуска служб RTCMRAUTH и RTCSRV на пограничном сервере вернитесь на сервер узла, запустите консоль PowerShell от имени администратора и выполните следующий командлет, чтобы переключиться на новое развертывание:
    
  ```powershell
  Switch-CcVersion
  ```

- 
    
    **Проблема. Сервер узла перезапускается после применения обновлений Windows, и происходит сбой вызовов, обслуживаемых этим сервером.**
    
    **Решение**. Если развернута среда высокой доступности, Microsoft предоставляет командлет для переноса одного хост-компьютера (экземпляра развертывания) в текущую топологию или из нее при проверке и установке обновления для Windows вручную. Для этого выполните следующие действия:
    
1. На сервере узла запустите консоль PowerShell от имени администратора, а затем выполните команду:
    
   ```powershell
   Enter-CcUpdate
   ```

2. Проверьте наличие обновлений и установите доступные обновления.
    
3. В консоли PowerShell запустите следующий командлет:
    
   ```powershell
   Exit-CcUpdate
   ```

- 
    
    **Проблема. При выполнении звонка из клиента Skype для бизнеса с использованием номера ТСОП невозможно повысить уровень звонка до конференции, пригласив к участию в нем другой номер ТСОП**.
    
    **Решение:** Чтобы устранить эту проблему, ознакомьтесь со сведениями в разделе [Настройка параметров сервера гибридных сетевых исправлений](configure-cloud-connector-integration-with-your-office-365-tenant.md#BKMK_ConfigureMediationServer).
    
- **Проблема. При установке сервера Active Directory отображается предупреждение о Центре обновления Windows: «Автоматическое обновление Windows отключено. Чтобы обеспечить автоматическое обновление только что установленной роли или компонента, включите Центр обновления Windows».**
    
    **Решение:** Запустите удаленный сеанс PowerShell клиента с помощью учетных данных администратора Skype для бизнеса, а затем выполните следующий командлет для проверки конфигурации _енаблеаутаупдате_ на сайте:
    
  ```powershell
  Get-CsHybridPSTNSite
  ```

    Если для _енаблеаутаупдате_ установлено **значение true**, вы можете спокойно проигнорировать это предупреждение, так как служба кцеманажемент будет обрабатывать загрузку и установку обновлений для Windows как для виртуальных машин, так и для основного сервера. Если для _енаблеаутаупдате_ задано **значение false**, запустите следующий командлет, чтобы установить для него значение **true**.
    
  ```powershell
  Set-CsHybridPSTNSite -EnableAutoUpdate $true
  ```

    Кроме того, вы можете вручную проверить наличие обновлений и установить их. Просмотрите следующий раздел.
    
- **Причина: вы получаете сообщение об ошибке: не удается зарегистрировать устройство управления, так как \<ваши\> текущие \<входные \<и конфигурации sitename\> или \<апплианценаме\> либо IP-\> адрес сервера исходящих серверов или сервер исходящих сообщений конфликтуют с существующим устройством. Удалите конфликтующее устройство или обновите данные ввода и настройки, а затем повторите регистрацию. ' при выполнении Register-Ккапплианце зарегистрировать текущее устройство в сети.**
    
    **Решение:** Значения для IP \<-\>адреса \<\> сервера апплианценаме,\> полного \<доменного имени и сервера исданных исправлений должны быть уникальными и использоваться только для одной регистрации устройства. По умолчанию \<апплианценаме\> берется из имени узла. \<IP-адрес\> \> сервера \<исправлений, заданный в файле конфигурации ini.
    
    Например, при использовании (ApplianceName= MyserverNew, Mediation Server FQDN=ms.contoso.com, Mediation Server IP Address=10.10.10.10) для регистрации на сайте SiteName=MySite, если существует зарегистрированное устройство (ApplianceName= Myserver, Mediation Server FQDN=ms.contoso.com, Mediation Server IP Address=10.10.10.10), возникнет конфликт.
    
    Прежде всего проверьте файл CloudConnector.ini в каталоге ApplianceRoot. Вы получите \<в файле\>значения \<IP-адреса\> \> сервера \<доменных имен (FQDN) и сервера исправлений. \<Апплианценаме\> — это имя вашего сервера узла.
    
    Во-вторых, запустите удаленную оболочку PowerShell с помощью учетных данных администратора клиента Skype для бизнеса, а затем выполните следующий командлет для проверки зарегистрированного устройства (-ов).
    
  ```powershell
  Get-CsHybridPSTNAppliance
  ```

    После обнаружения конфликтов вы можете обновить файл CloudConnector.ini, включив в него данные зарегистрированного устройства, или отменить регистрацию существующего устройства для устранения конфликтов.
    
  ```powershell
  Unregister-CsHybridPSTNAppliance -Force
  ```

    
- **Вопрос: командлет Get-Ккруннингверсион возвращает пустое значение, если на хосте запущено приложение с развернутым устройством.**
    
  **Решение:** Это может случиться при переходе с 1.3.4 или 1.3.8 на 1.4.1. После установки версии 1.4.1 с помощью MSI-файла необходимо запустить `Register-CcAppliance` перед запуском любого другого командлета. `Register-CcAppliance`выполняет миграцию файла Module. ini из%Усерпрофиле%\клаудконнектор в%Програмдата%\клаудконнектор. Если пропустить этот шаг, в папке %ProgramData%\CloudConnector будет создан новый файл module.ini, который заменит сведения о выполняющейся или резервной версии для 1.3.4 или 1.3.8.
    
  Сравните файлы module.ini в папках %UserProfile%\CloudConnector и %ProgramData%\CloudConnector. Если есть различия, удалите файл Module. ini в%Програмдата%\клаудконнектор и снова запустите `Register-CcAppliance`его. Вы также можете изменить файл вручную, чтобы он был правильно запущенный и резервная версия.
    
- **Проблема: после запуска командлета Switch-Ккверсион для переключения на старую версию, которая отличается от текущей версии сценария, для этой старой версии отсутствует поддержка высокого уровня доступности.**
    
    **Решение:** Например, вы перешли с 1.4.1 на 1.4.2. Текущая версия сценария, которая может быть определена при запуске `Get-CcVersion`, и используемая версия, которую можно определить с помощью команды `Get-CcRunningVersion` "1.4.2". В настоящее время, если вы `Switch-CcVersion` перейдете на 1.4.1, для этой старой версии отсутствует поддержка высокого уровня доступности.
    
    Чтобы получить полную поддержку высокой готовности, вернитесь к версии 1.4.2 (запущенная версия и версия скрипта должны быть одинаковыми). При возникновении проблем с развертыванием версии 1.4.2 удалите и повторно установите ее.
    
- **Проблема. Срок действия сертификатов, выданных центром сертификации, или внутренних сертификатов, выданных серверу центрального хранилища управления (CMS), серверу-посреднику или пограничному серверу, истекает, либо они скомпрометированы.**
    
    **Решение.** Сертификаты Skype для бизнеса, выданные центром сертификации, действуют в течение пяти лет. Внутренние сертификаты, выданные серверу центрального хранилища управления (CMS), серверу-посреднику или пограничному серверу, действуют в течение двух лет.
    
    > [!NOTE]
    > В облачном соединителе версии 2,0 и более поздних командлета Update-Кксерверцертификате изменилось на обновление Кксерверцертификате, а командлет продления-Кккацертификате изменился на Update-Кккацертификате. 
  
    Если внутренние сертификаты, выданные для хранилища централизованного управления, сервера-посредника и пограничного сервера, приближается к истечении срока действия или скомпрометированы, запустите командлет Restore-Кксерверцертификате или Update-Кксерверцертификате для продления сертификатов.
    
    Если срок действия сертификатов центра сертификации истек, выполните командлет возобновления-Кккацертификате или Update-Кккацертификате для продления сертификатов.
    
    **Если сертификаты центра сертификации скомпрометированы и на сайте есть только одно устройство,** выполните указанные ниже действия.
    
1. Выполните командлет Enter-CcUpdate, чтобы очистить службы и перевести устройство в режим обслуживания.
   
   ```powershell
   Enter-CcUpdate
   ```
   
2. Выполните следующие командлеты, чтобы сбросить и создать новые сертификаты центра сертификации, а также все внутренние сертификаты.
    
    Для выпусков облачных соединителей перед 2,0:
    
    ```powershell
    Reset-CcCACertificate 
    Renew-CcServerCertificate 
    Remove-CcLegacyServerCertificate 
    ```

    А также для облачного соединителя выпуска 2,0 и более поздних версий:
    
    ```powershell
    Reset-CcCACertificate 
    Update-CcServerCertificate 
    Remove-CcLegacyServerCertificate 
    ```
    
3. Если между шлюзом и сервером-посредником используется протокол TLS, выполните командлет Export-Ккрутцертификате на устройстве, а затем установите экспортированный сертификат на шлюзы PSTN. Кроме того, вам может потребоваться повторно выдать сертификат на ваш шлюз.

   ```powershell
   Export-CcRootCertificate
   ```

4. Запустите командлет Exit-Ккупдате, чтобы запустить службы и выйти из режима обслуживания.

   ```powershell
   Exit-CcUpdate
   ```


    **Если сертификаты центра сертификации скомпрометированы и на сайте есть несколько устройств,** выполните указанные ниже действия на каждом устройстве сайта.
    
    Корпорация Microsoft рекомендует выполнять эти действия во время непикового использования.
    
1. На первом устройстве выполните командлет Remove-Ккцертификатионаусоритифиле для очистки файлов резервных копий ЦС в каталоге \<ситерут.\>

     ```powershell
     Remove-CcCertificationAuthorityFile
     ```
    
2. Запустите командлет Enter-Ккупдате для сток служб и помещения каждого устройства в режим обслуживания.

     ```powershell
     Enter-CcUpdate
     ```
    
3. На первом устройстве выполните следующие командлеты для сброса и создания новых сертификатов центра сертификации и всех внутренних сертификатов сервера.
    
     Для выпусков облачных соединителей перед 2,0:
    
     ```powershell
     Reset-CcCACertificate
     Renew-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```

     А также для облачного соединителя выпуска 2,0 и более поздних версий:
    
     ```powershell
     Reset-CcCACertificate
     Update-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```

4. На первом устройстве запустите следующий командлет для резервного копирования файлов ЦС в папку \<ситерут.\>
    
     ```powershell
     Backup-CcCertificationAuthority
     ```
   
5. На любом другом устройстве на том же сайте выполните следующие команды, чтобы использовать резервные файлы центра сертификации, чтобы все устройства использовали один и тот же корневой сертификат, а затем запросить новые сертификаты. 
   
     ```powershell
     Reset-CcCACertificate
     Update-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```
     
6. Если между шлюзом и сервером-посредником используется протокол TLS, выполните командлет Export-Ккрутцертификате на любом устройстве сайта, а затем установите экспортированный сертификат на шлюзы PSTN. Кроме того, вам может потребоваться повторно выдать сертификат на ваш шлюз.
  
     ```powershell
     Export-CcRootCertificate
     ```
     
7. Запустите командлет Exit-Ккупдате, чтобы запустить службы и выйти из режима обслуживания. 

     ```powershell
     Exit-CcUpdate
     ```
    
    
- **Причина: в журнале службы управления облачным соединителем появляется следующее сообщение об ошибке: "C:\Program Филес\скипе для бизнеса Cloud Connector Едитион\манажементсервице\кцеманажементсервице.лог". Кцесервице Error: 0: непредвиденное исключение при отправке отчета о состоянии в сети: вход в System. Management. Automation. \<кмдлетинвокатионексцептион: сбой\>входа для администратора глобального клиента. Создайте новый объект учетных данных, убедившись в том, что вы использовали правильные имя пользователя и пароль. ---\>**
    
    **Решение:** Учетные данные администратора глобального клиента Office 365 были изменены с момента регистрации устройства облачного соединителя. Чтобы обновить локально хранящиеся учетные данные на устройстве облачного соединителя, выполните следующие действия от администратора PowerShell на устройстве узла:
    
  ```powershell
  Set-CcCredential -AccountType TenantAdmin
  ```

- **Вопрос: после изменения пароля для учетной записи сервера узла, которую вы использовали для развертывания, появляется следующее сообщение об ошибке: "ConvertTo-SecureString: ключ не является допустимым для использования в указанном состоянии" в%Програмфилес%\скипе для бизнеса Cloud Connector Едитион\манажементсервице\кцеманажементсервице.лог или при выполнении командлета Get-Кккредентиал.**
    
    **Решение:** Все учетные данные облачного соединителя хранятся в следующем файле: "%Системдриве%\програмдата\клаудконнектор\кредентиалс. \<CurrentUser\>. XML ". При изменении пароля на сервере узла необходимо обновить учетные данные, сохраненные локально.
    
    **При запуске Cloud Connector версии 1.4.2,** повторно создайте все пароли Cloud Connector, выполнив следующие действия.
    
  1. Перезапустите сервер узла.
    
  2. Удалите следующий файл: "%Системдриве%\програмдата\клаудконнектор\кредентиалс. \<CurrentUser\>. XML ".
    
  3. Запустите консоль PowerShell с правами администратора, а затем выполните команду "Register-Ккапплианце-Local", чтобы повторно ввести пароли после описания. Введите те же пароли, которые были указаны ранее для развертывания Cloud Connector.
    
     **Если вы используете облачный соединитель версии 2,0 или более поздней,** повторно создайте все пароли из облачных соединителей, выполнив следующие действия:
    
  4. Перезапустите сервер узла.
    
  5. Удалите следующий файл: "%Системдриве%\програмдата\клаудконнектор\кредентиалс. \<CurrentUser\>. XML ".
    
  6. Запустите консоль PowerShell с правами администратора, а затем выполните команду "Register-Ккапплианце-Local", чтобы повторно ввести пароли после описания. 
    
     Если файл кэшированного пароля был сгенерирован с помощью Cloud Connector версии 1.4.2, при появлении запроса используйте пароль VMAdmin для пароля CceService. Для всех остальных учетных записей введите тот же пароль, который был указан ранее для развертывания Cloud Connector.
    
     Если файл кэшированного пароля был сгенерирован с помощью Cloud Connector версии 1.4.2, и пароли учетных записей DomainAdmin и VMAdmin отличаются друг от друга, необходимо выполнить следующие действия.
    
  7. Запустите командлет Set-CcCredential -AccountType DomainAdmin, следуя инструкциям ниже.
    
  8. При запросе учетных данных старой учетной записи введите учетные данные, которые использовались с паролем для учетной записи CceService.
    
  9. При запросе учетных данных новой учетной записи введите пароль для DomainAdmin, использованный ранее.
    
     Если файл с кэшированным паролем был создан с помощью облачного соединителя версии 2,0 или более поздней, по умолчанию Вмадмин и Домаинадмин используют тот же пароль, что и в Кцесервице. Если пароли для DomainAdmin и VMAdmin были изменены, необходимо выполнить следующие действия.
    
  10. Запустите командлет Set-CcCredential -AccountType DomainAdmin, следуя инструкциям ниже.
    
       1. При запросе учетных данных старой учетной записи введите учетные данные, которые использовались с паролем для CceService.
    
       2. При запросе учетных данных новой учетной записи введите пароль для DomainAdmin, использованный ранее.
    
  11. Запустите командлет Set-CcCredential -AccountType VmAdmin, следуя инструкциям ниже.
    
       1. При запросе учетных данных старой учетной записи введите учетные данные, которые использовались с паролем для CceService.
    
       2. При запросе учетных данных новой учетной записи введите пароль для VmAdmin, использованный ранее.  
    
- **Проблема: если у вас есть облачный соединитель версии 2,1 или более поздней, то при запуске Register-Ккапплианце или других командлетов на устройстве появляется следующее сообщение об ошибке: "для каждого объекта: невозможно найти свойство" Common "для этого объекта. Убедитесь, что свойство существует. На странице C:\Program Files\WindowsPowerShell\Modules\CloudConnector\Internal\MtHostCommon.ps1:681 char: 14 "**
    
    **Решение:** Для облачного соединителя 2,1 и более поздних версий требуется платформа .NET Framework 4.6.1 или более поздней версии. Обновите .NET Framework на устройстве с помощью 4.6.1 или более поздней версии, а затем снова запустите командлеты.

- **Вопрос: с помощью Cloud Connector Edition 2,1 при запуске Install-Ккапплианце появляется следующее сообщение об ошибке: "сбой при установке нового экземпляра с ошибкой: невозможно установить" состояние ", так как только строки можно использовать в качестве значений для задания свойств XmlNode"**

   **Решение:** В Клаудконнектор. ini в разделе [общие] добавьте следующую конфигурацию "состояние": Каунтрикоде = US штат = WA City = Redmond

   Значение "State" для строки "состояние" не является обязательным, но строка "состояние" не может быть удалена из файла Клаудконнектор. ini.

- **Причина: сообщение об ошибке "Dismount-Виндовсимаже: Dismount-Виндовсимаже не удалось. Код ошибки = 0xc1550115 "при установке или обновлении Cloud Connector Edition.**
    
    **Решение:** Запустите консоль PowerShell с правами администратора, запустите "DISM-Cleanup-WIM". Произойдет очистка всех изображений с проблемами. Запустите командлет Install-CcAppliance повторно или дождитесь автоматического обновления.
    
- **Ошибка: не удается развернуть первое устройство облачного соединителя в среде высокой надежности**
    
    **Решение:** Действия, которые вы хотите выполнить, зависят от причины сбоя развертывания.
    
  - Если первое устройство облачного соединителя завершается сбоем и вы не можете определить причину сбоя, необходимо установить устройство еще раз, пока развертывание не завершится успешно, а затем установить другие устройства.
    
  - Если первое устройство облачного соединителя не проходит из-за незначительной проблемы, например проблемы с внешним сертификатом, возможно, вам удастся устранить проблему без повторной установки устройства. Затем вы можете использовать удаленную оболочку клиента PowerShell, чтобы помечать развертывание как выполненное следующим образом. (Кроме того, если первое развертывание прошло успешно, вы также можете выполнить следующие действия, но по какой-либо причине облачный соединитель не смог сообщить об этом развертывание как успешное.)
    
  - Чтобы получить идентификатор (GUID) первого устройства облачного соединителя, выполните командлет Get-Кшибридпстнапплианце.
    
  - Чтобы помечать устройство как успешно развернутое, выполните параметр SET-Кскцеапплианцедеплойментстатус следующим образом:
    
  ```powershell
  Set-CsCceApplianceDeploymentStatus -Identity <Appliance Identity GUID> -Action Deploy -Status Finished
  ```

- **Проблема. Требуется вручную проверять и устанавливать обновления Windows на сервере узла или виртуальных машинах.**
    
   **Решение**. Рекомендуется использовать преимущества функции автоматического применения обновлений ОС в составе Skype для бизнеса Cloud Connector Edition. После регистрации устройства для управления через Интернет и включения автоматического обновления ОС сервер узла и виртуальные машины будут проверять и устанавливать обновления Windows автоматически согласно параметрам периода обновления ОС.
    
   Если вам требуется вручную проверять и устанавливать обновления Windows, выполните процедуру в этом разделе, соответствующую вашему типу развертывания. Необходимо запланировать одновременное обновление сервера узла и выполняющихся на нем виртуальных машин, чтобы свести к минимум время простоя, необходимое для обновления.
    
   При желании можно использовать сервер служб WSUS для предоставления обновлений серверам Cloud Connector. Однако необходимо убедиться, что для обновлений Windows **не задана** автоматическая установка.
    
   Дополнительные сведения об обновлении развертывания Cloud Connector вручную см. в следующем разделе.
    
- **Вопрос: при обновлении облачного соединителя до новой сборки командлеты облачного соединителя не обновляются.** Это может произойти, если при выполнении автоматического обновления окно PowerShell остается открытым.
    
  **Решение:** Чтобы загрузить обновленные командлеты, выполните одно из указанных ниже действий.
    
   - Закройте PowerShell на устройстве облачного соединителя, а затем снова откройте PowerShell.
    
     - Кроме того, можно выполнить Import-Module Клаудконнектор-Force. 
 
-   **Ошибка: "Stop-Ксвиндовссервице" не распознается как имя командлета, функции, файла сценария или программы, которая не может быть запущена. "при попытке выполнить командлет Enter-Ккупдате.**

    **Решение:** Удалите файл $HOME \Аппдата\локал\микрософт\виндовс\повершелл\модулеаналисискаче.
Оболочка PowerShell создает этот файл в виде кэша командлетов из найденных модулей, поэтому не нужно каждый раз заново анализировать все модули, так как это сделает что-нибудь очень медленно. Скорее всего, обнаружено повреждение файлов, которое привело бы к недействительности результатов PowerShell при чтении из кэша.

-   **Ошибка: "Import-Module Клаудконнектор" создает ошибку "Import-Module: указанный модуль" Клаудконнектор "не был загружен, так как в каталоге модулей не найден допустимый файл модуля**

    **Решение:**
    - Проверка наличия модуля Клаудконнектор в папке c:\Program Филес\виндовсповершелл\модулес
    
    - После проверки наличия модуля Клаудконнектор в этом расположении переменная среды Псмодулепас, в которой хранится путь к расположениям модулей, может быть изменена.
    
     a) Временное изменение: запустите PowerShell с правами администратора и выполните следующую команду: $env:P Смодулепас = $env:P Смодулепас + "; C:\Program Филес\виндовсповершелл\модулес\"
        
     б) Чтобы внести постоянные изменения, запустите PowerShell как администратор и выполните следующие команды: $CurrentValue = [Environment]:: Жетенвиронментвариабле ("Псмодулепас", "Machine") Сетенвиронментвариабле ("Псмодулепас"; $CurrentValue C:\Program Филес\виндовсповершелл\модулес "," Machine ")

    
## <a name="install-windows-updates-manually"></a>Установка обновлений для Windows вручную

Если вы не хотите использовать автоматические обновления в своей среде, выполните эти действия для ручной проверки и применения обновлений Windows. Для проверки наличия и установки обновлений для Windows может потребоваться перезапуск сервера. При перезапуске хост-сервера пользователи не смогут использовать облачный соединитель для размещения и приема звонков. Вы можете вручную проверить и установить обновления, указав время их применения, а затем перезагрузить компьютеры по мере необходимости, выбрав периоды, которые позволят избежать перерывов в обслуживании.
  
Чтобы вручную проверить обновления, подключитесь к каждому серверу узла и откройте **панель управления**. Выберите **система и безопасность \>**, а затем — Управление обновлениями и сервером в соответствии с вашей средой.
  
- Если на сайте имеется только одно устройство, подключитесь к каждой виртуальной машине и откройте **панель управления**. Выберите пункт **Обновление Windows \>для системы и безопасность**, а затем настройте обновления и сервер, если это необходимо.
    
- Если на сайте несколько устройств, обновляемый и перезагружаемый экземпляр будет недоступен для пользователей во время обновления. Пользователи будут подключаться к другим экземплярам в развертывании до тех пор, пока все виртуальные машины и все службы Skype для бизнеса на виртуальных машинах не запустятся после завершения обновления. Чтобы избежать перерывов в обслуживании, можно удалить экземпляр из среды высокой доступности на время применения обновлений, а затем восстановить его. Для этого выполните следующую процедуру.
    
1. На каждом сервере узла откройте консоль PowerShell от имени администратора.
    
2. Удалите экземпляр из среды высокой доступности, используя следующий командлет:
    
   ```powershell
   Enter-CcUpdate
   ```

3. 
    
    Выполните процедуру применения обновлений вручную для одного экземпляра и перезапустите виртуальную машину.
    
4. Верните экземпляр в среду высокой доступности, используя следующий командлет:
    
   ```powershell
   Exit-CcUpdate
   ```

Для развертываний с несколькими сайтами выполните процедуру для отдельного сайта для всех сайтов в развертывании, применяя обновления к одному сайту за раз.
  
## <a name="tips-when-installing-anti-virus-software-on-the-cloud-connector-host-machine"></a>Советы по установке антивирусной программы на хост-компьютере облачного соединителя

Если вам нужно установить антивирусную программу на хост-компьютере облачного соединителя, необходимо добавить следующие исключения:
  
- Каталог локального устройства на каждом компьютере.
    
- Каталог удаленных сайтов на каждом компьютере.
    
- Каталог локального сайта на компьютере содержит корневую папку общего сайта.
    
- %Програмфилес%\скипе для бизнеса Cloud Connector Edition
    
- %аллусерспрофиле%\клаудконнектор
    
- %програмфилес%\виндовсповершелл\модулес\клаудконнектор
    
- Процесс Microsoft. RTC. КЦЕ. Манажементсервице. exe.
