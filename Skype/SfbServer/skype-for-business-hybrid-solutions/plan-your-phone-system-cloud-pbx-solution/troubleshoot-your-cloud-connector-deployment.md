---
title: Устранение неполадок с развертыванием Cloud Connector
ms.reviewer: ''
ms.author: crowe
author: CarolynRowe
manager: serdars
ms.date: 12/5/2017
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection:
- Strat_SB_Hybrid
ms.custom: ''
ms.assetid: e6cf58cc-dbd9-4f35-a51a-3e2fea71b5a5
description: Устранение неполадок развертывания Cloud Connector Edition.
ms.openlocfilehash: 7a1caea67c5b5899c2dc0909ef771a57c7c50389
ms.sourcegitcommit: b424ab14683ab5080ebfd085adff7c0dbe1be84c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/03/2020
ms.locfileid: "47359335"
---
# <a name="troubleshoot-your-cloud-connector-deployment"></a>Устранение неполадок с развертыванием Cloud Connector

> [!Important]
> Выпуск Cloud Connector Edition завершится 31 июля 2021 г. вместе со Skype для бизнеса Online. После обновления вашей организации до Teams узнайте, как подключить свою локальной телефонной сети к Teams с помощью [прямой маршрутизации.](https://docs.microsoft.com/MicrosoftTeams/direct-routing-landing-page)
 
Устранение неполадок развертывания Cloud Connector Edition.
  
В этом разделе описываются решения распространенных проблем с развертываниями Cloud Connector Edition. Если у вас возникли проблемы со звонками в телефонную сеть общего звонков ( PSTN) и из нее, вы можете изучить их, следуя решениям, описанным в этом разделе.
  
Cloud Connector предоставляет встроенные механизмы для автоматического решения некоторых проблем. Процесс автоматического обнаружения ищет потенциальные проблемы с устройствами Cloud Connector и, по возможности, устраняет эти проблемы без вмешательства администратора. Процесс обнаружения работает следующим образом:
  
- **Последовательность обнаружения:** Служба управления Cloud Connector запускает процесс каждые 60 секунд, чтобы определить, не работает ли устройство. В Cloud Connector версии 2.0 и более поздних версиях процесс обнаружения использует коммутатор Skype для бизнеса Corpnet для подключения PowerShell к компьютерам Cloud Connector; Для версий, предшествующих версии 2.0, процесс обнаружения использует коммутатор управления Cloud Connector.
    
    > [!NOTE]
    > Для успешного автоматического восстановления должно быть сетевое подключение между хост-компьютером и виртуальными машинами через сетевой коммутатор хост-компьютера. Обязательно проверьте возможность подключения к сети, чтобы обеспечить успешное автоматическое обнаружение и восстановление. 
  
- **Мониторинг:** В Cloud Connector версии 2.0 и более поздних версиях отслеживаются следующие службы:
    
  - Виртуальные машины не подключены к корпоративным или интернет-виртуальным коммутаторам Cloud Connector
    
  - Виртуальные машины находятся в сохраненной или остановленной состоянии
    
  - Службы центрального сервера управления: РЕПЛИКА, MASTER
    
  - Службы сервера-посредника: REPLICA, RTCSRV и MEDSVC
    
  - Службы edge Server: REPLICA, RTCSRV, RTCDATAPROXY, RTCMRAUTH, RTCMEDIARELAY
    
  - Правила брандмауэра входящие входящие отключены для CS RTCSRV на сервере-посреднике, CS RTCMEDSRV на сервере-посреднике
    
    В Cloud Connector версии 1.4.2 отслеживаются только следующие службы:
    
  - Службы серверов-посредников: RTCSRV и MEDSVC
    
  - Служба edge Server: RTCSRV
    
- **Процесс восстановления:** Если какие-либо отслеживаемая служба не работать, устройство помечается, а службы останавливаются и помечаются вручную до тех пор, пока не будут устранены все проблемы. Это предотвратит маршрутику вызовов на устройство, которое может привести к сбоям вызовов.
    
    Служба управления Cloud Connector повторно выполнит автоматическое восстановление следующим образом.
    
  - Интервал первой повторной попытку составляет каждые десять секунд с максимальным интервалом в один час.
    
  - Для первых трех попыток восстановления интервал составляет 10 секунд. Начиная с четвертой повторной попытку интервал увеличивается в два раза по сравнению с предыдущим интервалом. Например, четвертая повторить попытку произойдет через 20 секунд, пятая за 40 секунд и так далее. 
    
  - Когда достигается максимальный интервал в один час, повторы будут продолжаться один раз в час.
    
  - При успешном восстановлении интервал и количество повторной попытку устанавливаются на исходные значения.
    
  - При перезапуске службы управления интервал и количество повторов сбрасываются до исходных значений.
    
## <a name="troubleshooting"></a>Устранение неполадок

Ниже даны решения распространенных проблем.
  
- **Проблема: развертывание не отвечает или перестает отвечать при запуске сценариев развертывания. После входа на каждую ВМ IP-адрес отсутствует или неверен для сети управления, внутренней или внешней сети.**
    
    **Решение:** Эту проблему невозможно устранить автоматически. NiCs нельзя добавить на ВМ во время их работы. Закройте и удалите эти ВМ в диспетчере Hyper-V, а затем запустите следующие команды:
    
  ```powershell
  Uninstall-CcAppliance
  ```

  ```powershell
  Install-CcAppliance
  ```

- 
    
    **Проблема: после установки сервера Active Directory и леса сервер CMS и/или сервер-посредник не присоединились к домену правильно.**
    
    **Решение:** Чтобы устранить эту проблему, необходимо предпринять следующие действия.
    
  - Войдите на сервер Active Directory Server и убедитесь, что домен создан правильно.
    
  - Войдите на сервер CMS или сервер-посредник и убедитесь, что в подсети corpnet назначен действительный IP-адрес, а допустимый статический IP-адрес и DNS настроены в качестве IP-адреса сервера AD.
    
  - Войдите на сервер CMS или сервер-посредник и откройте командную подсказку. Убедитесь, что вы можете сделать ping FQDN и IP-адрес сервера Active Directory Server. Если это невозможно, может возникнуть конфликт IP-адресов. Попробуйте назначить новый IP-адрес для Active Directory и соответствующим образом обновить DNS на сервере-посреднике или CMS.
    
- **Проблема: вы получаете следующее сообщение об ошибке: "Remove-VMSwitch : Failed while removing virtual Ethernet switch. Виртуальный коммутатор "Cloud Connector Management Switch" нельзя удалить, так как он используется при запуске виртуальных машин или в качестве назначенного для него пула".**
    
    **Решение:** После развертывания не был удален переключатель управления Cloud Connector. Если вы нажмете эту ошибку, перейдите в диспетчер Hyper-v и убедитесь, что виртуальная машина еще не подключена к ней. Если виртуальные машины по-прежнему подключены, отключите их и удалите коммутатор управления. Если удалить коммутатор управления по-прежнему невозможно, перезапустите сервер хост-сервера и повторите попытку.
    
- **Проблема: вы получаете следующее сообщение об ошибке: "Не удалось запустить службу RTCMRAUTH. Убедитесь, что служба не отключена".**
    
    > [!NOTE]
    > Эта проблема относится только к версиям Cloud Connector более ранних версий, чем 1.4.2. 
  
    Сбой при запуске также может произойти из-за того, что этот сервер переднего сервера был ранее переудачен (с помощью отказа компьютера). В этом случае вы должны вызвать отбой (используя отбой компьютера).
    
    **Решение:** Эта проблема происходит на сервере, когда сертификат корневого или промежуточного ЦС не является доверенным для этого сервера. Даже если внешний сертификат можно импортировать, но цепочка сертификатов разбита. При этом условии не может запуститься служба RTCMRAUTH и/или RTCSRV.
    
    Импортировать сертификат корневого ЦС и все промежуточные сертификаты ЦС внешнего сертификата вручную на edge-сервер, а затем перезапустить его. После запуска служб RTCMRAUTH и RTCSRV на сервере edge, перейдите на хост-сервер, запустите консоль PowerShell от имени администратора и запустите следующий cmdlet, чтобы переключиться на новое развертывание:
    
  ```powershell
  Switch-CcVersion
  ```

- 
    
    **Проблема: сервер-сервер был перезапущен при применении обновлений Windows и сбое вызовов, отслужив их.**
    
    **Решение:** Если развернута среда с высоким уровнем доступности, корпорация Майкрософт предоставляет для перемещения одного хост-компьютера (экземпляра развертывания) в текущую топологию или из нее при проверке и установке обновления Windows вручную. Для этого с помощью следующих действий:
    
1. На сервере хост-сервера запустите консоль PowerShell от учетной записи администратора, а затем запустите ок.
    
   ```powershell
   Enter-CcUpdate
   ```

2. Проверьте, нет ли обновлений и установите все доступные.
    
3. В консоли PowerShell запустите следующий cmdlet:
    
   ```powershell
   Exit-CcUpdate
   ```

- 
    
    **Проблема: при вызове из клиента Skype для бизнеса с использованием номера STN вызов не может быть перенастроен в конференцию путем приглашения другого номера ЗВОНКОВ.**
    
    **Решение:** Чтобы устранить эту проблему, см. ["Настройка параметров сетевого гибридного сервера-посредника".](configure-cloud-connector-integration-with-your-office-365-tenant.md#BKMK_ConfigureMediationServer)
    
- **Проблема: при установке сервера Active Directory отображается предупреждение об Обновлении Windows : "Автоматическое обновление Windows не включено. Чтобы убедиться, что новая роль или функция автоматически обновлены, включите Обновление Windows".**
    
    **Решение:** Запустите удаленный сеанс PowerShell клиента с помощью учетных данных администратора клиента Skype для бизнеса, а затем запустите следующий cmdlet, чтобы проверить конфигурацию _EnableAutoUpdate_ сайта:
    
  ```powershell
  Get-CsHybridPSTNSite
  ```

    Если  _для enableAutoUpdate_ установлено значение **True,** вы можете игнорировать это предупреждение, так как служба CCEManagement будет обрабатывать загрузку и установку обновлений Windows для виртуальных машин и хост-сервера. Если _для enableAutoUpdate установлено_ **false,** запустите следующий cmdlet, чтобы установить для него **true.**
    
  ```powershell
  Set-CsHybridPSTNSite -EnableAutoUpdate $true
  ```

    Кроме того, вы можете вручную проверить и установить обновления. (см. следующий раздел).
    
- **Проблема: вы получаете сообщение об ошибке: не удается зарегистрировать устройство, так как текущая ввод/конфигурация или или конфликтующая с существующими \<SiteName\> \<ApplianceName\> \<Mediation Server FQDN\> \<Mediation Server IP Address\> устройствами. Удалите устройство для конфликтов или обновите данные ввода и конфигурации, а затем снова зарегистрируйтесь. ' при запуске Register-CcAppliance для регистрации текущего устройства в Сети.**
    
    **Решение:** Значения для и должны быть \<ApplianceName\> \<Mediation Server FQDN\> \<Mediation Server IP Address\> уникальными и использоваться только для одной регистрации устройства. По умолчанию происходит \<ApplianceName\> из имени хоста. \<Mediation Server FQDN\> и \<Mediation Server IP Address\> определено в ini-файле конфигурации.
    
    Например, using (ApplianceName= MyserverNew, Сервер-посредник: FQDN=ms.contoso.com, IP-адрес сервера-посредника=10.10.10.10) для регистрации в SiteName=MySite, но если имеется зарегистрированное устройство (ApplianceName= Myserver, Mediation Server FQDN=ms.contoso.com, MEDIATION Server IP Address=10.10.10.10), будет возник конфликт.
    
    Сначала проверьте файл CloudConnector.ini в разделе каталога ApplianceRoot. Вы получите \<SiteName\> и значения в \<Mediation Server FQDN\> \<Mediation Server IP Address\> файле. \<ApplianceName\> — имя сервера хост-сервера.
    
    Во-вторых, запустите удаленную powerShell клиента с помощью учетных данных администратора клиента Skype для бизнеса, а затем запустите следующий cmdlet, чтобы проверить зарегистрированные устройства.
    
  ```powershell
  Get-CsHybridPSTNAppliance
  ```

    После выявления конфликтов можно либо обновить файл CloudConnector.ini данными, которые совпадают с зарегистрированным устройством, либо отозарегистрировать существующее устройство для устранения конфликтов.
    
  ```powershell
  Unregister-CsHybridPSTNAppliance -Force
  ```

    
- **Проблема: Get-CcRunningVersion возвращает пустое значение, если на хосте запущено развернуто устройство.**
    
  **Решение:** Это может произойти при обновлении с 1.3.4 или 1.3.8 до 1.4.1. После установки версии 1.4.1 с MSI необходимо выполнить перед запуском любого `Register-CcAppliance` другого cmdlet. `Register-CcAppliance` будет перенесен module.ini из %UserProfile%\CloudConnector в %ProgramData%\CloudConnector. Если вы пропустили его, module.ini будет создан в папке %ProgramData%\CloudConnector и замените сведения о запущенной или резервной версии для версии 1.3.4 или 1.3.8.
    
  Сравните module.ini файлов в папках %UserProfile%\CloudConnector и %ProgramData%\CloudConnector. Если имеются различия, удалите файл module.ini в папке %ProgramData%\CloudConnector и повторно перезапустить  `Register-CcAppliance` . Вы также можете изменить файл вручную до правильной запущенной и резервной версии.
    
- **Проблема: после запуска Switch-CcVersion для перехода на старую версию, которая отличается от текущей версии сценария, поддержка высокой доступности для этой старой версии не поддерживается.**
    
    **Решение:** Например, вы обновили 1.4.1 до 1.4.2. Текущая версия сценария, которую можно определить при запуске, и текущая версия, которую можно определить при запуске, — `Get-CcVersion`  `Get-CcRunningVersion` 1.4.2. В настоящее время, если вы запустите для переключения запущенной версии обратно на 1.4.1, поддержка высокой доступности для этой старой версии `Switch-CcVersion` не будет.
    
    Чтобы получить полную поддержку высокой доступности, переключиться обратно на версию 1.4.2, чтобы версия и версия сценария были одинаковыми. Если у вас возникают проблемы с развертыванием 1.4.2, как можно скорее удалить и переустановить его.
    
- **Проблема: срок действия сертификатов центра сертификации или внутренних сертификатов, выдав центру управления, серверу-посреднику и серверу-посреднику, истекает или они скомпрометированы.**
    
    **Решение:** Сертификаты сертификации Skype для бизнеса действительны в течение пяти лет. Внутренние сертификаты, выдамые центральному правлению, серверу-посреднику и серверу-посреднику, действуют в течение двух лет.
    
    > [!NOTE]
    > В Cloud Connector версии 2.0 и более поздних версиях Renew-CcServerCertificate был изменен на Update-CcServerCertificate, а Renew-CcCACertificate — на Update-CcCACertificate. 
  
    Если срок действия внутренних сертификатов, выданных центральному окнову управления, серверу-посреднику и серверу-посреднику, истекает или скомпрометирован, запустите Renew-CcServerCertificate или Update-CcServerCertificate для обновления сертификатов.
    
    Если срок действия сертификатов цс сертификации истекает, запустите Renew-CcCACertificate или Update-CcCACertificate для продления сертификатов.
    
    **Если сертификаты сертификационного** органа скомпрометированы и на сайте имеется только одно устройство, выполните следующие действия.
    
1. Запустите Enter-CcUpdate для истощать службы и помещая устройство в режим обслуживания.
   
   ```powershell
   Enter-CcUpdate
   ```
   
2. Чтобы сбросить и создать новые сертификаты цс сертификации и все внутренние сертификаты сервера, запустите следующие cmdlets:
    
    Для выпусков Cloud Connector до версии 2.0:
    
    ```powershell
    Reset-CcCACertificate 
    Renew-CcServerCertificate 
    Remove-CcLegacyServerCertificate 
    ```

    Или для Cloud Connector версии 2.0 и более поздних версий:
    
    ```powershell
    Reset-CcCACertificate 
    Update-CcServerCertificate 
    Remove-CcLegacyServerCertificate 
    ```
    
3. Если между шлюзом и сервером-посредником используется TLS, запустите Export-CcRootCertificate с устройства, а затем установите экспортный сертификат на шлюзы STN. Кроме того, может потребоваться повторное выдача сертификата на шлюзе.

   ```powershell
   Export-CcRootCertificate
   ```

4. Запустите Exit-CcUpdate, чтобы запустить службы и выйти из режима обслуживания.

   ```powershell
   Exit-CcUpdate
   ```


    **Если сертификаты сертификации** скомпрометированы и на сайте имеется несколько устройств, выполните следующие последовательное действия на каждом устройстве на сайте.
    
    Корпорация Майкрософт рекомендует выполнять эти действия в периоды не пиковой нагрузки.
    
1. На первом устройстве запустите Remove-CcCertificationAuthorityFile для очистки файлов резервной копии ЦС в \<SiteRoot\> каталоге.

     ```powershell
     Remove-CcCertificationAuthorityFile
     ```
    
2. Запустите Enter-CcUpdate, чтобы оцедить службы и поместить каждое устройство в режим обслуживания.

     ```powershell
     Enter-CcUpdate
     ```
    
3. На первом устройстве запустите следующие cmdlets для сброса и создания новых сертификатов цс сертификации и всех внутренних сертификатов сервера:
    
     Для выпусков Cloud Connector до версии 2.0:
    
     ```powershell
     Reset-CcCACertificate
     Renew-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```

     Или для Cloud Connector версии 2.0 и более поздних версий:
    
     ```powershell
     Reset-CcCACertificate
     Update-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```

4. На первом устройстве запустите следующий cmdlet для архива файлов ЦС в \<SiteRoot\> папке.
    
     ```powershell
     Backup-CcCertificationAuthority
     ```
   
5. На всех остальных устройствах на том же сайте запустите следующие команды, чтобы использовать файлы резервных копий ЦС, чтобы все устройства использовали один и тот же корневой сертификат, а затем запросите новые сертификаты. 
   
     ```powershell
     Reset-CcCACertificate
     Update-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```
     
6. Если между шлюзом и сервером-посредником используется TLS, запустите Export-CcRootCertificate с любого устройства на сайте, а затем установите экспортный сертификат на шлюзы STN. Кроме того, может потребоваться повторное выдача сертификата на шлюзе.
  
     ```powershell
     Export-CcRootCertificate
     ```
     
7. Запустите Exit-CcUpdate, чтобы запустить службы и выйти из режима обслуживания. 

     ```powershell
     Exit-CcUpdate
     ```
    
    
- **Проблема: в журнале службы управления Cloud Connector вы получаете следующее сообщение об ошибке: "C:\Program Files\Skype for Business Cloud Connector Edition\ManagementService\CceManagementService.log": ошибка CceService: 0 : непредвиденное исключение при отчете о состоянии в сети: System.Management.Automation.CmdletInvocationException: ошибка входа для пользователя \<Global Tenant Admin\> . Создайте новый объект учетных данных, убедившись, что вы использовали правильное имя пользователя и пароль. ---\>**
    
    **Решение:** Учетные данные глобального администратора клиента Microsoft 365 или Office 365 были изменены с момента регистрации устройства Cloud Connector. Чтобы обновить локально хранимые учетные данные на устройстве Cloud Connector, запустите в powerShell администратора на хост-устройстве следующее:
    
  ```powershell
  Set-CcCredential -AccountType TenantAdmin
  ```

- **Проблема: после изменения пароля учетной записи сервера размещения, используемой для развертывания, вы получите следующее сообщение об ошибке: "ConvertTo-SecureString : key not valid for use in specified state." in %ProgramFiles%\Skype for Business Cloud Connector Edition\ManagementService\CceManagementService.log or while running the Get-CcCredential cmdlet.**
    
    **Решение:** Все учетные данные Cloud Connector хранятся в следующем файле: "%SystemDrive%\Programdata\Cloudconnector\credentials. \<CurrentUser\> xml". При смене пароля на сервере на хост-сервере потребуется обновить локально сохраненные учетные данные.
    
    **Если вы работаете с Cloud Connector версии 1.4.2,** повторно развяжите все пароли Cloud Connector, выдав следующие действия:
    
  1. Перезапустите сервер хост-сервера.
    
  2. Удалите следующий файл: "%SystemDrive%\Programdata\Cloudconnector\credentials. \<CurrentUser\> xml".
    
  3. Запустите консоль PowerShell от учетной записи администратора, а затем запустите "Register-CcAppliance -Local", чтобы повторно ввести пароли, следуя описанию. Введите те же пароли, которые были введены ранее для развертывания Cloud Connector.
    
     **Если вы работаете под управлением Cloud Connector версии 2.0** или более поздней, повторно вы можете повторно использовать все пароли Cloud Connector, выдав следующие действия:
    
  4. Перезапустите сервер хост-сервера.
    
  5. Удалите следующий файл: "%SystemDrive%\Programdata\Cloudconnector\credentials. \<CurrentUser\> xml" .
    
  6. Запустите консоль PowerShell от учетной записи администратора, а затем запустите "Register-CcAppliance -Local", чтобы повторно ввести пароли, следуя описанию. 
    
     Если cached password file was generated with Cloud Connector version 1.4.2, use the VMAdmin password for the CceService password when prompted. Введите тот же пароль, который был введен ранее для развертывания Cloud Connector для всех остальных учетных записей.
    
     Если cached password file was generated with Cloud Connector version 1.4.2 and the DomainAdmin and VMAdmin passwords are different, you must perform the following steps:
    
  7. Выполните Set-CcCredential -AccountType DomainAdmin следующим образом:
    
  8. При запросе учетных данных старой учетной записи введите учетные данные, использованные для пароля CceService.
    
  9. При запросе учетных данных новой учетной записи введите пароль для пароля DomainAdmin, который вы использовали ранее.
    
     Если файл кэширован паролей был создан с помощью Cloud Connector версии 2.0 или более поздней, по умолчанию VmAdmin и DomainAdmin используют тот же пароль, что и CceService. Если вы изменили пароли DomainAdmin и VMAdmin, необходимо выполнить следующие действия:
    
  10. Выполните Set-CcCredential -AccountType DomainAdmin следующим образом:
    
       1. При запросе учетных данных старой учетной записи введите учетные данные, использованные для пароля CceService
    
       2. При запросе учетных данных новой учетной записи введите пароль для пароля DomainAdmin, который вы использовали ранее.
    
  11. Выполните Set-CcCredential -AccountType VmAdmin следующим образом:
    
       1. При запросе учетных данных старой учетной записи введите учетные данные, использованные для пароля CceService
    
       2. При запросе учетных данных новой учетной записи введите пароль для ранее использованного пароля VmAdmin. 
    
- **Проблема: При работе с Cloud Connector версии 2.1 и более поздних версий при запуске Register-CcAppliance или других cmdlets на устройстве вы получаете сообщение об ошибке, например: "For Each-Object : The property 'Common' cannot be found on this object. Убедитесь, что свойство существует. В C:\Program Files\WindowsPowerShell\Modules\CloudConnector\Internal\MtHostCommon.ps1:681 char:14"**
    
    **Решение:** Для Cloud Connector 2.1 и более поздних требуется .NET Framework 4.6.1 или более поздней. Обновите .NET Framework на устройстве до версии 4.6.1 или более поздней, а затем снова запустите их.

- **Проблема: в Cloud Connector Edition 2.1 при запуске Install-CcAppliance вы получаете сообщение об ошибке, например: "Не удалось установить новый экземпляр с ошибкой: не удается установить "State", так как только строки можно использовать в качестве значений для установки свойств XmlNode"**

   **Решение:** В Cloudconnector.ini разделе [Common] добавьте config "State", как по умолчанию: CountryCode=US State=WA City=Redmond

   Строка "Состояние" не обязательно должна иметь значение, но строку "Состояние" нельзя удалить из Cloudconnector.ini файла.

- **Проблема: вы получаете следующее сообщение об ошибке"Dismount-WindowsImage : Dismount-WindowsImage ошибка. Код ошибки = 0xc1550115" при установке или обновлении Cloud Connector Edition.**
    
    **Решение:** Запустите консоль PowerShell от администратора и запустите "DISM -Cleanup-Wim". При этом будут очищены все проблемные изображения. Запустите Install-CcAppliance или дождись автоматического обновления битов.
    
- **Проблема: сбой развертывания первого устройства Cloud Connector в среде ha**
    
    **Решение:** Действия, которые необходимо предпринять, зависят от причины сбой развертывания:
    
  - В случае сбоя первого устройства Cloud Connector и невозможно определить причину сбоя, необходимо снова установить устройство, пока развертывание не будет успешным, а затем установить другие устройства.
    
  - Если сбой первого устройства Cloud Connector возникает из-за незначительных проблем, таких как проблема с внешним сертификатом, вы можете устранить проблему без повторной установки устройства. Затем вы можете использовать удаленную удаленную овецу PowerShell клиента, чтобы отметить развертывание как успешное следующим образом. (Вы также можете использовать следующие действия, если первое развертывание было успешным, но по какой-либо причине Cloud Connector не сообщает об успешном развертывании.)
    
  - Чтобы получить идентификатор (GUID) первого устройства Cloud Connector, запустите Get-CsHybridPSTNAppliance.
    
  - Чтобы пометить устройство как успешно развернуто, выполните Set-CsCceApplianceDeploymentStatus следующим образом:
    
  ```powershell
  Set-CsCceApplianceDeploymentStatus -Identity <Appliance Identity GUID> -Action Deploy -Status Finished
  ```

- **Проблема: необходимо вручную проверить и установить обновления Windows на сервере хост-сервера или виртуальных машинах.**
    
   **Решение:** Мы рекомендуем использовать преимущества автоматических обновлений ОС, предоставляемых Skype для бизнеса Cloud Connector Edition. После регистрации устройства для управления через Интернет и включения автоматического обновления ОС сервер хост-сервера и виртуальные машины будут проверять и устанавливать обновления Windows автоматически в соответствии с настройками времени обновления ОС.
    
   Если вам нужно проверить и установить обновления Windows вручную, выполните действия в этом разделе, применимые к вашему типу развертывания. Следует запланировать одновременное обновление сервера хост-сервера и виртуальных машин, работающих на нем, чтобы свести к минимуму время простоя, необходимое для обновления.
    
   При этом можно использовать сервер cлужбы Windows Server Update Services (WSUS) для предоставления обновлений серверам Cloud Connector. Просто убедитесь, что Обновление Windows не **устанавливается** автоматически.
    
   Сведения об обновлении развертывания Cloud Connector вручную см. в следующем разделе.
    
- **Проблема: при обновлении Cloud Connector до новой сборки, не обновляются их cmdlets.** Иногда это происходит, если окно PowerShell остается открытым при автоматическом обновлении.
    
  **Решение:** Чтобы загрузить обновленные cmdlets, можно сделать один из следующих действий:
    
   - Закроем PowerShell на устройстве Cloud Connector, а затем снова откроете PowerShell.
    
     - Также можно запустить Import-Module CloudConnector -Force. 
 
-   **Проблема: "Термин "Stop-CsWindowsService" не распознается как имя Enter-CcUpdate, функции, файла скрипта или программы.**

    **Решение:** Удалите файл $HOME\AppData\Local\Microsoft\Windows\PowerShell\ModuleAnalysisCache.
PowerShell создает этот файл как кэш командлетов из модулей, которые он находит, чтобы не каждый раз повторно анализировать все модули, так как это может замедлить процесс. Скорее всего, при чтении данных из этого кэша в PowerShell были повреждения файлов, которые вводящие в заблуждение результаты.

-   **Проблема: "Import-Module CloudConnector" генерирует ошибку "Import-Module: указанный модуль "CloudConnector" не загружен, так как в каталоге модулей не найден действительный файл модуля"**

    **Решение.**
    - Проверьте, существует ли модуль CloudConnector в папке c:\Program Files\WindowsPowerShell\Modules
    
    - После проверки того, что модуль CloudConnector существует в этом расположении, переменную среды PSModulePath, в которой хранятся пути к расположениям модулей, можно изменить:
    
     а. Временное изменение: запустите Powershell с учетной записи администратора и запустите следующую команду: $env:PSModulePath = $env:PSModulePath + "; C:\Program Files\WindowsPowerShell\Modules\"
        
     б. Для постоянного изменения запустите PowerShell как администратор и запустите следующие команды по одной: $CurrentValue = [Среда]::GetEnvironmentVariable("PSModulePath", "Machine") SetEnvironmentVariable("PSModulePath", $CurrentValue + "; C:\Program Files\WindowsPowerShell\Modules", "Machine")

    
## <a name="install-windows-updates-manually"></a>Установка обновлений Windows вручную

Если вы не хотите использовать автоматические обновления в своей среде, выполните следующие действия, чтобы вручную проверить и применить обновления Windows. Для проверки и установки обновлений Windows может потребоваться перезапуск сервера. При перезапуске хост-сервера пользователи не смогут использовать Cloud Connector для проведения или получения вызовов. Вы можете вручную проверить и установить обновления, чтобы контролировать время обновления, а затем перезапустить компьютеры по мере необходимости во время, чтобы избежать нарушения работы служб.
  
Чтобы вручную проверить обновления, подключите каждый сервер и откройте панель **управления.** Выберите **"System and Security \> Update"**(Обновление Windows для системы и системы безопасности), а затем управляйте обновлениями и перезапусками сервера в соответствующей среде.
  
- Если на сайте имеется только одно устройство, подключите каждую виртуальную машину и откройте панель **управления.** Выберите **"System and Security \> Update"**(Обновление Windows для системы и системы безопасности), а затем настройте обновления и перезагрузку сервера соответствующим образом.
    
- Если на сайте несколько устройств, обновляемая и перезапускаемая версия экземпляра не будет доступны пользователям во время обновления. Пользователи будут подключаться к другим экземплярам в развертывании до тех пор, пока все виртуальные машины и все службы Skype для бизнеса не будут запускаться на виртуальных машинах после завершения обновления. Чтобы избежать потенциального нарушения работы службы, можно удалить экземпляр из службы ha во время применения обновлений, а затем восстановить его по завершению. Для этого:
    
1. На каждом сервере хост-сервера откройте консоль PowerShell от учетной записи администратора.
    
2. Удалите экземпляр из ha с помощью следующего cmdlet:
    
   ```powershell
   Enter-CcUpdate
   ```

3. 
    
    Выполните действия для одного экземпляра, чтобы вручную применить обновления и перезапустить виртуальную машину.
    
4. Установите для экземпляра обратно ha с помощью следующего cmdlet:
    
   ```powershell
   Exit-CcUpdate
   ```

Для развертывания с несколькими сайтами выполните действия для одного сайта для каждого сайта в развертывании, применяя обновления к одному сайту за раз.
  
## <a name="tips-when-installing-anti-virus-software-on-the-cloud-connector-host-machine"></a>Советы по установке антивирусного программного обеспечения на хост-компьютер Cloud Connector

Если необходимо установить антивирусное ПО на хост-компьютер Cloud Connector, необходимо добавить следующие исключения:
  
- Локальный каталог устройств на каждом компьютере.
    
- Удаленный каталог сайтов на каждом компьютере.
    
- В локальном каталоге сайтов на компьютере размещена общая корневая папка сайта.
    
- %ProgramFiles%\Skype for Business Cloud Connector Edition
    
- %ALLUSERSPROFILE%\CloudConnector
    
- %ProgramFiles%\WindowsPowerShell\Modules\CloudConnector
    
- Процесс Microsoft.Rtc.CCE.ManagementService.exe.
