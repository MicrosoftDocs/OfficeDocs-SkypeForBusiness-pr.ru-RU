---
title: Отслеживание Cloud Connector с помощью Operations Management Suite (OMS)
ms.reviewer: ''
ms.author: crowe
author: CarolynRowe
manager: serdars
ms.date: 1/31/2018
ms.audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.assetid: edf4a04c-d4c9-4c05-aacc-9e084618bb55
description: Прочтите этот раздел, чтобы узнать, как мониторинг соединителя облачных версии 2.1 и последующего развертывания с помощью пакетов управления Microsoft операции (OMS).
ms.openlocfilehash: 2077b5525984cc3d9948e7602036dfbb7f0ee4b7
ms.sourcegitcommit: da8c037bb30abf5d5cf3b60d4b71e3a10e553402
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2019
ms.locfileid: "30886080"
---
# <a name="monitor-cloud-connector-using-operations-management-suite-oms"></a>Отслеживание Cloud Connector с помощью Operations Management Suite (OMS)

Прочтите этот раздел, чтобы узнать, как мониторинг соединителя облачных версии 2.1 и последующего развертывания с помощью пакетов управления Microsoft операции (OMS).

Теперь могут отслеживать соединителя облачных версии 2.1 и последующего развертывания с помощью операции управления Suite (OMS), Microsoft cloud решения по управлению ИТ. Аналитика журнала OMS позволяет вам для мониторинга и анализа доступность и производительность ресурсов, включая физических и виртуальных машин. Дополнительные сведения об OMS и анализа журнала можно [возможности пакет управления Operations (OMS)?](https://docs.microsoft.com/azure/operations-management-suite/operations-management-suite-overview).

В этой статье содержатся следующие разделы.

- Необходимые компоненты

- Настройка соединителя облака для использования OMS

- Настройка OMS

- Анализ оповещений в репозиторий анализа журнала

- Рекомендуемый набор мониторинга

## <a name="prerequisites"></a>Необходимые компоненты

Прежде чем использовать OMS мониторинг развертывания облака соединителя, необходимо будет следующее:

- **Учетная запись Azure и рабочей области OMS.** Если нет учетной записи Azure, необходимо создать новое анализа журнала OMS. Сведения о том, как создать учетную запись Azure и настройка OMS рабочей области в разделе [Начало работы с рабочей области для анализа журнала](https://docs.microsoft.com/azure/log-analytics/log-analytics-get-started).

- **Соединитель облачных 2.1 или более поздняя версия**

- **Новый поиск журнала анализа журнала** является обязательным для мониторинга облачных соединителя. Дополнительные сведения содержатся в разделе [обновление рабочей области анализа журнала Azure новый поиск журнала](https://docs.microsoft.com/azure/log-analytics/log-analytics-log-search-upgrade).

## <a name="configure-cloud-connector-to-use-oms"></a>Настройка соединителя облака для использования OMS

Вам потребуется настроить вашей соединителя облака в локальную среду для использования OMS. Для этого необходимо будет идентификатор рабочей области OMS и ключ, который можно найти с помощью портала OMS следующим образом: параметры--\>подключенных источников--\> серверов Windows:

![Снимок экрана OMS в Cloud Connector](../../media/a4bb0a96-c940-435e-a3f5-5ef3062dea83.png)

Как настроить соединитель облака для использования OMS зависит от используемого сценария.

- **При установке нового устройства соединителя облака или необходимо повторно развернуть устройства**, необходимо выполнить следующие действия перед запуском CcAppliance установки:

1. В файле CloudConnector.ini [распространенных] раздел установите для параметра OMSEnabled значение True.

    Каждый раз соединителя облачных развертывания или обновления, он будет попробуйте установить агента OMS автоматически на виртуальных машинах. Эта функция включена, поэтому агент OMS, способное соединителя облачных автоматического обновления.

2. Чтобы настроить OMS идентификатор и ключ, выполните Set-CcCredential - AccountType OMSWorkspace. 

- **При установке агент OMS на существующего устройства облачных соединителя**, выполните следующие действия:

1. В файле CloudConnector.ini [распространенных] раздел задать OMSEnabled = true. 

2. Выполните импорт CcConfiguration. 

3. Запуск установки CcOMSAgent. 

    > [!NOTE]
    > Если учетные данные OMSWorkspace никогда не были установлены, предлагается для учетных данных при запуске install-CcOMSAgent. 

- **Если вы хотите обновить OMS рабочей области идентификатор или ключ в облаке соединителя устройстве, который уже установлено агент OMS:**

1. Чтобы настроить OMS идентификатор и ключ, выполните Set-CcCredential - AccountType OMSWorkspace. 

2. Чтобы применить обновления, запустите Install CcOMSAgent. 

- **Для всех сценариев убедитесь, что агентам подключенные следующим образом:**

    На портале OMS перейдите в раздел Параметры -\> подключенных источников -\> серверов Windows. Появится список подключенных устройствах. 

## <a name="configure-oms"></a>Настройка OMS

Затем необходимо указать конфигурации OMS с помощью портала OMS. В частности необходимо:

- Укажите сведения о журналы событий и счетчики производительности.

- Создание оповещений. 

### <a name="specify-information-about-event-logs-and-performance-counters"></a>Укажите сведения о журналы событий и счетчики производительности

На портале OMS необходимо указать сведения о журналы событий и счетчики производительности следующим образом:

1. Последовательно выберите пункты Параметры -\>данных -\>журналы событий Windows и добавьте в журналах событий: 

   - Lync Server

   - Приложение

     > [!NOTE]
     > Lync Server необходимо вручную ввести в текстовом поле. Не отображается как параметр в раскрывающемся списке. 

     Для получения дополнительных сведений см [источников данных журнала событий Windows в аналитике журнала](https://docs.microsoft.com/azure/log-analytics/log-analytics-data-sources-windows-events)

2. Последовательно выберите пункты Параметры -\>данных -\> счетчики производительности Windows, и добавьте счетчики производительности для: 

   - На **уровне операционной системы счетчики**. Вы можете добавить счетчики уровня операционной системы, как использования процессора, использование памяти, использование сети, или можно использовать существующие решения, такие как емкости и производительности, сетевого монитора производительности без добавления счетчики явным образом. Независимо от того, как вы решили отслеживать их Корпорация Майкрософт рекомендует наблюдения за эти счетчики операционной системы.

   - **Скайп счетчиков бизнеса**. Существует множество счетчиков, автор Скайп для бизнеса. Вход в систему для любого сервера-посредника и открытие монитора производительности можно найти эти счетчики. Эти счетчики начинаются с «LS:». Корпорация Майкрософт рекомендует запустить с помощью следующих счетчиков емкости по крайней мере и добавить других пользователей, которые могут представлять интерес.

     Всего активных вызовов:

   - LS:MediationServer - входящий Calls(_Total)\- текущей 

   - LS:MediationServer - исходящий Calls(_Total)\- текущей 

     Общее active сервера-посредника вызовов:

   - LS:MediationServer - входящий Calls(_Total)\- активных вызовов сервера-посредника 

   - LS:MediationServer - исходящий Calls(_Total)\- активных вызовов сервера-посредника 

     > [!NOTE]
     > Счетчики производительности необходимо вручную ввести в текстовом поле. Они не отображаются как параметры в раскрывающемся списке. 

     Для получения дополнительных сведений см [Windows и Linux источники данных производительности в аналитике журнала](https://docs.microsoft.com/azure/log-analytics/log-analytics-data-sources-performance-counters)

### <a name="create-alerts"></a>Создание оповещений

Существует два типа оповещения в OMS: число результатов оповещения и уведомления метрики измерения. Дополнительные сведения о создании оповещений см [правила оповещений в аналитике журнала](https://docs.microsoft.com/azure/log-analytics/log-analytics-alerts-creating).

При создании оповещений необходимо учитывать следующее:

- Убедитесь в том, что оповещение число результатов в вариант по умолчанию — это оповещение. 

- Демонстрация запросов требуется, что «Количество результатов» имеет значение, чтобы «больше 0". 

- Рекомендуется установить интервал времени и частоты оповещений до 5 минут. 

- Рекомендуется не включайте «Отмена» оповещения для демонстрации оповещений. 

- В скриптах оповещения, рекомендуется создавать пары оповещения: сообщение об ошибке один и один reset оповещение. Сообщение об ошибке выберите уровень серьезности критическое; для сброса оповещение выберите уровень серьезности информационное.

В следующих разделах описывается создание образца оповещения.

 **Создание оповещения пары: «RTCMEDSRV не работает в серверов-посредников» и «RTCMEDSRV является обратно по запуску в серверов-посредников»**

Для создания этой пары оповещения:

- — Это запрос для сообщение об ошибке:

  ```
  Event | where Computer contains "MediationServer" | where EventLog == "Lync Server" and (EventID == 25002 or EventID == 25003)  | summarize arg_max(TimeGenerated, EventID) by Computer | where EventID == 25003
  ```

    В запросе используется фильтр компьютер, *где компьютер содержит «MediationServer»* . Фильтр выбирает только на компьютере, имя которого содержит строку «MediationServer».

     Будет заменить фильтр фильтра компьютера или просто удалите его. Можно создавать фильтры сложных строки без регулярных выражений. Для получения дополнительных сведений см [операторов строки](https://docs.loganalytics.io/docs/Language-Reference/Scalar-operators/String-operators). Можно также использовать регулярные выражения. Кроме того можно создать группу компьютеров путем сохранения поискового запроса и использование этой группы в качестве фильтра компьютера в запросе оповещения. Для получения дополнительных сведений см. [группы компьютеров в аналитике журнала операций поиска](https://docs.microsoft.com/azure/log-analytics/log-analytics-computer-groups).

    Для каждого компьютера Ошибочный запрос будет получить последние журнала событий для службы начальная RTCMEDSRV службы и остановить. Возвращает один вход, если последний событие события остановки службы; он возвращает nothing, если последний событие — запустить службы. Вкратце запрос возвращает список серверов, RTCMEDSRV остановлена в окне времени. 

- — Это запрос для сброса оповещения:

  ```
  Event | where Computer contains "MediationServer" | where EventLog == "Lync Server" and (EventID == 25002 or EventID == 25003) | summarize arg_max(TimeGenerated, EventID) by Computer  | where EventID == 2500
  ```

    Сброс запросов выполняет точно положительно запроса об ошибках. Для каждого компьютера он будет возвращать один Если последний событий — это служба запуска события; он возвращает nothing, если последний событие — остановить службу.

  **Создание оповещения пары: "слишком много одновременных звонков в серверов-посредников» и «одновременных звонков обычной нагрузки»**

Чтобы создать это предупреждение:

- — Это запрос для сообщение об ошибке:

  ```
  Perf | where Computer contains "MediationServer" | where (ObjectName == "LS:MediationServer - Outbound Calls" or ObjectName == "LS:MediationServer - Inbound Calls") | summarize arg_max(TimeGenerated, CounterValue) by ObjectName, Computer | summarize  TotalCalls = sum(CounterValue) by Computer| where TotalCalls >= 500
  ```

    Для каждого компьютера запрос будет получать последние счетчики для входящих звонков и исходящих вызовов и суммы этих двух значений. Возвращает один вход, если суммарное значение превышает 500; он возвращает nothing, если это не так. Вкратце запрос возвращает список серверов, одновременных звонков слишком большого числа в интервал времени.

- — Это запрос для сброса оповещения:

  ```
  Perf  | where Computer contains "MediationServer" | where (ObjectName == "LS:MediationServer - Outbound Calls" or ObjectName ==  "LS:MediationServer - Inbound Calls") | summarize arg_max(TimeGenerated, CounterValue) by ObjectName, Computer | summarize  TotalCalls = sum(CounterValue) by Computer| where TotalCalls < 500
  ```

    Сброс запросов выполняет точно положительно запроса об ошибках. Для каждого компьютера запрос будет получать последние счетчики для входящих звонков и исходящих вызовов и суммы этих двух значений. Возвращает один журнала, если значение сумма меньше, чем значение 500; в противном случае будет возвращено значение nothing.

  **Создание оповещения: «использование ресурсов ЦП \> 90 или RTCMEDIARELAY остановленной на серверах» оповещения**

Чтобы создать это предупреждение, — это запрос:

```
search *| where Computer contains "MediationServer" | where (Type == "Perf" or Type == "Event") | where ((ObjectName ==  "Processor" and CounterName == "% Processor Time") or EventLog == "Lync Server") | where (CounterValue > 90 or EventID == 22003)
```

Запрос будет возвращать все счетчика использования процессора и события остановки службы из всех компьютеров и прибыли, когда-либо остановлена одного журнала, если либо использования процессора превышает 90% или службы. 

## <a name="analyze-the-alerts-in-your-log-analytics-repository"></a>Анализ оповещений в репозиторий анализа журнала

Для анализа оповещений в репозиторий, использующих решение управления предупреждениями. Для получения дополнительных сведений см [решения по управлению оповещения в пакет управления Operations (OMS)](https://docs.microsoft.com/azure/log-analytics/log-analytics-solution-alert-management)

## <a name="recommended-minimal-monitoring-set"></a>Рекомендуемый минимальный набор мониторинга

Чтобы определить проблемы с журналы событий и счетчики производительности: 

- **Журналы событий.** Для любой проблемы должны быть пара событий с помощью одного набора событий, чтобы указать, что дает сбой, а другое указывает, что все работает хорошо. Для любого заданного периода это последний записанного события, появится сообщение о том, является ли что-то amiss для этого периода времени.

- **Счетчики производительности.** Должна быть пороговое значение для отслеживаемых счетчиков.

В следующей таблице перечислены службы, корпорация Майкрософт рекомендует мониторинга, указав остановка и запуск коды событий:

|Имя службы  <br/> |Роль конечного сервера  <br/> |Остановка событие с кодом  <br/> |Запустите код события  <br/> |
|:-----|:-----|:-----|:-----|
|RTCMEDSRV  <br/> |посредник  <br/> |25003  <br/> |25002  <br/> |
|RTCSRV  <br/> |пограничный сервер  <br/> |12289  <br/> |12288  <br/> |
|RTCMRAUTH  <br/> |пограничный сервер  <br/> |19003  <br/> |19002  <br/> |
|RTCMEDIARELAY  <br/> |пограничный сервер  <br/> |22003  <br/> |22002  <br/> |

В следующей таблице перечислены проблемы сети, корпорация Майкрософт рекомендует мониторинга:


| Имя монитора  <br/>                                        | Роль конечного сервера  <br/> | Идентификатор события выражение успеха  <br/> | Идентификатор события ошибки выражения  <br/> | Пример сбоя  <br/> |
|:-----------------------------------------------------------|:--------------------------|:-----------------------------------|:---------------------------------|:-----------------------|
| Сбой подключения к шлюза сервера-посредника  <br/>    | посредник  <br/>   | 25062                              |                                  | 25002  <br/>           |
| Ошибка завершения вызова сервера-посредника к шлюзу  <br/> | посредник  <br/>   | 25064                              |                                  | 25002  <br/>           |
| Критические проблемы в сети  <br/>                           | пограничный сервер  <br/>        | 14353                              |                                  | 12288  <br/>           |

В следующем списке перечислены счетчики емкости вызовов, которые должны отслеживаться. Эти номера должен быть меньше, 500 для соединителя облачных standard edition; меньше 50 для соединителя облачных минимальные edition.

- LS:MediationServer - входящий Calls(_Total)\- текущей 

- LS:MediationServer - исходящий Calls(_Total)\- текущей 

- LS:MediationServer - входящий Calls(_Total)\- активных вызовов сервера-посредника

- LS:MediationServer - исходящий Calls(_Total)\- активных вызовов сервера-посредника

## <a name="see-also"></a>См. также

Дополнительные сведения о работе с OMS см.:

- [Поиск данных с помощью поисков в журнале в аналитике журнала](https://docs.microsoft.com/azure/log-analytics/log-analytics-log-searches)

- [Справочник по языку Analytics Azure журнала](https://docs.loganalytics.io/docs/Language-Reference)

- [Общее представление о оповещений в аналитике журнала](https://docs.microsoft.com/azure/log-analytics/log-analytics-alerts)

- [Подключения компьютеров Windows к службе анализа журнала в Azure](https://docs.microsoft.com/azure/log-analytics/log-analytics-windows-agents)


