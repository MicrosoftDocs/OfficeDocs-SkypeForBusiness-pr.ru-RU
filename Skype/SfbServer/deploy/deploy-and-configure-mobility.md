---
title: Развертывание и настройка мобильности для Skype для бизнеса Server
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.assetid: 8ec6197a-3d1e-4b42-9465-564044cdab1a
description: В этой статье представлены по шагам по настройке существующей установки Skype для бизнеса Server для использования службы Mobility Service, что позволит мобильным устройствам использовать функции Skype для бизнеса Server Mobility.
ms.openlocfilehash: 420d34dcf1406df776e438e01007770e515c0d4a
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49820899"
---
# <a name="deploy-and-configure-mobility-for-skype-for-business-server"></a>Развертывание и настройка мобильности для Skype для бизнеса Server  
 
В этой статье представлены по шагам по настройке существующей установки Skype для бизнеса Server для использования службы Mobility Service, что позволит мобильным устройствам использовать функции Skype для бизнеса Server Mobility.
  
Просмотрев статью "Планирование мобильности для Skype для бизнеса [Server",](../plan-your-deployment/mobility.md) вы должны быть готовы приступить к приведенной ниже работе по развертыванию mobility в среде Skype для бизнеса Server. Ниже следуют шаги (и мы включаем в эту таблицу список разрешений):
  
|**Этап**|**Разрешения**|
|:-----|:-----|
|[Создание записей DNS](deploy-and-configure-mobility.md#CreateDNSRec) <br/> |Администраторы домена  <br/> DNSAdmins  <br/> |
|[Изменение сертификатов](deploy-and-configure-mobility.md#ModCerts) <br/> |Локальный администратор  <br/> |
|[Настройка обратного прокси-сервера](deploy-and-configure-mobility.md#ConfigRP) <br/> |Локальный администратор  <br/> |
|[Настройка автооружия для мобильной работы с гибридными развертываниями](deploy-and-configure-mobility.md#ConfigAutoD) <br/> |Администраторы домена  <br/> |
|[Тестирование развертывания mobility](deploy-and-configure-mobility.md#TestMobility) <br/> |CsAdministrator  <br/> |
|[Настройка для использования push-уведомлений](deploy-and-configure-mobility.md#ConfigPush) <br/> |RtcUniversalServerAdmins  <br/> |
|[Настройка политики мобильности](deploy-and-configure-mobility.md#ConfigMob) <br/> |CsAdministrator  <br/> |
   
Во всех следующих разделах содержатся действия, предполагая, что вы прочли раздел "Планирование". Если что-то вас запутает, вы можете найти там информацию.

> [!NOTE]
> Поддержка СЛУЖБЫ MCX (Mobility Service) для устаревших мобильных клиентов больше недоступна в Skype для бизнеса Server 2019. Все текущие мобильные клиенты Skype для бизнеса уже используют веб-API объединенных коммуникаций (UCWA) для поддержки обмена мгновенными сообщениями, присутствия и контактов. Пользователям с устаревшими клиентами, использующими MCX, потребуется обновиться до текущего клиента.
  
## <a name="create-dns-records"></a>Создание записей DNS
<a name="CreateDNSRec"> </a>

Возможно, эти записи уже есть в среде Skype для бизнеса Server, но для работы автоотнаружия необходимо создать следующие записи:
  
- Внутренняя запись DNS для поддержки мобильных пользователей, подключающихся из сети организации.
    
- Внешняя (или общедоступный) запись DNS для поддержки мобильных пользователей, подключающихся из-за пределов сети организации.
    
Эти записи могут быть именами A (host) или CNAME (не нужно делать и то, и другое, мы просто включаем все здесь).
  
### <a name="create-an-internal-dns-cname-record"></a>Создание внутренней записи CNAME DNS

1. Войдите на DNS-сервер в своей сети,  который входит в группу администраторов домена или **группу DnsAdmins.**
    
2. Нажмите **кнопку "Пуск"** и  выберите "Администрирование" **(может** потребоваться найти его, если это не выход из меню "Пуск"), а затем щелкните **DNS,** чтобы открыть оснастку администратора DNS.
    
3. In the left-hand pane of the console window, you'll need to go to the domain that's home to your Skype for Business Server's Front End Servers, and expand the **Forward Lookup Zones** there.
    
4. У вас есть время, чтобы узнать, что из следующего у вас есть:
    
   - Любые записи A или AAAA для сервера переднего сервера (стандартного или корпоративного) или пула переднего сервера.
    
   - Все записи A или AAAA для директора или пула директоров (дополнительная конфигурация, которая может быть в развертывании).
    
5. После этого щелкните правой кнопкой мыши имя домена SIP и выберите в меню новый псевдоним **(CNAME).**
    
6. В **текстовом ящике имени** псевдонима введите lyncdiscoverinternal для имени хоста для внутреннего URL-адреса службы автообнаружия.
    
7. В полное доменное имя **(FQDN** для целевого хоста) необходимо ввести полное доменное имя внутренних веб-служб для пула переднего сервера (или отдельного сервера переднего сервера, пула директоров или директора), которое было определено на шаге 4 выше. Нажмите кнопку "ОК" при его вжатии.
    
8. Вам потребуется создать новую запись CNAME автооружия в зоне forward lookup для каждого домена SIP, поддерживаемого в среде Skype для бизнеса Server.
    
### <a name="create-an-external-dns-cname-record"></a>Создание внешней записи CNAME DNS

1. Эти действия являются общими, так как мы не можем сообщить, какой общедоступный поставщик DNS вы можете использовать, но мы по-прежнему хотим помочь вам. Войдите в общедоступный поставщик DNS с помощью учетной записи, которая сможет там делать новые записи DNS.
    
2. На этом этапе уже должен существовать домен SIP для Skype для бизнеса Server. **Разкрой зону "Вперед" для** этого домена SIP или откройте ее другим способом.
    
3. У вас есть время, чтобы узнать, что из следующего у вас есть:
    
   - Любые записи A или AAAA для сервера переднего сервера (стандартного или корпоративного) или пула переднего сервера.
    
   - Все записи A или AAAA для директора или пула директоров (дополнительная конфигурация, которая может быть в развертывании).
    
4. После получения этой информации вы сможете выбрать параметр для создания нового псевдонима **(CNAME).**
    
5. Теперь у вас должна быть возможность ввести имя псевдонима, необходимо ввести здесь lyncdiscover для внешнего URL-адреса службы автоотнаружия.
    
6. Далее должна быть область, которая должна вводиться в качестве **FQDN** для целевого хоста. Это должно быть FQDN для пула переднего сервера (или одного сервера переднего сервера, пула директоров или директора), заданной на шаге 3 выше.
    
7. Вам может потребоваться сохранить здесь или если вам нужно создать дополнительные записи CNAME в зоне forward lookup каждого домена SIP в среде Skype для бизнеса Server, это необходимо сделать, но когда все будет готово, сохраните свою работу.
    
### <a name="create-an-internal-dns-a-record"></a>Создание внутренней записи A DNS

1. Войдите на DNS-сервер в своей сети,  который входит в группу администраторов домена или **группу DnsAdmins.**
    
2. Нажмите **кнопку "Пуск"** и  выберите "Администрирование" **(может** потребоваться найти его, если это не выход из меню "Пуск"), а затем щелкните **DNS,** чтобы открыть оснастку администратора DNS.
    
3. In the left-hand pane of the console window, you'll need to go to the domain that's home to your Skype for Business Server's Front End Servers, and expand the **Forward Lookup Zones** there.
    
4. У вас есть время, чтобы узнать, что из следующего у вас есть:
    
   - Любые записи A или AAAA для сервера переднего сервера (стандартного или корпоративного) или пула переднего сервера.
    
   - Все записи A или AAAA для директора или пула директоров (дополнительная конфигурация, которая может быть в развертывании).
    
5. После этого щелкните правой кнопкой мыши имя домена SIP и выберите в меню новый хост (A или **AAAA).**
    
6. В **текстовом** ящике "Имя" введите lyncdiscoverinternal для имени хоста для внутреннего URL-адреса службы автообнаружия.
    
7. В **текстовом** ящике IP-адреса введите IP-адрес внутренних веб-служб для пула переднего сервера (или одного сервера переднего сервера, пула директоров или директора), который был определен на шаге 4 выше.
    
8. После этого нажмите кнопку **"Добавить хост"** и нажмите кнопку **"ОК".**
    
9. Вам потребуется создать новые записи автооружия A или AAAA в зоне forward lookup для каждого домена SIP, поддерживаемого в среде Skype для бизнеса Server. Для этого повторите шаги с 6 по 8 столько раз, сколько необходимо.
    
10. После этого нажмите кнопку **"Готово".**
    
### <a name="create-an-external-dns-a-record"></a>Создание внешней DNS-записи A

1. Эти действия являются общими, так как мы не можем сообщить, какой общедоступный поставщик DNS вы можете использовать, но мы по-прежнему хотим помочь вам. Войдите в общедоступный поставщик DNS с помощью учетной записи, которая сможет там делать новые записи DNS.
    
2. На этом этапе уже должен существовать домен SIP для Skype для бизнеса Server. **Разкрой зону "Вперед" для** этого домена SIP или откройте ее другим способом.
    
3. У вас есть время, чтобы узнать, что из следующего у вас есть:
    
   - Любые записи A или AAAA для сервера переднего сервера (стандартного или корпоративного) или пула переднего сервера.
    
   - Все записи A или AAAA для директора или пула директоров (дополнительная конфигурация, которая может быть в развертывании).
    
4. После получения этой информации вы сможете выбрать вариант создания нового хоста **A или AAAA.**
    
5. Теперь у вас должна быть возможность ввести **имя,** необходимо ввести здесь lyncdiscover для внешнего URL-адреса службы автонаружия.
    
6. Далее должна быть область для ввода IP-адресов. Это должен быть **IP-адрес** для пула переднего сервера (или одного сервера переднего сервера, пула директоров или директора), который был определен на шаге 3 выше.
    
7. Вам может потребоваться сохранить здесь или если вам нужно создать дополнительные записи A или AAAA в зоне forward lookup каждого домена SIP для вашей среды Skype для бизнеса Server, вы должны сделать это, но когда все будет готово, сохраните свою работу.
    
## <a name="modify-certificates"></a>Изменение сертификатов
<a name="ModCerts"> </a>

Если у вас возникли вопросы о планировании сертификатов, мы задокументировали это в статье "Планирование мобильности [для Skype для бизнеса Server".](../plan-your-deployment/mobility.md) После проверки мы проймем следующие вопросы:
  
- Нужны ли мне новые сертификаты?
    
- Запрос новых сертификатов из вашего ЦС.
    
- Обновление сертификатов на месте с помощью замены с помощью PowerShell.
    
- Проверка сертификатов с помощью оснастки "Сертификаты" в консоли управления (MMC).
    
### <a name="do-i-need-new-certificates"></a>Нужны ли мне новые сертификаты?

1. Во-первых, вам может потребоваться проверить, какие сертификаты находятся на месте и есть ли у них необходимые записи. Для этого необходимо войти в Skype для бизнеса Server с помощью учетной записи локального администратора. Для некоторых из этих действий этой учетной записи также могут потребоваться права на выдачу ЦС.
    
2. Откройте оболочку управления Skype для бизнеса Server (ее можно найти с помощью поиска, если она не закреплена в меню "Пуск" или панели задач).
    
3. Перед добавлением обновленного сертификата необходимо знать, какие сертификаты были назначены. Поэтому введите в команду:
    
   ```powershell
   Get-CsCertificate
   ```

4. Сведения из шага 3 будут уникальными для вас. Чтобы определить, назначен ли вам один сертификат для нескольких вещей или для различных компонентов, которые в них нуждаются, необходимо найти другой сертификат. Параметр **Use** покажет, как используется сертификат, а параметр **Thumbprint** – один или несколько сертификатов.
    
5. Если в разделе "Планирование" мы рекомендуем использовать записи SAN, все будет хорошо. В этом случае вам потребуется запросить новый сертификат или несколько сертификатов (в зависимости от конфигурации) в вашем сертификате.
    
### <a name="request-a-new-certificate-or-certificates-from-your-certificate-authority-ca"></a>Запрос нового сертификата или сертификатов из вашего ЦС

1. Проверив, какие записи SAN у вас есть, вы знаете, что у вас есть один сертификат **(после** проверки с помощью вышеперечисленной проверки) и узнали, что у вас нет всех необходимых записей. В ваш ЦС должен быть сделан новый запрос на сертификат. Откройте Skype для бизнеса Server PowerShell:
    
   - For a missing Autodiscover Service SAN (replacing the -Ca parameter with your own Certificate Authority path):
    
   ```powershell
   Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -AllSipDomain -verbose
   ```

   - Теперь при использовании нескольких доменов SIP нельзя использовать параметр AllSipDomain, как в примере выше. Вместо этого необходимо использовать параметр DomainName. При использовании параметра DomainName необходимо определить FQDN для записей lyncdiscoverinternal и lyncdiscover. Примером может быть (замена параметра -Ca на собственный путь к ЦС):
    
   ```powershell
   Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
   ```

2. Или, проверив, какие записи SAN у вас есть, вы обнаружили, что у вас есть несколько сертификатов, которые не имеют всех необходимых записей.  В ваш ЦС должен быть сделан новый запрос на сертификат. Откройте Skype для бизнеса Server PowerShell:
    
   - For a missing Autodiscover Service SAN (replacing the -Ca parameter with your own Certificate Authority path):
    
   ```powershell
   Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -AllSipDomain -verbose
   ```

   - Теперь при использовании нескольких доменов SIP нельзя использовать параметр AllSipDomain, как в примере выше. Вместо этого необходимо использовать параметр DomainName. При использовании параметра DomainName необходимо определить FQDN для записей lyncdiscoverinternal и lyncdiscover. Примерами может быть (замена параметра -Ca на собственный путь к ЦС):
    
   ```powershell
   Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
   ```

   ```powershell
   Request-CsCertificate -New -Type WebServicesExternal -Ca dc\myca -DomainName "Lyncdiscover.contoso.com, Lyncdiscover.contoso.net" -verbose
   ```

   - После того как ЦС создает новые сертификаты, их необходимо назначить.
    
### <a name="assign-certificates-using-skype-for-business-server-management-shell"></a>Назначение сертификатов с помощью оболочки управления Skype для бизнеса Server

- В зависимости от того, что вы нашли в разделе "Требуются ли новые сертификаты" выше, необходимо выполнить **одно** из следующих запусков.
    
  - Если у вас есть один сертификат для всех (отпечатки идентичны), необходимо выполнить данной действия:
    
  ```powershell
  Set-CsCertificate -Type <certificate(s) from the Use parameter> -Thumbprint <unique identifier>
  ```

  - Если у вас есть разные сертификаты для вещей (отпечатки отличаются), запустите эту экономию:
    
  ```powershell
  Set-CsCertificate -Type Default -Thumbprint <certificate thumbprint>
  Set-CsCertificate -Type WebServicesInternal -Thumbprint <certificate thumbprint>
  Set-CsCertificate -Type WebServicesExternal -Thumbprint <certificate thumbprint>
  ```

### <a name="viewing-certificates-in-the-microsoft-management-console-mmc"></a>Просмотр сертификатов в консоли управления (MMC)

1. Вы можете посмотреть на сертификаты с помощью оснастки "Сертификаты" для MMC. Просто введите MMC в поиск, и она должна всплывать в виде параметра приложения.
    
2. Чтобы добавить оснастку "Сертификаты", необходимо щелкнуть "Файл", а затем добавить или удалить оснастку... (или сочетания клавиш **CTRL+M** также будут работать).  **Сертификаты** можно выбрать в области слева, выбрать его, а затем — учетную запись компьютера во всплывающее окно, а затем **— "Далее".** 
    
3. По-прежнему во всплывающее окно, по всей вероятности, вы делаете это на компьютере, на который находятся сертификаты, которые необходимо посмотреть, поэтому оставьте выбор на локальном компьютере, если это так.  Если вы работаете на удаленном компьютере,  измените кнопку на другой компьютер, а затем  введите его FQDN или используйте кнопку "Обзор" для поиска этого компьютера через AD. После выбора компьютера необходимо нажать кнопку **"Готово",** а затем ОК, чтобы добавить оснастку в MMC. 
    
4. **Разорите раздел** "Сертификаты" на левой области MMC. **Разоберем** также личную папку, а затем выберите **"Сертификаты".** Это позволяет увидеть сертификаты в этом хранилище.
    
5. Необходимо найти сертификат, который требуется просмотреть, щелкните его правой кнопкой мыши и выберите **"Открыть".**
    
    > [!NOTE]
    > Как узнать, что это за сертификат? Это должен быть либо один сертификат, присвоенный для фермы, либо у вас может быть несколько сертификатов для различных функций, таких как default, internal Web Services и т. д. В этом случае может потребоваться просмотр нескольких сертификатов. Несколько сертификатов будут иметь один и тот же отпечаток. 
  
6. После просмотра представления **"Сертификат"** выберите **"Сведения".** Это позволит увидеть имя субъекта сертификата при выборе **субъекта,** а также будут показаны назначенное имя субъекта и связанные свойства.
    
7. Вам также потребуется проверить записи **альтернативного имени** субъекта. Вы найдете один или несколько из следующих ок.
    
   - Имя пула для этого пула или имя одного сервера, если это не пул.
    
   - Имя сервера, для которого назначен сертификат.
    
   - Записи простых URL-адресов, как правило, meet и dialin.
    
   - Внутренние и внешние имена веб-служб (например, webpool01.contoso.net, webpool01.contoso.com), основанные на вариантах, сделанных в построителье топологий и выборе перенастроек веб-служб.
    
   - Если уже назначено, lyncdiscover.\<sipdomain\> и lyncdiscoverinternal.\<sipdomain\> записи.
    
     Вам потребуется проверить несколько сертификатов, если вам назначено несколько сертификатов (см. примечание выше).
    
8. Поэтому, если вы нашли lyncdiscover.\<sipdomain\> и lyncdiscoverinternal.\<sipdomain\> записи, вы уже настроили эту настройку. Можно закрыть MMC.
    
9. Если они не назначены, вам потребуется либо сделать новый запрос сертификата (описанный выше), либо установить их после запроса (для этого рекомендуется использовать powerShell, описанные выше).
    
## <a name="configure-the-reverse-proxy"></a>Настройка обратного прокси-сервера
<a name="ConfigRP"> </a>

Шаги ниже не предназначены для точного следованию. Это потому, что в предыдущих версиях продукта мы походили бы на вас, например, на настройку шлюза управления угрозами (TMG), и если вы не использовали его, вам потребуется разработать собственную версию оттуда.
  
TMG больше не предлагается корпорацией Майкрософт в качестве продукта, и если вам все еще нужно настроить его, вы можете посмотреть на шаги [Lync Server 2013.](https://technet.microsoft.com/library/hh690011%28v=ocs.15%29.aspx) Однако следующая информация должна быть более полезной, даже если мы не можем предоставить конкретные по шагам для каждого обратного прокси-сервера.
  
У нас есть два основных вещи, которые необходимо учитывать:
  
- Будете ли вы делать первоначальный запрос автооружия по протоколу HTTPS (что мы рекомендуем)?
    
  - Если у вас есть правило веб-публикации, его необходимо изменить.
    
  - Если у вас еще нет правила веб-публикации, его необходимо создать.
    
- Если вы делаете исходный запрос автооружия по протоколу HTTP, вам также потребуется создать или изменить это правило.
    
> [!NOTE]
> **Важно!** Значение времени простоя прокси-сервера — это число, которое зависит от развертывания и развертывания. Следует отслеживать развертывание и изменять значение для наилучшего работы клиентов. Вы можете установить значение как низкое, как 200. Если вы поддерживаете мобильные клиенты Lync в своей среде, следует установить значение 960, чтобы разрешить время простоя push-уведомлений из Office 365, время простоя которых составляет 900. Очень вероятно, что вам придется увеличить значение времени отключения, чтобы избежать отключения клиента при слишком низком значении, или уменьшить число, если подключения через прокси-сервер не отключались, но очищались долго после отключения клиента. Единственный точный способ определить соответствующий параметр для этого значения — мониторинг и создание базовых условий для вашей среды.
  
### <a name="modify-the-existing-web-publishing-rule-for-your-external-autodiscover-san-and-url"></a>Изменение существующего правила веб-публикации для внешнего SAN и URL-адреса автооружия

1. Откройте интерфейс обратного прокси-сервера.
    
2. Вам потребуется найти правило веб-публикации и выбрать параметр "Изменить" (он может находиться в меню или вкладке в зависимости от конфигурации обратного прокси-сервера).
    
3. Должна быть область, в которую должно быть вложено правило веб-публикации. Это правило необходимо изменить для входящих сайтов или запросов к сайтам. Вы добавим **новую** запись.
    
4. Введите имя сайта автообнаружния (в качестве примера мы будем  использовать lyncdiscover.contoso.com) и нажмите кнопку "ОК" или "Сохранить" **в** зависимости от формата обратного прокси-сервера.
    
5. Возможно, у вас есть новый сертификат с записью SAN автооружия. Его также необходимо установить и настроить для использования в соответствии с настройками обратного прокси-сервера. Обязательно сохраните все после завершения настройки.
    
6. Если обратный прокси-сервер имеет функцию **Test,** используйте ее, чтобы убедиться, что все работает правильно.
    
7. Теперь вам может потребоваться повторить эти действия, если в вашей среде есть директор или пул директоров (это означает, что у вас есть второе правило).
    
### <a name="create-a-web-publishing-rule-for-the-external-autodiscover-url"></a>Создание правила веб-публикации для внешнего URL-адреса автооружия

1. Откройте интерфейс обратного прокси-сервера.
    
2. Необходимо определить, где в интерфейсе создаются правила веб-публикации,  и выбрать параметр "Создать" или "Создать" (он может находиться в меню или вкладке в зависимости от конфигурации обратного прокси-сервера).  Вы ищете вариант создания нового правила веб-публикации.
    
3. Как правило, необходимо ввести следующие сведения:
    
   - **Name**: the name for your rule
    
   - **Действие правила:** в этом случае  это правило "Разрешить", что-то передается через обратный прокси-сервер.
    
   - Правило **публикации** или выбираемый вариант — один **веб-сайт или под балансировка нагрузки.**
    
   - Это должен быть **SSL для** внешнего доступа, выберите этот параметр.
    
   - Вам потребуется опубликовать путь для внутренней публикации и ввести FQDN для внешних веб-служб в под балансиру нагрузки пула переднего конца (или FQDN под баланситора нагрузки пула директоров, если таковой имеется), например sfb_pool01.contoso.local. 
    
   - В качестве пути для публикации необходимо ввести _, но также необходимо **/\\** переадлить исходный заглавный_заданный_заданный_заголок**.
    
   - Существует возможность для сведений или сведений об общедоступных **или внешних** именах. В этом месте вы сможете ввести:
    
   - **Принимать запросы,** но это должно быть имя домена.
    
   - Введите **имя** **lyncdiscover.** <sipdomain> (это внешний URL-адрес службы автонаружия). Теперь, если вы создаете правило для URL-адреса внешних веб-служб во внешнем пуле, необходимо ввести FQDN для внешних веб-служб в пуле переднего lyncwebextpool01.contoso.com.
    
   - Будет параметр **Path,** и вам потребуется ввести **/\\** _здесь.
    
   - You'll need to select a _ *SSL Listener** with your up-to-date public certificate.
    
   - **Для делегирования** проверки подлинности должно быть установлено отсутствие делегирования, но должна быть разрешена прямая проверка **подлинности** клиента.
    
   - Правило должно быть установлено для **всех пользователей.**
    
   - Это должны быть все сведения, необходимые для создания этого правила и позволяющие продолжить.
    
4. Вам потребуется убедиться, что  исходный заголок хоста переназначен.
    
5. Необходимо **также настроить** порты веб-сервера, вы должны сделать следующее:
    
   - **Перенаправление запросов на ПОРТ HTTP** и номер порта должен быть **8080.**
    
   - **Запросы на перенаправление на SSL-порт,** а номер порта должен быть **4443.**
    
6. Если все настроено, вам потребуется сохранить или применить их, а затем протестировать правило.
    
### <a name="create-a-web-publishing-rule-for-port-80-optional"></a>Создание правила веб-публикации для порта 80 (необязательно)

1. Откройте интерфейс обратного прокси-сервера.
    
2. Необходимо определить, где в интерфейсе создаются правила веб-публикации,  и выбрать параметр "Создать" или "Создать" (он может находиться в меню или вкладке в зависимости от конфигурации обратного прокси-сервера).  Вы ищете вариант создания нового правила веб-публикации.
    
3. Как правило, необходимо ввести следующие сведения:
    
   - **Name**: the name for your rule
    
   - **Действие правила:** в этом случае  это правило "Разрешить", что-то передается через обратный прокси-сервер.
    
   - Правило **публикации** или выбираемый вариант — один **веб-сайт или под балансировка нагрузки.**
    
   - Для подключения к опубликованного веб-серверу или ферме это должно быть не **защищенное подключение.**
    
   - Вам потребуется опубликовать путь для внутренней публикации и ввести FQDN для **VIP-адреса** балансировки нагрузки пула переднего sfb_pool01.contoso.local. 
    
   - В качестве пути для публикации необходимо ввести _, но также необходимо **/\\** переадлить исходный заглавный_заданный_заданный_заголок**.
    
   - Существует возможность для сведений или сведений об общедоступных **или внешних** именах. В этом месте вы сможете ввести:
    
   - **Принимать запросы,** но это должно быть имя домена.
    
   - Введите **имя** **lyncdiscover.** <sipdomain> (это внешний URL-адрес службы автонаружия).
    
   - Будет параметр **Path,** и вам потребуется ввести **/\\** _здесь.
    
   - Вам потребуется выбрать веб-прослушиватель или разрешить обратному прокси-серверу создать его для вас.
    
   - *_Authentication Delegation** should be set to **No delegation**, but direct client authentication **should not** be allowed.
    
   - Правило должно быть установлено для **всех пользователей.**
    
   - Это должны быть все сведения, необходимые для создания этого правила и позволяющие продолжить.
    
4. Необходимо **настроить порты** веб-сервера. Необходимо сделать следующее:
    
   - **Перенаправление запросов на ПОРТ HTTP** и номер порта должен быть **8080.**
    
   - **Запросы на перенаправление на SSL-порт,** а номер порта должен быть **4443.**
    
5. Если все настроено, вам потребуется сохранить или применить их, а затем протестировать правило.
    
## <a name="configure-autodiscover-for-mobility-with-hybrid-deployments"></a>Настройка автооружия для мобильной работы с гибридными развертываниями
<a name="ConfigAutoD"> </a>

Гибридные среды в Skype для бизнеса Server — это среды, которые объединяются в локальной среде и среде O365. Если Skype для бизнеса Server работает в гибридной среде, служба автонаружества должна иметь возможность найти пользователя из любой из этих сред.
  
Чтобы мобильные клиенты обнаруживали, где находится пользователь, необходимо настроить службу автоотнаружия с использованием нового URL-адреса. Ниже описана последовательность действий.
  
1. Откройте Skype для бизнеса Server Management Shell.
    
2. Чтобы получить значение атрибута **ProxyFQDN** для среды Skype для бизнеса Server, запустите следующую среду:
    
   ```powershell
   Get-CsHostingProvider
   ```

3. Затем, еще в окне оболочки, запустите:
    
   ```powershell
   Set-CsHostingProvider -Identity [identity] -AutodiscoverUrl https://webdir.online.lync.com/autodiscover/autodiscoverservice.svc/root
   ```

    Где [идентификатор] заменяется именем домена общего пространства адресов SIP.
    
## <a name="test-your-mobility-deployment"></a>Тестирование развертывания mobility
<a name="TestMobility"> </a>

После развертывания Skype для бизнеса Server Mobility Service и службы автообнаружия Skype для бизнеса Server необходимо выполнить тестовую транзакцию, чтобы убедиться, что развертывание работает правильно. Вы можете запустить **Test-CsUcwaConference,** чтобы проверить возможность двух пользователей создавать, присоединяться и общаться в конференции. Для этого тестирования вам потребуется два пользователя (реальные или тестовые) с полными учетными данными. Эта команда будет работать как для клиентов Skype для бизнеса, так и для клиентов Lync Server 2013.
  
For Lync Server 2010 clients on Skype for Business Server 2015, you'll need to run **Test-CsMcxP2PIM** to test. Ваши пользователи Lync Server 2010 по-прежнему должны быть действительными или предварительно заранее протестировать пользователей, и вам потребуется их пароль.

> [!NOTE]
> Поддержка СЛУЖБЫ MCX (Mobility Service) для устаревших мобильных клиентов больше недоступна в Skype для бизнеса Server 2019. Все текущие мобильные клиенты Skype для бизнеса уже используют веб-API объединенных коммуникаций (UCWA) для поддержки обмена мгновенными сообщениями, присутствия и контактов. Пользователям с устаревшими клиентами, использующими MCX, потребуется обновиться до текущего клиента.
  
### <a name="test-conferencing-for-skype-for-business-and-lync-2013-mobile-clients"></a>Тестирование услуг для мобильных клиентов Skype для бизнеса и Lync 2013

1. Войдите как участник роли **CsAdministrator** на любом компьютере, на котором установлены **оболочка** управления Skype для бизнеса Server и **Ocscore.**
    
2. Запустите **skype для бизнеса Server Management Shell** (вы можете ввести имя в поиске или перейти во все программы и выбрать его). 
    
3. В командной строке введите:
    
   ```powershell
   Test-CsUcwaConference -TargetFqdn <FQDN of Front End pool> -Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID> -OrganizerSipAddress sip:<SIP address of test user 1> -OrganizerCredential <test user 1 credentials> -ParticipantSipAddress sip:<SIP address of test user 2> -ParticipantCredential <test user 2 credentials> -v
   ```

   Кроме того, можно установить учетные данные в сценарии и передать их в тестовый cmdlet. Ниже приведен пример этого.
    
   ```powershell
   $passwd1 = ConvertTo-SecureString "Password01" -AsPlainText -Force
   $passwd2 = ConvertTo-SecureString "Password02" -AsPlainText -Force
   $testuser1 = New-Object Management.Automation.PSCredential("contoso\UserName1", $passwd1)
   $testuser2 = New-Object Management.Automation.PSCredential("contoso\UserName2", $passwd2)
   Test-CsUcwaConference -TargetFqdn pool01.contoso.com -Authentication Negotiate -OrganizerSipAddress sip:UserName1@contoso.com -OrganizerCredential $testuser1 -ParticipantSipAddress sip:UserName2@contoso.com -ParticipantCredential $testuser2 -v
   ```

### <a name="test-conferencing-for-lync-2010-mobile-clients"></a>Тестирование для мобильных клиентов Lync 2010

> [!NOTE]
> Поддержка СЛУЖБЫ MCX (Mobility Service) для устаревших мобильных клиентов больше недоступна в Skype для бизнеса Server 2019. Все текущие мобильные клиенты Skype для бизнеса уже используют веб-API объединенных коммуникаций (UCWA) для поддержки обмена мгновенными сообщениями, присутствия и контактов. Пользователям с устаревшими клиентами, использующими MCX, потребуется обновиться до текущего клиента.

1. Войдите в систему с ролью **CsAdministrator** на любом компьютере, на котором установлены **skype для бизнеса Server Management Shell** и **Ocscore.**
    
2. Запустите **skype для бизнеса Server Management Shell** (вы можете ввести имя в поиске или перейти во все программы и выбрать его). 
    
3. В командной строке введите:
    
   ```powershell
   Test-CsMcxP2PIM -TargetFqdn <FQDN of Front End pool> -Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID> -SenderSipAddress sip:<SIP address of test user 1> -SenderCredential <test user 1 credentials> -ReceiverSipAddress sip:<SIP address of test user 2> -ReceiverCredential <test user 2 credentials> -v
   ```

   Кроме того, можно установить учетные данные в сценарии и передать их в тестовый cmdlet. Ниже приведен пример этого.
    
   ```powershell
   $passwd1 = ConvertTo-SecureString "Password01" -AsPlainText -Force
   $passwd2 = ConvertTo-SecureString "Password02" -AsPlainText -Force
   $tuc1 = New-Object Management.Automation.PSCredential("contoso\UserName1", $passwd1)
   $tuc2 = New-Object Management.Automation.PSCredential("contoso\UserName2", $passwd2)
   Test-CsMcxP2PIM -TargetFqdn pool01.contoso.com -Authentication Negotiate -SenderSipAddress sip:UserName1@contoso.com -SenderCredential $tuc1 -ReceiverSipAddress sip:UserName2@contoso.com -ReceiverCredential $tuc2 -v
   ```

Для дальнейшего просмотра процедур команд можно проверить [Test-CsUcwaConference](https://docs.microsoft.com/powershell/module/skype/test-csucwaconference?view=skype-ps) и [Test-CsMcxP2PIM.](https://docs.microsoft.com/powershell/module/skype/test-csmcxp2pim?view=skype-ps)
  
## <a name="configure-for-push-notifications"></a>Настройка для использования push-уведомлений
<a name="ConfigPush"> </a>

Push-уведомления в виде индикаторов событий, значков или оповещений можно отправить на мобильное устройство, даже если приложение Skype или Lync неактивно. Но что такое push-уведомления? Это оповещения о событиях, такие как новое или пропущенное приглашение для мгновенных сообщения, или для полученной голосовой почты. Служба Skype для бизнеса Server Mobility отправляет эти уведомления облачной службе push-уведомлений Skype для бизнеса Server, которая затем отправляет уведомления в службу push-уведомлений Майкрософт (MSNS) для пользователей Windows Phone.
  
Эта функция не изменилась по сравнению с Lync Server 2013, но если у вас есть Skype для бизнеса Server, необходимо сделать следующее:
  
- Для skype для бизнеса Server Edge Server добавьте нового поставщика услуг размещения, Microsoft Skype для бизнеса Online, а затем настроите федерацию поставщика услуг размещения между вашей организацией и Skype для бизнеса Online.
    
- Чтобы включить push-уведомления, запустим для этого **cmdlet Set-CsPushNotificationConfiguration.** По умолчанию push-уведомления отключены.
    
- Проверьте конфигурацию федерации и push-уведомления.
    
### <a name="configure-your-skype-for-business-edge-server-for-push-notifications"></a>Настройка skype для бизнеса Edge Server для push-уведомлений

1. Войдите с учетной записью, которая является членом роли **CsAdministrator,** на компьютер, на котором установлены Skype для бизнеса **Server Management Shell** и **Ocscore.**
    
2. Запустите **оболочку управления Skype для бизнеса Server.**
    
3. Добавление поставщика услуг размещения Skype для бизнеса Server через Интернет.
    
   ```powershell
   New-CsHostingProvider -Identity <unique identifier for hosting provider> -Enabled $True -ProxyFQDN <FQDN for the Access Server used by the hosting provider> -VerificationLevel UseSourceVerification
   ```

   Например:
    
   ```powershell
   New-CsHostingProvider -Identity "SkypeOnline" -Enabled $True -ProxyFQDN "sipfed.online.lync.com" -VerificationLevel UseSourceVerification
   ```

    > [!NOTE]
    > Не может быть более одного отношения федерации с одним поставщиком услуг размещения. Поэтому, если вы уже настроили поставщика услуг размещения, который имеет отношение федерации с sipfed.online.lync.com, не добавляйте для него другого поставщика услуг размещения, даже если идентификатор поставщика услуг размещения не является SkypeOnline. 
  
4. Настройка федерации поставщика услуг размещения между организацией и службой push-уведомлений в Skype для бизнеса Online. В командной строке введите:
    
   ```powershell
    New-CsAllowedDomain -Identity "push.lync.com"
   ```

### <a name="enable-push-notifications"></a>Включить push-уведомления

1. Войдите с учетной записью, которая является членом роли **CsAdministrator,** на компьютер, на котором установлены Skype для бизнеса **Server Management Shell** и **Ocscore.**
    
2. Запустите **оболочку управления Skype для бизнеса Server.**
    
3. В включить push-уведомления:
    
   ```powershell
   Set-CsPushNotificationConfiguration -EnableMicrosoftPushNotificationService $True
   ```

4. Включить федерацию:
     
   ```powershell
   Set-CsAccessEdgeConfiguration -AllowFederatedUsers $True
   ```

### <a name="test-federation-and-push-notifications"></a>Проверка федерации и push-уведомлений

1. Войдите с учетной записью, которая является членом роли **CsAdministrator,** на компьютер, на котором установлены Skype для бизнеса **Server Management Shell** и **Ocscore.**
    
2. Запустите **оболочку управления Skype для бизнеса Server.**
    
3. Проверьте конфигурацию федерации:
    
   ```powershell
   Test-CsFederatedPartner -TargetFqdn <FQDN of Access Edge server used for federated SIP traffic> -Domain <FQDN of federated domain> -ProxyFqdn <FQDN of the Access Edge server used by the federated organization>
   ```

    Например:
    
   ```powershell
   Test-CsFederatedPartner -TargetFqdn accessproxy.contoso.com -Domain push.lync.com -ProxyFqdn sipfed.online.lync.com
   ```

4. Протестировать push-уведомления:
    
   ```powershell
   Test-CsMcxPushNotification -AccessEdgeFqdn <Access Edge service FQDN>
   ```

    Например:
    
   ```powershell
   Test-CsMcxPushNotification -AccessEdgeFqdn accessproxy.contoso.com
   ```

## <a name="configure-mobility-policy"></a>Настройка политики мобильности
<a name="ConfigMob"> </a>

С помощью Skype для бизнеса Server вы можете определить, кто может использовать службу Mobility Service, Call via Work, voIP или видеосвязь, а также будет ли требоваться Wi-Fi для VoIP или видео. Звонок с помощью работы позволяет мобильному пользователю использовать свой рабочий номер телефона вместо номера мобильного телефона при размещении и приеме звонков. Пользователь на другом конце линии не увидит номер мобильного пользователя на мобильном телефоне, и это позволяет этому мобильному пользователю избежать расходов на исходяющие звонки. Когда voIP и видео настроены, пользователи могут принимать и делать voIP-звонки и видео. Параметры использования Wi-Fi определяют, должно ли мобильное устройство пользователя использовать сеть Wi-Fi через сеть передачи данных.
  
Мобильные устройства, функции "Позвонить с работы", а также функции VoIP и видео включены по умолчанию. Параметр, требуя wiFi для VoIP и видео, отключен. Администратор может изменить его глобально, по сайту или по пользователю.
  
Чтобы иметь возможность использовать функции мобильности и функции "Позвонить с работы", пользователям необходимо:
  
- Включено для Skype для бизнеса Server
    
- Включено для Корпоративная голосовая связь.
    
- Назначена политика мобильности, для параметра **EnableMobility** **установлено** true.
    
Чтобы пользователи могли использовать "Позвонить с работы", им также потребуется:
  
- Назначена политика голосовой связи с выбранным параметром **"Включить** одновременные звонки на телефоны".
    
- Назначена политика мобильности, для **политики EnableOutsideVoice установлено** **true.**
    
> [!NOTE]
> Пользователи, не включенные в Корпоративная голосовая связь, могут использовать свои мобильные устройства для звонков по Skype по VoIP или присоединяться к конференциям с помощью ссылки "Щелкните, чтобы присоединиться" на мобильных устройствах, если для политики голосовой связи, с которыми они связаны, установлены соответствующие параметры. Дополнительные подробности в разделе "ПЛАНИРОВАНИЕ". 
  
### <a name="modify-global-mobility-policy"></a>Изменение глобальной политики мобильности

1. Войдите с учетной записью, которая является членом роли **CsAdministrator,** на компьютер, на котором установлены Skype для бизнеса **Server Management Shell** и **Ocscore.**
    
2. Запустите **оболочку управления Skype для бизнеса Server.**
    
3. Отключите доступ к мобильности и вызову с помощью work глобально, введя:
    
   ```powershell
   Set-CsMobilityPolicy -EnableMobility $False -EnableOutsideVoice $False
   ```

    > [!NOTE]
    > Вы можете отключить "Позвонить с работы", не отключая доступ к мобильной работе. Но вы не можете отключить мобильность, не отключив также "Позвонить с работы". 
  
    Дополнительные сведения можно узнать в [set-CsMobilityPolicy.](https://docs.microsoft.com/powershell/module/skype/set-csmobilitypolicy?view=skype-ps)
    
### <a name="modify-mobility-policy-by-site"></a>Изменение политики мобильности по сайту

1. Войдите с учетной записью, которая является членом роли **CsAdministrator,** на компьютер, на котором установлены Skype для бизнеса **Server Management Shell** и **Ocscore.**
    
2. Запустите **оболочку управления Skype для бизнеса Server.**
    
3. Вы можете создать политику на уровне сайта, отключить VoIP и видеосвязь, включить "Требовать Wi-Fi для IP-аудио" и "Требовать Wi-Fi для IP-видео по сайту". Тип:
    
   ```powershell
   New-CsMobilityPolicy -Identity site:<site identifier> -EnableIPAudioVideo $false -RequireWiFiForIPAudio $True -RequireWiFiforIPVideo $True
   ```

    Подробнее: [New-CsMobilityPolicy.](https://docs.microsoft.com/powershell/module/skype/new-csmobilitypolicy?view=skype-ps)
    
### <a name="modify-mobility-policy-by-user"></a>Изменение политики мобильности для пользователя

1. Войдите с учетной записью, которая является членом роли **CsAdministrator,** на компьютер, на котором установлены Skype для бизнеса **Server Management Shell** и **Ocscore.**
    
2. Запустите **оболочку управления Skype для бизнеса Server.**
    
3. Создайте политики мобильности на уровне пользователя и отключите мобильность и звонок с помощью работы для пользователей. Тип:
    
   ```powershell
   New-CsMobilityPolicy -Identity <policy name> -EnableMobility $False -EnableOutsideVoice $False
   Grant-CsMobilityPolicy -Identity <user identifier> -PolicyName <policy name>
   ```

    Дополнительный пример с примерами данных:
    
   ```powershell
   New-CsMobilityPolicy "tag:disableOutsideVoice" -EnableOutsideVoice $False
   Grant-CsMobilityPolicy -Identity MobileUser1@contoso.com -PolicyName tag:disableOutsideVoice
   ```

    > [!NOTE]
    > Вы можете отключить "Позвонить с работы", не отключая доступ к мобильной работе. Но вы не можете отключить мобильность, не отключив также "Позвонить с работы". 
  

