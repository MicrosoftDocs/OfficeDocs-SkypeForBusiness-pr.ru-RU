---
title: Развертывание и настройка мобильности для Skype для бизнеса Server
ms.reviewer: ''
ms.author: serdars
author: SerdarSoysal
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.assetid: 8ec6197a-3d1e-4b42-9465-564044cdab1a
description: В этой статье вы сможете настроить существующую установку Skype для бизнеса Server для использования службы Mobility, что позволит мобильным устройствам использовать возможности Skype для бизнеса Server Mobility.
ms.openlocfilehash: b6d99c18f17158ae8b999320b767b1cc07d44dd5
ms.sourcegitcommit: 59d209ed669c13807e38196dd2a2c0a4127d3621
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2022
ms.locfileid: "62397499"
---
# <a name="deploy-and-configure-mobility-for-skype-for-business-server"></a>Развертывание и настройка мобильности для Skype для бизнеса Server  
 
В этой статье вы сможете настроить существующую установку Skype для бизнеса Server для использования службы Mobility, что позволит мобильным устройствам использовать возможности Skype для бизнеса Server Mobility.
  
Просмотрев статью Plan [for Mobility for Skype для бизнеса Server](../plan-your-deployment/mobility.md), вы должны быть готовы приступить к приведенной ниже статье, чтобы развернуть Mobility в Skype для бизнеса Server среду. Действия следующие (и мы включаем в эту таблицу список разрешений):
  
|**Этап**|**Разрешения**|
|:-----|:-----|
|[Создание записей DNS](deploy-and-configure-mobility.md#CreateDNSRec) <br/> |Администраторы домена  <br/> DNSAdmins  <br/> |
|[Изменение сертификатов](deploy-and-configure-mobility.md#ModCerts) <br/> |Локальный администратор  <br/> |
|[Настройка обратного прокси-сервера](deploy-and-configure-mobility.md#ConfigRP) <br/> |Локальный администратор  <br/> |
|[Настройка автооткрытия для мобильности с помощью гибридных развертывания](deploy-and-configure-mobility.md#ConfigAutoD) <br/> |Администраторы домена  <br/> |
|[Тестирование развертывания мобильности](deploy-and-configure-mobility.md#TestMobility) <br/> |CsAdministrator  <br/> |
|[Настройка для использования push-уведомлений](deploy-and-configure-mobility.md#ConfigPush) <br/> |RtcUniversalServerAdmins  <br/> |
|[Настройка политики мобильности](deploy-and-configure-mobility.md#ConfigMob) <br/> |CsAdministrator  <br/> |
   
Во всех следующих разделах содержатся действия, которые предполагают, что вы читали тему Планирования. Если что-то вас сбивает с толку, не стесняйся проверять сведения.

> [!NOTE]
> Поддержка mcX (Mobility Service) для устаревших мобильных клиентов больше недоступна в Skype для бизнеса Server 2019 г. Все современные Skype для бизнеса мобильные клиенты уже используют веб-API единой связи (UCWA) для поддержки обмена мгновенными сообщениями,присутствия и контактов. Пользователям с устаревшими клиентами, использующими MCX, потребуется обновиться до текущего клиента.
  
## <a name="create-dns-records"></a>Создание записей DNS
<a name="CreateDNSRec"> </a>

Возможно, они уже есть в Skype для бизнеса Server среды, но для работы с автооткрытием необходимо создать следующие записи:
  
- Внутренняя запись DNS для поддержки мобильных пользователей, подключающихся из сети организации.
    
- Внешняя (или публичная) запись DNS для поддержки мобильных пользователей, подключающихся за пределами сети организации.
    
Эти записи могут быть именами A (host) или CNAME (вам не нужно делать обе записи, мы просто включаем шаги для всего здесь).
  
### <a name="create-an-internal-dns-cname-record"></a>Создание внутренней записи CNAME DNS

1. Войдите на DNS-сервер в вашей сети, который является членом группы **администраторов** домена или **группы DnsAdmins** .
    
2. Нажмите **кнопку** Начните, выберите административные **средства (вам** может потребоваться его поиск, если это не вариант с меню ), а затем нажмите **DNS**, чтобы открыть административную оснастку DNS.
    
3. В левом окне консоли необходимо перейти к домену, на который Skype для бизнеса Server серверы переднего входа, и расширить зоны передовой смотровой зоны.
    
4. У вас есть момент, чтобы узнать, какой из следующих ниже.
    
   - Любые записи хостов A или AAAA для переднего сервера (стандартный или Enterprise) или пула переднего конца (s).
    
   - Любые записи хостов A или AAAA для пула директоров или директоров (необязательная конфигурация, которая может иметься в развертывании).
    
5. После этого щелкните правой кнопкой мыши доменное имя SIP и выберите **New Alias (CNAME)** из меню.
    
6. В **текстовом ящике имени Alias** введите lyncdiscoverinternal для имени хозяина, для внутреннего URL-адреса службы автообнаружия.
    
7. В полноквалифицированном доменном имени **(FQDN** для целевого хоста) необходимо ввести или просмотреть внутренний FQDN веб-служб для вашего пула переднего конца (или одного переднего сервера, пула директоров или директора), идентифицированного на шаге 4 выше. Нажмите кнопку ОК, когда она будет введена.
    
8. Для каждого домена SIP, поддерживаемого в Skype для бизнеса Server среде, необходимо создать новую запись CNAME автооткрытия в зоне передающегося смотра.
    
### <a name="create-an-external-dns-cname-record"></a>Создание внешней записи CNAME DNS

1. Эти действия являются общими, так как мы не можем сказать, какой общедоступный поставщик DNS вы можете использовать, но мы по-прежнему хотим помочь вам. Войдите в общедоступный поставщик DNS с учетной записью, которая сможет делать там новые записи DNS.
    
2. На данный момент домен SIP уже должен существовать там для Skype для бизнеса Server. **Расширь зону forward Lookup** для этого домена SIP или откройте его иначе.
    
3. У вас есть момент, чтобы узнать, какой из следующих ниже.
    
   - Любые записи хостов A или AAAA для переднего сервера (стандартный или Enterprise) или пула переднего конца (s).
    
   - Любые записи хостов A или AAAA для пула директоров или директоров (необязательная конфигурация, которая может иметься в развертывании).
    
4. После получения этой информации вы сможете выбрать вариант создания нового псевдонима **(CNAME)**.
    
5. Теперь вы должны иметь возможность ввести имя **псевдонима**, необходимо ввести lyncdiscover здесь для внешнего URL-адреса службы автооткрытия.
    
6. Далее должна быть область для входа в **FQDN** для целевого хоста, это должен быть FQDN для вашего пула переднего конца (или одного переднего end Server, или пула директора или директора), определенного на шаге 3 выше.
    
7. Вам может потребоваться сохранить здесь, или если вам нужно создать дополнительные записи CNAME в зоне смотра вперед каждого домена SIP в вашей Skype для бизнеса Server среде, вы должны сделать это, но как только вы будете готовы, сохраните свою работу.
    
### <a name="create-an-internal-dns-a-record"></a>Создание внутренней записи DNS A

1. Войдите на DNS-сервер в вашей сети, который является членом группы **администраторов** домена или **группы DnsAdmins** .
    
2. Нажмите **кнопку** Начните, выберите административные **средства (вам** может потребоваться его поиск, если это не вариант с меню ), а затем нажмите **DNS**, чтобы открыть административную оснастку DNS.
    
3. В левом окне консоли необходимо перейти к домену, на который Skype для бизнеса Server серверы переднего входа, и расширить зоны передовой смотровой зоны.
    
4. У вас есть момент, чтобы узнать, какой из следующих ниже.
    
   - Любые записи хостов A или AAAA для переднего сервера (стандартный или Enterprise) или пула переднего конца (s).
    
   - Любые записи хостов A или AAAA для пула директоров или директоров (необязательная конфигурация, которая может иметься в развертывании).
    
5. После этого щелкните правой кнопкой мыши доменное имя SIP и выберите новый хост **(A или AAAA)** из меню.
    
6. В **текстовом** ящике Имя введите lyncdiscoverinternal для вашего имени хост-сайта, для внутреннего URL-адреса службы автообнаружа.
    
7. В **текстовом ящике IP-адреса** введите внутренний IP-адрес веб-служб для переднего пула (или одного переднего сервера, пула директора или директора), который был определен на шаге 4 выше.
    
8. После этого щелкните **Добавить хост** и нажмите **кнопку ОК**.
    
9. Для каждого домена SIP, поддерживаемого в среде Skype для бизнеса Server, необходимо создать новые записи автооткрывающего или AAAA. Для этого повторите действия в 6-8 раз больше, чем необходимо.
    
10. Когда вы закончили, нажмите кнопку **Готово**.
    
### <a name="create-an-external-dns-a-record"></a>Создание внешней записи DNS A

1. Эти действия являются общими, так как мы не можем сказать, какой общедоступный поставщик DNS вы можете использовать, но мы по-прежнему хотим помочь вам. Войдите в общедоступный поставщик DNS с учетной записью, которая сможет делать там новые записи DNS.
    
2. На данный момент домен SIP уже должен существовать там для Skype для бизнеса Server. **Расширь зону forward Lookup** для этого домена SIP или откройте его иначе.
    
3. У вас есть момент, чтобы узнать, какой из следующих ниже.
    
   - Любые записи хостов A или AAAA для переднего сервера (стандартный или Enterprise) или пула переднего конца (s).
    
   - Любые записи хостов A или AAAA для пула директоров или директоров (необязательная конфигурация, которая может иметься в развертывании).
    
4. После получения этой информации вы сможете выбрать вариант создания нового хоста **A или AAAA**.
    
5. Теперь вы должны иметь возможность ввести **имя**, необходимо ввести lyncdiscover здесь для внешнего URL-адреса службы автооткрытия.
    
6. Далее должна быть область, вступив в **IP-адреса**, это должен быть IP-адрес для вашего пула переднего конца (или одного переднего сервера, пула директора или директора), идентифицированного на шаге 3 выше.
    
7. Вам может потребоваться сохранить здесь, или если вам необходимо создать дополнительные записи A или AAAA в зоне передовой проверки каждого домена SIP для вашей Skype для бизнеса Server среды, вы должны сделать это, но как только вы будете готовы, сохраните свою работу.
    
## <a name="modify-certificates"></a>Изменение сертификатов
<a name="ModCerts"> </a>

Если у вас есть вопросы по планированию вокруг сертификатов, мы задокументировали это в статье [Plan for Mobility for Skype для бизнеса Server](../plan-your-deployment/mobility.md). После того, как вы рассмотрите этот вопрос, мы пройдите по следующим ниже.
  
- Нужны ли мне новые сертификаты?
    
- Запрос новых сертификатов в Вашем органе сертификации (CA).
    
- Обновление сертификатов на месте с помощью замены с помощью PowerShell.
    
- Проверка сертификатов с помощью snapin сертификатов в консоли управления Майкрософт (MMC).
    
### <a name="do-i-need-new-certificates"></a>Нужны ли мне новые сертификаты?

1. Во-первых, может потребоваться проверить и узнать, какие сертификаты находятся на месте, и есть ли у них необходимые записи. Для этого необходимо войти в Skype для бизнеса Server с учетной записью местного администратора. Эта учетная запись может также иметь права на выдачу сертификата (CA), для некоторых из этих действий.
    
2. Откройте оболочку Skype для бизнеса Server управления (поиск можно найти, если его не прикрепить к меню  или панели задач).
    
3. Необходимо знать, какие сертификаты были назначены перед добавлением обновленного сертификата. Поэтому в команду введите:
    
   ```powershell
   Get-CsCertificate
   ```

4. Сведения из шага 3 будут уникальными для вас. Чтобы определить, есть ли у вас один сертификат, который назначен для нескольких вещей, или вам назначен другой сертификат для различных компонентов, которые в них нуждаются. Параметр **Use** расскажет вам, как используется сертификат, а параметр **Thumbprint** покажет, является ли он все тем же сертификатом или несколькими сертификатами.
    
5. Если у вас есть записи SAN, рекомендуемые в разделе Планирование, вы хороши. Если нет, вам потребуется запросить новый сертификат или несколько сертификатов (в зависимости от конфигурации) в вашем органе сертификации.
    
### <a name="request-a-new-certificate-or-certificates-from-your-certificate-authority-ca"></a>Запрос нового сертификата или сертификатов в вашем органе сертификации (CA)

1. После проверки, чтобы узнать, какие записи san у вас есть, вы знаете, что у вас есть один **сертификат (после** проверки с помощью шагов выше), и вы узнали, что у вас нет всех записей, которые вам нужно. Необходимо сделать новый запрос сертификата в ЦС. Откройте Skype для бизнеса Server PowerShell:
    
   - Для отсутствующих служб автооткрытия SAN (замена параметра -Ca на собственный путь сертификации).
    
   ```powershell
   Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -AllSipDomain -verbose
   ```

   - Теперь, если у вас несколько доменов SIP, вы не можете использовать параметр AllSipDomain, как в примере выше. Вместо этого необходимо использовать параметр DomainName. При использовании параметра DomainName необходимо определить FQDN для записей lyncdiscoverinternal и lyncdiscover. Примером может быть (замена параметра -Ca на собственный путь сертификации):
    
   ```powershell
   Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
   ```

2. Или, после проверки, чтобы узнать, какие записи SAN у вас есть, вы обнаружили,  что у вас есть несколько сертификатов, которые не имеют всех записей, которые вам нужно. Необходимо сделать новый запрос сертификата в ЦС. Откройте Skype для бизнеса Server PowerShell:
    
   - Для отсутствующих служб автооткрытия SAN (замена параметра -Ca на собственный путь сертификации).
    
   ```powershell
   Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -AllSipDomain -verbose
   ```

   - Теперь, если у вас несколько доменов SIP, вы не можете использовать параметр AllSipDomain, как в примере выше. Вместо этого необходимо использовать параметр DomainName. При использовании параметра DomainName необходимо определить FQDN для записей lyncdiscoverinternal и lyncdiscover. Примерами может быть (замена параметра -Ca на собственный путь сертификации).
    
   ```powershell
   Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
   ```

   ```powershell
   Request-CsCertificate -New -Type WebServicesExternal -Ca dc\myca -DomainName "Lyncdiscover.contoso.com, Lyncdiscover.contoso.net" -verbose
   ```

   - После того как новые сертификаты будут созданы ЦС, вам потребуется назначить их.
    
### <a name="assign-certificates-using-skype-for-business-server-management-shell"></a>Назначение сертификатов с Skype для бизнеса Server управленческой оболочки

- В зависимости от того, что вы нашли в разделе Do I need new certifications above, необходимо выполнить **один из** следующих разделов.
    
  - Если у вас есть один сертификат для всего (отпечатки пальцев идентичны), необходимо выполнить это:
    
  ```powershell
  Set-CsCertificate -Type <certificate(s) from the Use parameter> -Thumbprint <unique identifier>
  ```

  - Если у вас есть разные сертификаты для вещей (отпечатки пальцев все разные), запустите это вместо этого:
    
  ```powershell
  Set-CsCertificate -Type Default -Thumbprint <certificate thumbprint>
  Set-CsCertificate -Type WebServicesInternal -Thumbprint <certificate thumbprint>
  Set-CsCertificate -Type WebServicesExternal -Thumbprint <certificate thumbprint>
  ```

### <a name="viewing-certificates-in-the-microsoft-management-console-mmc"></a>Просмотр сертификатов в консоли управления Майкрософт (MMC)

1. У вас есть возможность посмотреть на сертификаты с помощью оснастки Сертификаты для MMC. Просто введите MMC в поиск, и он должен всплывать в качестве параметра приложения,.
    
2. Чтобы добавить оснастку Сертификаты, необходимо нажать **файл, а** затем добавить или удалить клавишу **Snap-In...** (или клавиша **ярлыка Ctrl+M** также будет работать). **Сертификаты** будут параметром в левой области, выберите его и затем учетную запись компьютера в  всплывающее окно, а затем **Далее**.
    
3. По-прежнему в всплывающее окно, по всей вероятности, вы делаете это на компьютере, где находятся сертификаты, которые необходимо посмотреть, поэтому оставьте выбор на локальном  компьютере, если это так. Если вы работаете на удаленном компьютере, измените кнопку радио  на другой компьютер, а затем введите FQDN компьютера или используйте кнопку **Просмотр** для поиска этого компьютера через AD. После выбора компьютера необходимо нажать кнопку **Готово**, когда она будет готова, а затем ОК, чтобы добавить привязку к MMC.
    
4. **Расширь** раздел Сертификаты на левой области MMC. Также **разложите папку Personal** , а затем выберите **сертификаты**. Это позволяет увидеть сертификаты в этом магазине.
    
5. Необходимо найти нужный сертификат, щелкнуть правой кнопкой мыши и выбрать **Open**.
    
    > [!NOTE]
    > Как узнать, что это за сертификат? Это должен быть либо единственный сертификат, присвоенный всем для вашей фермы, либо у вас может быть несколько сертификатов для различных вещей, таких как Default, Внутренние веб-службы и т.д., в этом случае вам может потребоваться посмотреть несколько сертификатов. Несколько сертификатов будут иметь один и тот же отпечатки пальцев. 
  
6. После того как вы добрались до представления **сертификата** , выберите **Сведения**. Это позволит вам увидеть имя субъекта сертификата при выборе **Subject**, а также будет показано назначенное имя субъекта и связанные свойства.
    
7. Кроме того, необходимо проверить записи **альтернативного имени субъекта** . Вы найдете один или несколько из следующих ниже.
    
   - Имя пула для этого пула или имя одного сервера, если это не пул.
    
   - Имя сервера, заданное сертификату.
    
   - Простые записи URL-адресов, как правило, встречаются и диалоговые номера.
    
   - Внешние имена внутренних и веб-служб веб-служб (например, webpool01.contoso.net, webpool01.contoso.com), основанные на вариантах, сделанных в topology Builder и перенастроеченных выборах веб-служб.
    
   - Если уже назначено, lyncdiscover.\<sipdomain\> и lyncdiscoverinternal.\<sipdomain\> записи.
    
     Вам потребуется проверить несколько сертификатов, если вам назначено несколько сертификатов (проверьте примечание выше).
    
8. Итак, если вы найдете lyncdiscover.\<sipdomain\> и lyncdiscoverinternal.\<sipdomain\> записи, вы получили это уже настроено. MMC можно закрыть.
    
9. Если они не назначены, вам потребуется либо сделать новый запрос сертификата (описанный выше), либо установить их после запроса (для этого рекомендуется следующее выше PowerShell).
    
## <a name="configure-the-reverse-proxy"></a>Настройка обратного прокси-сервера
<a name="ConfigRP"> </a>

Шаги ниже не предназначены для точного следованию. Это потому, что в предыдущих версиях продукта, мы бы прошли вас через, например, настройка шлюза управления угрозами (TMG), и если вы не используете это, вам потребуется выработать собственную версию оттуда.
  
TMG больше не предлагается Корпорацией Майкрософт в качестве продукта, и если вам все еще нужно настроить его, вы можете посмотреть на шаги [Lync Server 2013](/previous-versions/office/lync-server-2013/lync-server-2013-configuring-the-reverse-proxy-for-mobility). Но следующие сведения должны быть более общими, даже если мы не можем предоставить конкретные шаги по погонам для каждого обратного прокси там.
  
У нас есть две основные вещи, которые следует учитывать:
  
- Собираетесь ли вы делать ваш первоначальный запрос автооткрытия по HTTPS (который мы рекомендуем)?
    
  - Если у вас есть правило веб-публикации, его необходимо изменить.
    
  - Если у вас еще нет правила веб-публикации, его необходимо создать.
    
- Если вы делаете первоначальный запрос автооткрытия по http, вам также потребуется создать или изменить это правило.
    
> [!NOTE]
> **Важно** Значение прокси-времени — это число, которое будет отличаться от развертывания к развертыванию. Необходимо отслеживать развертывание и изменять значение для наилучшего опыта для клиентов. Возможно, вам удастся установить значение не более 200. Если вы поддерживаете мобильные клиенты Lync в вашей среде, необходимо установить значение 960, чтобы разрешить время отжима уведомлений из Office 365, которые имеют значение времени от времени 900. Вполне вероятно, что вам придется увеличить значение времени, чтобы избежать отключений клиента, когда значение слишком низкое, или уменьшить число, если подключения через прокси-сервер не отключается, но ясно долго после отключения клиента. Мониторинг и базовая настройка обычной среды — это единственный точный способ определения соответствующего параметра для этого значения.
  
### <a name="modify-the-existing-web-publishing-rule-for-your-external-autodiscover-san-and-url"></a>Изменение существующего правила веб-публикации для внешнего SAN и URL-адреса автооткрытия

1. Откройте обратный прокси-интерфейс.
    
2. Вам потребуется найти правило веб-публикации и выбрать параметр Edit (он может находиться в меню или вкладке в зависимости от конфигурации обратного прокси-сервера).
    
3. Должна быть область, в которую должно быть задано, к чему применяется это правило веб-публикации. Необходимо изменить это правило для входящих сайтов или запросов для сайтов. Вы собираетесь добавить **новую** запись.
    
4. Введите имя сайта автообнаружение (пример, который мы будем использовать lyncdiscover.contoso.com) и нажмите кнопку ОК или  **Сохранить** в зависимости от формата обратного прокси-сервера.
    
5. Возможно, у вас есть новый сертификат с записью SAN с автозакрытием. Это также необходимо установить и настроить для использования в соответствии с настройками обратного прокси-сервера. Обязательно сохраните все после завершения конфигурации.
    
6. Если обратный прокси-сервер имеет функцию **Test** , используйте ее, чтобы убедиться, что все работает правильно.
    
7. Возможно, вам потребуется повторить эти действия, если в вашей среде есть пул директоров или директоров (это означает, что у вас есть второе правило).
    
### <a name="create-a-web-publishing-rule-for-the-external-autodiscover-url"></a>Создание правила веб-публикации для внешнего URL-адреса автооткрытия

1. Откройте обратный прокси-интерфейс.
    
2. Необходимо определить, где в интерфейсе создаются правила веб-публикации, и выбрать параметр **New** или **Create** (он может находиться в меню или вкладке в зависимости от конфигурации обратного прокси-сервера). Вы ищете вариант создания нового правила веб-публикации.
    
3. Как правило, необходимо ввести следующую информацию:
    
   - **Имя**: имя правила
    
   - **Действие правила**. В этом случае это правило **Разрешить** , вы позволяете что-то пройти через обратный прокси.
    
   - Правило **публикации** или вариант, который вы выбираете, — это **один веб-сайт или балансировка нагрузки**.
    
   - Это должен быть **SSL для** внешнего доступа, выберите этот параметр.
    
   - Вам потребуется опубликовать путь для внутренней публикации и ввести FQDN для внешних веб-служб на балансире нагрузки пула переднего конечного (или FQDN баланситора нагрузки пула директоров, если он есть), примером может быть sfb_pool01.contoso.local.
    
   - Вы должны ввести **/\\** _ в качестве пути к публикации, но вам также необходимо переназначить исходный заглавный сайт**.
    
   - Там будет возможность для **общедоступных или внешних сведений имя** или сведения. Это место, в которое вы сможете ввести:
    
   - **Принимать запросы**, но это должно быть для доменного имени.
    
   - Для **имени** необходимо ввести **lyncdiscover.**\<sipdomain> (это внешний URL-адрес службы автооткрытия). Теперь, если создается правило для внешнего URL-адреса веб-служб в пуле переднего конца, необходимо ввести FQDN для внешних веб-служб в пуле переднего конца (например, lyncwebextpool01.contoso.com).
    
   - Будет параметр **Path** , и вам потребуется **/\\** ввести * здесь.
    
   - Вам необходимо выбрать **SSL-слушатель** с вашим новым общедоступным сертификатом.
    
   - **Делегирование проверки** подлинности должно быть настроено на **"Нет делегирования**", но должна быть разрешена **прямая проверка подлинности** клиента.
    
   - Правило должно быть за установлено для **всех пользователей**.
    
   - Это должна быть вся информация, необходимая для создания этого правила и позволяет продолжить.
    
4. Необходимо убедиться в том, что исходный заглавный хозяйский **заглавник** будет переназначен.
    
5. Необходимо **также** настроить порты веб-сервера, чтобы сделать следующее:
    
   - **Перенаправление запросов в порт HTTP** и номер порта должен быть **8080**.
    
   - **Перенаправление запросов в порт SSL** и номер порта должен быть **4443**.
    
6. Когда все настроено, необходимо сохранить или применить их, а затем проверить правило.
    
### <a name="create-a-web-publishing-rule-for-port-80-optional"></a>Создание правила веб-публикации для порта 80 (необязательный)

1. Откройте обратный прокси-интерфейс.
    
2. Необходимо определить, где в интерфейсе создаются правила веб-публикации, и выбрать параметр **New** или **Create** (он может находиться в меню или вкладке в зависимости от конфигурации обратного прокси-сервера). Вы ищете вариант создания нового правила веб-публикации.
    
3. Как правило, необходимо ввести следующую информацию:
    
   - **Имя**: имя правила
    
   - **Действие правила**. В этом случае это правило **Разрешить** , вы позволяете что-то пройти через обратный прокси.
    
   - Правило **публикации** или вариант, который вы выбираете, — это **один веб-сайт или балансировка нагрузки**.
    
   - Это должно быть не защищенное **подключение, чтобы подключиться к опубликованной веб-сервер или ферму**.
    
   - Вам потребуется опубликовать путь для внутренней публикации и ввести FQDN для **VIP-адреса** балансира нагрузки вашего пула переднего конца, например, sfb_pool01.contoso.local.
    
   - Вы должны ввести **/\\** _ в качестве пути к публикации, но вам также необходимо переназначить исходный заглавный сайт**.
    
   - Там будет возможность для **общедоступных или внешних сведений имя** или сведения. Это место, в которое вы сможете ввести:
    
   - **Принимать запросы**, но это должно быть для доменного имени.
    
   - Для **имени** необходимо ввести **lyncdiscover.**\<sipdomain> (это внешний URL-адрес службы автооткрытия).
    
   - Будет параметр **Path** , и вам потребуется **/\\** ввести * здесь.
    
   - Вам потребуется выбрать веб-слушателя или разрешить обратному прокси-серверу создать его для вас.
    
   - **Делегирование проверки** подлинности должно быть настроено на **"Нет делегирования**", но прямая проверка подлинности клиента **не** должна быть разрешена.
    
   - Правило должно быть за установлено для **всех пользователей**.
    
   - Это должна быть вся информация, необходимая для создания этого правила и позволяет продолжить.
    
4. Необходимо **установить** порты веб-сервера, чтобы сделать следующее:
    
   - **Перенаправление запросов в порт HTTP** и номер порта должен быть **8080**.
    
   - **Перенаправление запросов в порт SSL** и номер порта должен быть **4443**.
    
5. Когда все настроено, необходимо сохранить или применить их, а затем проверить правило.
    
## <a name="configure-autodiscover-for-mobility-with-hybrid-deployments"></a>Настройка автооткрытия для мобильности с помощью гибридных развертывания
<a name="ConfigAutoD"> </a>

Гибридные среды в Skype для бизнеса Server являются средами, которые объединяют локальное пространство и среду O365. Если вы Skype для бизнеса Server в гибридной среде, служба автооткрытия должна быть в состоянии найти пользователя из любой из этих сред.
  
Чтобы мобильные клиенты узнали, где находится пользователь, службу автооткрытия необходимо настроить с помощью нового единого локатора ресурсов (URL-адрес). Ниже описана последовательность действий.
  
1. Откройте Skype для бизнеса Server управленческой оболочки.
    
2. Запустите следующее, чтобы получить значение **атрибута ProxyFQDN** для Skype для бизнеса Server среды:
    
   ```powershell
   Get-CsHostingProvider
   ```

3. Затем, еще в окне оболочки, запустите:
    
   ```powershell
   Set-CsHostingProvider -Identity [identity] -AutodiscoverUrl https://webdir.online.lync.com/autodiscover/autodiscoverservice.svc/root
   ```

    Где [идентификатор] заменяется именем домена общего пространства адресов SIP.
    
## <a name="test-your-mobility-deployment"></a>Тестирование развертывания мобильности
<a name="TestMobility"> </a>

После развертывания службы Skype для бизнеса Server мобильности и Skype для бизнеса Server автообнаружательных служб необходимо выполнить тестовую транзакцию, чтобы убедиться, что развертывание работает правильно. Вы можете запустить **Test-CsUcwaConference** , чтобы проверить способность двух пользователей создавать, присоединяться и общаться на конференции. Для этого тестирования потребуется два пользователя (реальные или тестовые) и полные учетные данные. Эта команда будет работать как для Skype для бизнеса, так и для клиентов Lync Server 2013.
  
Для клиентов Lync Server 2010 Skype для бизнеса Server 2015 г. необходимо выполнить тестирование **Test-CsMcxP2PIM**. Пользователи Lync Server 2010 по-прежнему должны быть реальными пользователями или заранее задав свои учетные данные паролей.

> [!NOTE]
> Поддержка mcX (Mobility Service) для устаревших мобильных клиентов больше недоступна в Skype для бизнеса Server 2019 г. Все современные Skype для бизнеса мобильные клиенты уже используют веб-API единой связи (UCWA) для поддержки обмена мгновенными сообщениями,присутствия и контактов. Пользователям с устаревшими клиентами, использующими MCX, потребуется обновиться до текущего клиента.
  
### <a name="test-conferencing-for-skype-for-business-and-lync-2013-mobile-clients"></a>Тестирование для мобильных клиентов Skype для бизнеса Lync 2013

1. Войдите в качестве члена **роли CsAdministrator** на любом компьютере, **на котором Skype для бизнеса Server** и **Ocscore**.
    
2. Запустите **Skype для бизнеса Server (** вы можете ввести имя в поиске или перейти во **все** программы и выбрать его).
    
3. В командной строке введите:
    
   ```powershell
   Test-CsUcwaConference -TargetFqdn <FQDN of Front End pool> -Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID> -OrganizerSipAddress sip:<SIP address of test user 1> -OrganizerCredential <test user 1 credentials> -ParticipantSipAddress sip:<SIP address of test user 2> -ParticipantCredential <test user 2 credentials> -v
   ```

   Также можно установить учетные данные в скрипте и передать их в тестовый комдлет. Ниже приведен пример этого.
    
   ```powershell
   $passwd1 = ConvertTo-SecureString "Password01" -AsPlainText -Force
   $passwd2 = ConvertTo-SecureString "Password02" -AsPlainText -Force
   $testuser1 = New-Object Management.Automation.PSCredential("contoso\UserName1", $passwd1)
   $testuser2 = New-Object Management.Automation.PSCredential("contoso\UserName2", $passwd2)
   Test-CsUcwaConference -TargetFqdn pool01.contoso.com -Authentication Negotiate -OrganizerSipAddress sip:UserName1@contoso.com -OrganizerCredential $testuser1 -ParticipantSipAddress sip:UserName2@contoso.com -ParticipantCredential $testuser2 -v
   ```

### <a name="test-conferencing-for-lync-2010-mobile-clients"></a>Тестирование для мобильных клиентов Lync 2010

> [!NOTE]
> Поддержка mcX (Mobility Service) для устаревших мобильных клиентов больше недоступна в Skype для бизнеса Server 2019 г. Все современные Skype для бизнеса мобильные клиенты уже используют веб-API единой связи (UCWA) для поддержки обмена мгновенными сообщениями,присутствия и контактов. Пользователям с устаревшими клиентами, использующими MCX, потребуется обновиться до текущего клиента.

1. Войдите в качестве члена **роли CsAdministrator** на любом компьютере, **на котором Skype для бизнеса Server** и **Ocscore**.
    
2. Запустите **Skype для бизнеса Server (** вы можете ввести имя в поиске или перейти во **все** программы и выбрать его).
    
3. В командной строке введите:
    
   ```powershell
   Test-CsMcxP2PIM -TargetFqdn <FQDN of Front End pool> -Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID> -SenderSipAddress sip:<SIP address of test user 1> -SenderCredential <test user 1 credentials> -ReceiverSipAddress sip:<SIP address of test user 2> -ReceiverCredential <test user 2 credentials> -v
   ```

   Также можно установить учетные данные в скрипте и передать их в тестовый комдлет. Ниже приведен пример этого.
    
   ```powershell
   $passwd1 = ConvertTo-SecureString "Password01" -AsPlainText -Force
   $passwd2 = ConvertTo-SecureString "Password02" -AsPlainText -Force
   $tuc1 = New-Object Management.Automation.PSCredential("contoso\UserName1", $passwd1)
   $tuc2 = New-Object Management.Automation.PSCredential("contoso\UserName2", $passwd2)
   Test-CsMcxP2PIM -TargetFqdn pool01.contoso.com -Authentication Negotiate -SenderSipAddress sip:UserName1@contoso.com -SenderCredential $tuc1 -ReceiverSipAddress sip:UserName2@contoso.com -ReceiverCredential $tuc2 -v
   ```

Дополнительные процедуры командной работы см. в [test-CsUcwaConference](/powershell/module/skype/test-csucwaconference) и [Test-CsMcxP2PIM](/powershell/module/skype/test-csmcxp2pim).
  
## <a name="configure-for-push-notifications"></a>Настройка для использования push-уведомлений
<a name="ConfigPush"> </a>

Push-уведомления в виде значков, значков или оповещений можно отправить на мобильное устройство, даже если приложение Skype или Lync неактивно. Но что такое push-уведомления? Они являются оповещениями о событиях, например новым или пропущенным приглашением для чата, или для полученной голосовой почты. Служба Skype для бизнеса Server Mobility отправляет эти уведомления в облачную службу push-уведомлений Skype для бизнеса Server, которая отправляет уведомления в службу push-уведомлений Майкрософт (MSNS) для Windows Phone пользователей.
  
Эта функция не изменилась с Lync Server 2013, но если у вас есть Skype для бизнеса Server, вы хотите сделать следующее:
  
- Для Skype для бизнеса Server Edge Server добавьте нового поставщика хостинга Microsoft Skype для бизнеса Online, а затем настроите федерацию поставщиков хостинга между организацией и Skype для бизнеса Online.
    
- Включить push-уведомления, запуская комлет **Set-CsPushNotificationConfiguration** . По умолчанию push-уведомления отключены.
    
- Проверьте конфигурацию федерации и push-уведомления.
    
### <a name="configure-your-skype-for-business-edge-server-for-push-notifications"></a>Настройка Skype для бизнеса Edge Server для push-уведомлений

1. Войдите с учетной записью, которая входит в роль **CsAdministrator**, на компьютер, **на котором Skype для бизнеса Server** и **Ocscore**.
    
2. Запуск **оболочки Skype для бизнеса Server управления**.
    
3. Добавление поставщика Skype для бизнеса Server веб-хостинга.
    
   ```powershell
   New-CsHostingProvider -Identity <unique identifier for hosting provider> -Enabled $True -ProxyFQDN <FQDN for the Access Server used by the hosting provider> -VerificationLevel UseSourceVerification
   ```

   Например:
    
   ```powershell
   New-CsHostingProvider -Identity "SkypeOnline" -Enabled $True -ProxyFQDN "sipfed.online.lync.com" -VerificationLevel UseSourceVerification
   ```

    > [!NOTE]
    > Вы не можете иметь несколько отношений федерации с одним поставщиком хостинга. Таким образом, если вы уже создали поставщика хостинга, который имеет отношение федерации с sipfed.online.lync.com, не добавляйте другого поставщика хостинга для него, даже если удостоверение поставщика хостинга является чем-то иным, чем SkypeOnline. 
  
4. Настройка федерации поставщика хостинга между организацией и службой push-уведомлений в Skype для бизнеса Online. В командной строке необходимо ввести:
    
   ```powershell
    New-CsAllowedDomain -Identity "push.lync.com"
   ```

### <a name="enable-push-notifications"></a>Включить push-уведомления

1. Войдите с учетной записью, которая входит в роль **CsAdministrator**, на компьютер, **на котором Skype для бизнеса Server** и **Ocscore**.
    
2. Запуск **оболочки Skype для бизнеса Server управления**.
    
3. Включить push-уведомления:
    
   ```powershell
   Set-CsPushNotificationConfiguration -EnableMicrosoftPushNotificationService $True
   ```

4. Включить Федерацию:
     
   ```powershell
   Set-CsAccessEdgeConfiguration -AllowFederatedUsers $True
   ```

### <a name="test-federation-and-push-notifications"></a>Тестирование федерации и push-уведомлений

1. Войдите с учетной записью, которая входит в роль **CsAdministrator**, на компьютер, **на котором Skype для бизнеса Server** и **Ocscore**.
    
2. Запуск **оболочки Skype для бизнеса Server управления**.
    
3. Проверьте конфигурацию федерации:
    
   ```powershell
   Test-CsFederatedPartner -TargetFqdn <FQDN of Access Edge server used for federated SIP traffic> -Domain <FQDN of federated domain> -ProxyFqdn <FQDN of the Access Edge server used by the federated organization>
   ```

    Например:
    
   ```powershell
   Test-CsFederatedPartner -TargetFqdn accessproxy.contoso.com -Domain push.lync.com -ProxyFqdn sipfed.online.lync.com
   ```

4. Проверьте push-уведомления:
    
   ```powershell
   Test-CsMcxPushNotification -AccessEdgeFqdn <Access Edge service FQDN>
   ```

    Например:
    
   ```powershell
   Test-CsMcxPushNotification -AccessEdgeFqdn accessproxy.contoso.com
   ```

## <a name="configure-mobility-policy"></a>Настройка политики мобильности
<a name="ConfigMob"> </a>

У вас есть возможность с помощью Skype для бизнеса Server, кто может использовать службу мобильности, вызов через работу, голос через IP (VoIP) или видео, а также потребуется ли Wi-Fi для VoIP или видео. Вызов через Work позволяет мобильному пользователю использовать рабочий номер телефона, а не номер мобильного телефона при размещении и приеме вызовов. Пользователь на другом конце строки не увидит номер мобильного телефона пользователя, и это позволяет мобильному пользователю избегать исходяющих звонков. При настройках VoIP и видео пользователи могут принимать и делать voIP-звонки и видео. Параметры использования Wi-Fi определяют, потребуется ли мобильному устройству пользователя использовать сеть Wi-Fi через сеть сотовых данных.
  
Мобильные устройства, вызовы с помощью work и функции VoIP и видео включены по умолчанию. Параметр, в котором требуется Wi-Fi для VoIP и видео, отключен. Администратор имеет возможность изменять это как глобально, так и по сайту, или по пользователю.
  
Чтобы иметь возможность использовать функции Mobility и Call via Work, пользователям необходимо:
  
- Включено для Skype для бизнеса Server
    
- Включено для Корпоративная голосовая связь.
    
- Назначена политика мобильности с параметром **EnableMobility** для **True**.
    
Чтобы пользователи могли использовать Call via Work, им также необходимо:
  
- Назначена политика голосовой связи с выбранным параметром **Включить одновременный** звон телефонов.
    
- Назначена политика мобильности с набором **EnableOutsideVoice** **true.**
    
> [!NOTE]
> Пользователи, которые не включены для Корпоративная голосовая связь, могут использовать свои мобильные устройства для Skype Skype вызовов VoIP или могут присоединяться к конференциям с помощью ссылки Щелкните присоединиться на мобильных устройствах, если для связанной с ними политики голосовой связи установлены соответствующие параметры. Дополнительные подробности в разделе PLANNING. 
  
### <a name="modify-global-mobility-policy"></a>Изменение глобальной политики мобильности

1. Войдите с учетной записью, которая входит в роль **CsAdministrator**, на компьютер, **на котором Skype для бизнеса Server** и **Ocscore**.
    
2. Запуск **оболочки Skype для бизнеса Server управления**.
    
3. Отключите доступ к мобильности и вызову с помощью work глобально, введя:
    
   ```powershell
   Set-CsMobilityPolicy -EnableMobility $False -EnableOutsideVoice $False
   ```

    > [!NOTE]
    > Вы можете отключить вызов с помощью Work, не отключив доступ к Mobility. Но вы не можете отключить Мобильность, не отключив вызов с помощью work. 
  
    Дополнительные сведения можно получить в [set-CsMobilityPolicy](/powershell/module/skype/set-csmobilitypolicy).
    
### <a name="modify-mobility-policy-by-site"></a>Изменение политики мобильности по сайту

1. Войдите с учетной записью, которая входит в роль **CsAdministrator**, на компьютер, **на котором Skype для бизнеса Server** и **Ocscore**.
    
2. Запуск **оболочки Skype для бизнеса Server управления**.
    
3. Вы можете создать политику на уровне сайта, отключить VoIP и видео, включить require WiFi для IP-аудио и требовать Wi-Fi для IP-видео по сайту. Тип:
    
   ```powershell
   New-CsMobilityPolicy -Identity site:<site identifier> -EnableIPAudioVideo $false -RequireWiFiForIPAudio $True -RequireWiFiforIPVideo $True
   ```

    Дополнительные новости в [New-CsMobilityPolicy](/powershell/module/skype/new-csmobilitypolicy).
    
### <a name="modify-mobility-policy-by-user"></a>Изменение политики мобильности пользователем

1. Войдите с учетной записью, которая входит в роль **CsAdministrator**, на компьютер, **на котором Skype для бизнеса Server** и **Ocscore**.
    
2. Запуск **оболочки Skype для бизнеса Server управления**.
    
3. Создайте политики мобильности уровня пользователя и отключите мобильность и вызов с помощью work пользователем. Тип:
    
   ```powershell
   New-CsMobilityPolicy -Identity <policy name> -EnableMobility $False -EnableOutsideVoice $False
   Grant-CsMobilityPolicy -Identity <user identifier> -PolicyName <policy name>
   ```

    Дополнительный пример с примерами данных:
    
   ```powershell
   New-CsMobilityPolicy "tag:disableOutsideVoice" -EnableOutsideVoice $False
   Grant-CsMobilityPolicy -Identity MobileUser1@contoso.com -PolicyName tag:disableOutsideVoice
   ```

    > [!NOTE]
    > Вы можете отключить вызов с помощью Work, не отключив доступ к Mobility. Но вы не можете отключить Мобильность, не отключив вызов с помощью work. 
