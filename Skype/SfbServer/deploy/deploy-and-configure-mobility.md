---
title: Развертывание и настройка мобильной работы для Skype для бизнеса Server
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.assetid: 8ec6197a-3d1e-4b42-9465-564044cdab1a
description: В этой статье описано, как настроить существующую установку Skype для бизнеса Server для использования службы Mobility Service, позволяя мобильным устройствам использовать функции мобильной работы Skype для бизнеса Server.
ms.openlocfilehash: 457eeff39c87f20326d64cc5227745b43e0af5f8
ms.sourcegitcommit: 88a16c09dd91229e1a8c156445eb3c360c942978
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2020
ms.locfileid: "42029070"
---
# <a name="deploy-and-configure-mobility-for-skype-for-business-server"></a>Развертывание и настройка мобильной работы для Skype для бизнеса Server  
 
В этой статье описано, как настроить существующую установку Skype для бизнеса Server для использования службы Mobility Service, позволяя мобильным устройствам использовать функции мобильной работы Skype для бизнеса Server.
  
Получив статью [о планировании мобильной работы для Skype для бизнеса Server](../plan-your-deployment/mobility.md) , необходимо выполнить указанные ниже действия, чтобы развернуть мобильную среду в среде Skype для бизнеса Server. Для этого необходимо выполнить указанные ниже действия (в этом случае список разрешений включается в эту таблицу).
  
|**Этап**|**Разрешения**|
|:-----|:-----|
|[Создание записей DNS](deploy-and-configure-mobility.md#CreateDNSRec) <br/> |Администраторы домена  <br/> DNSAdmins  <br/> |
|[Изменение сертификатов](deploy-and-configure-mobility.md#ModCerts) <br/> |Локальный администратор  <br/> |
|[Настройка обратного прокси-сервера](deploy-and-configure-mobility.md#ConfigRP) <br/> |Локальный администратор  <br/> |
|[Настройка службы автообнаружения для мобильной работы с гибридными развертываниями](deploy-and-configure-mobility.md#ConfigAutoD) <br/> |Администраторы домена  <br/> |
|[Тестирование развертывания мобильности](deploy-and-configure-mobility.md#TestMobility) <br/> |CsAdministrator  <br/> |
|[Настройка для использования push-уведомлений](deploy-and-configure-mobility.md#ConfigPush) <br/> |RtcUniversalServerAdmins  <br/> |
|[Настройка политики мобильности](deploy-and-configure-mobility.md#ConfigMob) <br/> |CsAdministrator  <br/> |
   
В следующих разделах содержатся действия, которые предполагают, что вы прочитали раздел Planning. Если что-то не так, вы можете бесплатно извлекать информацию.

> [!NOTE]
> MCX (служба Mobility Service) поддержка устаревших мобильных клиентов больше недоступна в Skype для бизнеса Server 2019. Все текущие мобильные клиенты Skype для бизнеса уже используют веб-API объединенных коммуникаций (UCWA), чтобы поддерживать обмен мгновенными сообщениями, сведения о присутствии и контакты. Пользователям прежних версий клиентов, использующих MCX, необходимо выполнить обновление до текущего клиента.
  
## <a name="create-dns-records"></a>Создание записей DNS
<a name="CreateDNSRec"> </a>

Они уже могут применяться в среде Skype для бизнеса Server, но для работы с автообнаружением необходимо создать следующие записи:
  
- Внутренняя запись DNS для поддержки мобильных пользователей, подключающихся из сети Организации.
    
- Внешняя (или общедоступная) запись DNS для поддержки мобильных пользователей, подключающихся из-за пределами сети Организации.
    
Эти записи могут быть либо именами (узла), либо записями CNAME (их не нужно делать, мы просто включая все необходимые действия).
  
### <a name="create-an-internal-dns-cname-record"></a>Создание внутренней записи CNAME DNS

1. Войдите на DNS-сервер в сети, который является членом группы **администраторов домена** или группы **DnsAdmins** .
    
2. Нажмите кнопку **Пуск**, выберите пункт **Администрирование** (возможно, вам потребуется **найти** его, если он не входит в меню "Пуск"), а затем нажмите кнопку **DNS** , чтобы открыть оснастку администрирования DNS.
    
3. В левой области окна консоли необходимо перейти к домену, который находится дома, на серверы переднего плана Skype для бизнеса Server, а также развернуть **зоны прямого просмотра** .
    
4. Проведите несколько минут, чтобы узнать, какие из следующих компонентов:
    
   - Любые записи A или AAAA для узла сервера переднего плана (стандартного или корпоративного) или пула переднего плана.
    
   - Записи A или AAAA для директора или пула директоров (Необязательная конфигурация, которая может возникнуть в развертывании).
    
5. После этого щелкните правой кнопкой мыши имя домена SIP и выберите в меню пункт **создать псевдоним (CNAME)** .
    
6. В текстовом поле **псевдоним** введите lyncdiscoverinternal в качестве имени узла для внутреннего URL-адреса службы автообнаружения.
    
7. В **полном доменном имени (полное доменное имя для целевого узла**) необходимо ввести полное доменное имя внутренних веб-служб для пула переднего плана (или одного сервера переднего плана или директора), указанного на шаге 4 выше. Нажмите кнопку ОК при вводе.
    
8. Вам потребуется создать новую запись CNAME автообнаружения в зоне прямого просмотра для каждого домена SIP, поддерживаемого в среде Skype для бизнеса Server.
    
### <a name="create-an-external-dns-cname-record"></a>Создание внешней записи CNAME DNS

1. Эти действия являются общими, так как мы не можем определить, какой общедоступный поставщик DNS вы можете использовать, но мы хотим помочь вам. Выполните вход в общедоступный поставщик DNS с учетной записью, которая будет иметь возможность делать новые записи DNS.
    
2. На данный момент времени для Skype для бизнеса Server уже должен существовать домен SIP. Разверните **зону прямого просмотра** для этого домена SIP или откройте ее другим способом.
    
3. Проведите несколько минут, чтобы узнать, какие из следующих компонентов:
    
   - Любые записи A или AAAA для узла сервера переднего плана (стандартного или корпоративного) или пула переднего плана.
    
   - Записи A или AAAA для директора или пула директоров (Необязательная конфигурация, которая может возникнуть в развертывании).
    
4. После получения этих сведений вы сможете выбрать вариант для создания **нового псевдонима (CNAME)**.
    
5. Теперь вы можете ввести **имя псевдонима**, вам нужно ввести lyncdiscover здесь для внешнего URL-адреса службы автообнаружения.
    
6. Далее должна быть область для ввода в **полное доменное имя конечного узла**, для этого потребуется указать полное доменное имя для пула переднего плана (или одного сервера переднего плана или директора), указанного на шаге 3.
    
7. Возможно, вам потребуется сохранить эту ссылку или создать дополнительные записи CNAME в зоне прямого просмотра для каждого домена SIP в среде Skype для бизнеса Server, но после того как все будет готово, сохраните работу.
    
### <a name="create-an-internal-dns-a-record"></a>Создание записи A внутренней DNS

1. Войдите на DNS-сервер в сети, который является членом группы **администраторов домена** или группы **DnsAdmins** .
    
2. Нажмите кнопку **Пуск**, выберите пункт **Администрирование** (возможно, вам потребуется **найти** его, если он не входит в меню "Пуск"), а затем нажмите кнопку **DNS** , чтобы открыть оснастку администрирования DNS.
    
3. В левой области окна консоли необходимо перейти к домену, который находится дома, на серверы переднего плана Skype для бизнеса Server, а также развернуть **зоны прямого просмотра** .
    
4. Проведите несколько минут, чтобы узнать, какие из следующих компонентов:
    
   - Любые записи A или AAAA для узла сервера переднего плана (стандартного или корпоративного) или пула переднего плана.
    
   - Записи A или AAAA для директора или пула директоров (Необязательная конфигурация, которая может возникнуть в развертывании).
    
5. После этого щелкните правой кнопкой мыши имя домена SIP и выберите в меню пункт **создать узел (A или AAAA)** .
    
6. В текстовом поле **имя** введите lyncdiscoverinternal для имени узла для внутреннего URL-адреса службы автообнаружения.
    
7. В текстовом поле **IP-адрес** введите IP-адрес внутренних веб-служб для пула переднего плана (или одного сервера переднего плана или директора), указанного на шаге 4 выше.
    
8. По завершении нажмите кнопку **Добавить узел**, а затем нажмите кнопку **ОК**.
    
9. Вам потребуется создать новые записи A или AAAA для автообнаружения в зоне прямого просмотра для каждого домена SIP, поддерживаемого в среде Skype для бизнеса Server. Для этого повторите шаги 6-8 столько раз, сколько необходимо.
    
10. Когда все будет готово, нажмите кнопку **Готово**.
    
### <a name="create-an-external-dns-a-record"></a>Создание записи A внешней DNS

1. Эти действия являются общими, так как мы не можем определить, какой общедоступный поставщик DNS вы можете использовать, но мы хотим помочь вам. Выполните вход в общедоступный поставщик DNS с учетной записью, которая будет иметь возможность делать новые записи DNS.
    
2. На данный момент времени для Skype для бизнеса Server уже должен существовать домен SIP. Разверните **зону прямого просмотра** для этого домена SIP или откройте ее другим способом.
    
3. Проведите несколько минут, чтобы узнать, какие из следующих компонентов:
    
   - Любые записи A или AAAA для узла сервера переднего плана (стандартного или корпоративного) или пула переднего плана.
    
   - Записи A или AAAA для директора или пула директоров (Необязательная конфигурация, которая может возникнуть в развертывании).
    
4. После получения этих сведений вы сможете выбрать вариант для создания **нового узла a или AAAA**.
    
5. Теперь вы можете ввести **имя**, введите lyncdiscover здесь для внешнего URL-адреса службы автообнаружения.
    
6. Далее должна быть область для ввода в **IP-адреса**, она должна быть IP-адресом для пула переднего плана (или одного сервера переднего плана или директора), указанного на шаге 3.
    
7. Вам может потребоваться сохранить эту ссылку или создать дополнительные записи A или AAAA в зоне прямого просмотра для каждого домена SIP в среде Skype для бизнеса Server, но после того как все будет готово, сохраните работу.
    
## <a name="modify-certificates"></a>Изменение сертификатов
<a name="ModCerts"> </a>

Если у вас есть вопросы по планированию сертификатов, мы задокументировани, что в нашем [плане для статьи по мобильности в Skype для бизнеса Server](../plan-your-deployment/mobility.md) . После того как вы проверили это, мы поможем вам выполнить следующие действия:
  
- Требуются ли новые сертификаты?
    
- Запрос новых сертификатов из центра сертификации (CA).
    
- Обновление сертификатов на месте с заменой с помощью PowerShell.
    
- Проверка сертификатов с помощью оснастки "сертификаты" в консоли управления (MMC).
    
### <a name="do-i-need-new-certificates"></a>Требуются ли новые сертификаты?

1. Для начала вам может потребоваться проверить, какие сертификаты имеются на месте, а какие — нет, а также указать, есть ли у них нужные записи. Для этого необходимо выполнить вход в Skype для бизнеса Server с учетной записью, которая является локальным администратором. Эта учетная запись может также требовать права на выдающий центр сертификации (CA), чтобы выполнить некоторые из этих действий.
    
2. Откройте командную консоль Skype для бизнеса Server (можно использовать поиск, чтобы найти ее, если она не закреплена в меню "Пуск" или панели задач).
    
3. Необходимо знать, какие сертификаты были назначены, прежде чем вы попробуете добавить обновленный сертификат. В командной команде введите:
    
   ```powershell
   Get-CsCertificate
   ```

4. Сведения, приведенные в шаге 3, будут уникальными. Чтобы определить, есть ли один сертификат, назначенный для нескольких вещей, или у вас есть другой сертификат, назначенный для разных компонентов. С **помощью параметра Use** вы узнаете, как будет использоваться сертификат, а параметр **Thumbprint** будет указывать на то, что все это один и тот же сертификат, или несколько сертификатов.
    
5. Если у вас есть записи SAN, Рекомендуемые в нашем разделе планирования, это хорошо. В противном случае вам потребуется запросить новый сертификат или несколько сертификатов (в зависимости от конфигурации) от вашего центра сертификации.
    
### <a name="request-a-new-certificate-or-certificates-from-your-certificate-authority-ca"></a>Запрос нового сертификата или сертификатов из центра сертификации (ЦС)

1. После проверки наличия записей в сети SAN вы знаете, что у вас есть **один сертификат** (после выполнения описанных выше действий), и вы узнали, что у вас нет необходимых записей. В ЦС должен быть создан новый запрос на сертификат. Откройте PowerShell Skype для бизнеса Server:
    
   - Для отсутствующей сети хранения данных службы автообнаружения (замените параметр-CA на собственный путь к центру сертификации):
    
   ```powershell
   Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -AllSipDomain -verbose
   ```

   - Теперь, если у вас несколько доменов SIP, вы не можете использовать параметр Аллсипдомаин, как в приведенном выше примере. Вместо этого необходимо использовать параметр DomainName. При использовании параметра имя_домена необходимо определить полное доменное имя для записей lyncdiscoverinternal и lyncdiscover. В качестве примера можно привести (заменив параметр-CA на свой собственный путь к центру сертификации):
    
   ```powershell
   Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
   ```

2. После того как вы проверили наличие записей в сети SAN, вы обнаружили **несколько сертификатов** , у которых нет нужных записей. В ЦС должен быть создан новый запрос на сертификат. Откройте PowerShell Skype для бизнеса Server:
    
   - Для отсутствующей сети хранения данных службы автообнаружения (замените параметр-CA на собственный путь к центру сертификации):
    
   ```powershell
   Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -AllSipDomain -verbose
   ```

   - Теперь, если у вас несколько доменов SIP, вы не можете использовать параметр Аллсипдомаин, как в приведенном выше примере. Вместо этого необходимо использовать параметр DomainName. При использовании параметра имя_домена необходимо определить полное доменное имя для записей lyncdiscoverinternal и lyncdiscover. В качестве примера можно привести (заменив параметр-CA на свой собственный путь к центру сертификации):
    
   ```powershell
   Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
   ```

   ```powershell
   Request-CsCertificate -New -Type WebServicesExternal -Ca dc\myca -DomainName "Lyncdiscover.contoso.com, Lyncdiscover.contoso.net" -verbose
   ```

   - После того как ЦС создал новые сертификаты, вам потребуется назначить их.
    
### <a name="assign-certificates-using-skype-for-business-server-management-shell"></a>Назначение сертификатов с помощью командной консоли Skype для бизнеса Server

- В зависимости от того, что вы нашли в разделе сделать так, что вам нужны новые сертификаты, необходимо выполнить **одно** из следующих действий.
    
  - Если у вас есть один сертификат для всех (одинаковые отпечатки), необходимо выполнить следующую команду:
    
  ```powershell
  Set-CsCertificate -Type <certificate(s) from the Use parameter> -Thumbprint <unique identifier>
  ```

  - Если у вас есть разные сертификаты для тех вещей (отпечатки отличаются), выполните следующую команду:
    
  ```powershell
  Set-CsCertificate -Type Default -Thumbprint <certificate thumbprint>
  Set-CsCertificate -Type WebServicesInternal -Thumbprint <certificate thumbprint>
  Set-CsCertificate -Type WebServicesExternal -Thumbprint <certificate thumbprint>
  ```

### <a name="viewing-certificates-in-the-microsoft-management-console-mmc"></a>Просмотр сертификатов в консоли управления (MMC)

1. Вы можете просмотреть свои сертификаты с помощью оснастки "сертификаты" для консоли управления (MMC). Просто введите MMC в область поиска, и она должна быть в качестве параметра приложения.
    
2. Чтобы добавить оснастку "сертификаты", необходимо щелкнуть **файл**, а затем **Добавить или удалить оснастку...** (или сочетание клавиш **CTRL + M** также будет работать). В левой области будут выбраны **Сертификаты** , выберите его, а затем нажмите **учетную запись компьютера** во всплывающем окне, а затем нажмите кнопку **Далее**.
    
3. По-прежнему во всплывающем окне все это можно сделать на локальном компьютере, который необходимо просматривать, поэтому оставьте выбор на **локальном компьютере** , если это так. Если вы работаете на удаленном компьютере, измените переключатель переключателя на **другой компьютер** , а затем введите полное доменное имя компьютера или воспользуйтесь кнопкой **Обзор** , чтобы выполнить поиск этого компьютера через AD. Выбрав компьютер, нажмите кнопку **Готово** при готовности, а затем нажмите кнопку **ОК** , чтобы добавить оснастку в консоль управления (MMC).
    
4. Разверните раздел **Сертификаты** в левой области консоли управления (MMC). Разверните также **личную** папку, а затем выберите пункт **Сертификаты**. Это позволяет просматривать сертификаты в этом хранилище.
    
5. Необходимо выбрать нужный сертификат, щелкните его правой кнопкой мыши и выберите команду **Открыть**.
    
    > [!NOTE]
    > Как узнать, какой сертификат это такое? Это должен быть один и тот же сертификат, назначенный всем для фермы, или несколько сертификатов для разных целей, например, по умолчанию, внутренние веб-службы и т. д., в таком случае вам может потребоваться просмотреть несколько сертификатов. Несколько сертификатов будут иметь один и тот же отпечаток. 
  
6. После получения представления " **сертификат** " нажмите кнопку **сведения**. Это позволит увидеть имя субъекта сертификата при выборе параметра **Тема**, а также отображаются назначенные имя субъекта и связанные свойства.
    
7. Кроме того, необходимо проверить записи **альтернативного имени субъекта** . Вы найдете один из следующих элементов:
    
   - Имя пула для этого пула или имя отдельного сервера, если это не пул.
    
   - Имя сервера, которому назначен сертификат.
    
   - Записи простых URL-адресов, как правило, удовлетворяют и набираемые.
    
   - Внутренние имена веб-служб и внешние имена веб-служб (например, webpool01.contoso.net, webpool01.contoso.com), основанные на вариантах, сделанных в построителе топологий и переопределенных на выборе веб-службах.
    
   - Если уже назначено, lyncdiscover. \<sipdomain\> и lyncdiscoverinternal. \<записи\> sipdomain.
    
     Вам потребуется проверить несколько сертификатов, если у вас больше одного назначения (проверьте заметку выше).
    
8. Итак, если вы нашли lyncdiscover. \<sipdomain\> и lyncdiscoverinternal. \<записи\> sipdomain. это уже настроено. Вы можете закрыть консоль управления (MMC).
    
9. Если они не назначены, вам потребуется создать новый запрос на сертификат (описанный выше) или необходимо установить их после запроса (для этого мы рекомендуем использовать приведенный выше пример PowerShell).
    
## <a name="configure-the-reverse-proxy"></a>Настройка обратного прокси-сервера
<a name="ConfigRP"> </a>

Приведенные ниже шаги не предназначены для выполнения в точности. Это вызвано тем, что в предыдущих версиях продукта мы прочитали вас, например, настроили шлюз управления угрозами (TMG), и если вы не использовали его, вам потребуется использовать собственную версию.
  
TMG больше не предлагается корпорацией Майкрософт в качестве продукта, и если вам по-прежнему нужно настроить его, вы можете ознакомиться с [этапами Lync Server 2013](https://technet.microsoft.com/library/hh690011%28v=ocs.15%29.aspx). Но приведенные ниже сведения предназначены для более широкого использования, даже если не существует способа, который можно использовать для каждого обратного прокси-сервера.
  
Мы рассмотрим два основных фактора:
  
- Планируется ли выполнять исходный запрос автообнаружения по протоколу HTTPS (рекомендуемый)?
    
  - Если у вас есть правило веб-публикации, его необходимо изменить.
    
  - Если у вас еще нет правила веб-публикации, его необходимо создать.
    
- Если вы выполняете исходный запрос автообнаружения по протоколу HTTP, необходимо также создать или изменить это правило.
    
> [!NOTE]
> **Важно!** Значение времени ожидания прокси-сервера — это число, которое будет отличаться в зависимости от развертывания до развертывания. Необходимо следить за развертыванием и изменять значение для лучшего взаимодействия с клиентами. Вы можете задать значение, равное 200. Если вы поддерживаете мобильные клиенты Lync в вашей среде, необходимо задать для этого параметра значение 960, чтобы разрешить время ожидания push-уведомлений в Office 365, для которого значение времени ожидания равно 900. Очень вероятно, что вам потребуется увеличить значение времени ожидания, чтобы избежать отключения клиента, если значение слишком мало, или уменьшить число, если подключения через прокси-сервер не будут отключаться, но очистить до отключения клиента. Мониторинг и базовая то, что обычно используется в вашей среде, — единственный точный способ определить соответствующий параметр для этого значения.
  
### <a name="modify-the-existing-web-publishing-rule-for-your-external-autodiscover-san-and-url"></a>Изменение существующего правила веб-публикации для внешнего адреса SAN и URL-адреса службы автообнаружения

1. Откройте интерфейс обратного прокси-сервера.
    
2. Необходимо указать правило веб-публикации и нажать кнопку Изменить (оно может находиться в меню или на вкладке, в зависимости от конфигурации обратного прокси-сервера).
    
3. Необходимо указать область, к которой применяется это правило веб-публикации. Это правило необходимо изменить для входящих сайтов или запросов для сайтов. Вы собираетесь **Добавить** новую запись.
    
4. Введите имя сайта автообнаружения (для примера мы будем использовать lyncdiscover.contoso.com), а затем нажмите кнопку **ОК** или **сохранить**, в зависимости от формата обратного прокси-сервера.
    
5. У вас может быть новый сертификат, в котором есть запись SAN автообнаружения. , Которые необходимо установить и настроить для использования в соответствии с параметрами обратного прокси-сервера. Не забудьте сохранить все после завершения настройки.
    
6. Если у обратного прокси-сервера есть **Тестовая** функциональность, выполните его, чтобы убедиться, что все работает должным образом.
    
7. Теперь вам может потребоваться повторить эти действия, если в вашей среде используется директор или директор пула (это означает, что у вас есть второе правило).
    
### <a name="create-a-web-publishing-rule-for-the-external-autodiscover-url"></a>Создание правила веб-публикации для внешнего URL-адреса автообнаружения

1. Откройте интерфейс обратного прокси-сервера.
    
2. Вам потребуется определить, где в интерфейсе создаются правила веб-публикации, и выберите команду Создать или **создать** (может находиться в **меню или на** вкладке, в зависимости от конфигурации обратного прокси-сервера). Вы ищете вариант для создания нового правила веб-публикации.
    
3. Как правило, необходимо ввести следующие сведения:
    
   - **Name**: имя правила.
    
   - **Действие правила**: в этом случае это правило разрешения, что вы **разрешаете** прохождение через обратный прокси-сервер.
    
   - Выбранным правилом **публикации** является **один веб-сайт или подсистема балансировки нагрузки**.
    
   - Это должен быть **SSL** для внешнего доступа, выберите этот параметр.
    
   - Необходимо опубликовать путь для **внутренней публикации**и ввести полное доменное имя для внешних веб-служб в подсистеме балансировки нагрузки пула переднего плана (или полное доменное имя балансировщика пула директоров, если таковой имеется), пример sfb_pool01. contoso. local.
    
   - Необходимо ввести ** / *** в качестве пути для публикации, но также необходимо **переадресовать исходный заголовок узла**.
    
   - Сведения об **общедоступных или внешних именах** , а также сведения о них. Это место, где вы сможете вводить:
    
   - **Принимать запросы**, но должно быть для доменного имени.
    
   - Введите lyncdiscover в поле **имя** **.** <sipdomain>(это URL-адрес внешней службы автообнаружения). Теперь, если вы создаете правило для URL-адреса внешних веб-служб в интерфейсном пуле, необходимо ввести полное доменное имя для внешних веб-служб в интерфейсном пуле (например, lyncwebextpool01.contoso.com).
    
   - Будет выбран **путь** , и вам потребуется ввести ** / *** здесь.
    
   - Вам потребуется выбрать **прослушиватель SSL** с общедоступным общедоступным сертификатом.
    
   - Для **делегирования проверки подлинности** должно быть задано значение **без делегирования**, но проверка подлинности клиента **должна** быть разрешена.
    
   - Правило должно быть задано для **всех пользователей**.
    
   - Это должно быть все сведения, необходимые для создания этого правила и предоставления возможности продолжения.
    
4. Необходимо обеспечить перенаправление **исходного заголовка узла** .
    
5. Необходимо также настроить порты **веб-сервера** , выполнив следующие действия:
    
   - **Запросы на перенаправление на HTTP-порт** и номер порта должны быть **8080**.
    
   - **Запросы на перенаправление на порт SSL** и номер порта должны быть **4443**.
    
6. Если все настроено, необходимо сохранить или применить их, а затем проверить правило.
    
### <a name="create-a-web-publishing-rule-for-port-80-optional"></a>Создание правила веб-публикации для порта 80 (необязательно)

1. Откройте интерфейс обратного прокси-сервера.
    
2. Вам потребуется определить, где в интерфейсе создаются правила веб-публикации, и выберите команду Создать или **создать** (может находиться в **меню или на** вкладке, в зависимости от конфигурации обратного прокси-сервера). Вы ищете вариант для создания нового правила веб-публикации.
    
3. Как правило, необходимо ввести следующие сведения:
    
   - **Name**: имя правила.
    
   - **Действие правила**: в этом случае это правило разрешения, что вы **разрешаете** прохождение через обратный прокси-сервер.
    
   - Выбранным правилом **публикации** является **один веб-сайт или подсистема балансировки нагрузки**.
    
   - Для **подключения к опубликованному веб-серверу или ферме это должно быть незащищенное подключение**.
    
   - Необходимо опубликовать путь для **внутренней публикации**и ввести полное доменное имя для **виртуального IP-адреса** подсистемы балансировки нагрузки пула переднего плана, например sfb_pool01. contoso. local.
    
   - Необходимо ввести ** / *** в качестве пути для публикации, но также необходимо **переадресовать исходный заголовок узла**.
    
   - Сведения об **общедоступных или внешних именах** , а также сведения о них. Это место, где вы сможете вводить:
    
   - **Принимать запросы**, но должно быть для доменного имени.
    
   - Введите lyncdiscover в поле **имя** **.** <sipdomain>(это URL-адрес внешней службы автообнаружения).
    
   - Будет выбран **путь** , и вам потребуется ввести ** / *** здесь.
    
   - Необходимо выбрать веб-прослушиватель или разрешить обратному прокси-серверу создать его.
    
   - Для **делегирования проверки подлинности** должно быть задано значение **без делегирования**, но проверка подлинности прямого клиента **не** разрешена.
    
   - Правило должно быть задано для **всех пользователей**.
    
   - Это должно быть все сведения, необходимые для создания этого правила и предоставления возможности продолжения.
    
4. Необходимо настроить порты **веб-сервера** , выполнив следующие действия:
    
   - **Запросы на перенаправление на HTTP-порт** и номер порта должны быть **8080**.
    
   - **Запросы на перенаправление на порт SSL** и номер порта должны быть **4443**.
    
5. Если все настроено, необходимо сохранить или применить их, а затем проверить правило.
    
## <a name="configure-autodiscover-for-mobility-with-hybrid-deployments"></a>Настройка службы автообнаружения для мобильной работы с гибридными развертываниями
<a name="ConfigAutoD"> </a>

Гибридные среды в Skype для бизнеса Server представляют собой среды, сочетающие в себе локальную среду и среду O365. Если в гибридной среде работает Skype для бизнеса Server, служба автообнаружения должна иметь возможность обнаружения пользователя в любой из этих сред.
  
Чтобы мобильные клиенты могли обнаруживать, где находится пользователь, служба автообнаружения должна быть настроена с помощью нового URL-адреса. Ниже описана последовательность действий.
  
1. Откройте консоль управления Skype для бизнеса Server.
    
2. Выполните следующую команду, чтобы получить значение атрибута **ProxyFQDN** для среды Skype для бизнеса Server:
    
   ```powershell
   Get-CsHostingProvider
   ```

3. Затем в окне командной консоли выполните команду:
    
   ```powershell
   Set-CsHostingProvider -Identity [identity] -AutodiscoverUrl https://webdir.online.lync.com/autodiscover/autodiscoverservice.svc/root
   ```

    Где [идентификатор] заменяется именем домена общего пространства адресов SIP.
    
## <a name="test-your-mobility-deployment"></a>Тестирование развертывания мобильности
<a name="TestMobility"> </a>

После того как вы развернули службу Mobility Service для Skype для бизнеса Server и службу автообнаружения Skype для бизнеса Server, вам потребуется выполнить тестовую транзакцию, чтобы убедиться, что ваше развертывание работает правильно. С помощью командлета **Test-CsUcwaConference** можно проверить возможность создания, присоединения и общения двух пользователей в Конференции. Для выполнения этого тестирования потребуются два пользователя (реальный или тестовый) и их полные учетные данные. Эта команда будет работать как для клиентов Skype для бизнеса, так и для клиентов Lync Server 2013.
  
Для пользователей Lync Server 2010 в Skype для бизнеса Server 2015 вам потребуется выполнить **Test-CsMcxP2PIM** для тестирования. Пользователи Lync Server 2010 по-прежнему должны быть реальными пользователями или предварительно определенными тестовыми пользователями, и вам понадобятся учетные данные их паролей.

> [!NOTE]
> MCX (служба Mobility Service) поддержка устаревших мобильных клиентов больше недоступна в Skype для бизнеса Server 2019. Все текущие мобильные клиенты Skype для бизнеса уже используют веб-API объединенных коммуникаций (UCWA), чтобы поддерживать обмен мгновенными сообщениями, сведения о присутствии и контакты. Пользователям прежних версий клиентов, использующих MCX, необходимо выполнить обновление до текущего клиента.
  
### <a name="test-conferencing-for-skype-for-business-and-lync-2013-mobile-clients"></a>Тестирование конференц-связи для мобильных клиентов Skype для бизнеса и Lync 2013

1. Выполните вход в качестве члена роли **CsAdministrator** на любом компьютере, на котором установлены **Командная консоль и OCSCore для управления Skype для бизнеса Server** . ****
    
2. Запустите **командную консоль Skype для бизнеса Server** (введите имя в поле Поиск или выберите **все программы** и выберите ее).
    
3. В командной строке введите:
    
   ```powershell
   Test-CsUcwaConference -TargetFqdn <FQDN of Front End pool> -Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID> -OrganizerSipAddress sip:<SIP address of test user 1> -OrganizerCredential <test user 1 credentials> -ParticipantSipAddress sip:<SIP address of test user 2> -ParticipantCredential <test user 2 credentials> -v
   ```

   Кроме того, можно задать учетные данные в сценарии и передать их в командлет Test. Ниже приведен пример.
    
   ```powershell
   $passwd1 = ConvertTo-SecureString "Password01" -AsPlainText -Force
   $passwd2 = ConvertTo-SecureString "Password02" -AsPlainText -Force
   $testuser1 = New-Object Management.Automation.PSCredential("contoso\UserName1", $passwd1)
   $testuser2 = New-Object Management.Automation.PSCredential("contoso\UserName2", $passwd2)
   Test-CsUcwaConference -TargetFqdn pool01.contoso.com -Authentication Negotiate -OrganizerSipAddress sip:UserName1@contoso.com -OrganizerCredential $testuser1 -ParticipantSipAddress sip:UserName2@contoso.com -ParticipantCredential $testuser2 -v
   ```

### <a name="test-conferencing-for-lync-2010-mobile-clients"></a>Проверка конференц-связи для мобильных клиентов Lync 2010

> [!NOTE]
> MCX (служба Mobility Service) поддержка устаревших мобильных клиентов больше недоступна в Skype для бизнеса Server 2019. Все текущие мобильные клиенты Skype для бизнеса уже используют веб-API объединенных коммуникаций (UCWA), чтобы поддерживать обмен мгновенными сообщениями, сведения о присутствии и контакты. Пользователям прежних версий клиентов, использующих MCX, необходимо выполнить обновление до текущего клиента.

1. Выполните вход в качестве члена роли **CsAdministrator** на любом компьютере, на котором установлены **Командная консоль и OCSCore для управления Skype для бизнеса Server** . ****
    
2. Запустите **командную консоль Skype для бизнеса Server** (введите имя в поле Поиск или выберите **все программы** и выберите ее).
    
3. В командной строке введите:
    
   ```powershell
   Test-CsMcxP2PIM -TargetFqdn <FQDN of Front End pool> -Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID> -SenderSipAddress sip:<SIP address of test user 1> -SenderCredential <test user 1 credentials> -ReceiverSipAddress sip:<SIP address of test user 2> -ReceiverCredential <test user 2 credentials> -v
   ```

   Кроме того, можно задать учетные данные в сценарии и передать их в командлет Test. Ниже приведен пример.
    
   ```powershell
   $passwd1 = ConvertTo-SecureString "Password01" -AsPlainText -Force
   $passwd2 = ConvertTo-SecureString "Password02" -AsPlainText -Force
   $tuc1 = New-Object Management.Automation.PSCredential("contoso\UserName1", $passwd1)
   $tuc2 = New-Object Management.Automation.PSCredential("contoso\UserName2", $passwd2)
   Test-CsMcxP2PIM -TargetFqdn pool01.contoso.com -Authentication Negotiate -SenderSipAddress sip:UserName1@contoso.com -SenderCredential $tuc1 -ReceiverSipAddress sip:UserName2@contoso.com -ReceiverCredential $tuc2 -v
   ```

Для дальнейшей проверки процедур командной строки можно извлечь [тест-CsUcwaConference](https://docs.microsoft.com/powershell/module/skype/test-csucwaconference?view=skype-ps) и [Test-CsMcxP2PIM](https://docs.microsoft.com/powershell/module/skype/test-csmcxp2pim?view=skype-ps).
  
## <a name="configure-for-push-notifications"></a>Настройка для использования push-уведомлений
<a name="ConfigPush"> </a>

Push-уведомления, в форме эмблем, значков или оповещений, могут быть отправлены на мобильное устройство, даже если приложение Skype или Lync неактивно. Но что такое push-уведомления? Они представляют собой оповещения о событиях, такие как новое или пропущенное приглашение на обмен мгновенными сообщениями, а также на получение голосовой почты. Служба Mobility Server для Skype для бизнеса Server отправляет эти уведомления в облачную службу push-уведомлений Skype для бизнеса Server, которая затем отправляет уведомления в службу push-уведомлений Майкрософт (МСНС) для пользователей Windows Phone.
  
Эта функция не изменилась с Lync Server 2013, но если у вас есть Skype для бизнеса Server, вам потребуется выполнить следующие действия:
  
- Для пограничного сервера Skype для бизнеса Server добавьте нового поставщика услуг хостинга, Microsoft Skype для бизнеса Online, а затем настройте Федерацию поставщика услуг хранения между вашей организацией и Skype для бизнеса Online.
    
- Включите push-уведомления, выполнив командлет **Set-CsPushNotificationConfiguration** . По умолчанию push-уведомления отключены.
    
- Протестируйте конфигурацию Федерации и Push-уведомления.
    
### <a name="configure-your-skype-for-business-edge-server-for-push-notifications"></a>Настройка пограничного сервера Skype для бизнеса для push-уведомлений

1. Войдите в систему, используя учетную запись, которая является участником роли **CsAdministrator** , на компьютер, на котором установлены Командная консоль и **OCSCore** **консоли управления Skype для бизнеса Server** .
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Добавьте поставщик услуг хостинга Skype для бизнеса Server Online.
    
   ```powershell
   New-CsHostingProvider -Identity <unique identifier for hosting provider> -Enabled $True -ProxyFQDN <FQDN for the Access Server used by the hosting provider> -VerificationLevel UseSourceVerification
   ```

   Например:
    
   ```powershell
   New-CsHostingProvider -Identity "SkypeOnline" -Enabled $True -ProxyFQDN "sipfed.online.lync.com" -VerificationLevel UseSourceVerification
   ```

    > [!NOTE]
    > Вы не можете использовать несколько отношений Федерации с одним поставщиком услуг хостинга. Таким образом, если вы уже настроили поставщика услуг хостинга с отношением Федерации с sipfed.online.lync.com, не добавляйте для него другого поставщика услуг хостинга, даже если идентификатор поставщика услуг хостинга не является Скипеонлине. 
  
4. Настройте федерацию поставщика услуг хостинга между вашей организацией и службой push-уведомлений в Skype для бизнеса Online. В командной строке необходимо ввести:
    
   ```powershell
    New-CsAllowedDomain -Identity "push.lync.com"
   ```

### <a name="enable-push-notifications"></a>Включение push-уведомлений

1. Войдите в систему, используя учетную запись, которая является участником роли **CsAdministrator** , на компьютер, на котором установлены Командная консоль и **OCSCore** **консоли управления Skype для бизнеса Server** .
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Включить push-уведомления:
    
   ```powershell
   Set-CsPushNotificationConfiguration -EnableMicrosoftPushNotificationService $True
   ```

4. Включение Федерации:
     
   ```powershell
   Set-CsAccessEdgeConfiguration -AllowFederatedUsers $True
   ```

### <a name="test-federation-and-push-notifications"></a>Тестирование Федерации и push-уведомлений

1. Войдите в систему, используя учетную запись, которая является участником роли **CsAdministrator** , на компьютер, на котором установлены Командная консоль и **OCSCore** **консоли управления Skype для бизнеса Server** .
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Тестирование конфигурации федерации:
    
   ```powershell
   Test-CsFederatedPartner -TargetFqdn <FQDN of Access Edge server used for federated SIP traffic> -Domain <FQDN of federated domain> -ProxyFqdn <FQDN of the Access Edge server used by the federated organization>
   ```

    Например:
    
   ```powershell
   Test-CsFederatedPartner -TargetFqdn accessproxy.contoso.com -Domain push.lync.com -ProxyFqdn sipfed.online.lync.com
   ```

4. Протестируйте push-уведомления:
    
   ```powershell
   Test-CsMcxPushNotification -AccessEdgeFqdn <Access Edge service FQDN>
   ```

    Например:
    
   ```powershell
   Test-CsMcxPushNotification -AccessEdgeFqdn accessproxy.contoso.com
   ```

## <a name="configure-mobility-policy"></a>Настройка политики мобильности
<a name="ConfigMob"> </a>

С помощью Skype для бизнеса Server можно определить, кто может использовать службу Mobility Service, позвонить через Works, Voice over IP (VoIP) или видео, а также требуется ли WiFi для VoIP или видео. "Позвонить с рабочего" — позволяет мобильному пользователю использовать номер рабочего телефона, а не номер мобильного телефона при размещении и получении звонков. Пользователь, находящийся на другом конце строки, не увидит номер сотового телефона пользователя мобильного устройства, и он позволяет пользователям мобильных устройств избежать оплаты исходящих звонков. Когда VoIP и видео настроены, пользователи могут совершать и совершать звонки и видео по VoIP. Параметры использования Wi-Fi определяют, потребуется ли мобильному устройству пользователя использовать сеть Wi-Fi через сотовую сеть передачи данных.
  
По умолчанию включены мобильные устройства, звонки через работу и функции VoIP и видео. Параметр требования WiFi для VoIP и Video отключены. Администратор может изменять это, как глобально, по сайту или по пользователю.
  
Чтобы иметь возможность использовать функции мобильной связи и звонить через работу, пользователям необходимо:
  
- Включен для Skype для бизнеса Server
    
- Включено для корпоративной голосовой связи.
    
- Назначена политика мобильности с установленным значением **true**для параметра **енаблемобилити** .
    
Чтобы пользователи могли использовать функцию "позвонить с рабочего", они также должны быть:
  
- Назначена политика голосовой связи, в которой выбран параметр **включить Одновременный звонок для телефонов** .
    
- Назначена политика мобильности со свойством **енаблеаутсидевоице** , равным **true**.
    
> [!NOTE]
> Пользователи, не поддерживающие корпоративную голосовую связь, могут использовать свои мобильные устройства для совершения звонков в Skype для VoIP или присоединяться к конференциям с помощью ссылки щелкните, чтобы присоединиться на мобильных устройствах, если соответствующие параметры настроены для соответствующей политики голосовой связи. у. В разделе Планирование есть более подробные сведения. 
  
### <a name="modify-global-mobility-policy"></a>Изменение глобальной политики мобильности

1. Войдите в систему, используя учетную запись, которая является участником роли **CsAdministrator** , на компьютер, на котором установлены Командная консоль и **OCSCore** **консоли управления Skype для бизнеса Server** .
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Отключите доступ к мобильному и мобильному телефону, введя:
    
   ```powershell
   Set-CsMobilityPolicy -EnableMobility $False -EnableOutsideVoice $False
   ```

    > [!NOTE]
    > Вы можете отключить функцию "позвонить с рабочего", не отключив доступ к мобильному режиму. Но вы не можете отключить мобильное взаимодействие, не отключая функцию "позвонить через". 
  
    Для получения дополнительных сведений ознакомьтесь со статьей [Set — CsMobilityPolicy](https://docs.microsoft.com/powershell/module/skype/set-csmobilitypolicy?view=skype-ps).
    
### <a name="modify-mobility-policy-by-site"></a>Изменение политики мобильности по сайту

1. Войдите в систему, используя учетную запись, которая является участником роли **CsAdministrator** , на компьютер, на котором установлены Командная консоль и **OCSCore** **консоли управления Skype для бизнеса Server** .
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Вы можете создать политику на уровне сайта, отключить VoIP и видео, включить параметр требовать WiFi для IP-звука и требовать WiFi для IP-видео по сайту. Тип:
    
   ```powershell
   New-CsMobilityPolicy -Identity site:<site identifier> -EnableIPAudioVideo $false -RequireWiFiForIPAudio $True -RequireWiFiforIPVideo $True
   ```

    Узнайте больше в статье [New – CsMobilityPolicy](https://docs.microsoft.com/powershell/module/skype/new-csmobilitypolicy?view=skype-ps).
    
### <a name="modify-mobility-policy-by-user"></a>Изменение политики мобильности по пользователям

1. Войдите в систему, используя учетную запись, которая является участником роли **CsAdministrator** , на компьютер, на котором установлены Командная консоль и **OCSCore** **консоли управления Skype для бизнеса Server** .
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Создание политик мобильности на уровне пользователей и выключение мобильности и звонки через работу по пользователям. Тип:
    
   ```powershell
   New-CsMobilityPolicy -Identity <policy name> -EnableMobility $False -EnableOutsideVoice $False
   Grant-CsMobilityPolicy -Identity <user identifier> -PolicyName <policy name>
   ```

    Ниже приведен пример с примерами данных.
    
   ```powershell
   New-CsMobilityPolicy "tag:disableOutsideVoice" -EnableOutsideVoice $False
   Grant-CsMobilityPolicy -Identity MobileUser1@contoso.com -PolicyName tag:disableOutsideVoice
   ```

    > [!NOTE]
    > Вы можете отключить функцию "позвонить с рабочего", не отключив доступ к мобильному режиму. Но вы не можете отключить мобильное взаимодействие, не отключая функцию "позвонить через". 
  

