---
title: Развертывание и Настройка мобильных устройств для Skype для бизнеса Server
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.assetid: 8ec6197a-3d1e-4b42-9465-564044cdab1a
description: В этой статье рассказывается о том, как настроить существующую установку Skype для бизнеса Server для использования службы Mobility Service, благодаря чему ваши мобильные устройства смогут пользоваться мобильными функциями Skype для бизнеса Server.
ms.openlocfilehash: 3e39c354fd77d7ac36e3a4c36ed7e36e1d8ffbbf
ms.sourcegitcommit: fe274303510d07a90b506bfa050c669accef0476
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/09/2020
ms.locfileid: "41002869"
---
# <a name="deploy-and-configure-mobility-for-skype-for-business-server"></a>Развертывание и Настройка мобильных устройств для Skype для бизнеса Server  
 
В этой статье рассказывается о том, как настроить существующую установку Skype для бизнеса Server для использования службы Mobility Service, благодаря чему ваши мобильные устройства смогут пользоваться мобильными функциями Skype для бизнеса Server.
  
Проверили [план мобильных устройств для работы со статьей Skype для бизнеса Server](../plan-your-deployment/mobility.md) , вы должны будете выполнить указанные ниже действия, чтобы развернуть мобильность в среде Skype для бизнеса Server. Эти шаги описаны ниже (в этом случае список разрешений включается в эту таблицу):
  
|**Этап**|**Разрешения**|
|:-----|:-----|
|[Создание записей DNS](deploy-and-configure-mobility.md#CreateDNSRec) <br/> |Администраторы домена  <br/> DNSAdmins  <br/> |
|[Изменение сертификатов](deploy-and-configure-mobility.md#ModCerts) <br/> |Локальный администратор  <br/> |
|[Настройка обратного прокси-сервера](deploy-and-configure-mobility.md#ConfigRP) <br/> |Локальный администратор  <br/> |
|[Настройка службы автообнаружения для мобильной работы с гибридными развертываниями](deploy-and-configure-mobility.md#ConfigAutoD) <br/> |Администраторы домена  <br/> |
|[Тестирование развертывания мобильности](deploy-and-configure-mobility.md#TestMobility) <br/> |CsAdministrator  <br/> |
|[Настройка для использования push-уведомлений](deploy-and-configure-mobility.md#ConfigPush) <br/> |RtcUniversalServerAdmins  <br/> |
|[Настройка политики мобильности](deploy-and-configure-mobility.md#ConfigMob) <br/> |CsAdministrator  <br/> |
   
Перед выполнением действий, описываемых в следующих разделах, необходимо ознакомиться с разделом, посвященным планированию. Если у вас возникают какие-либо вопросы, обращайтесь к этому разделу.

> [!NOTE]
> Поддержка МККС (служба Mobility Service) для устаревших мобильных клиентов больше не доступна в Skype для бизнеса Server 2019. На всех текущих мобильных клиентах Skype для бизнеса уже используется веб-API единой системы обмена сообщениями (УКВА) для поддержки мгновенных сообщений, присутствия и контактов. Пользователи с устаревшими клиентами, использующими МККС, должны обновиться до текущего клиента.
  
## <a name="create-dns-records"></a>Создание записей DNS
<a name="CreateDNSRec"> </a>

Возможно, у вас уже есть эти данные в среде Skype для бизнеса, но для работы автообнаружение вам потребуется создать следующие записи:
  
- Внутренняя DNS-запись для поддержки мобильных пользователей, которые подключаются изнутри сети организации
    
- Внутренняя DNS-запись для поддержки мобильных пользователей, которые подключаются из-за пределов сети организации
    
Это могут быть записи имен A (узел) или CNAME. Обратите внимание, что создавать записи обоих типов не обязательно, поскольку в этой статье описываются все возможные варианты действий.
  
### <a name="create-an-internal-dns-cname-record"></a>Создание внутренней DNS-записи CNAME

1. Войдите в систему DNS-сервера в сети, который входит в группу **Администраторы домена** или **DnsAdmins**.
    
2. Нажмите кнопку **Пуск** и выберите **Администрирование**. Если этот компонент отсутствует в меню "Пуск", воспользуйтесь полем **Поиск**. Затем щелкните **DNS**, чтобы открыть административную оснастку DNS.
    
3. В левой области окна консоли нужно перейти к домену, который находится дома, на серверы переднего плана Skype для бизнеса Server и расширить **зоны прямого просмотра** .
    
4. Проверьте, какие из следующих записей присутствуют в этом узле:
    
   - Любые записи A или AAAA для серверов переднего плана (Стандартная или Корпоративная) или пулов переднего плана (-ов).
    
   - Любые записи A или AAAA для режиссера или пула (дополнительная конфигурация, возможно, есть в развертывании).
    
5. После этого щелкните правой кнопкой мыши имя домена SIP и выберите в меню пункт **Создать псевдоним (CNAME)**.
    
6. В текстовое поле **Имя псевдонима** введите lyncdiscoverinternal в качестве имени узла для URL-адреса внутренней службы автообнаружения.
    
7. В полном **доменном имени (FQDN для целевого узла**) необходимо ввести или просмотреть полное доменное имя внутренних веб-служб для пула переднего плана (или сервер пула или режиссера), определенное в действии 4 выше. Click OK when this is entered.
    
8. Вам потребуется создать новую запись автообнаружения CNAME в зоне прямого просмотра для каждого домена SIP, поддерживаемого в среде Skype для бизнеса Server.
    
### <a name="create-an-external-dns-cname-record"></a>Создание внешней DNS-записи CNAME

1. Поскольку вы можете использовать разных общедоступных поставщиков DNS, в этом разделе приводятся универсальные действия. Войдите в систему общедоступного поставщика DNS с использованием учетной записи с правами на создание новых записей DNS.
    
2. На данный момент домен SIP уже должен существовать в Skype для бизнеса Server. Разверните узел **Зоны прямого просмотра** для этого домена SIP или откройте его любым другим способом.
    
3. Проверьте, какие из следующих записей присутствуют в этом узле:
    
   - Любые записи A или AAAA для серверов переднего плана (Стандартная или Корпоративная) или пулов переднего плана (-ов).
    
   - Любые записи A или AAAA для режиссера или пула (дополнительная конфигурация, возможно, есть в развертывании).
    
4. Имея на руках эти сведения, вы можете выбрать команду **Создать псевдоним (CNAME)**.
    
5. В поле **Имя псевдонима** введите lyncdiscover в качестве URL-адреса внешней службы автообнаружения.
    
6. Далее должна находиться область, в которой будет указываться **полное доменное имя для целевого узла**, оно должно быть полным доменным именем для пула переднего плана (или сервера пула или режиссера), определенного в действии 3 выше.
    
7. Возможно, вам потребуется сохранить эти данные или, если вам нужно создать дополнительные записи CNAME в зоне прямого просмотра каждого домена SIP в среде Skype для бизнеса Server, вы должны сделать это, но после этого вы сможете сохранить свою работу.
    
### <a name="create-an-internal-dns-a-record"></a>Создание записи A внутреннего DNS

1. Войдите в систему DNS-сервера в сети, который входит в группу **Администраторы домена** или **DnsAdmins**.
    
2. Нажмите кнопку **Пуск** и выберите **Администрирование**. Если этот компонент отсутствует в меню "Пуск", воспользуйтесь полем **Поиск**. Затем щелкните **DNS**, чтобы открыть административную оснастку DNS.
    
3. В левой области окна консоли нужно перейти к домену, который находится дома, на серверы переднего плана Skype для бизнеса Server и расширить **зоны прямого просмотра** .
    
4. Проверьте, какие из следующих записей присутствуют в этом узле:
    
   - Любые записи A или AAAA для серверов переднего плана (Стандартная или Корпоративная) или пулов переднего плана (-ов).
    
   - Любые записи A или AAAA для режиссера или пула (дополнительная конфигурация, возможно, есть в развертывании).
    
5. После этого щелкните правой кнопкой мыши имя домена SIP и выберите в меню пункт **Создать узел (A или AAAA)**.
    
6. В текстовое поле **Имя** введите lyncdiscoverinternal в качестве имени узла для URL-адреса внутренней службы автообнаружения.
    
7. В поле **IP Address** TEXTBOX введите IP-адрес внутренней веб-службы для пула переднего плана (или для внешнего сервера или режиссера), идентифицированный в действии 4 выше.
    
8. Затем щелкните **Добавить узел** и нажмите кнопку **ОК**.
    
9. Для каждого домена SIP, поддерживаемого в среде Skype для бизнеса, необходимо создать новые записи A или AAAA для автообнаружения в зоне прямого просмотра. Для этого повторяйте шаги с 6 по 8 необходимое число раз.
    
10. По завершении нажмите кнопку **Готово**.
    
### <a name="create-an-external-dns-a-record"></a>Создание записи A внешнего DNS

1. Поскольку вы можете использовать разных общедоступных поставщиков DNS, в этом разделе приводятся универсальные действия. Войдите в систему общедоступного поставщика DNS с использованием учетной записи с правами на создание новых записей DNS.
    
2. На данный момент домен SIP уже должен существовать в Skype для бизнеса Server. Разверните узел **Зоны прямого просмотра** для этого домена SIP или откройте его любым другим способом.
    
3. Проверьте, какие из следующих записей присутствуют в этом узле:
    
   - Любые записи A или AAAA для серверов переднего плана (Стандартная или Корпоративная) или пулов переднего плана (-ов).
    
   - Любые записи A или AAAA для режиссера или пула (дополнительная конфигурация, возможно, есть в развертывании).
    
4. Имея на руках эти сведения, вы можете выбрать команду **Создать узел (A или AAAA)**.
    
5. В поле **Имя** введите lyncdiscover в качестве URL-адреса внешней службы автообнаружения.
    
6. В этом случае необходимо, чтобы в **IP-адресах**была указана область, для вашего пула переднего плана (или внешнего сервера или режиссера или режиссера), определенного в действии 3 выше, должен быть указан адрес IP.
    
7. Возможно, вам потребуется сохранить эти данные или, если вам нужно создать дополнительные записи A или AAAA в зоне прямого просмотра каждого домена SIP для серверной среды Skype для бизнеса, вы должны выполнить эти действия, но после этого вы сможете сохранить свою работу.
    
## <a name="modify-certificates"></a>Изменение сертификатов
<a name="ModCerts"> </a>

Если у вас возникли вопросы по планированию сертификатов, мы задокументировани, что в нашем плане для обеспечения мобильной связи с этой статьей [Skype для бизнеса Server](../plan-your-deployment/mobility.md) . После этого вы можете продолжать знакомство с этим пошаговым руководством:
  
- Требуются ли новые сертификаты?
    
- Запрос новых сертификатов из центра сертификации.
    
- Замена существующих сертификатов новыми с помощью PowerShell.
    
- Проверка сертификатов с помощью оснастки «Сертификаты» в консоли управления (MMC).
    
### <a name="do-i-need-new-certificates"></a>Требуются ли новые сертификаты?

1. Сначала требуется проверить существующие сертификаты и наличие в них необходимых записей. Для этого вам потребуется войти на сервер Skype для бизнеса с учетной записью, которая является локальным администратором. Кроме того, для выполнения некоторых действий этой учетной записи могут потребоваться права на доступ к выдающему центру сертификации.
    
2. Откройте командную консоль управления Skype для бизнеса Server (чтобы найти ее, если она не закреплена в меню "Пуск" или на панели задач), можно воспользоваться поиском.
    
3. Важно знать, какие сертификаты были назначены до того, как вы попытаетесь добавить или обновить сертификат. В командной строке введите следующую команду:
    
   ```powershell
   Get-CsCertificate
   ```

4. На шаге 3 вы получите сведения, относящиеся к вашей уникальной среде. Опираясь на них, определите, используются ли у вас один или несколько сертификатов для нескольких компонентов. Параметр **Использование** содержит информацию об использовании сертификата, а параметр **Отпечаток** определяет, применяются ли для этих целей один или несколько сертификатов.
    
5. Если вы не настроили записи альтернативного имени субъекта согласно рекомендациям в разделе "Планирование", вам необходимо запросить один или несколько новых сертификатов (в зависимости от конфигурации) из центра сертификации.
    
### <a name="request-a-new-certificate-or-certificates-from-your-certificate-authority-ca"></a>Запрос одного или нескольких новых сертификатов из центра сертификации.

1. Проверив существующие записи альтернативного имени субъекта по описанной выше процедуре, вы определили наличие **одного сертификата** и обнаружили, что некоторые необходимые записи отсутствуют. В этом случае вам необходимо запросить новый сертификат в центре сертификации. Откройте сервер PowerShell в Skype для бизнеса Server:
    
   - Для отсутствующей записи альтернативного имени субъекта для службы автообнаружения (замените параметр -Ca путем к вашему центру сертификации):
    
   ```powershell
   Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -AllSipDomain -verbose
   ```

   - Теперь, если у вас есть несколько доменов SIP, нельзя использовать параметр Аллсипдомаин, как в приведенном выше примере. Вместо этого необходимо использовать параметр имя_домена. А если вы используете параметр DomainName, вам нужно определить полное доменное имя для записей линкдисковеринтернал и lyncdiscover. Например, вы можете заменить параметр-CA на собственный путь к центру сертификации.
    
   ```powershell
   Request-CsCertificate -New -Type Default,WebServicesInternal,WebServicesExternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
   ```

2. Проверив существующие записи альтернативного имени субъекта по описанной выше процедуре, вы определили наличие **нескольких сертификатов** и обнаружили, что некоторые необходимые записи отсутствуют. В этом случае вам необходимо запросить новый сертификат в центре сертификации. Откройте сервер PowerShell в Skype для бизнеса Server:
    
   - Для отсутствующей записи альтернативного имени субъекта для службы автообнаружения (замените параметр -Ca путем к вашему центру сертификации):
    
   ```powershell
   Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -AllSipDomain -verbose
   ```

   - Теперь, если у вас есть несколько доменов SIP, нельзя использовать параметр Аллсипдомаин, как в приведенном выше примере. Вместо этого необходимо использовать параметр имя_домена. А если вы используете параметр DomainName, вам нужно определить полное доменное имя для записей линкдисковеринтернал и lyncdiscover. В качестве примера можно привести (заменив параметр-CA на собственный путь к центру сертификации):
    
   ```powershell
   Request-CsCertificate -New -Type WebServicesInternal -Ca dc\myca -DomainName "LyncdiscoverInternal.contoso.com, LyncdiscoverInternal.contoso.net" -verbose
   ```

   ```powershell
   Request-CsCertificate -New -Type WebServicesExternal -Ca dc\myca -DomainName "Lyncdiscover.contoso.com, Lyncdiscover.contoso.net" -verbose
   ```

   - После создания новых сертификатов в центре сертификации вам необходимо назначить их.
    
### <a name="assign-certificates-using-skype-for-business-server-management-shell"></a>Назначение сертификатов с помощью командной консоли Skype для бизнеса Server

- В зависимости от результатов анализа среды, проведенного в разделе "Требуются ли новые сертификаты?", вам необходимо выполнить **одно** из следующих действий.
    
  - Если вы используете для всех компонентов один и тот же сертификат (одинаковые отпечатки), выполните следующую команду:
    
  ```powershell
  Set-CsCertificate -Type <certificate(s) from the Use parameter> -Thumbprint <unique identifier>
  ```

  - Если вы используете несколько сертификатов с разными отпечатками, выполните следующую команду:
    
  ```powershell
  Set-CsCertificate -Type Default -Thumbprint <certificate thumbprint>
  Set-CsCertificate -Type WebServicesInternal -Thumbprint <certificate thumbprint>
  Set-CsCertificate -Type WebServicesExternal -Thumbprint <certificate thumbprint>
  ```

### <a name="viewing-certificates-in-the-microsoft-management-console-mmc"></a>Просмотр сертификатов с помощью консоли управления (MMC)

1. Для просмотра всех сертификатов вы можете использовать оснастку сертификатов в консоли MMC. Чтобы открыть это приложение во всплывающем окне, достаточно ввести "MMC" в поле поиска.
    
2. Чтобы добавить оснастку сертификатов, щелкните **Файл** и выберите **Добавить или удалить оснастку** (также можно использовать сочетание клавиш **CTRL+M**). Выберите элемент **Сертификаты** в панели слева, щелкните **Учетная запись компьютера** во всплывающем окне и нажмите кнопку **Далее**.
    
3. Во всплывающем окне по-прежнему вы можете сделать это на компьютере, который вам нужен, поэтому оставьте это на **локальном компьютере** , если это так. Если вы работаете на удаленном компьютере, измените переключатель переключателя на **другой компьютер** , а затем введите полное доменное имя компьютера или нажмите кнопку **Обзор** , чтобы выполнить поиск этого компьютера через AD. После выбора компьютера вам потребуется нажать кнопку **Готово** , а затем **OK** , чтобы добавить оснастку в MMC.
    
4. Разверните раздел **Сертификаты** на левой панели MMC. Разверните **личную** папку, а затем выберите пункт **Сертификаты**. Это позволит увидеть сертификаты в этом магазине.
    
5. Найдите нужный сертификат, щелкните его правой кнопкой мыши и выберите пункт **Открыть**.
    
    > [!NOTE]
    > How do you know what certificate this is? Это должен быть один и тот же сертификат, назначенный всем для вашей фермы, или несколько сертификатов для разных целей, например по умолчанию, внутренние веб-службы и т. д., в этом случае вам может потребоваться ознакомиться с несколькими сертификатами. Multiple certificates will have the same thumbprint. 
  
6. В представлении **Сертификат** выберите **Сведения**. В этом разделе вы сможете просмотреть имя субъекта сертификата (выберите **Subject**), назначенное имя субъекта, а также связанные свойства.
    
7. Также следует проверить записи **Альтернативное имя субъекта**. В них вы можете найти следующую информацию:
    
   - Имя пула для этого пула или имя отдельного сервера, если он не является пулом.
    
   - Имя сервера, которому назначен сертификат.
    
   - Записи простых URL-адресов (обычно meet и dialin).
    
   - Внутренние имена внутренних и веб-служб (например, webpool01.contoso.net, webpool01.contoso.com), основанные на вариантах, сделанных в построителе топологии, и переопределяемые выборы веб-служб.
    
   - Если уже назначено, lyncdiscover. \<сипдомаин\> и линкдисковеринтернал. \<сипдомаин\> записи.
    
     Если назначено несколько сертификатов, необходимо проверить наличие множественных сертификатов (см. примечание выше).
    
8. Итак, если вы нашли lyncdiscover. \<сипдомаин\> и линкдисковеринтернал. \<сипдомаин\> записи, у вас уже есть такая настройка. Закройте консоль MMC.
    
9. Если они не назначены, необходимо запросить новый сертификат (см. выше) или установить их после запроса (для этого рекомендуется использовать представленный выше командлет PowerShell).
    
## <a name="configure-the-reverse-proxy"></a>Настройка обратного прокси-сервера
<a name="ConfigRP"> </a>

Представленные ниже шаги не обязательно выполнять в точности. Например, в предыдущих версиях продукта требовалась настройка Threat Management Gateway (TMG), поэтому если этот компонент не используется, вы можете пропустить соответствующие действия.
  
TMG больше не предлагается корпорацией Майкрософт в качестве продукта, и если вы по-прежнему хотите настроить его, вы можете ознакомиться с [пошаговыми инструкциями Lync Server 2013](https://technet.microsoft.com/en-us/library/hh690011%28v=ocs.15%29.aspx). Но приведенные ниже сведения предназначены для более широкого использования, даже если вы не можете предоставить определенные шаги в пошаговом руководстве для каждого обратного прокси-сервера.
  
Необходимо учитывать два основных момента:
  
- Будет ли выполняться первоначальный запрос службы автообнаружения по протоколу HTTPS (рекомендуется)?
    
  - Если у вас есть правило веб-публикации, его необходимо изменить.
    
  - Если у вас нет правила веб-публикации, его необходимо создать.
    
- Если первоначальный запрос службы автообнаружения выполняется по протоколу HTTP, также необходимо создать или изменить это правило.
    
> [!NOTE]
> **Важно!** Значение времени ожидания прокси-сервера — это число, которое будет отличаться в зависимости от развертывания до развертывания. Необходимо следить за развертыванием и изменять значение для оптимальной работы клиентов. Вы можете установить значение как минимум 200. Если у вас есть поддержка мобильных клиентов Lync в своей среде, необходимо установить для этого параметра значение 960, чтобы разрешить время ожидания push-уведомлений в Office 365, для которого установлено значение таймаута, равное 900. Скорее, вам придется увеличить время ожидания, чтобы избежать отключения клиента, если значение слишком низкое, либо уменьшить число, если соединение через прокси-сервер не отключается, но очищается долго после отключения клиента. Мониторинг и баселининг того, что обычно подходит для вашей среды, — единственный способ определить подходящую настройку для этого значения.
  
### <a name="modify-the-existing-web-publishing-rule-for-your-external-autodiscover-san-and-url"></a>Изменение существующего правила веб-публикации для внешних альтернативного имени субъекта и URL-адреса автообнаружения

1. Откройте интерфейс обратного прокси-сервера.
    
2. Вам потребуется найти правило веб-публикации и нажать кнопку Изменить (возможно, оно находится в меню или на вкладке) в зависимости от настройки обратной прокси-сервера.
    
3. Должна быть область, указывающая на то, к чему относится данное правило веб-публикации. Вам необходимо изменить это правило для входящих сайтов или запросов сайтов. В этом случае необходимо **добавить** новую запись.
    
4. Введите имя сайта автообнаружения (пример, который мы будем использовать: lyncdiscover.contoso.com) и нажмите кнопку **ОК** или **сохранить**в зависимости от формата обратного прокси-сервера.
    
5. You may have a new certificate that has the Autodiscover SAN entry in it. , Которые должны быть установлены и настроены для использования в соответствии с параметрами обратного прокси-сервера. Be sure to save everything when the configuration is completed.
    
6. Если у вашего обратного прокси-сервера есть **Тестовая** функциональность, то для обеспечения правильного функционирования убедитесь, что она используется.
    
7. Теперь вам может потребоваться повторить эти действия, если в вашей среде есть режиссер или режиссер (это означает, что у вас есть второе правило).
    
### <a name="create-a-web-publishing-rule-for-the-external-autodiscover-url"></a>Создание правила веб-публикации для внешнего URL-адреса автоавтообнаружения

1. Откройте интерфейс обратного прокси-сервера.
    
2. Вам нужно найти место в интерфейсе, где вы создали правила веб-публикации, и выбрать команду Создать или **создать** (возможно, она находится в **меню или на** вкладке) в зависимости от настройки обратной прокси-сервера. You are looking for the option to create a new web publishing rule.
    
3. Как правило, требуется ввести следующие данные:
    
   - **Имя** — имя правила.
    
   - **Действие правила**: в этом случае это правило разрешения, вы **разрешаете** прослушать обратный прокси-сервер.
    
   - Правило **публикации** или выбираемый параметр (**отдельный веб-сайт или подсистема балансировки нагрузки**).
    
   - Для внешнего доступа необходимо выбрать **SSL**.
    
   - Вам потребуется опубликовать путь для **внутренней публикации**и ввести полное доменное имя для внешних веб-служб в подсистеме балансировки нагрузки пула (или полное доменное имя для подсистемы балансировки нагрузки пула, если таковой имеется), например sfb_pool01. contoso. local.
    
   - Введите ** / *** в качестве пути, который нужно опубликовать, но вы также должны **переадресовать исходный заголовок узла**.
    
   - Кроме того, будет представлен параметр для ввода сведений о **публикации или внешнем имени**:
    
   - **Принимать запросы** (должно задаваться для доменного имени).
    
   - В поле **Имя** введите **lyncdiscover.** <sipdomain>(это URL-адрес внешней службы автообнаружения). Теперь, если вы создаете правило для URL-адреса внешней веб-службы в пуле переднего плана, вам нужно будет ввести полное доменное имя для внешних веб-служб в пуле переднего плана (например, lyncwebextpool01.contoso.com).
    
   - Будет **указан путь** , и вам нужно будет ввести ** / *** здесь.
    
   - Выберите **прослушиватель SSL** с актуальным общим сертификатом.
    
   - **Делегирование проверки подлинности** — выберите **Без делегирования**, но **разрешите** прямую проверку подлинности клиента.
    
   - Настройте применение правила ко **всем пользователям**.
    
   - На этом этапе должна быть введена вся необходимая информация.
    
4. Далее необходимо убедиться, что выполняется пересылка **исходного заголовка узла**.
    
5. Кроме того, требуется задать порты **веб-сервера** следующим образом:
    
   - **Перенаправлять запросы на HTTP-порт** — укажите порт **8080**.
    
   - **Перенаправлять запросы на SSL-порт** — укажите порт **4443**.
    
6. По завершении настройки сохраните и примените изменения, после чего протестируйте правило.
    
### <a name="create-a-web-publishing-rule-for-port-80-optional"></a>Создание правила веб-публикации для порта 80 (опционально)

1. Откройте интерфейс обратного прокси-сервера.
    
2. Вам нужно найти место в интерфейсе, где вы создали правила веб-публикации, и выбрать команду Создать или **создать** (возможно, она находится в **меню или на** вкладке) в зависимости от настройки обратной прокси-сервера. You are looking for the option to create a new web publishing rule.
    
3. Как правило, требуется ввести следующие данные:
    
   - **Имя** — имя правила.
    
   - **Действие правила**: в этом случае это правило разрешения, вы **разрешаете** прослушать обратный прокси-сервер.
    
   - Правило **публикации** или выбираемый параметр (**отдельный веб-сайт или подсистема балансировки нагрузки**).
    
   - Это должно быть **незащищенное подключение к опубликованным веб-серверу или ферме**.
    
   - Необходимо опубликовать путь для **внутренней публикации**и ввести полное доменное имя для **IP-адреса** подсистемы балансировки нагрузки пула, например sfb_pool01. contoso. local.
    
   - Введите ** / *** в качестве пути, который нужно опубликовать, но вы также должны **переадресовать исходный заголовок узла**.
    
   - Кроме того, будет представлен параметр для ввода сведений о **публикации или внешнем имени**:
    
   - **Принимать запросы** (должно задаваться для доменного имени).
    
   - В поле **Имя** введите **lyncdiscover.** <sipdomain>(это URL-адрес внешней службы автообнаружения).
    
   - Будет **указан путь** , и вам нужно будет ввести ** / *** здесь.
    
   - Вам нужно выбрать веб-прослушиватель или разрешить его создание на обратном прокси.
    
   - **Делегирование проверки подлинности** — выберите **Без делегирования**, но **запретите** прямую проверку подлинности клиента.
    
   - Настройте применение правила ко **всем пользователям**.
    
   - На этом этапе должна быть введена вся необходимая информация.
    
4. Требуется также задать порты **веб-сервера** следующим образом:
    
   - **Перенаправлять запросы на HTTP-порт** — укажите порт **8080**.
    
   - **Перенаправлять запросы на SSL-порт** — укажите порт **4443**.
    
5. По завершении настройки сохраните и примените изменения, после чего протестируйте правило.
    
## <a name="configure-autodiscover-for-mobility-with-hybrid-deployments"></a>Настройка службы автообнаружения для мобильной работы с гибридными развертываниями
<a name="ConfigAutoD"> </a>

Гибридные среды в Skype для бизнеса Server — это среды, объединяющие локальные и O365-среды. Если у вас есть Skype для бизнеса Server, работающий в гибридной среде, службе автообнаружения потребуется найти пользователя в любой из этих сред.
  
Чтобы мобильный клиенты могли определять местоположение пользователя, необходимо настроить новый URL-адрес для службы автообнаружения. Для этого требуется выполнить следующие действия:
  
1. Откройте консоль управления Skype для бизнеса Server.
    
2. Выполните указанные ниже действия, чтобы получить значение атрибута **проксифкдн** для среды Skype для бизнеса Server.
    
   ```powershell
   Get-CsHostingProvider
   ```

3. Затем, не закрывая окно оболочки, выполните следующий командлет:
    
   ```powershell
   Set-CsHostingProvider -Identity [identity] -AutodiscoverUrl https://webdir.online.lync.com/autodiscover/autodiscoverservice.svc/root
   ```

    Где [идентификатор] заменяется именем домена общего пространства адресов SIP.
    
## <a name="test-your-mobility-deployment"></a>Тестирование развертывания мобильности
<a name="TestMobility"> </a>

После того как вы развернули службу мобильной связи Skype для бизнеса Server и службу автообнаружения Skype для бизнеса Server, вам потребуется выполнить тестовую транзакцию, чтобы убедиться в правильности работы развертывания. Выполните команду **Test-CsUcwaConference**, чтобы проверить возможность создания конференции двумя пользователями, присоединения к ней и общения. Для этого вам потребуются два реальных или тестовых пользователя с полными учетными данными. Эта команда действует как для клиентов Skype для бизнеса, так и для клиентов Lync Server 2013.
  
Для клиентов Lync Server 2010 в Skype для бизнеса Server 2015 вам потребуется выполнить **тестовое тестирование CsMcxP2PIM** . Пользователи Lync Server 2010 по-прежнему должны быть реальными пользователями или предварительно определенными тестовыми пользователями, и вам понадобятся учетные данные пароля.

> [!NOTE]
> Поддержка МККС (служба Mobility Service) для устаревших мобильных клиентов больше не доступна в Skype для бизнеса Server 2019. На всех текущих мобильных клиентах Skype для бизнеса уже используется веб-API единой системы обмена сообщениями (УКВА) для поддержки мгновенных сообщений, присутствия и контактов. Пользователи с устаревшими клиентами, использующими МККС, должны обновиться до текущего клиента.
  
### <a name="test-conferencing-for-skype-for-business-and-lync-2013-mobile-clients"></a>Тестирование конференц-связи для мобильных клиентов Skype для бизнеса и Lync 2013

1. Войдите в систему под учетной записью участника роли **ксадминистратор** на любом компьютере, на котором установлены **Командная консоль управления и Окскоре Skype для бизнеса Server** . ****
    
2. Запустите **командную консоль управления Skype для бизнеса Server** (вы можете ввести имя в поле Поиск или перейдите в раздел **все программы** и выберите его).
    
3. В командной строке введите следующую команду:
    
   ```powershell
   Test-CsUcwaConference -TargetFqdn <FQDN of Front End pool> -Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID> -OrganizerSipAddress sip:<SIP address of test user 1> -OrganizerCredential <test user 1 credentials> -ParticipantSipAddress sip:<SIP address of test user 2> -ParticipantCredential <test user 2 credentials> -v
   ```

   Кроме того, можно задать учетные данные в скрипте и передать их в тестовый командлет (см. пример ниже).
    
   ```powershell
   $passwd1 = ConvertTo-SecureString "Password01" -AsPlainText -Force
   $passwd2 = ConvertTo-SecureString "Password02" -AsPlainText -Force
   $testuser1 = New-Object Management.Automation.PSCredential("contoso\UserName1", $passwd1)
   $testuser2 = New-Object Management.Automation.PSCredential("contoso\UserName2", $passwd2)
   Test-CsUcwaConference -TargetFqdn pool01.contoso.com -Authentication Negotiate -OrganizerSipAddress sip:UserName1@contoso.com -OrganizerCredential $testuser1 -ParticipantSipAddress sip:UserName2@contoso.com -ParticipantCredential $testuser2 -v
   ```

### <a name="test-conferencing-for-lync-2010-mobile-clients"></a>Тестирование конференц-связи для мобильных клиентов Lync 2010

> [!NOTE]
> Поддержка МККС (служба Mobility Service) для устаревших мобильных клиентов больше не доступна в Skype для бизнеса Server 2019. На всех текущих мобильных клиентах Skype для бизнеса уже используется веб-API единой системы обмена сообщениями (УКВА) для поддержки мгновенных сообщений, присутствия и контактов. Пользователи с устаревшими клиентами, использующими МККС, должны обновиться до текущего клиента.

1. Войдите в систему под учетной записью участника роли **ксадминистратор** на любом компьютере, на котором установлены **Командная консоль управления и Окскоре Skype для бизнеса Server** . ****
    
2. Запустите **командную консоль управления Skype для бизнеса Server** (вы можете ввести имя в поле Поиск или перейдите в раздел **все программы** и выберите его).
    
3. В командной строке введите следующую команду:
    
   ```powershell
   Test-CsMcxP2PIM -TargetFqdn <FQDN of Front End pool> -Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID> -SenderSipAddress sip:<SIP address of test user 1> -SenderCredential <test user 1 credentials> -ReceiverSipAddress sip:<SIP address of test user 2> -ReceiverCredential <test user 2 credentials> -v
   ```

   Кроме того, можно задать учетные данные в скрипте и передать их в тестовый командлет (см. пример ниже).
    
   ```powershell
   $passwd1 = ConvertTo-SecureString "Password01" -AsPlainText -Force
   $passwd2 = ConvertTo-SecureString "Password02" -AsPlainText -Force
   $tuc1 = New-Object Management.Automation.PSCredential("contoso\UserName1", $passwd1)
   $tuc2 = New-Object Management.Automation.PSCredential("contoso\UserName2", $passwd2)
   Test-CsMcxP2PIM -TargetFqdn pool01.contoso.com -Authentication Negotiate -SenderSipAddress sip:UserName1@contoso.com -SenderCredential $tuc1 -ReceiverSipAddress sip:UserName2@contoso.com -ReceiverCredential $tuc2 -v
   ```

Дополнительные сведения см. в разделах, посвященных командлетам [Test-CsUcwaConference](https://docs.microsoft.com/powershell/module/skype/test-csucwaconference?view=skype-ps) и [Test-CsMcxP2PIM](https://docs.microsoft.com/powershell/module/skype/test-csmcxp2pim?view=skype-ps).
  
## <a name="configure-for-push-notifications"></a>Настройка для использования push-уведомлений
<a name="ConfigPush"> </a>

Push notifications, in the form of badges, icons, or alerts, can be sent to a mobile device even when the Skype or Lync app is inactive. Но что такое push-уведомления? They are event alerts, like a new or missed IM invitation, or for a received voicemail. Служба мобильной связи в Skype для бизнеса Server отправляет эти уведомления на облачную службу push-уведомлений Skype для бизнеса Server, которая затем отправляет уведомления в службу извещающих уведомлений Майкрософт (МСНС) для пользователей Windows Phone.
  
Эта функция не изменилась с Lync Server 2013, но если у вас есть Skype для бизнеса Server, вам потребуется выполнить указанные ниже действия.
  
- Для пограничного сервера Skype для бизнеса Server добавьте нового поставщика услуг размещения, Microsoft Skype для бизнеса Online и настройте Федерацию поставщика услуг размещения между вашей организацией и Skype для бизнеса Online.
    
- Включите push-уведомления с помощью командлета **Set-CsPushNotificationConfiguration**. По умолчанию push-уведомления отключены.
    
- Протестируйте конфигурацию федерации и push-уведомлений.
    
### <a name="configure-your-skype-for-business-edge-server-for-push-notifications"></a>Настройка пограничного сервера Skype для бизнеса для использования push-уведомлений

1. Войдите в систему с помощью учетной записи, которая входит в роль **ксадминистратор** , на компьютер, на котором установлены **Командная консоль управления и Окскоре Skype для бизнеса Server** . ****
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Добавьте поставщика услуг размещения Skype для бизнеса Server Online.
    
   ```powershell
   New-CsHostingProvider -Identity <unique identifier for hosting provider> -Enabled $True -ProxyFQDN <FQDN for the Access Server used by the hosting provider> -VerificationLevel UseSourceVerification
   ```

   Пример:
    
   ```powershell
   New-CsHostingProvider -Identity "SkypeOnline" -Enabled $True -ProxyFQDN "sipfed.online.lync.com" -VerificationLevel UseSourceVerification
   ```

    > [!NOTE]
    > Нельзя настраивать несколько отношений федерации с одним поставщиком услуг размещения. То есть, настроив поставщик услуг размещения, имеющий отношения федерации с sipfed.online.lync.com, не добавляйте для этого сайта другой поставщик услуг размещения, даже если удостоверение поставщика отличается от SkypeOnline. 
  
4. Настройте федерацию поставщика услуг хостинга между вашей организацией и службой push-уведомлений в Skype для бизнеса Online. В командной строке введите следующую команду:
    
   ```powershell
    New-CsAllowedDomain -Identity "push.lync.com"
   ```

### <a name="enable-push-notifications"></a>Включение push-уведомлений

1. Войдите в систему с помощью учетной записи, которая входит в роль **ксадминистратор** , на компьютер, на котором установлены **Командная консоль управления и Окскоре Skype для бизнеса Server** . ****
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Включите push-уведомления:
    
   ```powershell
   Set-CsPushNotificationConfiguration -EnableMicrosoftPushNotificationService $True
   ```

4. Включите федерацию:
     
   ```powershell
   Set-CsAccessEdgeConfiguration -AllowFederatedUsers $True
   ```

### <a name="test-federation-and-push-notifications"></a>Тестирование федерации и push-уведомлений

1. Войдите в систему с помощью учетной записи, которая входит в роль **ксадминистратор** , на компьютер, на котором установлены **Командная консоль управления и Окскоре Skype для бизнеса Server** . ****
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Проверьте конфигурацию федерации:
    
   ```powershell
   Test-CsFederatedPartner -TargetFqdn <FQDN of Access Edge server used for federated SIP traffic> -Domain <FQDN of federated domain> -ProxyFqdn <FQDN of the Access Edge server used by the federated organization>
   ```

    Пример:
    
   ```powershell
   Test-CsFederatedPartner -TargetFqdn accessproxy.contoso.com -Domain push.lync.com -ProxyFqdn sipfed.online.lync.com
   ```

4. Протестируйте push-уведомления:
    
   ```powershell
   Test-CsMcxPushNotification -AccessEdgeFqdn <Access Edge service FQDN>
   ```

    Пример:
    
   ```powershell
   Test-CsMcxPushNotification -AccessEdgeFqdn accessproxy.contoso.com
   ```

## <a name="configure-mobility-policy"></a>Настройка политики мобильности
<a name="ConfigMob"> </a>

С помощью Skype для бизнеса Server вы можете определить, кто может использовать службу Mobility Service, позвонить через Works, голосовую почту через IP (VoIP) или видео, а также указать, требуется ли WiFi для VoIP или видео. Call via Work lets a mobile user use their work phone number, instead of their mobile phone number, when placing and receiving calls. The person on the other end of the line won't see that mobile user's cell phone number, and it lets that mobile user avoid outgoing call charges. When VoIP and video are set up, users can take and make VoIP calls and video. The settings for WiFi usage determine whether a user's mobile device will be required to use a WiFi network over a cellular data network.
  
По умолчанию включены мобильные устройства, звонки через работу и функции VoIP и видео. Параметры запроса на использование сети Wi-Fi для протокола VoIP и видеосвязи отключены. Администратор может изменять эти настройки глобально, а также на уровне сайта или пользователя.
  
Для использования функций мобильной связи и звонков через Works необходимо:
  
- Разрешено для Skype для бизнеса Server
    
- Активированы для корпоративной голосовой связи.
    
- Назначена политика мобильности с параметром **енаблемобилити** , для которого установлено **значение true**.
    
Чтобы использовать функцию "Позвонить с рабочего", пользователи должны отвечать следующим требованиям:
  
- Иметь назначенную политику голосовой связи с выбранной функцией  **Разрешить одновременный звонок на несколько телефонов**.
    
- Назначена политика мобильности с параметром **енаблеаутсидевоице** , для которого установлено **значение true**.
    
> [!NOTE]
> Пользователи, для которых не включена поддержка системы корпоративной голосовой связи, могут использовать мобильные устройства для выполнения звонков Skype–Skype по протоколу VoIP или могут присоединиться к конференциям с помощью ссылки "Щелкните для присоединения" на мобильном устройстве, если вы назначили этим пользователям соответствующие возможности в политике голосовой связи. Дополнительные сведения см. в разделе "Планирование". 
  
### <a name="modify-global-mobility-policy"></a>Изменение глобальной политики мобильности

1. Войдите в систему с помощью учетной записи, которая входит в роль **ксадминистратор** , на компьютер, на котором установлены **Командная консоль управления и Окскоре Skype для бизнеса Server** . ****
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Отключите доступ к мобильным каналам связи и работайте с ними глобально, введя:
    
   ```powershell
   Set-CsMobilityPolicy -EnableMobility $False -EnableOutsideVoice $False
   ```

    > [!NOTE]
    > Вы можете отключить функцию "звонок через", не отключив доступ к мобильному рабочему каналу. Но вы не можете отключить функцию мобильной связи, не отключив и не отключая Звонок через работу. 
  
    Дополнительные сведения можно найти в статье [Set-ксмобилитиполици](https://docs.microsoft.com/powershell/module/skype/set-csmobilitypolicy?view=skype-ps).
    
### <a name="modify-mobility-policy-by-site"></a>Изменение политики мобильной связи по сайту

1. Войдите в систему с помощью учетной записи, которая входит в роль **ксадминистратор** , на компьютер, на котором установлены **Командная консоль управления и Окскоре Skype для бизнеса Server** . ****
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. В можете создать политику на уровне сайта, отключить VoIP и видеосвязь и включить параметр "Запрашивать Wi-Fi для IP-аудио/видео" для отдельных сайтов. Для этого введите:
    
   ```powershell
   New-CsMobilityPolicy -Identity site:<site identifier> -EnableIPAudioVideo $false -RequireWiFiForIPAudio $True -RequireWiFiforIPVideo $True
   ```

    Дополнительные сведения см. в статье [New-CsMobilityPolicy](https://docs.microsoft.com/powershell/module/skype/new-csmobilitypolicy?view=skype-ps).
    
### <a name="modify-mobility-policy-by-user"></a>Изменение политики мобильности по пользователям

1. Войдите в систему с помощью учетной записи, которая входит в роль **ксадминистратор** , на компьютер, на котором установлены **Командная консоль управления и Окскоре Skype для бизнеса Server** . ****
    
2. Запустите **консоль управления Skype для бизнеса Server**.
    
3. Создавайте политики мобильности на уровне пользователей и отключайте мобильность и звоните по рабочему телефону. Type:
    
   ```powershell
   New-CsMobilityPolicy -Identity <policy name> -EnableMobility $False -EnableOutsideVoice $False
   Grant-CsMobilityPolicy -Identity <user identifier> -PolicyName <policy name>
   ```

    Дополнительный пример (используется образец данных):
    
   ```powershell
   New-CsMobilityPolicy "tag:disableOutsideVoice" -EnableOutsideVoice $False
   Grant-CsMobilityPolicy -Identity MobileUser1@contoso.com -PolicyName tag:disableOutsideVoice
   ```

    > [!NOTE]
    > Вы можете отключить функцию "звонок через", не отключив доступ к мобильному рабочему каналу. Но вы не можете отключить функцию мобильной связи, не отключив и не отключая Звонок через работу. 
  

