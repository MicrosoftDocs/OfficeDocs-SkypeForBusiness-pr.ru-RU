---
title: 'Развертывание единого магазина контактов в Skype для бизнеса Server '
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.assetid: d1c9ebd8-af42-42a0-87d9-fc899fbd7c42
description: 'Сводка: Включите единое хранилище контактов в Skype для бизнеса Server.'
ms.openlocfilehash: 382b4ed059c4066ae862bb3fe24b98b4bdde2a18
ms.sourcegitcommit: b1229ed5dc25a04e56aa02aab8ad3d4209559d8f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2020
ms.locfileid: "41798096"
---
# <a name="deploy-unified-contact-store-in-skype-for-business-server"></a>Развертывание единого магазина контактов в Skype для бизнеса Server
 
**Сводка:** Включите единое хранилище контактов в Skype для бизнеса Server.
  
Для включения единого магазина контактов в Skype для бизнеса Server не требуются параметры топологии. Для предоставления пользователям доступа к единому хранилищу контактов выполните следующие действия.
  
- Включена политика единого магазина контактов (по умолчанию включена).
    
- Пользователи входят в Skype для бизнеса по крайней мере один раз.
    
После того как контакты пользователей будут перенесены, что происходит автоматически, когда пользователь входит в систему с помощью Skype для бизнеса, пользователь может получить доступ к контактам Skype для бизнеса и управлять ими в Skype для бизнеса, Outlook 2013 или Outlook Web Access. Для управления контактами из Outlook или Outlook Web Access пользователю не нужно входить в Skype для бизнеса.
  
> [!IMPORTANT]
> Если пользователь входит в Skype для бизнеса после миграции, контакты и группы доступны и обновляются, но пользователи не могут управлять ими (то есть добавлять, удалять, перемещать, помечать, присвоенной или изменять) эти контакты. 
  
## <a name="enable-users-for-unified-contact-store"></a>Включение для пользователей единого хранилища контактов

При развертывании Skype для бизнеса Server и публикации топологии единое хранилище контактов включается для всех пользователей по умолчанию. Вам не нужно предпринимать никаких дополнительных действий, чтобы активировать единое хранилище контактов после развертывания Skype для бизнеса Server. Однако вы можете использовать командлет **Set-ксусерсервицесполици** , чтобы настроить, какие пользователи будут доступны в едином хранилище контактов. Вы можете включить эту функцию глобально, по сайту, по клиенту или по отдельным пользователям или группам пользователей.
  
### <a name="to-enable-users-for-unified-contact-store"></a>Включение пользователей в едином хранилище контактов

1. Запустите консоль управления в Skype для бизнеса Server: нажмите кнопку **Пуск**, выберите **все программы**, а затем — **Skype**для бизнеса и щелкните **Командная консоль управления Skype для бизнеса Server**.
    
2. Выполните одно из указанных ниже действий.
    
   - Чтобы включить единое хранилище контактов глобально для всех пользователей Skype для бизнеса Server, в командной строке Windows PowerShell можно использовать следующий командлет:
    
   ```powershell
   Set-CsUserServicesPolicy -Identity global -UcsAllowed $True
   ```

   - Чтобы включить единое хранилище контактов для пользователей на определенном сайте, введите в командной строке:
    
   ```powershell
   New-CsUserServicesPolicy -Identity site:<site name> -UcsAllowed $True
   ```

   Например:
    
   ```powershell
   New-CsUserServicesPolicy -Identity site:Redmond -UcsAllowed $True
   ```

   - Чтобы включить единое хранилище контактов по клиенту, в командной строке введите:
    
   ```powershell
   Set-CsUserServicesPolicy -Tenant <tenantId> -UcsAllowed $True
   ```

   Например:
    
   ```powershell
   Set-CsUserServicesPolicy -Tenant "38aad667-af54-4397-aaa7-e94c79ec2308" -UcsAllowed $True
   ```

   - Чтобы включить единое хранилище контактов для определенных пользователей, в командной строке введите:
    
   ```powershell
   New-CsUserServicesPolicy -Identity "<policy name>" -UcsAllowed $True
   Grant-CsUserServicesPolicy -Identity "<user display name>" -PolicyName <"policy name">
   ```

    > [!NOTE]
    > Вы также можете использовать псевдонимы пользователя или URI SIP вместо отображаемого имени пользователя. 
  
    Например:
    
   ```powershell
   New-CsUserServicesPolicy -Identity "UCS Enabled Users" -UcsAllowed $True
   Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "UCS Enabled Users"
   ```

    > [!NOTE]
    > В предыдущем примере первая команда создает новую политику для пользователей с включенным управлением UCS, при этом для флага Уксалловед задано значение true. Вторая команда назначает пользователю политику с отображаемым именем Кен мер, что означает, что Кен мер теперь включен для единого магазина контактов.
  
## <a name="migrate-users-to-unified-contact-store"></a>Перенос пользователей в единое хранилище контактов

Пользовательские контакты автоматически переносятся на сервер Exchange 2013, когда пользователь:
  
- Назначена политика пользовательских служб, у которой Уксалловед установлено значение true.
    
- Была настроена с помощью почтового ящика Exchange 2013 и один раз вошел в почтовый ящик.
    
- Войдите в систему с помощью многофункционального клиента Skype для бизнеса.
    
Если пользователь входит в систему с помощью Lync или более ранней версии клиента или если пользователь не подключен к серверу Exchange 2013, политика служб пользователей игнорируется, а контакты пользователя остаются в Skype для бизнеса Server.
  
Чтобы определить, перенесены ли контакты пользователя, используйте один из указанных ниже способов. 
  
- На клиентском компьютере проверьте следующий раздел реестра:
    
    HKEY_CURRENT_USER \Software\Microsoft\Office\15.0\Lync\\<URL-\>адрес SIP \укс
    
    Если контакты пользователя хранятся в Exchange 2013, в этом разделе содержится значение Инуксмоде со значением 2165.
    
- Запустите командлет **Test-ксунифиедконтактсторе** . В командной строке Skype для Business Server Management Shell введите:
    
  ```powershell
  Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"
  ```

    Если **тест-ксунифиедконтактсторе** выполняется успешно, контакты пользователя были перенесены в единое хранилище контактов.
    
## <a name="roll-back-migrated-users"></a>Откат пользователей, для которых выполнена миграция

Если вы хотите выполнить откат в едином хранилище контактов, изменяйте контакты только в том случае, если вы вернете пользователя на Exchange 2010 или Lync Server 2010. Чтобы выполнить откат, отключите политику для пользователя, а затем выполните командлет **Invoke-ксуксроллбакк** . Просто запустить функцию **Invoke-ксуксроллбакк** недостаточно для обеспечения постоянной процедуры отката, так как единая миграция хранилища контактов инициируется повторно, если она не отключена. Например, если пользователь выполняет откат, так как Exchange 2013 возвращается в Exchange 2010, а почтовый ящик пользователя перемещается в Exchange 2013, то единая миграция в магазине контактов начнется еще раз через семь дней после отката, пока единая база данных контактов по-прежнему включен для пользователя в политике служб пользователей.
  
Командлет **Move-CsUser** автоматически откатывает хранилище контактов пользователя Exchange 2013 на сервер Skype для бизнеса Server в указанных ниже случаях.
  
- При перемещении пользователей из Skype для бизнеса на сервер Microsoft Lync Server 2013 или Lync Server 2010. 
    
- Миграция локальных пользователей, например при перемещении пользователя из Skype для бизнеса Online в локальную версию Skype для бизнеса Server или наоборот.
    
Импорт данных из хранилища Объединенных контактов из резервной базы данных может привести к повреждению данных из хранилища контактов и данных пользователя, если в процессе экспорта и импорта изменился режим хранилища единого контакта. Например:
  
- Если вы экспортируете списки контактов перед тем, как контакты пользователей будут перенесены в Exchange 2013, а затем, после миграции, импортируйте эти данные в единое хранилище контактов и списки контактов, которые будут повреждены.
    
- Если вы экспортируете данные пользователя после миграции пользователей в Exchange 2013, откати миграции и, по некоторым причинам, вы импортируете данные из системы после миграции, они будут повреждены.
    
> [!IMPORTANT]
> Перед перемещением почтового ящика Exchange из Exchange 2013 в Exchange 2010 администратор Exchange должен предварительно вернуть контакты пользователей Skype для бизнеса Server из Exchange 2013 в Skype для Business Server. Чтобы вернуть контакты из магазина Объединенных контактов в Skype для бизнеса Server, ознакомьтесь с разделом "как вернуть контакты из Exchange 2013 в Skype для бизнеса Server" Далее в этом разделе. 
  
 **Как восстановить контакты пользователей:** Если вы используете командлет **Move-CsUser** для перемещения пользователей между Skype для бизнеса Server 2015 и Lync Server 2010, вы можете пропустить эти действия, так как командлет **Move-CsUser** автоматически откатывает единое хранилище контактов при перемещении пользователей из Skype для бизнеса Server 2015 в Lync Server 2010. В разделе **Move-CsUser** не отключена политика хранилища контактов, поэтому миграция в единое хранилище контактов будет повторена, если пользователь перейдет обратно в Skype для бизнеса Server 2015.
  

