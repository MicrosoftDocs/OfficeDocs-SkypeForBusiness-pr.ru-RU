---
title: 'Развертывание единого магазина контактов в Skype для бизнеса Server '
ms.reviewer: ''
ms.author: v-mahoffman
author: cichur
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.assetid: d1c9ebd8-af42-42a0-87d9-fc899fbd7c42
description: Сводка. Включить единый магазин контактов в Skype для бизнеса Server.
ms.openlocfilehash: 459626fe40f76cc19534aaff67d1b1b39c268469
ms.sourcegitcommit: 65a10f80e5dfd67b2778e09f5f92c21ef09ce36a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2021
ms.locfileid: "60748835"
---
# <a name="deploy-unified-contact-store-in-skype-for-business-server"></a>Развертывание единого магазина контактов в Skype для бизнеса Server
 
**Сводка:** Включить единый магазин контактов в Skype для бизнеса Server.
  
Включение единого магазина контактов в Skype для бизнеса Server не требует параметров топологии. Чтобы включить единый магазин контактов для пользователей:
  
- Политика единого хранилища контактов включена (по умолчанию — включена).
    
- Пользователи войдите с Skype для бизнеса по крайней мере один раз.
    
После переноса контактов пользователя, что происходит автоматически при входе пользователя в систему Skype для бизнеса, пользователь может получить доступ к своим Skype для бизнеса контактам из Skype для бизнеса, Outlook 2013 или Outlook Веб-доступа. Для управления контактами из Outlook или Outlook пользователя не Skype для бизнеса войти в систему.
  
> [!IMPORTANT]
> Если пользователь входит в систему Skype для бизнеса после миграции, контакты и группы доступны и устарели, но пользователь не может управлять (то есть добавлять, удалять, перемещать, теги, оттагировать или изменять) этими контактами. 
  
## <a name="enable-users-for-unified-contact-store"></a>Включить пользователей для единого магазина контактов

При развертывании Skype для бизнеса Server и публикации топологии унифицированный магазин контактов включен для всех пользователей по умолчанию. Вам не нужно принимать дополнительные меры, чтобы включить единый магазин контактов после развертывания Skype для бизнеса Server. Однако можно использовать командлет **Set-CsUserServicesPolicy**, чтобы указать, каким пользователям доступно единое хранилище контактов. Эту возможность можно включать глобально, по узлам, по клиентам, по отдельности или группами.
  
### <a name="to-enable-users-for-unified-contact-store"></a>Включение для пользователей единого хранилища контактов

1. Запустите Skype для бизнеса Server: нажмите кнопку Начните, щелкните Все **программы,** нажмите кнопку **Skype для бизнеса,** а затем нажмите кнопку **Skype для бизнеса Server.**
    
2. Выполните любые из следующих действий.
    
   - Чтобы включить единое хранилище контактов во всем мире для Skype для бизнеса Server пользователей, в интерфейсе командной строки Windows PowerShell следующий командный командный пункт:
    
   ```powershell
   Set-CsUserServicesPolicy -Identity global -UcsAllowed $True
   ```

   - Чтобы включить единый магазин контактов для пользователей на определенном сайте, введите:
    
   ```powershell
   New-CsUserServicesPolicy -Identity site:<site name> -UcsAllowed $True
   ```

   Например:
    
   ```powershell
   New-CsUserServicesPolicy -Identity site:Redmond -UcsAllowed $True
   ```

   - Чтобы включить единый магазин контактов клиентом, по запросу введите:
    
   ```powershell
   Set-CsUserServicesPolicy -Tenant <tenantId> -UcsAllowed $True
   ```

   Например:
    
   ```powershell
   Set-CsUserServicesPolicy -Tenant "38aad667-af54-4397-aaa7-e94c79ec2308" -UcsAllowed $True
   ```

   - Чтобы включить единый магазин контактов для определенных пользователей, введите:
    
   ```powershell
   New-CsUserServicesPolicy -Identity "<policy name>" -UcsAllowed $True
   Grant-CsUserServicesPolicy -Identity "<user display name>" -PolicyName <"policy name">
   ```

    > [!NOTE]
    > Вместо отображаемых имен пользователей можно использовать псевдонимы или SIP URI. 
  
    Например:
    
   ```powershell
   New-CsUserServicesPolicy -Identity "UCS Enabled Users" -UcsAllowed $True
   Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "UCS Enabled Users"
   ```

    > [!NOTE]
    > В предыдущем примере первая команда создает новую политику на уровне пользователя с именем UCS Enabled Users и с флагом UcsAllowed, установленным в значение True. Вторая команда назначает эту политику пользователю с отображаемым именем Ken Myer, что означает, что теперь Кену Майеру разрешен доступ к единому хранилищу контактов.
  
## <a name="migrate-users-to-unified-contact-store"></a>Перенос пользователей в единый магазин контактов

Контакты пользователя автоматически переносятся на сервер Exchange 2013 в следующих условиях.
  
- пользователю назначена политика служб пользователя, где для параметра UcsAllowed установлено значение true;
    
- Был предварительно с Exchange 2013 и подписался в почтовый ящик по крайней мере один раз.
    
- Пользователь входит в систему с помощью клиента Skype для бизнеса с расширенными возможностями.
    
Если пользователь входит в систему с клиентом Lync или более ранним клиентом или если он не подключен к серверу Exchange 2013 г., политика служб пользователя игнорируется, а контакты пользователя остаются в Skype для бизнеса Server.
  
Можно определить, перенесены ли контакты пользователя, с помощью любого из следующих методов: 
  
- Проверьте следующий раздел реестра на клиентском компьютере:
    
    HKEY_CURRENT_USER\Software\Microsoft\Office\15.0\Lync<\\ SIP \> URL\UCS
    
    Если контакты пользователя хранятся в Exchange 2013 г., этот ключ содержит значение InUCSMode со значением 2165.
    
- Выполните командлет **Test-CsUnifiedContactStore**. В командной Skype для бизнеса Server командной строке Management Shell введите:
    
  ```powershell
  Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"
  ```

    Если командлет **Test-CsUnifiedContactStore** выполнен успешно, следовательно, выполнен перенос контактов пользователя к единое хранилище контактов.
    
## <a name="roll-back-migrated-users"></a>Откат перенесенных пользователей

Если необходимо откатать функцию единого магазина контактов, откат контактов только в том случае, если вы переместили пользователя Exchange 2010 или Lync Server 2010. Для выполнении отката отключите политику для пользователя, а затем выполните командлет **Invoke-CsUcsRollback**. Выполнения одного командлета **Invoke-CsUcsRollback** недостаточно для обеспечения постоянного отката, поскольку если политика не отключена, то миграция универсального хранилища контактов будет инициирована повторно. Например, если пользователь откатился, так как Exchange 2013 г. откатился до Exchange 2010 г., а затем почтовый ящик пользователя перенесен на Exchange 2013 г., миграция единого магазина контактов будет начата снова через семь дней после отката, если для пользователя в политике служб пользователей по-прежнему включен единый магазин контактов.
  
Комлет **Move-CsUser** автоматически откатит хранилище контактов пользователя с Exchange 2013 г. до Skype для бизнеса Server в следующих ситуациях:
  
- При перемещении пользователей Skype для бизнеса Server Microsoft Lync Server 2013 или Lync Server 2010. 
    
- При переносе пользователей в другие помещения, например при перемещении пользователя из Skype для бизнеса Online в Skype для бизнеса Server локальное или наоборот.
    
Импорт данных универсального хранилища контактов из резервной копии базы данных может привести к повреждению данных универсального хранилища контактов и пользовательских данных, если режим универсального хранилища контактов изменится с экспорта на импорт. Пример:
  
- Если вы экспортируете списки контактов до переноса контактов пользователей в Exchange 2013 г., а затем после миграции импортируете те же данные, данные единого магазина контактов и списки контактов будут повреждены.
    
- Если вы экспортируете данные пользователей после переноса пользователей в 2013 Exchange 2013 г., откатите миграцию, а затем по какой-то причине импортируете данные из после миграции, данные единого магазина контактов и списки контактов будут повреждены.
    
> [!IMPORTANT]
> Перед перемещением Exchange почтового ящика с Exchange 2013 г. на Exchange 2010 г. администратор Exchange должен убедиться, что администратор Skype для бизнеса Server впервые откатил Skype для бизнеса Server пользователя контакты с Exchange 2013 г. Skype для бизнеса Server. Чтобы откатать контакты единого магазина контактов в Skype для бизнеса Server, см. процедуру "Откат унифицированных контактных контактов магазина с Exchange 2013 г. до Skype для бизнеса Server", далее в этом разделе. 
  
 **Как откат контактов пользователей:** Если вы используете **командалет Move-CsUser** для перемещения пользователей между Skype для бизнеса Server 2015 и Lync Server 2010, можно пропустить эти действия, так как **командалет Move-CsUser** автоматически откатывает единый магазин контактов при переходе пользователей с Skype для бизнеса Server 2015 г. на Lync Server 2010. **Move-CsUser** не отключит унифицированную политику магазина контактов, поэтому миграция в единый магазин контактов будет повторяться, если пользователь будет перемещен Skype для бизнеса Server 2015 г.
  

