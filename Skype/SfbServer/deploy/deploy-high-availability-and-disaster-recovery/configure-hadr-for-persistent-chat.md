---
title: 'Business Server 2015: Настройка высокой доступности и аварийного восстановления для сохраняемой сервера чата'
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.assetid: 5fb5b189-56c1-49cf-92c8-e4fd6e2fdd5c
description: Узнайте, как настроить высокую доступность и аварийное восстановление для сохраняемой сервера чата в Skype для бизнеса Server 2015 г.
ms.openlocfilehash: 9b7157b0f1bd3d1891edac752310343b7211b961
ms.sourcegitcommit: 556fffc96729150efcc04cd5d6069c402012421e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "58608586"
---
# <a name="business-server-2015-configure-high-availability-and-disaster-recovery-for-persistent-chat-server"></a>Business Server 2015: Настройка высокой доступности и аварийного восстановления для сохраняемой сервера чата
 
**Сводка:** Ознакомьтесь с этой темой, чтобы узнать о настройке высокой доступности и аварийного восстановления для сервера сохраняемой Skype для бизнеса Server 2015 г.
  
Skype для бизнеса Server поддерживает несколько режимов высокой доступности для серверов back end, включая зеркальное отражение базы данных. Дополнительные сведения см. в [проекте Plan for high availability and disaster recovery in Skype для бизнеса Server 2015.](../../plan-your-deployment/high-availability-and-disaster-recovery/high-availability-and-disaster-recovery.md)
  
> [!NOTE]
> Группы доступности AlwaysOn не поддерживаются с помощью постоянных серверов чата. 
  
Прежде чем настроить развертывание persistent Chat для высокой доступности и аварийного восстановления, ознакомьтесь с концепциями в Plan for high availability and disaster recovery for Persistent Chat Server в Skype для бизнеса Server [2015](../../plan-your-deployment/persistent-chat-server/high-availability-and-disaster-recovery.md)г. Решение аварийного восстановления для стойких чат-серверов, описанных в этих темах, построено на растянутой пуле стойких серверов чата. В контенте планирования описываются требования к ресурсам и топология растянутой пула, которая обеспечивает высокую доступность и восстановление аварийности для сохраняемой сервера чата, включая использование зеркального SQL Server для обеспечения высокой доступности и SQL Server доставки журналов для аварийного восстановления.
  
## <a name="use-topology-builder-to-configure-high-availability-and-disaster-recovery"></a>Используйте Topology Builder для настройки высокой доступности и аварийного восстановления

В Topology Builder выполните следующие действия для настройки высокой доступности и аварийного восстановления для сохраняемой сервера чата.
  
1. Добавьте зеркальные базы данных и вторичную базу данных SQL Server журнала.
    
2. Изменить свойства службы службы сохраняемой службы чата на:
    
    а. Включите зеркальное отображение для базы данных-источника.
    
    б. Добавление основного зеркального SQL Server магазина.
    
    в. Включить базу данных SQL Server log Shipping.
    
    г. Добавьте дополнительный SQL Server log Shipping SQL Server магазине.
    
    д. Добавьте зеркальное SQL Server для вторичной базы данных.
    
    е. Опубликуйте топологию.
    
## <a name="set-up-sql-server-log-shipping-for-the-persistent-chat-server-primary-database"></a>Настройка доставки SQL Server журнала для основной базы данных сервера сохраняемой системы чата

Используя SQL Server Management Studio, подключите к экземпляру базы данных вторичной базы данных log Shipping SQL Server Management Studio и убедитесь, что SQL Server агент запущен. Затем подключите к основному экземпляру базы данных persistent Chat и выполните следующие действия:
  
1. Щелкните базу данных mgc правой кнопкой мыши и выберите пункт **Свойства**.
    
2. В области **Выбор страницы** щелкните элемент **Доставка журналов транзакций**.
    
3. Установите флажок **Включить эту базу данных в качестве источника в конфигурацию доставки журналов**.
    
4. В области **Резервные копии журналов транзакций** щелкните элемент **Параметры копирования**.
    
5. В **сетевом пути к папке** резервного копирования введите сетевой путь к совместной папке, созданной для резервной папки журнала транзакций.
    
6. Если папка резервного копирования расположена на основном сервере, введите локальный путь к папке резервного копирования в поле Если папка резервного копирования расположена на основном сервере, введите локальный путь к папке **(пример: c:\backup).** (Если резервная папка находится не на основном сервере, вы можете оставить это поле пустым.)
    
    > [!IMPORTANT]
    > Если учетная запись SQL Server на основном сервере работает в локальной учетной записи системы, необходимо создать папку резервного копирования на основном сервере и указать локальный путь к этой папке. 
  
7. Настройте параметры **Удалить файлы, созданные ранее** и **Предупредить, если резервное копирование не произошло в течение**.
    
8. Просмотрите расписание резервного копирования, указанное в поле **Расписание** области **Задание резервного копирования**. Чтобы настроить расписание установки, щелкните Расписание **и** SQL Server агент по мере необходимости.
    
9. В **статье Сжатие** выберите **Параметр** сервера по умолчанию, а затем нажмите **кнопку ОК**.
    
10. В области **Экземпляры сервера-получателя и базы данных** нажмите кнопку **Добавить**.
    
11. Щелкните **Подключение** и подключите экземпляр SQL Server, настроенный в качестве дополнительного сервера.
    
12. В поле **База данных-получатель** выберите в списке базу данных **mgc**.
    
13. На вкладке **Initialize Secondary database** выберите параметр Да, создайте полное резервное копирование основной базы данных и восстановим ее во вторичную базу данных (и создайте вторичную базу данных, если ее **нет).**
    
14. На **вкладке Copy Files** в папке **Назначения** для скопированные файлы введите путь папки, в которую следует скопировать резервные копии журналов транзакций. Часто эта папка расположена на сервере-получателе.
    
15. Обратите внимание на расписание копирования, перечисленное в поле **Расписание** в **статье Скопируйте задание.** Чтобы настроить расписание установки, щелкните Расписание **и** SQL Server агент по мере необходимости. Это расписание должно быть примерно таким же, как и расписание резервного копирования.
    
16. На **вкладке Восстановление** в состоянии **Базы данных при восстановлении** резервных копий выберите параметр **Нет режиму восстановления.**
    
17. В **соответствии с задержкой восстановления резервных копий по крайней мере:** выберите **0 минут**.
    
18. Выберите пороговое значение оповещений **в alert, если восстановление не происходит в пределах**.
    
19. Посмотрите на расписание восстановления, перечисленное в поле **Расписание** под **заданием Восстановление.** Чтобы настроить расписание установки, нажмите кнопку **Расписание,** SQL Server агент по мере необходимости, и нажмите **кнопку ОК**. Это расписание должно быть примерно таким же, как и расписание резервного копирования.
    
20. В **диалоговом окне Свойства** базы данных нажмите **кнопку ОК,** чтобы начать процесс настройки.
    
## <a name="set-up-sql-server-log-shipping-between-the-primary-mirror-and-the-secondary-database"></a>Настройка SQL Server отгрузки журнала между первичным зеркалом и вторичной базой данных

Выполните следующие действия, чтобы доставка журнала продолжалась, если основная база данных сохраняемой чата не была выполнена в зеркальной базе данных.
  
1. Вручную сбой в основной базе данных сохраняемого чата в зеркале. Это делается с помощью Skype для бизнеса Server и команды **Invoke-CsDatabaseFailover.**
    
2. С помощью SQL Server Management Studio подключайтесь к основному экземпляру зеркального сервера сохраняемой чат-сервера.
    
3. Убедитесь, что SQL Server агент запущен.
    
4. Щелкните базу данных mgc правой кнопкой мыши и выберите пункт **Свойства**.
    
5. В области **Выбор страницы** щелкните элемент **Доставка журналов транзакций**.
    
6. Установите флажок **Включить эту базу данных в качестве источника в конфигурацию доставки журналов**.
    
7. В области **Резервные копии журналов транзакций** щелкните элемент **Параметры копирования**.
    
8. В поле **Network path to the backup folder** (Сетевой путь к каталогу резервной копии) введите сетевой путь к общей папке, созданной для резервной копии журнала транзакций.
    
9. Если резервная папка находится на основном сервере, введите локальный путь к этой резервной папке в поле **Если папка резервного копирования находится на сервере-источнике, укажите локальный путь к папке**. (Если резервная папка находится не на основном сервере, вы можете оставить это поле пустым.)
    
    > [!IMPORTANT]
    > Если учетная запись SQL Server на основном сервере работает в локальной учетной записи системы, необходимо создать папку резервного копирования на основном сервере и указать локальный путь к этой папке. 
  
10. Настройте параметры **Удалить файлы, созданные ранее** и **Предупредить, если резервное копирование не произошло в течение**.
    
11. Просмотрите расписание резервного копирования, указанное в поле **Расписание** области **Задание резервного копирования**. Чтобы настроить расписание для установки, щелкните Расписание **и** SQL Server агентов, как это требуется.
    
    > [!IMPORTANT]
    > Используйте те же параметры, которые применялись для основной базы данных. 
  
12. В области **Сжатие** выберите **Использовать параметр сервера по умолчанию** и нажмите кнопку **ОК**.
    
13. В области **Экземпляры сервера-получателя и базы данных** нажмите кнопку **Добавить**.
    
14. Щелкните элемент **Подключение** и подключитесь к экземпляру SQL Server, настроенному вами в качестве сервера-получателя.
    
15. В поле **База данных-получатель** выберите в списке базу данных **mgc**.
    
16. На вкладке **Инициализация базы данных-получателя** выберите параметр **Нет, база данных-получатель инициализирована**.
    
17. В поле **Папка назначения для копирования** на вкладке **Копирование файлов**  введите путь к папке, в которую следует копировать резервные копии журналов транзакций, и нажмите кнопку **ОК**. Часто эта папка расположена на сервере-получателе.
    
18. Откройте раскрывающийся список **Скрипт конфигурации** и выберите **Вывести конфигурацию в новое окно запроса**.
    
19. В разделе **Свойства базы данных** окна нового запроса нажмите кнопку **ОК**, чтобы начать процесс настройки.
    
20. Выберите и запустите первую половину запроса (см. шаг 18) до строки: -- \* \* \* \* \* \* End: Script, \* \* \* \* \* \* который будет работать в Primary: .
    
    > [!IMPORTANT]
    > Ручное управление этим скриптом необходимо, SQL Server Management Studio не поддерживает несколько основных баз данных в конфигурации SQL Server log Shipping. 
  
21. Выберите **Отмена**, чтобы закрыть панель конфигурации доставки журналов и создать рабочую программу установки, которая правильно внедряет доставку файлов журналов как для основной, так и для зеркальной базы данных (в случае отработки отказа).
    
22. Вручную не удается вернуть основную базу данных сохраняемого чата в основную. Это делается с помощью Skype для бизнеса Server и команды **invoke-CsDatabaseFailover.**
    

