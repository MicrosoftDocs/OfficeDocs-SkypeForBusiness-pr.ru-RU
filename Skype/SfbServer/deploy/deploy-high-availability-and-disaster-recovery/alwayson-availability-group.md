---
title: Развертывание группы доступности Always on на обратном стороне сервера в Skype для бизнеса Server
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: c93c01e6-626c-40ad-92dd-373b0fe9189f
description: Разверните (установите) группу доступности Always On в развертывании Skype для бизнеса Server.
ms.openlocfilehash: 2cfc75aecd53a82e146feefd944134a4695c21fe
ms.sourcegitcommit: e1c8a62577229daf42f1a7bcfba268a9001bb791
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2019
ms.locfileid: "36240130"
---
# <a name="deploy-an-always-on-availability-group-on-a-back-end-server-in-skype-for-business-server"></a>Развертывание группы доступности Always on на обратном стороне сервера в Skype для бизнеса Server
 
Разверните (установите) группу доступности Always On (AG) в развертывании Skype для бизнеса Server.
  
Способ развертывания AG зависит от того, выполняется ли развертывание в новом пуле, в существующем пуле, использующем зеркальное отображение, или в существующем пуле, в настоящее время не имеющего высокой доступности для серверной базы данных.
  
> [!NOTE]
> Использование AG с ролью сервера сохраняемого чата не поддерживается. 
  
- [Развертывание группы доступности Always On в новом пуле переднего плана](alwayson-availability-group.md#BKMK_NewPool_CreateAlwaysOnGroup)
    
- [Развертывание группы доступности Always On в существующем пуле, использующем зеркальное отображение базы данных](alwayson-availability-group.md#BKMK_MirroredPool_CreateAlwaysOnGroup)
    
- [Развертывание группы доступности Always On в существующем пуле, который не использует зеркальное отображение базы данных](alwayson-availability-group.md#BKMK_NoHAPool_CreateAlwaysOnGroup)
    
## <a name="deploy-an-always-on-availability-group-on-a-new-front-end-pool"></a>Развертывание группы доступности Always On в новом пуле переднего плана
<a name="BKMK_NewPool_CreateAlwaysOnGroup"> </a>

1. Включите функцию отказоустойчивой кластеризации на всех серверах баз данных, которые будут входить в AG. On each server, do the following
    
   - Откройте диспетчер серверов и щелкните **Добавить роли и компоненты**.
    
   - Нажимайте кнопку **Далее** до появления поля **Выбор компонентов**. В этом окне установите флажок **Отказоустойчивость кластеров**.
    
   - В поле **Добавить компоненты, необходимые для Отказоустойчивость кластеров?** щелкните **Добавить компоненты**.
    
   - Нажмите **Установить**.
    
2. Проверьте конфигурацию кластеров.
    
   - В диспетчере серверов щелкните меню **Сервис**, затем пункт **Диспетчер отказоустойчивости кластеров**.
    
   - В разделе **Действия** с правой стороны экрана щелкните **Проверить конфигурацию**.
    
   - На странице **Прежде чем приступить к работе** нажмите кнопку **Далее**.
    
   - Выберите серверы для добавления к кластеру, затем щелкните **Выполнить все тесты**.
    
   - В поле **Сводка** отметьте все ошибки, обнаруженные в ходе работы мастера. Затем нажмите кнопку **Готово** для завершения проверки.
    
     В этом поле мастера может отображаться несколько предупреждений, особенно в том случае, если не используется общее хранилище. Пользоваться общим хранилищем не обязательно. Однако при наличии сообщений с заголовком **Ошибка** перед продолжением необходимо устранить неполадки.
    
3. Создайте отказоустойчивый кластер Windows Server (WSFC).
    
   - В мастере **Средства управления отказоустойчивыми кластерами** щелкните **Средства управления отказоустойчивыми кластерами**, затем выберите **Создание кластера**.
    
   - На странице **Прежде чем приступить к работе** нажмите кнопку **Далее**.
    
   - Добавьте имя и IP -адрес кластера. После проверки параметров нажмите кнопку **Далее**.
    
   - На странице "Подтверждение" нажмите кнопку **Далее**.
    
   - После создания кластера нажмите кнопку **Готово**.
    
4. Рекомендуется настроить параметры кворума кластера для работы с файловым ресурсом-свидетелем. Для этого выполните следующие действия.
    
   - Щелкните имя кластера правой кнопкой мыши и выберите **More Actions**, затем **Настройка параметров кворума кластера**.
    
   - На странице **Выбор параметра конфигурации кворума** щелкните **Выбрать свидетель кворума**.
    
   - На странице **Выбор свидетеля кворума** щелкните **Настроить файловый ресурс-свидетель**.
    
   - На странице **Настройка файлового ресурса-свидетеля** введите путь к требуемому общему файловому ресурсу, затем нажмите кнопку **Далее**.
    
   - На странице **Подтверждение** нажмите кнопку **Далее**.
    
5. На каждом сервере в кластере включите функцию AG в диспетчере конфигурации SQL Server.
    
   - Откройте диспетчер конфигурации SQL Server. В дереве с левой стороны экрана щелкните **Службы SQL Server**, затем дважды щелкните службу SQL Server.  
    
   - В окне **Свойства** перейдите на вкладку **Высокий уровень доступности AlwaysOn**. Установите флажок **Включить группы доступности AlwaysOn**. По запросу перезапустите службу SQL Server.
   
6. Используйте построитель топологии для создания пула переднего плана, как описано в разделе [Создание и публикация новой топологии в Skype для бизнеса Server](../../deploy/install/create-and-publish-new-topology.md). После этого укажите AG для пула в качестве хранилища SQL.
    
7. Создайте группу доступности.
    
   - Откройте Microsoft SQL Server Management Studio и установите соединение с экземпляром SQL Server.
    
   - В обозревателе объектов разверните папку " **всегда в высоком уровне доступности** ". Щелкните папку **Группы доступности** правой кнопкой мыши и выберите **Мастер создания групп доступности**.
    
   - В случае появления страницы **Введение** нажмите кнопку **Далее**.
    
   - На странице **Указание имени группы доступности** введите имя группы доступности, затем нажмите кнопку **Далее**.
    
   - На странице Выбор баз данных выберите базы данных, которые вы хотите включить в группу доступности AlwaysOn. Then click **Next**.
    
     Не включайте базы данных **ReportServer**, **reportservertempdb**и persistent чата в группу доступности AlwaysOn, так как они не поддерживаются в этом сценарии. В группу доступности AlwaysOn вы можете включить все другие базы данных Skype для бизнеса Server.
    
   - На странице **Указание реплик** перейдите на вкладку **Реплики**. Затем нажмите кнопку **Добавить реплики** и установите соединение со всеми другими экземплярами SQL, присоединенными в качестве узлов отказоустойчивого кластера Windows Server.
    
   - Для каждого экземпляра выберите режимы **Автоматический переход на другой ресурс** и **Синхронная фиксация**. Не выбирайте режим **Вторичная реплика для чтения**.
    
   - Перейдите на вкладку **Конечные точки** и убедитесь в том, что для параметра **Номер порта** задано значение 5022.
    
   - Откройте вкладку **Прослушиватель** и выберите параметр **Создать прослушиватель группы доступности**. Введите имя прослушивателя и установите в поле **Порт** значение 1433 (этот параметр не поддерживает другие порты).
    
   - Нажмите кнопку **Добавить** и введите предпочтительный виртуальный IP‑адрес в поле **IPv4-адрес**, затем нажмите кнопку **ОК**.
    
   - На странице **Выбор начальной синхронизации данных** выберите "Полное" и укажите доступную для реплик папку, запись в которую разрешена учетной записи службы SQL, используемой обеими репликами. Затем нажмите кнопку **Далее**.
    
     Этот общий файловый ресурс будет временно использоваться при инициализации баз данных. При работе с большими базами данных рекомендуется инициализировать их вручную, если полосы пропускания сети недостаточно для передачи резервных копий баз данных.
    
   - На странице "Проверка" убедитесь в успешном выполнении всех операций проверки, затем нажмите кнопку **Далее**.
    
   - На странице **Сводка** проверьте значения всех параметров и нажмите кнопку "Готово".
      
8. После развертывания пула и AG выполните некоторые заключительные действия, чтобы убедиться, что имена входа SQL находятся на каждой реплике в группе доступности AlwaysOn. 
    
   - Откройте конфигуратор топологии, выберите пункт **загрузить топологию из существующего развертывания**и нажмите кнопку **ОК**.
    
   - Expand Skype for Business Server, expand your topology, and expand **SQL Server Stores**. Щелкните правой кнопкой мыши хранилище SQL для новой группы доступности AlwaysOn и выберите команду **изменить свойства**.
    
     - В нижней части страницы в поле **FQDN сервера SQL Server** измените значение на полное доменное имя прослушивателя AG.
    
   - Опубликуйте топологию. В меню **Действие** щелкните **Топология**, затем **Опубликовать**. Затем на странице подтверждения нажмите кнопку **Далее**. Репликация новой топологии занимает несколько минут.
    
   - Откройте центр SQL Server Management Studio и перейдите в "AG". Fail it over to a secondary replica.
    
   - Откройте командную консоль управления Skype для бизнеса Server и введите следующий командлет для создания имен входа SQL в этой реплике:
    
   ```
   Install-CsDatabase -Update
   ```

   - Повторите предыдущие два действия (для группы с помощью дополнительной реплики), а затем используйте `Install-CsDatabase -Update`ее для каждой реплики в группе.
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-uses-database-mirroring"></a>Развертывание группы доступности Always On в существующем пуле, использующем зеркальное отображение базы данных
<a name="BKMK_MirroredPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> Если в пуле, который вы обновляете до AG, размещено центральное хранилище управления для Организации, необходимо сначала переместить CMS в другой пул, прежде чем обновлять этот пул. Use the Move-CsManagementServer cmdlet to move the pool. Если у вас нет другого пула в вашей организации, вы можете временно развернуть сервер Standard Edition и переместить CMS на этот сервер перед обновлением пула до AG. 
  
1. Чтобы перенести все данные из зеркала на основной узел, откройте консоль управления Skype для бизнеса Server и введите следующий командлет.
    
   ```
   Invoke-CsDatabaseFailover -PoolFqdn <Pool FQDN> -DatabaseType <DatabaseType> -NewPrincipal "Primary"
   ```

    Повторно выполните этот командлет для каждого типа баз данных в пуле. Для поиска всех типов баз данных, хранящихся в пуле, можно выполнить следующий командлет.
     
   ```
   Get-CsPool -Identity <Pool FQDN>
   ```

2. Для удаления зеркального отображения базы данных из пула используйте построитель топологии.
    
   - Открытие построителя топологии. В данной топологии разверните узел **Пулы переднего плана Enterprise Edition**, щелкните имя пула правой кнопкой мыши и выберите пункт **Изменить свойства**.
    
   - Для каждого типа хранилищ SQL в пуле снимите флажок, **разрешающий зеркальное отображение хранилищ SQL Store Mirroring**.
    
3. Опубликуйте измененную топологию. В меню **Действие** щелкните **Топология**, затем **Опубликовать**. После этого нажмите кнопку **Далее** на странице подтверждения.
    
4. С помощью Microsoft SQL Server Management Studio отключите зеркальное отображение.
    
   - Откройте SQL Server Management Studio, перейдите к базам данных, щелкните **Задачи** правой кнопкой мыши и выберите **Зеркало**. Затем щелкните **Отключить отображение** и нажмите кнопку **ОК**.
    
   - Повторите эти действия для всех баз данных в пуле, которые будут преобразованы в AG.
    
5. Настройте функцию отказоустойчивой кластеризации на всех серверах баз данных, которые будут входить в AG. On each server, do the following
    
   - Откройте диспетчер серверов и щелкните **Добавить роли и компоненты**.
    
   - Нажимайте кнопку **Далее** до появления поля **Выбор компонентов**. В этом окне установите флажок **Отказоустойчивость кластеров**.
    
   - В поле **Добавить компоненты, необходимые для Отказоустойчивость кластеров?** щелкните **Добавить компоненты**.
    
   - Нажмите **Установить**.
    
6. Проверьте конфигурацию кластеров.
    
   - В диспетчере серверов щелкните меню **Сервис**, затем пункт **Диспетчер отказоустойчивости кластеров**.
    
   - В разделе **Действия** с правой стороны экрана щелкните **Проверить конфигурацию**.
    
   - На странице **Прежде чем приступить к работе** нажмите кнопку **Далее**.
    
   - Выберите серверы для добавления к кластеру, затем щелкните **Выполнить все тесты**.
    
   - В поле **Сводка** отметьте все ошибки, обнаруженные в ходе работы мастера. Затем нажмите кнопку **Готово** для завершения проверки.
    
     В этом поле мастера может отображаться несколько предупреждений, особенно в том случае, если не используется общее хранилище. Пользоваться общим хранилищем не обязательно. Однако при наличии сообщений с заголовком **Ошибка** перед продолжением необходимо устранить неполадки.
    
7. Создайте отказоустойчивый кластер Windows Server.
    
   - В мастере **Средства управления отказоустойчивыми кластерами** щелкните **Средства управления отказоустойчивыми кластерами**, затем выберите **Создание кластера**.
    
   - На странице **Прежде чем приступить к работе** нажмите кнопку **Далее**.
    
   - Добавьте имя и IP -адрес кластера. После проверки параметров нажмите кнопку **Далее**.
    
   - На странице "Подтверждение" нажмите кнопку **Далее**.
    
   - После создания кластера нажмите кнопку **Готово**.
    
8. Рекомендуется настроить параметры кворума кластера для работы с файловым ресурсом-свидетелем. Для этого выполните следующие действия.
    
   - Щелкните имя кластера правой кнопкой мыши и выберите **More Actions**, затем **Настройка параметров кворума кластера**.
    
   - На странице **Выбор параметра конфигурации кворума** щелкните **Выбрать свидетель кворума**.
    
   - На странице **Выбор свидетеля кворума** щелкните **Настроить файловый ресурс-свидетель**.
    
   - На странице **Настройка файлового ресурса-свидетеля** введите путь к требуемому общему файловому ресурсу, затем нажмите кнопку **Далее**.
    
   - На странице **Подтверждение** нажмите кнопку **Далее**.
    
9. На каждом сервере в кластере включите функцию AG в диспетчере конфигурации SQL Server.
    
   - Откройте диспетчер конфигурации SQL Server. В дереве с левой стороны экрана щелкните **Службы SQL Server**, затем дважды щелкните службу SQL Server.  
    
   - В окне **Свойства** перейдите на вкладку **Высокий уровень доступности AlwaysOn**. Установите флажок **Включить группы доступности AlwaysOn**. По запросу перезапустите службу SQL Server.
    
10. Создайте группу доступности.
    
    - Откройте Microsoft SQL Server Management Studio и установите соединение с экземпляром SQL Server.
    
    - В обозревателе объектов разверните папку " **всегда в высоком уровне доступности** ". Щелкните папку **Группы доступности** правой кнопкой мыши и выберите **Мастер создания групп доступности**.
    
    - В случае появления страницы **Введение** нажмите кнопку **Далее**.
    
    - На странице **Указание имени группы доступности** введите имя группы доступности, затем нажмите кнопку **Далее**.
    
    - На странице Выбор баз данных выберите базы данных, которые вы хотите включить в группу доступности AlwaysOn. Then click **Next**.
    
    Не включайте базы данных **ReportServer**, **reportservertempdb**и persistent чата в группу доступности AlwaysOn, так как они не поддерживаются в этом сценарии. В группу доступности AlwaysOn вы можете включить все другие базы данных Skype для бизнеса Server.
    
    - На странице **Указание реплик** перейдите на вкладку **Реплики**. Затем нажмите кнопку **Добавить реплики** и установите соединение со всеми другими экземплярами SQL, присоединенными в качестве узлов отказоустойчивого кластера Windows Server.
    
    - Для каждого экземпляра выберите режимы **Автоматический переход на другой ресурс** и **Синхронная фиксация**. Не выбирайте режим **Вторичная реплика для чтения**.
    
    - Перейдите на вкладку **Конечные точки** и убедитесь в том, что для параметра **Номер порта** задано значение 5022.
    
      - Откройте вкладку **Прослушиватель** и выберите параметр **Создать прослушиватель группы доступности**. Введите имя прослушивателя и установите в поле **Порт** значение 1433 (этот параметр не поддерживает другие порты).
    
    - Нажмите кнопку **Добавить** и введите предпочтительный виртуальный IP‑адрес в поле **IPv4-адрес**, затем нажмите кнопку **ОК**.
    
    - На странице **Выбор начальной синхронизации данных** выберите "Полное" и укажите доступную для реплик папку, запись в которую разрешена учетной записи службы SQL, используемой обеими репликами. Затем нажмите кнопку **Далее**.
    
    Этот общий файловый ресурс будет временно использоваться при инициализации баз данных. При работе с большими базами данных рекомендуется инициализировать их вручную, если полосы пропускания сети недостаточно для передачи резервных копий баз данных.
    
    - На странице "Проверка" убедитесь в успешном выполнении всех операций проверки, затем нажмите кнопку **Далее**.
    
    - На странице **Сводка** проверьте значения всех параметров и нажмите кнопку "Готово".
    
11. Создание нового магазина с указанием прослушивателя AG и указанием участника старого зеркала в качестве основного узла для AG.
    
    - Открытие построителя топологии. В данной топологии разверните узел **Общие компоненты**, щелкните **Хранилища SQL Server** правой кнопкой мыши и выберите **Создать хранилище SQL Server**.
    
    - На странице **Определение нового хранилища SQL Server** сначала установите флажок **Параметры высокого уровня доступности**, затем убедитесь в том, что в раскрывающемся списке отображаются группы доступности SQL AlwaysOn.
    
    - В поле **Полное доменное имя прослушивателя группы доступности SQL Server** введите полное доменное имя прослушивателя, созданного в процессе создания группы доступности.
    
    - В поле **FQDN сервера SQL Server** введите полное доменное имя основного узла AG и нажмите кнопку **ОК**. This should be the principal of the old mirror for this store.
    
12. Свяжите новую AG с пулом переднего плана.
    
    - В построителе топологии щелкните пул правой кнопкой мыши и выберите команду **изменить свойства**.
    
    - В разделе **связи**в поле **хранилище SQL Server** выберите AG. Выберите одну и ту же группу для всех баз данных в пуле, которые вы хотите переместить в AG.
    
    - Убедившись в том, что все необходимые базы данных настроены для AG, нажмите кнопку **ОК**.
    
13. Опубликуйте топологию. В меню **Действие** щелкните **Топология**, затем **Опубликовать**. Затем на странице подтверждения нажмите кнопку **Далее**.
    
14. Выполните некоторые заключительные действия, чтобы убедиться, что имена входа SQL находятся на каждой реплике в группе доступность AlwaysOn.
    
    - Откройте конфигуратор топологии, выберите пункт **загрузить топологию из существующего развертывания**и нажмите кнопку **ОК**.
    
    - Expand Skype for Business Server, expand your topology, and expand **SQL Server Stores**. Щелкните правой кнопкой мыши хранилище SQL нового AG и выберите команду **изменить свойства**.
    
    - В нижней части страницы в поле **FQDN сервера SQL Server** измените значение на полное доменное имя прослушивателя AG.
    
    - Опубликуйте топологию. В меню **Действие** щелкните **Топология**, затем **Опубликовать**. Затем на странице подтверждения нажмите кнопку **Далее**. Репликация новой топологии занимает несколько минут.
    
    - Откройте центр SQL Server Management Studio и перейдите в "AG". Fail it over to a secondary replica.
    
    - Откройте командную консоль управления Skype для бизнеса Server и введите следующий командлет для создания имен входа SQL в этой реплике:
    
    ```
    Install-CsDatabase -Update
    ```

    - Повторите предыдущие два действия (для группы с помощью дополнительной реплики), а затем используйте `Install-CsDatabase -Update`ее для каждой реплики в группе.
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-does-not-use-database-mirroring"></a>Развертывание группы доступности Always On в существующем пуле, который не использует зеркальное отображение базы данных
<a name="BKMK_NoHAPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> Если в пуле, который вы обновляете до AG, размещено центральное хранилище управления для Организации, необходимо сначала переместить CMS в другой пул, прежде чем обновлять этот пул. Use the Move-CsManagementServer cmdlet to move the pool. Если у вас нет другого пула в вашей организации, вы можете временно развернуть сервер Standard Edition и переместить CMS на этот сервер перед обновлением пула до AG. 
  
1. Настройте функцию отказоустойчивой кластеризации на всех серверах баз данных, которые будут входить в AG. On each server, do the following
    
   - Откройте диспетчер серверов и щелкните **Добавить роли и компоненты**.
    
   - Нажимайте кнопку **Далее** до появления поля **Выбор компонентов**. В этом окне установите флажок **Отказоустойчивость кластеров**.
    
   - В поле **Добавить компоненты, необходимые для Отказоустойчивость кластеров?** щелкните **Добавить компоненты**.
    
   - Нажмите **Установить**.
    
2. Проверьте конфигурацию кластеров.
    
   - В диспетчере серверов щелкните меню **Сервис**, затем пункт **Диспетчер отказоустойчивости кластеров**.
    
   - В разделе **Действия** с правой стороны экрана щелкните **Проверить конфигурацию**.
    
   - На странице **Прежде чем приступить к работе** нажмите кнопку **Далее**.
    
   - Выберите серверы для добавления к кластеру, затем щелкните **Выполнить все тесты**.
    
   - В поле **Сводка** отметьте все ошибки, обнаруженные в ходе работы мастера. Затем нажмите кнопку **Готово** для завершения проверки.
    
     В этом поле мастера может отображаться несколько предупреждений, особенно в том случае, если не используется общее хранилище. Пользоваться общим хранилищем не обязательно. Однако при наличии сообщений с заголовком **Ошибка** перед продолжением необходимо устранить неполадки.
    
3. Создайте отказоустойчивый кластер Windows Server (WSFC).
    
   - В мастере **Средства управления отказоустойчивыми кластерами** щелкните **Средства управления отказоустойчивыми кластерами**, затем выберите **Создание кластера**.
    
   - На странице **Прежде чем приступить к работе** нажмите кнопку **Далее**.
    
   - Добавьте имя и IP -адрес кластера. После проверки параметров нажмите кнопку **Далее**.
    
   - На странице "Подтверждение" нажмите кнопку **Далее**.
    
   - После создания кластера нажмите кнопку **Готово**.
    
4. Рекомендуется настроить параметры кворума кластера для работы с файловым ресурсом-свидетелем. Для этого выполните следующие действия.
    
   - Щелкните имя кластера правой кнопкой мыши и выберите **More Actions**, затем **Настройка параметров кворума кластера**.
    
   - На странице **Выбор параметра конфигурации кворума** щелкните **Выбрать свидетель кворума**.
    
   - На странице **Выбор свидетеля кворума** щелкните **Настроить файловый ресурс-свидетель**.
    
   - На странице **Настройка файлового ресурса-свидетеля** введите путь к требуемому общему файловому ресурсу, затем нажмите кнопку **Далее**.
    
   - На странице **Подтверждение** нажмите кнопку **Далее**.
    
5. На каждом сервере в кластере включите AG в диспетчере конфигурации SQL Server.
    
   - Откройте диспетчер конфигурации SQL Server. В дереве с левой стороны экрана щелкните **Службы SQL Server**, затем дважды щелкните службу SQL Server.  
    
   - В окне **Свойства** перейдите на вкладку **Высокий уровень доступности AlwaysOn**. Установите флажок **Включить группы доступности AlwaysOn**. По запросу перезапустите службу SQL Server.
    
6. Создайте группу доступности.
    
   - Откройте Microsoft SQL Server Management Studio и установите соединение с экземпляром SQL Server.
    
   - В обозревателе объектов разверните папку " **всегда в высоком уровне доступности** ". Щелкните папку **Группы доступности** правой кнопкой мыши и выберите **Мастер создания групп доступности**.
    
   - В случае появления страницы **Введение** нажмите кнопку **Далее**.
    
   - На странице **Указание имени группы доступности** введите имя группы доступности, затем нажмите кнопку **Далее**.
    
   - На странице Выбор баз данных выберите базы данных, которые вы хотите включить в AG. Then click **Next**.
    
     Не включайте базы данных **ReportServer**, **reportservertempdb**и сохраняемые чата в AG, так как они не поддерживаются в этом сценарии. Вы можете включить все другие базы данных Skype для бизнеса Server в AG.
    
   - На странице **Определение реплики** перейдите на вкладку **реплики** . Затем нажмите кнопку **Добавить реплики** и подключитесь к другим экземплярам SQL, которые вы присоединились как узлы WSFC.
    
   - Для каждого экземпляра выберите режимы **Автоматический переход на другой ресурс** и **Синхронная фиксация**. Не выбирайте режим **Вторичная реплика для чтения**.
    
   - Перейдите на вкладку **Конечные точки** и убедитесь в том, что для параметра **Номер порта** задано значение 5022.
    
   - Откройте вкладку **Прослушиватель** и выберите параметр **Создать прослушиватель группы доступности**. Введите имя прослушивателя и установите в поле **Порт** значение 1433 (этот параметр не поддерживает другие порты).
    
   - Нажмите кнопку **Добавить** и введите предпочтительный виртуальный IP‑адрес в поле **IPv4-адрес**, затем нажмите кнопку **ОК**.
    
   - На странице **Выбор начальной синхронизации данных** выберите "Полное" и укажите доступную для реплик папку, запись в которую разрешена учетной записи службы SQL, используемой обеими репликами. Затем нажмите кнопку **Далее**.
    
     Этот общий файловый ресурс будет временно использоваться при инициализации баз данных. При работе с большими базами данных рекомендуется инициализировать их вручную, если полосы пропускания сети недостаточно для передачи резервных копий баз данных.
    
     - На странице "Проверка" убедитесь в успешном выполнении всех операций проверки, затем нажмите кнопку **Далее**.
    
   - На странице **Сводка** проверьте значения всех параметров и нажмите кнопку "Готово".
    
7. Создание нового магазина с указанием прослушивателя AG.
    
   - Открытие построителя топологии. В данной топологии разверните узел **Общие компоненты**, щелкните **Хранилища SQL Server** правой кнопкой мыши и выберите **Создать хранилище SQL Server**.
    
   - На странице **Определение нового хранилища SQL Server** сначала установите флажок **Параметры высокого уровня доступности**, затем убедитесь в том, что в раскрывающемся списке отображаются группы доступности SQL AlwaysOn.
    
   - В поле **Полное доменное имя прослушивателя группы доступности SQL Server** введите полное доменное имя прослушивателя, созданного в процессе создания группы доступности.
    
   - В поле **FQDN сервера SQL Server** введите полное доменное имя основного узла AG и нажмите кнопку **ОК**.
    
8. Свяжите новую группу доступности Always On с пулом переднего плана.
    
   - В построителе топологии щелкните пул правой кнопкой мыши и выберите команду **изменить свойства**.
    
   - В разделе **связи**в поле **хранилище SQL Server** выберите AG. Выберите одну и ту же группу для всех баз данных в пуле, которые вы хотите переместить в AG.
    
   - Убедившись в том, что все необходимые базы данных настроены для AG, нажмите кнопку **ОК**.
    
9. Опубликуйте топологию. В меню **Действие** щелкните **Топология**, затем **Опубликовать**. Затем на странице подтверждения нажмите кнопку **Далее**.
    
10. Выполните некоторые заключительные действия, чтобы убедиться в том, что логины SQL находятся на каждой реплике в AG.
    
    - Откройте конфигуратор топологии, выберите пункт **загрузить топологию из существующего развертывания**и нажмите кнопку **ОК**.
    
    - Expand Skype for Business Server, expand your topology, and expand **SQL Server Stores**. Щелкните правой кнопкой мыши хранилище SQL нового AG и выберите команду **изменить свойства**.
    
    - В нижней части страницы в поле **FQDN сервера SQL Server** измените значение на полное доменное имя прослушивателя AG.
    
    - Опубликуйте топологию. В меню **Действие** щелкните **Топология**, затем **Опубликовать**. Затем на странице подтверждения нажмите кнопку **Далее**. Репликация новой топологии занимает несколько минут.
    
    - Откройте центр SQL Server Management Studio и перейдите в "AG". Fail it over to a secondary replica.
    
    - Откройте командную консоль управления Skype для бизнеса Server и введите следующий командлет для создания имен входа SQL в этой реплике:
    
      ```
      Install-CsDatabase -Update
      ```

      - Повторите предыдущие два действия (для группы с помощью дополнительной реплики), а затем используйте `Install-CsDatabase -Update`ее для каждой реплики в группе.
