---
title: Развертывание группы доступности Always On на тыловом сервере в Skype для бизнеса Server
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: c93c01e6-626c-40ad-92dd-373b0fe9189f
description: Развертывание (установка) группы доступности Always On в развертывании Skype для бизнеса Server.
ms.openlocfilehash: 83565efe850570ac5ab9a0695757e708f3eae566
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49830659"
---
# <a name="deploy-an-always-on-availability-group-on-a-back-end-server-in-skype-for-business-server"></a>Развертывание группы доступности Always On на тыловом сервере в Skype для бизнеса Server
 
Развертывание (установка) группы доступности Always On (AG) в развертывании Skype для бизнеса Server.
  
Развертывание ag зависит от того, развертывается ли она в новом пуле, в существующем пуле, использующем зеркальное отражение, или в существующем пуле, который в настоящее время не имеет высокой доступности для базы данных тыловой части.
  
> [!NOTE]
> Использование AG с ролью сервера сохраняемой беседы не поддерживается. 
  
- [Развертывание группы доступности Always On в новом пуле переднего доступа](alwayson-availability-group.md#BKMK_NewPool_CreateAlwaysOnGroup)
    
- [Развертывание группы доступности Always On в существующем пуле, использующем зеркальное отражение базы данных](alwayson-availability-group.md#BKMK_MirroredPool_CreateAlwaysOnGroup)
    
- [Развертывание группы доступности Always On в существующем пуле, который не использует зеркальное отражение базы данных](alwayson-availability-group.md#BKMK_NoHAPool_CreateAlwaysOnGroup)
    
## <a name="deploy-an-always-on-availability-group-on-a-new-front-end-pool"></a>Развертывание группы доступности Always On в новом пуле переднего доступа
<a name="BKMK_NewPool_CreateAlwaysOnGroup"> </a>

1. Включить функцию failover Clustering на всех серверах баз данных, которые будут в составе ag. На каждом сервере сделайте следующее:
    
   - Откройте диспетчер серверов и **нажмите кнопку "Добавить роли и функции".**
    
   - **Нажимайте кнопку** "Далее", пока не дойдете до **окна "Выбор компонентов".** В этом поле выберите **"Отбойная кластеризация".**
    
   - В **окне "Добавление компонентов, необходимых** для отбойной кластерной кластерии", нажмите кнопку **"Добавить функции".**
    
   - Нажмите **Установить**.
    
2. Проверьте конфигурацию кластера.
    
   - В диспетчере серверов выберите меню **"Инструменты",** а затем пункт **"Диспетчер отбойных кластеров".**
    
   - В **области "Действия"** в правой части экрана щелкните **"Проверить конфигурацию".**
    
   - На странице **Перед началом работы** нажмите кнопку **Далее**.
    
   - Выберите серверы для добавления в кластер и нажмите кнопку **"Выполнить все тесты".**
    
   - В поле **сводки** проверьте все ошибки, которые сообщает мастер. Затем нажмите **кнопку "Готово",** чтобы завершить проверку.
    
     Возможно, мастер вывести несколько предупреждений, особенно если общее хранилище не используется. Использовать общее хранилище не требуется. Тем не менее, если вы видите сообщения **об ошибках,** необходимо устранить эти проблемы, прежде чем продолжить.
    
3. Создание кластера windows Server Failover Cluster (WSFC).
    
   - В **мастере управления failover Cluster Management** щелкните правой кнопкой мыши **"Управление** отбойным кластером" и выберите **"Создать кластер".**
    
   - На странице **Перед началом работы** нажмите кнопку **Далее**.
    
   - Добавьте имя кластера и IP-адрес. После проверки параметров нажмите кнопку **"Далее".**
    
   - На странице Подтверждение нажмите кнопку **Далее**.
    
   - После создания кластера нажмите кнопку **"Готово".**
    
4. Рекомендуется настроить параметры кворума кластера для использования файловой папки-свидетеля. Для этого сделайте вот что:
    
   - Щелкните правой кнопкой мыши имя кластера, выберите "Дополнительные действия" и выберите "Настройка параметров **кворума кластера".**
    
   - На странице **"Выбор параметра конфигурации кворума"** щелкните **"Выберите свидетель кворума".**
    
   - На странице **"Выбор свидетеля кворума"** щелкните **"Настройка файловой папки-свидетеля".**
    
   - На странице **"Настройка файлового свидетеля"** введите путь к нужному файловому файлу и нажмите кнопку **"Далее".**
    
   - На странице **Подтверждение** нажмите кнопку **Далее**.
    
5. На каждом сервере в кластере в SQL Server Configuration Manager.
    
   - Откройте диспетчер конфигураций SQL Server. В дереве в левой части экрана щелкните SQL Server **services,** а затем дважды щелкните SQL Server службу. 
    
   - В поле **"Свойства"** выберите вкладку **"Высокий уровень доступности AlwaysOn".** Выберите **"Включить группы доступности AlwaysOn".** Перезапустите SQL Server по запросу.
   
6. Use Topology Builder to create the Front End pool, as explained in [Create and publish new topology in Skype for Business Server.](../../deploy/install/create-and-publish-new-topology.md) В этом случае укажите AG в качестве SQL для пула.
    
7. Создайте группу доступности.
    
   - Откройте SQL Server Management Studio и подключите его к SQL Server экземпляру.
    
   - В обозревателе объектов разоберете папку **"Высокий уровень доступности Always On".** Щелкните правой кнопкой мыши папку **"Группы** доступности" и выберите "Мастер новой **группы доступности".**
    
   - Если **появится страница** "Введение", нажмите кнопку **"Далее".**
    
   - На странице **"Указание имени группы** доступности" введите имя группы доступности и нажмите кнопку **"Далее".**
    
   - На странице "Выбор баз данных" выберите базы данных, которые необходимо включить в группу доступности AlwaysOn. Нажмите кнопку **Далее**.
    
     Не включайте базы данных **ReportServer,** **ReportServerTempDB** или Persistent Chat в группу доступности AlwaysOn, так как они не поддерживаются в этом сценарии. Вы можете включить все остальные базы данных Skype для бизнеса Server в группу доступности AlwaysOn.
    
   - На странице **"Указание реплик"** перейдите на вкладку **"Реплики".** Затем нажмите **кнопку "Добавить** реплики" и подключите другие экземпляры SQL, которые вы присоединили как узлы кластера для отключении Windows Server.
    
   - Для каждого экземпляра выберите параметры **автоматической отключки** и **синхронной фиксации.** Не выбирайте параметр **"Читаемый дополнительный".**
    
   - Перейдите **на вкладку "Конечные** точки" и убедитесь, что для номера порта установлено число 5022. 
    
   - Перейдите **на вкладку** "Прослушиватель" и выберите параметр **"Создать прослушиватель группы доступности".** В этом параметре введите имя прослушиватель  и заведите порт 1433 (другие порты для этого параметра не поддерживаются).
    
   - Нажмите **кнопку**"Добавить", а затем в **поле IPv4-адреса** уканите предпочитаемый виртуальный IP-адрес и нажмите кнопку **"ОК".**
    
   - На  странице "Выбор начальной синхронизации данных" выберите "Полная" и укажите папку, доступную репликам, и для учетной записи службы SQL Server, используемой обеими репликами, есть разрешения на запись. Нажмите кнопку **Далее**.
    
     Эта папка будет временно использоваться при инициализации баз данных. При работе с большими базами данных рекомендуется вручную инициализировать их, если пропускная способность сети не может вместить размер резервных копий баз данных.
    
   - На странице проверки убедитесь, что все проверки успешно, а затем нажмите кнопку **"Далее".**
    
   - На странице **"Сводка"** проверьте все параметры и нажмите кнопку "Готово".
      
8. После развертывания пула и ag выполните некоторые последние действия, чтобы убедиться, что SQL входа находятся на каждой реплике в группе доступности AlwaysOn. 
    
   - Откройте построитель топологий, выберите "Загрузить **топологию" из** существующего развертывания и нажмите кнопку **"ОК".**
    
   - Разверите Skype для бизнеса Server, развяйте топологию и SQL Server **хранилищах.** Щелкните правой кнопкой мыши SQL новой группы доступности AlwaysOn и выберите "Изменить **свойства".**
    
     - В нижней части страницы в SQL Server **FQDN** измените значение на FQDN прослушиватель ag.
    
   - Опубликуйте топологию. В меню **действий** **щелкните "Топология",** а затем **"Опубликовать".** Затем на странице подтверждения нажмите кнопку **"Далее".** Затем подождите несколько минут, пока не будет реплицироваться новая топология.
    
   - Откройте SQL Server Management Studio и перейдите к ag. Перенаправь его на вторичную реплику.
    
   - Откройте оболочку управления Skype для бизнеса Server и введите следующий SQL для входа в эту реплику:
    
   ```powershell
   Install-CsDatabase -Update
   ```

   - Повторите два предыдущих шага (перенаправляйте группу на вторичную реплику, а затем используйте) для каждой  `Install-CsDatabase -Update` реплики в группе.
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-uses-database-mirroring"></a>Развертывание группы доступности Always On в существующем пуле, использующем зеркальное отражение базы данных
<a name="BKMK_MirroredPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> Если в пуле, обновляемом до ag, размещено центральное хранилище управления для организации, перед обновлением этого пула необходимо сначала переместить CMS в другой пул. Используйте Move-CsManagementServer для перемещения пула. Если в организации нет другого пула, можно временно развернуть сервер Standard Edition и переместить CMS на этот сервер перед обновлением пула до ag. 
  
1. Отведите все данные от зеркала к основному узлу, открыв skype для бизнеса Server Management Shell и введя следующий cmdlet.
    
   ```powershell
   Invoke-CsDatabaseFailover -PoolFqdn <Pool FQDN> -DatabaseType <DatabaseType> -NewPrincipal "Primary"
   ```

    Повторите этот cmdlet для каждого типа базы данных в пуле. Чтобы найти все типы баз данных, хранимые в этом пуле, можно использовать следующий cmdlet.
     
   ```powershell
   Get-CsPool -Identity <Pool FQDN>
   ```

2. Используйте построитель топологий для удаления зеркального отражания базы данных из пула.
    
   - Откройте построитель топологий. В своей топологии разйдите пулы переднего входа **Enterprise Edition,** щелкните правой кнопкой мыши имя пула и выберите "Изменить **свойства".**
    
   - Для каждого типа SQL в пуле с помощью этого SQL **зеркального** зеркального хранения.
    
3. Опубликуем измененную топологию. В меню **действий** **щелкните "Топология",** а затем **"Опубликовать".** Затем на странице подтверждения нажмите кнопку **"Далее"**
    
4. Используйте SQL Server Management Studio для разгона зеркала.
    
   - Откройте SQL Server Management Studio, перейдите к базам данных, щелкните правой кнопкой **мыши "Задачи"** и выберите **"Зеркало".** Затем нажмите **кнопку "Удалить зеркальное** отражение" и нажмите кнопку **"ОК".**
    
   - Повторите это для всех баз данных в пуле, которые будут преобразованы в ag.
    
5. Настройка функции failover Clustering на всех серверах баз данных, которые будут частью AG. На каждом сервере сделайте следующее:
    
   - Откройте диспетчер серверов и **нажмите кнопку "Добавить роли и функции".**
    
   - **Нажимайте кнопку** "Далее", пока не дойдете до **окна "Выбор компонентов".** В этом поле выберите **"Отбойная кластеризация".**
    
   - В **окне "Добавление компонентов, необходимых** для отбойной кластерной кластерии", нажмите кнопку **"Добавить функции".**
    
   - Нажмите **Установить**.
    
6. Проверьте конфигурацию кластера.
    
   - В диспетчере серверов выберите меню **"Инструменты",** а затем пункт **"Диспетчер отбойных кластеров".**
    
   - В **области "Действия"** в правой части экрана щелкните **"Проверить конфигурацию".**
    
   - На странице **Перед началом работы** нажмите кнопку **Далее**.
    
   - Выберите серверы для добавления в кластер и нажмите кнопку **"Выполнить все тесты".**
    
   - В поле **сводки** проверьте все ошибки, которые сообщает мастер. Затем нажмите **кнопку "Готово",** чтобы завершить проверку.
    
     Возможно, мастер вывести несколько предупреждений, особенно если общее хранилище не используется. Использовать общее хранилище не требуется. Тем не менее, если вы видите сообщения **об ошибках,** необходимо устранить эти проблемы, прежде чем продолжить.
    
7. Создайте кластер ото всех серверов Windows Server.
    
   - В **мастере управления failover Cluster Management** щелкните правой кнопкой мыши **"Управление** отбойным кластером" и выберите **"Создать кластер".**
    
   - На странице **Перед началом работы** нажмите кнопку **Далее**.
    
   - Добавьте имя кластера и IP-адрес. После проверки параметров нажмите кнопку **"Далее".**
    
   - На странице Подтверждение нажмите кнопку **Далее**.
    
   - После создания кластера нажмите кнопку **"Готово".**
    
8. Рекомендуется настроить параметры кворума кластера для использования файловой папки-свидетеля. Для этого сделайте вот что:
    
   - Щелкните правой кнопкой мыши имя кластера, выберите "Дополнительные действия" и выберите "Настройка параметров **кворума кластера".**
    
   - На странице **"Выбор параметра конфигурации кворума"** щелкните **"Выберите свидетель кворума".**
    
   - На странице **"Выбор свидетеля кворума"** щелкните **"Настройка файловой папки-свидетеля".**
    
   - На странице **"Настройка файлового свидетеля"** введите путь к нужному файловому файлу и нажмите кнопку **"Далее".**
    
   - На странице **Подтверждение** нажмите кнопку **Далее**.
    
9. На каждом сервере в кластере в SQL Server Configuration Manager.
    
   - Откройте диспетчер конфигураций SQL Server. В дереве в левой части экрана щелкните SQL Server **services,** а затем дважды щелкните SQL Server службу. 
    
   - В поле **"Свойства"** выберите вкладку **"Высокий уровень доступности AlwaysOn".** Выберите **"Включить группы доступности AlwaysOn".** Перезапустите SQL Server по запросу.
    
10. Создайте группу доступности.
    
    - Откройте SQL Server Management Studio и подключите его к SQL Server экземпляру.
    
    - В обозревателе объектов разоберете папку **"Высокий уровень доступности Always On".** Щелкните правой кнопкой мыши папку **"Группы** доступности" и выберите "Мастер новой **группы доступности".**
    
    - Если **появится страница** "Введение", нажмите кнопку **"Далее".**
    
    - На странице **"Указание имени группы** доступности" введите имя группы доступности и нажмите кнопку **"Далее".**
    
    - На странице "Выбор баз данных" выберите базы данных, которые необходимо включить в группу доступности AlwaysOn. Нажмите кнопку **Далее**.
    
    Не включайте базы данных **ReportServer,** **ReportServerTempDB** или Persistent Chat в группу доступности AlwaysOn, так как они не поддерживаются в этом сценарии. Вы можете включить все остальные базы данных Skype для бизнеса Server в группу доступности AlwaysOn.
    
    - На странице **"Указание реплик"** перейдите на вкладку **"Реплики".** Затем нажмите **кнопку "Добавить** реплики" и подключите другие экземпляры SQL, которые вы присоединили как узлы кластера для отключении Windows Server.
    
    - Для каждого экземпляра выберите параметры **автоматической отключки** и **синхронной фиксации.** Не выбирайте параметр **"Читаемый дополнительный".**
    
    - Перейдите **на вкладку "Конечные** точки" и убедитесь, что для номера порта установлено число 5022. 
    
      - Перейдите **на вкладку** "Прослушиватель" и выберите параметр **"Создать прослушиватель группы доступности".** В этом параметре введите имя прослушиватель  и заведите порт 1433 (другие порты для этого параметра не поддерживаются).
    
    - Нажмите **кнопку**"Добавить", а затем в **поле IPv4-адреса** уканите предпочитаемый виртуальный IP-адрес и нажмите кнопку **"ОК".**
    
    - На  странице "Выбор начальной синхронизации данных" выберите "Полная" и укажите папку, доступную репликам, и для учетной записи службы SQL Server, используемой обеими репликами, есть разрешения на запись. Нажмите кнопку **Далее**.
    
    Эта папка будет временно использоваться при инициализации баз данных. При работе с большими базами данных рекомендуется вручную инициализировать их, если пропускная способность сети не может вместить размер резервных копий баз данных.
    
    - На странице проверки убедитесь, что все проверки успешно, а затем нажмите кнопку **"Далее".**
    
    - На странице **"Сводка"** проверьте все параметры и нажмите кнопку "Готово".
    
11. Создайте новое хранилище, указав прослушиватель AG и указав в качестве основного узла AG основной основной узел старого зеркала.
    
    - Откройте построитель топологий. В топологии разйдите раздел "Общие компоненты", щелкните правой кнопкой мыши SQL Server **Store** и выберите "Новый SQL Server **Store".**
    
    - На странице "Определение нового **SQL Store"**  сначала выберите "Параметры высокой доступности", а затем убедитесь, что в этом SQL группы доступности AlwaysOn.
    
    - В поле **SQL Server FQDN** прослушиватель доступности введите FQDN прослушиватель, созданный при создания группы доступности.
    
    - В поле **SQL Server FQDN** введите FQDN основного узла AG и нажмите кнопку **ОК.** Это должен быть основной частью старого зеркала для этого магазина.
    
12. Связать новую ag с пулом переднего конца.
    
    - В построителье топологий щелкните правой кнопкой мыши пул, чтобы связать его с ag, и выберите "Изменить **свойства".**
    
    - В **области "Связи"** в **SQL Server Store** выберите ag. Выберите ту же группу для любых других баз данных в пуле, которые нужно переместить в группу.
    
    - Убедившись, что все необходимые базы данных настроены на ag, нажмите кнопку **"ОК".**
    
13. Опубликуйте топологию. В меню **действий** **щелкните "Топология",** а затем **"Опубликовать".** Затем на странице подтверждения нажмите кнопку **"Далее".**
    
14. Выполните некоторые последние действия, чтобы SQL учетные записи для входа в каждую реплику в группе доступности AlwaysOn.
    
    - Откройте построитель топологий, выберите "Загрузить **топологию" из** существующего развертывания и нажмите кнопку **"ОК".**
    
    - Разверите Skype для бизнеса Server, развяйте топологию и SQL Server **хранилищах.** Щелкните правой кнопкой мыши SQL новой ag и выберите "Изменить **свойства".**
    
    - В нижней части страницы в SQL Server **FQDN** измените значение на FQDN прослушиватель ag.
    
    - Опубликуйте топологию. В меню **действий** **щелкните "Топология",** а затем **"Опубликовать".** Затем на странице подтверждения нажмите кнопку **"Далее".** Затем подождите несколько минут, пока не будет реплицироваться новая топология.
    
    - Откройте SQL Server Management Studio и перейдите к ag. Перенаправь его на вторичную реплику.
    
    - Откройте оболочку управления Skype для бизнеса Server и введите следующий SQL для входа в эту реплику:
    
    ```powershell
    Install-CsDatabase -Update
    ```

    - Повторите два предыдущих шага (перенаправляйте группу на вторичную реплику, а затем используйте) для каждой  `Install-CsDatabase -Update` реплики в группе.
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-does-not-use-database-mirroring"></a>Развертывание группы доступности Always On в существующем пуле, который не использует зеркальное отражение базы данных
<a name="BKMK_NoHAPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> Если в пуле, обновляемом до ag, размещено центральное хранилище управления для организации, перед обновлением этого пула необходимо сначала переместить CMS в другой пул. Используйте Move-CsManagementServer для перемещения пула. Если в организации нет другого пула, можно временно развернуть сервер Standard Edition и переместить CMS на этот сервер перед обновлением пула до ag. 
  
1. Настройка функции failover Clustering на всех серверах баз данных, которые будут частью AG. На каждом сервере сделайте следующее:
    
   - Откройте диспетчер серверов и **нажмите кнопку "Добавить роли и функции".**
    
   - **Нажимайте кнопку** "Далее", пока не дойдете до **окна "Выбор компонентов".** В этом поле выберите **"Отбойная кластеризация".**
    
   - В **окне "Добавление компонентов, необходимых** для отбойной кластерной кластерии", нажмите кнопку **"Добавить функции".**
    
   - Нажмите **Установить**.
    
2. Проверьте конфигурацию кластера.
    
   - В диспетчере серверов выберите меню **"Инструменты",** а затем пункт **"Диспетчер отбойных кластеров".**
    
   - В **области "Действия"** в правой части экрана щелкните **"Проверить конфигурацию".**
    
   - На странице **Перед началом работы** нажмите кнопку **Далее**.
    
   - Выберите серверы для добавления в кластер и нажмите кнопку **"Выполнить все тесты".**
    
   - В поле **сводки** проверьте все ошибки, которые сообщает мастер. Затем нажмите **кнопку "Готово",** чтобы завершить проверку.
    
     Возможно, мастер вывести несколько предупреждений, особенно если общее хранилище не используется. Использовать общее хранилище не требуется. Тем не менее, если вы видите сообщения **об ошибках,** необходимо устранить эти проблемы, прежде чем продолжить.
    
3. Создание кластера windows Server Failover Cluster (WSFC).
    
   - В **мастере управления failover Cluster Management** щелкните правой кнопкой мыши **"Управление** отбойным кластером" и выберите **"Создать кластер".**
    
   - На странице **Перед началом работы** нажмите кнопку **Далее**.
    
   - Добавьте имя кластера и IP-адрес. После проверки параметров нажмите кнопку **"Далее".**
    
   - На странице Подтверждение нажмите кнопку **Далее**.
    
   - После создания кластера нажмите кнопку **"Готово".**
    
4. Рекомендуется настроить параметры кворума кластера для использования файловой папки-свидетеля. Для этого сделайте вот что:
    
   - Щелкните правой кнопкой мыши имя кластера, выберите "Дополнительные действия" и выберите "Настройка параметров **кворума кластера".**
    
   - На странице **"Выбор параметра конфигурации кворума"** щелкните **"Выберите свидетель кворума".**
    
   - На странице **"Выбор свидетеля кворума"** щелкните **"Настройка файловой папки-свидетеля".**
    
   - На странице **"Настройка файлового свидетеля"** введите путь к нужному файловому файлу и нажмите кнопку **"Далее".**
    
   - На странице **Подтверждение** нажмите кнопку **Далее**.
    
5. На каждом сервере в кластере в SQL Server Configuration Manager.
    
   - Откройте диспетчер конфигураций SQL Server. В дереве в левой части экрана щелкните SQL Server **services,** а затем дважды щелкните SQL Server службу. 
    
   - В поле **"Свойства"** выберите вкладку **"Высокий уровень доступности AlwaysOn".** Выберите **"Включить группы доступности AlwaysOn".** Перезапустите SQL Server по запросу.
    
6. Создайте группу доступности.
    
   - Откройте SQL Server Management Studio и подключите его к SQL Server экземпляру.
    
   - В обозревателе объектов разоберете папку **"Высокий уровень доступности Always On".** Щелкните правой кнопкой мыши папку **"Группы** доступности" и выберите "Мастер новой **группы доступности".**
    
   - Если **появится страница** "Введение", нажмите кнопку **"Далее".**
    
   - На странице **"Указание имени группы** доступности" введите имя группы доступности и нажмите кнопку **"Далее".**
    
   - На странице "Выбор баз данных" выберите базы данных, которые необходимо включить в ag. Нажмите кнопку **Далее**.
    
     Не включайте базы данных **ReportServer,** **ReportServerTempDB** или Persistent Chat в ag, так как они не поддерживаются в этом сценарии. Вы можете включить все остальные базы данных Skype для бизнеса Server в ag.
    
   - На странице **"Указание реплик"** перейдите на вкладку **"Реплики".** Затем нажмите **кнопку "Добавить реплики"** и подключите другие экземпляры SQL, которые вы присоединили как узлы WSFC.
    
   - Для каждого экземпляра выберите параметры **автоматической отключки** и **синхронной фиксации.** Не выбирайте параметр **"Читаемый дополнительный".**
    
   - Перейдите **на вкладку "Конечные** точки" и убедитесь, что для номера порта установлено число 5022. 
    
   - Перейдите **на вкладку** "Прослушиватель" и выберите параметр **"Создать прослушиватель группы доступности".** В этом параметре введите имя прослушиватель  и заведите порт 1433 (другие порты для этого параметра не поддерживаются).
    
   - Нажмите **кнопку**"Добавить", а затем в **поле IPv4-адреса** уканите предпочитаемый виртуальный IP-адрес и нажмите кнопку **"ОК".**
    
   - На  странице "Выбор начальной синхронизации данных" выберите "Полная" и укажите папку, доступную репликам, и для учетной записи службы SQL Server, используемой обеими репликами, есть разрешения на запись. Нажмите кнопку **Далее**.
    
     Эта папка будет временно использоваться при инициализации баз данных. При работе с большими базами данных рекомендуется вручную инициализировать их, если пропускная способность сети не может вместить размер резервных копий баз данных.
    
     - На странице проверки убедитесь, что все проверки успешно, а затем нажмите кнопку **"Далее".**
    
   - На странице **"Сводка"** проверьте все параметры и нажмите кнопку "Готово".
    
7. Создайте новое хранилище, указывав прослушиватель AG.
    
   - Откройте построитель топологий. В топологии разйдите раздел "Общие компоненты", щелкните правой кнопкой мыши SQL Server **Store** и выберите "Новый SQL Server **Store".**
    
   - На странице "Определение нового **SQL Store"**  сначала выберите "Параметры высокой доступности", а затем убедитесь, что в этом SQL группы доступности AlwaysOn.
    
   - В поле **SQL Server FQDN** прослушиватель доступности введите FQDN прослушиватель, созданный при создания группы доступности.
    
   - В поле **SQL Server FQDN** введите FQDN основного узла AG и нажмите кнопку **ОК.**
    
8. Связать новую группу доступности Always On с пулом переднего доступа.
    
   - В построителье топологий щелкните правой кнопкой мыши пул, чтобы связать его с ag, и выберите "Изменить **свойства".**
    
   - В **области "Связи"** в **SQL Server Store** выберите ag. Выберите ту же группу для любых других баз данных в пуле, которые нужно переместить в группу.
    
   - Убедившись, что все необходимые базы данных настроены на ag, нажмите кнопку **"ОК".**
    
9. Опубликуйте топологию. В меню **действий** **щелкните "Топология",** а затем **"Опубликовать".** Затем на странице подтверждения нажмите кнопку **"Далее".**
    
10. Выполните некоторые последние действия, чтобы SQL учетные записи для входа в каждую реплику в AG.
    
    - Откройте построитель топологий, выберите "Загрузить **топологию" из** существующего развертывания и нажмите кнопку **"ОК".**
    
    - Разверите Skype для бизнеса Server, развяйте топологию и SQL Server **хранилищах.** Щелкните правой кнопкой мыши SQL новой ag и выберите "Изменить **свойства".**
    
    - В нижней части страницы в SQL Server **FQDN** измените значение на FQDN прослушиватель ag.
    
    - Опубликуйте топологию. В меню **действий** **щелкните "Топология",** а затем **"Опубликовать".** Затем на странице подтверждения нажмите кнопку **"Далее".** Затем подождите несколько минут, пока не будет реплицироваться новая топология.
    
    - Откройте SQL Server Management Studio и перейдите к ag. Перенаправь его на вторичную реплику.
    
    - Откройте оболочку управления Skype для бизнеса Server и введите следующий SQL для входа в эту реплику:
    
      ```powershell
      Install-CsDatabase -Update
      ```

      - Повторите два предыдущих шага (перенаправляйте группу на вторичную реплику, а затем используйте) для каждой  `Install-CsDatabase -Update` реплики в группе.
