---
title: Настройка высокой доступности и аварийного восстановления для сервера сохраняемой беседы в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.assetid: 5fb5b189-56c1-49cf-92c8-e4fd6e2fdd5c
description: Сводка. В этом разделе вы узнаете, как настроить высокую доступность и аварийное восстановление для сервера сохраняемой беседы в Skype для бизнеса Server 2015.
ms.openlocfilehash: 10d9e2eb76873cedc82daea817a732b8feb379da
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49802139"
---
# <a name="configure-high-availability-and-disaster-recovery-for-persistent-chat-server-in-skype-for-business-server-2015"></a>Настройка высокой доступности и аварийного восстановления для сервера сохраняемой беседы в Skype для бизнеса Server 2015
 
**Сводка:** В этом разделе вы узнаете, как настроить высокую доступность и аварийное восстановление для сервера сохраняемой беседы в Skype для бизнеса Server 2015.
  
Skype для бизнеса Server поддерживает несколько режимов высокой доступности для серверов, включая зеркальное отражение базы данных. Дополнительные сведения см. в плане высокой доступности и аварийного восстановления [в Skype для бизнеса Server 2015.](../../plan-your-deployment/high-availability-and-disaster-recovery/high-availability-and-disaster-recovery.md)
  
> [!NOTE]
> Группы доступности AlwaysOn не поддерживаются серверами сохраняемой беседы. 

> [!NOTE] 
> Сохраняемая беседа доступна в Skype для бизнеса Server 2015, но больше не поддерживается в Skype для бизнеса Server 2019. Такие же функции доступны в Teams. Дополнительные сведения [см. в сведениях о том,](/microsoftteams/upgrade-start-here)как начать обновление Microsoft Teams. Если необходимо использовать сохраняемого чата, вы можете либо перенести пользователей, которым требуются эти функции, в Teams, либо продолжить использование Skype для бизнеса Server 2015.
  
Прежде чем настраивать развертывание сохраняемой беседы для высокой доступности и аварийного восстановления, ознакомьтесь с понятиями в плане высокой доступности и аварийного восстановления для сервера сохраняемой беседы в Skype для бизнеса [Server 2015.](../../plan-your-deployment/persistent-chat-server/high-availability-and-disaster-recovery.md) Решение аварийного восстановления для сервера сохраняемой беседы, описанное в этих темах, построено на растянутом пуле серверов сохраняемой беседы. В контенте планирования описываются требования к ресурсам и топология растянутой пула, которая обеспечивает высокую доступность и аварийное восстановление для сервера сохраняемой беседы, включая использование зеркального SQL Server для обеспечения высокой доступности и доставки журналов SQL Server для аварийного восстановления.
  
## <a name="use-topology-builder-to-configure-high-availability-and-disaster-recovery"></a>Использование построитель топологий для настройки высокой доступности и аварийного восстановления

В построитель топологий выполните следующие действия, чтобы настроить высокую доступность и аварийное восстановление для сервера сохраняемой беседы.
  
1. Добавьте зеркальные базы данных и дополнительные базы данных доставки журналов SQL Server хранилищах.
    
2. Изменить свойства службы сервера сохраняемой беседы, чтобы:
    
    а. Включите зеркальное отображение для базы данных-источника.
    
    б. Добавьте основное хранилище SQL Server зеркала.
    
    в. В SQL Server базы данных доставки журналов.
    
    г. Добавьте дополнительный SQL Server доставки журналов в SQL Server хранения.
    
    д. Добавьте зеркальное SQL Server для базы данных-дополнительного.
    
    е. Опубликуйте топологию.
    
## <a name="set-up-sql-server-log-shipping-for-the-persistent-chat-server-primary-database"></a>Настройка доставки SQL Server журналов для основной базы данных сервера сохраняемой беседы

Используя SQL Server Management Studio, подключите дополнительный экземпляр базы данных доставки журналов сервера сохраняемого чата и убедитесь, что SQL Server агент запущен. Затем подключите основной экземпляр базы данных сохраняемой беседы и выполните следующие действия:
  
1. Щелкните базу данных mgc правой кнопкой мыши и выберите пункт **Свойства**.
    
2. В области **Выбор страницы** щелкните элемент **Доставка журналов транзакций**.
    
3. Установите флажок **Включить эту базу данных в качестве источника в конфигурацию доставки журналов**.
    
4. В области **Резервные копии журналов транзакций** щелкните элемент **Параметры копирования**.
    
5. В **сетевом пути к папке** резервной копии введите сетевой путь к папке, созданной для папки резервного копирования журнала транзакций.
    
6. Если резервная папка расположена на основном сервере, введите локальный путь к папке резервного копирования в поле "Если папка резервного копирования расположена на основном сервере", введите локальный путь к папке **(пример: c:\backup).** (Если резервная папка находится не на основном сервере, вы можете оставить это поле пустым.)
    
    > [!IMPORTANT]
    > Если учетная запись SQL Server на основном сервере работает под локальной системной учетной записью, необходимо создать папку резервного копирования на основном сервере и указать локальный путь к этой папке. 
  
7. Настройте параметры **Удалить файлы, созданные ранее** и **Предупредить, если резервное копирование не произошло в течение**.
    
8. Просмотрите расписание резервного копирования, указанное в поле **Расписание** области **Задание резервного копирования**. Чтобы настроить расписание установки, нажмите кнопку **"Расписание"** и SQL Server агента по мере необходимости.
    
9. В **области "Сжатие"** **выберите "Использовать параметр сервера по умолчанию"** и нажмите кнопку **"ОК".**
    
10. В области **Экземпляры сервера-получателя и базы данных** нажмите кнопку **Добавить**.
    
11. Click **Connect** and connect to the instance of SQL Server that you have configured as your secondary server.
    
12. В поле **База данных-получатель** выберите в списке базу данных **mgc**.
    
13. На  вкладке "Инициализация базы данных-дополнительного" выберите вариант **"Да",** создайте полную резервную копию основной базы данных и восстановим ее во вторичной базе данных (и создайте вторичную базу данных, если она не существует).
    
14. На **вкладке "Копирование** файлов" в папке **"Назначение"** для копирования файлов введите путь к папке, в которую следует скопировать резервные копии журналов транзакций. Часто эта папка расположена на сервере-получателе.
    
15. Обратите внимание на расписание копирования, перечисленное в **поле расписания** в **статье "Задание копирования".** Чтобы настроить расписание установки, нажмите кнопку **"Расписание"** и SQL Server агента по мере необходимости. Это расписание должно быть приблизительно таким же, как и расписание резервного копирования.
    
16. На **вкладке "Восстановление"** в области **"Состояние базы** данных" при восстановлении резервных копий выберите режим **"Нет восстановления".**
    
17. Under **Delay restoring backups at least:**, select **0 minutes**.
    
18. Выберите порог оповещения в области **"Оповещение", если восстановление не происходит.**
    
19. Посмотрите на расписание восстановления, перечисленное в поле **"Расписание"** задания **"Восстановление".** Чтобы настроить расписание установки, нажмите кнопку "Расписание", SQL Server агента по мере необходимости и нажмите кнопку **"ОК".** Это расписание должно быть приблизительно таким же, как и расписание резервного копирования.
    
20. В **диалоговом окне "Свойства** базы данных" нажмите кнопку "ОК", чтобы начать процесс настройки. 
    
## <a name="set-up-sql-server-log-shipping-between-the-primary-mirror-and-the-secondary-database"></a>Настройка доставки SQL Server журналов между основным зеркалом и базой данных-дополнительным

Выполните следующие действия, чтобы продолжить доставку журналов, если основная база данных сохраняемой беседы перенаправилась в зеркальную базу данных.
  
1. Вручную перетастить основную базу данных сохраняемого чата на зеркальное отражение. Для этого используется оболочка управления Skype для бизнеса Server и **cmdlet Invoke-CsDatabaseFailover.**
    
2. С помощью SQL Server Management Studio подключите основной зеркальный экземпляр сервера сохраняемой беседы.
    
3. Убедитесь, что агент SQL Server запущен.
    
4. Щелкните базу данных mgc правой кнопкой мыши и выберите пункт **Свойства**.
    
5. В области **Выбор страницы** щелкните элемент **Доставка журналов транзакций**.
    
6. Установите флажок **Включить эту базу данных в качестве источника в конфигурацию доставки журналов**.
    
7. В области **Резервные копии журналов транзакций** щелкните элемент **Параметры копирования**.
    
8. В поле **Network path to the backup folder** (Сетевой путь к каталогу резервной копии) введите сетевой путь к общей папке, созданной для резервной копии журнала транзакций.
    
9. Если резервная папка находится на основном сервере, введите локальный путь к этой резервной папке в поле **Если папка резервного копирования находится на сервере-источнике, укажите локальный путь к папке**. (Если резервная папка находится не на основном сервере, вы можете оставить это поле пустым.)
    
    > [!IMPORTANT]
    > Если учетная запись SQL Server на основном сервере работает под локальной системной учетной записью, необходимо создать папку резервного копирования на основном сервере и указать локальный путь к этой папке. 
  
10. Настройте параметры **Удалить файлы, созданные ранее** и **Предупредить, если резервное копирование не произошло в течение**.
    
11. Просмотрите расписание резервного копирования, указанное в поле **Расписание** области **Задание резервного копирования**. Чтобы настроить расписание установки, нажмите кнопку **"Расписание"** и SQL Server агента по мере необходимости.
    
    > [!IMPORTANT]
    > Используйте те же параметры, которые применялись для основной базы данных. 
  
12. В области **Сжатие** выберите **Использовать параметр сервера по умолчанию** и нажмите кнопку **ОК**.
    
13. В области **Экземпляры сервера-получателя и базы данных** нажмите кнопку **Добавить**.
    
14. Щелкните элемент **Подключение** и подключитесь к экземпляру SQL Server, настроенному вами в качестве сервера-получателя.
    
15. В поле **База данных-получатель** выберите в списке базу данных **mgc**.
    
16. На вкладке **Инициализация базы данных-получателя** выберите параметр **Нет, база данных-получатель инициализирована**.
    
17. В поле **Папка назначения для копирования** на вкладке **Копирование файлов**  введите путь к папке, в которую следует копировать резервные копии журналов транзакций, и нажмите кнопку **ОК**. Часто эта папка расположена на сервере-получателе.
    
18. Откройте раскрывающийся список **Скрипт конфигурации** и выберите **Вывести конфигурацию в новое окно запроса**.
    
19. В разделе **Свойства базы данных** окна нового запроса нажмите кнопку **ОК**, чтобы начать процесс настройки.
    
20. Выберите и запустите первую половину запроса (см. шаг 18) до строки: -- \* \* \* \* \* \* End: Script to be run at Primary: \* \* \* \* \* \* .
    
    > [!IMPORTANT]
    > Запуск этого сценария вручную необходим, SQL Server Management Studio не поддерживает несколько основных баз данных в конфигурации SQL Server доставки журналов. 
  
21. Выберите **Отмена**, чтобы закрыть панель конфигурации доставки журналов и создать рабочую программу установки, которая правильно внедряет доставку файлов журналов как для основной, так и для зеркальной базы данных (в случае отработки отказа).
    
22. Вручную вернуть основную базу данных сохраняемого чата в основную. Для этого используется оболочка управления Skype для бизнеса Server и **cmdlet Invoke-CsDatabaseFailover.**
    

