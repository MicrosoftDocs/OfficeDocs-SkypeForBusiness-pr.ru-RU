---
title: Настройка высокой доступности и аварийного восстановления для сервера сохраняемого чата в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: get-started-article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.assetid: 5fb5b189-56c1-49cf-92c8-e4fd6e2fdd5c
description: 'Аннотация: Ознакомьтесь с этой статьей, чтобы научиться настраивать постоянный доступ и восстановление после аварии для постоянного сервера чата в Skype для бизнеса Server 2015.'
ms.openlocfilehash: 152797229dc02bfcd1991a9ac6f67370c9154593
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2019
ms.locfileid: "34282296"
---
# <a name="configure-high-availability-and-disaster-recovery-for-persistent-chat-server-in-skype-for-business-server-2015"></a>Настройка высокой доступности и аварийного восстановления для сервера сохраняемого чата в Skype для бизнеса Server 2015
 
**Сводка:** В этой статье приведены сведения о том, как настроить высокую доступность и аварийное восстановление для постоянного сервера чата в Skype для бизнеса Server 2015.
  
Skype для бизнеса Server поддерживает различные режимы высокой доступности серверных серверов, в том числе для зеркального отображения баз данных. Дополнительные сведения см. в статье [Plan for high availability and disaster recovery in Skype for Business Server 2015](../../plan-your-deployment/high-availability-and-disaster-recovery/high-availability-and-disaster-recovery.md).
  
> [!NOTE]
> Группы доступности AlwaysOn не поддерживаются на серверах сохраняемого чата. 

> [!NOTE] 
> Сохраняемый чат доступен в Skype для бизнеса Server 2015, но больше не поддерживается в Skype для бизнеса Server 2019. Эта функция доступна в Teams. Дополнительные сведения можно найти в разделе [путешествие из Skype для бизнеса в Microsoft Teams](/microsoftteams/journey-skypeforbusiness-teams). Если вы хотите использовать сохраняемый чат, вы можете либо перенести пользователей, которым требуются эти функции, в Teams, либо продолжить работу с Skype для бизнеса Server 2015.
  
Перед настройкой развертывания сохраняемого чата для обеспечения высокой доступности и аварийного восстановления убедитесь, что вы знакомы с концепциями в [плане обеспечения высокой доступности и аварийного восстановления для постоянного сервера чата в Skype для бизнеса Server 2015](../../plan-your-deployment/persistent-chat-server/high-availability-and-disaster-recovery.md). Решение для аварийного восстановления для сервера сохраняемого чата, описанное в этих статьях, построено на разтянутом пуле серверов сохраняемого чата. Материалы по планированию описывают требования к ресурсам и топологию растянутого пула, которая обеспечивает высокую доступность и аварийное восстановление для постоянного сервера чата, в том числе использование зеркального отображения SQL Server для обеспечения высокой доступности и доставки журналов SQL Server для Аварийное восстановление.
  
## <a name="use-topology-builder-to-configure-high-availability-and-disaster-recovery"></a>Использование построителя топологий для настройки высокой доступности и аварийного восстановления

В построителе топологий выполните указанные ниже действия, чтобы настроить высокую доступность и аварийное восстановление для сервера сохраняемого чата.
  
1. Добавьте зеркальные базы данных и хранилище журналов SQL Server, которые являются получателями.
    
2. Измените параметры службы сервера для сохраняемого чата следующим образом:
    
    a) Включите зеркальное отображение для базы данных-источника.
    
    б) Добавьте основное зеркальное хранилище SQL Server.
    
    в. Включите базу данных доставки журналов SQL Server.
    
    г. Добавьте хранилище журналов SQL Server с дополнительной доставкой.
    
    учеб. Добавьте зеркало хранилища SQL Server для базы данных получателя.
    
    н. Опубликуйте топологию.
    
## <a name="set-up-sql-server-log-shipping-for-the-persistent-chat-server-primary-database"></a>Настройка доставки журналов SQL Server для основной базы данных сервера сохраняемого чата

Используя SQL Server Management Studio, подключитесь к дополнительному экземпляру базы данных доставки журналов сервера чатов и убедитесь, что агент SQL Server запущен. Затем подключитесь к экземпляру базы данных сохраняемого чата и выполните указанные ниже действия.
  
1. Щелкните базу данных mgc правой кнопкой мыши и выберите **Свойства**.
    
2. В области **Выбор страницы** выберите **Доставка журналов транзакций**.
    
3. Установите флажок **Включить эту базу данных в качестве источника в конфигурацию доставки журналов**.
    
4. В области **Резервные копии журналов транзакций** щелкните элемент **Параметры копирования**.
    
5. В поле **Сетевой путь к каталогу резервной копии** введите сетевой путь к общей папке, созданной для резервных копий журналов транзакций.
    
6. Если папка резервного копирования располагается на основном сервере, введите локальный путь к папке резервного копирования в поле **Если папка резервного копирования находится на сервере-источнике, укажите локальный путь к папке (пример: c:\backup)**. (Если папка резервного копирования находится не на основном сервере, это поле можно оставить пустым.)
    
    > [!IMPORTANT]
    > Если учетная запись службы SQL Server на сервере-источнике работает под учетной записью локальной системы, необходимо создать ее на сервере-источнике и указать локальный путь к этой папке. 
  
7. Настройте параметры **Удалить файлы, созданные ранее** и **Предупредить, если резервное копирование не произошло в течение**.
    
8. Просмотрите расписание резервного копирования, приведенное в поле **Расписание** в разделе **Задание резервного копирования**. Чтобы настроить расписание установки, нажмите кнопку **Расписание**и настройте расписание агента SQL Server в соответствии с требованиями.
    
9. В разделе **Сжатие** выберите флажок **Использовать параметр сервера по умолчанию** и нажмите кнопку **ОК**.
    
10. В области **Экземпляры сервера-получателя и базы данных** нажмите кнопку **Добавить**.
    
11. Нажмите кнопку **подключить** и подключитесь к экземпляру SQL Server, который вы настроили как дополнительный сервер.
    
12. В поле **База данных-получатель** выберите в списке базу данных **mgc**.
    
13. На вкладке **Инициализация базы данных-получателя** выберите вариант **Да**, создайте полную резервную копию базы данных-источника и выполните восстановление из нее в базу данных-получатель (и создайте базу данных-получатель, если она не существует).
    
14. На вкладке **Копирование файлов** в поле **Папка назначения для копирования файлов** введите путь к папке, в которую необходимо копировать резервные копии журналов транзакций. Эта папка часто находится на дополнительном сервере.
    
15. Обратите внимание на расписание копирования, приведенное в поле **Расписание** в разделе **Задание копирования**. Чтобы настроить расписание установки, нажмите кнопку **Расписание**и настройте расписание агента SQL Server в соответствии с требованиями. Это расписание должно приблизительно совпадать с расписанием резервного копирования.
    
16. На вкладке **Восстановление** в разделе **Папка назначения для копирования файлов** выберите вариант **Режим без восстановления**.
    
17. В списке **Отложить восстановление резервных копий по крайней мере на** выберите значение **0 минут**.
    
18. В поле **Предупреждение, если восстановление не выполнено в течение** выберите порог оповещений.
    
19. Просмотрите расписание восстановления в поле **Расписание** в разделе **Задание восстановления**. Чтобы настроить расписание установки, нажмите кнопку **Расписание**, настройте расписание агента SQL Server и нажмите кнопку **ОК**. Это расписание должно приблизительно совпадать с расписанием резервного копирования.
    
20. В диалоговом окне **Свойства базы данных** нажмите кнопку **ОК**, чтобы приступить к настройке.
    
## <a name="set-up-sql-server-log-shipping-between-the-primary-mirror-and-the-secondary-database"></a>Настройка доставки журналов SQL Server между основным зеркалом и дополнительной базой данных

Выполните указанные ниже действия, чтобы доставка журналов продолжала, если база данных основного сохраняемого чата не перемещается в зеркальную базу данных.
  
1. Ручной переход на зеркальную базу данных основного сохраняемого чата. Это можно сделать с помощью командной консоли Skype для бизнеса Server и командлет **Invoke-ксдатабасефаиловер** .
    
2. Используя SQL Server Management Studio, подключитесь к экземпляру основного сервера сохраняемого чата.
    
3. Убедитесь, что агент SQL Server запущен.
    
4. Щелкните базу данных mgc правой кнопкой мыши и выберите **Свойства**.
    
5. В области **Выбор страницы** выберите **Доставка журналов транзакций**.
    
6. Установите флажок **Включить эту базу данных в качестве источника в конфигурацию доставки журналов**.
    
7. В области **Резервные копии журналов транзакций** щелкните элемент **Параметры копирования**.
    
8. В поле **Сетевой путь к каталогу резервной копии** введите сетевой путь к общей папке, созданной для резервной копии журнала транзакций.
    
9. Если резервная папка находится на основном сервере, введите локальный путь к этой резервной папке в поле **Если папка резервного копирования находится на сервере-источнике, укажите локальный путь к папке**. (Если резервная папка находится не на основном сервере, вы можете оставить это поле пустым.)
    
    > [!IMPORTANT]
    > Если учетная запись службы SQL Server на сервере-источнике работает под учетной записью локальной системы, необходимо создать ее на сервере-источнике и указать локальный путь к этой папке. 
  
10. Настройте параметры **Удалить файлы, созданные ранее** и **Предупредить, если резервное копирование не произошло в течение**.
    
11. Просмотрите расписание резервного копирования, приведенное в поле **Расписание** в разделе **Задание резервного копирования**. Чтобы настроить расписание установки, нажмите кнопку **Расписание**и настройте расписание агента SQL Server по мере необходимости.
    
    > [!IMPORTANT]
    > Используйте те же параметры, которые применялись для основной базы данных. 
  
12. В области **Сжатие** выберите **Использовать параметр сервера по умолчанию** и нажмите кнопку **ОК**.
    
13. В области **Экземпляры сервера-получателя и базы данных** нажмите кнопку **Добавить**.
    
14. Щелкните элемент **Подключение** и подключитесь к экземпляру SQL Server, настроенному вами в качестве сервера-получателя.
    
15. В поле **База данных-получатель** выберите в списке базу данных **mgc**.
    
16. На вкладке **Инициализация базы данных-получателя** выберите вариант **Нет, база данных-получатель инициализирована**.
    
17. В поле **Папка назначения для копирования** на вкладке **Копирование файлов** введите путь к папке, в которую следует копировать резервные копии журналов транзакций, и нажмите кнопку **ОК**. Часто эта папка расположена на сервере-получателе.
    
18. Откройте раскрывающийся список **Скрипт конфигурации** и выберите **Вывести конфигурацию в новое окно запроса**.
    
19. В разделе **Свойства базы данных** окна нового запроса нажмите кнопку **ОК**, чтобы начать процесс настройки.
    
20. Выберите и запустите первую половину запроса (см. шаг 18) до строки:-- \* \* \* \* \* \* End: сценарий для выполнения \* \* \* \* \* \*на основном уровне:.
    
    > [!IMPORTANT]
    > Ручной запуск этого сценария необходим, так как SQL Server Management Studio не поддерживает несколько баз данных-источника в конфигурации доставки журналов SQL Server. 
  
21. Выберите **Отмена**, чтобы закрыть панель конфигурации доставки журналов и создать рабочую программу установки, которая правильно внедряет доставку файлов журналов как для основной, так и для зеркальной базы данных (в случае отработки отказа). 
    
22. Вручную не удается вернуть основную базу данных в основное окно чата. Это можно сделать с помощью командной консоли Skype для бизнеса Server и командлет **Invoke-ксдатабасефаиловер** .
    

