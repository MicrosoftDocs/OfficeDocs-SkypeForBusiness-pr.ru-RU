---
title: Настройка высокой доступности и аварийного восстановления для сервера сохраняемого чата в Skype для бизнеса Server 2015
ms.reviewer: ''
ms.author: serdars
author: SerdarSoysal
manager: serdars
ms.date: 2/7/2018
ms.audience: ITPro
ms.topic: get-started-article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.assetid: 5fb5b189-56c1-49cf-92c8-e4fd6e2fdd5c
description: 'Сводка: Сведения в этой статье описывается настройка высокой доступности и аварийного восстановления для сервера сохраняемого чата в Скайп для Business Server 2015.'
ms.openlocfilehash: 7bc1ae0b71df3916c36acfdc7fabce91caa297e8
ms.sourcegitcommit: da8c037bb30abf5d5cf3b60d4b71e3a10e553402
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2019
ms.locfileid: "30899280"
---
# <a name="configure-high-availability-and-disaster-recovery-for-persistent-chat-server-in-skype-for-business-server-2015"></a>Настройка высокой доступности и аварийного восстановления для сервера сохраняемого чата в Skype для бизнеса Server 2015
 
**Сводка:** В данном разделе приведены в этой статье описывается настройка высокой доступности и аварийного восстановления для сервера сохраняемого чата в Скайп для Business Server 2015.
  
Скайп для Business Server поддерживает несколько режимов обеспечения высокой доступности для вашей внутренними серверами, включая зеркальное отображение базы данных. Дополнительные сведения см. в статье [Plan for high availability and disaster recovery in Skype for Business Server 2015](../../plan-your-deployment/high-availability-and-disaster-recovery/high-availability-and-disaster-recovery.md).
  
> [!NOTE]
> Группы обеспечения доступности AlwaysOn с серверов сохраняемого сеанса беседы не поддерживаются. 

> [!NOTE] 
> Сохраняемый чат доступна в Скайп для Business Server 2015, но больше не поддерживается в Скайп для Business Server 2019. Те же функциональные возможности доступны в группах. Для получения дополнительных сведений см [Реализация из Скайп для бизнеса для групп Майкрософт](/microsoftteams/journey-skypeforbusiness-teams). Если необходимо использовать сохраняемого чата, возможны либо перенос пользователей, которым требуется эта функция групп, или для дальнейшего использования Скайп для Business Server 2015.
  
Перед настройкой развертывания Persistent Chat для обеспечения высокой доступности и аварийного восстановления, убедитесь, что вы знакомы с понятиями в [Планирование высокой доступности и аварийного восстановления для сервера сохраняемого чата в Скайп для Business Server 2015](../../plan-your-deployment/persistent-chat-server/high-availability-and-disaster-recovery.md). Решение аварийного восстановления для сервера сохраняемого чата описаны в следующих разделах построена на вытянутый пул серверов сохраняемого чата. Планирования содержимого описание требований к ресурсам и топология растянутый пул, который позволяет высокой доступности и аварийного восстановления для сервера сохраняемого чата, включая использование зеркального отображения SQL Server для обеспечения высокой доступности и доставки журналов SQL Server аварийное восстановление.
  
## <a name="use-topology-builder-to-configure-high-availability-and-disaster-recovery"></a>Использование построителя топологий для настройки высокой доступности и аварийного восстановления

В построителе топологий выполните указанные ниже действия, чтобы настроить высокую доступность и аварийное восстановление для сервера сохраняемого чата.
  
1. Добавьте зеркальные базы данных и журнала доставки дополнительной базы данных хранилища SQL Server.
    
2. Измените свойства службы сервера сохраняемого чата в:
    
    а. Включите зеркальное отображение для базы данных-источника.
    
    б. Добавьте основное зеркальное хранилище SQL Server.
    
    в. Настройка базы данных доставки журналов SQL Server.
    
    г. Добавление хранилища доставки журналов SQL Server дополнительного сервера SQL Server.
    
    e. Добавьте зеркало хранилища SQL Server для базы данных-получателя.
    
    f. Опубликуйте топологию.
    
## <a name="set-up-sql-server-log-shipping-for-the-persistent-chat-server-primary-database"></a>Настройка доставки журналов SQL Server для основной базы данных сервера сохраняемого чата

С помощью SQL Server Management Studio, подключиться к сервера сохраняемого чата экземпляру доставки журналов базы данных и убедитесь, что запущен агент SQL Server. Затем подключитесь к экземпляру основной базы данных Persistent Chat и выполните следующие действия:
  
1. Щелкните базу данных mgc правой кнопкой мыши и выберите **Свойства**.
    
2. В области **Выбор страницы** выберите **Доставка журналов транзакций**.
    
3. Установите флажок **Включить эту базу данных в качестве источника в конфигурацию доставки журналов**.
    
4. В области **Резервные копии журналов транзакций** щелкните элемент **Параметры копирования**.
    
5. В поле **Сетевой путь к каталогу резервной копии** введите сетевой путь к общей папке, созданной для резервных копий журналов транзакций.
    
6. Если папка резервного копирования располагается на основном сервере, введите локальный путь к папке резервного копирования в поле **Если папка резервного копирования находится на сервере-источнике, укажите локальный путь к папке (пример: c:\backup)**. (Если папка резервного копирования находится не на основном сервере, это поле можно оставить пустым.)
    
    > [!IMPORTANT]
    > Если учетная запись службы SQL Server на сервере-источнике выполняется от имени учетной записи локальной системы, необходимо создать папку резервного копирования на сервере-источнике и указать локальный путь к этой папке. 
  
7. Настройте параметры **Удалить файлы, созданные ранее** и **Предупредить, если резервное копирование не произошло в течение**.
    
8. Просмотрите расписание резервного копирования, приведенное в поле **Расписание** в разделе **Задание резервного копирования**. Чтобы настроить расписание для установки, нажмите кнопку **расписание**и настройте расписание агента SQL Server при необходимости.
    
9. В разделе **Сжатие** выберите флажок **Использовать параметр сервера по умолчанию** и нажмите кнопку **ОК**.
    
10. В области **Экземпляры сервера-получателя и базы данных** нажмите кнопку **Добавить**.
    
11. Нажмите кнопку **Подключить** и подключитесь к экземпляру SQL Server, которая была выбрана в качестве сервера-получателя.
    
12. В поле **База данных-получатель** выберите в списке базу данных **mgc**.
    
13. На вкладке **Инициализация базы данных-получателя** выберите вариант **Да**, создайте полную резервную копию базы данных-источника и выполните восстановление из нее в базу данных-получатель (и создайте базу данных-получатель, если она не существует).
    
14. На вкладке **Копирование файлов** в поле **Папка назначения для копирования файлов** введите путь к папке, в которую необходимо копировать резервные копии журналов транзакций. Эта папка часто находится на дополнительном сервере.
    
15. Обратите внимание на расписание копирования, приведенное в поле **Расписание** в разделе **Задание копирования**. Чтобы настроить расписание для установки, нажмите кнопку **расписание**и настройте расписание агента SQL Server при необходимости. Это расписание должно приблизительно совпадать с расписанием резервного копирования.
    
16. На вкладке **Восстановление** в разделе **Папка назначения для копирования файлов** выберите вариант **Режим без восстановления**.
    
17. В списке **Отложить восстановление резервных копий по крайней мере на** выберите значение **0 минут**.
    
18. В поле **Предупреждение, если восстановление не выполнено в течение** выберите порог оповещений.
    
19. Просмотрите расписание восстановления в поле **Расписание** в разделе **Задание восстановления**. Чтобы настроить расписание для установки, нажмите кнопку **расписание**, измените его агента SQL Server при необходимости и нажмите **кнопку ОК**. Это расписание должно приблизительно совпадать с расписанием резервного копирования.
    
20. В диалоговом окне **Свойства базы данных** нажмите кнопку **ОК**, чтобы приступить к настройке.
    
## <a name="set-up-sql-server-log-shipping-between-the-primary-mirror-and-the-secondary-database"></a>Настройка доставки журналов SQL Server между основным зеркалом и дополнительной базой данных

Выполните следующие действия для доставки журналов для продолжения, если основной базы данных Persistent Chat отработка отказа для ее зеркальную базу данных.
  
1. Ручное переключение Persistent Chat базы данных-источника с зеркальным сервером. Это делается с помощью Скайп для консоли Business Server и командлет **Invoke-CsDatabaseFailover** .
    
2. С помощью SQL Server Management Studio, подключитесь к основной экземпляр зеркального сервера сохраняемого чата.
    
3. Убедитесь, что запущен агент SQL Server.
    
4. Щелкните базу данных mgc правой кнопкой мыши и выберите **Свойства**.
    
5. В области **Выбор страницы** выберите **Доставка журналов транзакций**.
    
6. Установите флажок **Включить эту базу данных в качестве источника в конфигурацию доставки журналов**.
    
7. В области **Резервные копии журналов транзакций** щелкните элемент **Параметры копирования**.
    
8. В поле **Сетевой путь к каталогу резервной копии** введите сетевой путь к общей папке, созданной для резервной копии журнала транзакций.
    
9. Если резервная папка находится на основном сервере, введите локальный путь к этой резервной папке в поле **Если папка резервного копирования находится на сервере-источнике, укажите локальный путь к папке**. (Если резервная папка находится не на основном сервере, вы можете оставить это поле пустым.)
    
    > [!IMPORTANT]
    > Если учетная запись службы SQL Server на сервере-источнике выполняется от имени учетной записи локальной системы, необходимо создать папку резервного копирования на сервере-источнике и указать локальный путь к этой папке. 
  
10. Настройте параметры **Удалить файлы, созданные ранее** и **Предупредить, если резервное копирование не произошло в течение**.
    
11. Просмотрите расписание резервного копирования, приведенное в поле **Расписание** в разделе **Задание резервного копирования**. Чтобы настроить расписание для установки, нажмите кнопку **расписание**и измените его агента SQL Server при необходимости.
    
    > [!IMPORTANT]
    > Используйте те же параметры, которые применялись для основной базы данных. 
  
12. В области **Сжатие** выберите **Использовать параметр сервера по умолчанию** и нажмите кнопку **ОК**.
    
13. В области **Экземпляры сервера-получателя и базы данных** нажмите кнопку **Добавить**.
    
14. Щелкните элемент **Подключение** и подключитесь к экземпляру SQL Server, настроенному вами в качестве сервера-получателя.
    
15. В поле **База данных-получатель** выберите в списке базу данных **mgc**.
    
16. На вкладке **Инициализация базы данных-получателя** выберите вариант **Нет, база данных-получатель инициализирована**.
    
17. В поле **Папка назначения для копирования** на вкладке **Копирование файлов** введите путь к папке, в которую следует копировать резервные копии журналов транзакций, и нажмите кнопку **ОК**. Часто эта папка расположена на сервере-получателе.
    
18. Откройте раскрывающийся список **Скрипт конфигурации** и выберите **Вывести конфигурацию в новое окно запроса**.
    
19. В разделе **Свойства базы данных** окна нового запроса нажмите кнопку **ОК**, чтобы начать процесс настройки.
    
20. Выберите и запустите первая часть запроса (см. шаг 18) вверх на строку:-- \* \* \* \* \* \* конец: сценарий для запуска на источнике: \* \* \* \* \* \*.
    
    > [!IMPORTANT]
    > Ручное выполнение этого скрипта является обязательным, поскольку SQL Server Management Studio не поддерживает несколько основных баз данных в конфигурации доставки журналов SQL Server. 
  
21. Выберите **Отмена**, чтобы закрыть панель конфигурации доставки журналов и создать рабочую программу установки, которая правильно внедряет доставку файлов журналов как для основной, так и для зеркальной базы данных (в случае отработки отказа). 
    
22. Сохраняемый чат базы данных-источника на основную сбоя вручную. Это делается с помощью Скайп для консоли Business Server и командлет **Invoke-CsDatabaseFailover** .
    

