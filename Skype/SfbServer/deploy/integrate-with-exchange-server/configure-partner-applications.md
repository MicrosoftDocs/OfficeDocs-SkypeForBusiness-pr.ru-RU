---
title: Настройка партнерских приложений в Skype для бизнеса Server 2015 и Exchange Server
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 12/20/2018
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 9c3a3054-6201-433f-b128-4c49d3341370
description: 'Сводка: Настройка проверки подлинности сервера для Exchange Server 2016 или Exchange Server 2013 и Skype для бизнеса Server.'
ms.openlocfilehash: 004b9c1926f00cd869658ae0b90679897d20516b
ms.sourcegitcommit: fe274303510d07a90b506bfa050c669accef0476
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/09/2020
ms.locfileid: "41001259"
---
# <a name="configure-partner-applications-in-skype-for-business-server-and-exchange-server"></a><span data-ttu-id="9ad7a-103">Настройка партнерских приложений в Skype для бизнеса Server и Exchange Server</span><span class="sxs-lookup"><span data-stu-id="9ad7a-103">Configure partner applications in Skype for Business Server and Exchange Server</span></span>
 
<span data-ttu-id="9ad7a-104">**Сводка:** Настройка проверки подлинности сервера для Exchange Server 2016 или Exchange Server 2013 и Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-104">**Summary:** Configure server to server authentication for Exchange Server 2016 or Exchange Server 2013 and Skype for Business Server.</span></span>
  
<span data-ttu-id="9ad7a-105">Для проверки подлинности "сервер-сервер" обычно требуется два сервера, которые должны обмениваться данными, и сторонний сервер маркеров безопасности.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-105">Server-to-server authentication usually requires two servers that need to communicate with one another and a third-party security token server.</span></span> <span data-ttu-id="9ad7a-106">Если сервер A и сервер B нуждаются в общении, то оба эти сервера обычно начинают с того, что они поставляются с сервером-маркером и получают взаимно доверенные маркеры безопасности.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-106">If Server A and Server B need to communicate, then both of those servers typically start by contacting a token server and obtaining a mutually-trusted security token.</span></span> <span data-ttu-id="9ad7a-107">Затем сервер A отправляет этот маркер безопасности серверу B (и наоборот) в качестве гарантии своей подлинности и надежности.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-107">Server A then presents that security token to Server B (and vice-versa) as a way to guarantee its authenticity and trustworthiness.</span></span>
  
<span data-ttu-id="9ad7a-108">Однако это общее правило.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-108">However, that's a general rule.</span></span> <span data-ttu-id="9ad7a-109">Skype для бизнеса Server, Exchange Server 2016, Exchange Server 2013 и SharePoint Server 2013 не требуется использовать сторонний сервер маркеров при взаимодействии друг с другом. Это может быть вызвано тем, что эти серверные продукты могут создавать маркеры безопасности, которые могут принимать друг друга, без необходимости использования отдельного сервера маркеров.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-109">Skype for Business Server, Exchange Server 2016, Exchange Server 2013, and SharePoint Server 2013 do not need to use a third-party token server when communicating with one another; that's because these server products can create security tokens that can be accepted by one another without the need for a separate token server.</span></span> <span data-ttu-id="9ad7a-110">(Эта возможность доступна только в Skype для бизнеса Server, Exchange Server 2016, Exchange Server 2013 и SharePoint Server 2013.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-110">(This capability is only available in Skype for Business Server, Exchange Server 2016, Exchange Server 2013, and SharePoint Server 2013.</span></span> <span data-ttu-id="9ad7a-111">Для настройки проверки подлинности "сервер-сервер" с другими серверами, включая серверные продукты Microsoft, потребуется использование стороннего сервера маркеров.)</span><span class="sxs-lookup"><span data-stu-id="9ad7a-111">If you need to set up server-to-server authentication with other servers, including other Microsoft server products, then you will need to do so by using a third-party token server.)</span></span>
  
<span data-ttu-id="9ad7a-112">Чтобы настроить серверную проверку подлинности между Skype для бизнеса Server и Exchange Server, необходимо выполнить два действия: 1) необходимо назначить соответствующие сертификаты каждому серверу. и 2) необходимо настроить каждый сервер так, чтобы он был партнерским приложением другого сервера: это означает, что необходимо настроить Skype для бизнеса Server для использования партнера в Exchange Server, а также настроить сервер Exchange для использования в качестве партнерского приложения Skype. для Business Server.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-112">In order to set up server-to-server authentication between Skype for Business Server and Exchange Server you must do two things: 1) you must assign the appropriate certificates to each server; and, 2) you must configure each server to be a partner application of the other server: that means you must configure Skype for Business Server to be a partner application for Exchange Server, and you must configure Exchange Server to be a partner application for Skype for Business Server.</span></span>
  
## <a name="configuring-skype-for-business-server-to-be-a-partner-application-for-exchange-server"></a><span data-ttu-id="9ad7a-113">Настройка Skype для бизнеса Server для работы в качестве партнерских приложений для Exchange Server</span><span class="sxs-lookup"><span data-stu-id="9ad7a-113">Configuring Skype for Business Server to be a Partner Application for Exchange Server</span></span>

<span data-ttu-id="9ad7a-114">Самый простой способ настроить Skype для бизнеса Server — это партнерское приложение с Exchange Server 2016 или Exchange Server 2013 — запуск сценария Конфигуре-ентерприсепартнераппликатион. ps1 — сценария Windows PowerShell, который поставляется вместе с Exchange Server.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-114">The easiest way to configure Skype for Business Server to be a partner application with Exchange Server 2016 or Exchange Server 2013 is to run the Configure-EnterprisePartnerApplication.ps1 script, a Windows PowerShell script that ships with Exchange Server.</span></span> <span data-ttu-id="9ad7a-115">Чтобы выполнить этот сценарий, необходимо указать URL-адрес для документа метаданных проверки подлинности в Skype для бизнеса Server. как правило, это полное доменное имя пула сервера Skype для бизнеса, за которым следует суффикс/Metadata/JSON/1.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-115">To run this script, you must provide the URL for the Skype for Business Server authentication metadata document; this will typically be the fully qualified domain name of the Skype for Business Server pool followed by the suffix /metadata/json/1.</span></span> <span data-ttu-id="9ad7a-116">Например:</span><span class="sxs-lookup"><span data-stu-id="9ad7a-116">For example:</span></span>
  
```console
https://atl-cs-001.litwareinc.com/metadata/json/1
```

<span data-ttu-id="9ad7a-117">Чтобы настроить сервер Skype для бизнеса в качестве партнерского приложения, откройте командную консоль Exchange и выполните следующую команду (предполагая, что Exchange установлен на диске C: и используется путь к папке по умолчанию):</span><span class="sxs-lookup"><span data-stu-id="9ad7a-117">To configure Skype for Business Server as a partner application, open the Exchange Management Shell and run a command similar to this (assuming that Exchange has been installed on drive C: and that it uses the default folder path):</span></span>
  
```powershell
"C:\Program Files\Microsoft\Exchange Server\V15\Scripts\Configure-EnterprisePartnerApplication.ps1 -AuthMetaDataUrl 'https://atl-cs-001.litwareinc.com/metadata/json/1' -ApplicationType Lync"
```

<span data-ttu-id="9ad7a-118">После настройки приложения-партнера рекомендуется остановить и перезапустить службы IIS в почтовом ящике Exchange и на серверах клиентского доступа.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-118">After configuring the partner application it is recommended that you stop and restart Internet Information Services (IIS) on your Exchange mailbox and client access servers.</span></span> <span data-ttu-id="9ad7a-119">Ниже приведен пример команды перезапуска служб IIS, относящийся к компьютеру atl-exchange-001.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-119">You can restart IIS by using a command similar to this, which restarts the service on the computer atl-exchange-001:</span></span>
  
```powershell
iisreset atl-exchange-001
```

<span data-ttu-id="9ad7a-120">Эту команду можно выполнить в командной консоли Exchange или в любом другом окне команд, которое запускается с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-120">This command can be run from within the Exchange Management Shell or from any other command window run under administrator privileges.</span></span>
  
## <a name="configuring-exchange-server-to-be-a-partner-application-for-skype-for-business-server"></a><span data-ttu-id="9ad7a-121">Настройка сервера Exchange Server в качестве партнерской программы для Skype для бизнеса Server</span><span class="sxs-lookup"><span data-stu-id="9ad7a-121">Configuring Exchange Server to be a Partner Application for Skype for Business Server</span></span>

<span data-ttu-id="9ad7a-122">После того как вы настроили Skype для Business Server как приложение-партнер для Exchange Server 2016 или Exchange Server 2013, необходимо настроить сервер Exchange Server для работы в качестве партнерского приложения для Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-122">After you have configured Skype for Business Server to be a partner application for Exchange Server 2016 or Exchange Server 2013, you must then configure Exchange Server to be a partner application for Skype for Business Server.</span></span> <span data-ttu-id="9ad7a-123">Это можно сделать с помощью командной консоли Skype для бизнеса Server и указав документ метаданных проверки подлинности для Exchange; как правило, это URI службы автообнаружения Exchange, за которой следует суффикс/Metadata/JSON/1.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-123">This can be done by using the Skype for Business Server Management Shell and specifying the authentication metadata document for Exchange; this will typically be the URI of the Exchange autodiscover service followed by the suffix /metadata/json/1.</span></span> <span data-ttu-id="9ad7a-124">Например:</span><span class="sxs-lookup"><span data-stu-id="9ad7a-124">For example:</span></span>
  
```console
https://autodiscover.litwareinc.com/autodiscover/metadata/json/1
```

<span data-ttu-id="9ad7a-125">В Skype для бизнеса Server партнерские приложения настраиваются с помощью командлета [New-кспартнераппликатион](https://docs.microsoft.com/powershell/module/skype/new-cspartnerapplication?view=skype-ps) .</span><span class="sxs-lookup"><span data-stu-id="9ad7a-125">In Skype for Business Server, partner applications are configured by using the [New-CsPartnerApplication](https://docs.microsoft.com/powershell/module/skype/new-cspartnerapplication?view=skype-ps) cmdlet.</span></span> <span data-ttu-id="9ad7a-126">В дополнение к указанию URI метаданных необходимо также установить полный уровень доверия для приложения; Это позволит Exchange самостоятельно представлять себе и всех авторизованных пользователей в сфере.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-126">In addition to specifying the metadata URI you should also set the application trust level to Full; this will allow Exchange to represent both itself and any authorized user in the realm.</span></span> <span data-ttu-id="9ad7a-127">Например:</span><span class="sxs-lookup"><span data-stu-id="9ad7a-127">For example:</span></span>
  
```powershell
New-CsPartnerApplication -Identity Exchange -ApplicationTrustLevel Full -MetadataUrl "https://autodiscover.litwareinc.com/autodiscover/metadata/json/1"
```

<span data-ttu-id="9ad7a-128">Кроме того, вы можете создать партнерское приложение, скопировав и изменив код сценария, который находится в документации для проверки подлинности сервера в Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-128">Alternatively, you can create a partner application by copying and modifying the script code found in the Skype for Business Server server-to-server authentication documentation.</span></span> <span data-ttu-id="9ad7a-129">Дополнительные сведения можно найти в статье [Управление проверкой подлинности серверов (OAuth) и партнерских программ в Skype для бизнеса Server](../../manage/authentication/server-to-server-and-partner-applications.md) .</span><span class="sxs-lookup"><span data-stu-id="9ad7a-129">See the [Manage server-to-server authentication (OAuth) and partner applications in Skype for Business Server](../../manage/authentication/server-to-server-and-partner-applications.md) article for more information.</span></span>
  
<span data-ttu-id="9ad7a-130">Если вы успешно настроили партнерские приложения для Skype для бизнеса Server и Exchange Server, вы также успешно настроили проверку подлинности серверов и сервера между двумя продуктами.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-130">If you have successfully configured partner applications for both Skype for Business Server and Exchange Server, you have also successfully configured server-to-server authentication between the two products.</span></span> <span data-ttu-id="9ad7a-131">В Skype для бизнеса Server есть командлет Windows PowerShell [Test-ксекссторажеконнективити](https://docs.microsoft.com/powershell/module/skype/test-csexstorageconnectivity?view=skype-ps) , который позволяет проверить правильность настройки проверки подлинности серверов и служб хранилища в Skype для бизнеса Server, чтобы подключиться к Exchange Server.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-131">Skype for Business Server includes a Windows PowerShell cmdlet, [Test-CsExStorageConnectivity](https://docs.microsoft.com/powershell/module/skype/test-csexstorageconnectivity?view=skype-ps) which enables you to verify that server-to-server authentication has been correctly configured and that the Skype for Business Server Storage Service can connect to Exchange Server.</span></span> <span data-ttu-id="9ad7a-132">Командлет делает это, подключаясь к почтовому ящику пользователя Exchange Server, записывая элемент в папку журнала бесед для этого пользователя, а затем (необязательно) его удаление.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-132">The cmdlet does this by connecting to the mailbox of an Exchange Server user, writing an item into the Conversation History folder for that user, and then (optionally) deleting that item.</span></span>
  
<span data-ttu-id="9ad7a-133">Чтобы протестировать интеграцию Skype для бизнеса Server и Exchange Server, выполните в командной консоли Skype для Business Server команду, подобную следующей:</span><span class="sxs-lookup"><span data-stu-id="9ad7a-133">To test the integration of Skype for Business Server and Exchange Server, run a command similar to the following from the Skype for Business Server Management Shell:</span></span>
  
```powershell
Test-CsExStorageConnectivity -SipUri "sip:kenmyer@litwareinc.com"
```

<span data-ttu-id="9ad7a-134">В предыдущей команде Сипури — адрес SIP пользователя с учетной записью на сервере Exchange Server; не удается выполнить команду, так как она не является действительной учетной записью пользователя.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-134">In the preceding command, the SipUri represents the SIP address of a user with an account on Exchange Server; your command will fail in this is not a valid user account.</span></span>
  
> [!NOTE]
> <span data-ttu-id="9ad7a-135">Если вы получили ответ 401 от этого командлета, скорее всего, это связано с тем, что в конфигурации Exchange по умолчанию не указана поддержка приема маркеров OAuth.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-135">If you receive a 401 response from this cmdlet, it is probably because the default configuration for Exchange does not include support for accepting Oauth tokens.</span></span> <span data-ttu-id="9ad7a-136">Дополнительные сведения об использовании OAuth в Exchange можно найти в разделе [Настройка проверки подлинности OAuth с помощью SharePoint 2013 и Skype для бизнеса Server](https://go.microsoft.com/fwlink/p/?LinkId=513103).</span><span class="sxs-lookup"><span data-stu-id="9ad7a-136">For more information about using Oauth in Exchange, see [Configure OAuth authentication with SharePoint 2013 and Skype for Business Server](https://go.microsoft.com/fwlink/p/?LinkId=513103).</span></span> 
  
<span data-ttu-id="9ad7a-137">Если проверка завершилась успешно и соединение было установлено, можно перейти к настройке дополнительных компонентов, таких как интеграция службы архивации и единое хранилище контактов.</span><span class="sxs-lookup"><span data-stu-id="9ad7a-137">If the test succeeds and connectivity has been established, you can then proceed to configure optional features such as archiving integration and the unified contact store.</span></span>
