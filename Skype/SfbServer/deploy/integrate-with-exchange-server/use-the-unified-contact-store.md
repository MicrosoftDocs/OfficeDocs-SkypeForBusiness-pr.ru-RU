---
title: Настройка Skype для бизнеса Server для использования единого магазина контактов
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 6aa17ae3-764e-4986-a900-85a3cdb8c1fc
description: Сводка. Настройте единое хранилище контактов для Exchange Server и Skype для бизнеса Server.
ms.openlocfilehash: 4b96a0c4f3294146c987794ffce083c46d94bb48
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49833869"
---
# <a name="configure-skype-for-business-server-to-use-the-unified-contact-store"></a>Настройка Skype для бизнеса Server для использования единого магазина контактов
 
**Сводка:** Настройте единое хранилище контактов для Exchange Server 2016 или Exchange Server 2013 и Skype для бизнеса Server.
  
Используя единое хранилище контактов, пользователи сохраняют один список контактов, а затем могут использовать их в нескольких приложениях, включая Skype для бизнеса, Microsoft Outlook 2013 и Microsoft Outlook Web App 2013. Когда вы включаете единое хранилище контактов для пользователя, контакты этого пользователя не сохраняются в Skype для бизнеса Server и не извлекаются при необходимости. Вместо этого его контакты хранятся в Exchange Server 2016 или Exchange Server 2013 и извлекаются с помощью веб-служб Exchange.
  
> [!NOTE]
> Технически контактные данные хранятся в двух папках в почтовом ящике Exchange пользователя. Сами контакты хранятся в папке "Контакты Skype для бизнеса", которая видна конечным пользователям; метаданные о контактах хранятся во вузах, которая не видна конечным пользователям. 
  
## <a name="enabling-the-unified-contact-store-for-a-user"></a>Включение единого хранилища контактов для пользователей

Если проверка подлинности "сервер-сервер" между Skype для бизнеса Server и Exchange Server уже настроена, то также включено единое хранилище контактов; Дополнительная настройка сервера не требуется. Однако для перемещения контактов пользователя в единое хранилище контактов требуется дополнительная настройка учетной записи пользователя. По умолчанию контакты пользователей хранятся в Skype для бизнеса Server, а не в едином хранилище контактов.
  
Доступ к единому оклу контактов управляется с помощью политик обслуживания пользователей Skype для бизнеса Server. У политик служб пользователей всего одно свойство (UcsAllowed), которое используется для определения расположения хранения контактов пользователя. Если пользователь управляется политикой служб пользователей, в которой для UcsAllowed установлено имя True ($True), контакты пользователя будут храниться в едином хранилище контактов. Если пользователь управляется политикой служб пользователей, в которой для UcsAllowed установлено имя False ($False), его контакты будут храниться в Skype для бизнеса Server.
  
При установке Skype для бизнеса Server также устанавливается одна политика обслуживания пользователей (настроенная на глобальном уровне). Значение UcsAllowed в этой политике имеет значение True, то есть по умолчанию контакты пользователей будут храниться в едином хранилище контактов (при условии, что он развернут и настроен). Если вы хотите перенести все контакты пользователей в единое хранилище контактов, вам не нужно ничего делать. 
  
Если вы не хотите перенести все контакты в единое хранилище контактов, вы можете отключить единое хранилище контактов для всех пользователей, установив для свойства UcsAllowed глобальной политики параметр False:
  
```powershell
Set-CsUserServicesPolicy -Identity global -UcsAllowed $False
```

После отключения единого хранения контактов в глобальной политике можно создать политику на уровне пользователей, которая позволяет использовать единое хранилище контактов; Это позволяет сделать так, чтобы некоторые пользователи хранили свои контакты в едином хранилище контактов, в то время как другие пользователи продолжают хранить свои контакты в Skype для бизнеса Server. Вы можете создать политику служб на пользователя с помощью команды, похожей на данной:
  
```powershell
New-CsUserServicesPolicy -Identity "AllowUnifiedContactStore" -UcsAllowed $True
```

После создания политики ее необходимо назначить всем пользователям, которым требуется доступ к единому хранилищу контактов. Политики на уровне пользователей можно назначить пользователям с помощью следующей команды:
  
```powershell
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "AllowUnifiedContactStore"
```

После того как политика будет назначена, Skype для бизнеса Server начнет перенос контактов пользователя в единое хранилище контактов. После завершения миграции контакты пользователя будут храниться в Exchange, а не в Skype для бизнеса Server. Если во время миграции пользователь вошел в Lync 2013, появится окно сообщения, после чего ему будет предложено выйти из Skype для бизнеса, а затем снова войти в систему, чтобы завершить процесс. Контакты пользователей, которым не назначена эта политика на пользователя, не будут перенесены в единое хранилище контактов. Это потому, что эти пользователи управляются глобальной политикой, и использование единого магазина контактов было отключено в глобальной политике.
  
Чтобы убедиться, что контакты пользователя успешно перенесены в единое хранилище контактов, с помощью команды [Test-CsUnifiedContactStore](https://docs.microsoft.com/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) в оболочке управления Skype для бизнеса Server:
  
```powershell
Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"
```

Если Test-CsUnifiedContactStore успешно, это означает, что контакты пользователя sip:kenmyer@ litwareinc .com были перенесены в единое хранилище <span></span> <span></span> контактов.
  
## <a name="rolling-back-the-unified-contact-store"></a>Откат в единое хранилище контактов

Если вам нужно удалить контакты пользователя из единого хранения контактов (например, если пользователь должен быть перенаучен в Microsoft Lync Server 2010 и поэтому больше не может использовать единое хранилище контактов), необходимо сделать два действия. Во-первых, назначьте пользователю новую политику служб пользователей, которая запрещает хранение контактов в едином хранилище контактов. (То есть политика, в которой свойству UcsAllowed было заировано $False.) Если у вас нет такой политики, ее можно создать с помощью команды, похожей на данной:
  
```powershell
New-CsUserServicesPolicy -Identity NoUnifiedContactStore -UcsAllowed $False
```

Затем вы можете назначить эту политику на уровней пользователей (NoUnifiedContactStore) с помощью следующей команды:
  
```powershell
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName NoUnifiedContactStore
```

Предыдущая команда назначает новую политику пользователю Ken Myer и не позволяет переносить его контакты в единое хранилище контактов.
  
> [!NOTE]
> В некоторых случаях можно добиться такого же сетевого эффекта, просто отозначив текущую политику служб пользователя. Например, предположим, что для Ken Myer есть политика на уровне пользователя, включающая единое хранилище контактов, но ваша глобальная политика запрещает использование хранилища. В этом случае можно отозначить политику "Ken's per-user services". В этом случае этот пользователь будет контролироваться глобальной политикой и у него не будет доступа к единому хранилищу контактов. Чтобы отозначить ранее назначенную политику на уровне пользователя, используйте ту же команду, что и ранее, но на этот раз установите для параметра PolicyName значение null: Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName $Null 
  
Следует помнить о концепции "не позволяет перенести контакты пользователя Ken Myer в единое хранилище контактов" при работе с единым хранилищем контактов. Если просто назначить для Ken Myer новую политику служб пользователя, его контакты не будут перенесены из единого хранилища контактов. Когда пользователь входит в Skype для бизнеса Server, система проверяет политику служб пользователя, чтобы узнать, следует ли хранить его контакты в едином хранилище контактов. Если ответ — да, (т. е. для свойства UcsAllowed задано значение $True), эти контакты будут перенесены в единое хранилище контактов (если они еще не в нем). Если ответ — нет, Skype для бизнеса Server просто игнорирует контакты пользователя и переходит к следующей задаче. Это означает, что Skype для бизнеса Server не будет автоматически перемещать контакты пользователя из единого хранения контактов независимо от значения свойства UcsAllowed.
  
Это также означает, что после назначения пользователю новой политики служб пользователей необходимо выполнить cmdlet [Invoke-CsUcsRollback,](https://docs.microsoft.com/powershell/module/skype/invoke-csucsrollback?view=skype-ps) чтобы переместить контакты пользователя из Exchange Server и вернуться в Skype для бизнеса Server. Например, после назначения Ken Myer новой политики служб пользователя можно перенести его контакты из единого хранилища контактов с помощью следующей команды:
  
```powershell
Invoke-CsUcsRollback -Identity "Ken Myer"
```

Если изменить политику служб пользователей, но не выполнять командлет Invoke-CsUcsRollback, контакты Ken Myer не будут удалены из единого хранилища контактов. Что будет, если выполнить Invoke-CsUcsRollback, но не менять политику служб пользователей Ken Myer? Тогда его контакты будут временно удалены из единого хранилища контактов. Важно помнить о том, что удаление временное. После удаления контактов пользователя Ken из единого магазина контактов Skype для бизнеса Server подождите 7 дней, а затем проверит, какая политика служб пользователя назначена пользователю Ken. Если все еще назначена политика, позволяющая применять единое хранилище контактов, его контакты автоматически перемещаются в хранилище контактов. Чтобы удалить контакты из хранилища контактов без возможности восстановления, в дополнение к запуску командлета Invoke-CsUcsRollback следует изменить политику служб пользователя.
  
Из-за большого количества переменных, которые могут повлиять на миграцию, трудно оценить, сколько времени займет перенос учетных записей в единое хранилище контактов. Как правило, миграция не сразу вступает в силу: даже при переносе небольшого количества контактов до завершения перемещения может потребоваться 10 минут или больше.
  

