---
title: Настройка Skype для бизнеса Server для работы с единым хранилищем контактов
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: get-started-article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 6aa17ae3-764e-4986-a900-85a3cdb8c1fc
description: Аннотация. Настройте единое хранилище контактов для Exchange Server и Skype для Business Server.
ms.openlocfilehash: fd70c4b0b3d94ba26b76847ff053bf33d5902799
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2019
ms.locfileid: "34278044"
---
# <a name="configure-skype-for-business-server-to-use-the-unified-contact-store"></a>Настройка Skype для бизнеса Server для работы с единым хранилищем контактов
 
**Сводка:** Настройте единое хранилище контактов для Exchange Server 2016 или Exchange Server 2013 и Skype для Business Server.
  
Используя единое хранилище контактов, пользователи сохраняют один список контактов, а затем имеют доступ к этим контактам в нескольких приложениях, включая Skype для бизнеса, Microsoft Outlook 2013 и Microsoft Outlook Web App 2013. Когда вы включаете единое хранилище контактов для пользователя, контакты этого пользователя не сохраняются в Skype для бизнеса Server и извлекаются по мере необходимости. Вместо этого его контакты хранятся в Exchange Server 2016 или Exchange Server 2013 и извлекаются с помощью веб-служб Exchange.
  
> [!NOTE]
> Технически контактные данные хранятся в паре папок, которые находятся в почтовом ящике Exchange пользователя. Сами контакты хранятся в папке "Контакты" в Skype для бизнеса, которая отображается для конечных пользователей. метаданные о контактах хранятся во вложенной папке, невидимой для конечных пользователей. 
  
## <a name="enabling-the-unified-contact-store-for-a-user"></a>Включение единого хранилища контактов для пользователей

Если проверка подлинности "сервер-сервер" между Skype для бизнеса Server и Exchange Server уже настроена, вы также включили единое хранилище контактов; Дополнительная настройка сервера не требуется. Но для перемещения контактов пользователя в единое хранилище контактов необходима дополнительная настройка учетной записи пользователя, чтобы переместить контакты пользователя в единое хранилище. По умолчанию контакты пользователей хранятся в Skype для бизнеса Server, а не в едином банке контактов.
  
Управление доступом к единому хранилищу контактов осуществляется с помощью политик служб пользователей Skype для бизнеса Server. Политики серверов пользователей содержат только одно свойство (UcsAllowed): оно определяет место хранения контактов пользователя. Если пользователь управляется политикой пользовательских служб, в которой для Уксалловед установлено значение true ($True), контакты пользователя будут храниться в едином банке контактов. Если пользователь управляется политикой пользовательских служб, в которой для Уксалловед задано значение false ($False), его контакты будут храниться в Skype для бизнеса Server.
  
При установке Skype для бизнеса Server также устанавливаются политики одной из пользовательских служб (настроенную в глобальной области). Для значения Уксалловед в этой политике задано значение "true", то есть контакты пользователей по умолчанию будут храниться в едином хранилище контактов (предполагая, что оно развернуто и настроено). Если вы хотите перенести всех пользователей из списка контактов в единое хранилище контактов, вам не нужно ничего делать. 
  
Если для вас предпочтительнее не переносить все ваши контакты в единое хранилище контактов, можно заблокировать единое хранилище контактов для всех пользователей, присвоив свойству UcsAllowed в глобальной политике значение False:
  
```
Set-CsUserServicesPolicy -Identity global -UcsAllowed $False
```

После того как вы отключите единое хранилище контактов в глобальной политике, вы можете создать политику для пользователей, которая позволит использовать единое хранилище контактов; Это позволит некоторым пользователям хранить свои контакты в едином банке контактов, когда другие пользователи продолжают хранить свои контакты в Skype для бизнеса Server. Ниже приведен пример команды, позволяющей создать политику служб пользователей для отдельных пользователей:
  
```
New-CsUserServicesPolicy -Identity "AllowUnifiedContactStore" -UcsAllowed $True
```

После создания политики ее необходимо назначить всем пользователям, которым требуется доступ к единому хранилищу контактов. Политики на уровне пользователей можно назначить пользователям с помощью следующей команды:
  
```
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "AllowUnifiedContactStore"
```

После назначения политики Skype для бизнеса Server начнет переносить контакты пользователя в единое хранилище контактов. После завершения миграции пользователь сможет хранить свои контакты в Exchange, а не в Skype для бизнеса Server. Если пользователь будет входить в Lync 2013 после завершения миграции, появится диалоговое окно с сообщением и ему будет предложено выйти из Skype для бизнеса, а затем снова войти в систему, чтобы завершить процесс. Контакты пользователей, которым не назначена эта политика для отдельных пользователей, не переносятся в единое хранилище контактов. Это связано с тем, что пользователи управляются глобальной политикой, и использование единого хранилища контактов было отключено в глобальной политике.
  
Вы можете убедиться, что контакты пользователя успешно перенесены в единое хранилище контактов, запустив командлет [Test-ксунифиедконтактсторе](https://docs.microsoft.com/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) в командной консоли управления Skype для бизнеса Server.
  
```
Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"
```

Если Test-Ксунифиедконтактсторе успешно, это означает, что контакты для пользователя SIP: кенмер @<span></span>плана litwareinc<span></span>. com были перенесены в единое хранилище контактов.
  
## <a name="rolling-back-the-unified-contact-store"></a>Откат в единое хранилище контактов

Если вы хотите удалить контакты пользователя из хранилища Объединенных контактов (например, если нужно переадресовать пользователя на сервере Microsoft Lync Server 2010 и, следовательно, он больше не может использовать единое хранилище контактов), необходимо выполнить два действия. Сначала следует назначить пользователю новую политику служб пользователей, запрещающую хранение контактов в едином хранилище контактов. (То есть, политика, в которой для свойства Уксалловед задано значение $False.) Если у вас нет такой политики, вы можете создать ее с помощью следующей команды:
  
```
New-CsUserServicesPolicy -Identity NoUnifiedContactStore -UcsAllowed $False
```

Затем вы можете назначить эту политику на уровней пользователей (NoUnifiedContactStore) с помощью следующей команды:
  
```
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName NoUnifiedContactStore
```

Предыдущая команда назначает новую политику пользователю Ken Myer и не позволяет переносить его контакты в единое хранилище контактов.
  
> [!NOTE]
> В некоторых случаях можно получить тот же результат, не назначая текущую политику служб пользователя. Например, предположим, что политика служб пользователя Ken Myer разрешает ему доступ к единому хранилищу контактов, но глобальная политика запрещает доступ к нему. В этом случае можно отменить назначение политики служб пользователя Ken Myer. После этого пользователь Ken автоматически подпадает под действие глобальной политики и лишается доступа к единому хранилищу контактов. Чтобы отменить предварительно назначенную политику для пользователя, используйте ту же команду, которая указана перед этим, но в этот раз для параметра Полицинаме задано значение NULL: Grant-Ксусерсервицесполици-Identity "Кен мер"-Полицинаме $Null 
  
При работе с единым хранилищем контактов следует учитывать правило, согласно которому контакты пользователя не переносятся в единое хранилище контактов. Если просто назначить для пользователя Ken новую политику служб пользователя, его контакты не переносятся из единого хранилища контактов. Когда пользователь входит в Skype для бизнеса Server, система проверяет политику пользовательских служб, чтобы узнать, нужно ли хранить ее контакты в едином хранилище контактов. В случае утвердительного ответа (для свойства UcsAllowed задано значение $True) эти контакты переносятся в единое хранилище контактов (если они еще не находятся в нем). Если вы ответили нет, Skype для бизнеса Server просто проигнорирует контакты пользователя и переходит к следующей задаче. Это означает, что Skype для бизнеса Server не будет автоматически переносить контакты пользователя из единого хранилища контактов независимо от значения свойства Уксалловед.
  
Это также означает, что после назначения пользователю новой политики пользовательских служб необходимо запустить командлет [Invoke-ксуксроллбакк](https://docs.microsoft.com/powershell/module/skype/invoke-csucsrollback?view=skype-ps) , чтобы переместить контакты пользователя из Exchange Server в Skype для бизнеса Server. Например, после назначения пользователю Ken Myer новой политики служб пользователя можно перенести его контакты из единого хранилища контактов с помощью следующей команды:
  
```
Invoke-CsUcsRollback -Identity "Ken Myer"
```

Если изменить политику служб пользователя, но не выполнять командлет Invoke-CsUcsRollback, контакты пользователя Ken не удаляются из единого хранилища контактов. Что происходит, если выполнить Invoke-CsUcsRollback, не изменяя политику служб пользователя Ken Myer? Контакты этого пользователя временно удаляются из единого хранилища контактов. Важно помнить о том, что контакты удаляются временно. После того как контакты Кен были удалены из хранилища контактов, в Skype для бизнеса Server будет подождать 7 дней, а затем проверить, какая политика служб пользователей назначена Кенам. Если пользователю Ken по-прежнему назначена политика, разрешающая ему доступ к единому хранилищу контактов, его контакты автоматически перемещаются в хранилище контактов. Для удаления контактов из хранилища контактов без возможности восстановления необходимо не только выполнить командлет Invoke-CsUcsRollback, но и изменить политику служб пользователя.
  
Из-за большого количества переменных, влияющих на перенос, трудно определить, сколько времени потребуется для полного переноса учетных записей в единое хранилище контактов. В качестве общего правила следует иметь в виду, что перенос не вступает в силу немедленно: даже при переносе небольшого числа контактов для полного завершения переноса может потребоваться около 10 минут.
  

