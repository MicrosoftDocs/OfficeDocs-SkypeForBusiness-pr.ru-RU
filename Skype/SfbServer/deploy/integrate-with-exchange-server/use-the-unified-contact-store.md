---
title: Настройка Skype для бизнеса Server для использования единого магазина контактов
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 6aa17ae3-764e-4986-a900-85a3cdb8c1fc
description: Сводка. Настройте единое хранилище контактов для Exchange Server и Skype для бизнеса Server.
ms.openlocfilehash: 4b96a0c4f3294146c987794ffce083c46d94bb48
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "49833869"
---
# <a name="configure-skype-for-business-server-to-use-the-unified-contact-store"></a><span data-ttu-id="f0bc1-103">Настройка Skype для бизнеса Server для использования единого магазина контактов</span><span class="sxs-lookup"><span data-stu-id="f0bc1-103">Configure Skype for Business Server to use the unified contact store</span></span>
 
<span data-ttu-id="f0bc1-104">**Сводка:** Настройте единое хранилище контактов для Exchange Server 2016 или Exchange Server 2013 и Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-104">**Summary:** Configure the unified contacts store for Exchange Server 2016 or Exchange Server 2013 and Skype for Business Server.</span></span>
  
<span data-ttu-id="f0bc1-105">Используя единое хранилище контактов, пользователи сохраняют один список контактов, а затем могут использовать их в нескольких приложениях, включая Skype для бизнеса, Microsoft Outlook 2013 и Microsoft Outlook Web App 2013.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-105">Using the unified contact store, users maintain a single contacts list and then have those contacts available in multiple applications, including Skype for Business, Microsoft Outlook 2013, and Microsoft Outlook Web App 2013.</span></span> <span data-ttu-id="f0bc1-106">Когда вы включаете единое хранилище контактов для пользователя, контакты этого пользователя не сохраняются в Skype для бизнеса Server и не извлекаются при необходимости.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-106">When you enable the unified contact store for a user, that user's contacts are not stored in Skype for Business Server and retrieved as needed.</span></span> <span data-ttu-id="f0bc1-107">Вместо этого его контакты хранятся в Exchange Server 2016 или Exchange Server 2013 и извлекаются с помощью веб-служб Exchange.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-107">Instead, his or her contacts are stored in Exchange Server 2016 or Exchange Server 2013 and are retrieved by using Exchange Web Services.</span></span>
  
> [!NOTE]
> <span data-ttu-id="f0bc1-108">Технически контактные данные хранятся в паре папок, найденных в почтовом ящике Exchange пользователя.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-108">Technically, contact information is stored in a pair of folders found in the user's Exchange mailbox.</span></span> <span data-ttu-id="f0bc1-109">Сами контакты хранятся в папке "Контакты Skype для бизнеса", которая видна конечным пользователям; метаданные о контактах хранятся во в подкамере, которая не видна конечным пользователям.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-109">The contacts themselves are stored in a folder named Skype for Business Contacts which is visible to end users; metadata about the contacts are stored in a subfolder that is not visible to end users.</span></span> 
  
## <a name="enabling-the-unified-contact-store-for-a-user"></a><span data-ttu-id="f0bc1-110">Включение единого хранилища контактов для пользователей</span><span class="sxs-lookup"><span data-stu-id="f0bc1-110">Enabling the Unified Contact Store for a User</span></span>

<span data-ttu-id="f0bc1-111">Если проверка подлинности "сервер-сервер" между Skype для бизнеса Server и Exchange Server уже настроена, то также включено единое хранилище контактов; Дополнительная настройка сервера не требуется.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-111">If server-to-server authentication between Skype for Business Server and Exchange Server is already configured, then you have also enabled the unified contact store; no additional server configuration is required.</span></span> <span data-ttu-id="f0bc1-112">Однако для перемещения контактов пользователя в единое хранилище контактов требуется дополнительная настройка учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-112">However, additional user account configuration is required in order to move a user's contacts into the unified contact store.</span></span> <span data-ttu-id="f0bc1-113">По умолчанию контакты пользователей хранятся в Skype для бизнеса Server, а не в едином хранилище контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-113">By default, user contacts are kept in Skype for Business Server and not in the unified contact store.</span></span>
  
<span data-ttu-id="f0bc1-114">Доступ к единому оклу контактов управляется с помощью политик обслуживания пользователей Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-114">Access to the unified contact store is managed by using Skype for Business Server user services policies.</span></span> <span data-ttu-id="f0bc1-115">У политик служб пользователей всего одно свойство (UcsAllowed), которое используется для определения расположения хранения контактов пользователя.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-115">User server policies have only a single property (UcsAllowed); this property is used to determine the location where a user's contacts are stored.</span></span> <span data-ttu-id="f0bc1-116">Если пользователь управляется политикой служб пользователей, в которой для UcsAllowed установлено имя True ($True), контакты пользователя будут храниться в едином хранилище контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-116">If a user is managed by a user services policy where UcsAllowed has been set to True ($True) then the user's contacts will be stored in the unified contact store.</span></span> <span data-ttu-id="f0bc1-117">Если пользователь управляется политикой служб пользователей, где для UcsAllowed установлено имя False ($False), его контакты будут храниться в Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-117">If the user is managed by a user services policy where UcsAllowed has been set to False ($False) then his or her contacts will be stored in Skype for Business Server.</span></span>
  
<span data-ttu-id="f0bc1-118">При установке Skype для бизнеса Server также устанавливается одна политика обслуживания пользователей (настроенная на глобальном уровне).</span><span class="sxs-lookup"><span data-stu-id="f0bc1-118">When you install Skype for Business Server, a single user services policy (configured at the global scope) is installed as well.</span></span> <span data-ttu-id="f0bc1-119">Значение UcsAllowed в этой политике имеет значение True, то есть по умолчанию контакты пользователей будут храниться в едином хранилище контактов (при условии, что они развернуты и настроены).</span><span class="sxs-lookup"><span data-stu-id="f0bc1-119">The UcsAllowed value in this policy is set to True, meaning that, by default, user contacts will be stored in the unified contact store (assuming this has been deployed and configured).</span></span> <span data-ttu-id="f0bc1-120">Если вы хотите перенести все контакты пользователей в единое хранилище контактов, вам не нужно ничего делать.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-120">If you want to migrate all of your user contacts to the unified contact store you do not have to do anything at all.</span></span> 
  
<span data-ttu-id="f0bc1-121">Если вы не хотите перенести все контакты в единое хранилище контактов, вы можете отключить единое хранилище контактов для всех пользователей, установив для свойства UcsAllowed глобальной политики параметр False:</span><span class="sxs-lookup"><span data-stu-id="f0bc1-121">If you would prefer not to migrate all your contacts to the unified contact store you can disable the unified contact store for all users by setting the UcsAllowed property in the global policy to False:</span></span>
  
```powershell
Set-CsUserServicesPolicy -Identity global -UcsAllowed $False
```

<span data-ttu-id="f0bc1-122">После отключения единого хранения контактов в глобальной политике можно создать политику на уровне пользователей, которая позволяет использовать единое хранилище контактов; Это позволяет сделать так, чтобы некоторые пользователи хранили свои контакты в едином хранилище контактов, в то время как другие пользователи продолжают хранить свои контакты в Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-122">After you have disabled the unified contact store in the global policy you can then create a per-user policy that enables the use of the unified contact store; this allows you to have some users keep their contacts in the unified contact store while other users continue to keep their contacts in Skype for Business Server.</span></span> <span data-ttu-id="f0bc1-123">Вы можете создать политику служб на пользователя с помощью команды, похожей на данной:</span><span class="sxs-lookup"><span data-stu-id="f0bc1-123">You can create a per-user user services policy by using a command similar to this:</span></span>
  
```powershell
New-CsUserServicesPolicy -Identity "AllowUnifiedContactStore" -UcsAllowed $True
```

<span data-ttu-id="f0bc1-p107">После создания политики ее необходимо назначить всем пользователям, которым требуется доступ к единому хранилищу контактов. Политики на уровне пользователей можно назначить пользователям с помощью следующей команды:</span><span class="sxs-lookup"><span data-stu-id="f0bc1-p107">After you have created the new policy you must then assign that policy to any user who should have access to the unified contact store. Per-user policies can be assigned to users by using commands similar to this:</span></span>
  
```powershell
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "AllowUnifiedContactStore"
```

<span data-ttu-id="f0bc1-126">После того как политика будет назначена, Skype для бизнеса Server начнет перенос контактов пользователя в единое хранилище контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-126">After the policy has been assigned, Skype for Business Server will begin to migrate the user's contacts to the unified contact store.</span></span> <span data-ttu-id="f0bc1-127">После завершения миграции контакты пользователя будут храниться в Exchange, а не в Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-127">After migration is complete, the user will then have his or her contacts stored in Exchange rather than Skype for Business Server.</span></span> <span data-ttu-id="f0bc1-128">Если во время миграции пользователь вошел в Lync 2013, появится окно сообщения, после чего ему будет предложено выйти из Skype для бизнеса, а затем снова войти в систему, чтобы завершить процесс.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-128">If the user happens to be logged on to Lync 2013 at the time migration completes, a message box will appear and he or she will be asked to log off of Skype for Business and then log back on in order to finalize the process.</span></span> <span data-ttu-id="f0bc1-129">Контакты пользователей, которым не назначена эта политика на пользователя, не будут перенесены в единое хранилище контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-129">Users who have not been assigned this per-user policy will not have their contacts migrated to the unified contact store.</span></span> <span data-ttu-id="f0bc1-130">Это потому, что эти пользователи управляются глобальной политикой, и использование единого магазина контактов было отключено в глобальной политике.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-130">That's because those users are being managed by the global policy, and use of the unified contact store has been disabled in the global policy.</span></span>
  
<span data-ttu-id="f0bc1-131">Чтобы убедиться, что контакты пользователя успешно перенесены в единое хранилище контактов, с помощью команды [Test-CsUnifiedContactStore](https://docs.microsoft.com/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) в оболочке управления Skype для бизнеса Server:</span><span class="sxs-lookup"><span data-stu-id="f0bc1-131">You can verify that a user's contacts have successfully been migrated to the unified contact store by running the [Test-CsUnifiedContactStore](https://docs.microsoft.com/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) cmdlet from within the Skype for Business Server Management Shell:</span></span>
  
```powershell
Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"
```

<span data-ttu-id="f0bc1-132">Если Test-CsUnifiedContactStore успешно, это означает, что контакты пользователя sip:kenmyer@ litwareinc .com были перенесены в единое хранилище <span></span> <span></span> контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-132">If Test-CsUnifiedContactStore succeeds that means that the contacts for the user sip:kenmyer@<span></span>litwareinc<span></span>.com have been migrated to the unified contact store.</span></span>
  
## <a name="rolling-back-the-unified-contact-store"></a><span data-ttu-id="f0bc1-133">Откат в единое хранилище контактов</span><span class="sxs-lookup"><span data-stu-id="f0bc1-133">Rolling Back the Unified Contact Store</span></span>

<span data-ttu-id="f0bc1-134">Если вам нужно удалить контакты пользователя из единого хранения контактов (например, если пользователь должен быть перенаучен в Microsoft Lync Server 2010 и поэтому больше не может использовать единое хранилище контактов), необходимо сделать два действия.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-134">If you need to remove a user's contacts from the unified contact store (for example, if the user needs to be rehomed on Microsoft Lync Server 2010 and thus can no longer use the unified contact store) you must do two things.</span></span> <span data-ttu-id="f0bc1-135">Во-первых, назначьте пользователю новую политику служб пользователей, которая запрещает хранение контактов в едином хранилище контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-135">First, you must assign the user a new user services policy, one that prohibits storing contacts in the unified contact store.</span></span> <span data-ttu-id="f0bc1-136">(То есть политика, в которой свойству UcsAllowed было заировано $False.) Если у вас нет такой политики, ее можно создать с помощью команды, похожей на данной:</span><span class="sxs-lookup"><span data-stu-id="f0bc1-136">(That is, a policy where the UcsAllowed property has been set to $False.) If you do not have such a policy you can create one using a command similar to this:</span></span>
  
```powershell
New-CsUserServicesPolicy -Identity NoUnifiedContactStore -UcsAllowed $False
```

<span data-ttu-id="f0bc1-137">Затем вы можете назначить эту политику на уровней пользователей (NoUnifiedContactStore) с помощью следующей команды:</span><span class="sxs-lookup"><span data-stu-id="f0bc1-137">You can then assign this new per-user policy (NoUnifiedContactStore) by using a command like this:</span></span>
  
```powershell
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName NoUnifiedContactStore
```

<span data-ttu-id="f0bc1-138">Предыдущая команда назначает новую политику пользователю Ken Myer и не позволяет переносить его контакты в единое хранилище контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-138">The preceding command assigns the new policy to the user Ken Myer, and also prevents Ken's contacts from being migrated to the unified contact store.</span></span>
  
> [!NOTE]
> <span data-ttu-id="f0bc1-139">В некоторых случаях можно добиться такого же сетевого эффекта, просто отозначив текущую политику служб пользователя.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-139">In some cases you can achieve the same net effect by simply un-assigning the user's current user services policy.</span></span> <span data-ttu-id="f0bc1-140">Например, предположим, что для Ken Myer есть политика на уровне пользователя, включающая единое хранилище контактов, но ваша глобальная политика запрещает использование хранилища.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-140">For example, suppose Ken Myer has a per-user user services policy the enables the unified contact store, but your global policy prohibits the use of the unified contact store.</span></span> <span data-ttu-id="f0bc1-141">В этом случае можно отозначить политику "Ken's per-user services".</span><span class="sxs-lookup"><span data-stu-id="f0bc1-141">In that case, you could un-assign Ken's per-user services policy.</span></span> <span data-ttu-id="f0bc1-142">В этом случае этот пользователь будет контролироваться глобальной политикой и у него не будет доступа к единому хранилищу контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-142">When you do that, Ken will automatically be managed by the global policy, and thus will no longer have access to the unified contact store.</span></span> <span data-ttu-id="f0bc1-143">Чтобы отозначить ранее назначенную политику на уровне пользователя, используйте ту же команду, что и ранее, но на этот раз установите для параметра PolicyName значение null: Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName $Null</span><span class="sxs-lookup"><span data-stu-id="f0bc1-143">To un-assign a previously-assigned per-user policy, use the same command as shown before, but this time set the PolicyName parameter to a null value: Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName $Null</span></span> 
  
<span data-ttu-id="f0bc1-144">Следует помнить о концепции "не позволяет перенести контакты пользователя Ken Myer в единое хранилище контактов" при работе с единым хранилищем контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-144">The terminology "prevents Ken's contacts from being migrated to the unified contact store" is important to keep in mind when working with the unified contact store.</span></span> <span data-ttu-id="f0bc1-145">Если просто назначить для Ken Myer новую политику служб пользователя, его контакты не будут перенесены из единого хранилища контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-145">Simply assigning Ken a new user services policy will not move his contacts out of the unified contact store.</span></span> <span data-ttu-id="f0bc1-146">Когда пользователь входит в Skype для бизнеса Server, система проверяет политику служб пользователя, чтобы определить, следует ли хранить его контакты в едином хранилище контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-146">When a user logs on to Skype for Business Server, the system checks the user's user services policy to see whether his or her contacts should be kept in the unified contact store.</span></span> <span data-ttu-id="f0bc1-147">Если ответ — да, (т. е. для свойства UcsAllowed задано значение $True), эти контакты будут перенесены в единое хранилище контактов (если они еще не в нем).</span><span class="sxs-lookup"><span data-stu-id="f0bc1-147">If the answer is yes (that is, if the UcsAllowed property is set to $True) then those contacts will be migrated to the unified contact store (assuming that those contacts are not already in the unified contact store).</span></span> <span data-ttu-id="f0bc1-148">Если ответ — нет, Skype для бизнеса Server просто игнорирует контакты пользователя и переходит к следующей задаче.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-148">If the answer is no, then Skype for Business Server simply ignores the user's contacts and moves on to its next task.</span></span> <span data-ttu-id="f0bc1-149">Это означает, что Skype для бизнеса Server не будет автоматически перемещать контакты пользователя из единого хранения контактов независимо от значения свойства UcsAllowed.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-149">That means that Skype for Business Server will not automatically move a user's contacts from out of the unified contact store, regardless of the value of the UcsAllowed property.</span></span>
  
<span data-ttu-id="f0bc1-150">Это также означает, что после назначения пользователю новой политики служб пользователей необходимо выполнить cmdlet [Invoke-CsUcsRollback,](https://docs.microsoft.com/powershell/module/skype/invoke-csucsrollback?view=skype-ps) чтобы переместить контакты пользователя из Exchange Server и вернуться в Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-150">That also means that, after assigning the user a new user services policy, you must then run the [Invoke-CsUcsRollback](https://docs.microsoft.com/powershell/module/skype/invoke-csucsrollback?view=skype-ps) cmdlet in order to move the user's contacts out of Exchange Server and back to Skype for Business Server.</span></span> <span data-ttu-id="f0bc1-151">Например, после назначения Ken Myer новой политики служб пользователя можно перенести его контакты из единого хранилища контактов с помощью следующей команды:</span><span class="sxs-lookup"><span data-stu-id="f0bc1-151">For example, after assigning Ken Myer a new user services policy you can then move his contacts out of the unified contact store by using the following command:</span></span>
  
```powershell
Invoke-CsUcsRollback -Identity "Ken Myer"
```

<span data-ttu-id="f0bc1-152">Если изменить политику служб пользователей, но не выполнять командлет Invoke-CsUcsRollback, контакты Ken Myer не будут удалены из единого хранилища контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-152">If you change the user services policy but do not run the Invoke-CsUcsRollback cmdlet Ken's contacts will not be removed from the unified contact store.</span></span> <span data-ttu-id="f0bc1-153">Что будет, если выполнить Invoke-CsUcsRollback, но не менять политику служб пользователей Ken Myer?</span><span class="sxs-lookup"><span data-stu-id="f0bc1-153">What if you run Invoke-CsUcsRollback but do not change Ken Myer's user services policy?</span></span> <span data-ttu-id="f0bc1-154">Тогда его контакты будут временно удалены из единого хранилища контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-154">In that case, Ken's contacts will be temporarily removed from the unified contact store.</span></span> <span data-ttu-id="f0bc1-155">Важно помнить о том, что удаление временное.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-155">The fact that this removal is temporary is important to keep in mind.</span></span> <span data-ttu-id="f0bc1-156">После удаления контактов пользователя Ken из единого магазина контактов Skype для бизнеса Server подождите 7 дней, а затем проверит, какая политика служб пользователя назначена пользователю Ken.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-156">After Ken's contacts have been removed from the unified contact store, Skype for Business Server will wait 7 days and then check to see which user services policy has been assigned to Ken.</span></span> <span data-ttu-id="f0bc1-157">Если все еще назначена политика, позволяющая применять единое хранилище контактов, его контакты автоматически перемещаются в хранилище контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-157">If Ken is still assigned a policy that enables the user of the unified contact store, then his contacts will automatically be moved back to into the contact store.</span></span> <span data-ttu-id="f0bc1-158">Чтобы удалить контакты из хранилища контактов без возможности восстановления, в дополнение к запуску командлета Invoke-CsUcsRollback следует изменить политику служб пользователя.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-158">To permanently remove contacts from the unified contact store you must change the user services policy in addition to running the Invoke-CsUcsRollback cmdlet.</span></span>
  
<span data-ttu-id="f0bc1-159">Из-за большого количества переменных, которые могут повлиять на миграцию, трудно оценить, сколько времени займет перенос учетных записей в единое хранилище контактов.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-159">Due to the large number of variables that can affect migration, it is difficult to estimate how long it will take before accounts are fully migrated to the unified contact store.</span></span> <span data-ttu-id="f0bc1-160">Как правило, миграция не сразу вступает в силу: даже при переносе небольшого количества контактов до завершения перемещения может потребоваться 10 минут или больше.</span><span class="sxs-lookup"><span data-stu-id="f0bc1-160">As a general rule, however, migration does not take effect immediately: even when migrating a small number of contacts it might take 10 minutes or more before the move is complete.</span></span>
  

