---
title: Настройка Skype для бизнеса Server для использования единого магазина контактов
ms.reviewer: ''
ms.author: v-mahoffman
author: HowlinWolf-92
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.collection: IT_Skype16
ms.assetid: 6aa17ae3-764e-4986-a900-85a3cdb8c1fc
description: Сводка. Настройте хранилище унифицированных контактов для Exchange Server и Skype для бизнеса Server.
ms.openlocfilehash: ed28f57350e2ce1d7ed5f92d712bdf5ecc7f3de4
ms.sourcegitcommit: 67324fe43f50c8414bb65c52f5b561ac30b52748
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2021
ms.locfileid: "60853673"
---
# <a name="configure-skype-for-business-server-to-use-the-unified-contact-store"></a>Настройка Skype для бизнеса Server для использования единого магазина контактов
 
**Сводка:** Настройка единого магазина контактов для Exchange Server 2016 или Exchange Server 2013 и Skype для бизнеса Server.
  
С помощью единого магазина контактов пользователи поддерживают один список контактов, а затем имеют эти контакты в нескольких приложениях, включая Skype для бизнеса, Microsoft Outlook 2013 и Microsoft Outlook Web App 2013. Когда вы включаете единый хранилище контактов для пользователя, контакты этого пользователя не хранятся в Skype для бизнеса Server и извлекаются по мере необходимости. Вместо этого его контакты хранятся в Exchange Server 2016 или Exchange Server 2013 г. и извлекаются с помощью Exchange веб-служб.
  
> [!NOTE]
> Технически контактные данные хранятся в паре папок, найденных в Exchange почтовом ящике пользователя. Сами контакты хранятся в папке с именем Skype для бизнеса контактов, которая видна конечным пользователям; Метаданные о контактах хранятся в подмостке, которая не видна конечным пользователям. 
  
## <a name="enabling-the-unified-contact-store-for-a-user"></a>Включение единого хранилища контактов для пользователей

Если проверка подлинности между сервером Skype для бизнеса Server и Exchange Server уже настроена, вы также включили единый магазин контактов. дополнительная конфигурация сервера не требуется. Однако для перемещения контактов пользователя в единый магазин контактов требуется дополнительная конфигурация учетной записи пользователя. По умолчанию контакты пользователей хранятся в Skype для бизнеса Server, а не в едином хранилище контактов.
  
Доступ к единому хранилище контактов управляется с помощью Skype для бизнеса Server служб пользователей. У политик служб пользователей всего одно свойство (UcsAllowed), которое используется для определения расположения хранения контактов пользователя. Если пользователь управляется политикой служб пользователей, в которой UcsAllowed установлено true ($True), контакты пользователя будут храниться в едином магазине контактов. Если пользователь управляется политикой служб пользователей, в которой UcsAllowed установлено false ($False), его контакты будут храниться в Skype для бизнеса Server.
  
При установке Skype для бизнеса Server устанавливается политика служб пользователя (настроенная в глобальном масштабе). Значение UcsAllowed в этой политике задается значением True, а это означает, что по умолчанию контакты пользователей будут храниться в едином хранилище контактов (если это было развернуто и настроено). Если вы хотите перенести все контакты пользователей в единый магазин контактов, вам не нужно ничего делать. 
  
Если вы не хотите перенести все контакты в единый магазин контактов, вы можете отключить единый магазин контактов для всех пользователей, установив свойство UcsAllowed в глобальной политике false:
  
```powershell
Set-CsUserServicesPolicy -Identity global -UcsAllowed $False
```

После отключения единого магазина контактов в глобальной политике можно создать политику для каждого пользователя, которая позволяет использовать единый магазин контактов; это позволяет некоторым пользователям сохранять контакты в едином хранилище контактов, а другие пользователи продолжают поддерживать контакты в Skype для бизнеса Server. Вы можете создать политику пользовательских служб с помощью команды, аналогичной этой:
  
```powershell
New-CsUserServicesPolicy -Identity "AllowUnifiedContactStore" -UcsAllowed $True
```

После создания политики ее необходимо назначить всем пользователям, которым требуется доступ к единому хранилищу контактов. Политики на уровне пользователей можно назначить пользователям с помощью следующей команды:
  
```powershell
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "AllowUnifiedContactStore"
```

После того как политика назначена, Skype для бизнеса Server начнется перенос контактов пользователя в единый магазин контактов. После завершения миграции пользователь будет хранить свои контакты в Exchange, а не Skype для бизнеса Server. Если на момент завершения миграции пользователь вошел в систему Lync 2013, появится поле сообщений, и ему будет предложено выйти из Skype для бизнеса, а затем войти в систему, чтобы завершить процесс. Пользователи, которым не назначена эта политика для каждого пользователя, не будут иметь свои контакты, перенесенные в единый магазин контактов. Это потому, что этими пользователями управляет глобальная политика, а использование единого магазина контактов отключено в глобальной политике.
  
Вы можете убедиться в успешной миграции контактов пользователя в единый магазин контактов с помощью команды [Test-CsUnifiedContactStore](/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) из Skype для бизнеса Server management Shell:
  
```powershell
Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"
```

Если Test-CsUnifiedContactStore это означает, что контакты для пользователя sip:kenmyer@ litwareinc.com были перенесены в единый магазин <span></span> <span></span> контактов.
  
## <a name="rolling-back-the-unified-contact-store"></a>Откат в единое хранилище контактов

Если необходимо удалить контакты пользователя из единого магазина контактов (например, если пользователю требуется перенастраить его на Microsoft Lync Server 2010 и поэтому он больше не может использовать единый магазин контактов), необходимо сделать две вещи. Во-первых, назначьте пользователю новую политику служб пользователей, которая запрещает хранение контактов в едином хранилище контактов. (То есть политика, в которой для свойства UcsAllowed установлено $False.) Если у вас нет такой политики, можно создать ее с помощью команды, аналогичной этой:
  
```powershell
New-CsUserServicesPolicy -Identity NoUnifiedContactStore -UcsAllowed $False
```

Затем вы можете назначить эту политику на уровней пользователей (NoUnifiedContactStore) с помощью следующей команды:
  
```powershell
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName NoUnifiedContactStore
```

Предыдущая команда назначает новую политику пользователю Ken Myer и не позволяет переносить его контакты в единое хранилище контактов.
  
> [!NOTE]
> В некоторых случаях можно добиться того же чистого эффекта, просто отозначив текущую политику пользовательских служб пользователя. Например, предположим, что для Ken Myer есть политика на уровне пользователя, включающая единое хранилище контактов, но ваша глобальная политика запрещает использование хранилища. В этом случае можно отозначить политику служб Кена для каждого пользователя. В этом случае этот пользователь будет контролироваться глобальной политикой и у него не будет доступа к единому хранилищу контактов. Чтобы отозначить ранее назначенную политику для каждого пользователя, используйте ту же команду, что и показано ранее, но на этот раз установите параметр PolicyName значение null: Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName $Null 
  
Следует помнить о концепции "не позволяет перенести контакты пользователя Ken Myer в единое хранилище контактов" при работе с единым хранилищем контактов. Если просто назначить для Ken Myer новую политику служб пользователя, его контакты не будут перенесены из единого хранилища контактов. Когда пользователь входит в Skype для бизнеса Server, система проверяет политику пользовательских служб пользователя, чтобы узнать, следует ли хранить его контакты в едином хранилище контактов. Если ответ — да, (т. е. для свойства UcsAllowed задано значение $True), эти контакты будут перенесены в единое хранилище контактов (если они еще не в нем). Если ответ нет, Skype для бизнеса Server просто игнорирует контакты пользователя и переходит к следующей задаче. Это означает, Skype для бизнеса Server не будет автоматически перемещать контакты пользователя из единого магазина контактов независимо от значения свойства UcsAllowed.
  
Это также означает, что после назначения пользователю новой политики служб пользователей необходимо запустить комлет [Invoke-CsUcsRollback](/powershell/module/skype/invoke-csucsrollback?view=skype-ps) для перемещения контактов пользователя из Exchange Server и обратно в Skype для бизнеса Server. Например, после назначения Ken Myer новой политики служб пользователя можно перенести его контакты из единого хранилища контактов с помощью следующей команды:
  
```powershell
Invoke-CsUcsRollback -Identity "Ken Myer"
```

Если изменить политику служб пользователей, но не выполнять командлет Invoke-CsUcsRollback, контакты Ken Myer не будут удалены из единого хранилища контактов. Что будет, если выполнить Invoke-CsUcsRollback, но не менять политику служб пользователей Ken Myer? Тогда его контакты будут временно удалены из единого хранилища контактов. Важно помнить о том, что удаление временное. После удаления контактов Кена из единого магазина контактов Skype для бизнеса Server 7 дней, а затем проверьте, какая политика служб пользователей назначена Кену. Если все еще назначена политика, позволяющая применять единое хранилище контактов, его контакты автоматически перемещаются в хранилище контактов. Чтобы удалить контакты из хранилища контактов без возможности восстановления, в дополнение к запуску командлета Invoke-CsUcsRollback следует изменить политику служб пользователя.
  
Из-за большого количества переменных, которые могут повлиять на миграцию, трудно определить, сколько времени это займет, прежде чем учетные записи будут полностью перенесены в единый хранилище контактов. Однако, как правило, миграция не сразу вступает в силу: даже при переносе небольшого количества контактов до завершения перемещения может потребоваться 10 минут или более.
