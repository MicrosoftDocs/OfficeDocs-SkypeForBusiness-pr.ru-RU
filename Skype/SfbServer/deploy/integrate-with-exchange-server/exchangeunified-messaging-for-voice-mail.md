---
title: Настройка единой системы обмена сообщениями Exchange Server для голосовой почты Skype для бизнеса Server
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 2/11/2019
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 1be9c4f4-fd8e-4d64-9798-f8737b12e2ab
description: 'Сводка: Настройка единой системы обмена сообщениями Exchange Server для голосовой почты в Skype для бизнеса Server.'
ms.openlocfilehash: 514b2159c3836aee4bd6bcfad2b85311280277c4
ms.sourcegitcommit: e1c8a62577229daf42f1a7bcfba268a9001bb791
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2019
ms.locfileid: "36238010"
---
# <a name="configure-exchange-server-unified-messaging-for-skype-for-business-server-voice-mail"></a><span data-ttu-id="7e9c6-103">Настройка единой системы обмена сообщениями Exchange Server для голосовой почты Skype для бизнеса Server</span><span class="sxs-lookup"><span data-stu-id="7e9c6-103">Configure Exchange Server Unified Messaging for Skype for Business Server voice mail</span></span>
 
<span data-ttu-id="7e9c6-104">**Сводка:** Настройте единую систему обмена сообщениями Exchange Server для голосовой почты в Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-104">**Summary:** Configure Exchange Server Unified Messaging for Skype for Business Server voice mail.</span></span>
  
<span data-ttu-id="7e9c6-105">Skype для бизнеса Server позволяет использовать голосовые сообщения, хранящиеся в Exchange Server 2016 или Exchange Server 2013; Эти голосовые сообщения будут отображаться как сообщения электронной почты в ящиках пользователей.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-105">Skype for Business Server enables you to have voicemail messages stored in Exchange Server 2016 or Exchange Server 2013; those voicemail messages will then appear as email messages in your users' Inboxes.</span></span> 

> [!NOTE]
> <span data-ttu-id="7e9c6-106">Единая система обмена сообщениями Exchange, которая ранее известна, больше не доступна в Exchange 2019, но вы по-прежнему можете использовать телефонную систему для записи голосовых сообщений, а затем оставить запись в почтовом ящике Exchange пользователя.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-106">Exchange Unified Messaging as previously known is no longer available in Exchange 2019, but you can still use Phone System to record voicemail messages and then leave the recording in a user's Exchange mailbox.</span></span> <span data-ttu-id="7e9c6-107">Дополнительные сведения приведены в разделе [планирование облачной службы голосовой почты](../../../sfbhybrid/hybrid/plan-cloud-voicemail.md) .</span><span class="sxs-lookup"><span data-stu-id="7e9c6-107">See [Plan Cloud Voicemail service](../../../sfbhybrid/hybrid/plan-cloud-voicemail.md) for more information.</span></span>
  
<span data-ttu-id="7e9c6-108">Если вы уже настроили проверку подлинности серверов в Skype для бизнеса Server и Exchange Server 2016 или Exchange Server 2013, вы можете настроить единую систему обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-108">If you have already configured server-to-server authentication between Skype for Business Server and Exchange Server 2016 or Exchange Server 2013, then you are ready to setup unified messaging.</span></span> <span data-ttu-id="7e9c6-109">Для этого необходимо сначала создать и назначить новую абонентскую группу единой системы обмена сообщениями на сервере Exchange.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-109">To do so, you must first create and assign a new unified messaging dial plan on your Exchange Server.</span></span> <span data-ttu-id="7e9c6-110">Например, эти две команды (выполняются из командной консоли Exchange) настраивают новый 3-значный абонентский тариф для Exchange:</span><span class="sxs-lookup"><span data-stu-id="7e9c6-110">For example, these two commands (run from within the Exchange Management Shell) configure a new 3-digit dial plan for Exchange:</span></span>
  
```
New-UMDialPlan -Name "RedmondDialPlan" -VoIPSecurity "Secured" -NumberOfDigitsInExtension 3 -URIType "SipName" -CountryOrRegionCode 1
Set-UMDialPlan "RedmondDialPlan" -ConfiguredInCountryOrRegionGroups "Anywhere,*,*,*" -AllowedInCountryOrRegionGroups "Anywhere"
```

<span data-ttu-id="7e9c6-111">В первой команде примера параметр Воипсекурити и значение параметра "безопасно" указывает на то, что канал сигналов шифруется с помощью протокола TLS.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-111">In the first command in the example, the VoIPSecurity parameter, and the parameter value "Secured" indicates that the signaling channel is encrypted by using Transport Layer Security (TLS).</span></span> <span data-ttu-id="7e9c6-112">Значение "SipName" параметра URIType указывает, что сообщения будут отправляться и получаться посредством протокола SIP, а если для параметра CountryOrRegionCode выбрано значение "1", это свидетельствует о том, что абонентская группа применима для США.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-112">The URIType "SipName" indicates that messages will be sent and received using the SIP protocol, and the CountryOrRegionCode of 1 indicates that the dial plan applies to the US.</span></span>
  
<span data-ttu-id="7e9c6-113">Во второй команде значение, переданное в параметр ConfiguredInCountryOrRegionGroups, определяет группы внутри страны, которые можно использовать в этой абонентской группе.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-113">In the second command, the parameter value passed to the ConfiguredInCountryOrRegionGroups parameter specifies the in-country groups that can be used with this dial plan.</span></span> <span data-ttu-id="7e9c6-114">Значение параметра "везде\*\*",\*"," задает указанные ниже значения.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-114">The parameter value "Anywhere,\*,\*,\*" sets the following:</span></span>
  
- <span data-ttu-id="7e9c6-115">Имя группы ("Anywhere")</span><span class="sxs-lookup"><span data-stu-id="7e9c6-115">Group name ("Anywhere")</span></span>
    
- <span data-ttu-id="7e9c6-116">Алловеднумберстринг (\*— подстановочный знак, указывающий на то, что любая строка с цифрами разрешена)</span><span class="sxs-lookup"><span data-stu-id="7e9c6-116">AllowedNumberString (\*, a wildcard character indicating that any number string is allowed)</span></span>
    
- <span data-ttu-id="7e9c6-117">Диалнумберстринг (\*— подстановочный знак, указывающий на то, что все номера разрешены)</span><span class="sxs-lookup"><span data-stu-id="7e9c6-117">DialNumberString (\*, a wildcard character indicating that any dialed number is allowed)</span></span>
    
- <span data-ttu-id="7e9c6-118">Тексткоммент (\*— подстановочный знак, указывающий на то, что какая-либо из текстовых команд разрешена)</span><span class="sxs-lookup"><span data-stu-id="7e9c6-118">TextComment (\*, a wildcard character indicating that any text command is allowed)</span></span>
    
> [!NOTE]
> <span data-ttu-id="7e9c6-119">При создании новой абонентской группы создается также используемая по умолчанию политика почтовых ящиков.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-119">Creating a new dial plan will also create a Default Mailbox Policy.</span></span> 
  
<span data-ttu-id="7e9c6-120">После создания и настройки новой абонентской группы необходимо добавить ее на сервере единой системы обмена сообщениями и затем изменить режим запуска этого сервера: в частности, задать режим запуска "Двойной".</span><span class="sxs-lookup"><span data-stu-id="7e9c6-120">After creating and configuring the new dial plan you must add the new dial plan to your unified messaging server and then modify the startup mode of that server; in particular, you must set the startup mode to "Dual".</span></span> <span data-ttu-id="7e9c6-121">Вы можете выполнять обе эти задачи в командной консоли Exchange:</span><span class="sxs-lookup"><span data-stu-id="7e9c6-121">You can perform both of these tasks from within the Exchange Management Shell:</span></span>
  
```
Set-UmService -Identity "atl-exchangeum-001.litwareinc.com" -DialPlans "RedmondDialPlan" -UMStartupMode "Dual"
```

<span data-ttu-id="7e9c6-122">После того как вы настроили сервер единой системы обмена сообщениями, необходимо выполнить командлет Enable-ExchangeCertificate, чтобы убедиться в том, что сертификат Exchange применен к службе единой системы обмена сообщениями:</span><span class="sxs-lookup"><span data-stu-id="7e9c6-122">After the unified messaging server has been configured you should next run the Enable-ExchangeCertificate cmdlet to ensure that your Exchange certificate is applied to the unified messaging service:</span></span>
  
```
Enable-ExchangeCertificate -Server "atl-umserver-001.litwareinc.com" -Thumbprint "EA5A332496CC05DA69B75B66111C0F78A110D22d" -Services "SMTP","IIS","UM"
```

<span data-ttu-id="7e9c6-p106">После корректного назначения сертификата необходимо остановить и перезапустить службу MsExchangeUM на сервере единой системы обмена сообщениями. Эту службу необходимо останавливать и запускать после каждого изменения режима запуска.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-p106">After the certificate has been correctly assigned you must then stop and restart the MsExchangeUM service on the unified messaging server. This service must be stopped and restarted any time you change the startup mode.</span></span>
  
<span data-ttu-id="7e9c6-125">По завершении настройки сервера единой системы обмена сообщениями можно настроить маршрутизатор вызовов в единую систему обмена сообщениями:</span><span class="sxs-lookup"><span data-stu-id="7e9c6-125">After finishing configuration of the unified messaging server you can then configure the UM Call Router:</span></span>
  
```
Set-UMCallRouterSettings -Server "atl-exchange-001.litwareinc.com" -UMStartupMode "Dual" -DialPlans "RedmondDialPlan" 
Enable-ExchangeCertificate -Server "atl-umserver-001.litwareinc.com" -Thumbprint "45BAA32496CC891169B75B9811320F78A1075DDA" -Services "IIS","UMCallRouter"
```

<span data-ttu-id="7e9c6-126">Поскольку режим запуска был изменен, необходимо остановить и перезапустить службу MsExchangeUMCR на том, компьютере, где размещен маршрутизатор вызовов в единую систему обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-126">Because the startup mode has changed you must stop and restart the MsExchangeUMCR service on the computer hosting the UM Call Router.</span></span>
  
<span data-ttu-id="7e9c6-p107">Для завершения настройки единой системы обмена сообщениями необходимо создать политику почтовых ящиков единой системы обмена мгновенными сообщениями, после чего использовать ее, чтобы разрешить пользователям работу с единой системой обмена сообщениями. Для создания политики почтовых ящиков можно использовать команду следующего вида:</span><span class="sxs-lookup"><span data-stu-id="7e9c6-p107">To complete the unified messaging setup, you then need to create a UM mailbox policy and then use that policy to enable users for unified messaging. You can create a mailbox policy by using a command similar to this:</span></span>
  
```
New-UMMailboxPolicy -Name "RedmondMailboxPolicy" -AllowedInCountryOrRegionGroups "Anywhere"
```

<span data-ttu-id="7e9c6-129">Чтобы разрешить пользователям работу с единой системой обмена сообщениями, можно также использовать команду следующего вида:</span><span class="sxs-lookup"><span data-stu-id="7e9c6-129">And you can enable a user for unified messaging by using a command similar to this:</span></span>
  
```
Enable-UMMailbox -Extensions 100 -SIPResourceIdentifier "kenmyer@litwareinc.com" -Identity "litwareinc\kenmyer" -UMMailboxPolicy "RedmondMailboxPolicy"
```

<span data-ttu-id="7e9c6-p108">В предыдущей команде параметр Extensions представляет добавочный номер телефона для пользователя. В этом примере добавочный номер пользователя — 100.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-p108">In the preceding command, the Extensions parameter represents the telephone extension number for the user. In this example, the user has the extension number 100.</span></span>
  
<span data-ttu-id="7e9c6-132">После активации почтового ящика пользователь kenmyer@litwareinc.com может работать с единой системой обмена сообщениями Exchange.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-132">After you have enabled his mailbox, the user kenmyer@litwareinc.com should be able to use Exchange unified messaging.</span></span> <span data-ttu-id="7e9c6-133">Вы можете убедиться, что пользователь может подключаться к UM Exchange, выполнив командлет [Test-ксексумконнективити](https://docs.microsoft.com/powershell/module/skype/test-csexumconnectivity?view=skype-ps) в командной консоли управления Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-133">You can verify that the user can connect to Exchange UM by running the [Test-CsExUMConnectivity](https://docs.microsoft.com/powershell/module/skype/test-csexumconnectivity?view=skype-ps) cmdlet from within the Skype for Business Server Management Shell:</span></span>
  
```
$credential = Get-Credential "litwareinc\kenmyer"
Test-CsExUMConnectivity -TargetFqdn "atl-cs-001.litwareinc.com" -UserSipAddress "sip:kenmyer@litwareinc.com" -UserCredential $credential
```

<span data-ttu-id="7e9c6-134">При наличии второго пользователя, которому разрешена работа с единой системой обмена сообщениями, можно с помощью командлета [Test-CsExUMVoiceMail](https://docs.microsoft.com/powershell/module/skype/test-csexumvoicemail?view=skype-ps) проверить, может ли второй пользователь оставлять сообщения голосовой почты для первого пользователя.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-134">If you have a second user who has been enabled for unified messaging you can use the [Test-CsExUMVoiceMail](https://docs.microsoft.com/powershell/module/skype/test-csexumvoicemail?view=skype-ps) cmdlet to verify that this second user can leave a voicemail message for the first user.</span></span>
  
```
$credential = Get-Credential "litwareinc\pilar"
Test-CsExUMVoiceMail -TargetFqdn "atl-cs-001.litwareinc.com" -ReceiverSipAddress "sip:kenmyer@litwareinc.com" -SenderSipAddress "sip:pilar@litwareinc.com" -SenderCredential $credential
```



## <a name="configuring-unified-messaging-on-microsoft-exchange-server"></a><span data-ttu-id="7e9c6-135">Настройка единой системы обмена сообщениями на сервере Microsoft Exchange</span><span class="sxs-lookup"><span data-stu-id="7e9c6-135">Configuring Unified Messaging on Microsoft Exchange Server</span></span> 
> [!IMPORTANT]
> <span data-ttu-id="7e9c6-136">Если вы хотите использовать единую систему обмена сообщениями Exchange для обеспечения ответа на звонки, голосового доступа к Outlook или служб автоматического ассистента для пользователей корпоративной голосовой связи, читайте [план интеграции единой системы обмена сообщениями в Skype для бизнеса](../../plan-your-deployment/integrate-with-exchange/unified-messaging.md), а затем следуйте инструкциям инструкции в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-136">If you want to use Exchange Unified Messaging (UM) to provide call answering, Outlook Voice Access, or auto-attendant services for Enterprise Voice users, read [Plan for Exchange Unified Messaging integration in Skype for Business](../../plan-your-deployment/integrate-with-exchange/unified-messaging.md), and then follow the instructions in this section.</span></span> 

<span data-ttu-id="7e9c6-137">Чтобы настроить единую систему обмена сообщениями Exchange для работы с корпоративной голосовой связью, необходимо выполнить указанные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-137">To configure Exchange Unified Messaging (UM) to work with Enterprise Voice, you’ll need to perform the following tasks:</span></span>

- <span data-ttu-id="7e9c6-138">Настройка сертификатов на сервере, на котором запущены службы единой системы обмена сообщениями Exchange</span><span class="sxs-lookup"><span data-stu-id="7e9c6-138">Configure certificates on the server running Exchange Unified Messaging (UM) services</span></span>
  > [!NOTE]
  > <span data-ttu-id="7e9c6-139">Добавляйте все серверы клиентского доступа и почтовых ящиков ко всем абонентам SIP URI для UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-139">Add all Client Access and Mailbox servers to all UM SIP URI dial plans.</span></span> <span data-ttu-id="7e9c6-140">Если нет, Маршрутизация исходящих вызовов не будет работать должным образом.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-140">If not, outbound call routing won’t work as expected.</span></span> 
- <span data-ttu-id="7e9c6-141">Создайте одну или несколько абонентов SIP с помощью URI для обмена сообщениями, а также с телефонными номерами абонентов, если это необходимо, а затем создайте соответствующие абонентские планы.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-141">Create one or more UM SIP URI dial plans, along with the subscriber access phone numbers, as needed, and then create corresponding L dial plans.</span></span>

- <span data-ttu-id="7e9c6-142">С помощью сценария ексчукутил. ps1 вы можете:</span><span class="sxs-lookup"><span data-stu-id="7e9c6-142">Use the exchucutil.ps1 script to:</span></span>
    - <span data-ttu-id="7e9c6-143">Создание IP-шлюзов UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-143">Create UM IP gateways.</span></span>
    - <span data-ttu-id="7e9c6-144">Создание групп слежения UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-144">Create UM hunt groups.</span></span>
    - <span data-ttu-id="7e9c6-145">Предоставьте Skype для бизнеса Server разрешение на чтение объектов доменных служб Active Directory UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-145">Grant Skype for Business Server permission to read UM Active Directory Domain Services objects.</span></span>
- <span data-ttu-id="7e9c6-146">Создайте объект автоматического ассистента UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-146">Create a UM auto-attendant object.</span></span>
- <span data-ttu-id="7e9c6-147">Создайте объект абонентского доступа.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-147">Create a subscriber access object.</span></span>
- <span data-ttu-id="7e9c6-148">Создание универсального кода ресурса (URI) SIP для каждого пользователя и сопоставление пользователей с помощью абонентской группы SIP URI.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-148">Create a SIP URI for each user and associating users with a UM SIP URI dial plan.</span></span>

### <a name="requirements-and-recommendations"></a><span data-ttu-id="7e9c6-149">Требования и рекомендации</span><span class="sxs-lookup"><span data-stu-id="7e9c6-149">Requirements and Recommendations</span></span>

<span data-ttu-id="7e9c6-150">Прежде чем приступить к работе, в документации в этом разделе предполагается, что вы развернули следующие роли Exchange: клиентский доступ и почтовый ящик.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-150">Before you begin, the documentation in this section assumes that you have deployed the following Exchange roles: Client Access and Mailbox.</span></span> <span data-ttu-id="7e9c6-151">На сервере Microsoft Exchange служба единой системы обмена сообщениями Exchange работает в качестве службы на этих серверах.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-151">In Microsoft Exchange Server, Exchange UM runs as a service on these servers.</span></span>

<span data-ttu-id="7e9c6-152">Также обратите внимание на следующее:</span><span class="sxs-lookup"><span data-stu-id="7e9c6-152">Also note the following:</span></span>
- <span data-ttu-id="7e9c6-153">Если в нескольких лесах установлено приложение Exchange UM, для каждого леса UM необходимо выполнить инструкции интеграции с Exchange Server.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-153">If Exchange UM is installed in multiple forests, the Exchange Server integration steps must be performed for each UM forest.</span></span> <span data-ttu-id="7e9c6-154">Кроме того, каждый лес UM должен быть настроен для доверия к лесу, в котором развернута Skype для бизнеса Server, и лес в Вхичскипе для Business Server должен быть настроен для доверия к каждому лесу UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-154">In addition, each UM forest must be configured to trust the forest in which Skype for Business Server is deployed, and the forest in whichSkype for Business Server is deployed must be configured to trust each UM forest.</span></span>
- <span data-ttu-id="7e9c6-155">Этапы интеграции выполняются как на ролях сервера Exchange, так и на серверах, на которых работает служба единой системы обмена сообщениями, а также на сервере, на котором установлен Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-155">Integration steps are performed on both the Exchange Server roles where Unified Messaging services are running, and on the server running Skype for Business Server.</span></span> <span data-ttu-id="7e9c6-156">Перед выполнением шагов интеграции Lync Server 2013 необходимо выполнить инструкции интеграции с единой системой обмена сообщениями Exchange Server.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-156">You should perform the Exchange Server Unified Messaging integration steps before you perform the Lync Server 2013 integration steps.</span></span>
  > [!NOTE]
  > <span data-ttu-id="7e9c6-157">Чтобы узнать, какие действия по интеграции выполняются на каких серверах и на каких ролях администратора, ознакомьтесь со статьей [Общие сведения о процессе развертывания для интеграции локальной системы обработки сообщений и Skype для бизнеса](../../plan-your-deployment/integrate-with-exchange/deployment-overview.md).</span><span class="sxs-lookup"><span data-stu-id="7e9c6-157">To see which integration steps are performed on which servers and by which administrator roles, see  [Deployment process overview for integrating on-premises Unified Messaging and Skype for Business](../../plan-your-deployment/integrate-with-exchange/deployment-overview.md).</span></span> 

<span data-ttu-id="7e9c6-158">Следующие средства должны быть доступны на каждом сервере, на котором запущена служба единой системы обмена сообщениями Exchange.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-158">The following tools must be available on each server running Exchange UM:</span></span>
- <span data-ttu-id="7e9c6-159">Консоль управления Exchange</span><span class="sxs-lookup"><span data-stu-id="7e9c6-159">Exchange Management Shell</span></span>
- <span data-ttu-id="7e9c6-160">Сценарий ексчукутил. ps1, который выполняет следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="7e9c6-160">The script exchucutil.ps1, which performs the following tasks:</span></span>
    - <span data-ttu-id="7e9c6-161">Создание шлюза IP единой системы обмена сообщениями для каждого сервера Skype для бизнеса.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-161">Creates a UM IP gateway for each Skype for Business Server.</span></span>
    - <span data-ttu-id="7e9c6-162">Создание группы слежения для каждого шлюза.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-162">Creates a hunt group for each gateway.</span></span> <span data-ttu-id="7e9c6-163">Идентификатор пилотной программы для каждой из групп слежения указывает абонентскую группу UM SIP, используемую интерфейсным пулом или сервером Standard Edition, который связан с шлюзом.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-163">The pilot identifier of each hunt group specifies the UM SIP URI dial plan used by the Front End pool or Standard Edition server that is associated with the gateway.</span></span>
    - <span data-ttu-id="7e9c6-164">Предоставление серверу Skype для бизнеса разрешения на чтение объектов единой системы обмена сообщениями Exchange в доменных службах Active Directory.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-164">Grants Skype for Business Server permission to read Exchange UM objects in Active Directory Domain Services.</span></span>



### <a name="configure-unified-messaging-on-microsoft-exchange-with-exchucutilps1"></a><span data-ttu-id="7e9c6-165">Configure Unified Messaging on Microsoft Exchange with ExchUCUtil.ps1</span><span class="sxs-lookup"><span data-stu-id="7e9c6-165">Configure Unified Messaging on Microsoft Exchange with ExchUCUtil.ps1</span></span> 

<span data-ttu-id="7e9c6-166">При интеграции Microsoft Skype для бизнеса Server с единой системой обмена сообщениями Exchange (UM) необходимо запустить сценарий Ексчукутил. ps1 в оболочке.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-166">When you’re integrating Microsoft Skype for Business Server with Exchange Unified Messaging (UM), you have to run the ExchUcUtil.ps1 script in the Shell.</span></span> <span data-ttu-id="7e9c6-167">Сценарий Ексчукутил. ps1 делает следующее:</span><span class="sxs-lookup"><span data-stu-id="7e9c6-167">The ExchUcUtil.ps1 script does the following:</span></span>

- <span data-ttu-id="7e9c6-168">Создание шлюза IP единой системы обмена сообщениями для каждого пула серверов Skype для бизнеса.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-168">Creates a UM IP gateway for each Skype for Business Server pool.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7e9c6-169">Сценарий Ексчукутил. ps1 создает один или несколько IP-шлюзов UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-169">The ExchUcUtil.ps1 script creates one or more UM IP gateways.</span></span> <span data-ttu-id="7e9c6-170">Вы должны отключить исходящие вызовы для всех IP-шлюзов UM за исключением одного шлюза, созданного сценарием.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-170">You must disable outgoing calls on all UM IP gateways except one gateway that the script created.</span></span> <span data-ttu-id="7e9c6-171">Сюда входит отключение исходящих вызовов для IP-шлюзов UM, созданных до запуска сценария.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-171">This includes disabling outgoing calls on UM IP gateways that were created before you ran the script.</span></span> 

- <span data-ttu-id="7e9c6-172">Создает группу слежения UM для каждого IP-шлюза UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-172">Creates a UM hunt group for each UM IP gateway.</span></span> <span data-ttu-id="7e9c6-173">Идентификатор пилотной программы для каждой из групп слежения определяет абонентскую группу UM, которая используется в пуле интерфейсов SIP в Skype для бизнеса Server или стандартном сервере Standard Edition, связанном с IP-шлюзом UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-173">The pilot identifier of each hunt group specifies the UM SIP URI dial plan used by the Skype for Business Server Front End pool or Standard Edition server that’s associated with the UM IP gateway.</span></span>
- <span data-ttu-id="7e9c6-174">Предоставление доступа к Skype для бизнеса Server для чтения объектов контейнеров Active Directory UM, таких как абонентские группы единой системы обмена сообщениями, автосекретарей, IP-шлюзы UM и групп слежения UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-174">Grants Skype for Business Server permission to read Active Directory UM container objects such as UM dial plans, auto attendants, UM IP gateways, and UM hunt groups.</span></span>
  > [!IMPORTANT]
  > <span data-ttu-id="7e9c6-175">Каждый лес UM должен быть настроен для доверия к лесу, в котором развернута Skype для бизнеса Server, и в лесу, в котором развернута Skype для бизнеса Server 2013, необходимо настроить для доверия к каждому лесу UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-175">Each UM forest must be configured to trust the forest in which Skype for Business Server is deployed, and the forest in which Skype for Business Server 2013 is deployed must be configured to trust each UM forest.</span></span> <span data-ttu-id="7e9c6-176">Если в нескольких лесах установлено приложение Exchange UM, для каждого из них необходимо выполнить интеграцию с Exchange Server, а также указать домен Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-176">If Exchange UM is installed in multiple forests, the Exchange Server integration steps must be performed for each UM forest or you’ll have to specify the Skype for Business Server domain.</span></span> <span data-ttu-id="7e9c6-177">Например, Ексчукутил. ps1 — Forest: <Lync — Domain-Controller — FQDN>.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-177">For example, ExchUcUtil.ps1 –Forest:<lync-domain-controller-fqdn>.</span></span> 

### <a name="use-the-shell-to-run-the-exchucutilps1-script"></a><span data-ttu-id="7e9c6-178">Использование оболочки для запуска сценария Ексчукутил. ps1</span><span class="sxs-lookup"><span data-stu-id="7e9c6-178">Use the Shell to run the ExchUcUtil.ps1 script</span></span>

<span data-ttu-id="7e9c6-179">Запустите сценарий Ексчукутил. ps1 на любом сервере Exchange в Организации, который находится в той же топологии, что и Skype для бизнеса Server.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-179">Run the ExchUcUtil.ps1 script on any Exchange server in your organization that’s in the same topology as Skype for Business Server.</span></span> <span data-ttu-id="7e9c6-180">Вы можете запустить сценарий с сервера почтовых ящиков с помощью оболочки или запустить сценарий с помощью удаленного Windows PowerShell на сервере клиентского доступа.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-180">You can run the script from a Mailbox server using the Shell or you can run the script using Remote Windows PowerShell on a Client Access server.</span></span> <span data-ttu-id="7e9c6-181">Если сценарий запускается на сервере клиентского доступа в вашей организации, сервер клиентского доступа будет прокси-сервером для удаленного сеанса Windows PowerShell на сервере почтовых ящиков в Организации.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-181">If you run the script on a Client Access server in your organization, the Client Access server will proxy the Remote Windows PowerShell session to a Mailbox server in the organization.</span></span>
> [!IMPORTANT]
> <span data-ttu-id="7e9c6-182">Сценарий Ексчукутил. ps1 создает один или несколько IP-шлюзов UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-182">The ExchUcUtil.ps1 script creates one or more UM IP gateways.</span></span> <span data-ttu-id="7e9c6-183">Вы должны отключить исходящие вызовы для всех IP-шлюзов UM за исключением одного шлюза, созданного сценарием.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-183">You must disable outgoing calls on all UM IP gateways except one gateway that the script created.</span></span> <span data-ttu-id="7e9c6-184">Сюда входит отключение исходящих вызовов для IP-шлюзов UM, созданных до запуска сценария.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-184">This includes disabling outgoing calls on UM IP gateways that were created before you ran the script.</span></span> <span data-ttu-id="7e9c6-185">Чтобы отключить исходящие вызовы для IP-шлюза UM, ознакомьтесь со сведениями отключение исходящих вызовов для IP-шлюзов UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-185">To disable outgoing calls on a UM IP gateway, see Disable outgoing calls on UM IP gateways.</span></span> 
> [!IMPORTANT]
> <span data-ttu-id="7e9c6-186">Чтобы запустить сценарий, необходимо иметь разрешения роли управления организацией Exchange или быть членом группы безопасности администраторов организации Exchange.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-186">You must have the permissions of the Exchange Organization Management role or be a member of the Exchange Organization Administrators security group to run the script.</span></span> 

1. <span data-ttu-id="7e9c6-187">Откройте консоль управления Exchange.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-187">Open the Exchange Management Shell.</span></span>
2. <span data-ttu-id="7e9c6-188">В командной строке C:\Windows\System32 введите **букву \<компакт-диска>: \program филес\микрософт\ексчанже Server\V15\Scripts>. Ексчукутил. ps1**и нажмите клавишу ВВОД.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-188">At the C:\Windows\System32 prompt, type **cd \<drive letter>:\Program Files\Microsoft\Exchange Server\V15\Scripts>.ExchUcUtil.ps1**, and then press Enter.</span></span>

#### <a name="how-do-you-know-this-worked"></a><span data-ttu-id="7e9c6-189">Как узнать, что это сработало?</span><span class="sxs-lookup"><span data-stu-id="7e9c6-189">How do you know this worked?</span></span>

<span data-ttu-id="7e9c6-190">Чтобы убедиться, что сценарий Ексчукутул. ps1 успешно завершился, выполните указанные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-190">To verify that the ExchUcUtul.ps1 script completed successfully, do the following:</span></span>
- <span data-ttu-id="7e9c6-191">С помощью командлета Get-Умипгатевай или ПОПЗ просмотрите новые созданные IP-шлюзы или шлюзы UM.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-191">Use the Get-UMIPGateway cmdlet or the EAC to view the new UM IP gateway or gateways that were created.</span></span>
- <span data-ttu-id="7e9c6-192">Используйте командлет Get-Умхунтграуп или ПОПЗ для просмотра новой группы слежения UM или групп, которые были созданы.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-192">Use the Get-UMHuntGroup cmdlet or the EAC to view the new UM hunt group or groups that were created.</span></span>

### <a name="configure-certificates-on-the-server-running-exchange-server-unified-messaging"></a><span data-ttu-id="7e9c6-193">Настройка сертификатов на сервере, на котором работает единая система обмена сообщениями Exchange Server</span><span class="sxs-lookup"><span data-stu-id="7e9c6-193">Configure certificates on the server running Exchange Server Unified Messaging</span></span>
 
<span data-ttu-id="7e9c6-194">Если вы развернули единую систему обмена сообщениями Exchange (UM) в соответствии с инструкциями по планированию интеграции единой системы обмена сообщениями в Skype для бизнеса Server в документации по планированию, и хотите предоставить вам возможности Exchange UM для пользователей корпоративной голосовой связи в вашей учетной записи Организации, для настройки сертификата на сервере, на котором запущено приложение Exchange UM, можно использовать описанные ниже процедуры.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-194">If you have deployed Exchange Unified Messaging (UM), as described in Planning for Exchange Unified Messaging integration in Skype for Business Server in the Planning documentation, and you want to provide Exchange UM features to Enterprise Voice users in your organization, you can use the following procedures to configure the certificate on the server running Exchange UM.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7e9c6-195">Для внутренних сертификатов оба сервера, на которых работает Skype для бизнеса Server и серверы Microsoft Exchange, должны иметь Доверенные корневые центры сертификации, которые являются взаимно доверенными.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-195">For internal certificates, both the servers running Skype for Business Server and the servers running Microsoft Exchange must have trusted root authority certificates that are mutually trusted.</span></span> <span data-ttu-id="7e9c6-196">Центр сертификации (ЦС) может быть либо тем же, либо другим центром сертификации, если корневой сертификат центра сертификации зарегистрирован в хранилище сертификатов доверенного корневого центра.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-196">The certification authority (CA) can either be the same, or a different certification authority, as long as the servers have the certification authority’s root certificate registered in their trusted root authority certificate store.</span></span> 

<span data-ttu-id="7e9c6-197">Для подключения к Skype для бизнеса Server необходимо настроить сервер Exchange с сертификатом сервера.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-197">The Exchange Server must be configured with a server certificate in order to connect to Skype for Business Server:</span></span>
1. <span data-ttu-id="7e9c6-198">Скачайте сертификат ЦС для сервера Exchange.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-198">Download the CA certificate for the Exchange Server.</span></span>
2. <span data-ttu-id="7e9c6-199">Установите сертификат ЦС для сервера Exchange.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-199">Install the CA certificate for the Exchange Server.</span></span>
3. <span data-ttu-id="7e9c6-200">Убедитесь, что центр сертификации входит в список доверенных корневых ЦС сервера Exchange.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-200">Verify that the CA is in the list of trusted root CAs of the Exchange Server.</span></span>
4. <span data-ttu-id="7e9c6-201">Создайте запрос на сертификат для сервера Exchange и установите сертификат.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-201">Create a certificate request for the Exchange Server and install the certificate.</span></span> 
5. <span data-ttu-id="7e9c6-202">Назначьте сертификат для сервера Exchange.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-202">Assign the certificate for the Exchange Server.</span></span>


<span data-ttu-id="7e9c6-203">**Чтобы загрузить сертификат ЦС, выполните указанные ниже действия.**</span><span class="sxs-lookup"><span data-stu-id="7e9c6-203">**To download the CA certificate:**</span></span>

1. <span data-ttu-id="7e9c6-204">На сервере с Exchange UM нажмите кнопку **Пуск**, выберите команду **выполнить**, введите **http://\<имя сервера центра сертификации>/certsrv**и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-204">On the server running Exchange UM, click **Start**, click **Run**, type **http://\<name of your Issuing CA Server>/certsrv**, and then click **OK**.</span></span>
2. <span data-ttu-id="7e9c6-205">В разделе Выберите задачу нажмите **загрузить сертификат ЦС, цепочку сертификатов или CRL**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-205">Under Select a task, click **Download a CA certificate, certificate chain, or CRL**.</span></span>
3. <span data-ttu-id="7e9c6-206">В разделе **Загрузка сертификата ЦС, цепочки сертификатов или CRL**выберите **метод кодирования для базового 64**, а затем нажмите кнопку**загрузить сертификат ЦС**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-206">Under **Download a CA Certificate, Certificate Chain, or CRL**, select **Encoding Method to Base 64**, and then click**Download CA certificate**.</span></span>
   > [!NOTE]
   > <span data-ttu-id="7e9c6-207">Вы также можете задать кодировку DER (правила кодирования) на этом этапе.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-207">You can also specify Distinguished Encoding Rules (DER) encoding at this step.</span></span> <span data-ttu-id="7e9c6-208">Если вы выбрали кодировку DER, тип файла на следующем этапе и на этапе 10 **для установки сертификата ЦС** —. p7b, а не. cer.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-208">If you select DER encoding, the file type in the next step of this procedure and in step 10 of **To Install the CA certificate** is .p7b rather than .cer.</span></span> 
4. <span data-ttu-id="7e9c6-209">В диалоговом окне **Загрузка файла** нажмите кнопку **сохранить**, а затем сохраните файл на жестком диске сервера.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-209">In the **File Download** dialog box, click **Save**, and then save the file to the hard disk on the server.</span></span> <span data-ttu-id="7e9c6-210">(В зависимости от кодировки, выбранной на предыдущем шаге, файл будет содержать расширение. cer или. p7b.)</span><span class="sxs-lookup"><span data-stu-id="7e9c6-210">(The file will have either a .cer or a .p7b file extension, depending on the encoding that you selected in the previous step.)</span></span>

<span data-ttu-id="7e9c6-211">**Чтобы установить сертификат ЦС, выполните указанные ниже действия.**</span><span class="sxs-lookup"><span data-stu-id="7e9c6-211">**To install the CA certificate:**</span></span>

1. <span data-ttu-id="7e9c6-212">На сервере с Exchange UM откройте консоль управления (MMC), нажав кнопку **Пуск**, выберите команду **выполнить**, введите в поле Открыть значение **MMC** и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-212">On the server running Exchange UM, open Microsoft Management Console (MMC) by clicking **Start**, clicking **Run**, typing **mmc** in the Open box, and then clicking **OK**.</span></span>
2. <span data-ttu-id="7e9c6-213">В меню **файл** выберите команду **Добавить или удалить оснастку**, а затем нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-213">On the **File** menu, click **Add/Remove Snap-in**, and then click **Add**.</span></span>
3. <span data-ttu-id="7e9c6-214">В диалоговом окне **Добавление изолированных оснасток** выберите пункт **Сертификаты**и нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-214">In the **Add Standalone Snap-ins** box, click **Certificates**, and then click **Add**.</span></span>
4. <span data-ttu-id="7e9c6-215">В диалоговом окне **Оснастка диспетчера сертификатов** выберите **Учетная запись компьютера** и затем нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-215">In the **Certificate snap-in** dialog box, click **Computer account**, and then click **Next**.</span></span>
5. <span data-ttu-id="7e9c6-216">В диалоговом окне **Выбор компьютера** убедитесь, что на **локальном компьютере установлен флажок (компьютер, на котором запущена эта консоль)** , и нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-216">In the **Select Computer** dialog box, verify that the **Local computer: (the computer this console is running on)** check box is selected, and then click **Finish**.</span></span>
6. <span data-ttu-id="7e9c6-217">Нажмите кнопку **Закрыть**, а затем — кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-217">Click **Close**, and then click **OK**.</span></span> 
7. <span data-ttu-id="7e9c6-218">В дереве консоли разверните узел **Сертификаты (локальный компьютер)**, а затем разверните узел **Доверенные корневые центры сертификации**и выберите пункт **Сертификаты**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-218">In the console tree, expand **Certificates (Local Computer)**, expand **Trusted Root Certification Authorities**, and then click **Certificates**.</span></span>
8. <span data-ttu-id="7e9c6-219">Щелкните правой кнопкой мыши пункт **Сертификаты**, выберите пункт **все задачи**и нажмите кнопку **Импорт**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-219">Right-click **Certificates**, click **All Tasks**, and click **Import**.</span></span>
9. <span data-ttu-id="7e9c6-220">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-220">Click **Next**.</span></span> 
10. <span data-ttu-id="7e9c6-221">Нажмите кнопку **Обзор** , чтобы найти файл, а затем нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-221">Click **Browse** to locate the file, and then click **Next**.</span></span> <span data-ttu-id="7e9c6-222">(В зависимости от кодировки, выбранной на этапе 3 **для скачивания сертификата ЦС**, файл будет содержать расширение. cer или. p7b.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-222">(The file will have either a .cer or a .p7b file extension, depending on the encoding that you selected in step 3 of **To download the CA certificate**.</span></span>
11. <span data-ttu-id="7e9c6-223">Нажмите кнопку **поместить все сертификаты** в следующее хранилище.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-223">Click **Place All Certificates** in the following store.</span></span>
12. <span data-ttu-id="7e9c6-224">Нажмите кнопку **Обзор**и выберите пункт **Доверенные корневые центры сертификации**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-224">Click **Browse**, and then select **Trusted Root Certification Authorities**.</span></span> 
13. <span data-ttu-id="7e9c6-225">Нажмите кнопку **Далее** , чтобы проверить настройки, а затем нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-225">Click **Next** to verify the settings, and then click **Finish**.</span></span> 


<span data-ttu-id="7e9c6-226">**Чтобы убедиться в том, что центр сертификации находится в списке доверенных корневых ЦС, выполните указанные ниже действия.**</span><span class="sxs-lookup"><span data-stu-id="7e9c6-226">**To verify that the CA is in the list of trusted root CAs:**</span></span>

1. <span data-ttu-id="7e9c6-227">На сервере, на котором запущена служба единой системы обмена сообщениями, в MMC разверните раздел Сертификаты (локальный компьютер), разверните узел Доверенные корневые центры сертификации и выберите пункт Сертификаты.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-227">On the server running Exchange UM, in MMC expand Certificates (Local Computer), expand Trusted Root Certification Authorities, and then click Certificates.</span></span>
2. <span data-ttu-id="7e9c6-228">В области сведений убедитесь, что ваш центр сертификации входит в список доверенных центров сертификации.</span><span class="sxs-lookup"><span data-stu-id="7e9c6-228">In the details pane, verify that your CA is on the list of trusted CAs.</span></span>


